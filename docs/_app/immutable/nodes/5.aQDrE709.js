const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/QoFPZSeS.js","../chunks/Bc_TmxSc.js","../chunks/DOBtub6T.js","../assets/index.CQED0rIl.css","../chunks/4u0wcz6f.js","../chunks/C6pzAkdR.js","../chunks/CHwVPrQX.js","../chunks/DXGw_0Ww.js","../chunks/DHAweUE4.js","../chunks/HTOW8iPe.js","../chunks/CYB2EK_d.js","../chunks/CdDXOJ3Y.js","../chunks/CEIZYuf2.js","../chunks/DYslx7It.js","../chunks/DuIgqnlY.js","../chunks/D-Nm-cDg.js","../chunks/DaQyK3nQ.js","../chunks/Dex61Jy7.js","../chunks/DkJ9ydHD.js","../chunks/BUpj17sD.js","../chunks/DwWpeHsS.js","../chunks/BfMV86KQ.js","../chunks/PPVm8Dsz.js","../chunks/mvO4rAvm.js","../assets/component-utils.R4SXog4D.css","../chunks/DP-0fjQN.js","../chunks/8JOOWlUE.js","../chunks/DmtPipHG.js","../chunks/v5xyD8FI.js","../chunks/B87vTgcy.js","../chunks/bnayRBMH.js","../chunks/CbKIfN8e.js","../chunks/Y_0EfhRu.js","../chunks/D2feDspf.js","../chunks/DdbdneQ1.js","../chunks/BV8-ngCo.js","../chunks/Db91rTNV.js","../chunks/JSgpbLKx.js","../chunks/BxzdRo61.js","../chunks/D7TN9t_q.js","../chunks/BdDvN8O6.js","../chunks/DYAvFwNf.js","../chunks/BVzLLi1N.js","../chunks/BT4JRnHr.js","../chunks/BawRJkAp.js","../chunks/in6aGWsR.js","../chunks/CgRsZskV.js","../chunks/h5rW6lAS.js","../chunks/BiKLiV0b.js","../chunks/BFkxbxSE.js","../chunks/CNI1bPWi.js","../chunks/Cp_8tW2x.js","../chunks/BW9c9SrU.js","../chunks/CPLN7muT.js","../chunks/C0wm8_Yw.js","../chunks/C0Q15jgo.js","../chunks/idjzkL-p.js","../chunks/Dm66KbFf.js","../chunks/CH2_fMSn.js","../chunks/B5GhfNyB.js","../chunks/Cgb6qxNH.js","../chunks/D30EvcMW.js","../chunks/E6bx-lsJ.js","../chunks/jrtQMiTD.js","../chunks/8hNj00IL.js","../chunks/BauKPgXA.js","../chunks/CaVKkSa6.js","../chunks/CT-uuzXp.js","../chunks/fFYBqOqn.js","../chunks/B1N-tmtC.js","../chunks/DEfNR1C0.js","../chunks/CtljFrUl.js","../chunks/D-qJO60r.js","../chunks/QQC62dOK.js","../chunks/Bxxl7NsE.js","../chunks/DNogqiqR.js","../chunks/DQOO6RKE.js","../chunks/j00zX3Hz.js","../chunks/Bi6C4OG6.js","../chunks/C7e3Z5XT.js","../chunks/D-YQ4CHs.js","../chunks/COf4WTrX.js","../chunks/O7sg2ysZ.js","../chunks/rIJyvhvt.js","../chunks/Dc261vxq.js","../chunks/CC5XFA8H.js","../chunks/D-fXJnCB.js","../chunks/B4oxan5h.js","../chunks/CEhj4l8G.js","../chunks/D_bKRBrk.js","../chunks/BvwLokzg.js","../chunks/6vsZKnZ9.js","../chunks/7VNfS1TG.js","../chunks/DP5d1tPL.js","../chunks/D-LmNXBe.js","../chunks/B0qK9XMn.js","../chunks/Dci9kdnZ.js","../chunks/CF39WpqH.js","../chunks/BAzr6Eo0.js","../chunks/FTzM2Tyd.js","../chunks/C61-NiK_.js","../chunks/BWeyrF54.js","../chunks/Cx8JFOfk.js","../chunks/BmgeYasw.js","../chunks/DLOQEY_Z.js","../chunks/91llm6te.js","../chunks/D31seSHD.js","../chunks/DH0im0Cr.js","../chunks/NIvIaQ85.js","../chunks/qyF9FwQ9.js","../chunks/XI-Li77m.js","../chunks/Bdg0_NLM.js","../chunks/ShBCB_ow.js","../chunks/Df_x8s9w.js","../chunks/O7OdySC2.js","../chunks/UusjRatb.js","../chunks/BTOnRfOV.js","../chunks/CaYZrGFV.js","../chunks/DiSf52yC.js","../chunks/ChwpPGxO.js","../chunks/DlHjpvET.js","../chunks/h2nqTh5L.js","../chunks/DbKbkLbd.js","../chunks/Blp-4Wmz.js","../chunks/BQBvadb7.js","../chunks/DYyHyQO-.js","../chunks/Epqbrrx8.js","../chunks/OuOF1Ws1.js","../chunks/CHtALhqk.js"])))=>i.map(i=>d[i]);
import{_ as oe}from"../chunks/PPVm8Dsz.js";import"../chunks/DsnmJJEf.js";import{o as _e}from"../chunks/dDAaEPZG.js";import{p as Ve,a7 as w,a8 as v,t as n,a6 as R,c as U,V as se,r as $,a as Ie,u as Pe,a5 as ce,R as Q}from"../chunks/BDDTUZ88.js";import{e as Ae}from"../chunks/DNyUMNTX.js";import{f as j,t as ue,a as A,d as Te}from"../chunks/Cwt5lIb3.js";import{i as fe}from"../chunks/C31JG7LH.js";import{c as de}from"../chunks/D1jCOcTt.js";import{b as ye,d as F}from"../chunks/BElPz1eq.js";import{b as pe}from"../chunks/BSKGGa8Q.js";import{B as me}from"../chunks/B2ZqdCVZ.js";import{S as Ce}from"../chunks/6eoOfjnb.js";import{A as Le,a as Ee,L as We,M as Be,S as Fe}from"../chunks/tFvfzUak.js";import"../chunks/69_IOA4Y.js";import{a as Se,g as ge,m as be,b as De,c as he,F as we,W as O,N as Me,d as ve,e as ze,E as ie,M as Ne,L as xe,f as Oe,B as Re}from"../chunks/BXmjwkzE.js";import"../chunks/DcogKsHq.js";import{_ as Ue}from"../chunks/CbKIfN8e.js";import{z as re}from"../chunks/O7sg2ysZ.js";import"../chunks/DwWpeHsS.js";import"../chunks/D4VJcUD0.js";import"../chunks/CjH7Rf0r.js";import"../chunks/C9bC63rm.js";import"../chunks/BfMV86KQ.js";import"../chunks/D2feDspf.js";import"../chunks/BVLmr62Y.js";import"../chunks/BYRe6UlO.js";import"../chunks/Do8Mu2oV.js";import $e from"../chunks/BSlv9HcN.js";import"../chunks/C92cRl-g.js";async function je(E,f,y){let u=[];const d=E.createQuery();return d.geometry=f.geometry,d.spatialRelationship="intersects",d.returnGeometry=!1,d.outFields=[y],d.num=10,u=(await E.queryFeatures(d)).features.map(m=>m.attributes?.[y]).filter(m=>m!=null).map(m=>String(m)),u.length===0?null:(u=Array.from(new Set(u)),u)}var ke=j(`<div class="analysis-container svelte-wttb71"><div class="header-section svelte-wttb71"><p class="description svelte-wttb71">This is the Analysis tab. This is where the user can initiate analysis for a polygon or area
			(e.g. Ward).</p></div> <div class="button-group svelte-wttb71"><!> <!></div></div>`);function Ze(E,f){Ve(f,!0);let y=v(null),u=v(null),d=v(null),p=v(null),m=v(null);const S="UK Wards (Boundary Fully Clipped) (2022)";_e(async()=>{w(p,Se(f.mapView,"Analysis Results Layer"),!0),await H(),X()});async function H(){if(!f.mapView)throw new Error("[analysis-tab] MapView is not initialized");w(y,new Le,!0),w(u,new Ee(n(y),new We(f.mapView)),!0),w(d,new Be(f.mapView,n(u),new Set([S])),!0),console.log("[analysis-tab] Initialized stores",n(y).layerId),await n(u).refreshLayerView(),await n(u).refreshAreas()}function X(){if(!n(y)){console.warn("[analysis-tab] AreaSelectionStore not initialized yet");return}const a=f.mapView.map?.allLayers.find(e=>e.title===S);a?(n(y).setLayerId(a.uid),console.log(`[analysis-tab] Set default area layer to ID: ${a.uid}`)):console.warn("[analysis-tab] Default area layer not found on the map")}function D(a){const e=[];for(const t of a)t instanceof $e?e.push(...D(t.layers.toArray())):t instanceof re&&e.push(t);return e}function M(a,e=.3){let t=0;for(let s=0;s<a.length;s++)t=a.charCodeAt(s)+((t<<5)-t);const l=t>>0&255,o=t>>8&255,i=t>>16&255;return[l,o,i,e]}function _(a,e=.3,t=[255,0,0,1],l=2){return{type:"simple-fill",color:M(a,e),outline:{color:t,width:l}}}function k(){return{title:"Clipped region",content:[{type:"custom",creator:a=>{const e=a.graphic,t=e.attributes.layerTitles??[],l=e.attributes.layerValues??[],o=document.createElement("table");o.className="esri-widget__table";const i=document.createElement("tbody"),s=document.createElement("tr"),c=document.createElement("th"),r=document.createElement("th");return c.textContent="Layer",r.textContent="Value",s.appendChild(c),s.appendChild(r),i.appendChild(s),t.forEach((h,ae)=>{const B=document.createElement("tr"),I=document.createElement("td");I.textContent=h;const L=document.createElement("td");L.textContent=l[ae]??"",B.appendChild(I),B.appendChild(L),i.appendChild(B)}),o.appendChild(i),o}}]}}function Z(){return!f.mapView||!f.mapView.map?(console.warn("[analysis-tab] MapView not initialized yet"),!1):!n(y)||!n(u)||!n(d)?(console.warn("[analysis-tab] Stores not initialized yet"),!1):n(p)?!0:(console.warn("[analysis-tab] Graphic layer not initialized yet"),!1)}function b(){const a=f.mapView.map.findLayerById("19a9760b651-layer-105");return a&&console.log("Parcels Layer:",a.title),a}async function V(a,e,t){const l=await he({view:f.mapView,input:e,clipLayer:a,targetLayer:n(p)});if(!l){console.log(`No polygon clipped for layer: ${a.title}`);return}for(const o of l)o.attributes??={},o.attributes.layerTitle=a.title,o.attributes.layerId=a.id,a.displayField&&(o.attributes.value=await je(a,o,a.displayField)),o.attributes.layerTitles=[a.title],o.symbol=_(a.id,.3,[255,0,0,1],2),console.log("Clipped Polygon:",l)}function T(a){for(const e of a){const t=e.attributes.layerTitles.join("; ");e.symbol=_(t,.3,[0,0,0,1],1),e.popupTemplate=k()}}async function g(){if(!Z())return;const a=Y();if(a.length===0){console.warn("[analysis-tab] No area selected for analysis");return}if(n(m)===`analyzed-${a.join("-")}`){console.log("[analysis-tab] Analysis already performed for the selected area(s)");return}const e=b();if(!e){console.warn("[analysis-tab] Parcels layer not found");return}const t=await ge(e,a,"OBJECTID",f.mapView);if(!t){console.warn("[analysis-tab] Unable to retrieve polygon for selected parcel IDs");return}const l=D(f.mapView.map.layers.toArray());for(const i of l){if(!(i instanceof re)){console.log(`Skipping non-feature layer: ${i.title}, type: ${i.type}`);continue}if(i.id===e.id){console.log(`Skipping parcels layer itself: ${i.title}`);continue}try{await V(i,t,a[0])}catch(s){console.error(`Error processing layer ${i.title}:`,s);continue}}console.log("Merging clipped polygons in layer:",n(p).id);const o=be(n(p));T(o),n(y)?.clearSelectedAreas(),await n(u)?.refreshAreas(),n(u)?.clearSelections(),w(m,`analyzed-${a.join("-")}`)}async function z(a,e,t){const l=await he({view:f.mapView,input:a,clipLayer:e,clipLayerValueField:t instanceof we?t.fieldName:void 0,targetLayer:n(p)});if(!l||l.length===0){console.log(`No polygon clipped for layer: ${e.title}`);return}console.log(`Clipped ${l.length} polygons from layer: ${e.title}`);const o=t instanceof O||t instanceof Me?t.weight:void 0;for(const i of l){i.attributes.layerTitle=e.title,i.attributes.layerId=e.id,i.attributes.weight=o,i.attributes.layerTitles=[e.title],i.symbol=_(e.id,.3,[255,0,0,1],2);const s=i.attributes.value;i.attributes.weight=o||q(s,t);const c=t instanceof O?t.buffers:G(s,t);for(const r of c)if(r.distance>0){const h=await ve({view:f.mapView,input:i,targetLayer:n(p),bufferDistance:r.distance,bufferUnit:r.unit});h&&(h.attributes={...i.attributes,polygonBuffer:!0,bufferDistance:r.distance,bufferUnit:r.unit,weight:r.weight},h.symbol=_(`${e.id}-buffer-${r.distance}-${r.unit}`,.2,[0,0,255,1],1))}}}function q(a,e){if(!(e instanceof ie))return;const t=e.fieldValues.find(l=>l.value===a);if(t)return t.weight}function G(a,e){if(!(e instanceof ie))return[];const t=e.fieldValues.find(l=>l.value===a);return t?t.buffers||[]:[]}function ee(a){return a instanceof O?a.buffers?.[0]??null:a instanceof ie?a.fieldValues.find(t=>t.buffers&&t.buffers.length)?.buffers?.[0]??null:null}async function le(a,e,t){console.log(`Processing point layer: ${e.title}`);const l=t instanceof we?t.fieldName:void 0,o=ee(t),i=o?.distance??1,s=o?.unit,c=await ze({view:f.mapView,input:a,clipLayer:e,clipLayerValueField:l,bufferDistance:i,bufferUnit:s,targetLayer:n(p)});if(!c||c.length===0){console.log(`No polygon clipped for layer: ${e.title}`);return}console.log(`Clipped ${c.length} polygons from layer: ${e.title}`);for(const r of c){r.attributes??={};const h=r.attributes.value;r.attributes.layerTitle=e.title,r.attributes.layerId=e.id,r.attributes.layerTitles=[e.title],r.attributes.layerValues=h!=null?[String(h)]:r.attributes.layerValues??[],r.attributes.weight=t instanceof O?t.weight:q(h,t),r.symbol=_(e.id,.3,[255,0,0,1],2);const ae=t instanceof O?t.buffers:G(h,t);for(const B of ae){const{distance:I,unit:L}=B;if(!I||I<=0||o&&o.distance===I&&o.unit===L)continue;const ne=await ve({view:f.mapView,input:r,targetLayer:n(p),bufferDistance:I,bufferUnit:L});ne&&(ne.attributes={...r.attributes,polygonBuffer:!0,bufferDistance:I,bufferUnit:L,weight:B.weight},ne.symbol=_(`${e.id}-buffer-${I}-${L??"sr"}`,.2,[0,0,255,1],1))}console.log("Clipped Polygon:",c)}}function J(a,e){const t=new Ue({geometry:a.clone(),attributes:{layerTitle:"Base Weight",layerId:"base-weight-layer",layerTitles:["Base Weight"],layerValues:["base"],value:"base",weight:0,clipped:!1,baseWeight:!0},symbol:{type:"simple-fill",color:[128,128,128,.1],outline:{color:[128,128,128,.5],width:1}}});e.add(t)}function N(a){for(const e of a){const t=e.attributes.memberLayerTitles??[],l=e.attributes.memberLayerWeights??[],o=new Map;for(let s=0;s<t.length;s++){const c=t[s],r=l[s];if(r==null||isNaN(r))continue;const h=o.get(c)??Number.POSITIVE_INFINITY;r<h&&o.set(c,r)}const i=Array.from(o.values()).reduce((s,c)=>s+c,0);if(o.values().find(s=>s<=-1)){e.attributes.totalWeight=-1;continue}e.attributes.totalWeight=i}}function W(a){for(const e of a){const t=typeof e.attributes.totalWeight=="number"?e.attributes.totalWeight:0,l=Math.max(-1,Math.min(1,t));let o;if(l<=0){const i=l+1;o=[Math.round(255*i),0,0,.5]}else{const i=l;o=[Math.round(255*(1-i)),Math.round(255*i),0,.5]}e.symbol={type:"simple-fill",color:o,outline:{color:[0,0,0,1],width:1}},e.popupTemplate=k()}}async function K(){if(!Z())return;const a=Y();if(a.length===0){console.warn("[analysis-tab] No area selected for profile");return}if(n(m)===`profiled-${a.join("-")}`){console.log("[analysis-tab] Profile already performed for the selected area(s)");return}const e=b();if(!e){console.warn("[analysis-tab] Parcels layer not found");return}const t=await ge(e,a,"OBJECTID",f.mapView);if(!t){console.warn("[analysis-tab] Unable to retrieve polygon for selected parcel IDs");return}const l=await De();console.log("AI Where to Build Config:",l);const o=D(f.mapView.map.layers.toArray());for(const s of l.analysisSettings){const c=o.find(r=>r instanceof re&&r.portalItem?.id===s.id);if(!c){console.log(`Layer for setting ID ${s.id} not found on the map`);continue}if(c.id===e.id){console.log(`Skipping parcels layer itself: ${c.title}`);continue}try{c.geometryType==="polygon"?await z(t,c,s):(c.geometryType==="point"||c.geometryType==="multipoint")&&await le(t,c,s)}catch(r){console.error(`Error processing layer ${c.title}:`,r);continue}}console.log("Merging clipped polygons in layer:",n(p).id),J(t,n(p));const i=be(n(p));N(i),W(i),n(y)?.clearSelectedAreas(),await n(u)?.refreshAreas(),n(u)?.clearSelections(),w(m,`profiled-${a.join("-")}`)}function Y(){return!n(u)||!n(y)?[]:Array.from(n(y).selectedAreaIds)}var x=ke(),P=R(U(x),2),C=U(P);me(C,{onclick:K,children:(a,e)=>{se();var t=ue("Analyze");A(a,t)},$$slots:{default:!0}});var te=R(C,2);me(te,{onclick:g,children:(a,e)=>{se();var t=ue("Profile");A(a,t)},$$slots:{default:!0}}),$(P),$(x),A(E,x),Ie()}var qe=j("<div><!></div>"),Ge=j('<arcgis-layer-list></arcgis-layer-list> <div class="basemap-container svelte-1pveq6o"><arcgis-basemap-gallery></arcgis-basemap-gallery></div> <!>',3),Je=j("<arcgis-map></arcgis-map>",2),Ke=j('<div class="layout svelte-1pveq6o"><!> <!></div>');function At(E,f){Ve(f,!0);let y=v(null),u=v(null),d=v(null),p=v(!1),m=v(null),S=v(!1);const H=[{id:"layers",label:"Layers",icon:xe},{id:"basemap",label:"Basemap Gallery",icon:Oe},{id:"analysis",label:"Analysis",icon:Re}];_e(async()=>{await oe(()=>import("../chunks/QoFPZSeS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117]),import.meta.url),await oe(()=>import("../chunks/DiSf52yC.js"),__vite__mapDeps([118,119,2,3,120,12,11,121,7,5,4,1,6,8,9,10,18,19,20,21,22,23,24,122,123,17,48,49,36,50,51,52,39,33,30,124,57,43,125,85,32,34,40,41]),import.meta.url),await oe(()=>import("../chunks/Epqbrrx8.js").then(b=>b.a),__vite__mapDeps([126,18,2,3,19,20,21,22,23,11,24,59,42,36,43,33,30,44,35,32,31,28,34,127,128,124,80,123]),import.meta.url)}),Pe(()=>{!n(u)||!n(d)||(n(u).view=n(d),n(u).listItemCreatedFunction=b=>{const{item:V}=b;V.layer.type!="group"&&(V.panel={content:"legend",open:!0})})});async function X(){w(d,n(y)?.view??null,!0),n(u)&&n(d)&&(n(u).view=n(d)),!n(S)&&(w(S,!0),!(!n(d)||!n(d).map)&&await n(d).when())}function D(b,V){w(p,V,!0),w(m,V?b:null,!0)}var M=Ke(),_=U(M);{var k=b=>{Ne(b,{get options(){return H},onToggleItem:D})};fe(_,b=>{n(d)&&b(k)})}var Z=R(_,2);{const b=T=>{var g=Te(),z=ce(g);de(z,()=>Fe,(q,G)=>{G(q,{children:(ee,le)=>{var J=Ge(),N=ce(J);Q(()=>F(N,"hidden",n(m)!=="layers")),pe(N,P=>w(u,P),()=>n(u));var W=R(N,2),K=U(W);ye(K,1,"basemap-gallery svelte-1pveq6o"),Q(()=>F(K,"view",n(d))),$(W);var Y=R(W,2);{var x=P=>{var C=qe(),te=U(C);Ze(te,{get mapView(){return n(d)}}),$(C),Q(()=>C.hidden=n(m)!=="analysis"),A(P,C)};fe(Y,P=>{n(d)&&P(x)})}Q(()=>W.hidden=n(m)!=="basemap"),A(ee,J)},$$slots:{default:!0}})}),A(T,g)},V=T=>{var g=Je();ye(g,1,"relative h-full w-full"),F(g,"basemap","light-gray-canvas"),F(g,"item-id","331ba640fe6c4fa5b4c3d025160c2ec5"),F(g,"center","-2.231774828836059,53.46531847221502"),F(g,"zoom","15"),pe(g,z=>w(y,z),()=>n(y)),Ae("arcgisViewReadyChange",g,X),A(T,g)};de(Z,()=>Ce,(T,g)=>{g(T,{get isOpen(){return n(p)},hideToggleButton:!0,sidebarContent:b,mainContent:V,$$slots:{sidebarContent:!0,mainContent:!0}})})}$(M),A(E,M),Ie()}export{At as component};
