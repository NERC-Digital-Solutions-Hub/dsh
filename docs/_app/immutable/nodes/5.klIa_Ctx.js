const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/Bo-Ws7j2.js","../chunks/DtUpcSZL.js","../chunks/DHq0rblm.js","../chunks/BfhsIlKo.js","../chunks/qs4PuqLF.js","../chunks/D9Z9MdNV.js","../chunks/Bwh84WyQ.js","../chunks/BgvLO-3W.js","../chunks/BPWMfk3L.js","../chunks/B5FfC49X.js","../chunks/Cw1pwOU3.js","../chunks/Ab6_LQF8.js","../chunks/BzdAE8IO.js","../chunks/C1i-M2aP.js","../chunks/DpT7IovD.js","../chunks/DwaPv9Xz.js","../chunks/DxjcXvGa.js","../chunks/CU7c9CMG.js","../chunks/129gMYlb.js","../chunks/v8BQWUBe.js","../chunks/b9L_h0zx.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/BsbEhHPI.js","../chunks/1paoQEYR.js","../chunks/CbQpSWi7.js","../chunks/Cl5lrJ4c.js","../chunks/DS3I1QGm.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/C4HJhmWz.js","../chunks/BL_xGwnO.js","../chunks/CJDxRR2q.js","../chunks/Djp3mnm5.js","../chunks/5FB5fp0p.js","../chunks/DQOJ18NT.js","../chunks/BXRubaki.js","../chunks/CO7wCLMN.js","../chunks/CISklr1W.js","../chunks/BcYzNU04.js","../chunks/EzLf78vY.js","../chunks/DJcANb4D.js","../chunks/CYIjw6v6.js","../chunks/BHJeQD3W.js","../chunks/CFcsbxo9.js","../chunks/9YvG7tFv.js","../chunks/0RWeYtrz.js","../chunks/D63lrzPI.js","../chunks/aQeO9QTD.js","../chunks/thXDNXE5.js","../chunks/C8mSainR.js","../chunks/BMX0GFJS.js","../chunks/DzdGX2zJ.js","../chunks/BBxgwA0n.js","../chunks/CWhDOlk9.js","../chunks/DZd6gJy7.js","../chunks/DxShpBdY.js","../chunks/C8BmVxiO.js","../chunks/NT2Bw9Xs.js","../chunks/NdScq7k1.js","../chunks/BNxyGXCQ.js","../chunks/C1lBXX5P.js","../chunks/D2J_WLS8.js","../chunks/DQ8jsygj.js","../chunks/CQ7_HgKN.js","../chunks/B7w94aGg.js","../chunks/Chk7YAAL.js","../chunks/D0t3l1UW.js","../chunks/Cgb6qxNH.js","../chunks/CQSPGXrE.js","../chunks/BHlmUX6D.js","../chunks/QQC62dOK.js","../chunks/DJa1hCZQ.js","../chunks/BM6Wwexr.js","../chunks/Bm1xQlw6.js","../chunks/XNewhKeX.js","../chunks/DKpmsPfl.js","../chunks/Sc2kLiW3.js","../chunks/B55yQsaB.js","../chunks/B1N-tmtC.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/CWKudsnk.js","../chunks/pDuGEAnG.js","../chunks/CmGkajPk.js","../chunks/BrScpkSj.js","../chunks/rxpTDz6e.js","../chunks/huXfT4GN.js","../chunks/DoXK2rGs.js","../chunks/Ctm-fIfE.js","../chunks/CL2NbQte.js","../chunks/CpiZ4wIO.js","../chunks/BASHandG.js","../chunks/8QcYoK8I.js","../chunks/NPoLgU3x.js","../chunks/C5CzMsLd.js","../chunks/deFn64y_.js","../chunks/BAf2E7HJ.js","../chunks/Y387DGzA.js","../chunks/CFIXdoHM.js","../chunks/JBhdCoOi.js","../chunks/CHZSYXvn.js","../chunks/BML_M8sQ.js","../chunks/Dnb1jllm.js","../chunks/DfNP466Y.js","../chunks/eWXUghTg.js","../chunks/BE7embxS.js","../chunks/B2pz97Mw.js","../chunks/iS9MPUWn.js","../chunks/GKolV7NZ.js","../chunks/B7so6aiN.js","../chunks/D_jxB2M9.js","../chunks/C70Wcz7U.js","../chunks/Cp7iBt0A.js","../chunks/f7qLKxBD.js","../chunks/4c7MyKAz.js","../chunks/DbuHlGOH.js","../chunks/5Hu3Tj1O.js","../chunks/BDRwM1Gy.js","../chunks/VMSlSy0z.js","../chunks/lYnSLSOW.js","../chunks/C9yb1cMp.js","../chunks/BlVJDMPv.js","../chunks/DKdVR8l2.js","../chunks/DZ6eIUka.js","../chunks/n8j1sCwN.js","../chunks/L_yqRdqL.js","../chunks/BPsRHx0w.js","../chunks/CJzbRXVH.js","../chunks/DVkWVZrr.js","../chunks/Cbt3oAQ3.js","../chunks/C6-4EbnJ.js","../chunks/DdaJqb9x.js","../chunks/BQ9eRUBJ.js","../chunks/yMNjucUt.js","../chunks/DYWnz87V.js","../chunks/dDFQnWwh.js","../chunks/TngxyDh1.js","../chunks/6Dn7lewd.js","../chunks/DfJNYC5A.js","../chunks/zTkdiH1w.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/Bu2dLfoR.js","../chunks/uNqxL_S-.js","../chunks/BVskHUjz.js","../chunks/iUYx5jDy.js","../chunks/B5kADfHL.js","../chunks/CfrNlpsM.js","../chunks/DdSLmJ2d.js","../chunks/BS3H3l-F.js","../chunks/DCdj6Lab.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/Di4P92Bn.js","../chunks/ChlOomCl.js","../chunks/B8TggrAl.js","../chunks/BH-QLa3i.js","../chunks/Bt_bao6a.js","../chunks/CpOLeWL8.js","../chunks/Cy_9-Fvw.js","../chunks/CEiIohNf.js","../chunks/CNvMJFKk.js","../chunks/DqlQ8lc_.js","../chunks/CZQNMlVz.js","../chunks/uuiBM66S.js","../chunks/VStmm7cP.js","../chunks/BqnxlNxI.js","../chunks/BXAqi3_T.js","../chunks/D8UNv0pX.js","../chunks/DsHDw-MJ.js"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{a as Tt,o as Dt}from"../chunks/BTUtnK6b.js";import{aG as V,am as Q,J as r,ah as p,p as K,u as Y,f as N,b as A,a as l,d as $,a8 as k,a6 as _,a7 as w,c as G,a9 as le,N as X,aH as ie,n as ce,aI as me}from"../chunks/DehUWplH.js";import{p as J,i as O,a as Ft,b as Pt}from"../chunks/TLwjHNuO.js";import{_ as ge}from"../chunks/D9Z9MdNV.js";import{a as oe,s as re}from"../chunks/BTpQzbbG.js";import{b as Be}from"../chunks/BquELpeJ.js";import{p as de}from"../chunks/B3jgurcF.js";import{a as ue,i as He}from"../chunks/B--_NR5U.js";import{c as Z}from"../chunks/B1MLz82n.js";import{O as ct,T as zt,G as rt,F as at,a as Et,b as Ie,c as ut,t as se,d as Ot,e as Gt,f as Ut,g as Rt,h as jt,i as Bt,p as Wt,S as Ce,C as nt,j as qt,I as Zt,k as Xt,l as Jt,m as Qt,n as Yt,L as Kt,o as $t,V as ot,q as ei,r as ti}from"../chunks/hTpH4jzT.js";import{e as De,d as ke,s as ye,b as ii}from"../chunks/CZEBf6kI.js";import{h as _e}from"../chunks/DYCabrYF.js";import{d as Ae}from"../chunks/CG5SEHFF.js";import{C as ri,c as Ye,d as Ke,S as ai,e as ni,s as oi,X as si,f as li,g as di,h as ci,i as ui,j as hi,k as vi,l as fi}from"../chunks/B-JAyApq.js";import{B as fe}from"../chunks/CLqO5gQz.js";class gi{#e=V(Q({featureLayerView:null,areaInfos:[]}));get layerHighlightState(){return r(this.#e)}set layerHighlightState(e){p(this.#e,e,!0)}#t=V(null);get lastAddedArea(){return r(this.#t)}set lastAddedArea(e){p(this.#t,e,!0)}#a=V(null);get lastRemovedArea(){return r(this.#a)}set lastRemovedArea(e){p(this.#a,e,!0)}#i=V(null);get currentHoveredArea(){return r(this.#i)}set currentHoveredArea(e){p(this.#i,e,!0)}#r=[];#o=new de;setNameFields(e){console.log("Setting name fields:",e),this.#r=e}setSelectedLayerView(e){this.layerHighlightState?.featureLayerView!==e&&(this.layerHighlightState&&this.layerHighlightState.areaInfos.forEach(t=>{t.handle.remove()}),this.layerHighlightState={featureLayerView:e,areaInfos:[]})}clearSelectedLayerView(){this.layerHighlightState.featureLayerView!==null&&(this.resetSelectedAreas(),this.layerHighlightState.featureLayerView=null)}resetSelectedAreas(){!this.layerHighlightState.featureLayerView&&this.layerHighlightState.areaInfos.length===0||(this.layerHighlightState&&this.layerHighlightState.areaInfos.forEach(e=>{e.handle.remove()}),this.layerHighlightState={featureLayerView:null,areaInfos:[]})}addSelectedArea(e,t){if(console.log("Adding selected area with ID:",e),!this.layerHighlightState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const i={id:e,handle:t};this.layerHighlightState.areaInfos.push(i),this.lastAddedArea=i}removeSelectedArea(e){if(console.log("Removing selected area with ID:",e),!this.layerHighlightState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const t=this.layerHighlightState.areaInfos.findIndex(i=>i.id===e);t!==-1&&(this.lastRemovedArea={id:e,handle:this.layerHighlightState.areaInfos[t].handle},this.layerHighlightState.areaInfos[t].handle.remove(),this.layerHighlightState.areaInfos.splice(t,1))}async getAreaNamesById(e){if(!this.layerHighlightState?.featureLayerView)return[];const t=this.getNameFieldForCurrentLayer();if(!t)return[];const i=this.layerHighlightState.featureLayerView.layer;let a=this.#o.get(i.uid);a||(a=new de,this.#o.set(i.uid,a));const n=new Array(e.length),o=new de,y=[];if(e.forEach((g,b)=>{o.set(g,b);const s=a.get(g);s!==void 0?n[b]=s:y.push(g)}),y.length===0)return n.map(g=>g??"");const d=i.objectIdField,v=await i.queryFeatures({objectIds:y,outFields:[t,d],returnGeometry:!1});for(const g of v.features){const b=g.attributes[d],s=g.attributes[t],m=o.get(b);m!==void 0&&(n[m]=s??"",a.set(b,s??""))}return n.map(g=>g??"")}setHoveredArea(e,t){this.currentHoveredArea&&this.clearHoveredArea(),this.currentHoveredArea={id:e,handle:t}}clearHoveredArea(){this.currentHoveredArea&&(this.currentHoveredArea?.handle.remove(),this.currentHoveredArea=null)}getNameFieldForCurrentLayer(){if(!this.layerHighlightState||!this.layerHighlightState.featureLayerView)return null;const e=this.#r.find(t=>t.layerName===this.layerHighlightState?.featureLayerView?.layer?.title)?.field;return e||(console.warn(`SelectedAreasStore: No name field configured for layer ${this.layerHighlightState.featureLayerView.layer.title}`,this.#r),null)}}const E=new gi;class yi{#e=V(null);get mapView(){return r(this.#e)}set mapView(e){p(this.#e,e,!0)}#t=V(Q(new Set));get interactableLayers(){return r(this.#t)}set interactableLayers(e){p(this.#t,e,!0)}pointerMoveHandle=null;clickHandle=null;leaveHandle=null;enterHandle=null;#a=V(!1);get isInitialized(){return r(this.#a)}set isInitialized(e){p(this.#a,e,!0)}#i=V(!0);get pointerInsideMap(){return r(this.#i)}set pointerInsideMap(e){p(this.#i,e,!0)}initializationInProgress=!1;async initializeAsync(e,t){if(console.log("[map-interaction-store] Initializing with MapView"),this.mapView===e&&this.isInitialized){console.log("[map-interaction-store] MapView is already initialized"),this.interactableLayers=t;return}if(this.initializationInProgress){console.log("[map-interaction-store] Initialization already in progress");return}this.initializationInProgress=!0,console.log("[map-interaction-store] Cleaning up previous MapView if any"),this.cleanup(),this.mapView=e,this.interactableLayers=t,await e.when(),this.setupHighlights(e),this.setupPointerMoveHandler(e),this.setupClickHandler(e),this.setupLeaveHandler(e),this.setupEnterHandler(e),this.isInitialized=!0,this.initializationInProgress=!1,console.log("[map-interaction-store] Initialized with MapView")}updateInteractableLayers(e){this.interactableLayers=e}setupHighlights(e){const t={name:"hover",color:"lightgreen",haloOpacity:1,fillOpacity:.2},i={name:"selected",color:"green",haloOpacity:1,fillOpacity:.3};e.highlights.push(t),e.highlights.push(i)}setupPointerMoveHandler(e){this.pointerMoveHandle=e.on("pointer-move",async t=>{if(!this.pointerInsideMap)return;const{results:i}=await e.hitTest(t),a=i[0];if(!a){this.clearHoverHighlight();return}const n=a.graphic,o=n.layer;if(!n||!o||!this.isLayerInteractable(o.id)||n.attributes?.[o.objectIdField]===void 0){this.clearHoverHighlight();return}const y=n.attributes?.[o.objectIdField];if(!(E.currentHoveredArea&&E.currentHoveredArea.id===y))try{const d=await e.whenLayerView(o);E.layerHighlightState.featureLayerView!==d&&E.setSelectedLayerView(d),this.clearHoverHighlight();const v=d;if(!v){console.warn("LayerView is not a FeatureLayerView");return}if(!this.pointerInsideMap)return;const g=v.highlight(n,{name:"hover"});E.setHoveredArea(y,g)}catch(d){console.error("Error in pointer-move handler:",d),this.clearHoverHighlight()}})}setupClickHandler(e){this.clickHandle=e.on("click",async t=>{const{results:i}=await e.hitTest(t),a=i[0];if(!a)return;const n=a.graphic,o=n.layer;if(console.log("Clicked graphic:",n),!n||!o||!this.isLayerInteractable(o.id)||n.attributes?.[o.objectIdField]===void 0)return;const y=n.attributes?.[o.objectIdField];try{const d=await e.whenLayerView(o),v=d;if(!v){console.warn("Layer is not a FeatureLayerView");return}E.layerHighlightState.featureLayerView!==d&&E.setSelectedLayerView(d);const b=(E.layerHighlightState.areaInfos||[]).find(s=>s.id===y);if(b)E.removeSelectedArea(b.id);else{const s=v.highlight(n,{name:"selected"});E.addSelectedArea(y,s)}}catch(d){console.error("Error in click handler:",d)}})}setupLeaveHandler(e){this.leaveHandle=e.on("pointer-leave",()=>{this.pointerInsideMap=!1,this.clearHoverHighlight()})}setupEnterHandler(e){this.enterHandle=e.on("pointer-enter",()=>{this.pointerInsideMap=!0})}isLayerInteractable(e){return this.interactableLayers.has(e)}clearHoverHighlight(){E.currentHoveredArea&&E.clearHoveredArea()}cleanup(){this.pointerMoveHandle&&(this.pointerMoveHandle.remove(),this.pointerMoveHandle=null),this.clickHandle&&(this.clickHandle.remove(),this.clickHandle=null),this.leaveHandle&&(this.leaveHandle.remove(),this.leaveHandle=null),this.enterHandle&&(this.enterHandle.remove(),this.enterHandle=null),this.clearHoverHighlight(),this.isInitialized=!1,this.mapView=null,this.pointerInsideMap=!0,this.interactableLayers=new Set,console.log("[map-interaction-store] Cleaned up")}get currentMapView(){return this.mapView}get initialized(){return this.isInitialized}}const Me=new yi;var mi=N('<div class="esri-ui-element svelte-xggl6e"><!></div>'),wi=N('<div class="esri-ui-element svelte-xggl6e"><!></div>'),pi=N('<div class="map-view svelte-xggl6e"></div> <!> <!>',1);function _i(f,e){K(e,!0);const t=J(e,"webMap",3,null),i=J(e,"panelPosition",3,"top-left"),a=J(e,"menuPosition",3,"top-right");let n=null,o=V(null),y=V(null),d=V(null),v=V(!1);const g="streets-vector";let b,s;async function m(){if(!s){const[{default:I},{default:x},{default:D}]=await Promise.all([ge(()=>import("../chunks/Bo-Ws7j2.js").then(z=>z.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url),ge(()=>import("../chunks/CISklr1W.js").then(z=>z.a3),__vite__mapDeps([38,1,2,3,5,39,24,6,7,22,40,41,42,43,8,9,10,11,44,23,20,21,45,46,47,48,12,13,49,50,51,25,52,53,17,32,54,55,56,26,57,58,15,59,0,4,14,16,18,19,27,28,29,30,31,33,34,35,36,37,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86]),import.meta.url),ge(()=>import("../chunks/huXfT4GN.js").then(z=>z.W),__vite__mapDeps([87,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,88,89,90,91,62,92,93,74,75,65,94,95,96,61,97,98,99,100,64,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,52,53,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171]),import.meta.url)]);b=I,s=x}}async function u(I,x){const D=new s({container:x,popupEnabled:!1,map:I});return await D.when(),D}function h(I){I.ui.move("zoom","top-right"),r(y)&&i()&&I.ui.add(r(y),i()),r(d)&&a()&&I.ui.add(r(d),a()),p(v,!0)}async function T(){return new b({basemap:g})}async function L(){if(t())try{if(await m(),await C(),!r(o)){console.error("MapView is not initialized");return}r(o).map=t(),console.log("[uprn-map-view] MapView updated with new webMap")}catch(I){console.error("Error updating MapView with new webMap:",I)}}Y(()=>{t()&&L()});async function C(){if(!n){console.error("Map container element was not found");return}try{p(o,await u(t()??void 0,n),!0),h(r(o)),console.log("[uprn-map-view] Map loaded successfully")}catch(I){console.error("Error loading map:",I),await c()}}async function c(){try{const I=await T();p(o,await u(I,n),!0),h(r(o)),console.log("[uprn-map-view] Fallback map loaded")}catch(I){console.error("Error loading fallback map:",I)}}Y(()=>{if(!r(o)||!e.areaSelectionTreeviewStore.initialized)return;const I=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(x=>x.id);Me.initialized?Me.updateInteractableLayers(new Set(I)):Me.initializeAsync(r(o),new Set(I))});async function S(I){if(!r(o))return;const x=await r(o).whenLayerView(I);if(!x){console.warn("Could not get LayerView for the visible node layer");return}E.setSelectedLayerView(x)}Y(()=>{if(!e.areaSelectionTreeviewStore.initialized)return;if(!e.areaSelectionTreeviewStore.getVisibleNodes().length){E.resetSelectedAreas();return}const I=e.areaSelectionTreeviewStore.getVisibleNodes()[0].layer;if(!I){console.warn("Visible node layer is not a FeatureLayer");return}S(I)});function M(){Me.cleanup(),r(o)&&r(o).destroy()}Tt(()=>{M()});var H=pi(),j=A(H);Be(j,I=>n=I,()=>n);var F=k(j,2);{var U=I=>{var x=mi(),D=_(x);{var z=P=>{var W=G(),B=A(W);oe(B,()=>e.panel),l(P,W)};O(D,P=>{r(v)&&P(z)})}w(x),Be(x,P=>p(y,P),()=>r(y)),l(I,x)};O(F,I=>{e.panel&&I(U)})}var R=k(F,2);{var q=I=>{var x=wi(),D=_(x);{var z=P=>{var W=G(),B=A(W);oe(B,()=>e.menu),l(P,W)};O(D,P=>{r(v)&&P(z)})}w(x),Be(x,P=>p(d,P),()=>r(d)),l(I,x)};O(R,I=>{e.menu&&I(q)})}l(f,H),$()}var bi=N('<div class="tree-node-item svelte-1ehc80l"><!></div>'),Si=N('<div class="tree-children relative ml-4 w-full svelte-1ehc80l"><div class="tree-guide-line tree-guide-line-animate svelte-1ehc80l"></div> <!></div>'),Ii=N('<div class="w-full"><!>  <!></div>');function ht(f,e){const t=J(e,"isOpen",3,!1),i=J(e,"childNodes",3,null);var a=Ii(),n=_(a);oe(n,()=>e.content??le);var o=k(n,2);{var y=d=>{var v=Si(),g=k(_(v),2);ue(g,19,()=>i()??[],b=>b.id,(b,s,m)=>{var u=bi(),h=_(u);oe(h,()=>e.childNode??le,()=>r(s)),w(u),X(()=>De(u,`animation-delay: ${100+r(m)*50}ms;`)),l(b,u)}),w(v),l(d,v)};O(o,d=>{t()&&i()&&d(y)})}w(a),l(f,a)}const vt="mb-1 cursor-pointer rounded-md border border-border/30 p-2 text-left",ft="transform-gpu transition-all duration-150 ease-out hover:border-border/50 hover:bg-card/70 hover:shadow-sm",Ci="transition-colors hover:bg-card/70",Je="text-sm font-normal",Qe="bg-card/50",gt="bg-accent text-accent-foreground";function Hi(f){const{enhancedHover:e=!1,includeFont:t=!1,pressed:i=!1}=f;let a=vt;return e?a+=" "+ft:a+=" "+Ci,t&&(a+=" "+Je),i?a+=" "+gt:a+=" "+Qe,a}const ki="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";var Ai=N('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),Li=N('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function st(f,e){const t=`calc(100% - ${e.depth*1}rem)`,i=`${vt} ${ft}`,a=`${i} ${ki} ${Qe} ${Je}`,n=`${i} ${Je}`;var o=G(),y=A(o);{var d=g=>{zt(g,{get pressed(){return e.pressed},get class(){return a},variant:"outline",get style(){return`width: ${t};`},get onPressedChange(){return e.onclick},children:(b,s)=>{var m=Ai(),u=_(m),h=_(u),T=_(h);_e(T,()=>e.icon),w(h);var L=k(h,2),C=_(L,!0);w(L),w(u);var c=k(u,2);oe(c,()=>e.children??le),w(m),X(()=>re(C,e.name)),l(b,m)},$$slots:{default:!0}})},v=g=>{var b=Li();b.__click=function(...S){e.onclick?.apply(this,S)};var s=_(b),m=_(s),u=_(m);ct(u,{get isOpen(){return e.isOpen}});var h=k(u,2),T=_(h);_e(T,()=>e.icon),w(h);var L=k(h,2),C=_(L,!0);w(L),w(m);var c=k(m,2);oe(c,()=>e.children??le),w(s),w(b),X(()=>{ke(b,1,`${n} ${e.pressed?gt:Qe}`),De(b,`width: ${t};`),re(C,e.name)}),l(g,b)};O(y,g=>{e.isTogglable?g(d):g(v,!1)})}l(f,o)}Ae(["click"]);const yt=(f,e,t,i)=>e?xi(f,t):t?i?'<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',xi=(f,e)=>{switch(f.type){case"group":return rt;case"feature":return at;case"tile":return Et;default:return e?rt:at}};function mt(f,e){K(e,!0);const t=h=>{var T=G(),L=A(T);{var C=c=>{var S=G(),M=A(S);{var H=F=>{st(F,{isTogglable:!1,get pressed(){return r(v)},get icon(){return r(g)},get name(){return e.node.name},get depth(){return a()},onclick:u,get isOpen(){return r(d)}})},j=F=>{st(F,{isTogglable:!0,get pressed(){return r(v)},get icon(){return r(g)},get name(){return e.node.name},get depth(){return a()},onclick:m,get isOpen(){return r(d)}})};O(M,F=>{y?F(H):F(j,!1)})}l(c,S)};O(L,c=>{e.treeviewConfigStore.getItemConfig(e.node.id)?.isHidden||c(C)})}l(h,T)},i=(h,T=le)=>{var L=G(),C=A(L);{var c=S=>{{let M=ie(()=>a()+1);mt(S,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return T()},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return r(M)},get useLayerTypeIcon(){return n()}})}};O(C,S=>{y&&r(d)&&!e.treeviewConfigStore.getItemConfig(T().id)?.isHidden&&S(c)})}l(h,L)},a=J(e,"depth",3,0),n=J(e,"useLayerTypeIcon",3,!1),o=!!e.node.layer&&"visible"in e.node.layer,y=!!(e.node.children&&e.node.children.length);let d=V(!1),v=V(!1),g=V("");function b(){return!e.node.children||!e.getNodeVisibility?!1:e.node.children.some(h=>{const T=e.getNodeVisibility(h.id);return T!==void 0?T:h.layer.visible})}Y(()=>{if(e.node){if(y)p(v,b(),!0);else{const h=e.getNodeVisibility?e.getNodeVisibility(e.node.id):void 0;p(v,h!==void 0?h:e.node.layer.visible,!0)}p(g,yt(e.node.layer,n(),y,r(d)),!0)}});function s(){!o||!e.onNodeVisibilityChange||y||(p(v,!r(v)),e.onNodeVisibilityChange(e.node,r(v)))}function m(){y||s(),e.onNodeClick?.(e.node)}function u(){p(d,!r(d)),e.onNodeClick?.(e.node)}{let h=ie(()=>y?e.node.children:null);ht(f,{get isOpen(){return r(d)},get content(){return t},get childNodes(){return r(h)},get childNode(){return i}})}$()}class wt{#e=V(!1);get initialized(){return r(this.#e)}set initialized(e){p(this.#e,e,!0)}#t=null;#a=V(Q([]));#i=ie(()=>{const e=new de;return this.#w(r(this.#a),e),e});#r=V(Q(new de));#o=V(Q(new de));initialize(e,t){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!t)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=t,!e)throw new Error("TreeviewStore requires a valid array of layers to initialize.");p(this.#a,this.#u(e),!0)}getNodeById(e){return this.#l(),r(this.#i).get(e)}getNodes(){return this.#l(),r(this.#a)}getVisibleNodes(){this.#l();const e=[];for(const[t,i]of r(this.#r)){if(!i)continue;const a=r(this.#i).get(t);a&&e.push(a)}return e}getNonHiddenNodes(){return this.#l(),this.#d(r(this.#a))}#d(e){this.#l();const t=[];for(const i of e){const a=this.#n(i.id);if(!(a&&a.isHidden)&&(t.push(i),i.children?.length)){const n=this.#d(i.children);t.push(...n)}}return t}getVisibilityState(e){return this.#l(),r(this.#r).get(e)??!1}setVisibilityState(e,t){this.#l();const i=r(this.#i).get(e);if(!i)throw new Error(`Tree node not found for ID: ${e}`);if(r(this.#r).set(e,t),i.layer.visible=t,this.#s(i,t),i.visibilityDependencyIds?.length&&this.#c(i,t),!i.visibilityGroupId)return;const a=i.visibilityGroupId;console.log(`Node ${e} is part of visibility group ${a}`);let n=r(this.#o).get(a);n||(n=[],r(this.#o).set(a,n));const o=this.#f(a);if(!o)throw new Error(`Visibility group config not found for group ID: ${a}`);if(!t){const d=n.indexOf(e);n.splice(d,1);return}const y=d=>{r(this.#r).set(d,!1);const v=r(this.#i).get(d);v&&(v.layer.visible=!1,this.#s(v,!1),v.visibilityDependencyIds?.length&&this.#c(v,!1));const g=n.indexOf(d);g>=0&&n.splice(g,1)};for(;n.length>=o.maxVisibleLayers;){const d=n[0];y(d)}n.push(e),this.#s(i,t),i.visibilityDependencyIds?.length&&this.#c(i,t)}#s(e,t){e.parent&&(r(this.#r).set(e.parent.id,t),e.parent.layer.visible=t,this.#s(e.parent,t))}#c(e,t){if(e.visibilityDependencyIds?.length)for(const i of e.visibilityDependencyIds){const a=r(this.#i).get(i);a&&(r(this.#r).set(i,t),a.layer.visible=t,this.#s(a,t))}}#f(e){if(e&&this.#t)return this.#t.getVisibilityGroupConfig(e)}#u(e){const t=e.map(i=>{const a=this.#n(i.id);return this.#v(i,void 0,a)});return this.#h([...t])}#n(e){if(e&&this.#t)return this.#t.getItemConfig(e)}#h(e){e.reverse();for(const t of e)t.children?.length&&this.#h(t.children);return e}#v(e,t,i){const a={id:e.id,name:e.title,layer:e,visibilityDependencyIds:i?.visibilityDependencyIds,visibilityGroupId:i?.visibilityGroupId,children:[],parent:t};if(e.visible=i?.isVisibleOnInit??!1,r(this.#r).set(e.id,e.visible),this.#p(e)){const n=e;return a.children=n.layers.toArray().map(o=>{const y=this.#g(o,i);return this.#v(o,a,y)}),a}if(this.#y(e)){const n=e;if(n.sublayers&&n.sublayers.length>0){const o=n.sublayers;a.children=o.toArray().map(this.#m)}}return a}#g(e,t){if(!this.#t||!t)return;const i=this.#t.getItemConfig(e.id);return{id:e.id,type:Ie.None,isDownloadable:i?.isDownloadable,isVisibleOnInit:i?.isVisibleOnInit,isHidden:i?.isHidden,visibilityDependencyIds:i?.visibilityDependencyIds??t.visibilityDependencyIds,visibilityGroupId:i?.visibilityGroupId??t.visibilityGroupId}}#y(e){return e.type==="map-image"||e.type==="wms"}#m(e){const t={id:e.uid,name:e.title,layer:e,children:[]};return e.sublayers?.length&&(t.children=e.sublayers.toArray().map(this.#m)),t}#w(e,t){for(const i of e)t.set(i.id,i),i.children?.length&&this.#w(i.children,t)}#p(e){return e.type==="group"}#l(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}function Vi(f,e){K(e,!0);const t=J(e,"webMap",3,null);Y(()=>{!t()||e.treeviewStore.initialized||e.treeviewStore.initialize(t().layers.toArray(),e.treeviewConfigStore)});var i=G(),a=A(i);{var n=o=>{var y=G(),d=A(y);Z(d,()=>ut,(v,g)=>{g(v,{children:(b,s)=>{var m=G(),u=A(m);ue(u,17,()=>e.treeviewStore.getNodes(),h=>h.id,(h,T)=>{mt(h,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return r(T)},onNodeClick:()=>{},onNodeVisibilityChange:(L,C)=>e.treeviewStore.setVisibilityState(L.id,C),getNodeVisibility:L=>e.treeviewStore.getVisibilityState(L),depth:0,useLayerTypeIcon:!0})}),l(b,m)},$$slots:{default:!0}})}),l(o,y)};O(a,o=>{e.treeviewStore.initialized&&o(n)})}l(f,i),$()}function Ni(f,e){K(e,!0),Y(()=>{if(!E.lastAddedArea)return;(async()=>{if(E.lastAddedArea===null)return;const i=await E.getAreaNamesById([E.lastAddedArea.id]);!i||i.length===0||!i[0]||se.success(`Area added: ${i?.[0]}`)})()}),Y(()=>{if(!E.lastRemovedArea)return;(async()=>{if(E.lastRemovedArea===null)return;const i=await E.getAreaNamesById([E.lastRemovedArea.id]);!i||i.length===0||!i[0]||se.success(`Area removed: ${i?.[0]}`)})()}),$()}var Mi=N("<!> <!>",1),Ti=N("<!> <!>",1);function Di(f,e){K(e,!0);const t=J(e,"triggers",19,()=>[]);var i=G(),a=A(i);Z(a,()=>Ut,(n,o)=>{o(n,{get value(){return e.value},get onValueChange(){return e.onValueChange},class:"w-full",children:(y,d)=>{var v=Ti(),g=A(v);Z(g,()=>Ot,(s,m)=>{m(s,{class:"tab-list",children:(u,h)=>{var T=G(),L=A(T);ue(L,17,t,He,(C,c,S,M)=>{let H=()=>r(c).value,j=()=>r(c).label;var F=Mi(),U=A(F);Z(U,()=>Gt,(I,x)=>{x(I,{get value(){return H()},class:"tab-trigger",children:(D,z)=>{ce();var P=me();X(()=>re(P,j())),l(D,P)},$$slots:{default:!0}})});var R=k(U,2);{var q=I=>{ri(I,{class:"separator"})};O(R,I=>{H()!==t()[t().length-1]?.value&&I(q)})}l(C,F)}),l(u,T)},$$slots:{default:!0}})});var b=k(g,2);oe(b,()=>e.children??le),l(y,v)},$$slots:{default:!0}})}),l(f,i),$()}var Fi=N('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),Pi=N("<!> <!>",1);function Te(f,e){var t=G(),i=A(t);Z(i,()=>Rt,(a,n)=>{n(a,{get value(){return e.value},class:"w-full",children:(o,y)=>{var d=G(),v=A(d);Z(v,()=>Ye,(g,b)=>{b(g,{class:"w-full overflow-hidden",children:(s,m)=>{var u=Pi(),h=A(u);Z(h,()=>Ke,(C,c)=>{c(C,{class:"card-content overflow-hidden p-0",children:(S,M)=>{ai(S,{class:"h-[400px] w-full",children:(H,j)=>{var F=Fi(),U=_(F);oe(U,()=>e.children??le),w(F),l(H,F)},$$slots:{default:!0}})},$$slots:{default:!0}})});var T=k(h,2);{var L=C=>{var c=G(),S=A(c);Z(S,()=>ni,(M,H)=>{H(M,{class:"flex items-center justify-between",children:(j,F)=>{var U=G(),R=A(U);oe(R,()=>e.footer),l(j,U)},$$slots:{default:!0}})}),l(C,c)};O(T,C=>{e.footer&&C(L)})}l(s,u)},$$slots:{default:!0}})}),l(o,d)},$$slots:{default:!0}})}),l(f,t)}class zi{#e=V(!1);get isLoaded(){return r(this.#e)}set isLoaded(e){p(this.#e,e,!0)}#t=V(null);get data(){return r(this.#t)}set data(e){p(this.#t,e,!0)}#a=ie(()=>{const e=new de;function t(i){e.set(i.id,i),i.type==="group"&&i.layers.forEach(n=>{t(n)})}return this.data&&this.data.layers.forEach(i=>{t(i)}),e});get dataLookup(){return r(this.#a)}set dataLookup(e){p(this.#a,e)}#i=V(!1);get loading(){return r(this.#i)}set loading(e){p(this.#i,e,!0)}#r=V(null);get error(){return r(this.#r)}set error(e){p(this.#r,e,!0)}async initializeAsync(e){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:t,itemId:i,proxy:a}=e;await this.configurePortalAsync(t,a),await this.loadwebmapAsync(i)}catch(t){console.error("Error initializing webmap:",t),this.error=t.message}finally{this.loading=!1}}}async configurePortalAsync(e,t){if(!e)return;const i=await Gi();if(i.portalUrl=e,console.log(i),!t)return;const{addProxyRule:a}=await Ui();console.log("Adding proxy rule for portal traffic"),a({urlPrefix:t?.urlPrefix,proxyUrl:t?.proxyUrl})}async loadwebmapAsync(e){if(this.data)return;const[t,i]=await Promise.all([Ei(),Oi()]),a=new i({id:e}),n=new t({portalItem:a});this.data=n,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}let We=null,qe=null,Ze=null,Xe=null;async function Ei(){return We||(We=ge(()=>import("../chunks/huXfT4GN.js").then(f=>f.W),__vite__mapDeps([87,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,88,89,90,91,62,92,93,74,75,65,94,95,96,61,97,98,99,100,64,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,52,53,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171]),import.meta.url).then(f=>f.default)),We}async function Oi(){return qe||(qe=ge(()=>import("../chunks/DxjcXvGa.js"),__vite__mapDeps([16,5,1,2,3,6,7,13,10]),import.meta.url).then(f=>f.default)),qe}async function Gi(){return Ze||(Ze=ge(()=>import("../chunks/DHq0rblm.js").then(f=>f.Z),[],import.meta.url).then(f=>f.default)),Ze}async function Ui(){return Xe||(Xe=ge(()=>import("../chunks/BgvLO-3W.js").then(f=>f.O),__vite__mapDeps([7,2,3]),import.meta.url)),Xe}class Ri{#e=V(Q(new de));get DataSelections(){return r(this.#e)}set DataSelections(e){p(this.#e,e,!0)}addSelection(e){this.DataSelections.set(e.layerId,e),se.success(`'${e.name}' Added`)}removeSelection(e){const t=this.DataSelections.get(e);this.DataSelections.delete(e),se.success(`'${t?.name}' Removed`)}}const te=new Ri;function ji(f,e){f.stopPropagation(),e.onFilterClicked?.(e.layerId)}var Bi=N("<button><!></button>");function pt(f,e){K(e,!0);let t=V(Q(e.hasFiltersApplied?.(e.layerId)??!1));Y(()=>{p(t,e.hasFiltersApplied?.(e.layerId)??!1,!0)});const i=ie(()=>r(t)?jt:Bt);var a=Bi();let n;a.__click=[ji,e];var o=_(a);_e(o,()=>r(i)),w(a),X(y=>{n=ke(a,1,"filter-btn svelte-effqed",null,n,y),ye(a,"aria-pressed",r(t))},[()=>({active:r(t)})]),l(f,a),$()}Ae(["click"]);class Wi{#e=V(null);get ActiveLayer(){return r(this.#e)}set ActiveLayer(e){p(this.#e,e,!0)}}var qi=N('<li class="area-item svelte-1eawb4y"><span class="area-name svelte-1eawb4y"> </span> <!></li>'),Zi=N('<ul class="selected-list svelte-1eawb4y"></ul> <p class="count svelte-1eawb4y"> </p>',1),Xi=N('<p class="no-selection svelte-1eawb4y">No areas selected</p>'),Ji=N('<li class="data-item svelte-1eawb4y"><span class="data-name svelte-1eawb4y"> </span> <div class="data-actions svelte-1eawb4y"><!> <!></div></li>'),Qi=N('<ul class="selected-list svelte-1eawb4y"></ul> <p class="count svelte-1eawb4y"> </p>',1),Yi=N('<p class="no-selection svelte-1eawb4y">No data selected</p>'),Ki=N('<h2 class="svelte-1eawb4y">Export Options</h2> <div class="section svelte-1eawb4y"><h3 class="svelte-1eawb4y"> </h3> <h4 class="svelte-1eawb4y">Selected Areas</h4> <!></div> <div class="section svelte-1eawb4y"><h4 class="svelte-1eawb4y">Selected Data</h4> <!></div>',1);function $i(f,e){K(e,!0);const t=J(e,"fieldFilterMenuStore",7);let i=V(Q([]));Y(()=>{if(!E.layerHighlightState.areaInfos.length){p(i,[],!0);return}(async()=>{const S=await E.getAreaNamesById(E.layerHighlightState.areaInfos.map(H=>H.id)),M=[];for(let H=0;H<S.length;H++)M.push({name:S[H]||"Unknown Area",HighlightAreaInfo:E.layerHighlightState.areaInfos[H]});p(i,M,!0)})()});function a(c){const S=r(i).findIndex(M=>M.name===c);S!==-1&&E.removeSelectedArea(r(i)[S]?.HighlightAreaInfo.id)}function n(c){console.log("[export-menu] Removing data selection for layerId:",c),te.DataSelections.delete(c),console.log("[export-menu] Current SelectedData:",oi(te.DataSelections))}function o(c){t().ActiveLayer?.id===c?t().ActiveLayer=null:t().ActiveLayer=e.webMapStore.dataLookup.get(c)}function y(c){const S=te.DataSelections.get(c);return!(!S||!S.fields||S.fields.size===0||S.fields.size===e.webMapStore.dataLookup.get(c).fields?.length)}var d=Ki(),v=k(A(d),2),g=_(v),b=_(g,!0);w(g);var s=k(g,4);{var m=c=>{var S=Zi(),M=A(S);ue(M,21,()=>r(i),He,(F,U)=>{var R=qi(),q=_(R),I=_(q,!0);w(q);var x=k(q,2);fe(x,{variant:"ghost",size:"sm",class:"area-remove-btn",onclick:()=>a(r(U).name),children:(D,z)=>{ce();var P=me("×");l(D,P)},$$slots:{default:!0}}),w(R),X(()=>re(I,r(U).name)),l(F,R)}),w(M);var H=k(M,2),j=_(H);w(H),X(()=>re(j,`${r(i).length??""} area(s) selected`)),l(c,S)},u=c=>{var S=Xi();l(c,S)};O(s,c=>{r(i).length>0?c(m):c(u,!1)})}w(v);var h=k(v,2),T=k(_(h),2);{var L=c=>{var S=Qi(),M=A(S);ue(M,21,()=>[...te.DataSelections.values()],He,(F,U)=>{var R=Ji(),q=_(R),I=_(q,!0);w(q);var x=k(q,2),D=_(x);{var z=W=>{pt(W,{get layerId(){return r(U).layerId},onFilterClicked:o,hasFiltersApplied:y})};O(D,W=>{r(U).fields&&W(z)})}var P=k(D,2);fe(P,{variant:"ghost",size:"sm",class:"data-remove-btn",onclick:()=>n(r(U).layerId),children:(W,B)=>{ce();var ae=me("×");l(W,ae)},$$slots:{default:!0}}),w(x),w(R),X(()=>re(I,r(U).name)),l(F,R)}),w(M);var H=k(M,2),j=_(H);w(H),X(()=>re(j,`${te.DataSelections.size??""} data layer(s) selected`)),l(c,S)},C=c=>{var S=Yi();l(c,S)};O(T,c=>{te.DataSelections.size>0?c(L):c(C,!1)})}w(h),X(c=>re(b,c),[()=>e.areaSelectionTreeviewStore.initialized?e.areaSelectionTreeviewStore.getVisibleNodes()[0]?.name:"Loading..."]),l(f,d),$()}class er{#e=V(Q([]));get downloads(){return r(this.#e)}set downloads(e){p(this.#e,e,!0)}}const pe=new er;var tr=N('<p class="text-sm text-muted-foreground">Click "Export" to begin the download.</p> <!>',1);function ir(f,e){K(e,!0);const t=()=>Pt(Wt,"$page",i),[i,a]=Ft();function n(){if(E.layerHighlightState.areaInfos.length<=0){se.error("Please select at least one area to export.");return}if(te.DataSelections.size<=0){se.error("Please select at least one data layer to export.");return}console.log("Starting export..."),se.info("Export started successfully.",{duration:4e3});const d=crypto.randomUUID();pe.downloads.push({id:d,url:`${t().url}/${d}`,status:"pending"}),e.onExportSuccess?.()}var o=tr(),y=k(A(o),2);fe(y,{onclick:n,children:(d,v)=>{ce();var g=me("Export");l(d,g)},$$slots:{default:!0}}),l(f,o),$(),a()}var rr=N('<p class="text-sm font-medium"> </p>'),ar=N('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function nr(f,e){K(e,!0);let t=V(null),i=V(Q({x:0,y:0})),a=0;const n=v=>{p(i,{x:v.clientX,y:v.clientY},!0)};Y(()=>(document.addEventListener("mousemove",n),()=>{document.removeEventListener("mousemove",n)})),Y(()=>{const v=E.currentHoveredArea?.id,g=++a;if(!v){p(t,null);return}(async()=>{const b=await E.getAreaNamesById([v]);g===a&&E.currentHoveredArea?.id===v&&p(t,b[0]??null,!0)})()});var o=G(),y=A(o);{var d=v=>{var g=ar(),b=_(g);Z(b,()=>Ye,(s,m)=>{m(s,{class:"max-w-xs border !py-2 shadow-lg",children:(u,h)=>{var T=G(),L=A(T);Z(L,()=>Ke,(C,c)=>{c(C,{class:"!px-3 !py-0",children:(S,M)=>{var H=rr(),j=_(H,!0);w(H),X(()=>re(j,r(t))),l(S,H)},$$slots:{default:!0}})}),l(u,T)},$$slots:{default:!0}})}),w(g),X(()=>De(g,`left: ${r(i).x+10}px; top: ${r(i).y-10}px;`)),l(v,g)};O(y,v=>{r(t)&&v(d)})}l(f,o),$()}function or(f,e){f.target===f.currentTarget&&e()}var sr=(f,e)=>f.key==="Escape"&&e(),lr=(f,e,t)=>e(r(t).name),dr=N('<div class="info-icon-container svelte-18b92yu"><!></div>'),cr=N('<div class="field-content-wrapper svelte-18b92yu"><!> <button class="field-content svelte-18b92yu" tabindex="0"><div class="field-name-container svelte-18b92yu"><span class="field-name svelte-18b92yu"> </span> <!></div></button></div>'),ur=N('<div class="master-checkbox-container svelte-18b92yu"><!> <span class="master-checkbox-label svelte-18b92yu">Select All Fields</span></div> <!> <!>',1),hr=N("<!> <!>",1),vr=N("<!> <!>",1),fr=N('<button class="close-button svelte-18b92yu" aria-label="Close"><!></button> <!>',1),gr=N('<div class="card-container svelte-18b92yu" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function yr(f,e){K(e,!0);const t=J(e,"fieldFilterMenuStore",7);let i=V(null),a=V(Q(new Ce)),n=ie(()=>{if(!r(i)||!r(i).fields)return{checked:!1,indeterminate:!1};const u=r(i).fields.length,h=r(a)?.size||0;return h===0?{checked:!1,indeterminate:!1}:h===u?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});Y(()=>{console.log("Active Layer to Filter:",t().ActiveLayer);const u=t().ActiveLayer;if(p(i,u,!0),u){const h=te.DataSelections.get(u.id);h?.fields?p(a,new Ce([...h.fields]),!0):p(a,new Ce,!0)}});function o(){y(),t().ActiveLayer=null}function y(){if(!r(i))return;let u=te.DataSelections.get(r(i).id);if(u){if((u.fields===void 0||u.fields===null)&&(u.fields=new Ce),r(a).size===0){te.removeSelection(r(i).id);return}u.fields.clear(),r(a).forEach(h=>{u.fields?.add(h)})}}function d(u){r(i)&&(r(a).has(u)?r(a).delete(u):r(a).add(u))}function v(){if(!r(i)?.fields)return;(r(a)?.size||0)===0?r(i).fields.forEach(h=>{r(a).add(h.name)}):r(a).clear()}function g(){return r(i)?.fields?r(i).fields.filter(u=>!e.fieldsToHide?.has(u.alias?.toLowerCase()??"")):[]}var b=G(),s=A(b);{var m=u=>{var h=gr();h.__click=[or,o],h.__keydown=[sr,o];var T=_(h);Z(T,()=>Ye,(L,C)=>{C(L,{class:"command-card",children:(c,S)=>{var M=fr(),H=A(M);H.__click=o;var j=_(H);si(j,{size:20}),w(H);var F=k(H,2);Z(F,()=>Ke,(U,R)=>{R(U,{class:"card-content",children:(q,I)=>{var x=G(),D=A(x);Z(D,()=>li,(z,P)=>{P(z,{children:(W,B)=>{var ae=vr(),ee=A(ae);Z(ee,()=>di,(he,ve)=>{ve(he,{placeholder:"Search for fields..."})});var be=k(ee,2);Z(be,()=>ci,(he,ve)=>{ve(he,{children:(we,Fe)=>{var Le=hr(),xe=A(Le);Z(xe,()=>ui,(Pe,ze)=>{ze(Pe,{children:(Ee,St)=>{ce();var Ve=me("No results found.");l(Ee,Ve)},$$slots:{default:!0}})});var bt=k(xe,2);Z(bt,()=>hi,(Pe,ze)=>{ze(Pe,{heading:"Fields",children:(Ee,St)=>{var Ve=ur(),Oe=A(Ve),It=_(Oe);nt(It,{get checked(){return r(n).checked},get indeterminate(){return r(n).indeterminate},onCheckedChange:v}),ce(2),w(Oe);var $e=k(Oe,2);Z($e,()=>qt,(Ge,ne)=>{ne(Ge,{})});var Ct=k($e,2);ue(Ct,17,g,He,(Ge,ne)=>{var et=G(),Ht=A(et);Z(Ht,()=>vi,(kt,At)=>{At(kt,{class:"field-item",onselect:()=>d(r(ne).name),children:(Lt,Pr)=>{var Ue=cr(),tt=_(Ue);{let Se=ie(()=>r(a)?.has(r(ne).name)??!1);nt(tt,{class:"field-checkbox",get checked(){return r(Se)},onCheckedChange:()=>d(r(ne).name)})}var Re=k(tt,2);Re.__click=[lr,d,ne];var it=_(Re),je=_(it),xt=_(je,!0);w(je);var Vt=k(je,2);{var Nt=Se=>{var Ne=dr(),Mt=_(Ne);_e(Mt,()=>Zt),w(Ne),X(()=>ye(Ne,"title",r(ne).description)),l(Se,Ne)};O(Vt,Se=>{r(ne).description&&Se(Nt)})}w(it),w(Re),w(Ue),X(()=>re(xt,r(ne).alias||r(ne).name)),l(Lt,Ue)},$$slots:{default:!0}})}),l(Ge,et)}),l(Ee,Ve)},$$slots:{default:!0}})}),l(we,Le)},$$slots:{default:!0}})}),l(W,ae)},$$slots:{default:!0}})}),l(q,x)},$$slots:{default:!0}})}),l(c,M)},$$slots:{default:!0}})}),w(h),l(u,h)};O(s,u=>{r(i)&&u(m)})}l(f,b),$()}Ae(["click","keydown"]);var mr=N('<li class="download-item svelte-ynwhdm"><div class="download-info svelte-ynwhdm"><span class="download-url svelte-ynwhdm"> </span></div> <div class="download-actions svelte-ynwhdm"><div><!></div> <!> <!> <!></div></li>'),wr=N('<ul class="selected-list svelte-ynwhdm"></ul> <p class="count svelte-ynwhdm"> </p>',1),pr=N('<p class="no-selection svelte-ynwhdm">No downloads in queue</p>'),_r=N('<div class="section svelte-ynwhdm"><h4 class="svelte-ynwhdm">Download Queue</h4> <!></div>');function br(f,e){K(e,!0);let t=V(Q(new Set));function i(s){const m=pe.downloads.findIndex(u=>u.url===s);m!==-1&&pe.downloads.splice(m,1)}async function a(s){try{await navigator.clipboard.writeText(s),p(t,new Set(r(t)).add(s),!0),se.success("URL copied to clipboard"),setTimeout(()=>{const m=new Set(r(t));m.delete(s),p(t,m,!0)},2e3)}catch(m){console.error("Failed to copy URL:",m),se.error("Failed to copy URL to clipboard")}}function n(s){switch(s){case"completed":return"#059669";case"in-progress":return"#2563eb";case"failed":return"#dc2626";case"pending":default:return"#6b7280"}}function o(s){switch(s){case"completed":return"Completed";case"in-progress":return"In Progress";case"failed":return"Failed";case"pending":default:return"Pending"}}function y(s){switch(s){case"completed":return $t;case"in-progress":return Kt;case"failed":return Yt;case"pending":default:return Qt}}var d=_r(),v=k(_(d),2);{var g=s=>{var m=wr(),u=A(m);ue(u,21,()=>pe.downloads,He,(L,C)=>{var c=mr(),S=_(c),M=_(S),H=_(M,!0);w(M),w(S);var j=k(S,2),F=_(j),U=_(F);{let D=ie(()=>n(r(C).status));fe(U,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${r(D)??""}`},disabled:!0,children:(z,P)=>{const W=ie(()=>y(r(C).status));var B=G(),ae=A(B);{let ee=ie(()=>r(C).status==="in-progress"?"spinning":"");Z(ae,()=>r(W),(be,he)=>{he(be,{size:14,get class(){return r(ee)}})})}l(z,B)},$$slots:{default:!0}})}w(F);var R=k(F,2);fe(R,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>a(r(C).url),title:"Copy URL to clipboard",children:(D,z)=>{var P=G(),W=A(P);{var B=ee=>{Xt(ee,{size:14})},ae=ee=>{Jt(ee,{size:14})};O(W,ee=>{r(t).has(r(C).url)?ee(B):ee(ae,!1)})}l(D,P)},$$slots:{default:!0}});var q=k(R,2);{var I=D=>{fe(D,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(r(C).url,"_blank"),title:"Open download",children:(z,P)=>{ce();var W=me("📥");l(z,W)},$$slots:{default:!0}})};O(q,D=>{r(C).status==="completed"&&D(I)})}var x=k(q,2);fe(x,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>i(r(C).url),title:"Remove from queue",children:(D,z)=>{ce();var P=me("×");l(D,P)},$$slots:{default:!0}}),w(j),w(c),X(D=>{ye(M,"title",r(C).url),re(H,r(C).id),ye(F,"title",D)},[()=>o(r(C).status)]),l(L,c)}),w(u);var h=k(u,2),T=_(h);w(h),X(()=>re(T,`${pe.downloads.length??""} download(s) in queue`)),l(s,m)},b=s=>{var m=pr();l(s,m)};O(v,s=>{pe.downloads.length>0?s(g):s(b,!1)})}w(d),l(f,d),$()}var Sr=N('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function lt(f,e){K(e,!0);const t=J(e,"isGroup",3,!1),i=J(e,"isOpen",3,!1),a=`calc(100% - ${e.depth*1}rem)`;var n=Sr();n.__click=function(...h){e.onclick?.apply(this,h)};var o=_(n),y=_(o),d=_(y);{var v=h=>{ct(h,{get isOpen(){return i()}})};O(d,h=>{t()&&h(v)})}var g=k(d,2),b=_(g);_e(b,()=>e.icon),w(g);var s=k(g,2),m=_(s,!0);w(s),w(y);var u=k(y,2);oe(u,()=>e.children??le),w(o),w(n),X(h=>{ke(n,1,h),De(n,`width: ${a};`),re(m,e.name)},[()=>ii(Hi({enhancedHover:!0,includeFont:!0}))]),l(f,n),$()}Ae(["click"]);const Ir='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-down-to-line-icon lucide-arrow-down-to-line"><path d="M12 17V3"/><path d="m6 11 6 6 6-6"/><path d="M19 21H5"/></svg>';function Cr(f,e,t){f.stopPropagation(),p(e,!r(e)),t.onDownloadStateChanged?.(t.node,r(e))}var Hr=N("<button><!></button>");function kr(f,e){K(e,!0);let t=V(Q(e.getDownloadState?.(e.node)??!1));Y(()=>{if(e.getDownloadState){const o=e.getDownloadState(e.node);p(t,o??!1,!0)}});var i=Hr();let a;i.__click=[Cr,t,e];var n=_(i);_e(n,()=>Ir),w(i),X(o=>{a=ke(i,1,"download-btn svelte-1gynj9v",null,a,o),ye(i,"title",`Download ${e.node.name??""}`),ye(i,"aria-label",`Download ${e.node.name??""}`),ye(i,"aria-pressed",r(t))},[()=>({active:r(t)})]),l(f,i),$()}Ae(["click"]);var Ar=N('<div class="flex items-center gap-2"><!></div>'),Lr=N("<div><!></div>"),xr=N("<!> <!>",1),Vr=N('<div class="flex items-center gap-2"><!> <!></div>');function _t(f,e){K(e,!0);const t=L=>{var C=G(),c=A(C);{var S=M=>{var H=G(),j=A(H);{var F=R=>{lt(R,{get icon(){return r(b)},get name(){return e.node.name},get depth(){return n()},onclick:T,isGroup:!0,get isOpen(){return r(v)},children:I=>{var x=Ar(),D=_(x);{var z=P=>{ot(P,{get checked(){return r(g)},onCheckedChange:u})};O(D,P=>{d&&P(z)})}w(x),l(I,x)},$$slots:{default:!0}})},U=R=>{lt(R,{get icon(){return r(b)},get name(){return e.node.name},get depth(){return n()},onclick:h,isGroup:!1,children:I=>{var x=Vr(),D=_(x);{var z=B=>{var ae=xr(),ee=A(ae);{var be=ve=>{var we=Lr();let Fe;var Le=_(we);pt(Le,{get layerId(){return e.node.id},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied}}),w(we),X(xe=>Fe=ke(we,1,"filter-transition-wrapper svelte-42m3ms",null,Fe,xe),[()=>({"fade-in":!r(m),"fade-out":r(m)})]),l(ve,we)};O(ee,ve=>{r(s)&&ve(be)})}var he=k(ee,2);kr(he,{get node(){return e.node},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState}}),l(B,ae)};O(D,B=>{e.isDownloadable&&B(z)})}var P=k(D,2);{var W=B=>{ot(B,{get checked(){return r(g)},onCheckedChange:u})};O(P,B=>{d&&B(W)})}w(x),l(I,x)},$$slots:{default:!0}})};O(j,R=>{y?R(F):R(U,!1)})}l(M,H)};O(c,M=>{a()?.getItemConfig(e.node.id)?.isHidden||M(S)})}l(L,C)},i=(L,C=le)=>{var c=G(),S=A(c);{var M=H=>{{let j=ie(()=>a()?.getItemConfig(C().id)?.isDownloadable??!0),F=ie(()=>n()+1);_t(H,{get node(){return C()},get isDownloadable(){return r(j)},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return r(F)},get useLayerTypeIcon(){return o()}})}};O(S,H=>{y&&r(v)&&!a()?.getItemConfig(C().id)?.isHidden&&H(M)})}l(L,c)},a=J(e,"treeviewConfigStore",3,null),n=J(e,"depth",3,0),o=J(e,"useLayerTypeIcon",3,!1),y=!!(e.node.children&&e.node.children.length),d=!!e.node.layer&&"visible"in e.node.layer&&!y;let v=V(!1),g=V(!1),b=V(""),s=V(!1),m=V(!1);Y(()=>{if(!e.node)return;const L=e.getNodeVisibility?e.getNodeVisibility(e.node.id):void 0;p(g,L!==void 0?L:e.node.layer.visible,!0),p(b,yt(e.node.layer,o(),y,r(v)),!0)}),Y(()=>{const L=(e.getDownloadState?.(e.node)&&e.node.layer.type==="feature")??!1;L&&!r(s)?(p(s,!0),p(m,!1)):!L&&r(s)&&(p(m,!0),setTimeout(()=>{p(s,!1),p(m,!1)},180))});function u(){!d||!e.onNodeVisibilityChange||(p(g,!r(g)),e.onNodeVisibilityChange(e.node,r(g)))}function h(){e.onNodeClick?.(e.node)}function T(){p(v,!r(v)),e.onNodeClick?.(e.node)}{let L=ie(()=>y?e.node.children:null);ht(f,{get isOpen(){return r(v)},get content(){return t},get childNodes(){return r(L)},get childNode(){return i}})}$()}function Nr(f,e){K(e,!0);const t=J(e,"webMap",3,null),i=J(e,"fieldFilterMenuStore",7),a=new wt;Y(()=>{if(!t()||a.initialized)return;(async()=>{a.initialize(t().layers.toArray(),e.treeviewConfigStore),console.log("TreeView initialized with layers:",a.getNodes())})()});function n(s,m){if(m){const u={layerId:s.id,name:s.layer.title||"",fields:new Ce(s.layer.fields?.map(h=>h.name)||[])};te.addSelection(u)}else te.removeSelection(s.id)}function o(s){return te.DataSelections.has(s.id)}function y(s){if(i().ActiveLayer?.uid===s)i().ActiveLayer=null;else{const u=a.getNodeById(s)?.layer;i().ActiveLayer=u}}function d(s){const m=te.DataSelections.get(s);if(!m?.fields)return!1;const u=a.getNodeById(s);if(!u)return!1;const h=u.layer.fields?.length||0,T=m.fields.size;return T>0&&T!==h}var v=G(),g=A(v);{var b=s=>{var m=G(),u=A(m);Z(u,()=>ut,(h,T)=>{T(h,{children:(L,C)=>{var c=G(),S=A(c);ue(S,17,()=>a.getNodes(),M=>M.id,(M,H)=>{{let j=ie(()=>e.treeviewConfigStore.getItemConfig(r(H).id)?.isDownloadable??!1);_t(M,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return r(H)},get isDownloadable(){return r(j)},onNodeClick:()=>{},onNodeVisibilityChange:(F,U)=>a.setVisibilityState(F.id,U),getNodeVisibility:F=>a.getVisibilityState(F),onDownloadStateChanged:n,getDownloadState:o,onFilterClicked:y,hasFiltersApplied:d,depth:0,useLayerTypeIcon:!0})}}),l(L,c)},$$slots:{default:!0}})}),l(s,m)};O(g,s=>{a.initialized&&s(b)})}l(f,v),$()}class dt{#e=[];#t=new Map;#a=[];#i=new Map;#r=[];#o=new Map;#d=new Set;constructor(e){if(!e)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=e.items??[],this.#t=new Map(this.#e.map(t=>[t.id,t])),this.#a=e.visibilityGroups??[],this.#i=new Map(this.#a.map(t=>[t.id,t])),this.#r=e.inheritanceGroups??[],this.#o=new Map(this.#r.map(t=>[t.id,t])),e.fieldsToHide&&(this.#d=new Set(e.fieldsToHide.map(t=>t.trim().toLowerCase())))}getItemConfig(e){return this.#t.get(e)}getVisibilityGroupConfig(e){return this.#i.get(e)}getInheritanceGroupConfig(e){return this.#o.get(e)}resolveInheritance(e){if(!(e.length===0||!this.#e||this.#e.length===0))for(const t of e)this.#s(t)}#s(e,t){const i=this.#c(e,t);if(this.#y(e)&&i.showFields){const a=e;a.loaded||console.warn(`Layer not loaded: ${e.id}`);for(const n of a.fields??[])this.#f(this.#v(e.id,n.name),n.alias||n.name,i)}if(this.#g(e)){const a=e;for(const n of a.layers.toArray())this.#s(n,i)}}#c(e,t){const i=this.#u(e.id,t);return i.type===Ie.None&&(i.type=ei(e)),i}#f(e,t,i){const a=this.#u(e,i);return a.type===Ie.None&&(a.type=Ie.Field),this.#d.has(t.trim().toLowerCase())&&(a.isHidden=!0),a}#u(e,t){let i=this.getItemConfig(e);const a=i!==void 0,n=i?.inheritanceGroupId?this.getInheritanceGroupConfig(i.inheritanceGroupId):this.getInheritanceGroupConfig(t?.inheritanceGroupId??"");return i={id:e,type:Ie.None,isDownloadable:this.#n(n,"isDownloadable",i,t,!0),isVisibleOnInit:this.#n(n,"isVisibleOnInit",i,t,!1),isHidden:this.#n(n,"isHidden",i,t,!1),showFields:this.#n(n,"showFields",i,t,!1),visibilityDependencyIds:this.#n(n,"visibilityDependencyIds",i,t,[]),visibilityGroupId:this.#n(n,"visibilityGroupId",i,t,void 0),inheritanceGroupId:this.#n(n,"inheritanceGroupId",i,t,void 0)},a===!1&&this.#h(i),i}#n(e,t,i,a,n){const o=i?.[t];return o!==void 0?o:e?.inheritedProperties.includes(t)&&a?a[t]??n:n}#h(e){if(this.#t.has(e.id))throw new Error(`Item with id ${e.id} already exists.`);this.#e.push(e),this.#t.set(e.id,e)}#v(e,t){return`${e}-${t}`}#g(e){return e.type==="group"}#y(e){return e.type==="feature"}}const Mr=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];var Tr=N("<!> <!> <!> <!>",1),Dr=N('<div class="flex w-120 min-w-0 flex-col gap-6"><!></div>'),Fr=N('<!> <!> <!> <!> <div class="map-section svelte-1v5dyfr"><!></div>',1);function $r(f,e){K(e,!0);const t=c=>{var S=Dr(),M=_(S);Di(M,{get value(){return r(o)},get triggers(){return Mr},onValueChange:g,children:(H,j)=>{var F=Tr(),U=A(F);Te(U,{value:"define-areas",children:(x,D)=>{var z=G(),P=A(z);{var W=B=>{Vi(B,{get webMap(){return i.data},get treeviewStore(){return n},get treeviewConfigStore(){return r(v)}})};O(P,B=>{i.isLoaded&&B(W)})}l(x,z)}});var R=k(U,2);Te(R,{value:"select-data",children:(x,D)=>{var z=G(),P=A(z);{var W=B=>{Nr(B,{get webMap(){return i.data},get treeviewConfigStore(){return r(d)},get fieldFilterMenuStore(){return a}})};O(P,B=>{i.isLoaded&&B(W)})}l(x,z)}});var q=k(R,2);Te(q,{value:"export",footer:D=>{ir(D,{onExportSuccess:b})},children:(D,z)=>{$i(D,{get webMapStore(){return i},get areaSelectionTreeviewStore(){return n},get fieldFilterMenuStore(){return a}})}});var I=k(q,2);Te(I,{value:"downloads",children:(x,D)=>{br(x,{})}}),l(H,F)},$$slots:{default:!0}}),w(S),l(c,S)},i=Q(new zi),a=Q(new Wi),n=Q(new wt);let o=V("define-areas"),y=V(Q(new Set)),d=V(void 0),v=V(void 0);Dt(async()=>{const c=await fi();p(y,new Set(c.serviceUprnConfig.fieldsToHide||[]),!0),E.setNameFields(c.serviceUprnConfig.selectionLayersNameFields||[]),p(d,new dt(c.serviceUprnConfig.dataSelectionTreeviewConfig),!0),p(v,new dt(c.serviceUprnConfig.areaSelectionTreeviewConfig),!0),await i.initializeAsync({portalUrl:c.serviceUprnConfig.portalUrl,itemId:c.serviceUprnConfig.portalItemId||"",proxy:c.serviceUprnConfig.proxy}),console.log("[page] WebMap loaded")});function g(c){p(o,c,!0)}function b(){p(o,"downloads")}var s=Fr(),m=A(s);ti(m,{});var u=k(m,2);nr(u,{});var h=k(u,2);yr(h,{get fieldFilterMenuStore(){return a},get fieldsToHide(){return r(y)}});var T=k(h,2);Ni(T,{});var L=k(T,2),C=_(L);_i(C,{get webMap(){return i.data},get areaSelectionTreeviewStore(){return n},panelPosition:"top-left",menuPosition:"top-right",get panel(){return t}}),w(L),l(f,s),$()}export{$r as component};
