const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/QoFPZSeS.js","../chunks/Bc_TmxSc.js","../chunks/DOBtub6T.js","../assets/index.CQED0rIl.css","../chunks/4u0wcz6f.js","../chunks/C6pzAkdR.js","../chunks/CHwVPrQX.js","../chunks/DXGw_0Ww.js","../chunks/DHAweUE4.js","../chunks/HTOW8iPe.js","../chunks/CYB2EK_d.js","../chunks/CdDXOJ3Y.js","../chunks/CEIZYuf2.js","../chunks/DYslx7It.js","../chunks/DuIgqnlY.js","../chunks/D-Nm-cDg.js","../chunks/DaQyK3nQ.js","../chunks/Dex61Jy7.js","../chunks/DkJ9ydHD.js","../chunks/BUpj17sD.js","../chunks/DwWpeHsS.js","../chunks/BfMV86KQ.js","../chunks/PPVm8Dsz.js","../chunks/mvO4rAvm.js","../assets/component-utils.R4SXog4D.css","../chunks/DP-0fjQN.js","../chunks/8JOOWlUE.js","../chunks/DmtPipHG.js","../chunks/v5xyD8FI.js","../chunks/B87vTgcy.js","../chunks/bnayRBMH.js","../chunks/CbKIfN8e.js","../chunks/Y_0EfhRu.js","../chunks/D2feDspf.js","../chunks/DdbdneQ1.js","../chunks/BV8-ngCo.js","../chunks/Db91rTNV.js","../chunks/JSgpbLKx.js","../chunks/BxzdRo61.js","../chunks/D7TN9t_q.js","../chunks/BdDvN8O6.js","../chunks/DYAvFwNf.js","../chunks/BVzLLi1N.js","../chunks/BT4JRnHr.js","../chunks/BawRJkAp.js","../chunks/in6aGWsR.js","../chunks/CgRsZskV.js","../chunks/h5rW6lAS.js","../chunks/BiKLiV0b.js","../chunks/BFkxbxSE.js","../chunks/CNI1bPWi.js","../chunks/Cp_8tW2x.js","../chunks/BW9c9SrU.js","../chunks/CPLN7muT.js","../chunks/C0wm8_Yw.js","../chunks/C0Q15jgo.js","../chunks/idjzkL-p.js","../chunks/Dm66KbFf.js","../chunks/CH2_fMSn.js","../chunks/B5GhfNyB.js","../chunks/Cgb6qxNH.js","../chunks/D30EvcMW.js","../chunks/E6bx-lsJ.js","../chunks/jrtQMiTD.js","../chunks/8hNj00IL.js","../chunks/BauKPgXA.js","../chunks/CaVKkSa6.js","../chunks/CT-uuzXp.js","../chunks/fFYBqOqn.js","../chunks/B1N-tmtC.js","../chunks/DEfNR1C0.js","../chunks/CtljFrUl.js","../chunks/D-qJO60r.js","../chunks/QQC62dOK.js","../chunks/Bxxl7NsE.js","../chunks/DNogqiqR.js","../chunks/DQOO6RKE.js","../chunks/j00zX3Hz.js","../chunks/Bi6C4OG6.js","../chunks/C7e3Z5XT.js","../chunks/D-YQ4CHs.js","../chunks/COf4WTrX.js","../chunks/O7sg2ysZ.js","../chunks/rIJyvhvt.js","../chunks/Dc261vxq.js","../chunks/CC5XFA8H.js","../chunks/D-fXJnCB.js","../chunks/B4oxan5h.js","../chunks/CEhj4l8G.js","../chunks/D_bKRBrk.js","../chunks/BvwLokzg.js","../chunks/6vsZKnZ9.js","../chunks/7VNfS1TG.js","../chunks/DP5d1tPL.js","../chunks/D-LmNXBe.js","../chunks/B0qK9XMn.js","../chunks/Dci9kdnZ.js","../chunks/CF39WpqH.js","../chunks/BAzr6Eo0.js","../chunks/FTzM2Tyd.js","../chunks/C61-NiK_.js","../chunks/BWeyrF54.js","../chunks/Cx8JFOfk.js","../chunks/BmgeYasw.js","../chunks/DLOQEY_Z.js","../chunks/91llm6te.js","../chunks/D31seSHD.js","../chunks/DH0im0Cr.js","../chunks/NIvIaQ85.js","../chunks/qyF9FwQ9.js","../chunks/XI-Li77m.js","../chunks/Bdg0_NLM.js","../chunks/ShBCB_ow.js","../chunks/Df_x8s9w.js","../chunks/O7OdySC2.js","../chunks/UusjRatb.js","../chunks/BTOnRfOV.js","../chunks/CaYZrGFV.js","../chunks/DiSf52yC.js","../chunks/ChwpPGxO.js","../chunks/DlHjpvET.js","../chunks/h2nqTh5L.js","../chunks/DbKbkLbd.js","../chunks/Blp-4Wmz.js","../chunks/BQBvadb7.js","../chunks/DYyHyQO-.js","../chunks/Epqbrrx8.js","../chunks/OuOF1Ws1.js","../chunks/CHtALhqk.js"])))=>i.map(i=>d[i]);
import{_ as re}from"../chunks/PPVm8Dsz.js";import"../chunks/DsnmJJEf.js";import{o as we}from"../chunks/E-CWj5JT.js";import{p as ve,a7 as _,a8 as C,t as a,a6 as H,a5 as ue,V as Ce,a as _e,u as Ve,c as le,r as se,R as J}from"../chunks/kZbt_Riz.js";import{e as Be}from"../chunks/Nt3SXi6g.js";import{f as Z,t as Ie,a as S,d as Ae}from"../chunks/CcHDQE4Y.js";import{i as de}from"../chunks/P_mD4-LL.js";import{c as me}from"../chunks/BtB4Oo-j.js";import{b as pe,d as O}from"../chunks/B9EOCc4T.js";import{b as ye}from"../chunks/gAr-zTYj.js";import{B as Ee}from"../chunks/D8wi5ct4.js";import{S as Pe}from"../chunks/DjLbsW3p.js";import{A as Te,a as We,L as Se,M as De,S as Le}from"../chunks/CAqmsxQZ.js";import"../chunks/69_IOA4Y.js";import{a as Fe,g as Me,b as ze,m as Ne,c as xe,F as ge,W as U,N as ke,d as he,e as Re,E as fe,M as Oe,L as Ue,f as Ze,B as $e}from"../chunks/Cxng2lyF.js";import"../chunks/DcogKsHq.js";import{_ as je}from"../chunks/CbKIfN8e.js";import{z as be}from"../chunks/O7sg2ysZ.js";import"../chunks/DwWpeHsS.js";import"../chunks/D4VJcUD0.js";import"../chunks/CjH7Rf0r.js";import"../chunks/C9bC63rm.js";import"../chunks/BfMV86KQ.js";import"../chunks/D2feDspf.js";import"../chunks/BVLmr62Y.js";import"../chunks/BYRe6UlO.js";import"../chunks/Do8Mu2oV.js";import Ge from"../chunks/BSlv9HcN.js";import"../chunks/C92cRl-g.js";var qe=Z(`<p>This is the Analysis Tab component. This is where the user and initiate analysis for a polygon or
	area (e.g. Ward).</p> <!>`,1);function Ye(Q,d){ve(d,!0);let h=C(null),m=C(null),p=C(null),v=C(null),P=C(null);const D="UK Wards (Boundary Fully Clipped) (2022)";we(async()=>{_(v,Fe(d.mapView,"Analysis Results Layer"),!0),await X(),ee()});async function X(){if(!d.mapView)throw new Error("[analysis-tab] MapView is not initialized");_(h,new Te,!0),_(m,new We(a(h),new Se(d.mapView)),!0),_(p,new De(d.mapView,a(m),new Set([D])),!0),console.log("[analysis-tab] Initialized stores",a(h).layerId),await a(m).refreshLayerView(),await a(m).refreshAreas()}function ee(){if(!a(h)){console.warn("[analysis-tab] AreaSelectionStore not initialized yet");return}const n=d.mapView.map?.allLayers.find(t=>t.title===D);n?(a(h).setLayerId(n.uid),console.log(`[analysis-tab] Set default area layer to ID: ${n.uid}`)):console.warn("[analysis-tab] Default area layer not found on the map")}function $(n){const t=[];for(const e of n)e instanceof Ge?t.push(...$(e.layers.toArray())):e instanceof be&&t.push(e);return t}function L(n,t=.3){let e=0;for(let r=0;r<n.length;r++)e=n.charCodeAt(r)+((e<<5)-e);const i=e>>0&255,s=e>>8&255,f=e>>16&255;return[i,s,f,t]}function T(n,t=.3,e=[255,0,0,1],i=2){return{type:"simple-fill",color:L(n,t),outline:{color:e,width:i}}}function te(){return{title:"Clipped region",content:[{type:"custom",creator:n=>{const e=n.graphic.attributes??{},i=e.layerTitles??[],s=e.layerValues??[],f=e.layerWeights??[],r=e.bufferInfos??[],l=[];i.forEach((c,g)=>{const K=s[g]??"",u=f[g];l.push({layer:c,value:K,weight:u!=null&&u!==""?String(u):"",isBuffer:r[g]?"Yes":"No",bufferDistance:r[g]&&r[g].distance!=null?`${r[g].distance} ${r[g].unit??""}`.trim():""})});const o=l.some(c=>c.value&&c.value.trim()!==""),w=l.some(c=>c.weight&&c.weight.trim()!==""),q=l.some(c=>c.isBuffer&&c.isBuffer.trim()!==""),z=l.some(c=>c.bufferDistance&&c.bufferDistance.trim()!==""),V=document.createElement("table");V.className="esri-widget__table";const E=document.createElement("tbody"),B=document.createElement("tr"),Y=document.createElement("th");Y.textContent="Layer",B.appendChild(Y);let N,x,k,R;return Y.style.whiteSpace="nowrap",Y.style.wordBreak="normal",o&&(N=document.createElement("th"),N.textContent="Value",N.style.whiteSpace="nowrap",N.style.wordBreak="normal",B.appendChild(N)),w&&(x=document.createElement("th"),x.textContent="Weight",x.style.whiteSpace="nowrap",x.style.wordBreak="normal",B.appendChild(x)),q&&(k=document.createElement("th"),k.textContent="Is buffer",k.style.whiteSpace="nowrap",k.style.wordBreak="normal",B.appendChild(k)),z&&(R=document.createElement("th"),R.textContent="Buffer distance",R.style.whiteSpace="nowrap",R.style.wordBreak="normal",B.appendChild(R)),E.appendChild(B),l.forEach(c=>{const g=document.createElement("tr"),K=document.createElement("td");if(K.textContent=c.layer,g.appendChild(K),o){const u=document.createElement("td");u.textContent=c.value,g.appendChild(u)}if(w){const u=document.createElement("td");u.textContent=c.weight,u.style.whiteSpace="nowrap",u.style.wordBreak="normal",g.appendChild(u)}if(q){const u=document.createElement("td");u.textContent=c.isBuffer,u.style.whiteSpace="nowrap",u.style.wordBreak="normal",g.appendChild(u)}if(z){const u=document.createElement("td");u.textContent=c.bufferDistance,u.style.whiteSpace="nowrap",u.style.wordBreak="normal",g.appendChild(u)}E.appendChild(g)}),V.appendChild(E),V}}]}}function ae(){return!d.mapView||!d.mapView.map?(console.warn("[analysis-tab] MapView not initialized yet"),!1):!a(h)||!a(m)||!a(p)?(console.warn("[analysis-tab] Stores not initialized yet"),!1):a(v)?!0:(console.warn("[analysis-tab] Graphic layer not initialized yet"),!1)}function b(){const n=d.mapView.map.findLayerById("19a9760b651-layer-105");return n&&console.log("Parcels Layer:",n.title),n}async function I(n,t,e){const i=await xe({view:d.mapView,input:n,clipLayer:t,clipLayerValueField:e instanceof ge?e.fieldName:void 0,targetLayer:a(v)});if(!i||i.length===0){console.log(`No polygon clipped for layer: ${t.title}`);return}console.log(`Clipped ${i.length} polygons from layer: ${t.title}`);const s=e instanceof U||e instanceof ke?e.weight:void 0;for(const f of i){f.attributes.layerTitle=t.title,f.attributes.layerId=t.id,f.attributes.weight=s,f.attributes.layerTitles=[t.title],f.symbol=T(t.id,.3,[255,0,0,1],2);const r=f.attributes.value;f.attributes.weight=s||A(r,e);const l=e instanceof U?e.buffers:y(r,e);for(const o of l)if(o.distance>0){const w=await he({view:d.mapView,input:f,targetLayer:a(v),bufferDistance:o.distance,bufferUnit:o.unit});w&&(w.attributes={...f.attributes,polygonBuffer:!0,bufferDistance:o.distance,bufferUnit:o.unit,weight:o.weight},w.symbol=T(`${t.id}-buffer-${o.distance}-${o.unit}`,.2,[0,0,255,1],1))}}}function A(n,t){if(!(t instanceof fe))return;const e=t.fieldValues.find(i=>i.value===n);if(e)return e.weight}function y(n,t){if(!(t instanceof fe))return[];const e=t.fieldValues.find(i=>i.value===n);return e?e.buffers||[]:[]}function F(n){return n instanceof U?n.buffers?.[0]??null:n instanceof fe?n.fieldValues.find(e=>e.buffers&&e.buffers.length)?.buffers?.[0]??null:null}async function ne(n,t,e){console.log(`Processing point layer: ${t.title}`);const i=e instanceof ge?e.fieldName:void 0,s=F(e),f=s?.distance??1,r=s?.unit,l=await Re({view:d.mapView,input:n,clipLayer:t,clipLayerValueField:i,bufferDistance:f,bufferUnit:r,targetLayer:a(v)});if(!l||l.length===0){console.log(`No polygon clipped for layer: ${t.title}`);return}console.log(`Clipped ${l.length} polygons from layer: ${t.title}`);for(const o of l){o.attributes??={};const w=o.attributes.value;o.attributes.layerTitle=t.title,o.attributes.layerId=t.id,o.attributes.layerTitles=[t.title],o.attributes.layerValues=w!=null?[String(w)]:o.attributes.layerValues??[],o.attributes.weight=e instanceof U?e.weight:A(w,e),o.symbol=T(t.id,.3,[255,0,0,1],2);const q=e instanceof U?e.buffers:y(w,e);for(const z of q){const{distance:V,unit:E}=z;if(!V||V<=0||s&&s.distance===V&&s.unit===E)continue;const B=await he({view:d.mapView,input:o,targetLayer:a(v),bufferDistance:V,bufferUnit:E});B&&(B.attributes={...o.attributes,polygonBuffer:!0,bufferDistance:V,bufferUnit:E,weight:z.weight},B.symbol=T(`${t.id}-buffer-${V}-${E??"sr"}`,.2,[0,0,255,1],1))}console.log("Clipped Polygon:",l)}}function oe(n){for(const t of n){const e=typeof t.attributes.totalWeight=="number"?t.attributes.totalWeight:0,i=Math.max(-1,Math.min(1,e));let s;if(i<=0){const f=i+1;s=[Math.round(255*f),0,0,.5]}else{const f=i;s=[Math.round(255*(1-f)),Math.round(255*f),0,.5]}t.symbol={type:"simple-fill",color:s,outline:{color:[0,0,0,1],width:1}},t.popupTemplate=te()}}async function ie(){if(!ae())return;const n=M();if(n.length===0){console.warn("[analysis-tab] No area selected for analysis");return}if(a(P)===`analyzed-${n.join("-")}`){console.log("[analysis-tab] Analysis already performed for the selected area(s)");return}const t=b();if(!t){console.warn("[analysis-tab] Parcels layer not found");return}const e=await Me(t,n,"OBJECTID",d.mapView);if(!e){console.warn("[analysis-tab] Unable to retrieve polygon for selected parcel IDs");return}const i=await ze();console.log("AI Where to Build Config:",i);const s=$(d.mapView.map.layers.toArray());for(const r of i.analysisSettings){const l=s.find(o=>o instanceof be&&o.portalItem?.id===r.id);if(!l){console.log(`Layer for setting ID ${r.id} not found on the map`);continue}if(l.id===t.id){console.log(`Skipping parcels layer itself: ${l.title}`);continue}l.geometryType==="polygon"?await I(e,l,r):(l.geometryType==="point"||l.geometryType==="multipoint")&&await ne(e,l,r)}console.log("Merging clipped polygons in layer:",a(v).id),ce(e,a(v));const f=Ne(a(v));j(f),oe(f),a(h)?.clearSelectedAreas(),await a(m)?.refreshAreas(),a(m)?.clearSelections(),_(P,`analyzed-${n.join("-")}`)}function ce(n,t){const e=new je({geometry:n.clone(),attributes:{layerTitle:"Base Weight",layerId:"base-weight-layer",layerTitles:["Base Weight"],layerValues:["base"],value:"base",weight:0,clipped:!1,baseWeight:!0},symbol:{type:"simple-fill",color:[128,128,128,.1],outline:{color:[128,128,128,.5],width:1}}});t.add(e)}function j(n){for(const t of n){const e=t.attributes.memberLayerTitles??[],i=t.attributes.memberLayerWeights??[],s=new Map;for(let r=0;r<e.length;r++){const l=e[r],o=i[r];if(o==null||isNaN(o))continue;const w=s.get(l)??Number.POSITIVE_INFINITY;o<w&&s.set(l,o)}const f=Array.from(s.values()).reduce((r,l)=>r+l,0);if(s.values().find(r=>r<=-1)){t.attributes.totalWeight=-1;continue}t.attributes.totalWeight=f}}function M(){return!a(m)||!a(h)?[]:Array.from(a(h).selectedAreaIds)}var W=qe(),G=H(ue(W),2);Ee(G,{onclick:ie,children:(n,t)=>{Ce();var e=Ie("Analyze");S(n,e)},$$slots:{default:!0}}),S(Q,W),_e()}var Ke=Z("<div><!></div>"),Je=Z('<arcgis-layer-list></arcgis-layer-list> <div class="basemap-container svelte-1q0t0hd"><arcgis-basemap-gallery></arcgis-basemap-gallery></div> <!>',3),He=Z("<arcgis-map></arcgis-map>",2),Qe=Z('<div class="layout svelte-1q0t0hd"><!> <!></div>');function Pt(Q,d){ve(d,!0);let h=C(null),m=C(null),p=C(null),v=C(!1),P=C(null),D=C(!1);const X=[{id:"layers",label:"Layers",icon:Ue},{id:"basemap",label:"Basemap Gallery",icon:Ze},{id:"analysis",label:"Analysis",icon:$e}];we(async()=>{await re(()=>import("../chunks/QoFPZSeS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117]),import.meta.url),await re(()=>import("../chunks/DiSf52yC.js"),__vite__mapDeps([118,119,2,3,120,12,11,121,7,5,4,1,6,8,9,10,18,19,20,21,22,23,24,122,123,17,48,49,36,50,51,52,39,33,30,124,57,43,125,85,32,34,40,41]),import.meta.url),await re(()=>import("../chunks/Epqbrrx8.js").then(b=>b.a),__vite__mapDeps([126,18,2,3,19,20,21,22,23,11,24,59,42,36,43,33,30,44,35,32,31,28,34,127,128,124,80,123]),import.meta.url)}),Ve(()=>{!a(m)||!a(p)||(a(m).view=a(p),a(m).listItemCreatedFunction=b=>{const{item:I}=b;I.layer.type!="group"&&(I.panel={content:"legend",open:!0})})});async function ee(){_(p,a(h)?.view??null,!0),a(m)&&a(p)&&(a(m).view=a(p)),!a(D)&&(_(D,!0),!(!a(p)||!a(p).map)&&await a(p).when())}function $(b,I){_(v,I,!0),_(P,I?b:null,!0)}var L=Qe(),T=le(L);{var te=b=>{Oe(b,{get options(){return X},onToggleItem:$})};de(T,b=>{a(p)&&b(te)})}var ae=H(T,2);{const b=A=>{var y=Ae(),F=ue(y);me(F,()=>Le,(ne,oe)=>{oe(ne,{children:(ie,ce)=>{var j=Je(),M=ue(j);J(()=>O(M,"hidden",a(P)!=="layers")),ye(M,e=>_(m,e),()=>a(m));var W=H(M,2),G=le(W);pe(G,1,"basemap-gallery svelte-1q0t0hd"),J(()=>O(G,"view",a(p))),se(W);var n=H(W,2);{var t=e=>{var i=Ke(),s=le(i);Ye(s,{get mapView(){return a(p)}}),se(i),J(()=>i.hidden=a(P)!=="analysis"),S(e,i)};de(n,e=>{a(p)&&e(t)})}J(()=>W.hidden=a(P)!=="basemap"),S(ie,j)},$$slots:{default:!0}})}),S(A,y)},I=A=>{var y=He();pe(y,1,"relative h-full w-full"),O(y,"item-id","331ba640fe6c4fa5b4c3d025160c2ec5"),O(y,"center","-2.231774828836059,53.46531847221502"),O(y,"zoom","15"),ye(y,F=>_(h,F),()=>a(h)),Be("arcgisViewReadyChange",y,ee),S(A,y)};me(ae,()=>Pe,(A,y)=>{y(A,{get isOpen(){return a(v)},hideToggleButton:!0,sidebarContent:b,mainContent:I,$$slots:{sidebarContent:!0,mainContent:!0}})})}se(L),S(Q,L),_e()}export{Pt as component};
