const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/C3JU2Cqc.js","../chunks/Bc_TmxSc.js","../chunks/DOBtub6T.js","../assets/index.CQED0rIl.css","../chunks/4u0wcz6f.js","../chunks/C6pzAkdR.js","../chunks/CHwVPrQX.js","../chunks/DXGw_0Ww.js","../chunks/DHAweUE4.js","../chunks/HTOW8iPe.js","../chunks/CYB2EK_d.js","../chunks/CdDXOJ3Y.js","../chunks/CEIZYuf2.js","../chunks/DYslx7It.js","../chunks/DuIgqnlY.js","../chunks/D-Nm-cDg.js","../chunks/DaQyK3nQ.js","../chunks/Dex61Jy7.js","../chunks/1-A6SStS.js","../chunks/CAYuU9oo.js","../chunks/DwWpeHsS.js","../chunks/CeRhhlE3.js","../chunks/PPVm8Dsz.js","../chunks/CFn2K6-l.js","../assets/component-utils.R4SXog4D.css","../chunks/ZvSBfRuU.js","../chunks/C7VrMIJq.js","../chunks/BV6LrWRH.js","../chunks/v5xyD8FI.js","../chunks/B87vTgcy.js","../chunks/bnayRBMH.js","../chunks/6W6J17CP.js","../chunks/Y_0EfhRu.js","../chunks/DFoMxmW4.js","../chunks/DdbdneQ1.js","../chunks/CUKvHaKn.js","../chunks/GnozomzB.js","../chunks/C0r3nPFU.js","../chunks/D5wfNCSS.js","../chunks/CBhtnfFj.js","../chunks/Ck0Sc68b.js","../chunks/C1b-UyR1.js","../chunks/B9nrdN3I.js","../chunks/B2_jlIup.js","../chunks/D5wPz3MX.js","../chunks/CMGougg5.js","../chunks/CiTezgDL.js","../chunks/BF96_MCH.js","../chunks/C4qJhnT8.js","../chunks/DZE8-7HP.js","../chunks/2dXtPFpf.js","../chunks/Cp_8tW2x.js","../chunks/C_U3EkfM.js","../chunks/B2QrCEfK.js","../chunks/C0wm8_Yw.js","../chunks/D84DRQGh.js","../chunks/CamG5LcL.js","../chunks/BeG5PTJh.js","../chunks/D1_xF1l_.js","../chunks/Cd9GdU_L.js","../chunks/Cgb6qxNH.js","../chunks/B-m5Sl5o.js","../chunks/DCOPP4zh.js","../chunks/BrbL6HZH.js","../chunks/C3R-oROr.js","../chunks/HYjb2XVQ.js","../chunks/CaVKkSa6.js","../chunks/CI7YD90n.js","../chunks/YTLdojGG.js","../chunks/B1N-tmtC.js","../chunks/M9csEe_9.js","../chunks/CtljFrUl.js","../chunks/D-qJO60r.js","../chunks/QQC62dOK.js","../chunks/Bxxl7NsE.js","../chunks/DNogqiqR.js","../chunks/DQOO6RKE.js","../chunks/C80X2pXx.js","../chunks/Bi6C4OG6.js","../chunks/C7e3Z5XT.js","../chunks/D-YQ4CHs.js","../chunks/BZsETsOI.js","../chunks/BBV24j_2.js","../chunks/BAIa4HHN.js","../chunks/DYIbcMrs.js","../chunks/BfLeziQE.js","../chunks/BeiFfq_I.js","../chunks/B4oxan5h.js","../chunks/_Wu26JHk.js","../chunks/CIbyfs1t.js","../chunks/DfYjIaZP.js","../chunks/gul0yLcR.js","../chunks/Bt7d_ltN.js","../chunks/C_hZxtZf.js","../chunks/Iaw-yPgv.js","../chunks/C4m88JEB.js","../chunks/B_YI4KXt.js","../chunks/CF39WpqH.js","../chunks/BAzr6Eo0.js","../chunks/BOi-zD_D.js","../chunks/B36ip4uz.js","../chunks/C7XcR_qA.js","../chunks/DlemiWd4.js","../chunks/BmgeYasw.js","../chunks/DLOQEY_Z.js","../chunks/DRAy6pQp.js","../chunks/TaFUw3Kk.js","../chunks/BQME-Dbz.js","../chunks/CGdpgIRD.js","../chunks/qyF9FwQ9.js","../chunks/XI-Li77m.js","../chunks/C7Pxb65r.js","../chunks/BVgVoZ7V.js","../chunks/CHhbm2AT.js","../chunks/U5R98psz.js","../chunks/UusjRatb.js","../chunks/BTOnRfOV.js","../chunks/CaYZrGFV.js","../chunks/DQbFm6XI.js","../chunks/ChwpPGxO.js","../chunks/DlHjpvET.js","../chunks/h2nqTh5L.js","../chunks/CO5JJ6fr.js","../chunks/BtzHoEh5.js","../chunks/BQBvadb7.js","../chunks/DopMZQPn.js","../chunks/BI8Qvcwk.js","../chunks/Dsw-3r6y.js","../chunks/DnvC2qI8.js"])))=>i.map(i=>d[i]);
import{_ as U}from"../chunks/PPVm8Dsz.js";import"../chunks/DsnmJJEf.js";import{o as ae}from"../chunks/BW702uPa.js";import{p as re,a9 as f,a7 as g,t as e,a6 as E,c as T,V as J,r as z,a as ne,u as le,a5 as Q,R as M}from"../chunks/BjFLI01z.js";import{e as se}from"../chunks/B8uMhNXG.js";import{f as x,t as Y,a as w,d as ce}from"../chunks/DAMOoDui.js";import{i as $}from"../chunks/Ck_Twk2V.js";import{c as H}from"../chunks/BM3AUTZE.js";import{b as X,d as P}from"../chunks/BAHAaU2i.js";import{b as Z}from"../chunks/hODufui9.js";import{B as ee}from"../chunks/C1ksMhv9.js";import{S as de}from"../chunks/Bf7h3GQg.js";import{A as ue,a as pe,L as me,M as ye,S as fe}from"../chunks/BO_Ifhts.js";import"../chunks/69_IOA4Y.js";import{a as ge,g as ve,m as be,c as we,M as he,L as _e,b as Le,B as Se}from"../chunks/BfLQty9N.js";import"../chunks/BsgmZ9YD.js";import"../chunks/6W6J17CP.js";import{z as te}from"../chunks/BBV24j_2.js";import"../chunks/DwWpeHsS.js";import"../chunks/D4VJcUD0.js";import"../chunks/CjH7Rf0r.js";import"../chunks/C9bC63rm.js";import"../chunks/CeRhhlE3.js";import"../chunks/DFoMxmW4.js";import"../chunks/IyXX-m-G.js";import"../chunks/CCxKV4CJ.js";import"../chunks/DmDvrl5M.js";import Ve from"../chunks/CmSii9G0.js";import"../chunks/y635C_uJ.js";async function Ae(L,l,s){let n=[];const i=L.createQuery();return i.geometry=l.geometry,i.spatialRelationship="intersects",i.returnGeometry=!1,i.outFields=[s],i.num=10,n=(await L.queryFeatures(i)).features.map(p=>p.attributes?.[s]).filter(p=>p!=null).map(p=>String(p)),n.length===0?null:(n=Array.from(new Set(n)),n)}var Ce=x(`<div class="analysis-container svelte-wttb71"><div class="header-section svelte-wttb71"><p class="description svelte-wttb71">This is the Analysis tab. This is where the user can initiate analysis for a polygon or area
			(e.g. Ward).</p></div> <div class="button-group svelte-wttb71"><!> <!></div></div>`);function Ie(L,l){re(l,!0);let s=g(null),n=g(null),i=g(null),v=g(null),p=g(null);const S="UK Wards (Boundary Fully Clipped) (2022)";ae(async()=>{f(v,ge(l.mapView,"Analysis Results Layer"),!0),await O(),j()});async function O(){if(!l.mapView)throw new Error("[analysis-tab] MapView is not initialized");f(s,new ue,!0),f(n,new pe(e(s),new me(l.mapView)),!0),f(i,new ye(l.mapView,e(n),new Set([S])),!0),console.log("[analysis-tab] Initialized stores",e(s).layerId),await e(n).refreshLayerView(),await e(n).refreshAreas()}function j(){if(!e(s)){console.warn("[analysis-tab] AreaSelectionStore not initialized yet");return}const t=l.mapView.map?.allLayers.find(r=>r.title===S);t?(e(s).setLayerId(t.uid),console.log(`[analysis-tab] Set default area layer to ID: ${t.uid}`)):console.warn("[analysis-tab] Default area layer not found on the map")}function R(t){const r=[];for(const a of t)a instanceof Ve?r.push(...R(a.layers.toArray())):a instanceof te&&r.push(a);return r}function V(t,r=.3){let a=0;for(let y=0;y<t.length;y++)a=t.charCodeAt(y)+((a<<5)-a);const d=a>>0&255,o=a>>8&255,u=a>>16&255;return[d,o,u,r]}function A(t,r=.3,a=[255,0,0,1],d=2){return{type:"simple-fill",color:V(t,r),outline:{color:a,width:d}}}function q(){return{title:"Clipped region",content:[{type:"custom",creator:t=>{const r=t.graphic,a=r.attributes.layerTitles??[],d=r.attributes.layerValues??[],o=document.createElement("table");o.className="esri-widget__table";const u=document.createElement("tbody"),y=document.createElement("tr"),_=document.createElement("th"),D=document.createElement("th");return _.textContent="Layer",D.textContent="Value",y.appendChild(_),y.appendChild(D),u.appendChild(y),a.forEach((ie,oe)=>{const G=document.createElement("tr"),K=document.createElement("td");K.textContent=ie;const N=document.createElement("td");N.textContent=d[oe]??"",G.appendChild(K),G.appendChild(N),u.appendChild(G)}),o.appendChild(u),o}}]}}function k(){return!l.mapView||!l.mapView.map?(console.warn("[analysis-tab] MapView not initialized yet"),!1):!e(s)||!e(n)||!e(i)?(console.warn("[analysis-tab] Stores not initialized yet"),!1):e(v)?!0:(console.warn("[analysis-tab] Graphic layer not initialized yet"),!1)}function m(){const t=l.mapView.map.findLayerById("19a9760b651-layer-105");return t&&console.log("Parcels Layer:",t.title),t}async function b(t,r,a){const d=await we({view:l.mapView,input:r,clipLayer:t,targetLayer:e(v)});if(!d){console.log(`No polygon clipped for layer: ${t.title}`);return}for(const o of d)o.attributes??={},o.attributes.layerTitle=t.title,o.attributes.layerId=t.id,t.displayField&&(o.attributes.value=await Ae(t,o,t.displayField)),o.attributes.layerTitles=[t.title],o.symbol=A(t.id,.3,[255,0,0,1],2),console.log("Clipped Polygon:",d)}function h(t){for(const r of t){const a=r.attributes.layerTitles.join("; ");r.symbol=A(a,.3,[0,0,0,1],1),r.popupTemplate=q()}}async function c(){if(!k())return;const t=C();if(t.length===0){console.warn("[analysis-tab] No area selected for analysis");return}if(e(p)===`analyzed-${t.join("-")}`){console.log("[analysis-tab] Analysis already performed for the selected area(s)");return}const r=m();if(!r){console.warn("[analysis-tab] Parcels layer not found");return}const a=await ve(r,t,"OBJECTID",l.mapView);if(!a){console.warn("[analysis-tab] Unable to retrieve polygon for selected parcel IDs");return}const d=R(l.mapView.map.layers.toArray());for(const u of d){if(!(u instanceof te)){console.log(`Skipping non-feature layer: ${u.title}, type: ${u.type}`);continue}if(u.id===r.id){console.log(`Skipping parcels layer itself: ${u.title}`);continue}await b(u,a,t[0])}console.log("Merging clipped polygons in layer:",e(v).id);const o=be(e(v));h(o),e(s)?.clearSelectedAreas(),await e(n)?.refreshAreas(),e(n)?.clearSelections(),f(p,`analyzed-${t.join("-")}`)}function C(){return!e(n)||!e(s)?[]:Array.from(e(s).selectedAreaIds)}var I=Ce(),F=E(T(I),2),B=T(F);ee(B,{onclick:c,children:(t,r)=>{J();var a=Y("Analyze");w(t,a)},$$slots:{default:!0}});var W=E(B,2);ee(W,{children:(t,r)=>{J();var a=Y("Profile");w(t,a)},$$slots:{default:!0}}),z(F),z(I),w(L,I),ne()}var Pe=x("<div><!></div>"),Ee=x('<arcgis-layer-list></arcgis-layer-list> <div class="basemap-container svelte-1pveq6o"><arcgis-basemap-gallery></arcgis-basemap-gallery></div> <!>',3),Te=x("<arcgis-map></arcgis-map>",2),ze=x('<div class="layout svelte-1pveq6o"><!> <!></div>');function lt(L,l){re(l,!0);let s=g(null),n=g(null),i=g(null),v=g(!1),p=g(null),S=g(!1);const O=[{id:"layers",label:"Layers",icon:_e},{id:"basemap",label:"Basemap Gallery",icon:Le},{id:"analysis",label:"Analysis",icon:Se}];ae(async()=>{await U(()=>import("../chunks/C3JU2Cqc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117]),import.meta.url),await U(()=>import("../chunks/DQbFm6XI.js"),__vite__mapDeps([118,119,2,3,120,12,11,121,7,5,4,1,6,8,9,10,18,19,20,21,22,23,24,122,123,17,48,49,36,50,51,52,39,33,30,124,57,43,125,85,32,34,40,41]),import.meta.url),await U(()=>import("../chunks/BI8Qvcwk.js").then(m=>m.a),__vite__mapDeps([126,18,2,3,19,20,21,22,23,11,24,59,42,36,43,33,30,44,35,32,31,28,34,127,128,124,80,123]),import.meta.url)}),le(()=>{!e(n)||!e(i)||(e(n).view=e(i),e(n).listItemCreatedFunction=m=>{const{item:b}=m;b.layer.type!="group"&&(b.panel={content:"legend",open:!0})})});async function j(){f(i,e(s)?.view??null,!0),e(n)&&e(i)&&(e(n).view=e(i)),!e(S)&&(f(S,!0),!(!e(i)||!e(i).map)&&await e(i).when())}function R(m,b){f(v,b,!0),f(p,b?m:null,!0)}var V=ze(),A=T(V);{var q=m=>{he(m,{get options(){return O},onToggleItem:R})};$(A,m=>{e(i)&&m(q)})}var k=E(A,2);{const m=h=>{var c=ce(),C=Q(c);H(C,()=>fe,(I,F)=>{F(I,{children:(B,W)=>{var t=Ee(),r=Q(t);M(()=>P(r,"hidden",e(p)!=="layers")),Z(r,y=>f(n,y),()=>e(n));var a=E(r,2),d=T(a);X(d,1,"basemap-gallery svelte-1pveq6o"),M(()=>P(d,"view",e(i))),z(a);var o=E(a,2);{var u=y=>{var _=Pe(),D=T(_);Ie(D,{get mapView(){return e(i)}}),z(_),M(()=>_.hidden=e(p)!=="analysis"),w(y,_)};$(o,y=>{e(i)&&y(u)})}M(()=>a.hidden=e(p)!=="basemap"),w(B,t)},$$slots:{default:!0}})}),w(h,c)},b=h=>{var c=Te();X(c,1,"relative h-full w-full"),P(c,"item-id","331ba640fe6c4fa5b4c3d025160c2ec5"),P(c,"center","-2.231774828836059,53.46531847221502"),P(c,"zoom","15"),Z(c,C=>f(s,C),()=>e(s)),se("arcgisViewReadyChange",c,j),w(h,c)};H(k,()=>de,(h,c)=>{c(h,{get isOpen(){return e(v)},hideToggleButton:!0,sidebarContent:m,mainContent:b,$$slots:{sidebarContent:!0,mainContent:!0}})})}z(V),w(L,V),ne()}export{lt as component};
