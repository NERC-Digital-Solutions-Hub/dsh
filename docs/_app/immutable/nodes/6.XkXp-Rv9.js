const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CyrEfJff.js","../chunks/iFuBOtDF.js","../chunks/DHq0rblm.js","../chunks/BfhsIlKo.js","../chunks/faKFIXLZ.js","../chunks/D9Z9MdNV.js","../chunks/pCx8oau_.js","../chunks/BgvLO-3W.js","../chunks/CBG-jaYw.js","../chunks/C8PpcA25.js","../chunks/DhdgDebw.js","../chunks/Dt5YSiFI.js","../chunks/C1yg1qUQ.js","../chunks/LE72oyNN.js","../chunks/CYi2TAj9.js","../chunks/DgwIrkEl.js","../chunks/DmWTBsn2.js","../chunks/BwKptEmm.js","../chunks/CCzk6ARw.js","../chunks/Dvbl4r8A.js","../chunks/gRIb6kZn.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/Bvto7RYj.js","../chunks/BOB_xkBk.js","../chunks/DFQ1ZjBx.js","../chunks/Cl5lrJ4c.js","../chunks/B0LmsqEq.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/C4HJhmWz.js","../chunks/CDl12u7R.js","../chunks/DYJGs4je.js","../chunks/Djp3mnm5.js","../chunks/Bso-6bUH.js","../chunks/DQOJ18NT.js","../chunks/CLto_E8U.js","../chunks/CxFnk1MP.js","../chunks/D5ew8ajr.js","../chunks/B4aqFq2B.js","../chunks/EzLf78vY.js","../chunks/BPhm6YV-.js","../chunks/BkA6azLD.js","../chunks/hXVs3T0e.js","../chunks/Dytf6RTV.js","../chunks/9YvG7tFv.js","../chunks/B-VZ3wrL.js","../chunks/CaNAmI22.js","../chunks/aQeO9QTD.js","../chunks/BDqMdsvZ.js","../chunks/DJTyCEHv.js","../chunks/BMX0GFJS.js","../chunks/CsLyQp38.js","../chunks/ETfT8J3h.js","../chunks/BQ2D4CO5.js","../chunks/DZd6gJy7.js","../chunks/C7x2MF0l.js","../chunks/C8BmVxiO.js","../chunks/Cr2KJ5IK.js","../chunks/CJ_83qNO.js","../chunks/Ck-szKz5.js","../chunks/BxD4MBPA.js","../chunks/Banwpgrz.js","../chunks/cw1rsUFH.js","../chunks/C0pjifF4.js","../chunks/ok2Sqpw2.js","../chunks/Chk7YAAL.js","../chunks/D0t3l1UW.js","../chunks/Cgb6qxNH.js","../chunks/DsnVlOka.js","../chunks/CrwPCMe2.js","../chunks/QQC62dOK.js","../chunks/C51QhSzO.js","../chunks/BdLvjJaM.js","../chunks/BaYj2Wow.js","../chunks/DphnWQ0e.js","../chunks/DKpmsPfl.js","../chunks/B9RJBcJ2.js","../chunks/8WNRLB3q.js","../chunks/B1N-tmtC.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/Cf9zLCCH.js","../chunks/pDuGEAnG.js","../chunks/CMaiVHma.js","../chunks/BrScpkSj.js","../chunks/rxpTDz6e.js","../chunks/Dl1orkLD.js","../chunks/D_pI6fQj.js","../chunks/zFNEK25s.js","../chunks/CL2NbQte.js","../chunks/D_JYBHfY.js","../chunks/Cvs00xeJ.js","../chunks/Duu7_u0O.js","../chunks/Dmk_Dxvx.js","../chunks/C5CzMsLd.js","../chunks/pyb07plo.js","../chunks/BRLX27Af.js","../chunks/C8NkvdGB.js","../chunks/Cxihbb8M.js","../chunks/BYV4nsB9.js","../chunks/DQ_sR0Oz.js","../chunks/DbyYraQc.js","../chunks/Dj4-5pgM.js","../chunks/BY6Wrw2B.js","../chunks/D-j7oGrU.js","../chunks/ChTYeCcj.js","../chunks/QOzMNXdI.js","../chunks/DoDP5r3i.js","../chunks/GKolV7NZ.js","../chunks/Bs6tEc1N.js","../chunks/DadzvVj2.js","../chunks/BUd8m5s5.js","../chunks/vIRtxQoE.js","../chunks/BeKBFCJY.js","../chunks/4c7MyKAz.js","../chunks/BpFwjkk6.js","../chunks/Glnbxn3o.js","../chunks/DZ__J_Ha.js","../chunks/VMSlSy0z.js","../chunks/DkkI5QKs.js","../chunks/C3cxdwvi.js","../chunks/CTc4Bt11.js","../chunks/pdT4reVn.js","../chunks/D0yCzUdH.js","../chunks/BiM6pph8.js","../chunks/DA_X7pFa.js","../chunks/B_DLPStx.js","../chunks/CZnF4aA7.js","../chunks/CGwv2ov9.js","../chunks/DRnuuSv_.js","../chunks/CGe7GMdJ.js","../chunks/B3MXpedj.js","../chunks/B6WMH48X.js","../chunks/B1pCqEo_.js","../chunks/BrYzRPrF.js","../chunks/Bg3hnFg2.js","../chunks/DYzr77oO.js","../chunks/CMq8eZcm.js","../chunks/N_B-5EBV.js","../chunks/u5nA3ppO.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/4ef240Er.js","../chunks/CXd_PekB.js","../chunks/CNJBC4J4.js","../chunks/Dz-aVBgt.js","../chunks/Bs354Zoz.js","../chunks/CfrNlpsM.js","../chunks/DdSLmJ2d.js","../chunks/BS3H3l-F.js","../chunks/DCdj6Lab.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/CY_HuWbD.js","../chunks/D1FCtSgh.js","../chunks/kAKGzqpF.js","../chunks/C5PvpwSg.js","../chunks/BsB-6bk9.js","../chunks/CaNUsX_h.js","../chunks/CaqllLde.js","../chunks/D7knBxw1.js","../chunks/COKPF4Dy.js","../chunks/BT3t3G5h.js","../chunks/BjiS_nfk.js","../chunks/DvcDHnyV.js","../chunks/DbEhBJ1e.js","../chunks/D9LchIWm.js","../chunks/BK2emRUs.js","../chunks/DnIiJOoS.js","../chunks/DsHDw-MJ.js"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{o as Ze,a as zt}from"../chunks/CwlFPufh.js";import{c as U,b as T,a as d,Z as Y,u as K,H as t,aG as H,f as L,a0 as J,ah as N,ao as A,a4 as S,a6 as b,a5 as le,a1 as j,aH as ee,at as ae,n as ce,aI as _e}from"../chunks/J6Bl3sxN.js";import{_ as Be}from"../chunks/D9Z9MdNV.js";import{l as Dt,s as Vt,p as Z,i as M,a as Mt,b as Pt}from"../chunks/_fywD1i8.js";import{s as oe}from"../chunks/CdsLSXyK.js";import{b as De}from"../chunks/RQ99CAyZ.js";import{m as Ge,a as X,O as lt,T as Ht,G as et,F as tt,b as Ot,S as ge,c as dt,t as he,d as Et,e as Ut,f as Rt,g as Wt,h as Bt,i as Gt,j as ne,k as be,p as qt,C as nt,l as Xt,I as jt,n as Zt,o as Qt,q as Yt,r as Jt,L as Kt,s as $t,D as en,V as at,W as tn,u as nn,v as an,w as rt}from"../chunks/DDtRs2TW.js";import{B as ue,o as qe,F as Ie}from"../chunks/D-afBJkb.js";import{c as q}from"../chunks/D5NabK7e.js";import{e as me,d as Se,s as ye,b as rn}from"../chunks/BYOkOkBz.js";import{s as ie}from"../chunks/D8EIH3Is.js";import{h as pe}from"../chunks/piBjdR0k.js";import{d as Ce}from"../chunks/0Hj017KB.js";import{I as on,s as sn,C as ln,b as Qe,S as dn,c as cn,d as un,a as ct,X as vn,e as fn,f as gn,g as hn,h as mn,i as yn,j as _n,k as wn}from"../chunks/CyvILS5C.js";import{B as de}from"../chunks/hcL2bxKX.js";import{X as bn}from"../chunks/AVT9UQWA.js";import"../chunks/BEqW7Zwo.js";function pn(f,e){const a=Dt(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];on(f,Vt({name:"menu"},()=>a,{get iconNode(){return n},children:(r,o)=>{var i=U(),h=T(i);sn(h,e,"default",{}),d(r,i)},$$slots:{default:!0}}))}var Ne=(f=>(f.None="none",f.GroupLayer="group-layer",f.FeatureLayer="feature-layer",f.TileLayer="tile-layer",f.Field="field",f))(Ne||{});function Sn(f){switch(f.type){case"group":return"group-layer";case"feature":return"feature-layer";case"tile":return"tile-layer";default:throw new Error(`Unsupported layer type: ${f.type}`)}}class Cn{id;name;children;parent;constructor(e,a,n=[],r=null){this.id=e,this.name=a,this.children=n,this.parent=r}}class re extends Cn{layer;constructor(e,a,n,r=[],o=null){super(e,a,r,o),this.layer=n}}class it extends re{featureLayer;field;constructor(e,a,n,r,o=[],i=null){super(e,a,n,o,i),this.field=r,this.featureLayer=n}}var xn=L('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),kn=L('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),Nn=L('<div class="map-view svelte-i0p9uk"></div> <!> <!>',1);function In(f,e){Y(e,!0);const a=Z(e,"webMap",3,null),n=Z(e,"panelPosition",3,"top-left"),r=Z(e,"menuPosition",3,"top-right");let o=null,i=H(null),h=H(null),w=H(null),v=H(!1);const g="streets-vector";let x,m;async function c(){if(!m){const[{default:_},{default:I},{default:V}]=await Promise.all([Be(()=>import("../chunks/CyrEfJff.js").then(D=>D.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url),Be(()=>import("../chunks/D5ew8ajr.js").then(D=>D.a3),__vite__mapDeps([38,1,2,3,5,39,24,6,7,22,40,41,42,43,8,9,10,11,44,23,20,21,45,46,47,48,12,13,49,50,51,25,52,53,17,32,54,55,56,26,57,58,15,59,0,4,14,16,18,19,27,28,29,30,31,33,34,35,36,37,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86]),import.meta.url),Be(()=>import("../chunks/Dl1orkLD.js").then(D=>D.W),__vite__mapDeps([87,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,88,89,90,91,62,92,93,74,75,65,94,95,96,61,97,98,99,100,64,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,52,53,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171]),import.meta.url)]);x=_,m=I}}async function s(_,I){const V=new m({container:I,popupEnabled:!1,map:_});return await V.when(),V}function l(_){_.ui.move("zoom","top-right"),t(h)&&n()&&_.ui.add(t(h),n()),t(w)&&r()&&_.ui.add(t(w),r()),A(v,!0)}async function F(_){const I=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(V=>V.id);console.log("[uprn-map-view] Initializing map interactions with layers:",I),await Ge.initializeAsync(_,new Set(I))}async function k(){return new x({basemap:g})}Ze(async()=>{await c(),await u()});async function y(){if(a())try{if(await c(),await u(),!t(i)){console.error("MapView is not initialized");return}t(i).map=a(),await a().when(),console.log("[uprn-map-view] MapView updated with new webMap")}catch(_){console.error("Error updating MapView with new webMap:",_)}}K(()=>{a()&&y()});async function u(){if(!o){console.error("Map container element was not found");return}try{A(i,await s(a()??void 0,o),!0),await F(t(i)),l(t(i)),console.log("[uprn-map-view] Map loaded successfully")}catch(_){console.error("Error loading map:",_),await p()}}async function p(){try{const _=await k();A(i,await s(_,o),!0),await F(t(i)),l(t(i)),console.log("[uprn-map-view] Fallback map loaded")}catch(_){console.error("Error loading fallback map:",_)}}K(()=>{if(!t(i)||!e.areaSelectionTreeviewStore.initialized)return;const _=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(I=>I.id);Ge.updateInteractableLayers(new Set(_))});async function z(_){if(!t(i))return;const I=await t(i).whenLayerView(_);if(!I){console.warn("Could not get LayerView for the visible node layer");return}X.setSelectedLayerView(I)}K(()=>{if(!e.areaSelectionTreeviewStore.initialized)return;if(!e.areaSelectionTreeviewStore.getVisibleNodes().length){X.resetSelectedAreas();return}const _=e.areaSelectionTreeviewStore.getVisibleNodes()[0];if(!_||!(_ instanceof re)||!(_.layer instanceof __esri.FeatureLayer)){console.warn("Visible node is not a FeatureLayer");return}if(!_.layer){console.warn("Visible node layer is not a FeatureLayer");return}z(_.layer)});function C(){Ge.cleanup(),t(i)&&t(i).destroy()}zt(()=>{C()});var W=Nn(),P=T(W);De(P,_=>o=_,()=>o);var O=N(P,2);{var R=_=>{var I=xn(),V=S(I);{var D=E=>{var G=U(),$=T(G);oe($,()=>e.panel),d(E,G)};M(V,E=>{t(v)&&E(D)})}b(I),De(I,E=>A(h,E),()=>t(h)),d(_,I)};M(O,_=>{e.panel&&_(R)})}var B=N(O,2);{var Q=_=>{var I=kn(),V=S(I);{var D=E=>{var G=U(),$=T(G);oe($,()=>e.menu),d(E,G)};M(V,E=>{t(v)&&E(D)})}b(I),De(I,E=>A(w,E),()=>t(w)),d(_,I)};M(B,_=>{e.menu&&_(Q)})}d(f,W),J()}var Tn=L('<div class="tree-node-item svelte-1x7dzzd"><!></div>'),Fn=L('<div class="tree-children relative ml-4 w-full svelte-1x7dzzd"><div class="tree-guide-line tree-guide-line-animate svelte-1x7dzzd"></div> <!></div>'),An=L('<div class="w-full"><!>  <!></div>');function ut(f,e){const a=Z(e,"isOpen",3,!1),n=Z(e,"childNodes",3,null);var r=An(),o=S(r);oe(o,()=>e.content??le);var i=N(o,2);{var h=w=>{var v=Fn(),g=N(S(v),2);ue(g,19,()=>n()??[],x=>x.id,(x,m,c)=>{var s=Tn(),l=S(s);oe(l,()=>e.childNode??le,()=>t(m)),b(s),j(()=>me(s,`animation-delay: ${100+t(c)*50}ms;`)),d(x,s)}),b(v),d(w,v)};M(i,w=>{a()&&n()&&w(h)})}b(r),d(f,r)}const vt="mb-1 cursor-pointer rounded-md border border-border/30 p-2 text-left",ft="transform-gpu transition-all duration-150 ease-out hover:border-border/50 hover:bg-card/70 hover:shadow-sm",Ln="transition-colors hover:bg-card/70",Xe="text-sm font-normal",je="bg-card/50",gt="bg-accent text-accent-foreground";function zn(f){const{enhancedHover:e=!1,includeFont:a=!1,pressed:n=!1}=f;let r=vt;return e?r+=" "+ft:r+=" "+Ln,a&&(r+=" "+Xe),n?r+=" "+gt:r+=" "+je,r}const Dn="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";var Vn=L('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),Mn=L('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ot(f,e){const a=`calc(100% - ${e.depth*1}rem)`,n=`${vt} ${ft}`,r=`${n} ${Dn} ${je} ${Xe}`,o=`${n} ${Xe}`;var i=U(),h=T(i);{var w=g=>{Ht(g,{get pressed(){return e.pressed},get class(){return r},variant:"outline",get style(){return`width: ${a};`},get onPressedChange(){return e.onclick},children:(x,m)=>{var c=Vn(),s=S(c),l=S(s),F=S(l);pe(F,()=>e.icon),b(l);var k=N(l,2),y=S(k,!0);b(k),b(s);var u=N(s,2);oe(u,()=>e.children??le),b(c),j(()=>ie(y,e.name)),d(x,c)},$$slots:{default:!0}})},v=g=>{var x=Mn();x.__click=function(...p){e.onclick?.apply(this,p)};var m=S(x),c=S(m),s=S(c);lt(s,{get isOpen(){return e.isOpen}});var l=N(s,2),F=S(l);pe(F,()=>e.icon),b(l);var k=N(l,2),y=S(k,!0);b(k),b(c);var u=N(c,2);oe(u,()=>e.children??le),b(m),b(x),j(()=>{Se(x,1,`${o} ${e.pressed?gt:je}`),me(x,`width: ${a};`),ie(y,e.name)}),d(g,x)};M(h,g=>{e.isTogglable?g(w):g(v,!1)})}d(f,i)}Ce(["click"]);const ht=(f,e,a,n)=>e?Pn(f,a):a?n?'<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',Pn=(f,e)=>{switch(f.type){case"group":return et;case"feature":return tt;case"tile":return Ot;default:return e?et:tt}};function mt(f,e){Y(e,!0);const a=l=>{var F=U(),k=T(F);{var y=u=>{var p=U(),z=T(p);{var C=P=>{ot(P,{isTogglable:!1,get pressed(){return t(v)},get icon(){return t(g)},get name(){return e.node.name},get depth(){return r()},onclick:s,get isOpen(){return t(w)}})},W=P=>{ot(P,{isTogglable:!0,get pressed(){return t(v)},get icon(){return t(g)},get name(){return e.node.name},get depth(){return r()},onclick:c,get isOpen(){return t(w)}})};M(z,P=>{h?P(C):P(W,!1)})}d(u,p)};M(k,u=>{e.treeviewConfigStore.getItemConfig(e.node.id)?.isHidden||u(y)})}d(l,F)},n=(l,F=le)=>{var k=U(),y=T(k);{var u=p=>{{let z=ee(()=>r()+1);mt(p,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return F()},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return t(z)},get useLayerTypeIcon(){return o()}})}};M(y,p=>{h&&t(w)&&!e.treeviewConfigStore.getItemConfig(F().id)?.isHidden&&p(u)})}d(l,k)},r=Z(e,"depth",3,0),o=Z(e,"useLayerTypeIcon",3,!1),i=!!e.node.layer&&"visible"in e.node.layer,h=!!(e.node.children&&e.node.children.length);let w=H(!1),v=H(!1),g=H("");function x(){return!e.node.children||!e.getNodeVisibility?!1:e.node.children.some(l=>{const F=e.getNodeVisibility(l.id);return F!==void 0?F:l.layer.visible})}K(()=>{if(e.node){if(h)A(v,x(),!0);else{const l=e.getNodeVisibility?e.getNodeVisibility(e.node.id):void 0;A(v,l!==void 0?l:e.node.layer.visible,!0)}A(g,ht(e.node.layer,o(),h,t(w)),!0)}});function m(){!i||!e.onNodeVisibilityChange||h||(A(v,!t(v)),e.onNodeVisibilityChange(e.node,t(v)))}function c(){h||m(),e.onNodeClick?.(e.node)}function s(){A(w,!t(w)),e.onNodeClick?.(e.node)}{let l=ee(()=>h?e.node.children:null);ut(f,{get isOpen(){return t(w)},get content(){return a},get childNodes(){return t(l)},get childNode(){return n}})}J()}class yt{#d=H(!1);get initialized(){return t(this.#d)}set initialized(e){A(this.#d,e,!0)}#e=null;#s=new ge;#i=H(ae([]));#a=ee(()=>{const e=new qe;return this.#y(t(this.#i),e),e});#t=H(ae(new qe));#c=H(ae(new qe));initialize(e,a,n){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!a)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#e=a,!e)throw new Error("TreeviewStore requires a valid array of layers to initialize.");n&&(this.#s=new ge(n),console.log("Fields to hide:",Array.from(this.#s))),A(this.#i,this.#w(e),!0)}getNodeById(e){return this.#n(),t(this.#a).get(e)}getNodes(){return this.#n(),t(this.#i)}getVisibleNodes(){this.#n();const e=[];for(const[a,n]of t(this.#t)){if(!n)continue;const r=t(this.#a).get(a);r&&e.push(r)}return e}getNonHiddenNodes(){return this.#n(),this.#u(t(this.#i))}#u(e){this.#n();const a=[];for(const n of e){const r=this.#o(n.id);if(!(r&&r.isHidden)&&(a.push(n),n.children?.length)){const o=this.#u(n.children);a.push(...o)}}return a}getVisibilityState(e){return this.#n(),t(this.#t).get(e)??!1}setVisibilityState(e,a){this.#n();const n=t(this.#a).get(e);if(!n)throw new Error(`Tree node not found for ID: ${e}`);if(!(n instanceof re))throw new Error(`Tree node is not a layer node: ${e}`);t(this.#t).set(e,a),n.layer.visible=a,n instanceof it&&(n.featureLayer.displayField=a?n.field.name:""),this.#r(n,a);const r=this.#o(e);if(!r||r.isHidden||(r.visibilityDependencyIds?.length&&this.#l(n,a),!r.visibilityGroupId))return;const o=r.visibilityGroupId;console.log(`Node ${e} is part of visibility group ${o}`);let i=t(this.#c).get(o);i||(i=[],t(this.#c).set(o,i));const h=this.#_(o);if(!h)throw new Error(`Visibility group config not found for group ID: ${o}`);if(!a){const v=i.indexOf(e);i.splice(v,1);return}const w=v=>{t(this.#t).set(v,!1);const g=t(this.#a).get(v);if(g&&g instanceof re){g.layer.visible=!1,this.#r(g,!1);const m=this.#o(v);m&&m.visibilityDependencyIds?.length&&this.#l(g,!1)}const x=i.indexOf(v);x>=0&&i.splice(x,1)};for(;i.length>=h.maxVisibleLayers;){const v=i[0];w(v)}i.push(e),this.#r(n,a),r.visibilityDependencyIds?.length&&this.#l(n,a)}#r(e,a){const n=e.parent;!n||!(n instanceof re)||(t(this.#t).set(n.id,a),n.layer.visible=a,this.#r(n,a))}#l(e,a){const n=this.#o(e.id);if(n&&n.visibilityDependencyIds?.length)for(const r of n.visibilityDependencyIds){const o=t(this.#a).get(r);o&&o instanceof re&&(t(this.#t).set(r,a),o.layer.visible=a,this.#r(o,a))}}#_(e){if(e&&this.#e)return this.#e.getVisibilityGroupConfig(e)}#w(e){const a=e.map(n=>{const r=this.#g(n);return this.#f(n,void 0,r)});return this.#v([...a])}#o(e){if(e&&this.#e)return this.#e.getItemConfig(e)}#v(e){e.reverse();for(const a of e)a.children?.length&&this.#v(a.children);return e}#f(e,a,n){const r=new re(e.id,e.title,e,[],a);if(e.visible=n?.isVisibleOnInit??!1,t(this.#t).set(e.id,e.visible),this.#k(e)&&n?.hideFields!==!0){const o=e;o.loaded||console.warn(`Layer not loaded: ${e.id}`);for(const i of o.fields??[]){const h=this.#b(i,r,n);r.children.push(h)}}if(this.#x(e)){const o=e;return r.children=o.layers.toArray().map(i=>{const h=this.#g(i,n);return this.#f(i,r,h)}),r}if(this.#S(e)){const o=e;if(o.sublayers&&o.sublayers.length>0){const i=o.sublayers;r.children=i.toArray().map(this.#m)}}return r}#b(e,a,n){const r=this.#C(a.id,e.name),o=new it(r,e.alias||e.name,a.layer,e,[],a),i=this.#p(r,e.alias||e.name,n);return t(this.#t).set(r,i?.isVisibleOnInit??!1),o}#g(e,a){const n=this.#h(e.id,a);return n&&n.type===Ne.None&&(n.type=Sn(e)),n}#p(e,a,n){const r=this.#h(e,n);return r&&(r.type===Ne.None&&(r.type=Ne.Field),this.#s.has(a.trim().toLowerCase())&&(r.isHidden=!0)),r}#h(e,a){if(!this.#e)return;let n=this.#e.getItemConfig(e);return!n&&(n={id:e,type:Ne.None,isDownloadable:n?.isDownloadable,isVisibleOnInit:n?.isVisibleOnInit,isHidden:n?.isHidden??a?.isHidden,visibilityDependencyIds:n?.visibilityDependencyIds??a?.visibilityDependencyIds,visibilityGroupId:n?.visibilityGroupId??a?.visibilityGroupId},this.#e.addItemConfig(n)),n}#S(e){return e.type==="map-image"||e.type==="wms"}#m(e){const a=new re(e.uid,e.title,e);return e.sublayers?.length&&(a.children=e.sublayers.toArray().map(this.#m)),a}#y(e,a){for(const n of e)a.set(n.id,n),n.children?.length&&this.#y(n.children,a)}#C(e,a){return`${e}-${a}`}#x(e){return e.type==="group"}#k(e){return e.type==="feature"}#n(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}function Hn(f,e){Y(e,!0);const a=Z(e,"webMap",3,null);K(()=>{!a()||e.treeviewStore.initialized||e.treeviewStore.initialize(a().layers.toArray(),e.treeviewConfigStore)});var n=U(),r=T(n);{var o=i=>{var h=U(),w=T(h);q(w,()=>dt,(v,g)=>{g(v,{children:(x,m)=>{var c=U(),s=T(c);ue(s,17,()=>e.treeviewStore.getNodes(),l=>l.id,(l,F)=>{mt(l,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return t(F)},onNodeClick:()=>{},onNodeVisibilityChange:(k,y)=>e.treeviewStore.setVisibilityState(k.id,y),getNodeVisibility:k=>e.treeviewStore.getVisibilityState(k),depth:0,useLayerTypeIcon:!0})}),d(x,c)},$$slots:{default:!0}})}),d(i,h)};M(r,i=>{e.treeviewStore.initialized&&i(o)})}d(f,n),J()}function On(f,e){Y(e,!0),K(()=>{if(!X.lastAddedArea)return;(async()=>{if(X.lastAddedArea===null)return;const n=await X.getAreaNamesById([X.lastAddedArea.id]);!n||n.length===0||!n[0]||he.success(`Area added: ${n?.[0]}`)})()}),K(()=>{if(!X.lastRemovedArea)return;(async()=>{if(X.lastRemovedArea===null)return;const n=await X.getAreaNamesById([X.lastRemovedArea.id]);!n||n.length===0||!n[0]||he.success(`Area removed: ${n?.[0]}`)})()}),J()}var En=L("<!> <!>",1),Un=L('<div class="tab-list-wrapper svelte-rohqkk"><!></div> <!>',1);function Rn(f,e){Y(e,!0);const a=Z(e,"triggers",19,()=>[]);var n=U(),r=T(n);q(r,()=>Ut,(o,i)=>{i(o,{get value(){return e.value},get onValueChange(){return e.onValueChange},class:"w-full",children:(h,w)=>{var v=Un(),g=T(v),x=S(g);q(x,()=>Et,(c,s)=>{s(c,{class:"tab-list",children:(l,F)=>{var k=U(),y=T(k);ue(y,17,a,Ie,(u,p,z,C)=>{let W=()=>t(p).value,P=()=>t(p).label;var O=En(),R=T(O);q(R,()=>Rt,(_,I)=>{I(_,{get value(){return W()},class:"tab-trigger",children:(V,D)=>{ce();var E=_e();j(()=>ie(E,P())),d(V,E)},$$slots:{default:!0}})});var B=N(R,2);{var Q=_=>{ln(_,{class:"separator"})};M(B,_=>{W()!==a()[a().length-1]?.value&&_(Q)})}d(u,O)}),d(l,k)},$$slots:{default:!0}})}),b(g);var m=N(g,2);oe(m,()=>e.children??le),d(h,v)},$$slots:{default:!0}})}),d(f,n),J()}var Wn=L('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),Bn=L("<!> <!>",1);function ze(f,e){var a=U(),n=T(a);q(n,()=>Wt,(r,o)=>{o(r,{get value(){return e.value},class:"w-full",children:(i,h)=>{var w=Bn(),v=T(w);q(v,()=>Qe,(m,c)=>{c(m,{class:"card-content overflow-hidden p-0",children:(s,l)=>{dn(s,{class:"h-full w-full",children:(F,k)=>{var y=Wn(),u=S(y);oe(u,()=>e.children??le),b(y),d(F,y)},$$slots:{default:!0}})},$$slots:{default:!0}})});var g=N(v,2);{var x=m=>{var c=U(),s=T(c);q(s,()=>cn,(l,F)=>{F(l,{class:"flex items-center justify-between",children:(k,y)=>{var u=U(),p=T(u);oe(p,()=>e.footer),d(k,u)},$$slots:{default:!0}})}),d(m,c)};M(g,m=>{e.footer&&m(x)})}d(i,w)},$$slots:{default:!0}})}),d(f,a)}function Gn(f,e){f.stopPropagation(),e.onFilterClicked?.(e.layerId)}var qn=L("<button><!></button>");function _t(f,e){Y(e,!0);let a=H(ae(e.hasFiltersApplied?.(e.layerId)??!1));K(()=>{A(a,e.hasFiltersApplied?.(e.layerId)??!1,!0)});const n=ee(()=>t(a)?Bt:Gt);var r=qn();let o;r.__click=[Gn,e];var i=S(r);pe(i,()=>t(n)),b(r),j(h=>{o=Se(r,1,"filter-btn svelte-k95pvd",null,o,h),ye(r,"aria-pressed",t(a))},[()=>({active:t(a)})]),d(f,r),J()}Ce(["click"]);var Xn=L('<li class="area-item svelte-81yb5c"><span class="area-name svelte-81yb5c"> </span> <!></li>'),jn=L('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),Zn=L('<p class="no-selection svelte-81yb5c">No areas selected</p>'),Qn=L('<li class="data-item svelte-81yb5c"><span class="data-name svelte-81yb5c"> </span> <div class="data-actions svelte-81yb5c"><!> <!></div></li>'),Yn=L('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),Jn=L('<p class="no-selection svelte-81yb5c">No data selected</p>'),Kn=L('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function $n(f,e){Y(e,!0);const a=Z(e,"fieldFilterMenuStore",7);let n=H(ae([]));K(()=>{if(!X.layerHighlightState.areaInfos.length){A(n,[],!0);return}(async()=>{const p=await X.getAreaNamesById(X.layerHighlightState.areaInfos.map(C=>C.id)),z=[];for(let C=0;C<p.length;C++)z.push({name:p[C]||"Unknown Area",HighlightAreaInfo:X.layerHighlightState.areaInfos[C]});A(n,z,!0)})()});function r(u){const p=t(n).findIndex(z=>z.name===u);p!==-1&&X.removeSelectedArea(t(n)[p]?.HighlightAreaInfo.id)}function o(u){console.log("[export-menu] Removing data selection for layerId:",u),ne.DataSelections.delete(u),console.log("[export-menu] Current SelectedData:",un(ne.DataSelections))}function i(u){a().ActiveLayer?.id===u?a().ActiveLayer=null:a().ActiveLayer=e.webMapStore.dataLookup.get(u)}function h(u){const p=ne.DataSelections.get(u);return!(!p||!p.fields||p.fields.size===0||p.fields.size===e.webMapStore.dataLookup.get(u).fields?.length)}var w=Kn(),v=N(T(w),2),g=S(v),x=S(g,!0);b(g);var m=N(g,4);{var c=u=>{var p=jn(),z=T(p);ue(z,21,()=>t(n),Ie,(P,O)=>{var R=Xn(),B=S(R),Q=S(B,!0);b(B);var _=N(B,2);de(_,{variant:"ghost",size:"sm",class:"area-remove-btn",onclick:()=>r(t(O).name),children:(I,V)=>{ce();var D=_e("×");d(I,D)},$$slots:{default:!0}}),b(R),j(()=>ie(Q,t(O).name)),d(P,R)}),b(z);var C=N(z,2),W=S(C);b(C),j(()=>ie(W,`${t(n).length??""} area(s) selected`)),d(u,p)},s=u=>{var p=Zn();d(u,p)};M(m,u=>{t(n).length>0?u(c):u(s,!1)})}b(v);var l=N(v,2),F=N(S(l),2);{var k=u=>{var p=Yn(),z=T(p);ue(z,21,()=>[...ne.DataSelections.values()],Ie,(P,O)=>{var R=Qn(),B=S(R),Q=S(B,!0);b(B);var _=N(B,2),I=S(_);{var V=E=>{_t(E,{get layerId(){return t(O).layerId},onFilterClicked:i,hasFiltersApplied:h})};M(I,E=>{t(O).fields&&E(V)})}var D=N(I,2);de(D,{variant:"ghost",size:"sm",class:"data-remove-btn",onclick:()=>o(t(O).layerId),children:(E,G)=>{ce();var $=_e("×");d(E,$)},$$slots:{default:!0}}),b(_),b(R),j(()=>ie(Q,t(O).name)),d(P,R)}),b(z);var C=N(z,2),W=S(C);b(C),j(()=>ie(W,`${ne.DataSelections.size??""} data layer(s) selected`)),d(u,p)},y=u=>{var p=Jn();d(u,p)};M(F,u=>{ne.DataSelections.size>0?u(k):u(y,!1)})}b(l),j(u=>ie(x,u),[()=>e.areaSelectionTreeviewStore.initialized?e.areaSelectionTreeviewStore.getVisibleNodes()[0]?.name:"Loading..."]),d(f,w),J()}var ea=L('<p class="text-sm text-muted-foreground">Click "Export" to begin the download.</p> <!>',1);function ta(f,e){Y(e,!0);const a=()=>Pt(qt,"$page",n),[n,r]=Mt();function o(){if(X.layerHighlightState.areaInfos.length<=0){he.error("Please select at least one area to export.");return}if(ne.DataSelections.size<=0){he.error("Please select at least one data layer to export.");return}console.log("Starting export..."),he.info("Export started successfully.",{duration:4e3});const w=crypto.randomUUID();be.downloads.push({id:w,url:`${a().url}/${w}`,status:"pending"}),e.onExportSuccess?.()}var i=ea(),h=N(T(i),2);de(h,{onclick:o,children:(w,v)=>{ce();var g=_e("Export");d(w,g)},$$slots:{default:!0}}),d(f,i),J(),r()}var na=L('<p class="text-sm font-medium"> </p>'),aa=L('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function ra(f,e){Y(e,!0);let a=H(null),n=H(ae({x:0,y:0})),r=0;const o=v=>{A(n,{x:v.clientX,y:v.clientY},!0)};K(()=>(document.addEventListener("mousemove",o),()=>{document.removeEventListener("mousemove",o)})),K(()=>{const v=X.currentHoveredArea?.id,g=++r;if(!v){A(a,null);return}(async()=>{const x=await X.getAreaNamesById([v]);g===r&&X.currentHoveredArea?.id===v&&A(a,x[0]??null,!0)})()});var i=U(),h=T(i);{var w=v=>{var g=aa(),x=S(g);q(x,()=>ct,(m,c)=>{c(m,{class:"max-w-xs border !py-2 shadow-lg",children:(s,l)=>{var F=U(),k=T(F);q(k,()=>Qe,(y,u)=>{u(y,{class:"!px-3 !py-0",children:(p,z)=>{var C=na(),W=S(C,!0);b(C),j(()=>ie(W,t(a))),d(p,C)},$$slots:{default:!0}})}),d(s,F)},$$slots:{default:!0}})}),b(g),j(()=>me(g,`left: ${t(n).x+10}px; top: ${t(n).y-10}px;`)),d(v,g)};M(h,v=>{t(a)&&v(w)})}d(f,i),J()}function ia(f,e){f.target===f.currentTarget&&e()}var oa=(f,e)=>f.key==="Escape"&&e(),sa=(f,e,a)=>e(t(a).name),la=L('<div class="info-icon-container svelte-fp5rsc"><!></div>'),da=L('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),ca=L('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),ua=L("<!> <!>",1),va=L("<!> <!>",1),fa=L('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),ga=L('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function ha(f,e){Y(e,!0);const a=Z(e,"fieldFilterMenuStore",7);let n=H(null),r=H(ae(new ge)),o=ee(()=>{if(!t(n)||!t(n).fields)return{checked:!1,indeterminate:!1};const s=t(n).fields.length,l=t(r)?.size||0;return l===0?{checked:!1,indeterminate:!1}:l===s?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});K(()=>{console.log("Active Layer to Filter:",a().ActiveLayer);const s=a().ActiveLayer;if(A(n,s,!0),s){const l=ne.DataSelections.get(s.id);l?.fields?A(r,new ge([...l.fields]),!0):A(r,new ge,!0)}});function i(){h(),a().ActiveLayer=null}function h(){if(!t(n))return;let s=ne.DataSelections.get(t(n).id);if(s){if((s.fields===void 0||s.fields===null)&&(s.fields=new ge),t(r).size===0){ne.removeSelection(t(n).id);return}s.fields.clear(),t(r).forEach(l=>{s.fields?.add(l)})}}function w(s){t(n)&&(t(r).has(s)?t(r).delete(s):t(r).add(s))}function v(){if(!t(n)?.fields)return;(t(r)?.size||0)===0?t(n).fields.forEach(l=>{t(r).add(l.name)}):t(r).clear()}function g(){return t(n)?.fields?t(n).fields.filter(s=>!e.fieldsToHide?.has(s.alias?.toLowerCase()??"")):[]}var x=U(),m=T(x);{var c=s=>{var l=ga();l.__click=[ia,i],l.__keydown=[oa,i];var F=S(l);q(F,()=>ct,(k,y)=>{y(k,{class:"command-card",children:(u,p)=>{var z=fa(),C=T(z);C.__click=i;var W=S(C);vn(W,{size:20}),b(C);var P=N(C,2);q(P,()=>Qe,(O,R)=>{R(O,{class:"card-content",children:(B,Q)=>{var _=U(),I=T(_);q(I,()=>fn,(V,D)=>{D(V,{children:(E,G)=>{var $=va(),te=T($);q(te,()=>gn,(ve,fe)=>{fe(ve,{placeholder:"Search for fields..."})});var xe=N(te,2);q(xe,()=>hn,(ve,fe)=>{fe(ve,{children:(we,Ve)=>{var Te=ua(),Fe=T(Te);q(Fe,()=>mn,(Me,Pe)=>{Pe(Me,{children:(He,pt)=>{ce();var Ae=_e("No results found.");d(He,Ae)},$$slots:{default:!0}})});var bt=N(Fe,2);q(bt,()=>yn,(Me,Pe)=>{Pe(Me,{heading:"Fields",children:(He,pt)=>{var Ae=ca(),Oe=T(Ae),St=S(Oe);nt(St,{get checked(){return t(o).checked},get indeterminate(){return t(o).indeterminate},onCheckedChange:v}),ce(2),b(Oe);var Ye=N(Oe,2);q(Ye,()=>Xt,(Ee,se)=>{se(Ee,{})});var Ct=N(Ye,2);ue(Ct,17,g,Ie,(Ee,se)=>{var Je=U(),xt=T(Je);q(xt,()=>_n,(kt,Nt)=>{Nt(kt,{class:"field-item",onselect:()=>w(t(se).name),children:(It,Ha)=>{var Ue=da(),Ke=S(Ue);{let ke=ee(()=>t(r)?.has(t(se).name)??!1);nt(Ke,{class:"field-checkbox",get checked(){return t(ke)},onCheckedChange:()=>w(t(se).name)})}var Re=N(Ke,2);Re.__click=[sa,w,se];var $e=S(Re),We=S($e),Tt=S(We,!0);b(We);var Ft=N(We,2);{var At=ke=>{var Le=la(),Lt=S(Le);pe(Lt,()=>jt),b(Le),j(()=>ye(Le,"title",t(se).description)),d(ke,Le)};M(Ft,ke=>{t(se).description&&ke(At)})}b($e),b(Re),b(Ue),j(()=>ie(Tt,t(se).alias||t(se).name)),d(It,Ue)},$$slots:{default:!0}})}),d(Ee,Je)}),d(He,Ae)},$$slots:{default:!0}})}),d(we,Te)},$$slots:{default:!0}})}),d(E,$)},$$slots:{default:!0}})}),d(B,_)},$$slots:{default:!0}})}),d(u,z)},$$slots:{default:!0}})}),b(l),d(s,l)};M(m,s=>{t(n)&&s(c)})}d(f,x),J()}Ce(["click","keydown"]);var ma=L('<li class="download-item svelte-vgw5fc"><div class="download-info svelte-vgw5fc"><span class="download-url svelte-vgw5fc"> </span></div> <div class="download-actions svelte-vgw5fc"><div><!></div> <!> <!> <!></div></li>'),ya=L('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),_a=L('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),wa=L('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function ba(f,e){Y(e,!0);let a=H(ae(new Set));function n(m){const c=be.downloads.findIndex(s=>s.url===m);c!==-1&&be.downloads.splice(c,1)}async function r(m){try{await navigator.clipboard.writeText(m),A(a,new Set(t(a)).add(m),!0),he.success("URL copied to clipboard"),setTimeout(()=>{const c=new Set(t(a));c.delete(m),A(a,c,!0)},2e3)}catch(c){console.error("Failed to copy URL:",c),he.error("Failed to copy URL to clipboard")}}function o(m){switch(m){case"completed":return"#059669";case"in-progress":return"#2563eb";case"failed":return"#dc2626";case"pending":default:return"#6b7280"}}function i(m){switch(m){case"completed":return"Completed";case"in-progress":return"In Progress";case"failed":return"Failed";case"pending":default:return"Pending"}}function h(m){switch(m){case"completed":return $t;case"in-progress":return Kt;case"failed":return Jt;case"pending":default:return Yt}}var w=wa(),v=N(S(w),2);{var g=m=>{var c=ya(),s=T(c);ue(s,21,()=>be.downloads,Ie,(k,y)=>{var u=ma(),p=S(u),z=S(p),C=S(z,!0);b(z),b(p);var W=N(p,2),P=S(W),O=S(P);{let I=ee(()=>o(t(y).status));de(O,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${t(I)??""}`},disabled:!0,children:(V,D)=>{const E=ee(()=>h(t(y).status));var G=U(),$=T(G);{let te=ee(()=>t(y).status==="in-progress"?"spinning":"");q($,()=>t(E),(xe,ve)=>{ve(xe,{size:14,get class(){return t(te)}})})}d(V,G)},$$slots:{default:!0}})}b(P);var R=N(P,2);de(R,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>r(t(y).url),title:"Copy URL to clipboard",children:(I,V)=>{var D=U(),E=T(D);{var G=te=>{Zt(te,{size:14})},$=te=>{Qt(te,{size:14})};M(E,te=>{t(a).has(t(y).url)?te(G):te($,!1)})}d(I,D)},$$slots:{default:!0}});var B=N(R,2);{var Q=I=>{de(I,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(t(y).url,"_blank"),title:"Open download",children:(V,D)=>{ce();var E=_e("📥");d(V,E)},$$slots:{default:!0}})};M(B,I=>{t(y).status==="completed"&&I(Q)})}var _=N(B,2);de(_,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>n(t(y).url),title:"Remove from queue",children:(I,V)=>{ce();var D=_e("×");d(I,D)},$$slots:{default:!0}}),b(W),b(u),j(I=>{ye(z,"title",t(y).url),ie(C,t(y).id),ye(P,"title",I)},[()=>i(t(y).status)]),d(k,u)}),b(s);var l=N(s,2),F=S(l);b(l),j(()=>ie(F,`${be.downloads.length??""} download(s) in queue`)),d(m,c)},x=m=>{var c=_a();d(m,c)};M(v,m=>{be.downloads.length>0?m(g):m(x,!1)})}b(w),d(f,w),J()}var pa=L('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function st(f,e){Y(e,!0);const a=Z(e,"isFolder",3,!1),n=Z(e,"isOpen",3,!1),r=`calc(100% - ${e.depth*1}rem)`;var o=pa();o.__click=function(...l){e.onclick?.apply(this,l)};var i=S(o),h=S(i),w=S(h);{var v=l=>{lt(l,{get isOpen(){return n()}})};M(w,l=>{a()&&l(v)})}var g=N(w,2),x=S(g);pe(x,()=>e.icon),b(g);var m=N(g,2),c=S(m,!0);b(m),b(h);var s=N(h,2);oe(s,()=>e.children??le),b(i),b(o),j(l=>{Se(o,1,l),me(o,`width: ${r};`),ie(c,e.name)},[()=>rn(zn({enhancedHover:!0,includeFont:!0}))]),d(f,o),J()}Ce(["click"]);function Sa(f,e,a){f.stopPropagation(),A(e,!t(e)),a.onDownloadStateChanged?.(a.node,t(e))}var Ca=L("<button><!></button>");function xa(f,e){Y(e,!0);let a=H(ae(e.getDownloadState?.(e.node)??!1));K(()=>{if(e.getDownloadState){const i=e.getDownloadState(e.node);A(a,i??!1,!0)}});var n=Ca();let r;n.__click=[Sa,a,e];var o=S(n);pe(o,()=>en),b(n),j(i=>{r=Se(n,1,"download-btn svelte-zg9ffb",null,r,i),ye(n,"title",`Download ${e.node.name??""}`),ye(n,"aria-label",`Download ${e.node.name??""}`),ye(n,"aria-pressed",t(a))},[()=>({active:t(a)})]),d(f,n),J()}Ce(["click"]);var ka=L('<div class="flex items-center gap-2"><!></div>'),Na=L("<div><!></div>"),Ia=L("<!> <!>",1),Ta=L('<div class="flex items-center gap-2"><!> <!></div>');function wt(f,e){Y(e,!0);const a=k=>{var y=U(),u=T(y);{var p=z=>{var C=U(),W=T(C);{var P=R=>{st(R,{get icon(){return t(x)},get name(){return e.node.name},get depth(){return o()},onclick:F,get isFolder(){return h},get isOpen(){return t(v)},children:Q=>{var _=ka(),I=S(_);{var V=D=>{at(D,{get checked(){return t(g)},onCheckedChange:s})};M(I,D=>{w&&D(V)})}b(_),d(Q,_)},$$slots:{default:!0}})},O=R=>{st(R,{get icon(){return t(x)},get name(){return e.node.name},get depth(){return o()},onclick:l,get isFolder(){return h},children:Q=>{var _=Ta(),I=S(_);{var V=G=>{var $=Ia(),te=T($);{var xe=fe=>{var we=Na();let Ve;var Te=S(we);_t(Te,{get layerId(){return e.node.id},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied}}),b(we),j(Fe=>Ve=Se(we,1,"filter-transition-wrapper svelte-kvoyne",null,Ve,Fe),[()=>({"fade-in":!t(c),"fade-out":t(c)})]),d(fe,we)};M(te,fe=>{t(m)&&fe(xe)})}var ve=N(te,2);xa(ve,{get node(){return e.node},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState}}),d(G,$)};M(I,G=>{e.isDownloadable&&G(V)})}var D=N(I,2);{var E=G=>{at(G,{get checked(){return t(g)},onCheckedChange:s})};M(D,G=>{w&&G(E)})}b(_),d(Q,_)},$$slots:{default:!0}})};M(W,R=>{h?R(P):R(O,!1)})}d(z,C)};M(u,z=>{r()?.getItemConfig(e.node.id)?.isHidden||z(p)})}d(k,y)},n=(k,y=le)=>{var u=U(),p=T(u);{var z=C=>{{let W=ee(()=>r()?.getItemConfig(y().id)?.isDownloadable??!0),P=ee(()=>o()+1);wt(C,{get treeviewConfigStore(){return r()},get node(){return y()},get isDownloadable(){return t(W)},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return t(P)},get useLayerTypeIcon(){return i()}})}};M(p,C=>{h&&t(v)&&!r()?.getItemConfig(y().id)?.isHidden&&C(z)})}d(k,u)},r=Z(e,"treeviewConfigStore",3,null),o=Z(e,"depth",3,0),i=Z(e,"useLayerTypeIcon",3,!1),h=!!(e.node.children&&e.node.children.length),w=!h;let v=H(!1),g=H(!1),x=H(""),m=H(!1),c=H(!1);K(()=>{if(!e.node)return;const k=e.getNodeVisibility?e.getNodeVisibility(e.node.id):!1;A(g,k??!1,!0),e.node instanceof re&&A(x,ht(e.node.layer,i(),h,t(v)),!0)}),K(()=>{if(!(e.node instanceof re))return;const k=(e.getDownloadState?.(e.node)&&e.node.layer.type==="feature")??!1;k&&!t(m)?(A(m,!0),A(c,!1)):!k&&t(m)&&(A(c,!0),setTimeout(()=>{A(m,!1),A(c,!1)},180))});function s(){!w||!e.onNodeVisibilityChange||(A(g,!t(g)),e.onNodeVisibilityChange(e.node,t(g)))}function l(){e.onNodeClick?.(e.node)}function F(){A(v,!t(v)),e.onNodeClick?.(e.node)}{let k=ee(()=>h?e.node.children:null);ut(f,{get isOpen(){return t(v)},get content(){return a},get childNodes(){return t(k)},get childNode(){return n}})}J()}function Fa(f,e){Y(e,!0);const a=Z(e,"webMap",3,null),n=Z(e,"fieldFilterMenuStore",7),r=new yt;K(()=>{if(!a()||r.initialized)return;(async()=>{await a().when(),await o(a().layers.toArray()),console.log("[data-selection-tree-view] fields to hide:",e.fieldsToHide),r.initialize(a().layers.toArray(),e.treeviewConfigStore,e.fieldsToHide),console.log("[data-selection-tree-view] Initialized with layers:",r.getNodes())})()});async function o(c){for(const s of c)s.type==="feature"&&!s.loaded&&(await s.load(),console.log("Loaded feature layer:",s.title)),s.type==="group"&&await o(s.layers.toArray())}function i(c,s){if(!s){ne.removeSelection(c.id);return}if(!(c instanceof re))return;const l={layerId:c.id,name:c.layer.title||"",fields:new ge(c.layer.fields?.map(F=>F.name)||[])};ne.addSelection(l)}function h(c){return ne.DataSelections.has(c.id)}function w(c){if(n().ActiveLayer?.uid===c){n().ActiveLayer=null;return}const l=r.getNodeById(c);!l||!(l instanceof re)||(n().ActiveLayer=l.layer)}function v(c){const s=ne.DataSelections.get(c);if(!s?.fields)return!1;const l=r.getNodeById(c);if(!l||!(l instanceof re))return!1;const F=l.layer.fields?.length||0,k=s.fields.size;return k>0&&k!==F}var g=U(),x=T(g);{var m=c=>{var s=U(),l=T(s);q(l,()=>dt,(F,k)=>{k(F,{children:(y,u)=>{var p=U(),z=T(p);ue(z,17,()=>r.getNodes(),C=>C.id,(C,W)=>{{let P=ee(()=>e.treeviewConfigStore.getItemConfig(t(W).id)?.isDownloadable??!1);wt(C,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return t(W)},get isDownloadable(){return t(P)},onNodeClick:()=>{},onNodeVisibilityChange:(O,R)=>r.setVisibilityState(O.id,R),getNodeVisibility:O=>r.getVisibilityState(O),onDownloadStateChanged:i,getDownloadState:h,onFilterClicked:w,hasFiltersApplied:v,depth:0,useLayerTypeIcon:!0})}}),d(y,p)},$$slots:{default:!0}})}),d(c,s)};M(x,c=>{r.initialized&&c(m)})}d(f,g),J()}const Aa=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];function La(f,e,a,n,r){if(!e.isOpen)return;A(a,!0),f.preventDefault();const o=f.clientX,i=t(n);function h(v){const g=v.clientX-o,x=Math.max(t(r),i+g);A(n,x,!0)}function w(){A(a,!1),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",w),document.body.style.cursor="",document.body.style.userSelect=""}document.addEventListener("mousemove",h),document.addEventListener("mouseup",w),document.body.style.cursor="ew-resize",document.body.style.userSelect="none"}var za=L('<button class="absolute top-0 h-full cursor-ew-resize border-0 bg-transparent p-0 transition-colors hover:bg-primary/50" aria-label="Resize sidebar by dragging" tabindex="-1"></button>'),Da=L('<!> <aside><div class="flex h-full w-full flex-col"><div class="flex-1 overflow-x-hidden overflow-y-auto p-4"><!></div></div> <!></aside>',1);function Va(f,e){Y(e,!0);const a=Z(e,"minWidth",3,"500px");let n,r=H(0),o=H(ae(parseFloat(a()))),i=H(!1);const h=ee(()=>parseFloat(a()));Ze(()=>{if(!n)return;const y=new ResizeObserver(u=>{for(const p of u)A(r,p.contentRect.width,!0)});return y.observe(n),()=>{y.disconnect()}});var w=Da(),v=T(w);{let y=ee(()=>e.isOpen?"Close sidebar":"Open sidebar");de(v,{get onclick(){return e.onToggle},variant:"default",size:"icon",class:"fixed z-[2] rounded-l-none rounded-r-md shadow-lg hover:scale-105",get style(){return`top: calc(var(--header-height, 64px) + 1rem); left: ${t(r)??""}px; pointer-events: auto; transition: transform 200ms, background-color 200ms;`},get"aria-label"(){return t(y)},get"aria-expanded"(){return e.isOpen},children:(u,p)=>{var z=U(),C=T(z);{var W=O=>{bn(O,{class:"h-6 w-6"})},P=O=>{pn(O,{class:"h-6 w-6"})};M(C,O=>{e.isOpen?O(W):O(P,!1)})}d(u,z)},$$slots:{default:!0}})}var g=N(v,2);let x;var m=S(g),c=S(m);me(c,"padding-right: 16px;");var s=S(c);{var l=y=>{var u=U(),p=T(u);oe(p,()=>e.children),d(y,u)};M(s,y=>{e.children&&y(l)})}b(c),b(m);var F=N(m,2);{var k=y=>{var u=za();u.__mousedown=[La,e,i,o,h],me(u,"width: 8px; right: -4px;"),d(y,u)};M(F,y=>{e.isOpen&&y(k)})}b(g),De(g,y=>n=y,()=>n),j(y=>{x=Se(g,1,"relative flex h-full flex-col border-r border-sidebar-border bg-card text-card-foreground shadow-lg ease-in-out",null,x,y),me(g,`width: ${e.isOpen?`${t(o)}px`:"0"}; overflow: hidden;`)},[()=>({"transition-all":!t(i),"duration-300":!t(i)})]),d(f,w),J()}Ce(["mousedown"]);var Ma=L("<!> <!> <!> <!>",1),Pa=L('<!> <!> <!> <!> <div class="layout-container svelte-1xwk4vv"><!> <div class="map-section svelte-1xwk4vv"><!></div></div>',1);function nr(f,e){Y(e,!0);const a=ae(new tn),n=ae(new nn),r=ae(new yt);let o=H("define-areas"),i=H(ae(new Set)),h=H(void 0),w=H(void 0),v=H(!0);function g(){A(v,!t(v))}Ze(async()=>{const C=await wn();A(i,new Set(C.fieldsToHide||[]),!0),X.setNameFields(C.selectionLayersNameFields||[]),A(h,new rt(C.dataSelectionTreeviewConfig),!0),A(w,new rt(C.areaSelectionTreeviewConfig),!0),await a.initializeAsync({portalUrl:C.portalUrl,itemId:C.portalItemId||"",proxy:C.proxy}),console.log("[page] WebMap loaded")});function x(C){A(o,C,!0)}function m(){A(o,"downloads")}var c=Pa(),s=T(c);an(s,{});var l=N(s,2);ra(l,{});var F=N(l,2);ha(F,{get fieldFilterMenuStore(){return n},get fieldsToHide(){return t(i)}});var k=N(F,2);On(k,{});var y=N(k,2),u=S(y);Va(u,{get isOpen(){return t(v)},onToggle:g,children:(C,W)=>{Rn(C,{get value(){return t(o)},get triggers(){return Aa},onValueChange:x,children:(P,O)=>{var R=Ma(),B=T(R);ze(B,{value:"define-areas",children:(V,D)=>{Hn(V,{get webMap(){return a.data},get treeviewStore(){return r},get treeviewConfigStore(){return t(w)}})}});var Q=N(B,2);ze(Q,{value:"select-data",children:(V,D)=>{Fa(V,{get webMap(){return a.data},get treeviewConfigStore(){return t(h)},get fieldsToHide(){return t(i)},get fieldFilterMenuStore(){return n}})}});var _=N(Q,2);ze(_,{value:"export",footer:D=>{ta(D,{onExportSuccess:m})},children:(D,E)=>{$n(D,{get webMapStore(){return a},get areaSelectionTreeviewStore(){return r},get fieldFilterMenuStore(){return n}})}});var I=N(_,2);ze(I,{value:"downloads",children:(V,D)=>{ba(V,{})}}),d(P,R)},$$slots:{default:!0}})},$$slots:{default:!0}});var p=N(u,2),z=S(p);In(z,{get webMap(){return a.data},get areaSelectionTreeviewStore(){return r},panelPosition:"top-left",menuPosition:"top-right"}),b(p),b(y),d(f,c),J()}export{nr as component};
