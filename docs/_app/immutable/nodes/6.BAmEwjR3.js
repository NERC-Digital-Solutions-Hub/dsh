const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CyrEfJff.js","../chunks/iFuBOtDF.js","../chunks/DHq0rblm.js","../chunks/BfhsIlKo.js","../chunks/faKFIXLZ.js","../chunks/D9Z9MdNV.js","../chunks/pCx8oau_.js","../chunks/BgvLO-3W.js","../chunks/CBG-jaYw.js","../chunks/C8PpcA25.js","../chunks/DhdgDebw.js","../chunks/Dt5YSiFI.js","../chunks/C1yg1qUQ.js","../chunks/LE72oyNN.js","../chunks/CYi2TAj9.js","../chunks/DgwIrkEl.js","../chunks/DmWTBsn2.js","../chunks/BwKptEmm.js","../chunks/CCzk6ARw.js","../chunks/Dvbl4r8A.js","../chunks/gRIb6kZn.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/Bvto7RYj.js","../chunks/BOB_xkBk.js","../chunks/DFQ1ZjBx.js","../chunks/Cl5lrJ4c.js","../chunks/B0LmsqEq.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/C4HJhmWz.js","../chunks/CDl12u7R.js","../chunks/DYJGs4je.js","../chunks/Djp3mnm5.js","../chunks/Bso-6bUH.js","../chunks/DQOJ18NT.js","../chunks/CLto_E8U.js","../chunks/CxFnk1MP.js","../chunks/D5ew8ajr.js","../chunks/B4aqFq2B.js","../chunks/EzLf78vY.js","../chunks/BPhm6YV-.js","../chunks/BkA6azLD.js","../chunks/hXVs3T0e.js","../chunks/Dytf6RTV.js","../chunks/9YvG7tFv.js","../chunks/B-VZ3wrL.js","../chunks/CaNAmI22.js","../chunks/aQeO9QTD.js","../chunks/BDqMdsvZ.js","../chunks/DJTyCEHv.js","../chunks/BMX0GFJS.js","../chunks/CsLyQp38.js","../chunks/ETfT8J3h.js","../chunks/BQ2D4CO5.js","../chunks/DZd6gJy7.js","../chunks/C7x2MF0l.js","../chunks/C8BmVxiO.js","../chunks/Cr2KJ5IK.js","../chunks/CJ_83qNO.js","../chunks/Ck-szKz5.js","../chunks/BxD4MBPA.js","../chunks/Banwpgrz.js","../chunks/cw1rsUFH.js","../chunks/C0pjifF4.js","../chunks/ok2Sqpw2.js","../chunks/Chk7YAAL.js","../chunks/D0t3l1UW.js","../chunks/Cgb6qxNH.js","../chunks/DsnVlOka.js","../chunks/CrwPCMe2.js","../chunks/QQC62dOK.js","../chunks/C51QhSzO.js","../chunks/BdLvjJaM.js","../chunks/BaYj2Wow.js","../chunks/DphnWQ0e.js","../chunks/DKpmsPfl.js","../chunks/B9RJBcJ2.js","../chunks/8WNRLB3q.js","../chunks/B1N-tmtC.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/Cf9zLCCH.js","../chunks/pDuGEAnG.js","../chunks/CMaiVHma.js","../chunks/BrScpkSj.js","../chunks/rxpTDz6e.js","../chunks/Dl1orkLD.js","../chunks/D_pI6fQj.js","../chunks/zFNEK25s.js","../chunks/CL2NbQte.js","../chunks/D_JYBHfY.js","../chunks/Cvs00xeJ.js","../chunks/Duu7_u0O.js","../chunks/Dmk_Dxvx.js","../chunks/C5CzMsLd.js","../chunks/pyb07plo.js","../chunks/BRLX27Af.js","../chunks/C8NkvdGB.js","../chunks/Cxihbb8M.js","../chunks/BYV4nsB9.js","../chunks/DQ_sR0Oz.js","../chunks/DbyYraQc.js","../chunks/Dj4-5pgM.js","../chunks/BY6Wrw2B.js","../chunks/D-j7oGrU.js","../chunks/ChTYeCcj.js","../chunks/QOzMNXdI.js","../chunks/DoDP5r3i.js","../chunks/GKolV7NZ.js","../chunks/Bs6tEc1N.js","../chunks/DadzvVj2.js","../chunks/BUd8m5s5.js","../chunks/vIRtxQoE.js","../chunks/BeKBFCJY.js","../chunks/4c7MyKAz.js","../chunks/BpFwjkk6.js","../chunks/Glnbxn3o.js","../chunks/DZ__J_Ha.js","../chunks/VMSlSy0z.js","../chunks/DkkI5QKs.js","../chunks/C3cxdwvi.js","../chunks/CTc4Bt11.js","../chunks/pdT4reVn.js","../chunks/D0yCzUdH.js","../chunks/BiM6pph8.js","../chunks/DA_X7pFa.js","../chunks/B_DLPStx.js","../chunks/CZnF4aA7.js","../chunks/CGwv2ov9.js","../chunks/DRnuuSv_.js","../chunks/CGe7GMdJ.js","../chunks/B3MXpedj.js","../chunks/B6WMH48X.js","../chunks/B1pCqEo_.js","../chunks/BrYzRPrF.js","../chunks/Bg3hnFg2.js","../chunks/DYzr77oO.js","../chunks/CMq8eZcm.js","../chunks/N_B-5EBV.js","../chunks/u5nA3ppO.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/4ef240Er.js","../chunks/CXd_PekB.js","../chunks/CNJBC4J4.js","../chunks/Dz-aVBgt.js","../chunks/Bs354Zoz.js","../chunks/CfrNlpsM.js","../chunks/DdSLmJ2d.js","../chunks/BS3H3l-F.js","../chunks/DCdj6Lab.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/CY_HuWbD.js","../chunks/D1FCtSgh.js","../chunks/kAKGzqpF.js","../chunks/C5PvpwSg.js","../chunks/BsB-6bk9.js","../chunks/CaNUsX_h.js","../chunks/CaqllLde.js","../chunks/D7knBxw1.js","../chunks/COKPF4Dy.js","../chunks/BT3t3G5h.js","../chunks/BjiS_nfk.js","../chunks/DvcDHnyV.js","../chunks/DbEhBJ1e.js","../chunks/D9LchIWm.js","../chunks/BK2emRUs.js","../chunks/DnIiJOoS.js","../chunks/DsHDw-MJ.js"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{o as je,a as zt}from"../chunks/CwlFPufh.js";import{c as R,b as T,a as d,Z as Y,u as K,H as t,aG as E,f as z,a0 as J,ah as N,ao as F,a4 as S,a6 as p,a5 as le,a1 as j,aH as ee,at as ae,n as ce,aI as _e}from"../chunks/J6Bl3sxN.js";import{_ as We}from"../chunks/D9Z9MdNV.js";import{l as Lt,s as Mt,p as Z,i as D,a as Vt,b as Dt}from"../chunks/_fywD1i8.js";import{s as oe}from"../chunks/CdsLSXyK.js";import{b as Le}from"../chunks/RQ99CAyZ.js";import{m as Be,a as X,O as st,T as Pt,G as $e,F as et,b as Et,c as lt,t as ge,d as Ht,e as Ot,f as Rt,g as Ut,h as Wt,i as Bt,j as ne,k as ye,p as Gt,S as ke,C as tt,l as qt,I as Xt,n as jt,o as Zt,q as Qt,r as Yt,L as Jt,s as Kt,D as $t,V as nt,W as en,u as tn,v as nn,w as at}from"../chunks/C_BfcUbG.js";import{B as ue,o as Ge,F as Ne}from"../chunks/D-afBJkb.js";import{c as q}from"../chunks/D5NabK7e.js";import{e as he,d as pe,s as me,b as an}from"../chunks/BYOkOkBz.js";import{s as ie}from"../chunks/D8EIH3Is.js";import{h as be}from"../chunks/piBjdR0k.js";import{d as Se}from"../chunks/0Hj017KB.js";import{I as rn,s as on,C as sn,b as Ze,S as ln,c as dn,d as cn,a as dt,X as un,e as vn,f as fn,g as gn,h as hn,i as mn,j as _n,k as wn}from"../chunks/DIgvMCYa.js";import{B as de}from"../chunks/hcL2bxKX.js";import{X as yn}from"../chunks/CZAQqrGU.js";import"../chunks/BEqW7Zwo.js";function bn(_,e){const a=Lt(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];rn(_,Mt({name:"menu"},()=>a,{get iconNode(){return n},children:(r,i)=>{var o=R(),w=T(o);on(w,e,"default",{}),d(r,o)},$$slots:{default:!0}}))}class pn{id;name;children;parent;constructor(e,a,n=[],r=null){this.id=e,this.name=a,this.children=n,this.parent=r}}class re extends pn{layer;constructor(e,a,n,r=[],i=null){super(e,a,r,i),this.layer=n}}class rt extends re{featureLayer;field;constructor(e,a,n,r,i=[],o=null){super(e,a,n,i,o),this.field=r,this.featureLayer=n}}var Sn=z('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),Cn=z('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),xn=z('<div class="map-view svelte-i0p9uk"></div> <!> <!>',1);function kn(_,e){Y(e,!0);const a=Z(e,"webMap",3,null),n=Z(e,"panelPosition",3,"top-left"),r=Z(e,"menuPosition",3,"top-right");let i=null,o=E(null),w=E(null),y=E(null),v=E(!1);const f="streets-vector";let x,g;async function c(){if(!g){const[{default:m},{default:I},{default:V}]=await Promise.all([We(()=>import("../chunks/CyrEfJff.js").then(M=>M.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url),We(()=>import("../chunks/D5ew8ajr.js").then(M=>M.a3),__vite__mapDeps([38,1,2,3,5,39,24,6,7,22,40,41,42,43,8,9,10,11,44,23,20,21,45,46,47,48,12,13,49,50,51,25,52,53,17,32,54,55,56,26,57,58,15,59,0,4,14,16,18,19,27,28,29,30,31,33,34,35,36,37,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86]),import.meta.url),We(()=>import("../chunks/Dl1orkLD.js").then(M=>M.W),__vite__mapDeps([87,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,88,89,90,91,62,92,93,74,75,65,94,95,96,61,97,98,99,100,64,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,52,53,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171]),import.meta.url)]);x=m,g=I}}async function s(m,I){const V=new g({container:I,popupEnabled:!1,map:m});return await V.when(),V}function l(m){m.ui.move("zoom","top-right"),t(w)&&n()&&m.ui.add(t(w),n()),t(y)&&r()&&m.ui.add(t(y),r()),F(v,!0)}async function A(m){const I=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(V=>V.id);console.log("[uprn-map-view] Initializing map interactions with layers:",I),await Be.initializeAsync(m,new Set(I))}async function k(){return new x({basemap:f})}je(async()=>{await c(),await u()});async function h(){if(a())try{if(await c(),await u(),!t(o)){console.error("MapView is not initialized");return}t(o).map=a(),await a().when(),console.log("[uprn-map-view] MapView updated with new webMap")}catch(m){console.error("Error updating MapView with new webMap:",m)}}K(()=>{a()&&h()});async function u(){if(!i){console.error("Map container element was not found");return}try{F(o,await s(a()??void 0,i),!0),await A(t(o)),l(t(o)),console.log("[uprn-map-view] Map loaded successfully")}catch(m){console.error("Error loading map:",m),await b()}}async function b(){try{const m=await k();F(o,await s(m,i),!0),await A(t(o)),l(t(o)),console.log("[uprn-map-view] Fallback map loaded")}catch(m){console.error("Error loading fallback map:",m)}}K(()=>{if(!t(o)||!e.areaSelectionTreeviewStore.initialized)return;const m=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(I=>I.id);Be.updateInteractableLayers(new Set(m))});async function L(m){if(!t(o))return;const I=await t(o).whenLayerView(m);if(!I){console.warn("Could not get LayerView for the visible node layer");return}X.setSelectedLayerView(I)}K(()=>{if(!e.areaSelectionTreeviewStore.initialized)return;if(!e.areaSelectionTreeviewStore.getVisibleNodes().length){X.resetSelectedAreas();return}const m=e.areaSelectionTreeviewStore.getVisibleNodes()[0];if(!m||!(m instanceof re)||!(m.layer instanceof __esri.FeatureLayer)){console.warn("Visible node is not a FeatureLayer");return}if(!m.layer){console.warn("Visible node layer is not a FeatureLayer");return}L(m.layer)});function C(){Be.cleanup(),t(o)&&t(o).destroy()}zt(()=>{C()});var W=xn(),P=T(W);Le(P,m=>i=m,()=>i);var H=N(P,2);{var U=m=>{var I=Sn(),V=S(I);{var M=O=>{var G=R(),$=T(G);oe($,()=>e.panel),d(O,G)};D(V,O=>{t(v)&&O(M)})}p(I),Le(I,O=>F(w,O),()=>t(w)),d(m,I)};D(H,m=>{e.panel&&m(U)})}var B=N(H,2);{var Q=m=>{var I=Cn(),V=S(I);{var M=O=>{var G=R(),$=T(G);oe($,()=>e.menu),d(O,G)};D(V,O=>{t(v)&&O(M)})}p(I),Le(I,O=>F(y,O),()=>t(y)),d(m,I)};D(B,m=>{e.menu&&m(Q)})}d(_,W),J()}var Nn=z('<div class="tree-node-item svelte-1x7dzzd"><!></div>'),In=z('<div class="tree-children relative ml-4 w-full svelte-1x7dzzd"><div class="tree-guide-line tree-guide-line-animate svelte-1x7dzzd"></div> <!></div>'),Tn=z('<div class="w-full"><!>  <!></div>');function ct(_,e){const a=Z(e,"isOpen",3,!1),n=Z(e,"childNodes",3,null);var r=Tn(),i=S(r);oe(i,()=>e.content??le);var o=N(i,2);{var w=y=>{var v=In(),f=N(S(v),2);ue(f,19,()=>n()??[],x=>x.id,(x,g,c)=>{var s=Nn(),l=S(s);oe(l,()=>e.childNode??le,()=>t(g)),p(s),j(()=>he(s,`animation-delay: ${100+t(c)*50}ms;`)),d(x,s)}),p(v),d(y,v)};D(o,y=>{a()&&n()&&y(w)})}p(r),d(_,r)}const ut="mb-1 cursor-pointer rounded-md border border-border/30 p-2 text-left",vt="transform-gpu transition-all duration-150 ease-out hover:border-border/50 hover:bg-card/70 hover:shadow-sm",An="transition-colors hover:bg-card/70",qe="text-sm font-normal",Xe="bg-card/50",ft="bg-accent text-accent-foreground";function Fn(_){const{enhancedHover:e=!1,includeFont:a=!1,pressed:n=!1}=_;let r=ut;return e?r+=" "+vt:r+=" "+An,a&&(r+=" "+qe),n?r+=" "+ft:r+=" "+Xe,r}const zn="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";var Ln=z('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),Mn=z('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function it(_,e){const a=`calc(100% - ${e.depth*1}rem)`,n=`${ut} ${vt}`,r=`${n} ${zn} ${Xe} ${qe}`,i=`${n} ${qe}`;var o=R(),w=T(o);{var y=f=>{Pt(f,{get pressed(){return e.pressed},get class(){return r},variant:"outline",get style(){return`width: ${a};`},get onPressedChange(){return e.onclick},children:(x,g)=>{var c=Ln(),s=S(c),l=S(s),A=S(l);be(A,()=>e.icon),p(l);var k=N(l,2),h=S(k,!0);p(k),p(s);var u=N(s,2);oe(u,()=>e.children??le),p(c),j(()=>ie(h,e.name)),d(x,c)},$$slots:{default:!0}})},v=f=>{var x=Mn();x.__click=function(...b){e.onclick?.apply(this,b)};var g=S(x),c=S(g),s=S(c);st(s,{get isOpen(){return e.isOpen}});var l=N(s,2),A=S(l);be(A,()=>e.icon),p(l);var k=N(l,2),h=S(k,!0);p(k),p(c);var u=N(c,2);oe(u,()=>e.children??le),p(g),p(x),j(()=>{pe(x,1,`${i} ${e.pressed?ft:Xe}`),he(x,`width: ${a};`),ie(h,e.name)}),d(f,x)};D(w,f=>{e.isTogglable?f(y):f(v,!1)})}d(_,o)}Se(["click"]);const gt=(_,e,a,n)=>e?Vn(_,a):a?n?'<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',Vn=(_,e)=>{switch(_.type){case"group":return $e;case"feature":return et;case"tile":return Et;default:return e?$e:et}};function ht(_,e){Y(e,!0);const a=l=>{var A=R(),k=T(A);{var h=u=>{var b=R(),L=T(b);{var C=P=>{it(P,{isTogglable:!1,get pressed(){return t(v)},get icon(){return t(f)},get name(){return e.node.name},get depth(){return r()},onclick:s,get isOpen(){return t(y)}})},W=P=>{it(P,{isTogglable:!0,get pressed(){return t(v)},get icon(){return t(f)},get name(){return e.node.name},get depth(){return r()},onclick:c,get isOpen(){return t(y)}})};D(L,P=>{w?P(C):P(W,!1)})}d(u,b)};D(k,u=>{e.treeviewConfigStore.getItemConfig(e.node.id)?.isHidden||u(h)})}d(l,A)},n=(l,A=le)=>{var k=R(),h=T(k);{var u=b=>{{let L=ee(()=>r()+1);ht(b,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return A()},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return t(L)},get useLayerTypeIcon(){return i()}})}};D(h,b=>{w&&t(y)&&!e.treeviewConfigStore.getItemConfig(A().id)?.isHidden&&b(u)})}d(l,k)},r=Z(e,"depth",3,0),i=Z(e,"useLayerTypeIcon",3,!1),o=!!e.node.layer&&"visible"in e.node.layer,w=!!(e.node.children&&e.node.children.length);let y=E(!1),v=E(!1),f=E("");function x(){return!e.node.children||!e.getNodeVisibility?!1:e.node.children.some(l=>{const A=e.getNodeVisibility(l.id);return A!==void 0?A:l.layer.visible})}K(()=>{if(e.node){if(w)F(v,x(),!0);else{const l=e.getNodeVisibility?e.getNodeVisibility(e.node.id):void 0;F(v,l!==void 0?l:e.node.layer.visible,!0)}F(f,gt(e.node.layer,i(),w,t(y)),!0)}});function g(){!o||!e.onNodeVisibilityChange||w||(F(v,!t(v)),e.onNodeVisibilityChange(e.node,t(v)))}function c(){w||g(),e.onNodeClick?.(e.node)}function s(){F(y,!t(y)),e.onNodeClick?.(e.node)}{let l=ee(()=>w?e.node.children:null);ct(_,{get isOpen(){return t(y)},get content(){return a},get childNodes(){return t(l)},get childNode(){return n}})}J()}class mt{#l=E(!1);get initialized(){return t(this.#l)}set initialized(e){F(this.#l,e,!0)}#t=null;#o=E(ae([]));#r=ee(()=>{const e=new Ge;return this.#g(t(this.#o),e),e});#e=E(ae(new Ge));#d=E(ae(new Ge));initialize(e,a){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!a)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=a,!e)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#m(e),F(this.#o,this.#_(e),!0)}getNodeById(e){return this.#n(),t(this.#r).get(e)}getNodes(){return this.#n(),t(this.#o)}getVisibleNodes(){this.#n();const e=[];for(const[a,n]of t(this.#e)){if(!n)continue;const r=t(this.#r).get(a);r&&e.push(r)}return e}getNonHiddenNodes(){return this.#n(),this.#c(t(this.#o))}#c(e){this.#n();const a=[];for(const n of e){const r=this.#a(n.id);if(!(r&&r.isHidden)&&(a.push(n),n.children?.length)){const i=this.#c(n.children);a.push(...i)}}return a}getVisibilityState(e){return this.#n(),t(this.#e).get(e)??!1}setVisibilityState(e,a){this.#n();const n=t(this.#r).get(e);if(!n)throw new Error(`Tree node not found for ID: ${e}`);if(!(n instanceof re))throw new Error(`Tree node is not a layer node: ${e}`);t(this.#e).set(e,a),n.layer.visible=a,n instanceof rt&&(n.featureLayer.displayField=a?n.field.name:""),this.#i(n,a);const r=this.#a(e);if(!r||r.isHidden||(r.visibilityDependencyIds?.length&&this.#s(n,a),!r.visibilityGroupId))return;const i=r.visibilityGroupId;console.log(`Node ${e} is part of visibility group ${i}`);let o=t(this.#d).get(i);o||(o=[],t(this.#d).set(i,o));const w=this.#h(i);if(!w)throw new Error(`Visibility group config not found for group ID: ${i}`);if(!a){const v=o.indexOf(e);o.splice(v,1);return}const y=v=>{t(this.#e).set(v,!1);const f=t(this.#r).get(v);if(f&&f instanceof re){f.layer.visible=!1,this.#i(f,!1);const g=this.#a(v);g&&g.visibilityDependencyIds?.length&&this.#s(f,!1)}const x=o.indexOf(v);x>=0&&o.splice(x,1)};for(;o.length>=w.maxVisibleLayers;){const v=o[0];y(v)}o.push(e),this.#i(n,a),r.visibilityDependencyIds?.length&&this.#s(n,a)}#i(e,a){const n=e.parent;!n||!(n instanceof re)||(t(this.#e).set(n.id,a),n.layer.visible=a,this.#i(n,a))}#s(e,a){const n=this.#a(e.id);if(n&&n.visibilityDependencyIds?.length)for(const r of n.visibilityDependencyIds){const i=t(this.#r).get(r);i&&i instanceof re&&(t(this.#e).set(r,a),i.layer.visible=a,this.#i(i,a))}}#h(e){if(e&&this.#t)return this.#t.getVisibilityGroupConfig(e)}#m(e){this.#t&&this.#t.resolveInheritance(e)}#_(e){const a=e.map(n=>this.#v(n,void 0));return this.#u([...a])}#a(e){if(e&&this.#t)return this.#t.getItemConfig(e)}#u(e){e.reverse();for(const a of e)a.children?.length&&this.#u(a.children);return e}#v(e,a){const n=new re(e.id,e.title,e,[],a),r=this.#a(e.id);if(e.visible=r?.isVisibleOnInit??!1,t(this.#e).set(e.id,e.visible),this.#S(e)&&r?.showFields){const i=e;i.loaded||console.warn(`Layer not loaded: ${e.id}`);for(const o of i.fields??[]){const w=this.#w(o,n);n.children.push(w)}}if(this.#p(e)){const i=e;return n.children=i.layers.toArray().map(o=>this.#v(o,n)),n}if(this.#y(e)){const i=e;if(i.sublayers&&i.sublayers.length>0){const o=i.sublayers;n.children=o.toArray().map(this.#f)}}return n}#w(e,a){const n=this.#b(a.id,e.name),r=new rt(n,e.alias||e.name,a.layer,e,[],a),i=this.#a(n);return t(this.#e).set(n,i?.isVisibleOnInit??!1),r}#y(e){return e.type==="map-image"||e.type==="wms"}#f(e){const a=new re(e.uid,e.title,e);return e.sublayers?.length&&(a.children=e.sublayers.toArray().map(this.#f)),a}#g(e,a){for(const n of e)a.set(n.id,n),n.children?.length&&this.#g(n.children,a)}#b(e,a){return`${e}-${a}`}#p(e){return e.type==="group"}#S(e){return e.type==="feature"}#n(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}function Dn(_,e){Y(e,!0);const a=Z(e,"webMap",3,null);K(()=>{!a()||e.treeviewStore.initialized||e.treeviewStore.initialize(a().layers.toArray(),e.treeviewConfigStore)});var n=R(),r=T(n);{var i=o=>{var w=R(),y=T(w);q(y,()=>lt,(v,f)=>{f(v,{children:(x,g)=>{var c=R(),s=T(c);ue(s,17,()=>e.treeviewStore.getNodes(),l=>l.id,(l,A)=>{ht(l,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return t(A)},onNodeClick:()=>{},onNodeVisibilityChange:(k,h)=>e.treeviewStore.setVisibilityState(k.id,h),getNodeVisibility:k=>e.treeviewStore.getVisibilityState(k),depth:0,useLayerTypeIcon:!0})}),d(x,c)},$$slots:{default:!0}})}),d(o,w)};D(r,o=>{e.treeviewStore.initialized&&o(i)})}d(_,n),J()}function Pn(_,e){Y(e,!0),K(()=>{if(!X.lastAddedArea)return;(async()=>{if(X.lastAddedArea===null)return;const n=await X.getAreaNamesById([X.lastAddedArea.id]);!n||n.length===0||!n[0]||ge.success(`Area added: ${n?.[0]}`)})()}),K(()=>{if(!X.lastRemovedArea)return;(async()=>{if(X.lastRemovedArea===null)return;const n=await X.getAreaNamesById([X.lastRemovedArea.id]);!n||n.length===0||!n[0]||ge.success(`Area removed: ${n?.[0]}`)})()}),J()}var En=z("<!> <!>",1),Hn=z('<div class="tab-list-wrapper svelte-rohqkk"><!></div> <!>',1);function On(_,e){Y(e,!0);const a=Z(e,"triggers",19,()=>[]);var n=R(),r=T(n);q(r,()=>Ot,(i,o)=>{o(i,{get value(){return e.value},get onValueChange(){return e.onValueChange},class:"w-full",children:(w,y)=>{var v=Hn(),f=T(v),x=S(f);q(x,()=>Ht,(c,s)=>{s(c,{class:"tab-list",children:(l,A)=>{var k=R(),h=T(k);ue(h,17,a,Ne,(u,b,L,C)=>{let W=()=>t(b).value,P=()=>t(b).label;var H=En(),U=T(H);q(U,()=>Rt,(m,I)=>{I(m,{get value(){return W()},class:"tab-trigger",children:(V,M)=>{ce();var O=_e();j(()=>ie(O,P())),d(V,O)},$$slots:{default:!0}})});var B=N(U,2);{var Q=m=>{sn(m,{class:"separator"})};D(B,m=>{W()!==a()[a().length-1]?.value&&m(Q)})}d(u,H)}),d(l,k)},$$slots:{default:!0}})}),p(f);var g=N(f,2);oe(g,()=>e.children??le),d(w,v)},$$slots:{default:!0}})}),d(_,n),J()}var Rn=z('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),Un=z("<!> <!>",1);function ze(_,e){var a=R(),n=T(a);q(n,()=>Ut,(r,i)=>{i(r,{get value(){return e.value},class:"w-full",children:(o,w)=>{var y=Un(),v=T(y);q(v,()=>Ze,(g,c)=>{c(g,{class:"card-content overflow-hidden p-0",children:(s,l)=>{ln(s,{class:"h-full w-full",children:(A,k)=>{var h=Rn(),u=S(h);oe(u,()=>e.children??le),p(h),d(A,h)},$$slots:{default:!0}})},$$slots:{default:!0}})});var f=N(v,2);{var x=g=>{var c=R(),s=T(c);q(s,()=>dn,(l,A)=>{A(l,{class:"flex items-center justify-between",children:(k,h)=>{var u=R(),b=T(u);oe(b,()=>e.footer),d(k,u)},$$slots:{default:!0}})}),d(g,c)};D(f,g=>{e.footer&&g(x)})}d(o,y)},$$slots:{default:!0}})}),d(_,a)}function Wn(_,e){_.stopPropagation(),e.onFilterClicked?.(e.layerId)}var Bn=z("<button><!></button>");function _t(_,e){Y(e,!0);let a=E(ae(e.hasFiltersApplied?.(e.layerId)??!1));K(()=>{F(a,e.hasFiltersApplied?.(e.layerId)??!1,!0)});const n=ee(()=>t(a)?Wt:Bt);var r=Bn();let i;r.__click=[Wn,e];var o=S(r);be(o,()=>t(n)),p(r),j(w=>{i=pe(r,1,"filter-btn svelte-k95pvd",null,i,w),me(r,"aria-pressed",t(a))},[()=>({active:t(a)})]),d(_,r),J()}Se(["click"]);var Gn=z('<li class="area-item svelte-81yb5c"><span class="area-name svelte-81yb5c"> </span> <!></li>'),qn=z('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),Xn=z('<p class="no-selection svelte-81yb5c">No areas selected</p>'),jn=z('<li class="data-item svelte-81yb5c"><span class="data-name svelte-81yb5c"> </span> <div class="data-actions svelte-81yb5c"><!> <!></div></li>'),Zn=z('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),Qn=z('<p class="no-selection svelte-81yb5c">No data selected</p>'),Yn=z('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function Jn(_,e){Y(e,!0);const a=Z(e,"fieldFilterMenuStore",7);let n=E(ae([]));K(()=>{if(!X.layerHighlightState.areaInfos.length){F(n,[],!0);return}(async()=>{const b=await X.getAreaNamesById(X.layerHighlightState.areaInfos.map(C=>C.id)),L=[];for(let C=0;C<b.length;C++)L.push({name:b[C]||"Unknown Area",HighlightAreaInfo:X.layerHighlightState.areaInfos[C]});F(n,L,!0)})()});function r(u){const b=t(n).findIndex(L=>L.name===u);b!==-1&&X.removeSelectedArea(t(n)[b]?.HighlightAreaInfo.id)}function i(u){console.log("[export-menu] Removing data selection for layerId:",u),ne.DataSelections.delete(u),console.log("[export-menu] Current SelectedData:",cn(ne.DataSelections))}function o(u){if(a().ActiveLayer?.id===u){a().ActiveLayer=null;return}const b=e.webMapStore.dataLookup.get(u);if(!b){console.warn(`[export-menu] Layer with ID ${u} not found in web map store.`);return}a().ActiveLayer=b}function w(u){const b=ne.DataSelections.get(u);return!(!b||!b.fields||b.fields.size===0||b.fields.size===e.webMapStore.dataLookup.get(u)?.fields?.length)}var y=Yn(),v=N(T(y),2),f=S(v),x=S(f,!0);p(f);var g=N(f,4);{var c=u=>{var b=qn(),L=T(b);ue(L,21,()=>t(n),Ne,(P,H)=>{var U=Gn(),B=S(U),Q=S(B,!0);p(B);var m=N(B,2);de(m,{variant:"ghost",size:"sm",class:"area-remove-btn",onclick:()=>r(t(H).name),children:(I,V)=>{ce();var M=_e("×");d(I,M)},$$slots:{default:!0}}),p(U),j(()=>ie(Q,t(H).name)),d(P,U)}),p(L);var C=N(L,2),W=S(C);p(C),j(()=>ie(W,`${t(n).length??""} area(s) selected`)),d(u,b)},s=u=>{var b=Xn();d(u,b)};D(g,u=>{t(n).length>0?u(c):u(s,!1)})}p(v);var l=N(v,2),A=N(S(l),2);{var k=u=>{var b=Zn(),L=T(b);ue(L,21,()=>[...ne.DataSelections.values()],Ne,(P,H)=>{var U=jn(),B=S(U),Q=S(B,!0);p(B);var m=N(B,2),I=S(m);{var V=O=>{_t(O,{get layerId(){return t(H).layerId},onFilterClicked:o,hasFiltersApplied:w})};D(I,O=>{t(H).fields&&O(V)})}var M=N(I,2);de(M,{variant:"ghost",size:"sm",class:"data-remove-btn",onclick:()=>i(t(H).layerId),children:(O,G)=>{ce();var $=_e("×");d(O,$)},$$slots:{default:!0}}),p(m),p(U),j(()=>ie(Q,t(H).name)),d(P,U)}),p(L);var C=N(L,2),W=S(C);p(C),j(()=>ie(W,`${ne.DataSelections.size??""} data layer(s) selected`)),d(u,b)},h=u=>{var b=Qn();d(u,b)};D(A,u=>{ne.DataSelections.size>0?u(k):u(h,!1)})}p(l),j(u=>ie(x,u),[()=>e.areaSelectionTreeviewStore.initialized?e.areaSelectionTreeviewStore.getVisibleNodes()[0]?.name:"Loading..."]),d(_,y),J()}var Kn=z('<p class="text-sm text-muted-foreground">Click "Export" to begin the download.</p> <!>',1);function $n(_,e){Y(e,!0);const a=()=>Dt(Gt,"$page",n),[n,r]=Vt();function i(){if(X.layerHighlightState.areaInfos.length<=0){ge.error("Please select at least one area to export.");return}if(ne.DataSelections.size<=0){ge.error("Please select at least one data layer to export.");return}console.log("Starting export..."),ge.info("Export started successfully.",{duration:4e3});const y=crypto.randomUUID();ye.downloads.push({id:y,url:`${a().url}/${y}`,status:"pending"}),e.onExportSuccess?.()}var o=Kn(),w=N(T(o),2);de(w,{onclick:i,children:(y,v)=>{ce();var f=_e("Export");d(y,f)},$$slots:{default:!0}}),d(_,o),J(),r()}var ea=z('<p class="text-sm font-medium"> </p>'),ta=z('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function na(_,e){Y(e,!0);let a=E(null),n=E(ae({x:0,y:0})),r=0;const i=v=>{F(n,{x:v.clientX,y:v.clientY},!0)};K(()=>(document.addEventListener("mousemove",i),()=>{document.removeEventListener("mousemove",i)})),K(()=>{const v=X.currentHoveredArea?.id,f=++r;if(!v){F(a,null);return}(async()=>{const x=await X.getAreaNamesById([v]);f===r&&X.currentHoveredArea?.id===v&&F(a,x[0]??null,!0)})()});var o=R(),w=T(o);{var y=v=>{var f=ta(),x=S(f);q(x,()=>dt,(g,c)=>{c(g,{class:"max-w-xs border !py-2 shadow-lg",children:(s,l)=>{var A=R(),k=T(A);q(k,()=>Ze,(h,u)=>{u(h,{class:"!px-3 !py-0",children:(b,L)=>{var C=ea(),W=S(C,!0);p(C),j(()=>ie(W,t(a))),d(b,C)},$$slots:{default:!0}})}),d(s,A)},$$slots:{default:!0}})}),p(f),j(()=>he(f,`left: ${t(n).x+10}px; top: ${t(n).y-10}px;`)),d(v,f)};D(w,v=>{t(a)&&v(y)})}d(_,o),J()}function aa(_,e){_.target===_.currentTarget&&e()}var ra=(_,e)=>_.key==="Escape"&&e(),ia=(_,e,a)=>e(t(a).name),oa=z('<div class="info-icon-container svelte-fp5rsc"><!></div>'),sa=z('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),la=z('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),da=z("<!> <!>",1),ca=z("<!> <!>",1),ua=z('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),va=z('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function fa(_,e){Y(e,!0);const a=Z(e,"fieldFilterMenuStore",7);let n=E(null),r=E(ae(new ke)),i=ee(()=>{if(!t(n)||!t(n).fields)return{checked:!1,indeterminate:!1};const s=t(n).fields.length,l=t(r)?.size||0;return l===0?{checked:!1,indeterminate:!1}:l===s?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});K(()=>{console.log("Active Layer to Filter:",a().ActiveLayer);const s=a().ActiveLayer;if(F(n,s,!0),s){const l=ne.DataSelections.get(s.id);l?.fields?F(r,new ke([...l.fields]),!0):F(r,new ke,!0)}});function o(){w(),a().ActiveLayer=null}function w(){if(!t(n))return;let s=ne.DataSelections.get(t(n).id);if(s){if((s.fields===void 0||s.fields===null)&&(s.fields=new ke),t(r).size===0){ne.removeSelection(t(n).id);return}s.fields.clear(),t(r).forEach(l=>{s.fields?.add(l)})}}function y(s){t(n)&&(t(r).has(s)?t(r).delete(s):t(r).add(s))}function v(){if(!t(n)?.fields)return;(t(r)?.size||0)===0?t(n).fields.forEach(l=>{t(r).add(l.name)}):t(r).clear()}function f(){return t(n)?.fields?t(n).fields.filter(s=>!e.fieldsToHide?.has(s.alias?.toLowerCase()??"")):[]}var x=R(),g=T(x);{var c=s=>{var l=va();l.__click=[aa,o],l.__keydown=[ra,o];var A=S(l);q(A,()=>dt,(k,h)=>{h(k,{class:"command-card",children:(u,b)=>{var L=ua(),C=T(L);C.__click=o;var W=S(C);un(W,{size:20}),p(C);var P=N(C,2);q(P,()=>Ze,(H,U)=>{U(H,{class:"card-content",children:(B,Q)=>{var m=R(),I=T(m);q(I,()=>vn,(V,M)=>{M(V,{children:(O,G)=>{var $=ca(),te=T($);q(te,()=>fn,(ve,fe)=>{fe(ve,{placeholder:"Search for fields..."})});var Ce=N(te,2);q(Ce,()=>gn,(ve,fe)=>{fe(ve,{children:(we,Me)=>{var Ie=da(),Te=T(Ie);q(Te,()=>hn,(Ve,De)=>{De(Ve,{children:(Pe,bt)=>{ce();var Ae=_e("No results found.");d(Pe,Ae)},$$slots:{default:!0}})});var yt=N(Te,2);q(yt,()=>mn,(Ve,De)=>{De(Ve,{heading:"Fields",children:(Pe,bt)=>{var Ae=la(),Ee=T(Ae),pt=S(Ee);tt(pt,{get checked(){return t(i).checked},get indeterminate(){return t(i).indeterminate},onCheckedChange:v}),ce(2),p(Ee);var Qe=N(Ee,2);q(Qe,()=>qt,(He,se)=>{se(He,{})});var St=N(Qe,2);ue(St,17,f,Ne,(He,se)=>{var Ye=R(),Ct=T(Ye);q(Ct,()=>_n,(xt,kt)=>{kt(xt,{class:"field-item",onselect:()=>y(t(se).name),children:(Nt,Da)=>{var Oe=sa(),Je=S(Oe);{let xe=ee(()=>t(r)?.has(t(se).name)??!1);tt(Je,{class:"field-checkbox",get checked(){return t(xe)},onCheckedChange:()=>y(t(se).name)})}var Re=N(Je,2);Re.__click=[ia,y,se];var Ke=S(Re),Ue=S(Ke),It=S(Ue,!0);p(Ue);var Tt=N(Ue,2);{var At=xe=>{var Fe=oa(),Ft=S(Fe);be(Ft,()=>Xt),p(Fe),j(()=>me(Fe,"title",t(se).description)),d(xe,Fe)};D(Tt,xe=>{t(se).description&&xe(At)})}p(Ke),p(Re),p(Oe),j(()=>ie(It,t(se).alias||t(se).name)),d(Nt,Oe)},$$slots:{default:!0}})}),d(He,Ye)}),d(Pe,Ae)},$$slots:{default:!0}})}),d(we,Ie)},$$slots:{default:!0}})}),d(O,$)},$$slots:{default:!0}})}),d(B,m)},$$slots:{default:!0}})}),d(u,L)},$$slots:{default:!0}})}),p(l),d(s,l)};D(g,s=>{t(n)&&s(c)})}d(_,x),J()}Se(["click","keydown"]);var ga=z('<li class="download-item svelte-vgw5fc"><div class="download-info svelte-vgw5fc"><span class="download-url svelte-vgw5fc"> </span></div> <div class="download-actions svelte-vgw5fc"><div><!></div> <!> <!> <!></div></li>'),ha=z('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),ma=z('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),_a=z('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function wa(_,e){Y(e,!0);let a=E(ae(new Set));function n(g){const c=ye.downloads.findIndex(s=>s.url===g);c!==-1&&ye.downloads.splice(c,1)}async function r(g){try{await navigator.clipboard.writeText(g),F(a,new Set(t(a)).add(g),!0),ge.success("URL copied to clipboard"),setTimeout(()=>{const c=new Set(t(a));c.delete(g),F(a,c,!0)},2e3)}catch(c){console.error("Failed to copy URL:",c),ge.error("Failed to copy URL to clipboard")}}function i(g){switch(g){case"completed":return"#059669";case"in-progress":return"#2563eb";case"failed":return"#dc2626";case"pending":default:return"#6b7280"}}function o(g){switch(g){case"completed":return"Completed";case"in-progress":return"In Progress";case"failed":return"Failed";case"pending":default:return"Pending"}}function w(g){switch(g){case"completed":return Kt;case"in-progress":return Jt;case"failed":return Yt;case"pending":default:return Qt}}var y=_a(),v=N(S(y),2);{var f=g=>{var c=ha(),s=T(c);ue(s,21,()=>ye.downloads,Ne,(k,h)=>{var u=ga(),b=S(u),L=S(b),C=S(L,!0);p(L),p(b);var W=N(b,2),P=S(W),H=S(P);{let I=ee(()=>i(t(h).status));de(H,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${t(I)??""}`},disabled:!0,children:(V,M)=>{const O=ee(()=>w(t(h).status));var G=R(),$=T(G);{let te=ee(()=>t(h).status==="in-progress"?"spinning":"");q($,()=>t(O),(Ce,ve)=>{ve(Ce,{size:14,get class(){return t(te)}})})}d(V,G)},$$slots:{default:!0}})}p(P);var U=N(P,2);de(U,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>r(t(h).url),title:"Copy URL to clipboard",children:(I,V)=>{var M=R(),O=T(M);{var G=te=>{jt(te,{size:14})},$=te=>{Zt(te,{size:14})};D(O,te=>{t(a).has(t(h).url)?te(G):te($,!1)})}d(I,M)},$$slots:{default:!0}});var B=N(U,2);{var Q=I=>{de(I,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(t(h).url,"_blank"),title:"Open download",children:(V,M)=>{ce();var O=_e("📥");d(V,O)},$$slots:{default:!0}})};D(B,I=>{t(h).status==="completed"&&I(Q)})}var m=N(B,2);de(m,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>n(t(h).url),title:"Remove from queue",children:(I,V)=>{ce();var M=_e("×");d(I,M)},$$slots:{default:!0}}),p(W),p(u),j(I=>{me(L,"title",t(h).url),ie(C,t(h).id),me(P,"title",I)},[()=>o(t(h).status)]),d(k,u)}),p(s);var l=N(s,2),A=S(l);p(l),j(()=>ie(A,`${ye.downloads.length??""} download(s) in queue`)),d(g,c)},x=g=>{var c=ma();d(g,c)};D(v,g=>{ye.downloads.length>0?g(f):g(x,!1)})}p(y),d(_,y),J()}var ya=z('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ot(_,e){Y(e,!0);const a=Z(e,"isFolder",3,!1),n=Z(e,"isOpen",3,!1),r=`calc(100% - ${e.depth*1}rem)`;var i=ya();i.__click=function(...l){e.onclick?.apply(this,l)};var o=S(i),w=S(o),y=S(w);{var v=l=>{st(l,{get isOpen(){return n()}})};D(y,l=>{a()&&l(v)})}var f=N(y,2),x=S(f);be(x,()=>e.icon),p(f);var g=N(f,2),c=S(g,!0);p(g),p(w);var s=N(w,2);oe(s,()=>e.children??le),p(o),p(i),j(l=>{pe(i,1,l),he(i,`width: ${r};`),ie(c,e.name)},[()=>an(Fn({enhancedHover:!0,includeFont:!0}))]),d(_,i),J()}Se(["click"]);function ba(_,e,a){_.stopPropagation(),F(e,!t(e)),a.onDownloadStateChanged?.(a.node,t(e))}var pa=z("<button><!></button>");function Sa(_,e){Y(e,!0);let a=E(ae(e.getDownloadState?.(e.node)??!1));K(()=>{if(e.getDownloadState){const o=e.getDownloadState(e.node);F(a,o??!1,!0)}});var n=pa();let r;n.__click=[ba,a,e];var i=S(n);be(i,()=>$t),p(n),j(o=>{r=pe(n,1,"download-btn svelte-zg9ffb",null,r,o),me(n,"title",`Download ${e.node.name??""}`),me(n,"aria-label",`Download ${e.node.name??""}`),me(n,"aria-pressed",t(a))},[()=>({active:t(a)})]),d(_,n),J()}Se(["click"]);var Ca=z('<div class="flex items-center gap-2"><!></div>'),xa=z("<div><!></div>"),ka=z("<!> <!>",1),Na=z('<div class="flex items-center gap-2"><!> <!></div>');function wt(_,e){Y(e,!0);const a=k=>{var h=R(),u=T(h);{var b=L=>{var C=R(),W=T(C);{var P=U=>{ot(U,{get icon(){return t(x)},get name(){return e.node.name},get depth(){return i()},onclick:A,get isFolder(){return w},get isOpen(){return t(v)},children:Q=>{var m=Ca(),I=S(m);{var V=M=>{nt(M,{get checked(){return t(f)},onCheckedChange:s})};D(I,M=>{y&&M(V)})}p(m),d(Q,m)},$$slots:{default:!0}})},H=U=>{ot(U,{get icon(){return t(x)},get name(){return e.node.name},get depth(){return i()},onclick:l,get isFolder(){return w},children:Q=>{var m=Na(),I=S(m);{var V=G=>{var $=ka(),te=T($);{var Ce=fe=>{var we=xa();let Me;var Ie=S(we);_t(Ie,{get layerId(){return e.node.id},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied}}),p(we),j(Te=>Me=pe(we,1,"filter-transition-wrapper svelte-kvoyne",null,Me,Te),[()=>({"fade-in":!t(c),"fade-out":t(c)})]),d(fe,we)};D(te,fe=>{t(g)&&fe(Ce)})}var ve=N(te,2);Sa(ve,{get node(){return e.node},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState}}),d(G,$)};D(I,G=>{e.isDownloadable&&G(V)})}var M=N(I,2);{var O=G=>{nt(G,{get checked(){return t(f)},onCheckedChange:s})};D(M,G=>{y&&G(O)})}p(m),d(Q,m)},$$slots:{default:!0}})};D(W,U=>{w?U(P):U(H,!1)})}d(L,C)};D(u,L=>{r()?.getItemConfig(e.node.id)?.isHidden||L(b)})}d(k,h)},n=(k,h=le)=>{var u=R(),b=T(u);{var L=C=>{{let W=ee(()=>r()?.getItemConfig(h().id)?.isDownloadable??!0),P=ee(()=>i()+1);wt(C,{get treeviewConfigStore(){return r()},get node(){return h()},get isDownloadable(){return t(W)},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return t(P)},get useLayerTypeIcon(){return o()}})}};D(b,C=>{w&&t(v)&&!r()?.getItemConfig(h().id)?.isHidden&&C(L)})}d(k,u)},r=Z(e,"treeviewConfigStore",3,null),i=Z(e,"depth",3,0),o=Z(e,"useLayerTypeIcon",3,!1),w=!!(e.node.children&&e.node.children.length),y=!w;let v=E(!1),f=E(!1),x=E(""),g=E(!1),c=E(!1);K(()=>{if(!e.node)return;const k=e.getNodeVisibility?e.getNodeVisibility(e.node.id):!1;F(f,k??!1,!0),e.node instanceof re&&F(x,gt(e.node.layer,o(),w,t(v)),!0)}),K(()=>{if(!(e.node instanceof re))return;const k=(e.getDownloadState?.(e.node)&&e.node.layer.type==="feature")??!1;k&&!t(g)?(F(g,!0),F(c,!1)):!k&&t(g)&&(F(c,!0),setTimeout(()=>{F(g,!1),F(c,!1)},180))});function s(){!y||!e.onNodeVisibilityChange||(F(f,!t(f)),e.onNodeVisibilityChange(e.node,t(f)))}function l(){e.onNodeClick?.(e.node)}function A(){F(v,!t(v)),e.onNodeClick?.(e.node)}{let k=ee(()=>w?e.node.children:null);ct(_,{get isOpen(){return t(v)},get content(){return a},get childNodes(){return t(k)},get childNode(){return n}})}J()}function Ia(_,e){Y(e,!0);const a=Z(e,"webMap",3,null),n=Z(e,"fieldFilterMenuStore",7),r=new mt;K(()=>{if(!a()||r.initialized)return;(async()=>{await a().when(),await i(a().layers.toArray()),console.log("[data-selection-tree-view] fields to hide:",e.fieldsToHide),r.initialize(a().layers.toArray(),e.treeviewConfigStore,e.fieldsToHide),console.log("[data-selection-tree-view] Initialized with layers:",r.getNodes())})()});async function i(c){for(const s of c)s.type==="feature"&&!s.loaded&&(await s.load(),console.log("Loaded feature layer:",s.title)),s.type==="group"&&await i(s.layers.toArray())}function o(c,s){if(!s){ne.removeSelection(c.id);return}if(!(c instanceof re))return;const l={layerId:c.id,name:c.layer.title||"",fields:new ke(c.layer.fields?.map(A=>A.name)||[])};ne.addSelection(l)}function w(c){return ne.DataSelections.has(c.id)}function y(c){if(n().ActiveLayer?.uid===c){n().ActiveLayer=null;return}const l=r.getNodeById(c);!l||!(l instanceof re)||(n().ActiveLayer=l.layer)}function v(c){const s=ne.DataSelections.get(c);if(!s?.fields)return!1;const l=r.getNodeById(c);if(!l||!(l instanceof re))return!1;const A=l.layer.fields?.length||0,k=s.fields.size;return k>0&&k!==A}var f=R(),x=T(f);{var g=c=>{var s=R(),l=T(s);q(l,()=>lt,(A,k)=>{k(A,{children:(h,u)=>{var b=R(),L=T(b);ue(L,17,()=>r.getNodes(),C=>C.id,(C,W)=>{{let P=ee(()=>e.treeviewConfigStore.getItemConfig(t(W).id)?.isDownloadable??!1);wt(C,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return t(W)},get isDownloadable(){return t(P)},onNodeClick:()=>{},onNodeVisibilityChange:(H,U)=>r.setVisibilityState(H.id,U),getNodeVisibility:H=>r.getVisibilityState(H),onDownloadStateChanged:o,getDownloadState:w,onFilterClicked:y,hasFiltersApplied:v,depth:0,useLayerTypeIcon:!0})}}),d(h,b)},$$slots:{default:!0}})}),d(c,s)};D(x,c=>{r.initialized&&c(g)})}d(_,f),J()}const Ta=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];function Aa(_,e,a,n,r){if(!e.isOpen)return;F(a,!0),_.preventDefault();const i=_.clientX,o=t(n);function w(v){const f=v.clientX-i,x=Math.max(t(r),o+f);F(n,x,!0)}function y(){F(a,!1),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",y),document.body.style.cursor="",document.body.style.userSelect=""}document.addEventListener("mousemove",w),document.addEventListener("mouseup",y),document.body.style.cursor="ew-resize",document.body.style.userSelect="none"}var Fa=z('<button class="absolute top-0 h-full cursor-ew-resize border-0 bg-transparent p-0 transition-colors hover:bg-primary/50" aria-label="Resize sidebar by dragging" tabindex="-1"></button>'),za=z('<!> <aside><div class="flex h-full w-full flex-col"><div class="flex-1 overflow-x-hidden overflow-y-auto p-4"><!></div></div> <!></aside>',1);function La(_,e){Y(e,!0);const a=Z(e,"minWidth",3,"500px");let n,r=E(0),i=E(ae(parseFloat(a()))),o=E(!1);const w=ee(()=>parseFloat(a()));je(()=>{if(!n)return;const h=new ResizeObserver(u=>{for(const b of u)F(r,b.contentRect.width,!0)});return h.observe(n),()=>{h.disconnect()}});var y=za(),v=T(y);{let h=ee(()=>e.isOpen?"Close sidebar":"Open sidebar");de(v,{get onclick(){return e.onToggle},variant:"default",size:"icon",class:"fixed z-[2] rounded-l-none rounded-r-md shadow-lg hover:scale-105",get style(){return`top: calc(var(--header-height, 64px) + 1rem); left: ${t(r)??""}px; pointer-events: auto; transition: transform 200ms, background-color 200ms;`},get"aria-label"(){return t(h)},get"aria-expanded"(){return e.isOpen},children:(u,b)=>{var L=R(),C=T(L);{var W=H=>{yn(H,{class:"h-6 w-6"})},P=H=>{bn(H,{class:"h-6 w-6"})};D(C,H=>{e.isOpen?H(W):H(P,!1)})}d(u,L)},$$slots:{default:!0}})}var f=N(v,2);let x;var g=S(f),c=S(g);he(c,"padding-right: 16px;");var s=S(c);{var l=h=>{var u=R(),b=T(u);oe(b,()=>e.children),d(h,u)};D(s,h=>{e.children&&h(l)})}p(c),p(g);var A=N(g,2);{var k=h=>{var u=Fa();u.__mousedown=[Aa,e,o,i,w],he(u,"width: 8px; right: -4px;"),d(h,u)};D(A,h=>{e.isOpen&&h(k)})}p(f),Le(f,h=>n=h,()=>n),j(h=>{x=pe(f,1,"relative flex h-full flex-col border-r border-sidebar-border bg-card text-card-foreground shadow-lg ease-in-out",null,x,h),he(f,`width: ${e.isOpen?`${t(i)}px`:"0"}; overflow: hidden;`)},[()=>({"transition-all":!t(o),"duration-300":!t(o)})]),d(_,y),J()}Se(["mousedown"]);var Ma=z("<!> <!> <!> <!>",1),Va=z('<!> <!> <!> <!> <div class="layout-container svelte-1xwk4vv"><!> <div class="map-section svelte-1xwk4vv"><!></div></div>',1);function er(_,e){Y(e,!0);const a=ae(new en),n=ae(new tn),r=ae(new mt);let i=E("define-areas"),o=E(ae(new Set)),w=E(void 0),y=E(void 0),v=E(!0);function f(){F(v,!t(v))}je(async()=>{const C=await wn();F(o,new Set(C.fieldsToHide||[]),!0),X.setNameFields(C.selectionLayersNameFields||[]),F(w,new at(C.dataSelectionTreeviewConfig),!0),F(y,new at(C.areaSelectionTreeviewConfig),!0),await a.initializeAsync({portalUrl:C.portalUrl,itemId:C.portalItemId||"",proxy:C.proxy}),console.log("[page] WebMap loaded")});function x(C){F(i,C,!0)}function g(){F(i,"downloads")}var c=Va(),s=T(c);nn(s,{});var l=N(s,2);na(l,{});var A=N(l,2);fa(A,{get fieldFilterMenuStore(){return n},get fieldsToHide(){return t(o)}});var k=N(A,2);Pn(k,{});var h=N(k,2),u=S(h);La(u,{get isOpen(){return t(v)},onToggle:f,children:(C,W)=>{On(C,{get value(){return t(i)},get triggers(){return Ta},onValueChange:x,children:(P,H)=>{var U=Ma(),B=T(U);ze(B,{value:"define-areas",children:(V,M)=>{Dn(V,{get webMap(){return a.data},get treeviewStore(){return r},get treeviewConfigStore(){return t(y)}})}});var Q=N(B,2);ze(Q,{value:"select-data",children:(V,M)=>{Ia(V,{get webMap(){return a.data},get treeviewConfigStore(){return t(w)},get fieldsToHide(){return t(o)},get fieldFilterMenuStore(){return n}})}});var m=N(Q,2);ze(m,{value:"export",footer:M=>{$n(M,{onExportSuccess:g})},children:(M,O)=>{Jn(M,{get webMapStore(){return a},get areaSelectionTreeviewStore(){return r},get fieldFilterMenuStore(){return n}})}});var I=N(m,2);ze(I,{value:"downloads",children:(V,M)=>{wa(V,{})}}),d(P,U)},$$slots:{default:!0}})},$$slots:{default:!0}});var b=N(u,2),L=S(b);kn(L,{get webMap(){return a.data},get areaSelectionTreeviewStore(){return r},panelPosition:"top-left",menuPosition:"top-right"}),p(b),p(h),d(_,c),J()}export{er as component};
