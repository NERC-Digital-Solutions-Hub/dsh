const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CyrEfJff.js","../chunks/iFuBOtDF.js","../chunks/DHq0rblm.js","../chunks/BfhsIlKo.js","../chunks/faKFIXLZ.js","../chunks/D9Z9MdNV.js","../chunks/pCx8oau_.js","../chunks/BgvLO-3W.js","../chunks/CBG-jaYw.js","../chunks/C8PpcA25.js","../chunks/DhdgDebw.js","../chunks/Dt5YSiFI.js","../chunks/C1yg1qUQ.js","../chunks/LE72oyNN.js","../chunks/CYi2TAj9.js","../chunks/DgwIrkEl.js","../chunks/DmWTBsn2.js","../chunks/BwKptEmm.js","../chunks/CCzk6ARw.js","../chunks/Dvbl4r8A.js","../chunks/gRIb6kZn.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/Bvto7RYj.js","../chunks/BOB_xkBk.js","../chunks/DFQ1ZjBx.js","../chunks/Cl5lrJ4c.js","../chunks/B0LmsqEq.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/C4HJhmWz.js","../chunks/CDl12u7R.js","../chunks/DYJGs4je.js","../chunks/Djp3mnm5.js","../chunks/Bso-6bUH.js","../chunks/DQOJ18NT.js","../chunks/CLto_E8U.js","../chunks/CxFnk1MP.js","../chunks/D5ew8ajr.js","../chunks/B4aqFq2B.js","../chunks/EzLf78vY.js","../chunks/BPhm6YV-.js","../chunks/BkA6azLD.js","../chunks/hXVs3T0e.js","../chunks/Dytf6RTV.js","../chunks/9YvG7tFv.js","../chunks/B-VZ3wrL.js","../chunks/CaNAmI22.js","../chunks/aQeO9QTD.js","../chunks/BDqMdsvZ.js","../chunks/DJTyCEHv.js","../chunks/BMX0GFJS.js","../chunks/CsLyQp38.js","../chunks/ETfT8J3h.js","../chunks/BQ2D4CO5.js","../chunks/DZd6gJy7.js","../chunks/C7x2MF0l.js","../chunks/C8BmVxiO.js","../chunks/Cr2KJ5IK.js","../chunks/CJ_83qNO.js","../chunks/Ck-szKz5.js","../chunks/BxD4MBPA.js","../chunks/Banwpgrz.js","../chunks/cw1rsUFH.js","../chunks/C0pjifF4.js","../chunks/ok2Sqpw2.js","../chunks/Chk7YAAL.js","../chunks/D0t3l1UW.js","../chunks/Cgb6qxNH.js","../chunks/DsnVlOka.js","../chunks/CrwPCMe2.js","../chunks/QQC62dOK.js","../chunks/C51QhSzO.js","../chunks/BdLvjJaM.js","../chunks/BaYj2Wow.js","../chunks/DphnWQ0e.js","../chunks/DKpmsPfl.js","../chunks/B9RJBcJ2.js","../chunks/8WNRLB3q.js","../chunks/B1N-tmtC.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/Cf9zLCCH.js","../chunks/pDuGEAnG.js","../chunks/CMaiVHma.js","../chunks/BrScpkSj.js","../chunks/rxpTDz6e.js","../chunks/Dl1orkLD.js","../chunks/D_pI6fQj.js","../chunks/zFNEK25s.js","../chunks/CL2NbQte.js","../chunks/D_JYBHfY.js","../chunks/Cvs00xeJ.js","../chunks/Duu7_u0O.js","../chunks/Dmk_Dxvx.js","../chunks/C5CzMsLd.js","../chunks/pyb07plo.js","../chunks/BRLX27Af.js","../chunks/C8NkvdGB.js","../chunks/Cxihbb8M.js","../chunks/BYV4nsB9.js","../chunks/DQ_sR0Oz.js","../chunks/DbyYraQc.js","../chunks/Dj4-5pgM.js","../chunks/BY6Wrw2B.js","../chunks/D-j7oGrU.js","../chunks/ChTYeCcj.js","../chunks/QOzMNXdI.js","../chunks/DoDP5r3i.js","../chunks/GKolV7NZ.js","../chunks/Bs6tEc1N.js","../chunks/DadzvVj2.js","../chunks/BUd8m5s5.js","../chunks/vIRtxQoE.js","../chunks/BeKBFCJY.js","../chunks/4c7MyKAz.js","../chunks/BpFwjkk6.js","../chunks/Glnbxn3o.js","../chunks/DZ__J_Ha.js","../chunks/VMSlSy0z.js","../chunks/DkkI5QKs.js","../chunks/C3cxdwvi.js","../chunks/CTc4Bt11.js","../chunks/pdT4reVn.js","../chunks/D0yCzUdH.js","../chunks/BiM6pph8.js","../chunks/DA_X7pFa.js","../chunks/B_DLPStx.js","../chunks/CZnF4aA7.js","../chunks/CGwv2ov9.js","../chunks/DRnuuSv_.js","../chunks/CGe7GMdJ.js","../chunks/B3MXpedj.js","../chunks/B6WMH48X.js","../chunks/B1pCqEo_.js","../chunks/BrYzRPrF.js","../chunks/Bg3hnFg2.js","../chunks/DYzr77oO.js","../chunks/CMq8eZcm.js","../chunks/N_B-5EBV.js","../chunks/u5nA3ppO.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/4ef240Er.js","../chunks/CXd_PekB.js","../chunks/CNJBC4J4.js","../chunks/Dz-aVBgt.js","../chunks/Bs354Zoz.js","../chunks/CfrNlpsM.js","../chunks/DdSLmJ2d.js","../chunks/BS3H3l-F.js","../chunks/DCdj6Lab.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/CY_HuWbD.js","../chunks/D1FCtSgh.js","../chunks/kAKGzqpF.js","../chunks/C5PvpwSg.js","../chunks/BsB-6bk9.js","../chunks/CaNUsX_h.js","../chunks/CaqllLde.js","../chunks/D7knBxw1.js","../chunks/COKPF4Dy.js","../chunks/BT3t3G5h.js","../chunks/BjiS_nfk.js","../chunks/DvcDHnyV.js","../chunks/DbEhBJ1e.js","../chunks/D9LchIWm.js","../chunks/BK2emRUs.js","../chunks/DnIiJOoS.js","../chunks/DsHDw-MJ.js"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{o as Ze,a as Mt}from"../chunks/CwlFPufh.js";import{c as U,b as A,a as c,Z as Q,u as J,H as t,aG as P,f as F,a0 as Y,ah as I,ao as z,a4 as S,a6 as b,a5 as le,a1 as X,aH as ee,at as ae,n as ce,aI as we}from"../chunks/J6Bl3sxN.js";import{_ as Ge}from"../chunks/D9Z9MdNV.js";import{l as Vt,s as Lt,p as Z,i as D,a as Dt,b as Pt}from"../chunks/_fywD1i8.js";import{s as oe}from"../chunks/CdsLSXyK.js";import{b as Ve}from"../chunks/RQ99CAyZ.js";import{m as qe,a as j,O as st,T as Et,G as et,F as tt,b as Ot,c as lt,t as ge,d as Ht,e as Ut,f as Rt,g as Bt,h as Wt,i as Gt,j as ne,k as ye,p as qt,S as ke,C as nt,l as jt,I as Xt,n as Zt,o as Kt,q as Qt,r as Yt,L as Jt,s as $t,D as en,V as rt,W as tn,u as nn,v as rn,w as at}from"../chunks/KAY0K1dZ.js";import{B as ue,o as ze,F as Ne}from"../chunks/D-afBJkb.js";import{c as q}from"../chunks/D5NabK7e.js";import{e as he,d as pe,s as me,b as an}from"../chunks/BYOkOkBz.js";import{s as ie}from"../chunks/D8EIH3Is.js";import{h as be}from"../chunks/piBjdR0k.js";import{d as Se}from"../chunks/0Hj017KB.js";import{I as on,s as sn,C as ln,b as Ke,S as dn,c as cn,d as un,a as dt,X as vn,e as fn,f as gn,g as hn,h as mn,i as wn,j as _n,k as yn}from"../chunks/DV2d5gb9.js";import{B as de}from"../chunks/hcL2bxKX.js";import{X as bn}from"../chunks/VfCdEW56.js";import"../chunks/BEqW7Zwo.js";function pn(w,e){const r=Vt(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const n=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];on(w,Lt({name:"menu"},()=>r,{get iconNode(){return n},children:(a,i)=>{var o=U(),g=A(o);sn(g,e,"default",{}),c(a,o)},$$slots:{default:!0}}))}class ct{id;name;children;parent;constructor(e,r,n=[],a=null){this.id=e,this.name=r,this.children=n,this.parent=a}}class re extends ct{layer;constructor(e,r,n,a=[],i=null){super(e,r,a,i),this.layer=n}}class Le extends re{featureLayer;field;constructor(e,r,n,a,i=[],o=null){super(e,r,n,i,o),this.field=a,this.featureLayer=n}}var Sn=F('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),Cn=F('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),xn=F('<div class="map-view svelte-i0p9uk"></div> <!> <!>',1);function kn(w,e){Q(e,!0);const r=Z(e,"webMap",3,null),n=Z(e,"panelPosition",3,"top-left"),a=Z(e,"menuPosition",3,"top-right");let i=null,o=P(null),g=P(null),m=P(null),v=P(!1);const h="streets-vector";let C,u;async function d(){if(!u){const[{default:y},{default:x},{default:L}]=await Promise.all([Ge(()=>import("../chunks/CyrEfJff.js").then(O=>O.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url),Ge(()=>import("../chunks/D5ew8ajr.js").then(O=>O.a3),__vite__mapDeps([38,1,2,3,5,39,24,6,7,22,40,41,42,43,8,9,10,11,44,23,20,21,45,46,47,48,12,13,49,50,51,25,52,53,17,32,54,55,56,26,57,58,15,59,0,4,14,16,18,19,27,28,29,30,31,33,34,35,36,37,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86]),import.meta.url),Ge(()=>import("../chunks/Dl1orkLD.js").then(O=>O.W),__vite__mapDeps([87,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,88,89,90,91,62,92,93,74,75,65,94,95,96,61,97,98,99,100,64,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,52,53,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171]),import.meta.url)]);C=y,u=x}}async function l(y,x){const L=new u({container:x,popupEnabled:!1,map:y});return await L.when(),L}function s(y){y.ui.move("zoom","top-right"),t(g)&&n()&&y.ui.add(t(g),n()),t(m)&&a()&&y.ui.add(t(m),a()),z(v,!0)}async function N(y){const x=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(L=>L.id);console.log("[uprn-map-view] Initializing map interactions with layers:",x),await qe.initializeAsync(y,new Set(x))}async function k(){return new C({basemap:h})}Ze(async()=>{await d(),await f()});async function _(){if(r())try{if(await d(),await f(),!t(o)){console.error("MapView is not initialized");return}t(o).map=r(),await r().when(),console.log("[uprn-map-view] MapView updated with new webMap")}catch(y){console.error("Error updating MapView with new webMap:",y)}}J(()=>{r()&&_()});async function f(){if(!i){console.error("Map container element was not found");return}try{z(o,await l(r()??void 0,i),!0),await N(t(o)),s(t(o)),console.log("[uprn-map-view] Map loaded successfully")}catch(y){console.error("Error loading map:",y),await p()}}async function p(){try{const y=await k();z(o,await l(y,i),!0),await N(t(o)),s(t(o)),console.log("[uprn-map-view] Fallback map loaded")}catch(y){console.error("Error loading fallback map:",y)}}J(()=>{if(!t(o)||!e.areaSelectionTreeviewStore.initialized)return;const y=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(x=>x.id);qe.updateInteractableLayers(new Set(y))});async function T(y){if(!t(o))return;const x=await t(o).whenLayerView(y);if(!x){console.warn("Could not get LayerView for the visible node layer");return}j.setSelectedLayerView(x)}J(()=>{if(!e.areaSelectionTreeviewStore.initialized)return;if(!e.areaSelectionTreeviewStore.getVisibleNodes().length){j.resetSelectedAreas();return}const y=e.areaSelectionTreeviewStore.getVisibleNodes()[0];if(!y||!(y instanceof re)||!(y.layer instanceof __esri.FeatureLayer)){console.warn("Visible node is not a FeatureLayer");return}if(!y.layer){console.warn("Visible node layer is not a FeatureLayer");return}T(y.layer)});function M(){qe.cleanup(),t(o)&&t(o).destroy()}Mt(()=>{M()});var R=xn(),E=A(R);Ve(E,y=>i=y,()=>i);var V=I(E,2);{var B=y=>{var x=Sn(),L=S(x);{var O=H=>{var G=U(),$=A(G);oe($,()=>e.panel),c(H,G)};D(L,H=>{t(v)&&H(O)})}b(x),Ve(x,H=>z(g,H),()=>t(g)),c(y,x)};D(V,y=>{e.panel&&y(B)})}var W=I(V,2);{var K=y=>{var x=Cn(),L=S(x);{var O=H=>{var G=U(),$=A(G);oe($,()=>e.menu),c(H,G)};D(L,H=>{t(v)&&H(O)})}b(x),Ve(x,H=>z(m,H),()=>t(m)),c(y,x)};D(W,y=>{e.menu&&y(K)})}c(w,R),Y()}var Nn=F('<div class="tree-node-item svelte-1x7dzzd"><!></div>'),In=F('<div class="tree-children relative ml-4 w-full svelte-1x7dzzd"><div class="tree-guide-line tree-guide-line-animate svelte-1x7dzzd"></div> <!></div>'),Tn=F('<div class="w-full"><!>  <!></div>');function ut(w,e){const r=Z(e,"isOpen",3,!1),n=Z(e,"childNodes",3,null);var a=Tn(),i=S(a);oe(i,()=>e.content??le);var o=I(i,2);{var g=m=>{var v=In(),h=I(S(v),2);ue(h,19,()=>n()??[],C=>C.id,(C,u,d)=>{var l=Nn(),s=S(l);oe(s,()=>e.childNode??le,()=>t(u)),b(l),X(()=>he(l,`animation-delay: ${100+t(d)*50}ms;`)),c(C,l)}),b(v),c(m,v)};D(o,m=>{r()&&n()&&m(g)})}b(a),c(w,a)}const vt="mb-1 cursor-pointer rounded-md border border-border/30 p-2 text-left",ft="transform-gpu transition-all duration-150 ease-out hover:border-border/50 hover:bg-card/70 hover:shadow-sm",An="transition-colors hover:bg-card/70",je="text-sm font-normal",Xe="bg-card/50",gt="bg-accent text-accent-foreground";function Fn(w){const{enhancedHover:e=!1,includeFont:r=!1,pressed:n=!1}=w;let a=vt;return e?a+=" "+ft:a+=" "+An,r&&(a+=" "+je),n?a+=" "+gt:a+=" "+Xe,a}const zn="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";var Mn=F('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),Vn=F('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function it(w,e){const r=`calc(100% - ${e.depth*1}rem)`,n=`${vt} ${ft}`,a=`${n} ${zn} ${Xe} ${je}`,i=`${n} ${je}`;var o=U(),g=A(o);{var m=h=>{Et(h,{get pressed(){return e.pressed},get class(){return a},variant:"outline",get style(){return`width: ${r};`},get onPressedChange(){return e.onclick},children:(C,u)=>{var d=Mn(),l=S(d),s=S(l),N=S(s);be(N,()=>e.icon),b(s);var k=I(s,2),_=S(k,!0);b(k),b(l);var f=I(l,2);oe(f,()=>e.children??le),b(d),X(()=>ie(_,e.name)),c(C,d)},$$slots:{default:!0}})},v=h=>{var C=Vn();C.__click=function(...p){e.onclick?.apply(this,p)};var u=S(C),d=S(u),l=S(d);st(l,{get isOpen(){return e.isOpen}});var s=I(l,2),N=S(s);be(N,()=>e.icon),b(s);var k=I(s,2),_=S(k,!0);b(k),b(d);var f=I(d,2);oe(f,()=>e.children??le),b(u),b(C),X(()=>{pe(C,1,`${i} ${e.pressed?gt:Xe}`),he(C,`width: ${r};`),ie(_,e.name)}),c(h,C)};D(g,h=>{e.isTogglable?h(m):h(v,!1)})}c(w,o)}Se(["click"]);const ht=(w,e,r,n)=>e?Ln(w,r):r?n?'<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',Ln=(w,e)=>{switch(w.type){case"group":return et;case"feature":return tt;case"tile":return Ot;default:return e?et:tt}};function mt(w,e){Q(e,!0);const r=s=>{var N=U(),k=A(N);{var _=f=>{var p=U(),T=A(p);{var M=E=>{it(E,{isTogglable:!1,get pressed(){return t(v)},get icon(){return t(h)},get name(){return e.node.name},get depth(){return a()},onclick:l,get isOpen(){return t(m)}})},R=E=>{it(E,{isTogglable:!0,get pressed(){return t(v)},get icon(){return t(h)},get name(){return e.node.name},get depth(){return a()},onclick:d,get isOpen(){return t(m)}})};D(T,E=>{g?E(M):E(R,!1)})}c(f,p)};D(k,f=>{e.treeviewConfigStore.getItemConfig(e.node.id)?.isHidden||f(_)})}c(s,N)},n=(s,N=le)=>{var k=U(),_=A(k);{var f=p=>{{let T=ee(()=>a()+1);mt(p,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return N()},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return t(T)},get useLayerTypeIcon(){return i()}})}};D(_,p=>{g&&t(m)&&!e.treeviewConfigStore.getItemConfig(N().id)?.isHidden&&p(f)})}c(s,k)},a=Z(e,"depth",3,0),i=Z(e,"useLayerTypeIcon",3,!1),o=!!e.node.layer&&"visible"in e.node.layer,g=!!(e.node.children&&e.node.children.length);let m=P(!1),v=P(!1),h=P("");function C(){return!e.node.children||!e.getNodeVisibility?!1:e.node.children.some(s=>{const N=e.getNodeVisibility(s.id);return N!==void 0?N:s.layer.visible})}J(()=>{if(e.node){if(g)z(v,C(),!0);else{const s=e.getNodeVisibility?e.getNodeVisibility(e.node.id):void 0;z(v,s!==void 0?s:e.node.layer.visible,!0)}z(h,ht(e.node.layer,i(),g,t(m)),!0)}});function u(){!o||!e.onNodeVisibilityChange||g||(z(v,!t(v)),e.onNodeVisibilityChange(e.node,t(v)))}function d(){g||u(),e.onNodeClick?.(e.node)}function l(){z(m,!t(m)),e.onNodeClick?.(e.node)}{let s=ee(()=>g?e.node.children:null);ut(w,{get isOpen(){return t(m)},get content(){return r},get childNodes(){return t(s)},get childNode(){return n}})}Y()}class wt{#s=P(!1);get initialized(){return t(this.#s)}set initialized(e){z(this.#s,e,!0)}#e=null;#r=P(ae([]));#i=ee(()=>{const e=new ze;return this.#h(t(this.#r),e),e});#t=P(ae(new ze));#c=P(ae(new ze));#l=P(ae(new ze));initialize(e,r,n){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!r)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#e=r,n)for(const a of n)t(this.#l).set(a.id,a);if(!e)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#w(e),z(this.#r,this.#_(e),!0)}getNodeById(e){return this.#n(),t(this.#i).get(e)}getNodes(){return this.#n(),t(this.#r)}getVisibleNodes(){this.#n();const e=[];for(const[r,n]of t(this.#t)){if(!n)continue;const a=t(this.#i).get(r);a&&e.push(a)}return e}getNonHiddenNodes(){return this.#n(),this.#u(t(this.#r))}#u(e){this.#n();const r=[];for(const n of e){const a=this.#a(n.id);if(!(a&&a.isHidden)&&(r.push(n),n.children?.length)){const i=this.#u(n.children);r.push(...i)}}return r}getVisibilityState(e){return this.#n(),t(this.#t).get(e)??!1}setVisibilityState(e,r){this.#n();const n=t(this.#i).get(e);if(!n)throw new Error(`Tree node not found for ID: ${e}`);if(!(n instanceof re))throw new Error(`Tree node is not a layer node: ${e}`);t(this.#t).set(e,r),n.layer.visible=r,n instanceof Le&&(n.featureLayer.displayField=r?n.field.name:""),this.#o(n,r);const a=this.#a(e);if(!a||a.isHidden||(a.visibilityDependencyIds?.length&&this.#d(n,r),!a.visibilityGroupId))return;const i=a.visibilityGroupId;console.log(`Node ${e} is part of visibility group ${i}`);let o=t(this.#c).get(i);o||(o=[],t(this.#c).set(i,o));const g=this.#m(i);if(!g)throw new Error(`Visibility group config not found for group ID: ${i}`);if(!r){const v=o.indexOf(e);o.splice(v,1);return}const m=v=>{t(this.#t).set(v,!1);const h=t(this.#i).get(v);if(h&&h instanceof re){h.layer.visible=!1,this.#o(h,!1);const u=this.#a(v);u&&u.visibilityDependencyIds?.length&&this.#d(h,!1)}const C=o.indexOf(v);C>=0&&o.splice(C,1)};for(;o.length>=g.maxVisibleLayers;){const v=o[0];m(v)}o.push(e),this.#o(n,r),a.visibilityDependencyIds?.length&&this.#d(n,r)}#o(e,r){const n=e.parent;!n||!(n instanceof re)||(t(this.#t).set(n.id,r),n.layer.visible=r,this.#o(n,r))}#d(e,r){const n=this.#a(e.id);if(n&&n.visibilityDependencyIds?.length)for(const a of n.visibilityDependencyIds){const i=t(this.#i).get(a);i&&i instanceof re&&(t(this.#t).set(a,r),i.layer.visible=r,this.#o(i,r))}}#m(e){if(e&&this.#e)return this.#e.getVisibilityGroupConfig(e)}#w(e){this.#e&&this.#e.resolveInheritance(e)}#_(e){const r=e.map(n=>this.#f(n,void 0));return this.#v([...r])}#a(e){if(e&&this.#e)return this.#e.getItemConfig(e)}#v(e){e.reverse();for(const r of e)r.children?.length&&this.#v(r.children);return e}#f(e,r){const n=this.#a(e.id);if(n&&n.customConverterId){if(!t(this.#l).has(n.customConverterId))throw new Error(`Custom converter not found: ${n.customConverterId}`);const i=t(this.#l).get(n.customConverterId);if(!i)throw new Error(`Custom converter not found: ${n.customConverterId}`);return i.layerToNode(e,r??null)}const a=new re(e.id,e.title,e,[],r);if(e.visible=n?.isVisibleOnInit??!1,t(this.#t).set(e.id,e.visible),this.#C(e)&&n?.showFields){const i=e;i.loaded||console.warn(`Layer not loaded: ${e.id}`);for(const o of i.fields??[]){const g=this.#y(o,a);a.children.push(g)}}if(this.#S(e)){const i=e;return a.children=i.layers.toArray().map(o=>this.#f(o,a)),a}if(this.#b(e)){const i=e;if(i.sublayers&&i.sublayers.length>0){const o=i.sublayers;a.children=o.toArray().map(this.#g)}}return a}#y(e,r){const n=this.#p(r.id,e.name),a=new Le(n,e.alias||e.name,r.layer,e,[],r),i=this.#a(n);return t(this.#t).set(n,i?.isVisibleOnInit??!1),a}#b(e){return e.type==="map-image"||e.type==="wms"}#g(e){const r=new re(e.uid,e.title,e);return e.sublayers?.length&&(r.children=e.sublayers.toArray().map(this.#g)),r}#h(e,r){for(const n of e)r.set(n.id,n),n.children?.length&&this.#h(n.children,r)}#p(e,r){return`${e}-${r}`}#S(e){return e.type==="group"}#C(e){return e.type==="feature"}#n(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}function Dn(w,e){Q(e,!0);const r=Z(e,"webMap",3,null);J(()=>{!r()||e.treeviewStore.initialized||e.treeviewStore.initialize(r().layers.toArray(),e.treeviewConfigStore)});var n=U(),a=A(n);{var i=o=>{var g=U(),m=A(g);q(m,()=>lt,(v,h)=>{h(v,{children:(C,u)=>{var d=U(),l=A(d);ue(l,17,()=>e.treeviewStore.getNodes(),s=>s.id,(s,N)=>{mt(s,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return t(N)},onNodeClick:()=>{},onNodeVisibilityChange:(k,_)=>e.treeviewStore.setVisibilityState(k.id,_),getNodeVisibility:k=>e.treeviewStore.getVisibilityState(k),depth:0,useLayerTypeIcon:!0})}),c(C,d)},$$slots:{default:!0}})}),c(o,g)};D(a,o=>{e.treeviewStore.initialized&&o(i)})}c(w,n),Y()}function Pn(w,e){Q(e,!0),J(()=>{if(!j.lastAddedArea)return;(async()=>{if(j.lastAddedArea===null)return;const n=await j.getAreaNamesById([j.lastAddedArea.id]);!n||n.length===0||!n[0]||ge.success(`Area added: ${n?.[0]}`)})()}),J(()=>{if(!j.lastRemovedArea)return;(async()=>{if(j.lastRemovedArea===null)return;const n=await j.getAreaNamesById([j.lastRemovedArea.id]);!n||n.length===0||!n[0]||ge.success(`Area removed: ${n?.[0]}`)})()}),Y()}var En=F("<!> <!>",1),On=F('<div class="tab-list-wrapper svelte-rohqkk"><!></div> <!>',1);function Hn(w,e){Q(e,!0);const r=Z(e,"triggers",19,()=>[]);var n=U(),a=A(n);q(a,()=>Ut,(i,o)=>{o(i,{get value(){return e.value},get onValueChange(){return e.onValueChange},class:"w-full",children:(g,m)=>{var v=On(),h=A(v),C=S(h);q(C,()=>Ht,(d,l)=>{l(d,{class:"tab-list",children:(s,N)=>{var k=U(),_=A(k);ue(_,17,r,Ne,(f,p,T,M)=>{let R=()=>t(p).value,E=()=>t(p).label;var V=En(),B=A(V);q(B,()=>Rt,(y,x)=>{x(y,{get value(){return R()},class:"tab-trigger",children:(L,O)=>{ce();var H=we();X(()=>ie(H,E())),c(L,H)},$$slots:{default:!0}})});var W=I(B,2);{var K=y=>{ln(y,{class:"separator"})};D(W,y=>{R()!==r()[r().length-1]?.value&&y(K)})}c(f,V)}),c(s,k)},$$slots:{default:!0}})}),b(h);var u=I(h,2);oe(u,()=>e.children??le),c(g,v)},$$slots:{default:!0}})}),c(w,n),Y()}var Un=F('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),Rn=F("<!> <!>",1);function Me(w,e){var r=U(),n=A(r);q(n,()=>Bt,(a,i)=>{i(a,{get value(){return e.value},class:"w-full",children:(o,g)=>{var m=Rn(),v=A(m);q(v,()=>Ke,(u,d)=>{d(u,{class:"card-content overflow-hidden p-0",children:(l,s)=>{dn(l,{class:"h-full w-full",children:(N,k)=>{var _=Un(),f=S(_);oe(f,()=>e.children??le),b(_),c(N,_)},$$slots:{default:!0}})},$$slots:{default:!0}})});var h=I(v,2);{var C=u=>{var d=U(),l=A(d);q(l,()=>cn,(s,N)=>{N(s,{class:"flex items-center justify-between",children:(k,_)=>{var f=U(),p=A(f);oe(p,()=>e.footer),c(k,f)},$$slots:{default:!0}})}),c(u,d)};D(h,u=>{e.footer&&u(C)})}c(o,m)},$$slots:{default:!0}})}),c(w,r)}function Bn(w,e){w.stopPropagation(),e.onFilterClicked?.(e.layerId)}var Wn=F("<button><!></button>");function _t(w,e){Q(e,!0);let r=P(ae(e.hasFiltersApplied?.(e.layerId)??!1));J(()=>{z(r,e.hasFiltersApplied?.(e.layerId)??!1,!0)});const n=ee(()=>t(r)?Wt:Gt);var a=Wn();let i;a.__click=[Bn,e];var o=S(a);be(o,()=>t(n)),b(a),X(g=>{i=pe(a,1,"filter-btn svelte-k95pvd",null,i,g),me(a,"aria-pressed",t(r))},[()=>({active:t(r)})]),c(w,a),Y()}Se(["click"]);var Gn=F('<li class="area-item svelte-81yb5c"><span class="area-name svelte-81yb5c"> </span> <!></li>'),qn=F('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),jn=F('<p class="no-selection svelte-81yb5c">No areas selected</p>'),Xn=F('<li class="data-item svelte-81yb5c"><span class="data-name svelte-81yb5c"> </span> <div class="data-actions svelte-81yb5c"><!> <!></div></li>'),Zn=F('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),Kn=F('<p class="no-selection svelte-81yb5c">No data selected</p>'),Qn=F('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function Yn(w,e){Q(e,!0);const r=Z(e,"fieldFilterMenuStore",7);let n=P(ae([]));J(()=>{if(!j.layerHighlightState.areaInfos.length){z(n,[],!0);return}(async()=>{const p=await j.getAreaNamesById(j.layerHighlightState.areaInfos.map(M=>M.id)),T=[];for(let M=0;M<p.length;M++)T.push({name:p[M]||"Unknown Area",HighlightAreaInfo:j.layerHighlightState.areaInfos[M]});z(n,T,!0)})()});function a(f){const p=t(n).findIndex(T=>T.name===f);p!==-1&&j.removeSelectedArea(t(n)[p]?.HighlightAreaInfo.id)}function i(f){console.log("[export-menu] Removing data selection for layerId:",f),ne.DataSelections.delete(f),console.log("[export-menu] Current SelectedData:",un(ne.DataSelections))}function o(f){if(r().ActiveLayer?.id===f){r().ActiveLayer=null;return}const p=e.webMapStore.dataLookup.get(f);if(!p){console.warn(`[export-menu] Layer with ID ${f} not found in web map store.`);return}r().ActiveLayer=p}function g(f){const p=ne.DataSelections.get(f);return!(!p||!p.fields||p.fields.size===0||p.fields.size===e.webMapStore.dataLookup.get(f)?.fields?.length)}var m=Qn(),v=I(A(m),2),h=S(v),C=S(h,!0);b(h);var u=I(h,4);{var d=f=>{var p=qn(),T=A(p);ue(T,21,()=>t(n),Ne,(E,V)=>{var B=Gn(),W=S(B),K=S(W,!0);b(W);var y=I(W,2);de(y,{variant:"ghost",size:"sm",class:"area-remove-btn",onclick:()=>a(t(V).name),children:(x,L)=>{ce();var O=we("×");c(x,O)},$$slots:{default:!0}}),b(B),X(()=>ie(K,t(V).name)),c(E,B)}),b(T);var M=I(T,2),R=S(M);b(M),X(()=>ie(R,`${t(n).length??""} area(s) selected`)),c(f,p)},l=f=>{var p=jn();c(f,p)};D(u,f=>{t(n).length>0?f(d):f(l,!1)})}b(v);var s=I(v,2),N=I(S(s),2);{var k=f=>{var p=Zn(),T=A(p);ue(T,21,()=>[...ne.DataSelections.values()],Ne,(E,V)=>{var B=Xn(),W=S(B),K=S(W,!0);b(W);var y=I(W,2),x=S(y);{var L=H=>{_t(H,{get layerId(){return t(V).layerId},onFilterClicked:o,hasFiltersApplied:g})};D(x,H=>{t(V).fields&&H(L)})}var O=I(x,2);de(O,{variant:"ghost",size:"sm",class:"data-remove-btn",onclick:()=>i(t(V).layerId),children:(H,G)=>{ce();var $=we("×");c(H,$)},$$slots:{default:!0}}),b(y),b(B),X(()=>ie(K,t(V).name)),c(E,B)}),b(T);var M=I(T,2),R=S(M);b(M),X(()=>ie(R,`${ne.DataSelections.size??""} data layer(s) selected`)),c(f,p)},_=f=>{var p=Kn();c(f,p)};D(N,f=>{ne.DataSelections.size>0?f(k):f(_,!1)})}b(s),X(f=>ie(C,f),[()=>e.areaSelectionTreeviewStore.initialized?e.areaSelectionTreeviewStore.getVisibleNodes()[0]?.name:"Loading..."]),c(w,m),Y()}var Jn=F('<p class="text-sm text-muted-foreground">Click "Export" to begin the download.</p> <!>',1);function $n(w,e){Q(e,!0);const r=()=>Pt(qt,"$page",n),[n,a]=Dt();function i(){if(j.layerHighlightState.areaInfos.length<=0){ge.error("Please select at least one area to export.");return}if(ne.DataSelections.size<=0){ge.error("Please select at least one data layer to export.");return}console.log("Starting export..."),ge.info("Export started successfully.",{duration:4e3});const m=crypto.randomUUID();ye.downloads.push({id:m,url:`${r().url}/${m}`,status:"pending"}),e.onExportSuccess?.()}var o=Jn(),g=I(A(o),2);de(g,{onclick:i,children:(m,v)=>{ce();var h=we("Export");c(m,h)},$$slots:{default:!0}}),c(w,o),Y(),a()}var er=F('<p class="text-sm font-medium"> </p>'),tr=F('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function nr(w,e){Q(e,!0);let r=P(null),n=P(ae({x:0,y:0})),a=0;const i=v=>{z(n,{x:v.clientX,y:v.clientY},!0)};J(()=>(document.addEventListener("mousemove",i),()=>{document.removeEventListener("mousemove",i)})),J(()=>{const v=j.currentHoveredArea?.id,h=++a;if(!v){z(r,null);return}(async()=>{const C=await j.getAreaNamesById([v]);h===a&&j.currentHoveredArea?.id===v&&z(r,C[0]??null,!0)})()});var o=U(),g=A(o);{var m=v=>{var h=tr(),C=S(h);q(C,()=>dt,(u,d)=>{d(u,{class:"max-w-xs border !py-2 shadow-lg",children:(l,s)=>{var N=U(),k=A(N);q(k,()=>Ke,(_,f)=>{f(_,{class:"!px-3 !py-0",children:(p,T)=>{var M=er(),R=S(M,!0);b(M),X(()=>ie(R,t(r))),c(p,M)},$$slots:{default:!0}})}),c(l,N)},$$slots:{default:!0}})}),b(h),X(()=>he(h,`left: ${t(n).x+10}px; top: ${t(n).y-10}px;`)),c(v,h)};D(g,v=>{t(r)&&v(m)})}c(w,o),Y()}function rr(w,e){w.target===w.currentTarget&&e()}var ar=(w,e)=>w.key==="Escape"&&e(),ir=(w,e,r)=>e(t(r).name),or=F('<div class="info-icon-container svelte-fp5rsc"><!></div>'),sr=F('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),lr=F('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),dr=F("<!> <!>",1),cr=F("<!> <!>",1),ur=F('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),vr=F('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function fr(w,e){Q(e,!0);const r=Z(e,"fieldFilterMenuStore",7);let n=P(null),a=P(ae(new ke)),i=ee(()=>{if(!t(n)||!t(n).fields)return{checked:!1,indeterminate:!1};const l=t(n).fields.length,s=t(a)?.size||0;return s===0?{checked:!1,indeterminate:!1}:s===l?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});J(()=>{console.log("Active Layer to Filter:",r().ActiveLayer);const l=r().ActiveLayer;if(z(n,l,!0),l){const s=ne.DataSelections.get(l.id);s?.fields?z(a,new ke([...s.fields]),!0):z(a,new ke,!0)}});function o(){g(),r().ActiveLayer=null}function g(){if(!t(n))return;let l=ne.DataSelections.get(t(n).id);if(l){if((l.fields===void 0||l.fields===null)&&(l.fields=new ke),t(a).size===0){ne.removeSelection(t(n).id);return}l.fields.clear(),t(a).forEach(s=>{l.fields?.add(s)})}}function m(l){t(n)&&(t(a).has(l)?t(a).delete(l):t(a).add(l))}function v(){if(!t(n)?.fields)return;(t(a)?.size||0)===0?t(n).fields.forEach(s=>{t(a).add(s.name)}):t(a).clear()}function h(){return t(n)?.fields?t(n).fields:[]}var C=U(),u=A(C);{var d=l=>{var s=vr();s.__click=[rr,o],s.__keydown=[ar,o];var N=S(s);q(N,()=>dt,(k,_)=>{_(k,{class:"command-card",children:(f,p)=>{var T=ur(),M=A(T);M.__click=o;var R=S(M);vn(R,{size:20}),b(M);var E=I(M,2);q(E,()=>Ke,(V,B)=>{B(V,{class:"card-content",children:(W,K)=>{var y=U(),x=A(y);q(x,()=>fn,(L,O)=>{O(L,{children:(H,G)=>{var $=cr(),te=A($);q(te,()=>gn,(ve,fe)=>{fe(ve,{placeholder:"Search for fields..."})});var Ce=I(te,2);q(Ce,()=>hn,(ve,fe)=>{fe(ve,{children:(_e,De)=>{var Ie=dr(),Te=A(Ie);q(Te,()=>mn,(Pe,Ee)=>{Ee(Pe,{children:(Oe,pt)=>{ce();var Ae=we("No results found.");c(Oe,Ae)},$$slots:{default:!0}})});var bt=I(Te,2);q(bt,()=>wn,(Pe,Ee)=>{Ee(Pe,{heading:"Fields",children:(Oe,pt)=>{var Ae=lr(),He=A(Ae),St=S(He);nt(St,{get checked(){return t(i).checked},get indeterminate(){return t(i).indeterminate},onCheckedChange:v}),ce(2),b(He);var Qe=I(He,2);q(Qe,()=>jt,(Ue,se)=>{se(Ue,{})});var Ct=I(Qe,2);ue(Ct,17,h,Ne,(Ue,se)=>{var Ye=U(),xt=A(Ye);q(xt,()=>_n,(kt,Nt)=>{Nt(kt,{class:"field-item",onselect:()=>m(t(se).name),children:(It,Or)=>{var Re=sr(),Je=S(Re);{let xe=ee(()=>t(a)?.has(t(se).name)??!1);nt(Je,{class:"field-checkbox",get checked(){return t(xe)},onCheckedChange:()=>m(t(se).name)})}var Be=I(Je,2);Be.__click=[ir,m,se];var $e=S(Be),We=S($e),Tt=S(We,!0);b(We);var At=I(We,2);{var Ft=xe=>{var Fe=or(),zt=S(Fe);be(zt,()=>Xt),b(Fe),X(()=>me(Fe,"title",t(se).description)),c(xe,Fe)};D(At,xe=>{t(se).description&&xe(Ft)})}b($e),b(Be),b(Re),X(()=>ie(Tt,t(se).alias||t(se).name)),c(It,Re)},$$slots:{default:!0}})}),c(Ue,Ye)}),c(Oe,Ae)},$$slots:{default:!0}})}),c(_e,Ie)},$$slots:{default:!0}})}),c(H,$)},$$slots:{default:!0}})}),c(W,y)},$$slots:{default:!0}})}),c(f,T)},$$slots:{default:!0}})}),b(s),c(l,s)};D(u,l=>{t(n)&&l(d)})}c(w,C),Y()}Se(["click","keydown"]);var gr=F('<li class="download-item svelte-vgw5fc"><div class="download-info svelte-vgw5fc"><span class="download-url svelte-vgw5fc"> </span></div> <div class="download-actions svelte-vgw5fc"><div><!></div> <!> <!> <!></div></li>'),hr=F('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),mr=F('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),wr=F('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function _r(w,e){Q(e,!0);let r=P(ae(new Set));function n(u){const d=ye.downloads.findIndex(l=>l.url===u);d!==-1&&ye.downloads.splice(d,1)}async function a(u){try{await navigator.clipboard.writeText(u),z(r,new Set(t(r)).add(u),!0),ge.success("URL copied to clipboard"),setTimeout(()=>{const d=new Set(t(r));d.delete(u),z(r,d,!0)},2e3)}catch(d){console.error("Failed to copy URL:",d),ge.error("Failed to copy URL to clipboard")}}function i(u){switch(u){case"completed":return"#059669";case"in-progress":return"#2563eb";case"failed":return"#dc2626";case"pending":default:return"#6b7280"}}function o(u){switch(u){case"completed":return"Completed";case"in-progress":return"In Progress";case"failed":return"Failed";case"pending":default:return"Pending"}}function g(u){switch(u){case"completed":return $t;case"in-progress":return Jt;case"failed":return Yt;case"pending":default:return Qt}}var m=wr(),v=I(S(m),2);{var h=u=>{var d=hr(),l=A(d);ue(l,21,()=>ye.downloads,Ne,(k,_)=>{var f=gr(),p=S(f),T=S(p),M=S(T,!0);b(T),b(p);var R=I(p,2),E=S(R),V=S(E);{let x=ee(()=>i(t(_).status));de(V,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${t(x)??""}`},disabled:!0,children:(L,O)=>{const H=ee(()=>g(t(_).status));var G=U(),$=A(G);{let te=ee(()=>t(_).status==="in-progress"?"spinning":"");q($,()=>t(H),(Ce,ve)=>{ve(Ce,{size:14,get class(){return t(te)}})})}c(L,G)},$$slots:{default:!0}})}b(E);var B=I(E,2);de(B,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>a(t(_).url),title:"Copy URL to clipboard",children:(x,L)=>{var O=U(),H=A(O);{var G=te=>{Zt(te,{size:14})},$=te=>{Kt(te,{size:14})};D(H,te=>{t(r).has(t(_).url)?te(G):te($,!1)})}c(x,O)},$$slots:{default:!0}});var W=I(B,2);{var K=x=>{de(x,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(t(_).url,"_blank"),title:"Open download",children:(L,O)=>{ce();var H=we("📥");c(L,H)},$$slots:{default:!0}})};D(W,x=>{t(_).status==="completed"&&x(K)})}var y=I(W,2);de(y,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>n(t(_).url),title:"Remove from queue",children:(x,L)=>{ce();var O=we("×");c(x,O)},$$slots:{default:!0}}),b(R),b(f),X(x=>{me(T,"title",t(_).url),ie(M,t(_).id),me(E,"title",x)},[()=>o(t(_).status)]),c(k,f)}),b(l);var s=I(l,2),N=S(s);b(s),X(()=>ie(N,`${ye.downloads.length??""} download(s) in queue`)),c(u,d)},C=u=>{var d=mr();c(u,d)};D(v,u=>{ye.downloads.length>0?u(h):u(C,!1)})}b(m),c(w,m),Y()}var yr=F('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ot(w,e){Q(e,!0);const r=Z(e,"isFolder",3,!1),n=Z(e,"isOpen",3,!1),a=`calc(100% - ${e.depth*1}rem)`;var i=yr();i.__click=function(...s){e.onclick?.apply(this,s)};var o=S(i),g=S(o),m=S(g);{var v=s=>{st(s,{get isOpen(){return n()}})};D(m,s=>{r()&&s(v)})}var h=I(m,2),C=S(h);be(C,()=>e.icon),b(h);var u=I(h,2),d=S(u,!0);b(u),b(g);var l=I(g,2);oe(l,()=>e.children??le),b(o),b(i),X(s=>{pe(i,1,s),he(i,`width: ${a};`),ie(d,e.name)},[()=>an(Fn({enhancedHover:!0,includeFont:!0}))]),c(w,i),Y()}Se(["click"]);function br(w,e,r){w.stopPropagation(),z(e,!t(e)),r.onDownloadStateChanged?.(r.node,t(e))}var pr=F("<button><!></button>");function Sr(w,e){Q(e,!0);let r=P(ae(e.getDownloadState?.(e.node)??!1));J(()=>{if(e.getDownloadState){const o=e.getDownloadState(e.node);z(r,o??!1,!0)}});var n=pr();let a;n.__click=[br,r,e];var i=S(n);be(i,()=>en),b(n),X(o=>{a=pe(n,1,"download-btn svelte-zg9ffb",null,a,o),me(n,"title",`Download ${e.node.name??""}`),me(n,"aria-label",`Download ${e.node.name??""}`),me(n,"aria-pressed",t(r))},[()=>({active:t(r)})]),c(w,n),Y()}Se(["click"]);var Cr=F('<div class="flex items-center gap-2"><!></div>'),xr=F("<div><!></div>"),kr=F("<!> <!>",1),Nr=F('<div class="flex items-center gap-2"><!> <!></div>');function yt(w,e){Q(e,!0);const r=k=>{var _=U(),f=A(_);{var p=T=>{var M=U(),R=A(M);{var E=B=>{ot(B,{get icon(){return t(C)},get name(){return e.node.name},get depth(){return i()},onclick:N,get isFolder(){return g},get isOpen(){return t(v)},children:K=>{var y=Cr(),x=S(y);{var L=O=>{rt(O,{get checked(){return t(h)},onCheckedChange:l})};D(x,O=>{m&&O(L)})}b(y),c(K,y)},$$slots:{default:!0}})},V=B=>{ot(B,{get icon(){return t(C)},get name(){return e.node.name},get depth(){return i()},onclick:s,get isFolder(){return g},children:K=>{var y=Nr(),x=S(y);{var L=G=>{var $=kr(),te=A($);{var Ce=fe=>{var _e=xr();let De;var Ie=S(_e);_t(Ie,{get layerId(){return e.node.id},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied}}),b(_e),X(Te=>De=pe(_e,1,"filter-transition-wrapper svelte-kvoyne",null,De,Te),[()=>({"fade-in":!t(d),"fade-out":t(d)})]),c(fe,_e)};D(te,fe=>{t(u)&&fe(Ce)})}var ve=I(te,2);Sr(ve,{get node(){return e.node},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState}}),c(G,$)};D(x,G=>{e.isDownloadable&&G(L)})}var O=I(x,2);{var H=G=>{rt(G,{get checked(){return t(h)},onCheckedChange:l})};D(O,G=>{m&&G(H)})}b(y),c(K,y)},$$slots:{default:!0}})};D(R,B=>{g?B(E):B(V,!1)})}c(T,M)};D(f,T=>{a()?.getItemConfig(e.node.id)?.isHidden||T(p)})}c(k,_)},n=(k,_=le)=>{var f=U(),p=A(f);{var T=M=>{{let R=ee(()=>a()?.getItemConfig(_().id)?.isDownloadable??!0),E=ee(()=>i()+1);yt(M,{get treeviewConfigStore(){return a()},get node(){return _()},get isDownloadable(){return t(R)},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return t(E)},get useLayerTypeIcon(){return o()}})}};D(p,M=>{g&&t(v)&&!a()?.getItemConfig(_().id)?.isHidden&&M(T)})}c(k,f)},a=Z(e,"treeviewConfigStore",3,null),i=Z(e,"depth",3,0),o=Z(e,"useLayerTypeIcon",3,!1),g=!!(e.node.children&&e.node.children.length),m=!g;let v=P(!1),h=P(!1),C=P(""),u=P(!1),d=P(!1);J(()=>{if(!e.node)return;const k=e.getNodeVisibility?e.getNodeVisibility(e.node.id):!1;z(h,k??!1,!0),e.node instanceof re&&z(C,ht(e.node.layer,o(),g,t(v)),!0)}),J(()=>{if(!(e.node instanceof re))return;const k=(e.getDownloadState?.(e.node)&&e.node.layer.type==="feature")??!1;k&&!t(u)?(z(u,!0),z(d,!1)):!k&&t(u)&&(z(d,!0),setTimeout(()=>{z(u,!1),z(d,!1)},180))});function l(){!m||!e.onNodeVisibilityChange||(z(h,!t(h)),e.onNodeVisibilityChange(e.node,t(h)))}function s(){e.onNodeClick?.(e.node)}function N(){z(v,!t(v)),e.onNodeClick?.(e.node)}{let k=ee(()=>g?e.node.children:null);ut(w,{get isOpen(){return t(v)},get content(){return r},get childNodes(){return t(k)},get childNode(){return n}})}Y()}class Ir{configStore;constructor(e){this.configStore=e}}function Tr(w){return w.replace(/&deg;/gi,"°").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}class Ar extends Ir{id="aliasPath";layerToNode(e,r){const n=new re(e.id,e.title,e,[],r),a=this.configStore.getItemConfig(e.id);if(this.#r(e)&&a?.showFields){const i=e;i.loaded||console.warn(`Layer not loaded: ${e.id}`);const o=new Map;for(const g of i.fields??[]){const m=this.configStore.getItemConfig(this.#e(e.id,g.name));!m||m.isHidden||this.#s(g,n,o)}n.children.sort((g,m)=>g.children.length>0&&m.children.length===0?1:g.children.length===0&&m.children.length>0?-1:0)}return n}#s(e,r,n=new Map){const a=this.#e(r.id,e.name),o=Tr(e.alias||"")?.split("|").map(u=>u.trim()).filter(Boolean)??[];if(o.length===0){const u=new Le(a,e.alias||e.name,r.layer,e,[],r);return r.children.push(u),u}const g=o.slice(0,-1),m=o[o.length-1];let v=r;const h=(u,d)=>{u.children??=[],u.children.includes(d)||u.children.push(d)};for(let u=0;u<g.length;u++){const d=g[u],l=o.slice(0,u+1).join("::"),s=`${r.id}::${l}`;let N=n.get(s);N||(N=new ct(s,d,[],v),n.set(s,N),h(v,N)),v=N}const C=new Le(a,m||e.name,r.layer,e,[],v);return h(v,C),C}#e(e,r){return`${e}-${r}`}#r(e){return e.type==="feature"}}function Fr(w,e){Q(e,!0);const r=Z(e,"webMap",3,null),n=Z(e,"fieldFilterMenuStore",7),a=new wt;J(()=>{if(!r()||a.initialized)return;(async()=>{await r().when(),await i(r().layers.toArray()),console.log("[data-selection-tree-view] fields to hide:",e.fieldsToHide);const l=new Ar(e.treeviewConfigStore);a.initialize(r().layers.toArray(),e.treeviewConfigStore,[l]),console.log("[data-selection-tree-view] Initialized with layers:",a.getNodes())})()});async function i(d){for(const l of d)l.type==="feature"&&!l.loaded&&(await l.load(),console.log("Loaded feature layer:",l.title)),l.type==="group"&&await i(l.layers.toArray())}function o(d,l){if(!l){ne.removeSelection(d.id);return}if(!(d instanceof re))return;const s={layerId:d.id,name:d.layer.title||"",fields:new ke(d.layer.fields?.map(N=>N.name)||[])};ne.addSelection(s)}function g(d){return ne.DataSelections.has(d.id)}function m(d){if(n().ActiveLayer?.uid===d){n().ActiveLayer=null;return}const s=a.getNodeById(d);!s||!(s instanceof re)||(n().ActiveLayer=s.layer)}function v(d){const l=ne.DataSelections.get(d);if(!l?.fields)return!1;const s=a.getNodeById(d);if(!s||!(s instanceof re))return!1;const N=s.layer.fields?.length||0,k=l.fields.size;return k>0&&k!==N}var h=U(),C=A(h);{var u=d=>{var l=U(),s=A(l);q(s,()=>lt,(N,k)=>{k(N,{children:(_,f)=>{var p=U(),T=A(p);ue(T,17,()=>a.getNodes(),M=>M.id,(M,R)=>{{let E=ee(()=>e.treeviewConfigStore.getItemConfig(t(R).id)?.isDownloadable??!1);yt(M,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return t(R)},get isDownloadable(){return t(E)},onNodeClick:()=>{},onNodeVisibilityChange:(V,B)=>a.setVisibilityState(V.id,B),getNodeVisibility:V=>a.getVisibilityState(V),onDownloadStateChanged:o,getDownloadState:g,onFilterClicked:m,hasFiltersApplied:v,depth:0,useLayerTypeIcon:!0})}}),c(_,p)},$$slots:{default:!0}})}),c(d,l)};D(C,d=>{a.initialized&&d(u)})}c(w,h),Y()}const zr=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];function Mr(w,e,r,n,a){if(!e.isOpen)return;z(r,!0),w.preventDefault();const i=w.clientX,o=t(n);function g(v){const h=v.clientX-i,C=Math.max(t(a),o+h);z(n,C,!0)}function m(){z(r,!1),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",m),document.body.style.cursor="",document.body.style.userSelect=""}document.addEventListener("mousemove",g),document.addEventListener("mouseup",m),document.body.style.cursor="ew-resize",document.body.style.userSelect="none"}var Vr=F('<button class="absolute top-0 h-full cursor-ew-resize border-0 bg-transparent p-0 transition-colors hover:bg-primary/50" aria-label="Resize sidebar by dragging" tabindex="-1"></button>'),Lr=F('<!> <aside><div class="flex h-full w-full flex-col"><div class="flex-1 overflow-x-hidden overflow-y-auto p-4"><!></div></div> <!></aside>',1);function Dr(w,e){Q(e,!0);const r=Z(e,"minWidth",3,"500px");let n,a=P(0),i=P(ae(parseFloat(r()))),o=P(!1);const g=ee(()=>parseFloat(r()));Ze(()=>{if(!n)return;const _=new ResizeObserver(f=>{for(const p of f)z(a,p.contentRect.width,!0)});return _.observe(n),()=>{_.disconnect()}});var m=Lr(),v=A(m);{let _=ee(()=>e.isOpen?"Close sidebar":"Open sidebar");de(v,{get onclick(){return e.onToggle},variant:"default",size:"icon",class:"fixed z-[2] rounded-l-none rounded-r-md shadow-lg hover:scale-105",get style(){return`top: calc(var(--header-height, 64px) + 1rem); left: ${t(a)??""}px; pointer-events: auto; transition: transform 200ms, background-color 200ms;`},get"aria-label"(){return t(_)},get"aria-expanded"(){return e.isOpen},children:(f,p)=>{var T=U(),M=A(T);{var R=V=>{bn(V,{class:"h-6 w-6"})},E=V=>{pn(V,{class:"h-6 w-6"})};D(M,V=>{e.isOpen?V(R):V(E,!1)})}c(f,T)},$$slots:{default:!0}})}var h=I(v,2);let C;var u=S(h),d=S(u);he(d,"padding-right: 16px;");var l=S(d);{var s=_=>{var f=U(),p=A(f);oe(p,()=>e.children),c(_,f)};D(l,_=>{e.children&&_(s)})}b(d),b(u);var N=I(u,2);{var k=_=>{var f=Vr();f.__mousedown=[Mr,e,o,i,g],he(f,"width: 8px; right: -4px;"),c(_,f)};D(N,_=>{e.isOpen&&_(k)})}b(h),Ve(h,_=>n=_,()=>n),X(_=>{C=pe(h,1,"relative flex h-full flex-col border-r border-sidebar-border bg-card text-card-foreground shadow-lg ease-in-out",null,C,_),he(h,`width: ${e.isOpen?`${t(i)}px`:"0"}; overflow: hidden;`)},[()=>({"transition-all":!t(o),"duration-300":!t(o)})]),c(w,m),Y()}Se(["mousedown"]);var Pr=F("<!> <!> <!> <!>",1),Er=F('<!> <!> <!> <!> <div class="layout-container svelte-1xwk4vv"><!> <div class="map-section svelte-1xwk4vv"><!></div></div>',1);function ra(w,e){Q(e,!0);const r=ae(new tn),n=ae(new nn),a=ae(new wt);let i=P("define-areas"),o=P(void 0),g=P(void 0),m=P(!0);function v(){z(m,!t(m))}Ze(async()=>{const T=await yn();j.setNameFields(T.serviceUprn2Config.selectionLayersNameFields||[]),z(o,new at(T.serviceUprn2Config.dataSelectionTreeviewConfig),!0),z(g,new at(T.serviceUprn2Config.areaSelectionTreeviewConfig),!0),await r.initializeAsync({portalUrl:T.serviceUprn2Config.portalUrl,itemId:T.serviceUprn2Config.portalItemId||"",proxy:T.serviceUprn2Config.proxy}),console.log("[page] WebMap loaded")});function h(T){z(i,T,!0)}function C(){z(i,"downloads")}var u=Er(),d=A(u);rn(d,{});var l=I(d,2);nr(l,{});var s=I(l,2);fr(s,{get fieldFilterMenuStore(){return n}});var N=I(s,2);Pn(N,{});var k=I(N,2),_=S(k);Dr(_,{get isOpen(){return t(m)},onToggle:v,children:(T,M)=>{Hn(T,{get value(){return t(i)},get triggers(){return zr},onValueChange:h,children:(R,E)=>{var V=Pr(),B=A(V);Me(B,{value:"define-areas",children:(x,L)=>{Dn(x,{get webMap(){return r.data},get treeviewStore(){return a},get treeviewConfigStore(){return t(g)}})}});var W=I(B,2);Me(W,{value:"select-data",children:(x,L)=>{Fr(x,{get webMap(){return r.data},get treeviewConfigStore(){return t(o)},get fieldFilterMenuStore(){return n}})}});var K=I(W,2);Me(K,{value:"export",footer:L=>{$n(L,{onExportSuccess:C})},children:(L,O)=>{Yn(L,{get webMapStore(){return r},get areaSelectionTreeviewStore(){return a},get fieldFilterMenuStore(){return n}})}});var y=I(K,2);Me(y,{value:"downloads",children:(x,L)=>{_r(x,{})}}),c(R,V)},$$slots:{default:!0}})},$$slots:{default:!0}});var f=I(_,2),p=S(f);kn(p,{get webMap(){return r.data},get areaSelectionTreeviewStore(){return a},panelPosition:"top-left",menuPosition:"top-right"}),b(f),b(k),c(w,u),Y()}export{ra as component};
