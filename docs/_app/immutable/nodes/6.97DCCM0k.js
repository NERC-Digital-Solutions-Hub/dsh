const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/BsJbwhv8.js","../chunks/CDGqq53N.js","../chunks/BzZgUCJc.js","../chunks/C9_KfL0q.js","../chunks/Cm7AOsqL.js","../chunks/PPVm8Dsz.js","../chunks/Cad-p0g1.js","../chunks/COT3swUQ.js","../chunks/D1sKJjB8.js","../chunks/C3oh_tnt.js","../chunks/C_1gjxB4.js","../chunks/fh0BQpDQ.js","../chunks/BNR3I_eR.js","../chunks/Cp_8tW2x.js","../chunks/Dy3IPmu3.js","../chunks/CicY3o9G.js","../chunks/bnayRBMH.js","../chunks/DHehJAQP.js","../chunks/NEmuse4e.js","../chunks/DyeKTZUU.js","../chunks/Bcsiu1z4.js","../chunks/C-nwrPug.js","../chunks/C0wm8_Yw.js","../chunks/B0eu-fbb.js","../chunks/B92oQJPd.js","../chunks/BPKnb2Ep.js","../chunks/BP3dapwT.js","../chunks/9ka9skRU.js","../chunks/BBnDJw94.js","../chunks/BzQEzIrU.js","../chunks/ByYe5JNT.js","../chunks/B87vTgcy.js","../chunks/CPwmGbun.js","../chunks/clW6bTka.js","../chunks/CY1ScL2v.js","../chunks/BqBW39kE.js","../chunks/Ncy6WYEt.js","../chunks/Bsvdop-J.js","../chunks/DY7bJyoW.js","../chunks/CZ1cFYIj.js","../chunks/DOBtub6T.js","../assets/index.CQED0rIl.css","../chunks/CwswxHzg.js","../chunks/DmK00UBb.js","../chunks/DL5OcIt-.js","../chunks/Cgb6qxNH.js","../chunks/BNEZVyfC.js","../chunks/iGtE-x7J.js","../chunks/BMEoQDn3.js","../chunks/CjvOpC9P.js","../chunks/BaNElx7S.js","../chunks/CaVKkSa6.js","../chunks/BzPGhKjT.js","../chunks/BW5FX2Vq.js","../chunks/B1N-tmtC.js","../chunks/BirX00qr.js","../chunks/y-H9M8xu.js","../chunks/D-qJO60r.js","../chunks/QQC62dOK.js","../chunks/Bxxl7NsE.js","../chunks/DWdJ8y7A.js","../chunks/DQOO6RKE.js","../chunks/CpKt4gnm.js","../chunks/Bi6C4OG6.js","../chunks/C7e3Z5XT.js","../chunks/D-YQ4CHs.js","../chunks/Bs6xTxvz.js","../chunks/C6j0c8D7.js","../chunks/BnIkuiB_.js","../chunks/BobhZSEo.js","../chunks/DGRj8LLO.js","../chunks/BuFC1hBS.js","../chunks/Di9axRGX.js","../chunks/BcU1P1CV.js","../chunks/BkaRJQOf.js","../chunks/DujhAnCs.js","../chunks/CWMNWfLw.js","../chunks/CmkbQrYx.js","../chunks/EQ54Yfcd.js","../chunks/DuNa-JhG.js","../chunks/3SbGqcbX.js","../chunks/OuCfdC0r.js","../chunks/Cbf23dJy.js","../chunks/CWaspPwN.js","../chunks/vu8FjO6O.js","../chunks/CvbnrAEx.js","../chunks/BJLSrlOq.js","../chunks/2al6WD4b.js","../chunks/CyyW12qt.js","../chunks/Dpaauiqf.js","../chunks/DstbFQD6.js","../chunks/CxKE0Jjq.js","../chunks/BDmhfu3R.js","../chunks/DxjXvSCh.js","../chunks/qyF9FwQ9.js","../chunks/XI-Li77m.js","../chunks/DjsBn23O.js","../chunks/DbEENCEu.js","../chunks/Cy-nR8IT.js","../chunks/DX8bWC0d.js","../chunks/DMoBPOW4.js","../chunks/UcZE3skJ.js","../chunks/CaYZrGFV.js"])))=>i.map(i=>d[i]);
import{_ as Mn}from"../chunks/PPVm8Dsz.js";import"../chunks/DsnmJJEf.js";import{o as jn,a as ya}from"../chunks/BI5Gp87m.js";import{X as so,E as lo,b9 as uo,ba as co,F as fo,y as ho,bb as vo,bc as po,bd as go,a2 as ba,av as mo,H as yo,n as qe,a0 as Ie,g as u,b as G,p as Fe,f as Z,c as Ne,d as ee,r as X,s as ie,aA as Le,w as Ve,Y as ut,ad as ce,$ as dn,aK as bo}from"../chunks/Dg8B37cN.js";import{p as wo,c as de,a as T,f as ae,t as _n}from"../chunks/Lqxt2u0_.js";import{p as Re,i as ve,r as Et,l as wa,s as Rt}from"../chunks/DX-cJOE_.js";import{c as Oe}from"../chunks/C27fUA72.js";import{b as Nt}from"../chunks/DRG7OQx7.js";import{b as _o,s as Ct}from"../chunks/Dy6t_wds.js";import{a as Sr,d as xr,s as hi,b as vi,f as So}from"../chunks/ZHUHaqSd.js";import{C as kr}from"../chunks/D07KZK_i.js";import{C as Cr}from"../chunks/DLy_QKZY.js";import{t as Kn,k as xo,l as ko,L as Co,m as Io,h as Po,i as Ao,C as Ji,j as Oo,I as Eo,G as Qi,F as Xi,b as Do,O as _a,a as To,d as Sa,c as hr,n as Fo,o as No,M as Ro,V as $i,e as Mo,f as Lo,g as jo,S as Ko}from"../chunks/XmQsaBUt.js";import{s as Ze,e as Vt,i as Sn}from"../chunks/B3syFVNQ.js";import{g as qo,e as Ir}from"../chunks/2p-loE3l.js";import{c as Vn,B as Tt}from"../chunks/DAMheLE7.js";import{C as Bo,D as Vo,k as zo,l as Uo,g as Ho,a as vr,m as Go,S as qt}from"../chunks/BZOnCu_P.js";import{I as kn}from"../chunks/Bc9iEGYw.js";import{I as Wo}from"../chunks/B1GXYwgn.js";import{I as xa,s as ka,S as Yo}from"../chunks/Kyo2J1YB.js";import{S as Jo,C as Qo}from"../chunks/B3bwBiAo.js";import{c as Xo,g as $o}from"../chunks/Cpj98o6Y.js";import"../chunks/D-WwhvxC.js";import{b as Zo}from"../chunks/CUvm1Ruv.js";import"../chunks/B17Q6ahh.js";import"../chunks/69_IOA4Y.js";import{s as ai,f as es,g as ts,h as ns,i as rs}from"../chunks/CZwPzpMR.js";import{b as is}from"../chunks/Bs6xTxvz.js";import as from"../chunks/BNR3I_eR.js";import{s as Zi}from"../chunks/BzZgUCJc.js";import{J as os}from"../chunks/COT3swUQ.js";import{h as qn}from"../chunks/DRuftlug.js";import{X as ss,a as ls,b as us,C as cs,g as ds}from"../chunks/CYwhYb6C.js";import{S as Bt}from"../chunks/pSJ29C-C.js";import{b as ea}from"../chunks/fh0BQpDQ.js";import"../chunks/BKQ2gCMi.js";import{a as fs}from"../chunks/D1sKJjB8.js";import{z as ta}from"../chunks/C6j0c8D7.js";import"../chunks/C9_KfL0q.js";import"../chunks/CDGqq53N.js";import"../chunks/bnayRBMH.js";import"../chunks/BcU1P1CV.js";import"../chunks/BkaRJQOf.js";import"../chunks/CPwmGbun.js";import"../chunks/CY1ScL2v.js";import{d as hs}from"../chunks/C8hn-AFl.js";import{c as vs}from"../chunks/DOQyJ1lj.js";import{M as ps,L as Ca,A as gs,a as ms,S as ys}from"../chunks/D485tY-B.js";import{a as na,S as bs}from"../chunks/BzjoCI4e.js";import"../chunks/CWMNWfLw.js";import{j as ra}from"../chunks/2al6WD4b.js";import{p as ia}from"../chunks/DujhAnCs.js";import{a as aa,m as oa}from"../chunks/clW6bTka.js";import{u as pr}from"../chunks/CicY3o9G.js";import{C as ws}from"../chunks/uMzs0gdM.js";import{C as _s}from"../chunks/BmZJvC6A.js";const Ss=()=>performance.now(),Wt={tick:C=>requestAnimationFrame(C),now:()=>Ss(),tasks:new Set};function Ia(){const C=Wt.now();Wt.tasks.forEach(n=>{n.c(C)||(Wt.tasks.delete(n),n.f())}),Wt.tasks.size!==0&&Wt.tick(Ia)}function xs(C){let n;return Wt.tasks.size===0&&Wt.tick(Ia),{promise:new Promise(o=>{Wt.tasks.add(n={c:C,f:o})}),abort(){Wt.tasks.delete(n)}}}function gr(C,n){ba(()=>{C.dispatchEvent(new CustomEvent(n))})}function ks(C){if(C==="float")return"cssFloat";if(C==="offset")return"cssOffset";if(C.startsWith("--"))return C;const n=C.split("-");return n.length===1?n[0]:n[0]+n.slice(1).map(o=>o[0].toUpperCase()+o.slice(1)).join("")}function sa(C){const n={},o=C.split(";");for(const s of o){const[c,f]=s.split(":");if(!c||f===void 0)break;const v=ks(c.trim());n[v]=f.trim()}return n}const Cs=C=>C;function wr(C,n,o,s){var c=(C&po)!==0,f=(C&go)!==0,v=c&&f,k=(C&vo)!==0,O=v?"both":c?"in":"out",P,E=n.inert,j=n.style.overflow,L,Y;function M(){return ba(()=>P??=o()(n,s?.()??{},{direction:O}))}var N={is_global:k,in(){if(n.inert=E,!c){Y?.abort(),Y?.reset?.();return}f||L?.abort(),gr(n,"introstart"),L=oi(n,M(),Y,1,()=>{gr(n,"introend"),L?.abort(),L=P=void 0,n.style.overflow=j})},out(K){if(!f){K?.(),P=void 0;return}n.inert=!0,gr(n,"outrostart"),Y=oi(n,M(),L,0,()=>{gr(n,"outroend"),K?.()})},stop:()=>{L?.abort(),Y?.abort()}},B=so;if((B.transitions??=[]).push(N),c&&_o){var F=k;if(!F){for(var q=B.parent;q&&(q.f&lo)!==0;)for(;(q=q.parent)&&(q.f&uo)===0;);F=!q||(q.f&co)!==0}F&&fo(()=>{ho(()=>N.in())})}}function oi(C,n,o,s,c){var f=s===1;if(mo(n)){var v,k=!1;return yo(()=>{if(!k){var B=n({direction:f?"in":"out"});v=oi(C,B,o,s,c)}}),{abort:()=>{k=!0,v?.abort()},deactivate:()=>v.deactivate(),reset:()=>v.reset(),t:()=>v.t()}}if(o?.deactivate(),!n?.duration)return c(),{abort:qe,deactivate:qe,reset:qe,t:()=>s};const{delay:O=0,css:P,tick:E,easing:j=Cs}=n;var L=[];if(f&&o===void 0&&(E&&E(0,1),P)){var Y=sa(P(0,1));L.push(Y,Y)}var M=()=>1-s,N=C.animate(L,{duration:O,fill:"forwards"});return N.onfinish=()=>{N.cancel();var B=o?.t()??1-s;o?.abort();var F=s-B,q=n.duration*Math.abs(F),K=[];if(q>0){var U=!1;if(P)for(var oe=Math.ceil(q/16.666666666666668),te=0;te<=oe;te+=1){var se=B+F*j(te/oe),he=sa(P(se,1-se));K.push(he),U||=he.overflow==="hidden"}U&&(C.style.overflow="hidden"),M=()=>{var ke=N.currentTime;return B+F*j(ke/q)},E&&xs(()=>{if(N.playState!=="running")return!1;var ke=M();return E(ke,1-ke),!0})}N=C.animate(K,{duration:q,fill:"forwards"}),N.onfinish=()=>{M=()=>s,E?.(s,1-s),c()}},{abort:()=>{N&&(N.cancel(),N.effect=null,N.onfinish=qe)},deactivate:()=>{c=qe},reset:()=>{s===0&&E?.(1,0)},t:()=>M()}}const Is=Uo({component:"avatar",parts:["root","image","fallback"]}),Ps=new Bo("Avatar.Root");class pi{static create(n){return Ps.set(new pi(n))}opts;domContext;attachment;constructor(n){this.opts=n,this.domContext=new Vo(this.opts.ref),this.loadImage=this.loadImage.bind(this),this.attachment=zo(this.opts.ref)}loadImage(n,o,s){if(this.opts.loadingStatus.current==="loaded")return;let c;const f=new Image;return f.src=n,o!==void 0&&(f.crossOrigin=o),s&&(f.referrerPolicy=s),this.opts.loadingStatus.current="loading",f.onload=()=>{c=this.domContext.setTimeout(()=>{this.opts.loadingStatus.current="loaded"},this.opts.delayMs.current)},f.onerror=()=>{this.opts.loadingStatus.current="error"},()=>{c&&this.domContext.clearTimeout(c)}}#e=Ie(()=>({id:this.opts.id.current,[Is.root]:"","data-status":this.opts.loadingStatus.current,...this.attachment}));get props(){return u(this.#e)}set props(n){G(this.#e,n)}}var As=ae("<div><!></div>");function Os(C,n){const o=wo();Fe(n,!0);let s=Re(n,"delayMs",3,0),c=Re(n,"loadingStatus",15,"loading"),f=Re(n,"id",19,()=>Ho(o)),v=Re(n,"ref",15,null),k=Et(n,["$$slots","$$events","$$legacy","delayMs","loadingStatus","onLoadingStatusChange","child","children","id","ref"]);const O=pi.create({delayMs:vr(()=>s()),loadingStatus:vr(()=>c(),M=>{c()!==M&&(c(M),n.onLoadingStatusChange?.(M))}),id:vr(()=>f()),ref:vr(()=>v(),M=>v(M))}),P=Ie(()=>Go(k,O.props));var E=de(),j=Z(E);{var L=M=>{var N=de(),B=Z(N);Ze(B,()=>n.child,()=>({props:u(P)})),T(M,N)},Y=M=>{var N=As();Sr(N,()=>({...u(P)}));var B=ee(N);Ze(B,()=>n.children??qe),X(N),T(M,N)};ve(j,M=>{n.child?M(L):M(Y,!1)})}T(C,E),Ne()}function Es(C,n){const o=wa(n,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]];xa(C,Rt({name:"download"},()=>o,{get iconNode(){return s},children:(c,f)=>{var v=de(),k=Z(v);ka(k,n,"default",{}),T(c,v)},$$slots:{default:!0}}))}function Ds(C,n){const o=wa(n,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];xa(C,Rt({name:"trash"},()=>o,{get iconNode(){return s},children:(c,f)=>{var v=de(),k=Z(v);ka(k,n,"default",{}),T(c,v)},$$slots:{default:!0}}))}var Ts=ae('<div class="w-full flex-shrink-0"><!></div>');function Fs(C,n){var o=Ts(),s=ee(o);{var c=f=>{var v=de(),k=Z(v);Ze(k,()=>n.children),T(f,v)};ve(s,f=>{n.children&&f(c)})}X(o),T(C,o)}var Ns=ae('<div class="w-full flex-shrink-0"><!></div>');function Rs(C,n){var o=Ns(),s=ee(o);{var c=f=>{var v=de(),k=Z(v);Ze(k,()=>n.children),T(f,v)};ve(s,f=>{n.children&&f(c)})}X(o),T(C,o)}function Ms(C,n){Fe(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let o=Et(n,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];kn(C,Rt({name:"arrow-down-to-line"},()=>o,{get iconNode(){return s},children:(c,f)=>{var v=de(),k=Z(v);Ze(k,()=>n.children??qe),T(c,v)},$$slots:{default:!0}})),Ne()}function Ls(C,n){Fe(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let o=Et(n,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];kn(C,Rt({name:"arrow-down"},()=>o,{get iconNode(){return s},children:(c,f)=>{var v=de(),k=Z(v);Ze(k,()=>n.children??qe),T(c,v)},$$slots:{default:!0}})),Ne()}function js(C,n){Fe(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let o=Et(n,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"m18 15-6-6-6 6"}]];kn(C,Rt({name:"chevron-up"},()=>o,{get iconNode(){return s},children:(c,f)=>{var v=de(),k=Z(v);Ze(k,()=>n.children??qe),T(c,v)},$$slots:{default:!0}})),Ne()}function Ks(C,n){Fe(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let o=Et(n,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]];kn(C,Rt({name:"maximize"},()=>o,{get iconNode(){return s},children:(c,f)=>{var v=de(),k=Z(v);Ze(k,()=>n.children??qe),T(c,v)},$$slots:{default:!0}})),Ne()}function qs(C,n){Fe(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let o=Et(n,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]];kn(C,Rt({name:"minimize"},()=>o,{get iconNode(){return s},children:(c,f)=>{var v=de(),k=Z(v);Ze(k,()=>n.children??qe),T(c,v)},$$slots:{default:!0}})),Ne()}function Bs(C,n){Fe(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let o=Et(n,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];kn(C,Rt({name:"send"},()=>o,{get iconNode(){return s},children:(c,f)=>{var v=de(),k=Z(v);Ze(k,()=>n.children??qe),T(c,v)},$$slots:{default:!0}})),Ne()}var Vs=ae('<p class="text-sm font-medium"> </p>'),zs=ae('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function Us(C,n){Fe(n,!0);let o=ie(null),s=ie(Le({x:0,y:0})),c=0;const f=P=>{G(s,{x:P.clientX,y:P.clientY},!0)};Ve(()=>(document.addEventListener("mousemove",f),()=>{document.removeEventListener("mousemove",f)})),Ve(()=>{const P=n.areaSelectionInteractionStore.currentHoveredArea?.id,E=++c;if(!P){G(o,null);return}(async()=>{const j=await n.areaSelectionInteractionStore.getAreaNamesById([P]);E===c&&n.areaSelectionInteractionStore.currentHoveredArea?.id===P&&G(o,j[0]??null,!0)})()});var v=de(),k=Z(v);{var O=P=>{var E=zs(),j=ee(E);Oe(j,()=>kr,(L,Y)=>{Y(L,{class:"max-w-xs border !py-2 shadow-lg",children:(M,N)=>{var B=de(),F=Z(B);Oe(F,()=>Cr,(q,K)=>{K(q,{class:"!px-3 !py-0",children:(U,oe)=>{var te=Vs(),se=ee(te,!0);X(te),ut(()=>Ct(se,u(o))),T(U,te)},$$slots:{default:!0}})}),T(M,B)},$$slots:{default:!0}})}),X(E),ut(()=>xr(E,`left: ${u(s).x+10}px; top: ${u(s).y-10}px;`)),T(P,E)};ve(k,P=>{u(o)&&P(O)})}T(C,v),Ne()}function Hs(C,n){Fe(n,!0);async function o(s,c){const f=await n.areaSelectionInteractionStore.getAreaNamesById([s]);if(!f||f.length===0||!f[0])return;const v=`Area ${c}: ${f[0]}`;Kn.success(v)}Ve(()=>{n.areaSelectionInteractionStore.lastAddedArea&&o(n.areaSelectionInteractionStore.lastAddedArea.id,"added")}),Ve(()=>{n.areaSelectionInteractionStore.lastRemovedArea&&o(n.areaSelectionInteractionStore.lastRemovedArea.id,"removed")}),Ne()}var Gs=ae("<div><!></div>");function la(C,n){Fe(n,!0);let o=Re(n,"ref",15,null),s=Et(n,["$$slots","$$events","$$legacy","ref","variant","children"]);var c=Gs();Sr(c,()=>({...s,class:"group/chat-bubble flex max-w-[80%] flex-row place-items-end gap-2 data-[variant='sent']:place-self-end","data-variant":n.variant}));var f=ee(c);Ze(f,()=>n.children??qe),X(c),Nt(c,v=>o(v),()=>o()),T(C,c),Ne()}var Ws=ae('<span class="inline-block size-(--loading-dots-size) rounded-full bg-primary svelte-k2x6sv"></span>'),Ys=ae('<div class="inline-flex items-center gap-1 svelte-k2x6sv"></div>');function Js(C,n){let o=Re(n,"size",3,4);var s=Ys();let c;Vt(s,20,()=>({length:3}),Sn,(f,v)=>{var k=Ws();T(f,k)}),X(s),ut(f=>c=xr(s,"",c,f),[()=>({"--loading-dots-size":`${o()??""}px`})]),T(C,s)}var Qs=ae('<div class="flex size-full place-items-center justify-center"><!></div>'),Xs=ae("<div><!></div>");function ii(C,n){Fe(n,!0);let o=Re(n,"ref",15,null),s=Re(n,"typing",3,!1),c=Et(n,["$$slots","$$events","$$legacy","ref","typing","class","children"]);var f=Xs();Sr(f,P=>({...c,class:P}),[()=>Vn("order-2 rounded-lg bg-secondary p-4 text-sm group-data-[variant='received']/chat-bubble:rounded-bl-none group-data-[variant='sent']/chat-bubble:order-1 group-data-[variant='sent']/chat-bubble:rounded-br-none group-data-[variant='sent']/chat-bubble:bg-primary group-data-[variant='sent']/chat-bubble:text-primary-foreground",n.class)]);var v=ee(f);{var k=P=>{var E=Qs(),j=ee(E);Js(j,{}),X(E),T(P,E)},O=P=>{var E=de(),j=Z(E);Ze(j,()=>n.children??qe),T(P,E)};ve(v,P=>{s()?P(k):P(O,!1)})}X(f),Nt(f,P=>o(P),()=>o()),T(C,f),Ne()}function $s(C,n){Fe(n,!0);let o=Re(n,"ref",15,null),s=Et(n,["$$slots","$$events","$$legacy","ref","class"]);var c=de(),f=Z(c);{let v=Ie(()=>Vn("relative flex size-8 shrink-0 overflow-hidden rounded-full",n.class));Oe(f,()=>Os,(k,O)=>{O(k,Rt({"data-slot":"avatar",get class(){return u(v)}},()=>s,{get ref(){return o()},set ref(P){o(P)}}))})}T(C,c),Ne()}function ua(C,n){Fe(n,!0);let o=Re(n,"ref",15,null),s=Et(n,["$$slots","$$events","$$legacy","ref","class"]);{let c=Ie(()=>Vn("order-1 group-data-[variant='sent']/chat-bubble:order-2",n.class));$s(C,Rt({get class(){return u(c)}},()=>s,{get ref(){return o()},set ref(f){o(f)}}))}Ne()}function Pa(C){const n=C-1;return n*n*n+1}function ca(C,{delay:n=0,duration:o=400,easing:s=Pa,axis:c="y"}={}){const f=getComputedStyle(C),v=+f.opacity,k=c==="y"?"height":"width",O=parseFloat(f[k]),P=c==="y"?["top","bottom"]:["left","right"],E=P.map(F=>`${F[0].toUpperCase()}${F.slice(1)}`),j=parseFloat(f[`padding${E[0]}`]),L=parseFloat(f[`padding${E[1]}`]),Y=parseFloat(f[`margin${E[0]}`]),M=parseFloat(f[`margin${E[1]}`]),N=parseFloat(f[`border${E[0]}Width`]),B=parseFloat(f[`border${E[1]}Width`]);return{delay:n,duration:o,easing:s,css:F=>`overflow: hidden;opacity: ${Math.min(F*20,1)*v};${k}: ${F*O}px;padding-${P[0]}: ${F*j}px;padding-${P[1]}: ${F*L}px;margin-${P[0]}: ${F*Y}px;margin-${P[1]}: ${F*M}px;border-${P[0]}-width: ${F*N}px;border-${P[1]}-width: ${F*B}px;min-${k}: 0`}}function da(C,{delay:n=0,duration:o=400,easing:s=Pa,start:c=0,opacity:f=0}={}){const v=getComputedStyle(C),k=+v.opacity,O=v.transform==="none"?"":v.transform,P=1-c,E=k*(1-f);return{delay:n,duration:o,easing:s,css:(j,L)=>`
			transform: ${O} scale(${1-P*L});
			opacity: ${k-E*L}
		`}}class Zs{#e=ie();#t=ie(0);#n=ie(!1);lastScrollHeight=0;set ref(n){if(G(this.#e,n,!0),!u(this.#e))return;this.lastScrollHeight=u(this.#e).scrollHeight,u(this.#e).scrollTo(0,u(this.#t)?u(this.#t):u(this.#e).scrollHeight),u(this.#e).addEventListener("scroll",()=>{u(this.#e)&&(G(this.#t,u(this.#e).scrollTop,!0),this.disableAutoScroll())}),window.addEventListener("resize",()=>{this.scrollToBottom(!0)}),new MutationObserver(()=>{u(this.#e)&&(u(this.#e).scrollHeight!==this.lastScrollHeight&&this.scrollToBottom(!0),this.lastScrollHeight=u(this.#e).scrollHeight)}).observe(u(this.#e),{childList:!0,subtree:!0})}get ref(){return u(this.#e)}get scrollY(){return u(this.#t)}get isAtBottom(){return u(this.#e)?u(this.#t)+u(this.#e).offsetHeight>=u(this.#e).scrollHeight:!0}disableAutoScroll(){this.isAtBottom?G(this.#n,!1):G(this.#n,!0)}scrollToBottom(n=!1){u(this.#e)&&(n&&u(this.#n)||u(this.#e).scrollTo(0,u(this.#e).scrollHeight))}}var el=ae("<div><!></div>"),tl=ae('<div class="relative"><div><!></div> <!></div>');function nl(C,n){Fe(n,!0);let o=Re(n,"ref",15,null),s=Et(n,["$$slots","$$events","$$legacy","ref","children","class"]),c=ie(!1);const f=new Zs;jn(()=>{G(c,!0)});var v=tl(),k=ee(v);Sr(k,j=>({...s,class:j}),[()=>Vn("no-scrollbar flex h-full w-full flex-col gap-4 overflow-y-auto p-4",n.class,{"scroll-smooth":u(c)})]);var O=ee(k);Ze(O,()=>n.children??qe),X(k),Nt(k,j=>o(j),()=>o()),Nt(k,j=>f.ref=j,()=>f?.ref);var P=ce(k,2);{var E=j=>{var L=el(),Y=ee(L);Tt(Y,{onclick:()=>f.scrollToBottom(),variant:"outline",size:"icon",class:"absolute bottom-2 left-1/2 inline-flex -translate-x-1/2 transform rounded-full shadow-md",children:(M,N)=>{Ls(M,{})},$$slots:{default:!0}}),X(L),wr(1,L,()=>da,()=>({start:.85,duration:100,delay:250})),wr(2,L,()=>da,()=>({start:.85,duration:100})),T(j,L)};ve(P,j=>{f.isAtBottom||j(E)})}X(v),T(C,v),Ne()}var rl=ae(`<p class="break-words whitespace-pre-wrap"> </p> <div class="w-full text-xs group-data-[variant='sent']/chat-bubble:text-end"> </div>`,1),il=ae("<!> <!>",1),al=ae('<p class="break-words whitespace-pre-wrap"> </p>'),ol=ae("<!> <!>",1),sl=ae("<!> <!>",1),ll=ae('<div class="chat-container h-full w-full border border-border svelte-1osgd7m"><div class="message-wrapper svelte-1osgd7m"><!></div> <div class="input-wrapper svelte-1osgd7m"><form class="flex shrink-0 items-center gap-2 border-t border-border bg-background p-2"><!> <!></form></div></div>');function ul(C,n){Fe(n,!0);const o=1,s=2,c="Sorry, I encountered an error processing your request.",f="How can I help?";let v=ie(""),k=ie(!1),O=ie(""),P=ie(null),E=ie(null),j=ie(null);const L=Le([{senderId:o,message:f,sentAt:Y(new Date)}]);Ve(()=>{if(u(E)&&u(j)){const ue=u(E),ye=u(j),Se=()=>{const De=ue.offsetHeight;ye.style.paddingBottom=`${De}px`};Se();const _e=new ResizeObserver(Se);return _e.observe(ue),()=>{_e.disconnect()}}}),Ve(()=>{L.length,u(O),u(P)&&setTimeout(()=>{const ue=u(P)?.querySelector('[data-slot="scroll-area-viewport"]');ue&&(ue.scrollTop=ue.scrollHeight)},0)});function Y(ue){const ye=ue.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Se=ue.getHours()>=12?"PM":"AM";return`${ye} ${Se}`}function M(ue,ye){return{message:ue,senderId:ye,sentAt:Y(new Date)}}function N(ue,ye){L.push(M(ue,ye))}function B(){G(k,!1),G(O,"")}function F(ue){G(O,u(O)+ue)}async function q(ue){if(ue.preventDefault(),!u(v).trim()||u(k))return;const ye=u(v).trim();G(v,""),N(ye,s),G(k,!0),G(O,"");try{await n.aiUprnChatbotService.chatStream(ye,F)&&u(O)?N(u(O),o):N(c,o)}catch(Se){console.error("Chat error:",Se),N(c,o)}finally{B()}}var K=ll(),U=ee(K),oe=ee(U);Yo(oe,{class:"h-full w-full",get ref(){return u(P)},set ref(ue){G(P,ue,!0)},children:(ue,ye)=>{var Se=de(),_e=Z(Se);Oe(_e,()=>nl,(De,ze)=>{ze(De,{children:(Qe,Ce)=>{var Me=sl(),ge=Z(Me);Vt(ge,16,()=>L,ot=>ot,(ot,fe)=>{var je=de(),Xe=Z(je);{let Pe=Ie(()=>fe.senderId===s?"sent":"received");Oe(Xe,()=>la,(et,It)=>{It(et,{get variant(){return u(Pe)},children:(ne,St)=>{var tt=il(),pe=Z(tt);Oe(pe,()=>ua,(gt,Ue)=>{Ue(gt,{})});var Be=ce(pe,2);Oe(Be,()=>ii,(gt,Ue)=>{Ue(gt,{class:"flex flex-col gap-1",children:(ct,pt)=>{var nt=rl(),st=Z(nt),lt=ee(st,!0);X(st);var He=ce(st,2),xt=ee(He,!0);X(He),ut(()=>{Ct(lt,fe.message),Ct(xt,fe.sentAt)}),T(ct,nt)},$$slots:{default:!0}})}),T(ne,tt)},$$slots:{default:!0}})})}T(ot,je)});var Ee=ce(ge,2);{var at=ot=>{var fe=de(),je=Z(fe);Oe(je,()=>la,(Xe,Pe)=>{Pe(Xe,{variant:"received",children:(et,It)=>{var ne=ol(),St=Z(ne);Oe(St,()=>ua,(pe,Be)=>{Be(pe,{})});var tt=ce(St,2);Oe(tt,()=>ii,(pe,Be)=>{Be(pe,{class:"flex flex-col gap-1",children:(gt,Ue)=>{var ct=de(),pt=Z(ct);{var nt=lt=>{var He=al(),xt=ee(He,!0);X(He),ut(()=>Ct(xt,u(O))),T(lt,He)},st=lt=>{var He=de(),xt=Z(He);Oe(xt,()=>ii,(Ft,kt)=>{kt(Ft,{typing:!0})}),T(lt,He)};ve(pt,lt=>{u(O)?lt(nt):lt(st,!1)})}T(gt,ct)},$$slots:{default:!0}})}),T(et,ne)},$$slots:{default:!0}})}),T(ot,fe)};ve(Ee,ot=>{u(k)&&ot(at)})}T(Qe,Me)},$$slots:{default:!0}})}),T(ue,Se)},$$slots:{default:!0}}),X(U),Nt(U,ue=>G(j,ue),()=>u(j));var te=ce(U,2),se=ee(te),he=ee(se);Wo(he,{class:"rounded-full",placeholder:"Type a message...",get disabled(){return u(k)},get value(){return u(v)},set value(ue){G(v,ue,!0)}});var ke=ce(he,2);{let ue=Ie(()=>u(v).trim()===""||u(k));Tt(ke,{type:"submit",variant:"default",size:"icon",class:"shrink-0 rounded-full",get disabled(){return u(ue)},children:(ye,Se)=>{Bs(ye,{})},$$slots:{default:!0}})}X(se),Nt(se,ue=>G(E,ue),()=>u(E)),X(te),X(K),qo("submit",se,q),T(C,K),Ne()}const en=Object.freeze({Pending:"pending",InProgress:"in-progress",Completed:"completed",Failed:"failed"}),mr=Object.freeze({Submitted:"SUBMITTED",Queued:"QUEUED",Processing:"IN_PROGRESS",Completed:"COMPLETED",Error:"ERROR"}),cl=Object.freeze({Success:"success",Error:"error"});var br={exports:{}},dl=br.exports,fa;function fl(){return fa||(fa=1,(function(C,n){(function(o,s){C.exports=s()})(dl,function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=i[a])})(e,t)},s=function(){return(s=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function c(e,t,r){for(var i,a=0,l=t.length;a<l;a++)!i&&a in t||((i=i||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(i||Array.prototype.slice.call(t))}var f=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Xo,v=Object.keys,k=Array.isArray;function O(e,t){return typeof t!="object"||v(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||f.Promise||(f.Promise=Promise);var P=Object.getPrototypeOf,E={}.hasOwnProperty;function j(e,t){return E.call(e,t)}function L(e,t){typeof t=="function"&&(t=t(P(e))),(typeof Reflect>"u"?v:Reflect.ownKeys)(t).forEach(function(r){M(e,r,t[r])})}var Y=Object.defineProperty;function M(e,t,r,i){Y(e,t,O(r&&j(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},i))}function N(e){return{from:function(t){return e.prototype=Object.create(t.prototype),M(e.prototype,"constructor",e),{extend:L.bind(null,e.prototype)}}}}var B=Object.getOwnPropertyDescriptor,F=[].slice;function q(e,t,r){return F.call(e,t,r)}function K(e,t){return t(e)}function U(e){if(!e)throw new Error("Assertion Failed")}function oe(e){f.setImmediate?setImmediate(e):setTimeout(e,0)}function te(e,t){if(typeof t=="string"&&j(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],i=0,a=t.length;i<a;++i){var l=te(e,t[i]);r.push(l)}return r}var d=t.indexOf(".");if(d!==-1){var h=e[t.substr(0,d)];return h==null?void 0:te(h,t.substr(d+1))}}function se(e,t,r){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){U(typeof r!="string"&&"length"in r);for(var i=0,a=t.length;i<a;++i)se(e,t[i],r[i])}else{var l,d,h=t.indexOf(".");h!==-1?(l=t.substr(0,h),(d=t.substr(h+1))===""?r===void 0?k(e)&&!isNaN(parseInt(l))?e.splice(l,1):delete e[l]:e[l]=r:se(h=!(h=e[l])||!j(e,l)?e[l]={}:h,d,r)):r===void 0?k(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function he(e){var t,r={};for(t in e)j(e,t)&&(r[t]=e[t]);return r}var ke=[].concat;function ue(e){return ke.apply([],e)}var Ye="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ue([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return f[e]}),ye=new Set(Ye.map(function(e){return f[e]})),Se=null;function _e(e){return Se=new WeakMap,e=(function t(r){if(!r||typeof r!="object")return r;var i=Se.get(r);if(i)return i;if(k(r)){i=[],Se.set(r,i);for(var a=0,l=r.length;a<l;++a)i.push(t(r[a]))}else if(ye.has(r.constructor))i=r;else{var d,h=P(r);for(d in i=h===Object.prototype?{}:Object.create(h),Se.set(r,i),r)j(r,d)&&(i[d]=t(r[d]))}return i})(e),Se=null,e}var De={}.toString;function ze(e){return De.call(e).slice(8,-1)}var Qe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Ce=typeof Qe=="symbol"?function(e){var t;return e!=null&&(t=e[Qe])&&t.apply(e)}:function(){return null};function Me(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var ge={};function Ee(e){var t,r,i,a;if(arguments.length===1){if(k(e))return e.slice();if(this===ge&&typeof e=="string")return[e];if(a=Ce(e)){for(r=[];!(i=a.next()).done;)r.push(i.value);return r}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(r=new Array(t);t--;)r[t]=e[t];return r}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var at=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Mt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Dt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Mt),ot={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function fe(e,t){this.name=e,this.message=t}function je(e,t){return e+". Errors: "+Object.keys(t).map(function(r){return t[r].toString()}).filter(function(r,i,a){return a.indexOf(r)===i}).join(`
`)}function Xe(e,t,r,i){this.failures=t,this.failedKeys=i,this.successCount=r,this.message=je(e,t)}function Pe(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(r){return t[r]}),this.failuresByPos=t,this.message=je(e,this.failures)}N(fe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),N(Xe).from(fe),N(Pe).from(fe);var et=Dt.reduce(function(e,t){return e[t]=t+"Error",e},{}),It=fe,ne=Dt.reduce(function(e,t){var r=t+"Error";function i(a,l){this.name=r,a?typeof a=="string"?(this.message="".concat(a).concat(l?`
 `+l:""),this.inner=l||null):typeof a=="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a):(this.message=ot[t]||r,this.inner=null)}return N(i).from(It),e[t]=i,e},{});ne.Syntax=SyntaxError,ne.Type=TypeError,ne.Range=RangeError;var St=Mt.reduce(function(e,t){return e[t+"Error"]=ne[t],e},{}),tt=Dt.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=ne[t]),e},{});function pe(){}function Be(e){return e}function gt(e,t){return e==null||e===Be?t:function(r){return t(e(r))}}function Ue(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ct(e,t){return e===pe?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var l=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ue(i,this.onsuccess):i),a&&(this.onerror=this.onerror?Ue(a,this.onerror):a),l!==void 0?l:r}}function pt(e,t){return e===pe?t:function(){e.apply(this,arguments);var r=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Ue(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Ue(i,this.onerror):i)}}function nt(e,t){return e===pe?t:function(r){var i=e.apply(this,arguments);O(r,i);var a=this.onsuccess,l=this.onerror;return this.onsuccess=null,this.onerror=null,r=t.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?Ue(a,this.onsuccess):a),l&&(this.onerror=this.onerror?Ue(l,this.onerror):l),i===void 0?r===void 0?void 0:r:O(i,r)}}function st(e,t){return e===pe?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function lt(e,t){return e===pe?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var i=this,a=arguments.length,l=new Array(a);a--;)l[a]=arguments[a];return r.then(function(){return t.apply(i,l)})}return t.apply(this,arguments)}}tt.ModifyError=Xe,tt.DexieError=fe,tt.BulkError=Pe;var He=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function xt(e){He=e}var Ft={},kt=100,Ye=typeof Promise>"u"?[]:(function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,P(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,P(t),e]})(),Mt=Ye[0],Dt=Ye[1],Ye=Ye[2],Dt=Dt&&Dt.then,dt=Mt&&Mt.constructor,wt=!!Ye,$e=function(e,t){Cn.push([e,t]),Lt&&(queueMicrotask(La),Lt=!1)},ft=!0,Lt=!0,zt=[],fn=[],Ut=Be,Pt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pe,pgp:!1,env:{},finalize:pe},le=Pt,Cn=[],rn=0,zn=[];function $(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=le;if(typeof e!="function"){if(e!==Ft)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ar(this,this._value))}this._state=null,this._value=null,++t.ref,(function r(i,a){try{a(function(l){if(i._state===null){if(l===i)throw new TypeError("A promise cannot be resolved with itself.");var d=i._lib&&hn();l&&typeof l.then=="function"?r(i,function(h,g){l instanceof $?l._then(h,g):l.then(h,g)}):(i._state=!0,i._value=l,mi(i)),d&&vn()}},Ar.bind(null,i))}catch(l){Ar(i,l)}})(this,e)}var Pr={get:function(){var e=le,t=Wn;function r(i,a){var l=this,d=!e.global&&(e!==le||t!==Wn),h=d&&!Jt(),g=new $(function(m,_){Or(l,new gi(bi(i,e,d,h),bi(a,e,d,h),m,_,e))});return this._consoleTask&&(g._consoleTask=this._consoleTask),g}return r.prototype=Ft,r},set:function(e){M(this,"then",e&&e.prototype===Ft?Pr:{get:function(){return e},set:Pr.set})}};function gi(e,t,r,i,a){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=i,this.psd=a}function Ar(e,t){var r,i;fn.push(t),e._state===null&&(r=e._lib&&hn(),t=Ut(t),e._state=!1,e._value=t,i=e,zt.some(function(a){return a._value===i._value})||zt.push(i),mi(e),r&&vn())}function mi(e){var t=e._listeners;e._listeners=[];for(var r=0,i=t.length;r<i;++r)Or(e,t[r]);var a=e._PSD;--a.ref||a.finalize(),rn===0&&(++rn,$e(function(){--rn==0&&Er()},[]))}function Or(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++rn,$e(Ma,[r,e,t])}else e._listeners.push(t)}function Ma(e,t,r){try{var i,a=t._value;!t._state&&fn.length&&(fn=[]),i=He&&t._consoleTask?t._consoleTask.run(function(){return e(a)}):e(a),t._state||fn.indexOf(a)!==-1||(function(l){for(var d=zt.length;d;)if(zt[--d]._value===l._value)return zt.splice(d,1)})(t),r.resolve(i)}catch(l){r.reject(l)}finally{--rn==0&&Er(),--r.psd.ref||r.psd.finalize()}}function La(){an(Pt,function(){hn()&&vn()})}function hn(){var e=ft;return Lt=ft=!1,e}function vn(){var e,t,r;do for(;0<Cn.length;)for(e=Cn,Cn=[],r=e.length,t=0;t<r;++t){var i=e[t];i[0].apply(null,i[1])}while(0<Cn.length);Lt=ft=!0}function Er(){var e=zt;zt=[],e.forEach(function(i){i._PSD.onunhandled.call(null,i._value,i)});for(var t=zn.slice(0),r=t.length;r;)t[--r]()}function Un(e){return new $(Ft,!1,e)}function Ge(e,t){var r=le;return function(){var i=hn(),a=le;try{return Qt(r,!0),e.apply(this,arguments)}catch(l){t&&t(l)}finally{Qt(a,!1),i&&vn()}}}L($.prototype,{then:Pr,_then:function(e,t){Or(this,new gi(null,null,e,t,le))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,r=arguments[1];return typeof t=="function"?this.then(null,function(i){return(i instanceof t?r:Un)(i)}):this.then(null,function(i){return(i&&i.name===t?r:Un)(i)})},finally:function(e){return this.then(function(t){return $.resolve(e()).then(function(){return t})},function(t){return $.resolve(e()).then(function(){return Un(t)})})},timeout:function(e,t){var r=this;return e<1/0?new $(function(i,a){var l=setTimeout(function(){return a(new ne.Timeout(t))},e);r.then(i,a).finally(clearTimeout.bind(null,l))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&M($.prototype,Symbol.toStringTag,"Dexie.Promise"),Pt.env=yi(),L($,{all:function(){var e=Ee.apply(null,arguments).map(Yn);return new $(function(t,r){e.length===0&&t([]);var i=e.length;e.forEach(function(a,l){return $.resolve(a).then(function(d){e[l]=d,--i||t(e)},r)})})},resolve:function(e){return e instanceof $?e:e&&typeof e.then=="function"?new $(function(t,r){e.then(t,r)}):new $(Ft,!0,e)},reject:Un,race:function(){var e=Ee.apply(null,arguments).map(Yn);return new $(function(t,r){e.map(function(i){return $.resolve(i).then(t,r)})})},PSD:{get:function(){return le},set:function(e){return le=e}},totalEchoes:{get:function(){return Wn}},newPSD:Yt,usePSD:an,scheduler:{get:function(){return $e},set:function(e){$e=e}},rejectionMapper:{get:function(){return Ut},set:function(e){Ut=e}},follow:function(e,t){return new $(function(r,i){return Yt(function(a,l){var d=le;d.unhandleds=[],d.onunhandled=l,d.finalize=Ue(function(){var h,g=this;h=function(){g.unhandleds.length===0?a():l(g.unhandleds[0])},zn.push(function m(){h(),zn.splice(zn.indexOf(m),1)}),++rn,$e(function(){--rn==0&&Er()},[])},d.finalize),e()},t,r,i)})}}),dt&&(dt.allSettled&&M($,"allSettled",function(){var e=Ee.apply(null,arguments).map(Yn);return new $(function(t){e.length===0&&t([]);var r=e.length,i=new Array(r);e.forEach(function(a,l){return $.resolve(a).then(function(d){return i[l]={status:"fulfilled",value:d}},function(d){return i[l]={status:"rejected",reason:d}}).then(function(){return--r||t(i)})})})}),dt.any&&typeof AggregateError<"u"&&M($,"any",function(){var e=Ee.apply(null,arguments).map(Yn);return new $(function(t,r){e.length===0&&r(new AggregateError([]));var i=e.length,a=new Array(i);e.forEach(function(l,d){return $.resolve(l).then(function(h){return t(h)},function(h){a[d]=h,--i||r(new AggregateError(a))})})})}),dt.withResolvers&&($.withResolvers=dt.withResolvers));var ht={awaits:0,echoes:0,id:0},ja=0,Hn=[],Gn=0,Wn=0,Ka=0;function Yt(e,t,r,i){var a=le,l=Object.create(a);return l.parent=a,l.ref=0,l.global=!1,l.id=++Ka,Pt.env,l.env=wt?{Promise:$,PromiseProp:{value:$,configurable:!0,writable:!0},all:$.all,race:$.race,allSettled:$.allSettled,any:$.any,resolve:$.resolve,reject:$.reject}:{},t&&O(l,t),++a.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()},i=an(l,e,r,i),l.ref===0&&l.finalize(),i}function pn(){return ht.id||(ht.id=++ja),++ht.awaits,ht.echoes+=kt,ht.id}function Jt(){return!!ht.awaits&&(--ht.awaits==0&&(ht.id=0),ht.echoes=ht.awaits*kt,!0)}function Yn(e){return ht.echoes&&e&&e.constructor===dt?(pn(),e.then(function(t){return Jt(),t},function(t){return Jt(),rt(t)})):e}function qa(){var e=Hn[Hn.length-1];Hn.pop(),Qt(e,!1)}function Qt(e,t){var r,i=le;(t?!ht.echoes||Gn++&&e===le:!Gn||--Gn&&e===le)||queueMicrotask(t?(function(a){++Wn,ht.echoes&&--ht.echoes!=0||(ht.echoes=ht.awaits=ht.id=0),Hn.push(le),Qt(a,!0)}).bind(null,e):qa),e!==le&&(le=e,i===Pt&&(Pt.env=yi()),wt&&(r=Pt.env.Promise,t=e.env,(i.global||e.global)&&(Object.defineProperty(f,"Promise",t.PromiseProp),r.all=t.all,r.race=t.race,r.resolve=t.resolve,r.reject=t.reject,t.allSettled&&(r.allSettled=t.allSettled),t.any&&(r.any=t.any))))}function yi(){var e=f.Promise;return wt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(f,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function an(e,t,r,i,a){var l=le;try{return Qt(e,!0),t(r,i,a)}finally{Qt(l,!1)}}function bi(e,t,r,i){return typeof e!="function"?e:function(){var a=le;r&&pn(),Qt(t,!0);try{return e.apply(this,arguments)}finally{Qt(a,!1),i&&queueMicrotask(Jt)}}}function Dr(e){Promise===dt&&ht.echoes===0?Gn===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Dt).indexOf("[native code]")===-1&&(pn=Jt=pe);var rt=$.reject,on="",Ht="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",wi="String expected.",gn=[],Jn="__dbnames",Tr="readonly",Fr="readwrite";function sn(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var _i={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Qn(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=_e(t))[e],t}}function Si(){throw ne.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Ae(e,t){try{var r=xi(e),i=xi(t);if(r!==i)return r==="Array"?1:i==="Array"?-1:r==="binary"?1:i==="binary"?-1:r==="string"?1:i==="string"?-1:r==="Date"?1:i!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return(function(a,l){for(var d=a.length,h=l.length,g=d<h?d:h,m=0;m<g;++m)if(a[m]!==l[m])return a[m]<l[m]?-1:1;return d===h?0:d<h?-1:1})(ki(e),ki(t));case"Array":return(function(a,l){for(var d=a.length,h=l.length,g=d<h?d:h,m=0;m<g;++m){var _=Ae(a[m],l[m]);if(_!==0)return _}return d===h?0:d<h?-1:1})(e,t)}}catch{}return NaN}function xi(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=ze(e),e==="ArrayBuffer"?"binary":e)}function ki(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Xn(e,t,r){var i=e.schema.yProps;return i?(t&&0<r.numFailures&&(t=t.filter(function(a,l){return!r.failures[l]})),Promise.all(i.map(function(a){return a=a.updatesTable,t?e.db.table(a).where("k").anyOf(t).delete():e.db.table(a).clear()})).then(function(){return r})):r}var In=(Ci.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var r=t.add;if(k(r))return c(c([],k(e)?e:[],!0),r).sort();if(typeof r=="number")return(Number(e)||0)+r;if(typeof r=="bigint")try{return BigInt(e)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(t.remove!==void 0){var i=t.remove;if(k(i))return k(e)?e.filter(function(a){return!i.includes(a)}).sort():[];if(typeof i=="number")return Number(e)-i;if(typeof i=="bigint")try{return BigInt(e)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}return r=(r=t.replacePrefix)===null||r===void 0?void 0:r[0],r&&typeof e=="string"&&e.startsWith(r)?t.replacePrefix[1]+e.substring(r.length):e},Ci);function Ci(e){this["@@propmod"]=e}function Ii(e,t){for(var r=v(t),i=r.length,a=!1,l=0;l<i;++l){var d=r[l],h=t[d],g=te(e,d);h instanceof In?(se(e,d,h.execute(g)),a=!0):g!==h&&(se(e,d,h),a=!0)}return a}var Pi=(Ke.prototype._trans=function(e,t,r){var i=this._tx||le.trans,a=this.name,l=He&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function d(m,_,p){if(!p.schema[a])throw new ne.NotFound("Table "+a+" not part of transaction");return t(p.idbtrans,p)}var h=hn();try{var g=i&&i.db._novip===this.db._novip?i===le.trans?i._promise(e,d,r):Yt(function(){return i._promise(e,d,r)},{trans:i,transless:le.transless||le}):(function m(_,p,x,y){if(_.idbdb&&(_._state.openComplete||le.letThrough||_._vip)){var b=_._createTransaction(p,x,_._dbSchema);try{b.create(),_._state.PR1398_maxLoop=3}catch(w){return w.name===et.InvalidState&&_.isOpen()&&0<--_._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),_.close({disableAutoOpen:!1}),_.open().then(function(){return m(_,p,x,y)})):rt(w)}return b._promise(p,function(w,S){return Yt(function(){return le.trans=b,y(w,S,b)})}).then(function(w){if(p==="readwrite")try{b.idbtrans.commit()}catch{}return p==="readonly"?w:b._completion.then(function(){return w})})}if(_._state.openComplete)return rt(new ne.DatabaseClosed(_._state.dbOpenError));if(!_._state.isBeingOpened){if(!_._state.autoOpen)return rt(new ne.DatabaseClosed);_.open().catch(pe)}return _._state.dbReadyPromise.then(function(){return m(_,p,x,y)})})(this.db,e,[this.name],d);return l&&(g._consoleTask=l,g=g.catch(function(m){return console.trace(m),rt(m)})),g}finally{h&&vn()}},Ke.prototype.get=function(e,t){var r=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?rt(new ne.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(a){return r.hook.reading.fire(a)})}).then(t)},Ke.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(k(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=v(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(h){if(h.compound&&t.every(function(m){return 0<=h.keyPath.indexOf(m)})){for(var g=0;g<t.length;++g)if(t.indexOf(h.keyPath[g])===-1)return!1;return!0}return!1}).sort(function(h,g){return h.keyPath.length-g.keyPath.length})[0];if(r&&this.db._maxKey!==on){var l=r.keyPath.slice(0,t.length);return this.where(l).equals(l.map(function(g){return e[g]}))}!r&&He&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var i=this.schema.idxByName;function a(h,g){return Ae(h,g)===0}var d=t.reduce(function(p,g){var m=p[0],_=p[1],p=i[g],x=e[g];return[m||p,m||!p?sn(_,p&&p.multi?function(y){return y=te(y,g),k(y)&&y.some(function(b){return a(x,b)})}:function(y){return a(x,te(y,g))}):_]},[null,null]),l=d[0],d=d[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(d):r?this.filter(d):this.where(t).equals("")},Ke.prototype.filter=function(e){return this.toCollection().and(e)},Ke.prototype.count=function(e){return this.toCollection().count(e)},Ke.prototype.offset=function(e){return this.toCollection().offset(e)},Ke.prototype.limit=function(e){return this.toCollection().limit(e)},Ke.prototype.each=function(e){return this.toCollection().each(e)},Ke.prototype.toArray=function(e){return this.toCollection().toArray(e)},Ke.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Ke.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,k(e)?"[".concat(e.join("+"),"]"):e))},Ke.prototype.reverse=function(){return this.toCollection().reverse()},Ke.prototype.mapToClass=function(e){var t,r=this.db,i=this.name;function a(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Si&&((function(g,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function _(){this.constructor=g}o(g,m),g.prototype=m===null?Object.create(m):(_.prototype=m.prototype,new _)})(a,t=e),Object.defineProperty(a.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),a.prototype.table=function(){return i},e=a);for(var l=new Set,d=e.prototype;d;d=P(d))Object.getOwnPropertyNames(d).forEach(function(g){return l.add(g)});function h(g){if(!g)return g;var m,_=Object.create(e.prototype);for(m in g)if(!l.has(m))try{_[m]=g[m]}catch{}return _}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=h,this.hook("reading",h),e},Ke.prototype.defineClass=function(){return this.mapToClass(function(e){O(this,e)})},Ke.prototype.add=function(e,t){var r=this,i=this.schema.primKey,a=i.auto,l=i.keyPath,d=e;return l&&a&&(d=Qn(l)(e)),this._trans("readwrite",function(h){return r.core.mutate({trans:h,type:"add",keys:t!=null?[t]:null,values:[d]})}).then(function(h){return h.numFailures?$.reject(h.failures[0]):h.lastResult}).then(function(h){if(l)try{se(e,l,h)}catch{}return h})},Ke.prototype.upsert=function(e,t){var r=this,i=this.schema.primKey.keyPath;return this._trans("readwrite",function(a){return r.core.get({trans:a,key:e}).then(function(l){var d=l??{};return Ii(d,t),i&&se(d,i,e),r.core.mutate({trans:a,type:"put",values:[d],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(h){return h.numFailures?$.reject(h.failures[0]):!!l})})})},Ke.prototype.update=function(e,t){return typeof e!="object"||k(e)?this.where(":id").equals(e).modify(t):(e=te(e,this.schema.primKey.keyPath),e===void 0?rt(new ne.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},Ke.prototype.put=function(e,t){var r=this,i=this.schema.primKey,a=i.auto,l=i.keyPath,d=e;return l&&a&&(d=Qn(l)(e)),this._trans("readwrite",function(h){return r.core.mutate({trans:h,type:"put",values:[d],keys:t!=null?[t]:null})}).then(function(h){return h.numFailures?$.reject(h.failures[0]):h.lastResult}).then(function(h){if(l)try{se(e,l,h)}catch{}return h})},Ke.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:[e]}).then(function(i){return Xn(t,[e],i)}).then(function(i){return i.numFailures?$.reject(i.failures[0]):void 0})})},Ke.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:_i}).then(function(r){return Xn(e,null,r)})}).then(function(t){return t.numFailures?$.reject(t.failures[0]):void 0})},Ke.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(r){return t.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(a){return t.hook.reading.fire(a)})})})},Ke.prototype.bulkAdd=function(e,t,r){var i=this,a=Array.isArray(t)?t:void 0,l=(r=r||(a?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(d){var m=i.schema.primKey,h=m.auto,m=m.keyPath;if(m&&a)throw new ne.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new ne.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,m=m&&h?e.map(Qn(m)):e;return i.core.mutate({trans:d,type:"add",keys:a,values:m,wantResults:l}).then(function(b){var p=b.numFailures,x=b.results,y=b.lastResult,b=b.failures;if(p===0)return l?x:y;throw new Pe("".concat(i.name,".bulkAdd(): ").concat(p," of ").concat(g," operations failed"),b)})})},Ke.prototype.bulkPut=function(e,t,r){var i=this,a=Array.isArray(t)?t:void 0,l=(r=r||(a?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(d){var m=i.schema.primKey,h=m.auto,m=m.keyPath;if(m&&a)throw new ne.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new ne.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,m=m&&h?e.map(Qn(m)):e;return i.core.mutate({trans:d,type:"put",keys:a,values:m,wantResults:l}).then(function(b){var p=b.numFailures,x=b.results,y=b.lastResult,b=b.failures;if(p===0)return l?x:y;throw new Pe("".concat(i.name,".bulkPut(): ").concat(p," of ").concat(g," operations failed"),b)})})},Ke.prototype.bulkUpdate=function(e){var t=this,r=this.core,i=e.map(function(d){return d.key}),a=e.map(function(d){return d.changes}),l=[];return this._trans("readwrite",function(d){return r.getMany({trans:d,keys:i,cache:"clone"}).then(function(h){var g=[],m=[];e.forEach(function(p,x){var y=p.key,b=p.changes,w=h[x];if(w){for(var S=0,I=Object.keys(b);S<I.length;S++){var A=I[S],D=b[A];if(A===t.schema.primKey.keyPath){if(Ae(D,y)!==0)throw new ne.Constraint("Cannot update primary key in bulkUpdate()")}else se(w,A,D)}l.push(x),g.push(y),m.push(w)}});var _=g.length;return r.mutate({trans:d,type:"put",keys:g,values:m,updates:{keys:i,changeSpecs:a}}).then(function(p){var x=p.numFailures,y=p.failures;if(x===0)return _;for(var b=0,w=Object.keys(y);b<w.length;b++){var S,I=w[b],A=l[Number(I)];A!=null&&(S=y[I],delete y[I],y[A]=S)}throw new Pe("".concat(t.name,".bulkUpdate(): ").concat(x," of ").concat(_," operations failed"),y)})})})},Ke.prototype.bulkDelete=function(e){var t=this,r=e.length;return this._trans("readwrite",function(i){return t.core.mutate({trans:i,type:"delete",keys:e}).then(function(a){return Xn(t,e,a)})}).then(function(d){var a=d.numFailures,l=d.lastResult,d=d.failures;if(a===0)return l;throw new Pe("".concat(t.name,".bulkDelete(): ").concat(a," of ").concat(r," operations failed"),d)})},Ke);function Ke(){}function Pn(e){function t(d,h){if(h){for(var g=arguments.length,m=new Array(g-1);--g;)m[g-1]=arguments[g];return r[d].subscribe.apply(null,m),e}if(typeof d=="string")return r[d]}var r={};t.addEventType=l;for(var i=1,a=arguments.length;i<a;++i)l(arguments[i]);return t;function l(d,h,g){if(typeof d!="object"){var m;h=h||st;var _={subscribers:[],fire:g=g||pe,subscribe:function(p){_.subscribers.indexOf(p)===-1&&(_.subscribers.push(p),_.fire=h(_.fire,p))},unsubscribe:function(p){_.subscribers=_.subscribers.filter(function(x){return x!==p}),_.fire=_.subscribers.reduce(h,g)}};return r[d]=t[d]=_}v(m=d).forEach(function(p){var x=m[p];if(k(x))l(p,m[p][0],m[p][1]);else{if(x!=="asap")throw new ne.InvalidArgument("Invalid event config");var y=l(p,Be,function(){for(var b=arguments.length,w=new Array(b);b--;)w[b]=arguments[b];y.subscribers.forEach(function(S){oe(function(){S.apply(null,w)})})})}})}}function An(e,t){return N(t).from({prototype:e}),t}function mn(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Nr(e,t){e.filter=sn(e.filter,t)}function Rr(e,t,r){var i=e.replayFilter;e.replayFilter=i?function(){return sn(i(),t())}:t,e.justLimit=r&&!i}function $n(e,t){if(e.isPrimKey)return t.primaryKey;var r=t.getIndexByKeyPath(e.index);if(!r)throw new ne.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Ai(e,t,r){var i=$n(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:i,range:e.range}})}function Zn(e,t,r,i){var a=e.replayFilter?sn(e.filter,e.replayFilter()):e.filter;if(e.or){var l={},d=function(h,g,m){var _,p;a&&!a(g,m,function(x){return g.stop(x)},function(x){return g.fail(x)})||((p=""+(_=g.primaryKey))=="[object ArrayBuffer]"&&(p=""+new Uint8Array(_)),j(l,p)||(l[p]=!0,t(h,g,m)))};return Promise.all([e.or._iterate(d,r),Oi(Ai(e,i,r),e.algorithm,d,!e.keysOnly&&e.valueMapper)])}return Oi(Ai(e,i,r),sn(e.algorithm,a),t,!e.keysOnly&&e.valueMapper)}function Oi(e,t,r,i){var a=Ge(i?function(l,d,h){return r(i(l),d,h)}:r);return e.then(function(l){if(l)return l.start(function(){var d=function(){return l.continue()};t&&!t(l,function(h){return d=h},function(h){l.stop(h),d=pe},function(h){l.fail(h),d=pe})||a(l.value,l,function(h){return d=h}),d()})})}var Ba=(Te.prototype._read=function(e,t){var r=this._ctx;return r.error?r.table._trans(null,rt.bind(null,r.error)):r.table._trans("readonly",e).then(t)},Te.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,rt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},Te.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=sn(t.algorithm,e)},Te.prototype._iterate=function(e,t){return Zn(this._ctx,e,t,this._ctx.table.core)},Te.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&O(r,e),t._ctx=r,t},Te.prototype.raw=function(){return this._ctx.valueMapper=null,this},Te.prototype.each=function(e){var t=this._ctx;return this._read(function(r){return Zn(t,e,r,t.table.core)})},Te.prototype.count=function(e){var t=this;return this._read(function(r){var i=t._ctx,a=i.table.core;if(mn(i,!0))return a.count({trans:r,query:{index:$n(i,a.schema),range:i.range}}).then(function(d){return Math.min(d,i.limit)});var l=0;return Zn(i,function(){return++l,!1},r,a).then(function(){return l})}).then(e)},Te.prototype.sortBy=function(e,t){var r=e.split(".").reverse(),i=r[0],a=r.length-1;function l(g,m){return m?l(g[r[m]],m-1):g[i]}var d=this._ctx.dir==="next"?1:-1;function h(g,m){return Ae(l(g,a),l(m,a))*d}return this.toArray(function(g){return g.sort(h)}).then(t)},Te.prototype.toArray=function(e){var t=this;return this._read(function(r){var i=t._ctx;if(i.dir==="next"&&mn(i,!0)&&0<i.limit){var a=i.valueMapper,l=$n(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:l,range:i.range}}).then(function(h){return h=h.result,a?h.map(a):h})}var d=[];return Zn(i,function(h){return d.push(h)},r,i.table.core).then(function(){return d})},e)},Te.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,mn(t)?Rr(t,function(){var r=e;return function(i,a){return r===0||(r===1?--r:a(function(){i.advance(r),r=0}),!1)}}):Rr(t,function(){var r=e;return function(){return--r<0}})),this},Te.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Rr(this._ctx,function(){var t=e;return function(r,i,a){return--t<=0&&i(a),0<=t}},!0),this},Te.prototype.until=function(e,t){return Nr(this._ctx,function(r,i,a){return!e(r.value)||(i(a),t)}),this},Te.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},Te.prototype.last=function(e){return this.reverse().first(e)},Te.prototype.filter=function(e){var t;return Nr(this._ctx,function(r){return e(r.value)}),(t=this._ctx).isMatch=sn(t.isMatch,e),this},Te.prototype.and=function(e){return this.filter(e)},Te.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Te.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Te.prototype.desc=function(){return this.reverse()},Te.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.key,i)})},Te.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Te.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},Te.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(e)},Te.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&mn(t,!0)&&0<t.limit)return this._read(function(i){var a=$n(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:a,range:t.range}})}).then(function(i){return i.result}).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(e)},Te.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Te.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},Te.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Te.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return Nr(this._ctx,function(a){var i=a.primaryKey.toString(),a=j(t,i);return t[i]=!0,!a}),this},Te.prototype.modify=function(e){var t=this,r=this._ctx;return this._write(function(i){var a=typeof e=="function"?e:function(w){return Ii(w,e)},l=r.table.core,m=l.schema.primaryKey,d=m.outbound,h=m.extractKey,g=200,m=t.db._options.modifyChunkSize;m&&(g=typeof m=="object"?m[l.name]||m["*"]||200:m);function _(w,A){var I=A.failures,A=A.numFailures;x+=w-A;for(var D=0,R=v(I);D<R.length;D++){var z=R[D];p.push(I[z])}}var p=[],x=0,y=[],b=e===Ei;return t.clone().primaryKeys().then(function(w){function S(A){var D=Math.min(g,w.length-A),R=w.slice(A,A+D);return(b?Promise.resolve([]):l.getMany({trans:i,keys:R,cache:"immutable"})).then(function(z){var J=[],V=[],H=d?[]:null,Q=b?R:[];if(!b)for(var W=0;W<D;++W){var re=z[W],be={value:_e(re),primKey:w[A+W]};a.call(be,be.value,be)!==!1&&(be.value==null?Q.push(w[A+W]):d||Ae(h(re),h(be.value))===0?(V.push(be.value),d&&H.push(w[A+W])):(Q.push(w[A+W]),J.push(be.value)))}return Promise.resolve(0<J.length&&l.mutate({trans:i,type:"add",values:J}).then(function(we){for(var xe in we.failures)Q.splice(parseInt(xe),1);_(J.length,we)})).then(function(){return(0<V.length||I&&typeof e=="object")&&l.mutate({trans:i,type:"put",keys:H,values:V,criteria:I,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<A}).then(function(we){return _(V.length,we)})}).then(function(){return(0<Q.length||I&&b)&&l.mutate({trans:i,type:"delete",keys:Q,criteria:I,isAdditionalChunk:0<A}).then(function(we){return Xn(r.table,Q,we)}).then(function(we){return _(Q.length,we)})}).then(function(){return w.length>A+D&&S(A+g)})})}var I=mn(r)&&r.limit===1/0&&(typeof e!="function"||b)&&{index:r.index,range:r.range};return S(0).then(function(){if(0<p.length)throw new Xe("Error modifying one or more objects",p,x,y);return w.length})})})},Te.prototype.delete=function(){var e=this._ctx,t=e.range;return!mn(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(Ei):this._write(function(r){var i=e.table.core.schema.primaryKey,a=t;return e.table.core.count({trans:r,query:{index:i,range:a}}).then(function(l){return e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(g){var h=g.failures,g=g.numFailures;if(g)throw new Xe("Could not delete some values",Object.keys(h).map(function(m){return h[m]}),l-g);return l-g})})})},Te);function Te(){}var Ei=function(e,t){return t.value=null};function Va(e,t){return e<t?-1:e===t?0:1}function za(e,t){return t<e?-1:e===t?0:1}function At(e,t,r){return e=e instanceof Ti?new e.Collection(e):e,e._ctx.error=new(r||TypeError)(t),e}function yn(e){return new e.Collection(e,function(){return Di("")}).limit(0)}function er(e,t,r,i){var a,l,d,h,g,m,_,p=r.length;if(!r.every(function(b){return typeof b=="string"}))return At(e,wi);function x(b){a=b==="next"?function(S){return S.toUpperCase()}:function(S){return S.toLowerCase()},l=b==="next"?function(S){return S.toLowerCase()}:function(S){return S.toUpperCase()},d=b==="next"?Va:za;var w=r.map(function(S){return{lower:l(S),upper:a(S)}}).sort(function(S,I){return d(S.lower,I.lower)});h=w.map(function(S){return S.upper}),g=w.map(function(S){return S.lower}),_=(m=b)==="next"?"":i}x("next"),e=new e.Collection(e,function(){return Xt(h[0],g[p-1]+i)}),e._ondirectionchange=function(b){x(b)};var y=0;return e._addAlgorithm(function(b,w,S){var I=b.key;if(typeof I!="string")return!1;var A=l(I);if(t(A,g,y))return!0;for(var D=null,R=y;R<p;++R){var z=(function(J,V,H,Q,W,re){for(var be=Math.min(J.length,Q.length),we=-1,xe=0;xe<be;++xe){var Ot=V[xe];if(Ot!==Q[xe])return W(J[xe],H[xe])<0?J.substr(0,xe)+H[xe]+H.substr(xe+1):W(J[xe],Q[xe])<0?J.substr(0,xe)+Q[xe]+H.substr(xe+1):0<=we?J.substr(0,we)+V[we]+H.substr(we+1):null;W(J[xe],Ot)<0&&(we=xe)}return be<Q.length&&re==="next"?J+H.substr(J.length):be<J.length&&re==="prev"?J.substr(0,H.length):we<0?null:J.substr(0,we)+Q[we]+H.substr(we+1)})(I,A,h[R],g[R],d,m);z===null&&D===null?y=R+1:(D===null||0<d(D,z))&&(D=z)}return w(D!==null?function(){b.continue(D+_)}:S),!1}),e}function Xt(e,t,r,i){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:i}}function Di(e){return{type:1,lower:e,upper:e}}var Ti=(Object.defineProperty(vt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),vt.prototype.between=function(e,t,r,i){r=r!==!1,i=i===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(r||i)&&(!r||!i)?yn(this):new this.Collection(this,function(){return Xt(e,t,!r,!i)})}catch{return At(this,Ht)}},vt.prototype.equals=function(e){return e==null?At(this,Ht):new this.Collection(this,function(){return Di(e)})},vt.prototype.above=function(e){return e==null?At(this,Ht):new this.Collection(this,function(){return Xt(e,void 0,!0)})},vt.prototype.aboveOrEqual=function(e){return e==null?At(this,Ht):new this.Collection(this,function(){return Xt(e,void 0,!1)})},vt.prototype.below=function(e){return e==null?At(this,Ht):new this.Collection(this,function(){return Xt(void 0,e,!1,!0)})},vt.prototype.belowOrEqual=function(e){return e==null?At(this,Ht):new this.Collection(this,function(){return Xt(void 0,e)})},vt.prototype.startsWith=function(e){return typeof e!="string"?At(this,wi):this.between(e,e+on,!0,!0)},vt.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):er(this,function(t,r){return t.indexOf(r[0])===0},[e],on)},vt.prototype.equalsIgnoreCase=function(e){return er(this,function(t,r){return t===r[0]},[e],"")},vt.prototype.anyOfIgnoreCase=function(){var e=Ee.apply(ge,arguments);return e.length===0?yn(this):er(this,function(t,r){return r.indexOf(t)!==-1},e,"")},vt.prototype.startsWithAnyOfIgnoreCase=function(){var e=Ee.apply(ge,arguments);return e.length===0?yn(this):er(this,function(t,r){return r.some(function(i){return t.indexOf(i)===0})},e,on)},vt.prototype.anyOf=function(){var e=this,t=Ee.apply(ge,arguments),r=this._cmp;try{t.sort(r)}catch{return At(this,Ht)}if(t.length===0)return yn(this);var i=new this.Collection(this,function(){return Xt(t[0],t[t.length-1])});i._ondirectionchange=function(l){r=l==="next"?e._ascending:e._descending,t.sort(r)};var a=0;return i._addAlgorithm(function(l,d,h){for(var g=l.key;0<r(g,t[a]);)if(++a===t.length)return d(h),!1;return r(g,t[a])===0||(d(function(){l.continue(t[a])}),!1)}),i},vt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},vt.prototype.noneOf=function(){var e=Ee.apply(ge,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return At(this,Ht)}var t=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[-1/0,i]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},vt.prototype.inAnyRange=function(I,t){var r=this,i=this._cmp,a=this._ascending,l=this._descending,d=this._min,h=this._max;if(I.length===0)return yn(this);if(!I.every(function(A){return A[0]!==void 0&&A[1]!==void 0&&a(A[0],A[1])<=0}))return At(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ne.InvalidArgument);var g=!t||t.includeLowers!==!1,m=t&&t.includeUppers===!0,_,p=a;function x(A,D){return p(A[0],D[0])}try{(_=I.reduce(function(A,D){for(var R=0,z=A.length;R<z;++R){var J=A[R];if(i(D[0],J[1])<0&&0<i(D[1],J[0])){J[0]=d(J[0],D[0]),J[1]=h(J[1],D[1]);break}}return R===z&&A.push(D),A},[])).sort(x)}catch{return At(this,Ht)}var y=0,b=m?function(A){return 0<a(A,_[y][1])}:function(A){return 0<=a(A,_[y][1])},w=g?function(A){return 0<l(A,_[y][0])}:function(A){return 0<=l(A,_[y][0])},S=b,I=new this.Collection(this,function(){return Xt(_[0][0],_[_.length-1][1],!g,!m)});return I._ondirectionchange=function(A){p=A==="next"?(S=b,a):(S=w,l),_.sort(x)},I._addAlgorithm(function(A,D,R){for(var z,J=A.key;S(J);)if(++y===_.length)return D(R),!1;return!b(z=J)&&!w(z)||(r._cmp(J,_[y][1])===0||r._cmp(J,_[y][0])===0||D(function(){p===a?A.continue(_[y][0]):A.continue(_[y][1])}),!1)}),I},vt.prototype.startsWithAnyOf=function(){var e=Ee.apply(ge,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?yn(this):this.inAnyRange(e.map(function(t){return[t,t+on]})):At(this,"startsWithAnyOf() only works with strings")},vt);function vt(){}function jt(e){return Ge(function(t){return On(t),e(t.target.error),!1})}function On(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var En="storagemutated",Mr="x-storagemutated-1",$t=Pn(null,En),Ua=(Kt.prototype._lock=function(){return U(!le.global),++this._reculock,this._reculock!==1||le.global||(le.lockOwnerFor=this),this},Kt.prototype._unlock=function(){if(U(!le.global),--this._reculock==0)for(le.global||(le.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{an(e[1],e[0])}catch{}}return this},Kt.prototype._locked=function(){return this._reculock&&le.lockOwnerFor!==this},Kt.prototype.create=function(e){var t=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(U(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new ne.DatabaseClosed(i);case"MissingAPIError":throw new ne.MissingAPI(i.message,i);default:throw new ne.OpenFailed(i)}if(!this.active)throw new ne.TransactionInactive;return U(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ge(function(a){On(a),t._reject(e.error)}),e.onabort=Ge(function(a){On(a),t.active&&t._reject(new ne.Abort(e.error)),t.active=!1,t.on("abort").fire(a)}),e.oncomplete=Ge(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&$t.storagemutated.fire(e.mutatedParts)}),this},Kt.prototype._promise=function(e,t,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return rt(new ne.ReadOnly("Transaction is readonly"));if(!this.active)return rt(new ne.TransactionInactive);if(this._locked())return new $(function(l,d){i._blockedFuncs.push([function(){i._promise(e,t,r).then(l,d)},le])});if(r)return Yt(function(){var l=new $(function(d,h){i._lock();var g=t(d,h,i);g&&g.then&&g.then(d,h)});return l.finally(function(){return i._unlock()}),l._lib=!0,l});var a=new $(function(l,d){var h=t(l,d,i);h&&h.then&&h.then(l,d)});return a._lib=!0,a},Kt.prototype._root=function(){return this.parent?this.parent._root():this},Kt.prototype.waitFor=function(e){var t,r=this._root(),i=$.resolve(e);r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return i}):(r._waitingFor=i,r._waitingQueue=[],t=r.idbtrans.objectStore(r.storeNames[0]),(function l(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(t.get(-1/0).onsuccess=l)})());var a=r._waitingFor;return new $(function(l,d){i.then(function(h){return r._waitingQueue.push(Ge(l.bind(null,h)))},function(h){return r._waitingQueue.push(Ge(d.bind(null,h)))}).finally(function(){r._waitingFor===a&&(r._waitingFor=null)})})},Kt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ne.Abort))},Kt.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(j(t,e))return t[e];var r=this.schema[e];if(!r)throw new ne.NotFound("Table "+e+" not part of transaction");return r=new this.db.Table(e,r,this),r.core=this.db.core.table(e),t[e]=r},Kt);function Kt(){}function Lr(e,t,r,i,a,l,d,h){return{name:e,keyPath:t,unique:r,multi:i,auto:a,compound:l,src:(r&&!d?"&":"")+(i?"*":"")+(a?"++":"")+Fi(t),type:h}}function Fi(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function jr(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:(i=function(a){return[a.name,a]},r.reduce(function(a,l,d){return d=i(l,d),d&&(a[d[0]]=d[1]),a},{}))};var i}var Dn=function(e){try{return e.only([[]]),Dn=function(){return[[]]},[[]]}catch{return Dn=function(){return on},on}};function Kr(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(r){return r[t]}:function(r){return te(r,t)}:function(r){return te(r,e)};var t}function Ni(e){return[].slice.call(e)}var Ha=0;function Tn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Ga(e,t,g){function i(S){if(S.type===3)return null;if(S.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var y=S.lower,b=S.upper,w=S.lowerOpen,S=S.upperOpen;return y===void 0?b===void 0?null:t.upperBound(b,!!S):b===void 0?t.lowerBound(y,!!w):t.bound(y,b,!!w,!!S)}function a(x){var y,b=x.name;return{name:b,schema:x,mutate:function(w){var S=w.trans,I=w.type,A=w.keys,D=w.values,R=w.range;return new Promise(function(z,J){z=Ge(z);var V=S.objectStore(b),H=V.keyPath==null,Q=I==="put"||I==="add";if(!Q&&I!=="delete"&&I!=="deleteRange")throw new Error("Invalid operation type: "+I);var W,re=(A||D||{length:1}).length;if(A&&D&&A.length!==D.length)throw new Error("Given keys array must have same length as given values array.");if(re===0)return z({numFailures:0,failures:{},results:[],lastResult:void 0});function be(_t){++Ot,On(_t)}var we=[],xe=[],Ot=0;if(I==="deleteRange"){if(R.type===4)return z({numFailures:Ot,failures:xe,results:[],lastResult:void 0});R.type===3?we.push(W=V.clear()):we.push(W=V.delete(i(R)))}else{var H=Q?H?[D,A]:[D,null]:[A,null],me=H[0],yt=H[1];if(Q)for(var bt=0;bt<re;++bt)we.push(W=yt&&yt[bt]!==void 0?V[I](me[bt],yt[bt]):V[I](me[bt])),W.onerror=be;else for(bt=0;bt<re;++bt)we.push(W=V[I](me[bt])),W.onerror=be}function fr(_t){_t=_t.target.result,we.forEach(function(cn,ri){return cn.error!=null&&(xe[ri]=cn.error)}),z({numFailures:Ot,failures:xe,results:I==="delete"?A:we.map(function(cn){return cn.result}),lastResult:_t})}W.onerror=function(_t){be(_t),fr(_t)},W.onsuccess=fr})},getMany:function(w){var S=w.trans,I=w.keys;return new Promise(function(A,D){A=Ge(A);for(var R,z=S.objectStore(b),J=I.length,V=new Array(J),H=0,Q=0,W=function(we){we=we.target,V[we._pos]=we.result,++Q===H&&A(V)},re=jt(D),be=0;be<J;++be)I[be]!=null&&((R=z.get(I[be]))._pos=be,R.onsuccess=W,R.onerror=re,++H);H===0&&A(V)})},get:function(w){var S=w.trans,I=w.key;return new Promise(function(A,D){A=Ge(A);var R=S.objectStore(b).get(I);R.onsuccess=function(z){return A(z.target.result)},R.onerror=jt(D)})},query:(y=m,function(w){return new Promise(function(S,I){S=Ge(S);var A,D,R,H=w.trans,z=w.values,J=w.limit,W=w.query,V=J===1/0?void 0:J,Q=W.index,W=W.range,H=H.objectStore(b),Q=Q.isPrimaryKey?H:H.index(Q.name),W=i(W);if(J===0)return S({result:[]});y?((V=z?Q.getAll(W,V):Q.getAllKeys(W,V)).onsuccess=function(re){return S({result:re.target.result})},V.onerror=jt(I)):(A=0,D=!z&&"openKeyCursor"in Q?Q.openKeyCursor(W):Q.openCursor(W),R=[],D.onsuccess=function(re){var be=D.result;return be?(R.push(z?be.value:be.primaryKey),++A===J?S({result:R}):void be.continue()):S({result:R})},D.onerror=jt(I))})}),openCursor:function(w){var S=w.trans,I=w.values,A=w.query,D=w.reverse,R=w.unique;return new Promise(function(z,J){z=Ge(z);var Q=A.index,V=A.range,H=S.objectStore(b),H=Q.isPrimaryKey?H:H.index(Q.name),Q=D?R?"prevunique":"prev":R?"nextunique":"next",W=!I&&"openKeyCursor"in H?H.openKeyCursor(i(V),Q):H.openCursor(i(V),Q);W.onerror=jt(J),W.onsuccess=Ge(function(re){var be,we,xe,Ot,me=W.result;me?(me.___id=++Ha,me.done=!1,be=me.continue.bind(me),we=(we=me.continuePrimaryKey)&&we.bind(me),xe=me.advance.bind(me),Ot=function(){throw new Error("Cursor not stopped")},me.trans=S,me.stop=me.continue=me.continuePrimaryKey=me.advance=function(){throw new Error("Cursor not started")},me.fail=Ge(J),me.next=function(){var yt=this,bt=1;return this.start(function(){return bt--?yt.continue():yt.stop()}).then(function(){return yt})},me.start=function(yt){function bt(){if(W.result)try{yt()}catch(_t){me.fail(_t)}else me.done=!0,me.start=function(){throw new Error("Cursor behind last entry")},me.stop()}var fr=new Promise(function(_t,cn){_t=Ge(_t),W.onerror=jt(cn),me.fail=cn,me.stop=function(ri){me.stop=me.continue=me.continuePrimaryKey=me.advance=Ot,_t(ri)}});return W.onsuccess=Ge(function(_t){W.onsuccess=bt,bt()}),me.continue=be,me.continuePrimaryKey=we,me.advance=xe,bt(),fr},z(me)):z(null)},J)})},count:function(w){var S=w.query,I=w.trans,A=S.index,D=S.range;return new Promise(function(R,z){var J=I.objectStore(b),V=A.isPrimaryKey?J:J.index(A.name),J=i(D),V=J?V.count(J):V.count();V.onsuccess=Ge(function(H){return R(H.target.result)}),V.onerror=jt(z)})}}}var l,d,h,_=(d=g,h=Ni((l=e).objectStoreNames),{schema:{name:l.name,tables:h.map(function(x){return d.objectStore(x)}).map(function(x){var y=x.keyPath,S=x.autoIncrement,b=k(y),w={},S={name:x.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y==null,compound:b,keyPath:y,autoIncrement:S,unique:!0,extractKey:Kr(y)},indexes:Ni(x.indexNames).map(function(I){return x.index(I)}).map(function(R){var A=R.name,D=R.unique,z=R.multiEntry,R=R.keyPath,z={name:A,compound:k(R),keyPath:R,unique:D,multiEntry:z,extractKey:Kr(R)};return w[Tn(R)]=z}),getIndexByKeyPath:function(I){return w[Tn(I)]}};return w[":id"]=S.primaryKey,y!=null&&(w[Tn(y)]=S.primaryKey),S})},hasGetAll:0<h.length&&"getAll"in d.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),g=_.schema,m=_.hasGetAll,_=g.tables.map(a),p={};return _.forEach(function(x){return p[x.name]=x}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(x){if(!p[x])throw new Error("Table '".concat(x,"' not found"));return p[x]},MIN_KEY:-1/0,MAX_KEY:Dn(t),schema:g}}function Wa(e,t,r,i){var a=r.IDBKeyRange;return r.indexedDB,{dbcore:(i=Ga(t,a,i),e.dbcore.reduce(function(l,d){return d=d.create,s(s({},l),d(l))},i))}}function tr(e,i){var r=i.db,i=Wa(e._middlewares,r,e._deps,i);e.core=i.dbcore,e.tables.forEach(function(a){var l=a.name;e.core.schema.tables.some(function(d){return d.name===l})&&(a.core=e.core.table(l),e[l]instanceof e.Table&&(e[l].core=a.core))})}function nr(e,t,r,i){r.forEach(function(a){var l=i[a];t.forEach(function(d){var h=(function g(m,_){return B(m,_)||(m=P(m))&&g(m,_)})(d,a);(!h||"value"in h&&h.value===void 0)&&(d===e.Transaction.prototype||d instanceof e.Transaction?M(d,a,{get:function(){return this.table(a)},set:function(g){Y(this,a,{value:g,writable:!0,configurable:!0,enumerable:!0})}}):d[a]=new e.Table(a,l))})})}function qr(e,t){t.forEach(function(r){for(var i in r)r[i]instanceof e.Table&&delete r[i]})}function Ya(e,t){return e._cfg.version-t._cfg.version}function Ja(e,t,r,i){var a=e._dbSchema;r.objectStoreNames.contains("$meta")&&!a.$meta&&(a.$meta=jr("$meta",Mi("")[0],[]),e._storeNames.push("$meta"));var l=e._createTransaction("readwrite",e._storeNames,a);l.create(r),l._completion.catch(i);var d=l._reject.bind(l),h=le.transless||le;Yt(function(){return le.trans=l,le.transless=h,t!==0?(tr(e,r),m=t,((g=l).storeNames.includes("$meta")?g.table("$meta").get("version").then(function(_){return _??m}):$.resolve(m)).then(function(_){return x=_,y=l,b=r,w=[],_=(p=e)._versions,S=p._dbSchema=ir(0,p.idbdb,b),(_=_.filter(function(I){return I._cfg.version>=x})).length!==0?(_.forEach(function(I){w.push(function(){var A=S,D=I._cfg.dbschema;ar(p,A,b),ar(p,D,b),S=p._dbSchema=D;var R=Br(A,D);R.add.forEach(function(Q){Vr(b,Q[0],Q[1].primKey,Q[1].indexes)}),R.change.forEach(function(Q){if(Q.recreate)throw new ne.Upgrade("Not yet support for changing primary key");var W=b.objectStore(Q.name);Q.add.forEach(function(re){return rr(W,re)}),Q.change.forEach(function(re){W.deleteIndex(re.name),rr(W,re)}),Q.del.forEach(function(re){return W.deleteIndex(re)})});var z=I._cfg.contentUpgrade;if(z&&I._cfg.version>x){tr(p,b),y._memoizedTables={};var J=he(D);R.del.forEach(function(Q){J[Q]=A[Q]}),qr(p,[p.Transaction.prototype]),nr(p,[p.Transaction.prototype],v(J),J),y.schema=J;var V,H=at(z);return H&&pn(),R=$.follow(function(){var Q;(V=z(y))&&H&&(Q=Jt.bind(null,null),V.then(Q,Q))}),V&&typeof V.then=="function"?$.resolve(V):R.then(function(){return V})}}),w.push(function(A){var D,R,z=I._cfg.dbschema;D=z,R=A,[].slice.call(R.db.objectStoreNames).forEach(function(J){return D[J]==null&&R.db.deleteObjectStore(J)}),qr(p,[p.Transaction.prototype]),nr(p,[p.Transaction.prototype],p._storeNames,p._dbSchema),y.schema=p._dbSchema}),w.push(function(A){p.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(p.idbdb.version/10)===I._cfg.version?(p.idbdb.deleteObjectStore("$meta"),delete p._dbSchema.$meta,p._storeNames=p._storeNames.filter(function(D){return D!=="$meta"})):A.objectStore("$meta").put(I._cfg.version,"version"))})}),(function I(){return w.length?$.resolve(w.shift()(y.idbtrans)).then(I):$.resolve()})().then(function(){Ri(S,b)})):$.resolve();var p,x,y,b,w,S}).catch(d)):(v(a).forEach(function(_){Vr(r,_,a[_].primKey,a[_].indexes)}),tr(e,r),void $.follow(function(){return e.on.populate.fire(l)}).catch(d));var g,m})}function Qa(e,t){Ri(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var r=ir(0,e.idbdb,t);ar(e,e._dbSchema,t);for(var i=0,a=Br(r,e._dbSchema).change;i<a.length;i++){var l=(function(d){if(d.change.length||d.recreate)return console.warn("Unable to patch indexes of table ".concat(d.name," because it has changes on the type of index or primary key.")),{value:void 0};var h=t.objectStore(d.name);d.add.forEach(function(g){He&&console.debug("Dexie upgrade patch: Creating missing index ".concat(d.name,".").concat(g.src)),rr(h,g)})})(a[i]);if(typeof l=="object")return l.value}}function Br(e,t){var r,i={del:[],add:[],change:[]};for(r in e)t[r]||i.del.push(r);for(r in t){var a=e[r],l=t[r];if(a){var d={name:r,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||a.primKey.auto!==l.primKey.auto)d.recreate=!0,i.change.push(d);else{var h=a.idxByName,g=l.idxByName,m=void 0;for(m in h)g[m]||d.del.push(m);for(m in g){var _=h[m],p=g[m];_?_.src!==p.src&&d.change.push(p):d.add.push(p)}(0<d.del.length||0<d.add.length||0<d.change.length)&&i.change.push(d)}}else i.add.push([r,l])}return i}function Vr(e,t,r,i){var a=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return i.forEach(function(l){return rr(a,l)}),a}function Ri(e,t){v(e).forEach(function(r){t.db.objectStoreNames.contains(r)||(He&&console.debug("Dexie: Creating missing table",r),Vr(t,r,e[r].primKey,e[r].indexes))})}function rr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function ir(e,t,r){var i={};return q(t.objectStoreNames,0).forEach(function(a){for(var l=r.objectStore(a),d=Lr(Fi(m=l.keyPath),m||"",!0,!1,!!l.autoIncrement,m&&typeof m!="string",!0),h=[],g=0;g<l.indexNames.length;++g){var _=l.index(l.indexNames[g]),m=_.keyPath,_=Lr(_.name,m,!!_.unique,!!_.multiEntry,!1,m&&typeof m!="string",!1);h.push(_)}i[a]=jr(a,d,h)}),i}function ar(e,t,r){for(var i=r.db.objectStoreNames,a=0;a<i.length;++a){var l=i[a],d=r.objectStore(l);e._hasGetAll="getAll"in d;for(var h=0;h<d.indexNames.length;++h){var g=d.indexNames[h],m=d.index(g).keyPath,_=typeof m=="string"?m:"["+q(m).join("+")+"]";!t[l]||(m=t[l].idxByName[_])&&(m.name=g,delete t[l].idxByName[_],t[l].idxByName[g]=m)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&f.WorkerGlobalScope&&f instanceof f.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Mi(e){return e.split(",").map(function(t,r){var l=t.split(":"),i=(a=l[1])===null||a===void 0?void 0:a.trim(),a=(t=l[0].trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return Lr(a,l||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),k(l),r===0,i)})}var Xa=(bn.prototype._createTableSchema=jr,bn.prototype._parseIndexSyntax=Mi,bn.prototype._parseStoresSpec=function(e,t){var r=this;v(e).forEach(function(i){if(e[i]!==null){var a=r._parseIndexSyntax(e[i]),l=a.shift();if(!l)throw new ne.Schema("Invalid schema for table "+i+": "+e[i]);if(l.unique=!0,l.multi)throw new ne.Schema("Primary key cannot be multiEntry*");a.forEach(function(d){if(d.auto)throw new ne.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new ne.Schema("Index must have a name and cannot be an empty string")}),a=r._createTableSchema(i,l,a),t[i]=a}})},bn.prototype.stores=function(r){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?O(this._cfg.storesSource,r):r;var r=t._versions,i={},a={};return r.forEach(function(l){O(i,l._cfg.storesSource),a=l._cfg.dbschema={},l._parseStoresSpec(i,a)}),t._dbSchema=a,qr(t,[t._allTables,t,t.Transaction.prototype]),nr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],v(a),a),t._storeNames=v(a),this},bn.prototype.upgrade=function(e){return this._cfg.contentUpgrade=lt(this._cfg.contentUpgrade||pe,e),this},bn);function bn(){}function zr(e,t){var r=e._dbNamesDB;return r||(r=e._dbNamesDB=new Gt(Jn,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function Ur(e){return e&&typeof e.databases=="function"}function Hr(e){return Yt(function(){return le.letThrough=!0,e()})}function Gr(e){return!("from"in e)}var mt=function(e,t){if(!this){var r=new mt;return e&&"d"in e&&O(r,e),r}O(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Fn(e,t,r){var i=Ae(t,r);if(!isNaN(i)){if(0<i)throw RangeError();if(Gr(e))return O(e,{from:t,to:r,d:1});var a=e.l,i=e.r;if(Ae(r,e.from)<0)return a?Fn(a,t,r):e.l={from:t,to:r,d:1,l:null,r:null},ji(e);if(0<Ae(t,e.to))return i?Fn(i,t,r):e.r={from:t,to:r,d:1,l:null,r:null},ji(e);Ae(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),0<Ae(r,e.to)&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1),r=!e.r,a&&!e.l&&Nn(e,a),i&&r&&Nn(e,i)}}function Nn(e,t){Gr(t)||(function r(i,g){var l=g.from,d=g.to,h=g.l,g=g.r;Fn(i,l,d),h&&r(i,h),g&&r(i,g)})(e,t)}function Li(e,t){var r=or(t),i=r.next();if(i.done)return!1;for(var a=i.value,l=or(e),d=l.next(a.from),h=d.value;!i.done&&!d.done;){if(Ae(h.from,a.to)<=0&&0<=Ae(h.to,a.from))return!0;Ae(a.from,h.from)<0?a=(i=r.next(h.from)).value:h=(d=l.next(a.from)).value}return!1}function or(e){var t=Gr(e)?null:{s:0,n:e};return{next:function(r){for(var i=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,i)for(;t.n.l&&Ae(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!i||Ae(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function ji(e){var t,r,i=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),a=1<i?"r":i<-1?"l":"";a&&(t=a=="r"?"l":"r",r=s({},e),i=e[a],e.from=i.from,e.to=i.to,e[a]=i[a],r[a]=i[t],(e[t]=r).d=Ki(r)),e.d=Ki(e)}function Ki(r){var t=r.r,r=r.l;return(t?r?Math.max(t.d,r.d):t.d:r?r.d:0)+1}function sr(e,t){return v(t).forEach(function(r){e[r]?Nn(e[r],t[r]):e[r]=(function i(a){var l,d,h={};for(l in a)j(a,l)&&(d=a[l],h[l]=!d||typeof d!="object"||ye.has(d.constructor)?d:i(d));return h})(t[r])}),e}function Wr(e,t){return e.all||t.all||Object.keys(e).some(function(r){return t[r]&&Li(t[r],e[r])})}L(mt.prototype,((Dt={add:function(e){return Nn(this,e),this},addKey:function(e){return Fn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(r){return Fn(t,r,r)}),this},hasKey:function(e){var t=or(this).next(e).value;return t&&Ae(t.from,e)<=0&&0<=Ae(t.to,e)}})[Qe]=function(){return or(this)},Dt));var ln={},Yr={},Jr=!1;function lr(e){sr(Yr,e),Jr||(Jr=!0,setTimeout(function(){Jr=!1,Qr(Yr,!(Yr={}))},0))}function Qr(e,t){t===void 0&&(t=!1);var r=new Set;if(e.all)for(var i=0,a=Object.values(ln);i<a.length;i++)qi(d=a[i],e,r,t);else for(var l in e){var d,h=/^idb\:\/\/(.*)\/(.*)\//.exec(l);h&&(l=h[1],h=h[2],(d=ln["idb://".concat(l,"/").concat(h)])&&qi(d,e,r,t))}r.forEach(function(g){return g()})}function qi(e,t,r,i){for(var a=[],l=0,d=Object.entries(e.queries.query);l<d.length;l++){for(var h=d[l],g=h[0],m=[],_=0,p=h[1];_<p.length;_++){var x=p[_];Wr(t,x.obsSet)?x.subscribers.forEach(function(S){return r.add(S)}):i&&m.push(x)}i&&a.push([g,m])}if(i)for(var y=0,b=a;y<b.length;y++){var w=b[y],g=w[0],m=w[1];e.queries.query[g]=m}}function $a(e){var t=e._state,r=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?rt(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var i=t.openCanceller,a=Math.round(10*e.verno),l=!1;function d(){if(t.openCanceller!==i)throw new ne.DatabaseClosed("db.open() was cancelled")}function h(){return new $(function(x,y){if(d(),!r)throw new ne.MissingAPI;var b=e.name,w=t.autoSchema||!a?r.open(b):r.open(b,a);if(!w)throw new ne.MissingAPI;w.onerror=jt(y),w.onblocked=Ge(e._fireOnBlocked),w.onupgradeneeded=Ge(function(S){var I;_=w.transaction,t.autoSchema&&!e._options.allowEmptyDB?(w.onerror=On,_.abort(),w.result.close(),(I=r.deleteDatabase(b)).onsuccess=I.onerror=Ge(function(){y(new ne.NoSuchDatabase("Database ".concat(b," doesnt exist")))})):(_.onerror=jt(y),S=S.oldVersion>Math.pow(2,62)?0:S.oldVersion,p=S<1,e.idbdb=w.result,l&&Qa(e,_),Ja(e,S/10,_,y))},y),w.onsuccess=Ge(function(){_=null;var S,I,A,D,R,z=e.idbdb=w.result,J=q(z.objectStoreNames);if(0<J.length)try{var V=z.transaction((D=J).length===1?D[0]:D,"readonly");if(t.autoSchema)I=z,A=V,(S=e).verno=I.version/10,A=S._dbSchema=ir(0,I,A),S._storeNames=q(I.objectStoreNames,0),nr(S,[S._allTables],v(A),A);else if(ar(e,e._dbSchema,V),((R=Br(ir(0,(R=e).idbdb,V),R._dbSchema)).add.length||R.change.some(function(H){return H.add.length||H.change.length}))&&!l)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),z.close(),a=z.version+1,l=!0,x(h());tr(e,V)}catch{}gn.push(e),z.onversionchange=Ge(function(H){t.vcFired=!0,e.on("versionchange").fire(H)}),z.onclose=Ge(function(){e.close({disableAutoOpen:!1})}),p&&(R=e._deps,V=b,z=R.indexedDB,R=R.IDBKeyRange,Ur(z)||V===Jn||zr(z,R).put({name:V}).catch(pe)),x()},y)}).catch(function(x){switch(x?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),h();break;case"VersionError":if(0<a)return a=0,h()}return $.reject(x)})}var g,m=t.dbReadyResolve,_=null,p=!1;return $.race([i,(typeof navigator>"u"?$.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(x){function y(){return indexedDB.databases().finally(x)}g=setInterval(y,100),y()}).finally(function(){return clearInterval(g)}):Promise.resolve()).then(h)]).then(function(){return d(),t.onReadyBeingFired=[],$.resolve(Hr(function(){return e.on.ready.fire(e.vip)})).then(function x(){if(0<t.onReadyBeingFired.length){var y=t.onReadyBeingFired.reduce(lt,pe);return t.onReadyBeingFired=[],$.resolve(Hr(function(){return y(e.vip)})).then(x)}})}).finally(function(){t.openCanceller===i&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(x){t.dbOpenError=x;try{_&&_.abort()}catch{}return i===t.openCanceller&&e._close(),rt(x)}).finally(function(){t.openComplete=!0,m()}).then(function(){var x;return p&&(x={},e.tables.forEach(function(y){y.schema.indexes.forEach(function(b){b.name&&(x["idb://".concat(e.name,"/").concat(y.name,"/").concat(b.name)]=new mt(-1/0,[[[]]]))}),x["idb://".concat(e.name,"/").concat(y.name,"/")]=x["idb://".concat(e.name,"/").concat(y.name,"/:dels")]=new mt(-1/0,[[[]]])}),$t(En).fire(x),Qr(x,!0)),e})}function Xr(e){function t(l){return e.next(l)}var r=a(t),i=a(function(l){return e.throw(l)});function a(l){return function(g){var h=l(g),g=h.value;return h.done?g:g&&typeof g.then=="function"?g.then(r,i):k(g)?Promise.all(g).then(r,i):r(g)}}return a(t)()}function ur(e,t,r){for(var i=k(e)?e.slice():[e],a=0;a<r;++a)i.push(t);return i}var Za={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return s(s({},e),{table:function(t){var r=e.table(t),i=r.schema,a={},l=[];function d(p,x,y){var b=Tn(p),w=a[b]=a[b]||[],S=p==null?0:typeof p=="string"?1:p.length,I=0<x,I=s(s({},y),{name:I?"".concat(b,"(virtual-from:").concat(y.name,")"):y.name,lowLevelIndex:y,isVirtual:I,keyTail:x,keyLength:S,extractKey:Kr(p),unique:!I&&y.unique});return w.push(I),I.isPrimaryKey||l.push(I),1<S&&d(S===2?p[0]:p.slice(0,S-1),x+1,y),w.sort(function(A,D){return A.keyTail-D.keyTail}),I}t=d(i.primaryKey.keyPath,0,i.primaryKey),a[":id"]=[t];for(var h=0,g=i.indexes;h<g.length;h++){var m=g[h];d(m.keyPath,0,m)}function _(p){var x,y=p.query.index;return y.isVirtual?s(s({},p),{query:{index:y.lowLevelIndex,range:(x=p.query.range,y=y.keyTail,{type:x.type===1?2:x.type,lower:ur(x.lower,x.lowerOpen?e.MAX_KEY:e.MIN_KEY,y),lowerOpen:!0,upper:ur(x.upper,x.upperOpen?e.MIN_KEY:e.MAX_KEY,y),upperOpen:!0})}}):p}return s(s({},r),{schema:s(s({},i),{primaryKey:t,indexes:l,getIndexByKeyPath:function(p){return(p=a[Tn(p)])&&p[0]}}),count:function(p){return r.count(_(p))},query:function(p){return r.query(_(p))},openCursor:function(p){var x=p.query.index,y=x.keyTail,b=x.isVirtual,w=x.keyLength;return b?r.openCursor(_(p)).then(function(I){return I&&S(I)}):r.openCursor(p);function S(I){return Object.create(I,{continue:{value:function(A){A!=null?I.continue(ur(A,p.reverse?e.MAX_KEY:e.MIN_KEY,y)):p.unique?I.continue(I.key.slice(0,w).concat(p.reverse?e.MIN_KEY:e.MAX_KEY,y)):I.continue()}},continuePrimaryKey:{value:function(A,D){I.continuePrimaryKey(ur(A,e.MAX_KEY,y),D)}},primaryKey:{get:function(){return I.primaryKey}},key:{get:function(){var A=I.key;return w===1?A[0]:A.slice(0,w)}},value:{get:function(){return I.value}}})}}})}})}};function $r(e,t,r,i){return r=r||{},i=i||"",v(e).forEach(function(a){var l,d,h;j(t,a)?(l=e[a],d=t[a],typeof l=="object"&&typeof d=="object"&&l&&d?(h=ze(l))!==ze(d)?r[i+a]=t[a]:h==="Object"?$r(l,d,r,i+a+"."):l!==d&&(r[i+a]=t[a]):l!==d&&(r[i+a]=t[a])):r[i+a]=void 0}),v(t).forEach(function(a){j(e,a)||(r[i+a]=t[a])}),r}function Zr(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var eo={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return s(s({},e),{table:function(t){var r=e.table(t),i=r.schema.primaryKey;return s(s({},r),{mutate:function(a){var l=le.trans,d=l.table(t).hook,h=d.deleting,g=d.creating,m=d.updating;switch(a.type){case"add":if(g.fire===pe)break;return l._promise("readwrite",function(){return _(a)},!0);case"put":if(g.fire===pe&&m.fire===pe)break;return l._promise("readwrite",function(){return _(a)},!0);case"delete":if(h.fire===pe)break;return l._promise("readwrite",function(){return _(a)},!0);case"deleteRange":if(h.fire===pe)break;return l._promise("readwrite",function(){return(function p(x,y,b){return r.query({trans:x,values:!1,query:{index:i,range:y},limit:b}).then(function(w){var S=w.result;return _({type:"delete",keys:S,trans:x}).then(function(I){return 0<I.numFailures?Promise.reject(I.failures[0]):S.length<b?{failures:[],numFailures:0,lastResult:void 0}:p(x,s(s({},y),{lower:S[S.length-1],lowerOpen:!0}),b)})})})(a.trans,a.range,1e4)},!0)}return r.mutate(a);function _(p){var x,y,b,w=le.trans,S=p.keys||Zr(i,p);if(!S)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?s(s({},p),{keys:S}):s({},p)).type!=="delete"&&(p.values=c([],p.values)),p.keys&&(p.keys=c([],p.keys)),x=r,b=S,((y=p).type==="add"?Promise.resolve([]):x.getMany({trans:y.trans,keys:b,cache:"immutable"})).then(function(I){var A=S.map(function(D,R){var z,J,V,H=I[R],Q={onerror:null,onsuccess:null};return p.type==="delete"?h.fire.call(Q,D,H,w):p.type==="add"||H===void 0?(z=g.fire.call(Q,D,p.values[R],w),D==null&&z!=null&&(p.keys[R]=D=z,i.outbound||se(p.values[R],i.keyPath,D))):(z=$r(H,p.values[R]),(J=m.fire.call(Q,z,D,H,w))&&(V=p.values[R],Object.keys(J).forEach(function(W){j(V,W)?V[W]=J[W]:se(V,W,J[W])}))),Q});return r.mutate(p).then(function(D){for(var R=D.failures,z=D.results,J=D.numFailures,D=D.lastResult,V=0;V<S.length;++V){var H=(z||S)[V],Q=A[V];H==null?Q.onerror&&Q.onerror(R[V]):Q.onsuccess&&Q.onsuccess(p.type==="put"&&I[V]?p.values[V]:H)}return{failures:R,results:z,numFailures:J,lastResult:D}}).catch(function(D){return A.forEach(function(R){return R.onerror&&R.onerror(D)}),Promise.reject(D)})})}}})}})}};function Bi(e,t,r){try{if(!t||t.keys.length<e.length)return null;for(var i=[],a=0,l=0;a<t.keys.length&&l<e.length;++a)Ae(t.keys[a],e[l])===0&&(i.push(r?_e(t.values[a]):t.values[a]),++l);return i.length===e.length?i:null}catch{return null}}var to={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var r=e.table(t);return s(s({},r),{getMany:function(i){if(!i.cache)return r.getMany(i);var a=Bi(i.keys,i.trans._cache,i.cache==="clone");return a?$.resolve(a):r.getMany(i).then(function(l){return i.trans._cache={keys:i.keys,values:i.cache==="clone"?_e(l):l},l})},mutate:function(i){return i.type!=="add"&&(i.trans._cache=null),r.mutate(i)}})}}}};function Vi(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function zi(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var no={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,r=new mt(e.MIN_KEY,e.MAX_KEY);return s(s({},e),{transaction:function(i,a,l){if(le.subscr&&a!=="readonly")throw new ne.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(le.querier));return e.transaction(i,a,l)},table:function(i){var a=e.table(i),l=a.schema,d=l.primaryKey,p=l.indexes,h=d.extractKey,g=d.outbound,m=d.autoIncrement&&p.filter(function(y){return y.compound&&y.keyPath.includes(d.keyPath)}),_=s(s({},a),{mutate:function(y){function b(W){return W="idb://".concat(t,"/").concat(i,"/").concat(W),D[W]||(D[W]=new mt)}var w,S,I,A=y.trans,D=y.mutatedParts||(y.mutatedParts={}),R=b(""),z=b(":dels"),J=y.type,Q=y.type==="deleteRange"?[y.range]:y.type==="delete"?[y.keys]:y.values.length<50?[Zr(d,y).filter(function(W){return W}),y.values]:[],V=Q[0],H=Q[1],Q=y.trans._cache;return k(V)?(R.addKeys(V),(Q=J==="delete"||V.length===H.length?Bi(V,Q):null)||z.addKeys(V),(Q||H)&&(w=b,S=Q,I=H,l.indexes.forEach(function(W){var re=w(W.name||"");function be(xe){return xe!=null?W.extractKey(xe):null}function we(xe){return W.multiEntry&&k(xe)?xe.forEach(function(Ot){return re.addKey(Ot)}):re.addKey(xe)}(S||I).forEach(function(xe,yt){var me=S&&be(S[yt]),yt=I&&be(I[yt]);Ae(me,yt)!==0&&(me!=null&&we(me),yt!=null&&we(yt))})}))):V?(H={from:(H=V.lower)!==null&&H!==void 0?H:e.MIN_KEY,to:(H=V.upper)!==null&&H!==void 0?H:e.MAX_KEY},z.add(H),R.add(H)):(R.add(r),z.add(r),l.indexes.forEach(function(W){return b(W.name).add(r)})),a.mutate(y).then(function(W){return!V||y.type!=="add"&&y.type!=="put"||(R.addKeys(W.results),m&&m.forEach(function(re){for(var be=y.values.map(function(me){return re.extractKey(me)}),we=re.keyPath.findIndex(function(me){return me===d.keyPath}),xe=0,Ot=W.results.length;xe<Ot;++xe)be[xe][we]=W.results[xe];b(re.name).addKeys(be)})),A.mutatedParts=sr(A.mutatedParts||{},D),W})}}),p=function(b){var w=b.query,b=w.index,w=w.range;return[b,new mt((b=w.lower)!==null&&b!==void 0?b:e.MIN_KEY,(w=w.upper)!==null&&w!==void 0?w:e.MAX_KEY)]},x={get:function(y){return[d,new mt(y.key)]},getMany:function(y){return[d,new mt().addKeys(y.keys)]},count:p,query:p,openCursor:p};return v(x).forEach(function(y){_[y]=function(b){var w=le.subscr,S=!!w,I=Vi(le,a)&&zi(y,b)?b.obsSet={}:w;if(S){var A=function(H){return H="idb://".concat(t,"/").concat(i,"/").concat(H),I[H]||(I[H]=new mt)},D=A(""),R=A(":dels"),w=x[y](b),S=w[0],w=w[1];if((y==="query"&&S.isPrimaryKey&&!b.values?R:A(S.name||"")).add(w),!S.isPrimaryKey){if(y!=="count"){var z=y==="query"&&g&&b.values&&a.query(s(s({},b),{values:!1}));return a[y].apply(this,arguments).then(function(H){if(y==="query"){if(g&&b.values)return z.then(function(be){return be=be.result,D.addKeys(be),H});var Q=b.values?H.result.map(h):H.result;(b.values?D:R).addKeys(Q)}else if(y==="openCursor"){var W=H,re=b.values;return W&&Object.create(W,{key:{get:function(){return R.addKey(W.primaryKey),W.key}},primaryKey:{get:function(){var be=W.primaryKey;return R.addKey(be),be}},value:{get:function(){return re&&D.addKey(W.primaryKey),W.value}}})}return H})}R.add(r)}}return a[y].apply(this,arguments)}}),_}})}};function Ui(e,t,r){if(r.numFailures===0)return t;if(t.type==="deleteRange")return null;var i=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return r.numFailures===i?null:(t=s({},t),k(t.keys)&&(t.keys=t.keys.filter(function(a,l){return!(l in r.failures)})),"values"in t&&k(t.values)&&(t.values=t.values.filter(function(a,l){return!(l in r.failures)})),t)}function ei(e,t){return r=e,((i=t).lower===void 0||(i.lowerOpen?0<Ae(r,i.lower):0<=Ae(r,i.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?Ae(e,t.upper)<0:Ae(e,t.upper)<=0));var r,i}function Hi(e,t,x,i,a,l){if(!x||x.length===0)return e;var d=t.query.index,h=d.multiEntry,g=t.query.range,m=i.schema.primaryKey.extractKey,_=d.extractKey,p=(d.lowLevelIndex||d).extractKey,x=x.reduce(function(y,b){var w=y,S=[];if(b.type==="add"||b.type==="put")for(var I=new mt,A=b.values.length-1;0<=A;--A){var D,R=b.values[A],z=m(R);I.hasKey(z)||(D=_(R),(h&&k(D)?D.some(function(W){return ei(W,g)}):ei(D,g))&&(I.addKey(z),S.push(R)))}switch(b.type){case"add":var J=new mt().addKeys(t.values?y.map(function(re){return m(re)}):y),w=y.concat(t.values?S.filter(function(re){return re=m(re),!J.hasKey(re)&&(J.addKey(re),!0)}):S.map(function(re){return m(re)}).filter(function(re){return!J.hasKey(re)&&(J.addKey(re),!0)}));break;case"put":var V=new mt().addKeys(b.values.map(function(re){return m(re)}));w=y.filter(function(re){return!V.hasKey(t.values?m(re):re)}).concat(t.values?S:S.map(function(re){return m(re)}));break;case"delete":var H=new mt().addKeys(b.keys);w=y.filter(function(re){return!H.hasKey(t.values?m(re):re)});break;case"deleteRange":var Q=b.range;w=y.filter(function(re){return!ei(m(re),Q)})}return w},e);return x===e?e:(x.sort(function(y,b){return Ae(p(y),p(b))||Ae(m(y),m(b))}),t.limit&&t.limit<1/0&&(x.length>t.limit?x.length=t.limit:e.length===t.limit&&x.length<t.limit&&(a.dirty=!0)),l?Object.freeze(x):x)}function Gi(e,t){return Ae(e.lower,t.lower)===0&&Ae(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function ro(e,t){return(function(r,i,a,l){if(r===void 0)return i!==void 0?-1:0;if(i===void 0)return 1;if((i=Ae(r,i))===0){if(a&&l)return 0;if(a)return 1;if(l)return-1}return i})(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=(function(r,i,a,l){if(r===void 0)return i!==void 0?1:0;if(i===void 0)return-1;if((i=Ae(r,i))===0){if(a&&l)return 0;if(a)return-1;if(l)return 1}return i})(e.upper,t.upper,e.upperOpen,t.upperOpen)}function io(e,t,r,i){e.subscribers.add(r),i.addEventListener("abort",function(){var a,l;e.subscribers.delete(r),e.subscribers.size===0&&(a=e,l=t,setTimeout(function(){a.subscribers.size===0&&Me(l,a)},3e3))})}var ao={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return s(s({},e),{transaction:function(r,i,a){var l,d,h=e.transaction(r,i,a);return i==="readwrite"&&(d=(l=new AbortController).signal,a=function(g){return function(){if(l.abort(),i==="readwrite"){for(var m=new Set,_=0,p=r;_<p.length;_++){var x=p[_],y=ln["idb://".concat(t,"/").concat(x)];if(y){var b=e.table(x),w=y.optimisticOps.filter(function(re){return re.trans===h});if(h._explicit&&g&&h.mutatedParts)for(var S=0,I=Object.values(y.queries.query);S<I.length;S++)for(var A=0,D=(J=I[S]).slice();A<D.length;A++)Wr((V=D[A]).obsSet,h.mutatedParts)&&(Me(J,V),V.subscribers.forEach(function(re){return m.add(re)}));else if(0<w.length){y.optimisticOps=y.optimisticOps.filter(function(re){return re.trans!==h});for(var R=0,z=Object.values(y.queries.query);R<z.length;R++)for(var J,V,H,Q=0,W=(J=z[R]).slice();Q<W.length;Q++)(V=W[Q]).res!=null&&h.mutatedParts&&(g&&!V.dirty?(H=Object.isFrozen(V.res),H=Hi(V.res,V.req,w,b,V,H),V.dirty?(Me(J,V),V.subscribers.forEach(function(re){return m.add(re)})):H!==V.res&&(V.res=H,V.promise=$.resolve({result:H}))):(V.dirty&&Me(J,V),V.subscribers.forEach(function(re){return m.add(re)})))}}}m.forEach(function(re){return re()})}}},h.addEventListener("abort",a(!1),{signal:d}),h.addEventListener("error",a(!1),{signal:d}),h.addEventListener("complete",a(!0),{signal:d})),h},table:function(r){var i=e.table(r),a=i.schema.primaryKey;return s(s({},i),{mutate:function(l){var d=le.trans;if(a.outbound||d.db._options.cache==="disabled"||d.explicit||d.idbtrans.mode!=="readwrite")return i.mutate(l);var h=ln["idb://".concat(t,"/").concat(r)];return h?(d=i.mutate(l),l.type!=="add"&&l.type!=="put"||!(50<=l.values.length||Zr(a,l).some(function(g){return g==null}))?(h.optimisticOps.push(l),l.mutatedParts&&lr(l.mutatedParts),d.then(function(g){0<g.numFailures&&(Me(h.optimisticOps,l),(g=Ui(0,l,g))&&h.optimisticOps.push(g),l.mutatedParts&&lr(l.mutatedParts))}),d.catch(function(){Me(h.optimisticOps,l),l.mutatedParts&&lr(l.mutatedParts)})):d.then(function(g){var m=Ui(0,s(s({},l),{values:l.values.map(function(_,p){var x;return g.failures[p]?_:(_=(x=a.keyPath)!==null&&x!==void 0&&x.includes(".")?_e(_):s({},_),se(_,a.keyPath,g.results[p]),_)})}),g);h.optimisticOps.push(m),queueMicrotask(function(){return l.mutatedParts&&lr(l.mutatedParts)})}),d):i.mutate(l)},query:function(l){if(!Vi(le,i)||!zi("query",l))return i.query(l);var d=((m=le.trans)===null||m===void 0?void 0:m.db._options.cache)==="immutable",p=le,h=p.requery,g=p.signal,m=(function(b,w,S,I){var A=ln["idb://".concat(b,"/").concat(w)];if(!A)return[];if(!(w=A.queries[S]))return[null,!1,A,null];var D=w[(I.query?I.query.index.name:null)||""];if(!D)return[null,!1,A,null];switch(S){case"query":var R=D.find(function(z){return z.req.limit===I.limit&&z.req.values===I.values&&Gi(z.req.query.range,I.query.range)});return R?[R,!0,A,D]:[D.find(function(z){return("limit"in z.req?z.req.limit:1/0)>=I.limit&&(!I.values||z.req.values)&&ro(z.req.query.range,I.query.range)}),!1,A,D];case"count":return R=D.find(function(z){return Gi(z.req.query.range,I.query.range)}),[R,!!R,A,D]}})(t,r,"query",l),_=m[0],p=m[1],x=m[2],y=m[3];return _&&p?_.obsSet=l.obsSet:(p=i.query(l).then(function(b){var w=b.result;if(_&&(_.res=w),d){for(var S=0,I=w.length;S<I;++S)Object.freeze(w[S]);Object.freeze(w)}else b.result=_e(w);return b}).catch(function(b){return y&&_&&Me(y,_),Promise.reject(b)}),_={obsSet:l.obsSet,promise:p,subscribers:new Set,type:"query",req:l,dirty:!1},y?y.push(_):(y=[_],(x=x||(ln["idb://".concat(t,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[l.query.index.name||""]=y)),io(_,y,h,g),_.promise.then(function(b){return{result:Hi(b.result,l,x?.optimisticOps,i,_,d)}})}})}})}};function cr(e,t){return new Proxy(e,{get:function(r,i,a){return i==="db"?t:Reflect.get(r,i,a)}})}var Gt=(it.prototype.version=function(e){if(isNaN(e)||e<.1)throw new ne.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ne.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,r=t.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),t.push(r),t.sort(Ya),r.stores({}),this._state.autoSchema=!1,r)},it.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||le.letThrough||this._vip)?e():new $(function(r,i){if(t._state.openComplete)return i(new ne.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void i(new ne.DatabaseClosed);t.open().catch(pe)}t._state.dbReadyPromise.then(r,i)}).then(e)},it.prototype.use=function(e){var t=e.stack,r=e.create,i=e.level,a=e.name;return a&&this.unuse({stack:t,name:a}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:r,level:i??10,name:a}),e.sort(function(l,d){return l.level-d.level}),this},it.prototype.unuse=function(e){var t=e.stack,r=e.name,i=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(a){return i?a.create!==i:!!r&&a.name!==r})),this},it.prototype.open=function(){var e=this;return an(Pt,function(){return $a(e)})},it.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=gn.indexOf(this);if(0<=t&&gn.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new $(function(r){e.dbReadyResolve=r}),e.openCanceller=new $(function(r,i){e.cancelOpen=i}))},it.prototype.close=function(r){var t=(r===void 0?{disableAutoOpen:!0}:r).disableAutoOpen,r=this._state;t?(r.isBeingOpened&&r.cancelOpen(new ne.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new ne.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},it.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var r=0<arguments.length&&typeof arguments[0]!="object",i=this._state;return new $(function(a,l){function d(){t.close(e);var h=t._deps.indexedDB.deleteDatabase(t.name);h.onsuccess=Ge(function(){var g,m,_;g=t._deps,m=t.name,_=g.indexedDB,g=g.IDBKeyRange,Ur(_)||m===Jn||zr(_,g).delete(m).catch(pe),a()}),h.onerror=jt(l),h.onblocked=t._fireOnBlocked}if(r)throw new ne.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(d):d()})},it.prototype.backendDB=function(){return this.idbdb},it.prototype.isOpen=function(){return this.idbdb!==null},it.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},it.prototype.hasFailed=function(){return this._state.dbOpenError!==null},it.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(it.prototype,"tables",{get:function(){var e=this;return v(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),it.prototype.transaction=function(){var e=(function(t,r,i){var a=arguments.length;if(a<2)throw new ne.InvalidArgument("Too few arguments");for(var l=new Array(a-1);--a;)l[a-1]=arguments[a];return i=l.pop(),[t,ue(l),i]}).apply(this,arguments);return this._transaction.apply(this,e)},it.prototype._transaction=function(e,t,r){var i=this,a=le.trans;a&&a.db===this&&e.indexOf("!")===-1||(a=null);var l,d,h=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(d=t.map(function(m){if(m=m instanceof i.Table?m.name:m,typeof m!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return m}),e=="r"||e===Tr)l=Tr;else{if(e!="rw"&&e!=Fr)throw new ne.InvalidArgument("Invalid transaction mode: "+e);l=Fr}if(a){if(a.mode===Tr&&l===Fr){if(!h)throw new ne.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&d.forEach(function(m){if(a&&a.storeNames.indexOf(m)===-1){if(!h)throw new ne.SubTransaction("Table "+m+" not included in parent transaction.");a=null}}),h&&a&&!a.active&&(a=null)}}catch(m){return a?a._promise(null,function(_,p){p(m)}):rt(m)}var g=(function m(_,p,x,y,b){return $.resolve().then(function(){var w=le.transless||le,S=_._createTransaction(p,x,_._dbSchema,y);if(S.explicit=!0,w={trans:S,transless:w},y)S.idbtrans=y.idbtrans;else try{S.create(),S.idbtrans._explicit=!0,_._state.PR1398_maxLoop=3}catch(D){return D.name===et.InvalidState&&_.isOpen()&&0<--_._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),_.close({disableAutoOpen:!1}),_.open().then(function(){return m(_,p,x,null,b)})):rt(D)}var I,A=at(b);return A&&pn(),w=$.follow(function(){var D;(I=b.call(S,S))&&(A?(D=Jt.bind(null,null),I.then(D,D)):typeof I.next=="function"&&typeof I.throw=="function"&&(I=Xr(I)))},w),(I&&typeof I.then=="function"?$.resolve(I).then(function(D){return S.active?D:rt(new ne.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):w.then(function(){return I})).then(function(D){return y&&S._resolve(),S._completion.then(function(){return D})}).catch(function(D){return S._reject(D),rt(D)})})}).bind(null,this,l,d,a,r);return a?a._promise(l,g,"lock"):le.trans?an(le.transless,function(){return i._whenReady(g)}):this._whenReady(g)},it.prototype.table=function(e){if(!j(this._allTables,e))throw new ne.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},it);function it(e,t){var r=this;this._middlewares={},this.verno=0;var i=it.dependencies;this._options=t=s({addons:it.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},i=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a,l,d,h,g,m={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:pe,dbReadyPromise:null,cancelOpen:pe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};m.dbReadyPromise=new $(function(p){m.dbReadyResolve=p}),m.openCanceller=new $(function(p,x){m.cancelOpen=x}),this._state=m,this.name=e,this.on=Pn(this,"populate","blocked","versionchange","close",{ready:[lt,pe]}),this.once=function(p,x){var y=function(){for(var b=[],w=0;w<arguments.length;w++)b[w]=arguments[w];r.on(p).unsubscribe(y),x.apply(r,b)};return r.on(p,y)},this.on.ready.subscribe=K(this.on.ready.subscribe,function(p){return function(x,y){it.vip(function(){var b,w=r._state;w.openComplete?(w.dbOpenError||$.resolve().then(x),y&&p(x)):w.onReadyBeingFired?(w.onReadyBeingFired.push(x),y&&p(x)):(p(x),b=r,y||p(function S(){b.on.ready.unsubscribe(x),b.on.ready.unsubscribe(S)}))})}}),this.Collection=(a=this,An(Ba.prototype,function(I,S){this.db=a;var y=_i,b=null;if(S)try{y=S()}catch(A){b=A}var w=I._ctx,S=w.table,I=S.hook.reading.fire;this._ctx={table:S,index:w.index,isPrimKey:!w.index||S.schema.primKey.keyPath&&w.index===S.schema.primKey.name,range:y,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:b,or:w.or,valueMapper:I!==Be?I:null}})),this.Table=(l=this,An(Pi.prototype,function(p,x,y){this.db=l,this._tx=y,this.name=p,this.schema=x,this.hook=l._allTables[p]?l._allTables[p].hook:Pn(null,{creating:[ct,pe],reading:[gt,Be],updating:[nt,pe],deleting:[pt,pe]})})),this.Transaction=(d=this,An(Ua.prototype,function(p,x,y,b,w){var S=this;p!=="readonly"&&x.forEach(function(I){I=(I=y[I])===null||I===void 0?void 0:I.yProps,I&&(x=x.concat(I.map(function(A){return A.updatesTable})))}),this.db=d,this.mode=p,this.storeNames=x,this.schema=y,this.chromeTransactionDurability=b,this.idbtrans=null,this.on=Pn(this,"complete","error","abort"),this.parent=w||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $(function(I,A){S._resolve=I,S._reject=A}),this._completion.then(function(){S.active=!1,S.on.complete.fire()},function(I){var A=S.active;return S.active=!1,S.on.error.fire(I),S.parent?S.parent._reject(I):A&&S.idbtrans&&S.idbtrans.abort(),rt(I)})})),this.Version=(h=this,An(Xa.prototype,function(p){this.db=h,this._cfg={version:p,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(g=this,An(Ti.prototype,function(p,x,y){if(this.db=g,this._ctx={table:p,index:x===":id"?null:x,or:y},this._cmp=this._ascending=Ae,this._descending=function(b,w){return Ae(w,b)},this._max=function(b,w){return 0<Ae(b,w)?b:w},this._min=function(b,w){return Ae(b,w)<0?b:w},this._IDBKeyRange=g._deps.IDBKeyRange,!this._IDBKeyRange)throw new ne.MissingAPI})),this.on("versionchange",function(p){0<p.newVersion?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(p){!p.newVersion||p.newVersion<p.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(p.oldVersion/10))}),this._maxKey=Dn(t.IDBKeyRange),this._createTransaction=function(p,x,y,b){return new r.Transaction(p,x,y,r._options.chromeTransactionDurability,b)},this._fireOnBlocked=function(p){r.on("blocked").fire(p),gn.filter(function(x){return x.name===r.name&&x!==r&&!x._state.vcFired}).map(function(x){return x.on("versionchange").fire(p)})},this.use(to),this.use(ao),this.use(no),this.use(Za),this.use(eo);var _=new Proxy(this,{get:function(p,x,y){if(x==="_vip")return!0;if(x==="table")return function(w){return cr(r.table(w),_)};var b=Reflect.get(p,x,y);return b instanceof Pi?cr(b,_):x==="tables"?b.map(function(w){return cr(w,_)}):x==="_createTransaction"?function(){return cr(b.apply(this,arguments),_)}:b}});this.vip=_,i.forEach(function(p){return p(r)})}var dr,Dt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",oo=(ti.prototype.subscribe=function(e,t,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:r})},ti.prototype[Dt]=function(){return this},ti);function ti(e){this._subscribe=e}try{dr={indexedDB:f.indexedDB||f.mozIndexedDB||f.webkitIndexedDB||f.msIndexedDB,IDBKeyRange:f.IDBKeyRange||f.webkitIDBKeyRange}}catch{dr={indexedDB:null,IDBKeyRange:null}}function Wi(e){var t,r=!1,i=new oo(function(a){var l=at(e),d,h=!1,g={},m={},_={get closed(){return h},unsubscribe:function(){h||(h=!0,d&&d.abort(),p&&$t.storagemutated.unsubscribe(y))}};a.start&&a.start(_);var p=!1,x=function(){return Dr(b)},y=function(w){sr(g,w),Wr(m,g)&&x()},b=function(){var w,S,I;!h&&dr.indexedDB&&(g={},w={},d&&d.abort(),d=new AbortController,I=(function(A){var D=hn();try{l&&pn();var R=Yt(e,A);return R=l?R.finally(Jt):R}finally{D&&vn()}})(S={subscr:w,signal:d.signal,requery:x,querier:e,trans:null}),Promise.resolve(I).then(function(A){r=!0,t=A,h||S.signal.aborted||(g={},(function(D){for(var R in D)if(j(D,R))return;return 1})(m=w)||p||($t(En,y),p=!0),Dr(function(){return!h&&a.next&&a.next(A)}))},function(A){r=!1,["DatabaseClosedError","AbortError"].includes(A?.name)||h||Dr(function(){h||a.error&&a.error(A)})}))};return setTimeout(x,0),_});return i.hasValue=function(){return r},i.getValue=function(){return t},i}var un=Gt;function ni(e){var t=Zt;try{Zt=!0,$t.storagemutated.fire(e),Qr(e,!0)}finally{Zt=t}}L(un,s(s({},tt),{delete:function(e){return new un(e,{addons:[]}).delete()},exists:function(e){return new un(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=un.dependencies,r=t.indexedDB,t=t.IDBKeyRange,(Ur(r)?Promise.resolve(r.databases()).then(function(i){return i.map(function(a){return a.name}).filter(function(a){return a!==Jn})}):zr(r,t).toCollection().primaryKeys()).then(e)}catch{return rt(new ne.MissingAPI)}var t,r},defineClass:function(){return function(e){O(this,e)}},ignoreTransaction:function(e){return le.trans?an(le.transless,e):e()},vip:Hr,async:function(e){return function(){try{var t=Xr(e.apply(this,arguments));return t&&typeof t.then=="function"?t:$.resolve(t)}catch(r){return rt(r)}}},spawn:function(e,t,r){try{var i=Xr(e.apply(r,t||[]));return i&&typeof i.then=="function"?i:$.resolve(i)}catch(a){return rt(a)}},currentTransaction:{get:function(){return le.trans||null}},waitFor:function(e,t){return t=$.resolve(typeof e=="function"?un.ignoreTransaction(e):e).timeout(t||6e4),le.trans?le.trans.waitFor(t):t},Promise:$,debug:{get:function(){return He},set:function(e){xt(e)}},derive:N,extend:O,props:L,override:K,Events:Pn,on:$t,liveQuery:Wi,extendObservabilitySet:sr,getByKeyPath:te,setByKeyPath:se,delByKeyPath:function(e,t){typeof t=="string"?se(e,t,void 0):"length"in t&&[].map.call(t,function(r){se(e,r,void 0)})},shallowClone:he,deepClone:_e,getObjectDiff:$r,cmp:Ae,asap:oe,minKey:-1/0,addons:[],connections:gn,errnames:et,dependencies:dr,cache:ln,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,r){return e+t/Math.pow(10,2*r)})})),un.maxKey=Dn(un.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&($t(En,function(e){Zt||(e=new CustomEvent(Mr,{detail:e}),Zt=!0,dispatchEvent(e),Zt=!1)}),addEventListener(Mr,function(e){e=e.detail,Zt||ni(e)}));var wn,Zt=!1,Yi=function(){};return typeof BroadcastChannel<"u"&&((Yi=function(){(wn=new BroadcastChannel(Mr)).onmessage=function(e){return e.data&&ni(e.data)}})(),typeof wn.unref=="function"&&wn.unref(),$t(En,function(e){Zt||wn.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Gt.disableBfCache&&e.persisted){He&&console.debug("Dexie: handling persisted pagehide"),wn?.close();for(var t=0,r=gn;t<r.length;t++)r[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Gt.disableBfCache&&e.persisted&&(He&&console.debug("Dexie: handling persisted pageshow"),Yi(),ni({all:new mt(-1/0,[[]])}))})),$.rejectionMapper=function(e,t){return!e||e instanceof fe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!St[e.name]?e:(t=new St[e.name](t||e.message,e),"stack"in e&&M(t,"stack",{get:function(){return this.inner.stack}}),t)},xt(He),s(Gt,Object.freeze({__proto__:null,Dexie:Gt,liveQuery:Wi,Entity:Si,cmp:Ae,PropModification:In,replacePrefix:function(e,t){return new In({replacePrefix:[e,t]})},add:function(e){return new In({add:e})},remove:function(e){return new In({remove:e})},default:Gt,RangeSet:mt,mergeRanges:Nn,rangesOverlap:Li}),{default:Gt}),Gt})})(br)),br.exports}var hl=fl();const si=$o(hl),ha=Symbol.for("Dexie"),_r=globalThis[ha]||(globalThis[ha]=si);if(si.semVer!==_r.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${si.semVer} and ${_r.semVer}`);const{liveQuery:Jc,mergeRanges:Qc,rangesOverlap:Xc,RangeSet:$c,cmp:Zc,Entity:ed,PropModification:td,replacePrefix:nd,add:rd,remove:id,DexieYProvider:ad}=_r,Bn="current";class vl extends _r{uprnSelections;areaSelections;dataSelections;userDownloads;constructor(){super("app-db2"),this.version(2).stores({uprnSelections:"&id",areaSelections:"++id, layerId, *areaIds",dataSelections:"++id, layerId, *fields",userDownloads:"++id, &localId, createdAt"}),this.on("populate",async n=>{if(console.log("[db] Populating database with initial data"),await n.table("uprnSelections").get(Bn)){console.log("[db] Initial UPRN selection already exists");return}await n.table("uprnSelections").add({id:"current",areas:null,data:[]}),console.log("[db] Initial UPRN selection created")})}}const nn=new vl,Aa=async()=>await nn.uprnSelections.get(Bn),Rn=async C=>{let n=await Aa();n||(n={id:Bn,areas:null,data:[]},await nn.uprnSelections.add(n)),console.log("[db] Updating UPRN selection with patch:",C,"current:",n),await nn.uprnSelections.update(Bn,C)},pl=async()=>{await nn.uprnSelections.put({id:Bn,areas:null,data:[]})},gl=async(C,n,o)=>await nn.userDownloads.add({localId:C,areaSelection:n,dataSelections:o,status:en.Pending,createdAt:Date.now()}),ml=async(C,n,o,s)=>{const c={};n!==void 0&&(c.externalId=n),o!==void 0&&(c.areaSelection=o),s!==void 0&&(c.dataSelections=s),Object.keys(c).length!==0&&await nn.userDownloads.where("localId").equals(C).modify(c)},yl=async()=>await nn.userDownloads.orderBy("createdAt").reverse().toArray(),bl=async C=>await nn.userDownloads.where("localId").equals(C).delete();class wl{#e=ie(Le(new qt));constructor(){this.#t()}addDownload(n){console.log("[downloads-store] Adding download:",n),u(this.#e).set(n.localId,n),gl(n.localId,n.areaSelection,n.dataSelections)}updateDownloadStatus(n){console.log("[downloads-store] Updating download status:",n),u(this.#e).set(n.localId,{...n}),ml(n.localId,n.externalId,n.areaSelection,n.dataSelections)}removeDownload(n){u(this.#e).delete(n),bl(n)}getDownloads(){return Array.from(u(this.#e).values())}async#t(){const n=await yl();!n||n.length===0||(console.log("Loaded downloads from DB:",n),n.forEach(o=>{u(this.#e).set(o.localId,{localId:o.localId,status:en.Pending,areaSelection:o.areaSelection,dataSelections:o.dataSelections})}))}}const Ln=new wl;var _l=ae('<div class="data-item svelte-v4uih6"><span class="data-name svelte-v4uih6"> </span> <div class="data-actions svelte-v4uih6"><!></div></div>');function li(C,n){const o=Re(n,"title",3,"");kr(C,{class:"data-item-card",children:(s,c)=>{var f=_l(),v=ee(f),k=ee(v,!0);X(v);var O=ce(v,2),P=ee(O);Ze(P,()=>n.children??qe),X(O),X(f),ut(()=>{hi(v,"title",o()),Ct(k,o())}),T(s,f)},$$slots:{default:!0}})}var Sl=ae("<!> <!> <!> <!>",1),xl=ae('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),kl=ae('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),Cl=ae('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function Il(C,n){Fe(n,!0);let o=ie(Le(new Set));const s=Ie(()=>Ln.getDownloads()),c={completed:{color:"#059669",text:"Completed",icon:Io},"in-progress":{color:"#2563eb",text:"In Progress",icon:Co},failed:{color:"#dc2626",text:"Failed",icon:Qo},pending:{color:"#6b7280",text:"Pending",icon:Jo}};jn(()=>{const B=setInterval(()=>{f()},5e3);return()=>{clearInterval(B)}}),Ve(()=>{if(!u(s)||u(s).length<=0||!n.uprnDownloadService)return;(async()=>{for(const F of u(s)){if(F.externalId||F.status!==en.Pending)continue;const q={exports:{areaSelectionLayer:{remoteId:F.areaSelection.layerId,areas:F.areaSelection.areaFieldInfos.map(U=>U.code)},dataSelectionLayers:F.dataSelections.map(U=>({remoteId:U.layerId,fields:U.fields.filter(oe=>!n.fieldsToHide||!n.fieldsToHide.has(oe))}))}};console.log("[downloads-menu] Submitting download request:",q);const K=await n.uprnDownloadService.requestJob(q);if(!K||K.type===cl.Error){console.error("[downloads-menu] Failed to submit download request.",K);continue}F.externalId=K.guid,F.status=en.InProgress,Ln.updateDownloadStatus(F)}})()});async function f(){if(u(s).length<=0||!n.uprnDownloadService)return;const B={jobs:u(s).filter(q=>q.externalId).map(q=>q.externalId)},F=await n.uprnDownloadService.requestJobStatuses(B);if(!F){console.error("[downloads-menu] Failed to get job statuses.",F);return}for(const q of F.jobs){const K=u(s).find(U=>U.externalId===q.guid);if(!K){console.warn("[downloads-menu] Received job status for unknown download:",q.guid);continue}switch(q.status.type){case mr.Submitted:case mr.Processing:K.status=en.InProgress;break;case mr.Completed:K.status=en.Completed;break;case mr.Error:K.status=en.Failed;break;default:console.warn("[downloads-menu] Unknown job status type:",q.status.type);break}Ln.updateDownloadStatus(K)}}function v(B){Ln.removeDownload(B)}async function k(B){try{await navigator.clipboard.writeText(B),G(o,new Set(u(o)).add(B),!0),Kn.success("URL copied to clipboard"),setTimeout(()=>{const F=new Set(u(o));F.delete(B),G(o,F,!0)},2e3)}catch(F){console.error("Failed to copy URL:",F),Kn.error("Failed to copy URL to clipboard")}}function O(B){return c[B]?.color??c.pending.color}function P(B){return c[B]?.text??c.pending.text}function E(B){return c[B]?.icon??c.pending.icon}function j(B){return n.uprnDownloadService.getDownloadUrl(B)}var L=Cl(),Y=ce(ee(L),2);{var M=B=>{var F=xl(),q=Z(F);Vt(q,21,()=>u(s),Sn,(oe,te)=>{{let se=Ie(()=>u(te).externalId?u(te).externalId:"Pending...");li(oe,{get title(){return u(se)},children:(he,ke)=>{var ue=Sl(),ye=Z(ue);{let Ce=Ie(()=>O(u(te).status)),Me=Ie(()=>P(u(te).status));Tt(ye,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${u(Ce)??""}`},get title(){return u(Me)},disabled:!0,children:(ge,Ee)=>{const at=Ie(()=>E(u(te).status));var ot=de(),fe=Z(ot);{let je=Ie(()=>u(te).status==="in-progress"?"spinning":"");Oe(fe,()=>u(at),(Xe,Pe)=>{Pe(Xe,{size:14,get class(){return u(je)}})})}T(ge,ot)},$$slots:{default:!0}})}var Se=ce(ye,2);{var _e=Ce=>{Tt(Ce,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>k(j(u(te).externalId)),title:"Copy URL to clipboard",children:(Me,ge)=>{var Ee=de(),at=Z(Ee);{var ot=je=>{xo(je,{size:14})},fe=je=>{ko(je,{size:14})};ve(at,je=>{u(o).has(j(u(te).externalId))?je(ot):je(fe,!1)})}T(Me,Ee)},$$slots:{default:!0}})};ve(Se,Ce=>{u(te).externalId&&Ce(_e)})}var De=ce(Se,2);{var ze=Ce=>{Tt(Ce,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(j(u(te).externalId),"_blank"),title:"Open download",children:(Me,ge)=>{Es(Me,{})},$$slots:{default:!0}})};ve(De,Ce=>{u(te).externalId&&u(te).status==="completed"&&Ce(ze)})}var Qe=ce(De,2);Tt(Qe,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>v(u(te).localId),title:"Remove from queue",children:(Ce,Me)=>{dn();var ge=_n("");T(Ce,ge)},$$slots:{default:!0}}),T(he,ue)},$$slots:{default:!0}})}}),X(q);var K=ce(q,2),U=ee(K);X(K),ut(()=>Ct(U,`${u(s).length??""} download(s) in queue`)),T(B,F)},N=B=>{var F=kl();T(B,F)};ve(Y,B=>{u(s).length>0?B(M):B(N,!1)})}X(L),T(C,L),Ne()}function Pl(C,n){Fe(n,!0);{let o=Ie(()=>Vn("size-7 border-1 border-destructive",n.class));Tt(C,{onclick:()=>n.clear(),variant:"ghost",get class(){return u(o)},title:"Clear all selections",children:(s,c)=>{Ds(s,{class:"text-destructive"})},$$slots:{default:!0}})}Ne()}class Al{#e=ie(Le(new qt));get dataSelections(){return u(this.#e)}set dataSelections(n){G(this.#e,n,!0)}addSelection(n){this.dataSelections.set(n.layerId,n)}updateSelection(n,o){const s=this.dataSelections.get(n);if(!s){console.warn(`[data-selection-store] no existing selection for layerId ${n}`);return}s.selectedFieldIds=new Bt(o),this.dataSelections.set(n,{...s})}addOrUpdateSelection(n,o){const s=this.dataSelections.get(n);if(s)s.selectedFieldIds=new Bt(o),this.dataSelections.set(n,{...s});else{const c={layerId:n,selectedFieldIds:new Bt(o)};this.dataSelections.set(n,c)}}removeSelection(n){this.dataSelections.delete(n)}getSelection(n){return this.dataSelections.get(n)}getAllSelections(){return Array.from(this.dataSelections.values())}clearSelections(){this.dataSelections.clear(),console.log("[data-selection-store] selections cleared.")}cleanup(){this.dataSelections.clear()}}var Ol=ae('<div class="export-footer svelte-10dgoyk"><div class="export-footer__left svelte-10dgoyk"><p class="text-sm text-muted-foreground svelte-10dgoyk">Click "Export" to begin the download.</p></div> <div class="export-footer__right svelte-10dgoyk"><!> <!></div></div>');function El(C,n){Fe(n,!0);function o(){if(n.areaSelectionInteractionStore.selectionViewState?.areaHandles.size<=0){Kn.error("Please select at least one area to export.");return}if(n.dataSelectionStore.getAllSelections().length<=0){Kn.error("Please select at least one data layer to export.");return}console.log("Starting export..."),(async()=>{const O=await n.areaSelectionInteractionStore.getAreaCodesById(n.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),P=n.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().map(([Y,M],N)=>({id:Y,code:O[N]})).toArray(),E={layerId:n.areaSelectionInteractionStore.selectionViewState.layerView?.layer.id||"",areaFieldInfos:P},j=n.dataSelectionStore.getAllSelections().map(Y=>({layerId:Y.layerId,fields:Array.from(Y.selectedFieldIds)})),L=crypto.randomUUID();Ln.addDownload({localId:L,status:en.Pending,areaSelection:E,dataSelections:j}),n.onExportSuccess?.()})()}var s=Ol(),c=ce(ee(s),2),f=ee(c);Pl(f,{class:"mr-4",get clear(){return n.clearSelections}});var v=ce(f,2);Tt(v,{onclick:o,title:"Export",children:(k,O)=>{dn();var P=_n("Export");T(k,P)},$$slots:{default:!0}}),X(c),X(s),T(C,s),Ne()}class Dl{#e=ie(null);get ActiveLayer(){return u(this.#e)}set ActiveLayer(n){G(this.#e,n,!0)}}class Tl{#e=ie(!1);get isLoaded(){return u(this.#e)}set isLoaded(n){G(this.#e,n,!0)}#t=ie(null);get data(){return u(this.#t)}set data(n){G(this.#t,n,!0)}#n=Ie(()=>{const n=new qt;function o(s){n.set(s.id,s),s.type==="group"&&s.layers.forEach(f=>{o(f)})}return this.data&&this.data.layers.forEach(s=>{o(s)}),n});get dataLookup(){return u(this.#n)}set dataLookup(n){G(this.#n,n)}#i=ie(!1);get loading(){return u(this.#i)}set loading(n){G(this.#i,n,!0)}#r=ie(null);get error(){return u(this.#r)}set error(n){G(this.#r,n,!0)}async initializeAsync(n){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:o,itemId:s,proxy:c}=n;await this.configurePortalAsync(o,c),await this.loadwebmapAsync(s)}catch(o){console.error("Error initializing webmap:",o),this.error=o.message}finally{this.loading=!1}}}async configurePortalAsync(n,o){if(!n||(Zi.portalUrl=n,console.log(Zi),!o))return;const{addProxyRule:s}=os;console.log("Adding proxy rule for portal traffic"),s({urlPrefix:o?.urlPrefix,proxyUrl:o?.proxyUrl})}async loadwebmapAsync(n){if(this.data)return;const o=new as({id:n}),s=new is({portalItem:o});this.data=s,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}function Fl(C,n){C.stopPropagation(),n.onFilterClicked?.(n.layerId)}var Nl=ae('<button title="Filter"><!></button>');function Rl(C,n){Fe(n,!0);let o=ie(Le(n.hasFiltersApplied?.(n.layerId)??!1));Ve(()=>{G(o,n.hasFiltersApplied?.(n.layerId)??!1,!0)});const s=Ie(()=>u(o)?Po:Ao);var c=Nl();let f;c.__click=[Fl,n];var v=ee(c);qn(v,()=>u(s)),X(c),ut(k=>{f=vi(c,1,"filter-btn svelte-k95pvd",null,f,k),hi(c,"aria-pressed",u(o))},[()=>({active:u(o)})]),T(C,c),Ne()}Ir(["click"]);var Ml=ae('<ul class="selected-list"></ul> <p class="count svelte-81yb5c"> </p>',1),Ll=ae('<p class="no-selection svelte-81yb5c">No areas selected</p>'),jl=ae("<!> <!>",1),Kl=ae('<ul></ul> <p class="count svelte-81yb5c"> </p>',1),ql=ae('<p class="no-selection svelte-81yb5c">No data selected</p>'),Bl=ae('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function Vl(C,n){Fe(n,!0);const o=Re(n,"fieldFilterMenuStore",7);let s=ie(Le([]));Ve(()=>{if(!n.areaSelectionInteractionStore){G(s,[],!0);return}if(!n.areaSelectionInteractionStore.selectionViewState?.areaHandles.size){G(s,[],!0);return}(async()=>{const U=await n.areaSelectionInteractionStore.getAreaNamesById(n.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),oe=n.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().toArray().map(([se,he])=>({id:se,handle:he})),te=[];for(let se=0;se<U.length;se++)te.push({name:U[se]||"Unknown Area",HighlightAreaInfo:oe[se]});G(s,te,!0)})()});function c(K){const U=u(s).findIndex(oe=>oe.name===K);U!==-1&&n.areaSelectionInteractionStore.removeSelectedArea(u(s)[U]?.HighlightAreaInfo.id)}function f(K){console.log("[export-menu] Removing data selection for layerId:",K),n.dataSelectionStore.removeSelection(K),console.log("[export-menu] Current SelectedData:",ai(n.dataSelectionStore.getAllSelections()))}function v(K){if(o().ActiveLayer?.id===K){o().ActiveLayer=null;return}const U=n.webMapStore.dataLookup.get(K);if(!U){console.warn(`[export-menu] Layer with ID ${K} not found in web map store.`);return}o().ActiveLayer=U}function k(K){const U=n.dataSelectionStore.getSelection(K);return!(!U||!U.selectedFieldIds||U.selectedFieldIds.size===0||U.selectedFieldIds.size===n.webMapStore.dataLookup.get(K)?.fields?.length)}var O=Bl(),P=ce(Z(O),2),E=ee(P),j=ee(E,!0);X(E);var L=ce(E,4);{var Y=K=>{var U=Ml(),oe=Z(U);Vt(oe,21,()=>u(s),Sn,(he,ke)=>{li(he,{get title(){return u(ke).name},children:(ue,ye)=>{Tt(ue,{variant:"ghost",size:"sm",class:"area-remove-btn",title:"Remove area",onclick:()=>c(u(ke).name),children:(Se,_e)=>{dn();var De=_n("");T(Se,De)},$$slots:{default:!0}})},$$slots:{default:!0}})}),X(oe);var te=ce(oe,2),se=ee(te);X(te),ut(()=>Ct(se,`${u(s).length??""} area(s) selected`)),T(K,U)},M=K=>{var U=Ll();T(K,U)};ve(L,K=>{u(s).length>0?K(Y):K(M,!1)})}X(P);var N=ce(P,2),B=ce(ee(N),2);{var F=K=>{var U=Kl(),oe=Z(U);Vt(oe,21,()=>n.dataSelectionStore.getAllSelections(),Sn,(he,ke)=>{{let ue=Ie(()=>n.webMapStore.dataLookup.get(u(ke).layerId)?.title??"");li(he,{get title(){return u(ue)},children:(ye,Se)=>{var _e=jl(),De=Z(_e);{var ze=Ce=>{Rl(Ce,{get layerId(){return u(ke).layerId},onFilterClicked:v,hasFiltersApplied:k})};ve(De,Ce=>{n.dataSelectionTreeviewConfig?.getItemConfig(u(ke).layerId)?.showFields&&Ce(ze)})}var Qe=ce(De,2);Tt(Qe,{variant:"ghost",size:"sm",class:"data-remove-btn",title:"Remove data selection",onclick:()=>f(u(ke).layerId),children:(Ce,Me)=>{dn();var ge=_n("");T(Ce,ge)},$$slots:{default:!0}}),T(ye,_e)},$$slots:{default:!0}})}}),X(oe);var te=ce(oe,2),se=ee(te);X(te),ut(he=>Ct(se,`${he??""} data layer(s) selected`),[()=>n.dataSelectionStore.getAllSelections().length]),T(K,U)},q=K=>{var U=ql();T(K,U)};ve(B,K=>{n.dataSelectionStore.getAllSelections().length>0?K(F):K(q,!1)})}X(N),ut(()=>Ct(j,n.areaSelectionInteractionStore.selectionViewState?.layerView?.layer?n.areaSelectionInteractionStore.selectionViewState?.layerView?.layer.title:"No Area Layer Selected")),T(C,O),Ne()}function zl(C,n){C.target===C.currentTarget&&n()}var Ul=(C,n)=>C.key==="Escape"&&n(),Hl=(C,n,o)=>n(u(o).name),Gl=ae('<div class="info-icon-container svelte-fp5rsc"><!></div>'),Wl=ae('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),Yl=ae('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),Jl=ae("<!> <!>",1),Ql=ae("<!> <!>",1),Xl=ae('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),$l=ae('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Zl(C,n){Fe(n,!0);const o=Re(n,"fieldFilterMenuStore",7);let s=ie(null),c=ie(Le(new Bt)),f=Ie(()=>{if(!u(s)||!u(s).fields)return{checked:!1,indeterminate:!1};const M=u(s).fields.length,N=u(c)?.size||0;return N===0?{checked:!1,indeterminate:!1}:N===M?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});Ve(()=>{const M=o().ActiveLayer;if(!M){G(s,null),G(c,new Bt,!0);return}G(s,M,!0);const N=n.dataSelectionStore.getSelection(M.id);N?.selectedFieldIds?G(c,new Bt([...N.selectedFieldIds]),!0):G(c,new Bt,!0)});function v(){k(),o().ActiveLayer=null}function k(){if(!u(s))return;let M=n.dataSelectionStore.getSelection(u(s).id);if(M){if((M.selectedFieldIds===void 0||M.selectedFieldIds===null)&&(M.selectedFieldIds=new Bt),u(c).size===0){n.dataSelectionStore.removeSelection(u(s).id);return}M.selectedFieldIds.clear(),u(c).forEach(N=>{M.selectedFieldIds?.add(N)})}}function O(M){u(s)&&(u(c).has(M)?u(c).delete(M):u(c).add(M))}function P(){if(!u(s)?.fields)return;(u(c)?.size||0)===0?u(s).fields.forEach(N=>{u(c).add(N.name)}):u(c).clear()}function E(){if(!u(s)?.fields)return[];const M=u(s).fields.filter(N=>!n.fieldsToHide.has(N.name.toLowerCase()));return console.log("Filtered fields to show:",M,n.fieldsToHide,u(s).fields),M}var j=de(),L=Z(j);{var Y=M=>{var N=$l();N.__click=[zl,v],N.__keydown=[Ul,v];var B=ee(N);Oe(B,()=>kr,(F,q)=>{q(F,{class:"command-card",children:(K,U)=>{var oe=Xl(),te=Z(oe);te.__click=v;var se=ee(te);ss(se,{size:20}),X(te);var he=ce(te,2);Oe(he,()=>Cr,(ke,ue)=>{ue(ke,{class:"card-content",children:(ye,Se)=>{var _e=de(),De=Z(_e);Oe(De,()=>es,(ze,Qe)=>{Qe(ze,{children:(Ce,Me)=>{var ge=Ql(),Ee=Z(ge);Oe(Ee,()=>ls,(ot,fe)=>{fe(ot,{placeholder:"Search for fields..."})});var at=ce(Ee,2);Oe(at,()=>ts,(ot,fe)=>{fe(ot,{children:(je,Xe)=>{var Pe=Jl(),et=Z(Pe);Oe(et,()=>ns,(ne,St)=>{St(ne,{children:(tt,pe)=>{dn();var Be=_n("No results found.");T(tt,Be)},$$slots:{default:!0}})});var It=ce(et,2);Oe(It,()=>us,(ne,St)=>{St(ne,{heading:"Fields",children:(tt,pe)=>{var Be=Yl(),gt=Z(Be),Ue=ee(gt);Ji(Ue,{get checked(){return u(f).checked},get indeterminate(){return u(f).indeterminate},onCheckedChange:P}),dn(2),X(gt);var ct=ce(gt,2);Oe(ct,()=>Oo,(nt,st)=>{st(nt,{})});var pt=ce(ct,2);Vt(pt,17,E,Sn,(nt,st)=>{var lt=de(),He=Z(lt);Oe(He,()=>rs,(xt,Ft)=>{Ft(xt,{class:"field-item",onselect:()=>O(u(st).name),children:(kt,Mt)=>{var Ye=Wl(),dt=ee(Ye);{let Ut=Ie(()=>u(c)?.has(u(st).name)??!1);Ji(dt,{class:"field-checkbox",get checked(){return u(Ut)},onCheckedChange:()=>O(u(st).name)})}var wt=ce(dt,2);wt.__click=[Hl,O,st];var $e=ee(wt),ft=ee($e),Lt=ee(ft,!0);X(ft);var zt=ce(ft,2);{var fn=Ut=>{var Pt=Gl(),le=ee(Pt);qn(le,()=>Eo),X(Pt),ut(()=>hi(Pt,"title",u(st).description)),T(Ut,Pt)};ve(zt,Ut=>{u(st).description&&Ut(fn)})}X($e),X(wt),X(Ye),ut(()=>Ct(Lt,u(st).alias||u(st).name)),T(kt,Ye)},$$slots:{default:!0}})}),T(nt,lt)}),T(tt,Be)},$$slots:{default:!0}})}),T(je,Pe)},$$slots:{default:!0}})}),T(Ce,ge)},$$slots:{default:!0}})}),T(ye,_e)},$$slots:{default:!0}})}),T(K,oe)},$$slots:{default:!0}})}),X(N),T(M,N)};ve(L,M=>{u(s)&&M(Y)})}T(C,j),Ne()}Ir(["click","keydown"]);class Oa{id;name;children;parent;constructor(n,o,s=[],c=null){this.id=n,this.name=o,this.children=s,this.parent=c}}class Je extends Oa{layer;constructor(n,o,s,c=[],f=null){super(n,o,c,f),this.layer=s}}class xn extends Je{featureLayer;field;constructor(n,o,s,c,f=[],v=null){super(n,o,s,f,v),this.field=c,this.featureLayer=s}}var We=(C=>(C.Inactive="inactive",C.Indeterminate="indeterminate",C.Active="active",C))(We||{}),tn=(C=>(C.Hidden="hidden",C.Suspended="suspended",C.Visible="visible",C))(tn||{});class Ea{#e=ie(!1);get initialized(){return u(this.#e)}set initialized(n){G(this.#e,n,!0)}#t=null;#n=null;#i=ie(Le([]));#r=Ie(()=>{const n=new qt;return this.#S(u(this.#i),n),n});#a=ie(Le(new qt));#s=ie(Le(new qt));#l=ie(Le(new qt));#u=ie(Le(new qt));#f=ie(Le(new qt));#h=null;initialize(n,o,s,c,f){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!o)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=o,c)for(const v of c)u(this.#f).set(v.id,v);if(f&&(this.#h=f),!n)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#n=s,this.#m(n),G(this.#i,this.#y(n),!0)}getNodeById(n){return this.#c(),u(this.#r).get(n)}getNodes(){return this.#c(),u(this.#i)}getVisibleNodes(){this.#c();const n=[];for(const[o,s]of u(this.#a)){if(!s)continue;const c=u(this.#r).get(o);c&&n.push(c)}return n}getNonHiddenNodes(){return this.#c(),this.#o(u(this.#i))}clearSelections(){this.#c();for(const n of u(this.#a).keys()){u(this.#a).set(n,!1);const o=u(this.#r).get(n);o&&o instanceof Je&&(o.layer.visible=!1)}u(this.#u).clear()}#o(n){this.#c();const o=[];for(const s of n){const c=this.#v(s.id);if(!(c&&c.isHidden)&&(o.push(s),s.children?.length)){const f=this.#o(s.children);o.push(...f)}}return o}getVisibilityState(n){return this.#c(),u(this.#a).get(n)??!1}setVisibilityState(n,o){this.#c();const s=u(this.#r).get(n);if(!s)throw new Error(`Tree node not found for ID: ${n}`);if(!(s instanceof Je))throw new Error(`Tree node is not a layer node: ${n}`);const c=this.#v(n);if(c?.disableVisibilityToggle||(u(this.#a).set(n,o),s.layer.visible=o,this.updateDrawState(s,o),s instanceof xn&&(s.featureLayer.displayField=o?s.field.name:"",o&&this.#h&&(console.log("[TreeviewStore] Applying custom renderer for field:",s.field.name),this.#h.applyCustomRenderer(s.featureLayer,s.field.name))),this.#d(s,o),!c||c.isHidden)||(c.visibilityDependencyIds?.length&&this.#p(s,o),!c.visibilityGroupId))return;const f=c.visibilityGroupId;let v=u(this.#u).get(f);v||(v=[],u(this.#u).set(f,v));const k=this.#g(f);if(!k)throw new Error(`Visibility group config not found for group ID: ${f}`);if(!o){const P=v.indexOf(n);v.splice(P,1);return}const O=P=>{u(this.#a).set(P,!1);const E=u(this.#r).get(P);if(E&&E instanceof Je){E.layer.visible=!1,this.updateDrawState(E,!1),this.#d(E,!1);const L=this.#v(P);L&&L.visibilityDependencyIds?.length&&this.#p(E,!1)}const j=v.indexOf(P);j>=0&&v.splice(j,1)};for(;v.length>=k.maxVisibleLayers;){const P=v[0];O(P)}v.push(n),this.#d(s,o),c.visibilityDependencyIds?.length&&this.#p(s,o)}async updateDrawState(n,o){if(!this.#n)return;if(!o){u(this.#s).delete(n.id),u(this.#l).get(n.id)?.remove(),u(this.#l).delete(n.id);return}if(!(n instanceof Je)||!(n.layer instanceof ea))return;const s=await this.#n.getLayerView(n.layer);if(!s)return;this.setInitialDrawState(n,s);const c=fs(()=>s.suspended,(f,v)=>{v&&!f?u(this.#s).set(n.id,tn.Visible):!v&&f&&u(this.#s).set(n.id,tn.Suspended)});u(this.#l).set(n.id,c)}getNodeDrawState(n){return this.#c(),u(this.#s).get(n)??tn.Hidden}setInitialDrawState(n,o){!(n instanceof Je)||!(n.layer instanceof ea)||o&&(o.suspended?u(this.#s).set(n.id,tn.Suspended):u(this.#s).set(n.id,tn.Visible))}clearDrawStateHandles(){for(const n of u(this.#l).values())n.remove();u(this.#l).clear()}cleanup(){this.initialized=!1,u(this.#a).clear(),u(this.#u).clear(),u(this.#f).clear(),G(this.#i,[],!0),u(this.#r).clear(),u(this.#s).clear(),this.clearDrawStateHandles()}#d(n,o){const s=n.parent;if(s){if(!(s instanceof Je)){this.#d(s,o);return}u(this.#a).set(s.id,o),s.layer.visible=o,this.#d(s,o)}}#p(n,o){const s=this.#v(n.id);if(s&&s.visibilityDependencyIds?.length)for(const c of s.visibilityDependencyIds){const f=u(this.#r).get(c);f&&f instanceof Je&&(u(this.#a).set(c,o),f.layer.visible=o,this.#d(f,o))}}#g(n){if(n&&this.#t)return this.#t.getVisibilityGroupConfig(n)}#m(n){this.#t&&this.#t.resolveInheritance(n)}#y(n){const o=n.map(s=>this.#w(s,void 0));return this.#b([...o])}#v(n){if(n&&this.#t)return this.#t.getItemConfig(n)}#b(n){n.reverse();for(const o of n)o.children?.length&&this.#b(o.children);return n}#w(n,o){const s=this.#v(n.id);if(s&&s.customConverterId){if(!u(this.#f).has(s.customConverterId))throw new Error(`Custom converter not found: ${s.customConverterId}`);const f=u(this.#f).get(s.customConverterId);if(!f)throw new Error(`Custom converter not found: ${s.customConverterId}`);return f.layerToNode(n,o??null)}const c=new Je(n.id,n.title,n,[],o);if(n.visible=s?.disableVisibilityToggle?n.visible:s?.isHidden?!1:s?.isVisibleOnInit??!1,u(this.#a).set(n.id,n.visible),this.updateDrawState(c,n.visible),this.#P(n)&&s?.showFields){const f=n;f.loaded||console.warn(`Layer not loaded: ${n.id}`);for(const v of f.fields??[]){const k=this.#x(v,c);c.children.push(k)}}if(this.#I(n)){const f=n;return c.children=f.layers.toArray().map(v=>this.#w(v,c)),c}if(this.#k(n)){const f=n;if(f.sublayers&&f.sublayers.length>0){const v=f.sublayers;c.children=v.toArray().map(this.#_)}}return c}#x(n,o){const s=this.#C(o.id,n.name),c=new xn(s,n.alias||n.name,o.layer,n,[],o),f=this.#v(s);return u(this.#a).set(s,f?.isVisibleOnInit??!1),c}#k(n){return n.type==="map-image"||n.type==="wms"}#_(n){const o=new Je(n.uid,n.title,n);return n.sublayers?.length&&(o.children=n.sublayers.toArray().map(this.#_)),o}#S(n,o){for(const s of n)o.set(s.id,s),s.children?.length&&this.#S(s.children,o)}#C(n,o){return`${n}-${o}`}#I(n){return n.type==="group"}#P(n){return n.type==="feature"}#c(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}const eu='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',tu='<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',nu='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',Da=(C,n,o,s)=>n?ru(C,o):o?s?eu:tu:nu,ru=(C,n)=>{switch(C.type){case"group":return Qi;case"feature":return Xi;case"tile":return Do;default:return n?Qi:Xi}};function iu(C){const n=C-1;return n*n*n+1}var au=ae('<div class="relative ml-4 w-full"><div class="tree-guide-line svelte-1y72o5r"></div> <div class="tree-children svelte-1y72o5r"></div></div>'),ou=ae('<div class="w-full"><!> <!></div>');function Ta(C,n){const o=Re(n,"isOpen",3,!1),s=Re(n,"childNodes",3,null),c=Re(n,"duration",3,300);var f=ou(),v=ee(f);Ze(v,()=>n.content??qe);var k=ce(v,2);{var O=P=>{var E=au(),j=ce(ee(E),2);Vt(j,21,()=>s()??[],L=>L.id,(L,Y)=>{var M=de(),N=Z(M);Ze(N,()=>n.childNode??qe,()=>u(Y)),T(L,M)}),X(j),X(E),wr(1,j,()=>ca,()=>({duration:c(),easing:iu})),wr(2,j,()=>ca,()=>({duration:c()})),T(P,E)};ve(k,P=>{o()&&s()&&P(O)})}X(f),T(C,f)}const ui="mb-1 cursor-pointer rounded-md border border-border p-2 text-left",ci="transition-all duration-150 hover:border-border/50 hover:bg-gray-100 hover:shadow-sm",su="transition-colors hover:bg-blue-500",di="text-sm font-normal",fi="bg-card",Fa="bg-accent text-accent-foreground",lu="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";function uu(C={}){const{enhancedHover:n=!1,includeFont:o=!1,pressed:s=!1}=C;let c=ui;return n?c+=" "+ci:c+=" "+su,o&&(c+=" "+di),s?c+=" "+Fa:c+=" "+fi,c}var cu=ae('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),du=ae('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function va(C,n){const o=`calc(100% - ${n.depth*1}rem)`,s=`${ui} ${ci} ${lu} ${fi} ${di}`,c=`${ui} ${ci} ${di}`;var f=de(),v=Z(f);{var k=P=>{To(P,{get pressed(){return n.pressed},get class(){return s},variant:"outline",get style(){return`width: ${o};`},get onPressedChange(){return n.onclick},children:(E,j)=>{var L=cu(),Y=ee(L),M=ee(Y),N=ee(M);qn(N,()=>n.icon),X(M);var B=ce(M,2),F=ee(B,!0);X(B),X(Y);var q=ce(Y,2);Ze(q,()=>n.children??qe),X(L),ut(()=>Ct(F,n.name)),T(E,L)},$$slots:{default:!0}})},O=P=>{var E=du();E.__click=function(...K){n.onclick?.apply(this,K)};var j=ee(E),L=ee(j),Y=ee(L);_a(Y,{get isOpen(){return n.isOpen}});var M=ce(Y,2),N=ee(M);qn(N,()=>n.icon),X(M);var B=ce(M,2),F=ee(B,!0);X(B),X(L);var q=ce(L,2);Ze(q,()=>n.children??qe),X(j),X(E),ut(()=>{vi(E,1,`${c} ${n.pressed?Fa:fi}`),xr(E,`width: ${o};`),Ct(F,n.name)}),T(P,E)};ve(v,P=>{n.isTogglable?P(k):P(O,!1)})}T(C,f)}Ir(["click"]);function Na(C,n){Fe(n,!0);const o=N=>{var B=de(),F=Z(B);{var q=K=>{var U=de(),oe=Z(U);{var te=he=>{va(he,{isTogglable:!1,get pressed(){return u(P)},get icon(){return u(E)},get name(){return n.node.name},get depth(){return c()},onclick:M,get isOpen(){return u(O)}})},se=he=>{va(he,{isTogglable:!0,get pressed(){return u(P)},get icon(){return u(E)},get name(){return n.node.name},get depth(){return c()},onclick:Y,get isOpen(){return u(O)}})};ve(oe,he=>{v?he(te):he(se,!1)})}T(K,U)};ve(F,K=>{n.treeviewConfigStore.getItemConfig(n.node.id)?.isHidden||K(q)})}T(N,B)},s=(N,B=qe)=>{var F=de(),q=Z(F);{var K=U=>{{let oe=Ie(()=>c()+1);Na(U,{get treeviewConfigStore(){return n.treeviewConfigStore},get node(){return B()},get onNodeClick(){return n.onNodeClick},get onNodeVisibilityChange(){return n.onNodeVisibilityChange},get getNodeVisibility(){return n.getNodeVisibility},get depth(){return u(oe)},get useLayerTypeIcon(){return f()}})}};ve(q,U=>{v&&u(O)&&!n.treeviewConfigStore.getItemConfig(B().id)?.isHidden&&U(K)})}T(N,F)},c=Re(n,"depth",3,0),f=Re(n,"useLayerTypeIcon",3,!1),v=!!(n.node.children&&n.node.children.length),k=!v;let O=ie(!1),P=ie(!1),E=ie("");function j(){return!n.node.children||!n.getNodeVisibility?!1:n.node.children.some(N=>{const B=n.getNodeVisibility(N.id);return B!==void 0?B:N instanceof Je?N.layer.visible:!1})}Ve(()=>{if(!(!n.node||!(n.node instanceof Je))){if(v)G(P,j(),!0);else{const N=n.getNodeVisibility?n.getNodeVisibility(n.node.id):void 0;G(P,N!==void 0?N:n.node.layer.visible,!0)}G(E,Da(n.node.layer,f(),v,u(O)),!0)}});function L(){!k||!n.onNodeVisibilityChange||v||(G(P,!u(P)),n.onNodeVisibilityChange(n.node,u(P)))}function Y(){v||L(),n.onNodeClick?.(n.node)}function M(){G(O,!u(O)),n.onNodeClick?.(n.node)}{let N=Ie(()=>v?n.node.children:null);Ta(C,{get isOpen(){return u(O)},get content(){return o},get childNodes(){return u(N)},get childNode(){return s}})}Ne()}function fu(C,n){Fe(n,!0);const o=new Ea;function s(){o.clearSelections()}Ve(()=>{!n.webMap||o.initialized||o.initialize(n.webMap.layers.toArray(),n.treeviewConfigStore,null)}),Ve(()=>{o.initialized&&!o.getVisibleNodes().length&&n.areaSelectionStore.layerId&&o.setVisibilityState(n.areaSelectionStore.layerId,!0)}),Ve(()=>{if(!o.initialized||!o.getVisibleNodes().length)return;const O=o.getVisibleNodes().find(P=>P instanceof Je&&P.layer instanceof ta);if(!O||!(O instanceof Je)){console.warn("Visible node is not a FeatureLayer");return}if(!O.layer||!(O.layer instanceof ta)){console.warn("Visible node layer is not a FeatureLayer",O.layer.type);return}n.areaSelectionStore.setLayerId(O.id)});var c={clearSelections:s},f=de(),v=Z(f);{var k=O=>{var P=de(),E=Z(P);Oe(E,()=>Sa,(j,L)=>{L(j,{children:(Y,M)=>{var N=de(),B=Z(N);Vt(B,17,()=>o.getNodes(),F=>F.id,(F,q)=>{Na(F,{get treeviewConfigStore(){return n.treeviewConfigStore},get node(){return u(q)},onNodeClick:()=>{},onNodeVisibilityChange:(K,U)=>o.setVisibilityState(K.id,U),getNodeVisibility:K=>o.getVisibilityState(K),depth:0,useLayerTypeIcon:!0})}),T(Y,N)},$$slots:{default:!0}})}),T(O,P)};ve(v,O=>{o.initialized&&O(k)})}return T(C,f),Ne(c)}class hu{configStore;constructor(n){this.configStore=n}}class vu extends hu{id="aliasPath";layerToNode(n,o){const s=new Je(n.id,n.title,n,[],o),c=this.configStore.getItemConfig(n.id);if(this.#n(n)&&c?.showFields){const f=n;f.loaded||console.warn(`Layer not loaded: ${n.id}`);const v=new Map;for(const k of f.fields??[]){const O=this.configStore.getItemConfig(this.#t(n.id,k.name));!O||O.isHidden||this.#e(k,s,v)}s.children.sort((k,O)=>k.children.length>0&&O.children.length===0?1:k.children.length===0&&O.children.length>0?-1:0)}return s}#e(n,o,s=new Map){const c=this.#t(o.id,n.name),v=hs(n.alias||"")?.split("|").map(L=>L.trim()).filter(Boolean)??[];if(v.length===0){const L=new xn(c,n.alias||n.name,o.layer,n,[],o);return o.children.push(L),L}const k=v.slice(0,-1),O=v[v.length-1];let P=o;const E=(L,Y)=>{L.children??=[],L.children.includes(Y)||L.children.push(Y)};for(let L=0;L<k.length;L++){const Y=k[L],M=v.slice(0,L+1).join("::"),N=`${o.id}::${M}`;let B=s.get(N);B||(B=new Oa(N,Y,[],P),s.set(N,B),E(P,B)),P=B}const j=new xn(c,O||n.name,o.layer,n,[],P);return E(P,j),j}#t(n,o){return`${n}-${o}`}#n(n){return n.type==="feature"}}class pa{#e=[];#t=new Map;#n=[];#i=new Map;#r=[];#a=new Map;#s=new Set;constructor(n){if(!n)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=n.items??[],this.#t=new Map(this.#e.map(o=>[o.id,o])),this.#n=n.visibilityGroups??[],this.#i=new Map(this.#n.map(o=>[o.id,o])),this.#r=n.inheritanceGroups??[],this.#a=new Map(this.#r.map(o=>[o.id,o])),n.fieldsToHide&&(this.#s=new Set(n.fieldsToHide.map(o=>o.trim().toLowerCase())))}getItemConfig(n){return this.#t.get(n)}getVisibilityGroupConfig(n){return this.#i.get(n)}getInheritanceGroupConfig(n){return this.#a.get(n)}resolveInheritance(n){if(!(n.length===0||!this.#e||this.#e.length===0))for(const o of n){const s=this.getItemConfig(o.id);this.#l(o,s)}}#l(n,o){const s=this.#u(n,o);if(this.#y(n)&&s.showFields){const c=n;c.loaded||console.warn(`Layer not loaded: ${n.id}`);for(const f of c.fields??[])this.#f(this.#g(n.id,f.name),f.alias||f.name,s)}if(this.#m(n)){const c=n;for(const f of c.layers.toArray())this.#l(f,s)}}#u(n,o){const s=this.#h(n.id,o);return s.type===hr.None&&(s.type=Fo(n)),s}#f(n,o,s){const c=this.#h(n,s);return c.type===hr.None&&(c.type=hr.Field),this.#s.has(o.trim().toLowerCase())&&(c.isHidden=!0),c}#h(n,o){let s=this.getItemConfig(n);const c=s?.inheritanceGroupId?this.getInheritanceGroupConfig(s.inheritanceGroupId):this.getInheritanceGroupConfig(o?.inheritanceGroupId??"");return s={id:n,type:hr.None,isDownloadable:this.#o(c,"isDownloadable",s,o,!0),isVisibleOnInit:this.#o(c,"isVisibleOnInit",s,o,!1),isHidden:this.#o(c,"isHidden",s,o,!1),disableVisibilityToggle:this.#o(c,"disableVisibilityToggle",s,o,!1),isOpenOnInit:this.#o(c,"isOpenOnInit",s,o,!1),showFields:this.#o(c,"showFields",s,o,!1),visibilityDependencyIds:this.#o(c,"visibilityDependencyIds",s,o,[]),visibilityGroupId:this.#o(c,"visibilityGroupId",s,o,void 0),customConverterId:this.#o(c,"customConverterId",s,o,void 0),inheritanceGroupId:this.#o(c,"inheritanceGroupId",s,o,void 0)},this.#p(s),this.#d(s),s}#o(n,o,s,c,f){const v=s?.[o];return v!==void 0?v:n?.inheritedProperties.includes(o)&&c?c[o]??f:f}#d(n){if(this.#t.has(n.id))throw new Error(`Item with id ${n.id} already exists.`);this.#e.push(n),this.#t.set(n.id,n)}#p(n){this.#t.has(n.id)&&(this.#e=this.#e.filter(o=>o.id!==n.id),this.#t.delete(n.id))}#g(n,o){return`${n}-${o}`}#m(n){return n.type==="group"}#y(n){return n.type==="feature"}}var pu=ae('<div data-slot="checkbox-indicator" class="text-current transition-none"><!></div>');function gu(C,n){Fe(n,!0);let o=Re(n,"ref",15,null),s=Re(n,"checked",11,!1),c=Re(n,"indeterminate",11,!1),f=Et(n,["$$slots","$$events","$$legacy","ref","checked","indeterminate","class"]),v=ie(Le(s())),k=ie(Le(c()));Ve(()=>{G(v,s())}),Ve(()=>{G(k,c())});var O=de(),P=Z(O);{const E=(L,Y)=>{let M=()=>Y?.().checked,N=()=>Y?.().indeterminate;var B=pu(),F=ee(B);{var q=U=>{Ms(U,{class:"size-3.5"})},K=U=>{var oe=de(),te=Z(oe);{var se=he=>{Ro(he,{class:"size-3.5"})};ve(te,he=>{N()&&he(se)},!0)}T(U,oe)};ve(F,U=>{M()?U(q):U(K,!1)})}X(B),T(L,B)};let j=Ie(()=>vs("peer flex size-4 shrink-0 items-center justify-center rounded-[4px] border border-input shadow-xs transition-shadow outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 data-[state=checked]:border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:bg-input/30 dark:aria-invalid:ring-destructive/40 dark:data-[state=checked]:bg-primary",n.class));Oe(P,()=>No,(L,Y)=>{Y(L,Rt({"data-slot":"checkbox",get class(){return u(j)}},()=>f,{get ref(){return o()},set ref(M){o(M)},get checked(){return u(v)},set checked(M){G(v,M,!0)},get indeterminate(){return u(k)},set indeterminate(M){G(k,M,!0)},children:E,$$slots:{default:!0}}))})}T(C,O),Ne()}var mu=ae("<div><!></div>");function ga(C,n){Fe(n,!0);let o=Ie(()=>n.getDownloadState?.(n.node)??We.Inactive),s=Ie(()=>u(o)===We.Active),c=Ie(()=>u(o)===We.Indeterminate);function f(O){O.stopPropagation();const P=u(o)===We.Active?We.Inactive:We.Active;n.onDownloadStateChanged?.(n.node,P)}var v=mu(),k=ee(v);gu(k,{get checked(){return u(s)},get indeterminate(){return u(c)},onclick:f,title:"Download"}),X(v),T(C,v),Ne()}var yu=ae('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ma(C,n){Fe(n,!0);const o=Re(n,"isFolder",3,!1),s=Re(n,"isOpen",3,!1),c=`calc(100% - ${n.depth*1}rem)`;var f=yu();f.__click=function(...N){n.onclick?.apply(this,N)};var v=ee(f),k=ee(v),O=ee(k);{var P=N=>{_a(N,{get isOpen(){return s()}})};ve(O,N=>{o()&&N(P)})}var E=ce(O,2),j=ee(E);qn(j,()=>n.icon),X(E);var L=ce(E,2),Y=ee(L,!0);X(L),X(k);var M=ce(k,2);Ze(M,()=>n.children??qe),X(v),X(f),ut(N=>{vi(f,1,N),xr(f,`width: ${c};`),Ct(Y,n.name)},[()=>So(uu({enhancedHover:!0,includeFont:!0}))]),T(C,f),Ne()}Ir(["click"]);var bu=ae('<div class="flex items-center gap-2"><!> <!></div>'),wu=ae('<div class="flex items-center gap-2"><!> <!></div>');function Ra(C,n){Fe(n,!0);const o=q=>{var K=de(),U=Z(K);{var oe=te=>{var se=de(),he=Z(se);{var ke=ye=>{ma(ye,{get icon(){return u(L)},get name(){return n.node.name},get depth(){return f()},onclick:F,get isFolder(){return k},get isOpen(){return u(E)},children:_e=>{var De=bu(),ze=ee(De);{var Qe=ge=>{ga(ge,{get node(){return n.node},get onDownloadStateChanged(){return n.onDownloadStateChanged},get getDownloadState(){return n.getDownloadState}})};ve(ze,ge=>{n.isDownloadable&&ge(Qe)})}var Ce=ce(ze,2);{var Me=ge=>{{let Ee=Ie(()=>n.getNodeDrawState?.(n.node.id)===tn.Suspended);$i(ge,{get checked(){return u(j)},get indeterminate(){return u(Ee)},onCheckedChange:N})}};ve(Ce,ge=>{O&&ge(Me)})}X(De),T(_e,De)},$$slots:{default:!0}})},ue=ye=>{ma(ye,{get icon(){return u(L)},get name(){return n.node.name},get depth(){return f()},onclick:B,get isFolder(){return k},children:_e=>{var De=wu(),ze=ee(De);{var Qe=ge=>{ga(ge,{get node(){return n.node},get onDownloadStateChanged(){return n.onDownloadStateChanged},get getDownloadState(){return n.getDownloadState}})};ve(ze,ge=>{n.isDownloadable&&ge(Qe)})}var Ce=ce(ze,2);{var Me=ge=>{{let Ee=Ie(()=>n.getNodeDrawState?.(n.node.id)===tn.Suspended);$i(ge,{get checked(){return u(j)},get indeterminate(){return u(Ee)},onCheckedChange:N})}};ve(Ce,ge=>{O&&ge(Me)})}X(De),T(_e,De)},$$slots:{default:!0}})};ve(he,ye=>{k?ye(ke):ye(ue,!1)})}T(te,se)};ve(U,te=>{c()?.getItemConfig(n.node.id)?.isHidden||te(oe)})}T(q,K)},s=(q,K=qe)=>{var U=de(),oe=Z(U);{var te=se=>{{let he=Ie(()=>c()?.getItemConfig(K().id)?.isDownloadable??!0),ke=Ie(()=>f()+1);Ra(se,{get treeviewConfigStore(){return c()},get node(){return K()},get isDownloadable(){return u(he)},get onNodeClick(){return n.onNodeClick},get onNodeVisibilityChange(){return n.onNodeVisibilityChange},get onDownloadStateChanged(){return n.onDownloadStateChanged},get getDownloadState(){return n.getDownloadState},get onFilterClicked(){return n.onFilterClicked},get hasFiltersApplied(){return n.hasFiltersApplied},get getNodeVisibility(){return n.getNodeVisibility},get getNodeDrawState(){return n.getNodeDrawState},get depth(){return u(ke)},get useLayerTypeIcon(){return v()}})}};ve(oe,se=>{k&&u(E)&&!c()?.getItemConfig(K().id)?.isHidden&&se(te)})}T(q,U)},c=Re(n,"treeviewConfigStore",3,null),f=Re(n,"depth",3,0),v=Re(n,"useLayerTypeIcon",3,!1),k=!!(n.node.children&&n.node.children.length),O=!k;let P=!1,E=ie(!1),j=ie(!1),L=ie(""),Y=ie(!1),M=ie(!1);Ve(()=>{P||(G(E,c()?.getItemConfig(n.node.id)?.isOpenOnInit??!1,!0),P=!0)}),Ve(()=>{if(!n.node)return;const q=n.getNodeVisibility?n.getNodeVisibility(n.node.id):!1;G(j,q??!1,!0),n.node instanceof Je&&G(L,Da(n.node.layer,v(),k,u(E)),!0)}),Ve(()=>{if(!(n.node instanceof Je))return;const q=(n.getDownloadState?.(n.node)===We.Active&&n.node.layer.type==="feature")??!1;q&&!u(Y)?(G(Y,!0),G(M,!1)):!q&&u(Y)&&(G(M,!0),setTimeout(()=>{G(Y,!1),G(M,!1)},180))});function N(){!O||!n.onNodeVisibilityChange||(G(j,!u(j)),n.onNodeVisibilityChange(n.node,u(j)))}function B(){n.onNodeClick?.(n.node)}function F(){G(E,!u(E)),n.onNodeClick?.(n.node)}{let q=Ie(()=>k?n.node.children:null);Ta(C,{get isOpen(){return u(E)},get content(){return o},get childNodes(){return u(q)},get childNode(){return s}})}Ne()}class _u{#e;#t;constructor(n,o){this.#e=n,this.#t=o}updateSelection(n,o){if(!this.#t.getItemConfig(n.id)?.isHidden){if(!(n instanceof Je)){this.updateChildrenSelection(n,o);return}if(n instanceof xn){this.updateFieldSelection(n,o);return}this.updateLayerSelection(n,o)}}getSelectionState(n){if(!(n instanceof Je))return this.determineSelectionStateFromChildren(n);if(this.isGroupLayer(n))return this.determineSelectionStateFromChildren(n);let o;return n instanceof xn?(o=this.#e.getSelection(n.featureLayer.id),o&&o.selectedFieldIds.has(n.field.name)?We.Active:We.Inactive):(o=this.#e.getSelection(n.id),o?this.isFeatureLayer(n)&&n.children&&n.children.length>0?this.determineSelectionStateFromChildren(n):We.Active:We.Inactive)}updateLayerSelection(n,o){let s=this.#e.getSelection(n.id);switch(o){case We.Active:!s&&!this.isGroupLayer(n)&&(s=this.createAndAddDataSelection(n.id));for(const c of n.children||[])this.updateSelection(c,o);break;case We.Inactive:s&&!this.isGroupLayer(n)&&this.#e.removeSelection(n.id),this.updateChildrenSelection(n,o);break}}updateFieldSelection(n,o){let s=this.#e.getSelection(n.featureLayer.id);switch(o){case We.Active:s||(s=this.createAndAddDataSelection(n.featureLayer.id)),this.#e.addOrUpdateSelection(n.featureLayer.id,[...s.selectedFieldIds,n.field.name]);break;case We.Inactive:{if(!s)break;const c=new Bt(s.selectedFieldIds);c.delete(n.field.name),this.#e.addOrUpdateSelection(n.featureLayer.id,[...c]),c.size===0&&this.#e.removeSelection(s.layerId);break}}}updateChildrenSelection(n,o){for(const s of n.children||[])this.updateSelection(s,o)}determineSelectionStateFromChildren(n){let o=0,s=0;for(const c of n.children||[]){if(this.#t.getItemConfig(c.id)?.isHidden)continue;s++;const v=this.getSelectionState(c);if(v===We.Active||this.isFeatureLayer(c)&&v!==We.Inactive)o++;else if(v===We.Indeterminate)return We.Indeterminate}return o===0?We.Inactive:o===s?We.Active:We.Indeterminate}createAndAddDataSelection(n){const o={layerId:n,selectedFieldIds:new Bt};return this.#e.addSelection(o),o}isGroupLayer(n){return n instanceof Je&&n.layer.type==="group"}isFeatureLayer(n){return n instanceof Je&&n.layer.type==="feature"}}function Su(C,n){Fe(n,!0);const o=Re(n,"fieldFilterMenuStore",7);function s(){c.clearSelections()}const c=new Ea,f=new _u(n.dataSelectionStore,n.treeviewConfigStore);Ve(()=>{if(!n.webMap||c.initialized)return;(async()=>{await n.webMap.when(),await v(n.webMap.layers.toArray());const q=new vu(n.treeviewConfigStore);c.initialize(n.webMap.layers.toArray(),n.treeviewConfigStore,n.layerViewProvider,[q],n.customRendererService)})()});async function v(F){for(const q of F)q.type==="feature"&&!q.loaded&&await q.load(),q.type==="group"&&await v(q.layers.toArray())}function k(F,q){console.log(`[tree-view] onNodeVisibilityChange: Setting visibility of node ${F.id} to ${q}`),c.setVisibilityState(F.id,q)}function O(F){return c.getNodeDrawState(F)}function P(F,q){f.updateSelection(F,q)}function E(F){return f.getSelectionState(F)}function j(F){if(o().ActiveLayer?.uid===F){o().ActiveLayer=null;return}const K=c.getNodeById(F);!K||!(K instanceof Je)||(o().ActiveLayer=K.layer)}function L(F){const q=n.dataSelectionStore.getSelection(F);if(!q?.selectedFieldIds)return!1;const K=c.getNodeById(F);if(!K||!(K instanceof Je))return!1;const U=K.layer.fields?.length||0,oe=q?.selectedFieldIds.size||0;return oe>0&&oe!==U}var Y={clearSelections:s},M=de(),N=Z(M);{var B=F=>{var q=de(),K=Z(q);Oe(K,()=>Sa,(U,oe)=>{oe(U,{children:(te,se)=>{var he=de(),ke=Z(he);Vt(ke,17,()=>c.getNodes(),ue=>ue.id,(ue,ye)=>{{let Se=Ie(()=>n.treeviewConfigStore.getItemConfig(u(ye).id)?.isDownloadable??!0);Ra(ue,{get treeviewConfigStore(){return n.treeviewConfigStore},get node(){return u(ye)},get isDownloadable(){return u(Se)},onNodeClick:()=>{},onNodeVisibilityChange:k,getNodeVisibility:_e=>c.getVisibilityState(_e),onDownloadStateChanged:P,getDownloadState:E,onFilterClicked:j,hasFiltersApplied:L,getNodeDrawState:O,depth:0,useLayerTypeIcon:!0})}}),T(te,he)},$$slots:{default:!0}})}),T(F,q)};ve(N,F=>{c.initialized&&F(B)})}return T(C,M),Ne(Y)}var xu=ae('<div class="map-view svelte-14z0ybm"></div>');function ku(C,n){Fe(n,!0);const o=Re(n,"mapView",7);let s=ie(null),c=null;const f="streets-vector";let v,k;function O(){if(!o())throw new Error("MapView is not initialized");return new Ca(o())}jn(async()=>{await P(),await L()});async function P(){if(!k){const[{default:F},{default:q},{default:K},{default:U}]=await Promise.all([Mn(()=>import("../chunks/BsJbwhv8.js").then(oe=>oe.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]),import.meta.url),Mn(()=>import("../chunks/BBnDJw94.js").then(oe=>oe.a2),__vite__mapDeps([28,1,2,3,5,29,30,18,31,16,6,7,32,8,9,15,20,33,34,11,17,35,25,36,37,38,19,39,40,41,42,43,0,4,10,12,13,14,21,22,23,24,26,27,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65]),import.meta.url),Mn(()=>import("../chunks/Bs6xTxvz.js").then(oe=>oe.W),__vite__mapDeps([66,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,29,30,31,32,33,34,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,49,50,100,101,102]),import.meta.url),Mn(()=>import("../chunks/C6j0c8D7.js").then(oe=>oe.aq),__vite__mapDeps([67,5,1,2,3,32,18,8,7,9,6,15,16,20,33,68,69,70,19,71,34,11,72,73,25,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,12]),import.meta.url)]);v=F,k=q}}async function E(){return new v({basemap:f})}async function j(){if(n.webMap)try{if(await P(),await L(),!o()){console.error("MapView is not initialized");return}o().container=c,o().popupEnabled=!1,o().map=n.webMap,console.log("[uprn-map-view] MapView updated with new webMap"),await n.areaSelectionInteractionStore.refreshLayerView(),await n.areaSelectionInteractionStore.refreshAreas()}catch(F){console.error("Error updating MapView with new webMap:",F)}}async function L(){if(!c){console.error("Map container element was not found");return}try{o().container=c,o().popupEnabled=!1,o().map=n.webMap??void 0,o().ui.move("zoom","top-right"),await o().when(),console.log("[uprn-map-view] Map loaded successfully")}catch(F){console.error("Error loading map:",F),await Y()}}async function Y(){try{const F=await E();o().container=c,o().popupEnabled=!1,o().map=F,await o().when(),console.log("[uprn-map-view] Fallback map loaded")}catch(F){console.error("Error loading fallback map:",F)}}Ve(()=>{n.webMap&&j()}),Ve(()=>{!o()||u(s)||G(s,new ps(o(),n.areaSelectionInteractionStore,n.interactableLayers),!0)});function M(){o()&&o().destroy()}ya(()=>{M()});var N={getLayerViewProvider:O},B=xu();return Nt(B,F=>c=F,()=>c),T(C,B),Ne(N)}var Cu=ae('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),Iu=ae('<div class="flex min-h-0 flex-1 flex-col"><!></div>');function yr(C,n){var o=Iu(),s=ee(o);Oe(s,()=>Cr,(c,f)=>{f(c,{class:"card-content flex min-h-0 flex-1 flex-col overflow-hidden p-0",children:(v,k)=>{var O=Cu(),P=ee(O);Ze(P,()=>n.children??qe),X(O),T(v,O)},$$slots:{default:!0}})}),X(o),T(C,o)}var Pu=ae("<!> <!>",1),Au=ae('<div class="tab-list-wrapper flex-shrink-0 svelte-rohqkk"><!></div> <!>',1);function Ou(C,n){Fe(n,!0);const o=Re(n,"triggers",19,()=>[]);var s=de(),c=Z(s);Oe(c,()=>Mo,(f,v)=>{v(f,{get value(){return n.value},get onValueChange(){return n.onValueChange},class:"flex h-full w-full flex-col",children:(k,O)=>{var P=Au(),E=Z(P),j=ee(E);Oe(j,()=>Lo,(Y,M)=>{M(Y,{class:"tab-list",children:(N,B)=>{var F=de(),q=Z(F);Vt(q,17,o,Sn,(K,U,oe,te)=>{let se=()=>u(U).value,he=()=>u(U).label;var ke=Pu(),ue=Z(ke);Oe(ue,()=>jo,(_e,De)=>{De(_e,{get value(){return se()},class:"tab-trigger",children:(ze,Qe)=>{dn();var Ce=_n();ut(()=>Ct(Ce,he())),T(ze,Ce)},$$slots:{default:!0}})});var ye=ce(ue,2);{var Se=_e=>{cs(_e,{class:"separator"})};ve(ye,_e=>{se()!==o()[o().length-1]?.value&&_e(Se)})}T(K,ke)}),T(N,F)},$$slots:{default:!0}})}),X(E);var L=ce(E,2);Ze(L,()=>n.children??qe),T(k,P)},$$slots:{default:!0}})}),T(C,s),Ne()}const Eu=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];class Du{#e;constructor(n){if(!n)throw new Error("UprnDownloadService endpoints configuration is required");if(!n.baseUrl||!n.healthRoute||!n.requestJobRoute||!n.requestJobStatusesRoute||!n.getAreaSelectionLimitsRoute||!n.fetchDownloadRoute)throw new Error("UprnDownloadService endpoints configuration is incomplete");this.#e=n}async getHealth(){try{const n=`${this.#e.baseUrl}${this.#e.healthRoute}`,o=await fetch(n);return o.ok?(await o.json()).status==="ok":!1}catch(n){return console.error("Health check failed:",n),!1}}async requestJob(n){try{console.log("[uprn-download-service] requesting job with request:",n);const o=`${this.#e.baseUrl}${this.#e.requestJobRoute}`,s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok){console.error("Failed to request job:",s.statusText,"request:",JSON.stringify(n));return}return await s.json()}catch(o){console.error("Error requesting job:",o);return}}async requestJobStatuses(n){try{const o=`${this.#e.baseUrl}${this.#e.requestJobStatusesRoute}`,s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok){console.error("Failed to get job statuses:",s.statusText);return}return await s.json()}catch(o){console.error("Error getting job statuses:",o);return}}async getSelectionAreaLimits(){try{const n=`${this.#e.baseUrl}${this.#e.getAreaSelectionLimitsRoute}`,o=await fetch(n);if(!o.ok){console.error("Failed to get area selection limits:",o.statusText);return}return await o.json()}catch(n){console.error("Error getting selection area limits:",n);return}}getDownloadUrl(n){const o=this.#e.baseUrl.replace(/\/+$/,""),s=this.#e.fetchDownloadRoute.replace(/\/+$/,"");return`${o}${s}/${encodeURIComponent(n)}`}}class Tu{#e;constructor(n){this.#e=n}async getHealth(){try{const n=`${this.#e.baseUrl}${this.#e.healthRoute}`,o=await fetch(n);return o.ok?(await o.json()).status==="ok":!1}catch(n){return console.error("Health check failed:",n),!1}}async chat(n){try{const o=`${this.#e.baseUrl}${this.#e.chatRoute}`,c=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n})});if(!c.ok){console.error("Failed to send chat query:",c.statusText);return}return await c.json()}catch(o){console.error("Error sending chat query:",o);return}}async chatStream(n,o){try{const s=`${this.#e.baseUrl}${this.#e.chatStreamRoute}`,f=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n})});if(!f.ok)return console.error("Failed to start chat stream:",f.statusText),!1;const v=f.body?.getReader();if(!v)return console.error("No response body reader available"),!1;const k=new TextDecoder;let O=!1;for(;!O;){const{value:P,done:E}=await v.read();if(O=E,P){const j=k.decode(P,{stream:!O});o(j)}}return!0}catch(s){return console.error("Error during chat stream:",s),!1}}}const Fu=Object.freeze({lod00World:{lod:0,scale:591657527591555e-6},lod01World:{lod:1,scale:295828763795777e-6},lod02World:{lod:2,scale:147914381897889e-6},lod03Continent:{lod:3,scale:73957190948944e-6},lod04Continent:{lod:4,scale:36978595474472e-6},lod05Countries:{lod:5,scale:18489297737236e-6},lod06Country:{lod:6,scale:9244648868618e-6},lod07StatesProvinces:{lod:7,scale:4622324434309e-6},lod08Counties:{lod:8,scale:2311162217155e-6},lod09Counties:{lod:9,scale:1155581108577e-6},lod10Country:{lod:10,scale:577790.554289},lod11MetropolitanArea:{lod:11,scale:288895.277144},lod12Cities:{lod:12,scale:144447.638572},lod13City:{lod:13,scale:72223.819286},lod14Town:{lod:14,scale:36111.909643},lod15Neighborhood:{lod:15,scale:18055.954822},lod16Streets:{lod:16,scale:9027.977411},lod17CityBlock:{lod:17,scale:4513.988705},lod18Buildings:{lod:18,scale:2256.994353},lod19Building:{lod:19,scale:1128.497176},lod20Houses:{lod:20,scale:564.248588},lod21Houses:{lod:21,scale:282.124294},lod22Houses:{lod:22,scale:141.062147},lod23HouseProperty:{lod:23,scale:70.5310735}});class Nu{#e=null;#t=!1;async init(n){this.#t||(await this.#n(n),this.#t=!0)}async#n(n){const s=await(await fetch(n)).json();this.#e=s}doesFieldHaveCustomRenderer(n,o){this.#u();const s=this.#e.FeatureLayers.find(v=>v.Name===n.title);if(!s)return!1;const c=this.#e.Fields.find(v=>v.FeatureLayerId===s.Id&&v.Name===o);return c?!!this.#e.CustomRenderers_Fields.find(v=>v.FieldId===c.Id):!1}getAllFieldsWithCustomRenderers(n){this.#u();const o=this.#e.FeatureLayers.find(f=>f.Name===n.title);if(!o)return[];const s=this.#e.Fields.filter(f=>f.FeatureLayerId===o.Id),c=[];for(const f of s)this.#e.CustomRenderers_Fields.some(k=>k.FieldId===f.Id)&&c.push(f.Name);return c}async applyCustomRenderer(n,o){this.#u();const s=this.#e.FeatureLayers.find(E=>E.Name===n.title);if(!s)return;const c=this.#e.Fields.find(E=>E.FeatureLayerId===s.Id&&E.Name===o);if(!c){console.warn(`[custom-renderer-service] could not find the field ${o} for feature layer id ${s.Id}`);return}const f=this.#e.CustomRenderers_Fields.find(E=>E.FieldId===c.Id);if(!f){console.warn(`[custom-renderer-service] could not find a custom renderer field for field ${o} in feature layer id ${s.Id}`);return}const v=this.#e.CustomRenderers.find(E=>E.Id===f.CustomRendererId);if(!v)throw new Error(`Could not find a custom renderer with the id ${f.CustomRendererId}`);const k=await this.getRendererClassBreaks(v.ClassBreaksGroupId.toString()),O=await this.getRendererSymbols(v.SymbolsId.toString()),P=this.#r(v.CustomRendererType,O,k,[],o);n.renderer=P,this.setCustomOutlines(n,v.LodsGroupId)}async setCustomOutlines(n,o){const s=this.#e.CustomRenderers_Lods.filter(v=>v.GroupId===o).sort((v,k)=>v.Lod-k.Lod);if(s.length===0){console.warn(`No LODs found for LODs group id ${o}`);return}const c=[],f=Object.values(Fu);s.forEach(v=>{const k=v.OutlineWidth,O=v.Lod,P=this.#i(f,O)-1;c.push({size:k,value:f[P].scale})}),(n.renderer instanceof ra||n.renderer instanceof ia)&&this.#l(n.renderer,c)}async getRendererClassBreaks(n){const o=parseInt(n,10),s=this.#e.CustomRenderers_ClassBreaks.filter(c=>c.GroupId===o).sort((c,f)=>c.Order-f.Order);if(s.length===0)throw new Error(`Could not find a group with the id ${n}`);return s}async getRendererSymbols(n){const o=parseInt(n,10),s=this.#e.CustomRenderers_Symbols.find(v=>v.Id===o);if(!s)throw new Error(`Could not find a symbol with the id ${n}`);const c=this.#e.CustomRenderers_Symbols_Appearances.filter(v=>v.SymbolsId===o).sort((v,k)=>v.Order-k.Order);return{...s,Appearances:c}}#i(n,o){const s=n.findIndex(c=>c.lod===o);return s===-1?0:s<23?s+1:s}#r(n,o,s,c,f){switch(n){case 1:return this.#s(o,c);case 2:return this.#a(f,o,s,c);default:throw new Error(`Unknown renderer type: ${n}`)}}#a(n,o,s,c){const f="ClassMinValue",v="ClassMaxValue",k="SymbolColor",O="OutlineColor",P="OutlineWidth",E=o.Appearances.length,j=new ra({field:n});for(let L=0;L<E;L++){const Y=s[L][f],M=s[L][v],N=o.Appearances[L][k],B=o.Appearances[L][O],F=o.Appearances[L][P];j.addClassBreakInfo({minValue:Y,maxValue:M,symbol:new aa({color:pr.fromHex(N),outline:new oa({color:pr.fromHex(B),width:F})})})}return this.#l(j,c),j}#s(n,o){const s="SymbolColor",c="OutlineColor",f="OutlineWidth",v=n.Appearances[0][s],k=n.Appearances[0][c],O=n.Appearances[0][f],P=new ia({symbol:new aa({color:pr.fromHex(v),outline:new oa({color:pr.fromHex(k),width:O})})});return this.#l(P,o),P}#l(n,o){n.visualVariables=[{type:"size",target:"outline",valueExpression:"$view.scale",stops:o}]}#u(){if(!this.#t)throw new Error("CustomRendererService is not initialized");if(!this.#e)throw new Error("Data is not loaded")}}var Ru=ae('<div class="flex w-full items-center justify-between"><div class="font-medium">Chat</div> <div class="flex gap-1"><!> <!></div></div>'),Mu=ae("<!> <!>",1),Lu=ae("<div><!></div>");function ju(C,n){Fe(n,!0);const o=Re(n,"isOpenedOnInit",3,!1);let s=ie(!1),c=ie(Le(o())),f=ie(!1),v=ie(void 0),k="300px",O="45px";Ve(()=>{u(s)||!u(v)||(u(c)&&(u(v).style.height=k),G(s,!0))});function P(){u(v)&&(G(c,!u(c)),G(f,!1),u(c)?(O=u(v).style.height,u(v).style.height=k):u(v).style.height=O)}function E(){u(v)&&(G(f,!u(f)),u(f)?(k=u(v).style.height,u(v).style.height="100%"):u(v).style.height=k)}var j=Lu(),L=ee(j);Oe(L,()=>kr,(Y,M)=>{M(Y,{class:"h-full w-full gap-0 rounded-none py-0 pt-0 pb-0",children:(N,B)=>{var F=Mu(),q=Z(F);Oe(q,()=>ws,(oe,te)=>{te(oe,{class:"pt-2",children:(se,he)=>{var ke=Ru(),ue=ce(ee(ke),2),ye=ee(ue);{var Se=De=>{Tt(De,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:E,children:(ze,Qe)=>{var Ce=de(),Me=Z(Ce);{var ge=at=>{qs(at,{class:"text-primary"})},Ee=at=>{Ks(at,{class:"text-primary"})};ve(Me,at=>{u(f)?at(ge):at(Ee,!1)})}T(ze,Ce)},$$slots:{default:!0}})};ve(ye,De=>{u(c)&&De(Se)})}var _e=ce(ye,2);Tt(_e,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:P,children:(De,ze)=>{var Qe=de(),Ce=Z(Qe);{var Me=Ee=>{js(Ee,{class:"text-primary"})},ge=Ee=>{_s(Ee,{class:"text-primary"})};ve(Ce,Ee=>{u(c)?Ee(ge,!1):Ee(Me)})}T(De,Qe)},$$slots:{default:!0}}),X(ue),X(ke),T(se,ke)},$$slots:{default:!0}})});var K=ce(q,2);{var U=oe=>{var te=de(),se=Z(te);Oe(se,()=>Cr,(he,ke)=>{ke(he,{class:"h-full min-h-[10px] w-full p-0",children:(ue,ye)=>{var Se=de(),_e=Z(Se);Ze(_e,()=>n.children??qe),T(ue,Se)},$$slots:{default:!0}})}),T(oe,te)};ve(K,oe=>{u(c)&&oe(U)})}T(N,F)},$$slots:{default:!0}})}),X(j),Nt(j,Y=>G(v,Y),()=>u(v)),T(C,j),Ne()}class Ku{#e;#t;#n=ie(!1);#i=Ie(()=>this.#e.exportSnapshot());#r=Ie(()=>{const n=new qt;for(const[o,s]of this.#t.dataSelections)n.set(o,{layerId:s.layerId,selectedFieldIds:s.selectedFieldIds});return n});constructor(n,o){this.#e=n,this.#t=o,bo(()=>{Ve(()=>{console.log("[selection-tracking-store] Detected area selection change"),(async()=>{if(!u(this.#n)){console.log("[selection-tracking-store] Initial load not complete, skipping area selection effect");return}if(u(this.#i)){if(!u(this.#i).layerId){await Rn({areas:null});return}if(!u(this.#i).selectedAreaIds.size){await Rn({areas:null});return}await Rn({areas:u(this.#i)}),console.log("[selection-tracking-store] Area selection updated:",ai(u(this.#i)))}})()}),Ve(()=>{console.log("[selection-tracking-store] Detected data selection change"),(async()=>{if(!u(this.#n)){console.log("[selection-tracking-store] Initial load not complete, skipping data selection effect");return}if(!u(this.#r)||u(this.#r).size===0){console.log("[selection-tracking-store] No data selections, clearing in database"),await Rn({data:[]});return}await Rn({data:u(this.#r).values().toArray()}),console.log("[selection-tracking-store] Data selection updated:",ai(u(this.#r)))})()})})}async loadSelections(){const n=await Aa();if(!n){console.log("[selection-tracking-store] No existing selection found in database"),G(this.#n,!0);return}console.log("[selection-tracking-store] Loaded selection from database:",n),n.areas&&(this.#e.setLayerId(n.areas.layerId),console.log("[selection-tracking-store] (loadSelections) Restoring selected area IDs:",Array.from(n.areas.selectedAreaIds),"layer ID:",this.#e.layerId),this.#e.addSelectedAreas(Array.from(n.areas.selectedAreaIds))),n.data.forEach(o=>{this.#t.addSelection(o)}),G(this.#n,!0)}}var qu=ae("<!> <!>",1),Bu=ae('<p class="p-4 text-center text-sm text-gray-500">Download service is not available.</p>'),Vu=ae("<div><!></div> <div><!></div> <div><!></div> <div><!></div>",1),zu=ae("<div><!></div>"),Uu=ae('<p class="p-4 text-center text-sm text-gray-500">AI UPRN Chatbot service is not available.</p>'),Hu=ae('<div class="relative flex h-full w-full min-w-0 flex-col overflow-visible"><!> <!> <!> <!></div>'),Gu=ae("<!> <!> <!> <!>",1);function od(C,n){Fe(n,!0);let o,s,c;const f=Le(new Tl),v=Le(new Dl);let k=ie("define-areas"),O=Le(new Al),P=Le(new gs),E=ie(null),j=Le(new Ku(P,O)),L=ie(null),Y=ie(void 0),M=ie(void 0),N=ie(void 0),B=ie(void 0),F=ie(void 0),q=ie(!1),K=ie(!1),U=ie(Le(new Set)),oe=ie(Le(new Set)),te=ie(!0),se=Le(na.LEFT);Le(na.BOTTOM);let he=ie(Le([])),ke=ie(Le(typeof window<"u"?window.innerWidth:1280)),ue=Ie(()=>Se(u(he),fe=>fe.originalSize)),ye=Ie(()=>Se(u(he),fe=>fe.minSize));function Se(fe,je){if(!fe||fe.length===0)return;const Pe=[...fe].sort((et,It)=>It.breakpoint-et.breakpoint).find(et=>u(ke)>=et.breakpoint);return Pe?je(Pe):"0"}function _e(){G(te,!u(te))}function De(fe){G(k,fe,!0)}function ze(){G(k,"downloads")}function Qe(){P.clearSelectedAreas(),O.clearSelections(),o?.clearSelections(),s?.clearSelections(),pl()}jn(async()=>{G(N,new Nu,!0),await u(N).init(`${Zo}/custom-renderers.json`),console.log("[uprn-2/page] CustomRendererService initialized");const fe=await ds();await j.loadSelections();const[{default:je}]=await Promise.all([Mn(()=>import("../chunks/BBnDJw94.js").then(Pe=>Pe.a2),__vite__mapDeps([28,1,2,3,5,29,30,18,31,16,6,7,32,8,9,15,20,33,34,11,17,35,25,36,37,38,19,39,40,41,42,43,0,4,10,12,13,14,21,22,23,24,26,27,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65]),import.meta.url)]);G(L,new je,!0),G(E,new ms(P,new Ca(u(L))),!0),G(oe,new Set((fe.serviceUprn2Config.selectionLayersNameFields||[]).map(Pe=>Pe.layerName)),!0),u(E).setFieldInfos(fe.serviceUprn2Config.selectionLayersNameFields||[]),G(he,fe.serviceUprn2Config.mainSidebarSizes||[],!0),G(Y,new pa(fe.serviceUprn2Config.dataSelectionTreeviewConfig),!0),G(M,new pa(fe.serviceUprn2Config.areaSelectionTreeviewConfig),!0),(async()=>{const Pe=fe.serviceUprn2Config.uprnDownloadServiceEndpoints,et=fe.serviceUprn2Config.aiUprnChatbotServiceEndpoints;G(B,new Du(Pe),!0),G(F,new Tu(et),!0),G(q,await u(B).getHealth(),!0),u(q)?console.log("[uprn-2/page] UPRN Download Service is available"):console.warn("[uprn-2/page] UPRN Download Service is NOT available"),G(K,await u(F).getHealth(),!0),u(K)?console.log("[uprn-2/page] AI UPRN Chatbot Service is available"):console.warn("[uprn-2/page] AI UPRN Chatbot Service is NOT available")})(),G(U,new Set(fe.serviceUprn2Config.dataSelectionTreeviewConfig?.fieldsToHide||[]),!0),await f.initializeAsync({portalUrl:fe.serviceUprn2Config.portalUrl,itemId:fe.serviceUprn2Config.portalItemId||"",proxy:fe.serviceUprn2Config.proxy})}),jn(()=>{const fe=()=>{G(ke,window.innerWidth,!0)};return window.addEventListener("resize",fe),()=>{window.removeEventListener("resize",fe)}}),ya(()=>{O.cleanup()});var Ce=Gu(),Me=Z(Ce);Ko(Me,{});var ge=ce(Me,2);Zl(ge,{get dataSelectionStore(){return O},get fieldFilterMenuStore(){return v},get fieldsToHide(){return u(U)}});var Ee=ce(ge,2);{var at=fe=>{var je=qu(),Xe=Z(je);Us(Xe,{get areaSelectionInteractionStore(){return u(E)}});var Pe=ce(Xe,2);Hs(Pe,{get areaSelectionInteractionStore(){return u(E)}}),T(fe,je)};ve(Ee,fe=>{u(E)&&fe(at)})}var ot=ce(Ee,2);{const fe=Xe=>{var Pe=Hu(),et=ee(Pe);Oe(et,()=>Fs,(tt,pe)=>{pe(tt,{children:(Be,gt)=>{Ou(Be,{get value(){return u(k)},get triggers(){return Eu},onValueChange:De})},$$slots:{default:!0}})});var It=ce(et,2);Oe(It,()=>ys,(tt,pe)=>{pe(tt,{children:(Be,gt)=>{var Ue=Vu(),ct=Z(Ue),pt=ee(ct);yr(pt,{children:(kt,Mt)=>{var Ye=de(),dt=Z(Ye);{var wt=$e=>{Nt(fu($e,{get webMap(){return f.data},get treeviewConfigStore(){return u(M)},get areaSelectionStore(){return P}}),ft=>o=ft,()=>o)};ve(dt,$e=>{f.isLoaded&&$e(wt)})}T(kt,Ye)}}),X(ct);var nt=ce(ct,2),st=ee(nt);yr(st,{children:(kt,Mt)=>{var Ye=de(),dt=Z(Ye);{var wt=$e=>{{let ft=Ie(()=>c?.getLayerViewProvider());Nt(Su($e,{get webMap(){return f.data},get dataSelectionStore(){return O},get layerViewProvider(){return u(ft)},get treeviewConfigStore(){return u(Y)},get customRendererService(){return u(N)},get fieldFilterMenuStore(){return v}}),Lt=>s=Lt,()=>s)}};ve(dt,$e=>{f.isLoaded&&$e(wt)})}T(kt,Ye)}}),X(nt);var lt=ce(nt,2),He=ee(lt);yr(He,{children:(kt,Mt)=>{var Ye=de(),dt=Z(Ye);{var wt=$e=>{Vl($e,{get webMapStore(){return f},get areaSelectionInteractionStore(){return u(E)},get dataSelectionStore(){return O},get dataSelectionTreeviewConfig(){return u(Y)},get fieldFilterMenuStore(){return v}})};ve(dt,$e=>{u(E)&&f.isLoaded&&$e(wt)})}T(kt,Ye)}}),X(lt);var xt=ce(lt,2),Ft=ee(xt);yr(Ft,{children:(kt,Mt)=>{var Ye=de(),dt=Z(Ye);{var wt=ft=>{var Lt=Bu();T(ft,Lt)},$e=ft=>{Il(ft,{get webMapStore(){return f},get uprnDownloadService(){return u(B)},get fieldsToHide(){return u(U)}})};ve(dt,ft=>{!u(B)||!u(q)?ft(wt):ft($e,!1)})}T(kt,Ye)}}),X(xt),ut(()=>{ct.hidden=u(k)!=="define-areas",nt.hidden=u(k)!=="select-data",lt.hidden=u(k)!=="export",xt.hidden=u(k)!=="downloads"}),T(Be,Ue)},$$slots:{default:!0}})});var ne=ce(It,2);Oe(ne,()=>Rs,(tt,pe)=>{pe(tt,{children:(Be,gt)=>{var Ue=zu(),ct=ee(Ue);{var pt=nt=>{El(nt,{onExportSuccess:ze,clearSelections:Qe,get areaSelectionInteractionStore(){return u(E)},get dataSelectionStore(){return O}})};ve(ct,nt=>{u(E)&&nt(pt)})}X(Ue),ut(()=>Ue.hidden=u(k)!=="export"),T(Be,Ue)},$$slots:{default:!0}})});var St=ce(ne,2);ju(St,{isOpenedOnInit:!0,children:(tt,pe)=>{var Be=de(),gt=Z(Be);{var Ue=pt=>{var nt=Uu();T(pt,nt)},ct=pt=>{ul(pt,{get aiUprnChatbotService(){return u(F)}})};ve(gt,pt=>{!u(F)||!u(K)?pt(Ue):pt(ct,!1)})}T(tt,Be)},$$slots:{default:!0}}),X(Pe),T(Xe,Pe)},je=Xe=>{var Pe=de(),et=Z(Pe);{var It=ne=>{Nt(ku(ne,{get webMap(){return f.data},get mapView(){return u(L)},get areaSelectionInteractionStore(){return u(E)},get interactableLayers(){return u(oe)}}),St=>c=St,()=>c)};ve(et,ne=>{u(E)&&ne(It)})}T(Xe,Pe)};Oe(ot,()=>bs,(Xe,Pe)=>{Pe(Xe,{get isOpen(){return u(te)},onToggle:_e,get position(){return se},get originalSize(){return u(ue)},get minSize(){return u(ye)},sidebarContent:fe,mainContent:je,$$slots:{sidebarContent:!0,mainContent:!0}})})}T(C,Ce),Ne()}export{od as component};
