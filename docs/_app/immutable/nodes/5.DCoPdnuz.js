const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CqdJTlSq.js","../chunks/20z1kPdE.js","../chunks/waHvktcX.js","../chunks/hffy0Rzx.js","../chunks/Be5BmMgB.js","../chunks/PPVm8Dsz.js","../chunks/BUXna_JK.js","../chunks/PYsgr6Cv.js","../chunks/DN9kDbX2.js","../chunks/DMvchwLT.js","../chunks/C4idZhCR.js","../chunks/DeBzx-Kv.js","../chunks/CmlOEIqN.js","../chunks/DGcr_N8i.js","../chunks/BlYmCyW6.js","../chunks/ByOEwiGd.js","../chunks/CE_6rpa2.js","../chunks/brROqHrR.js","../chunks/DLsg3iLa.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/CxP1NnKQ.js","../chunks/Ducz1gN7.js","../chunks/Df3jYj0r.js","../chunks/Cl5lrJ4c.js","../chunks/6s7HVfZ4.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/DjDSr30s.js","../chunks/CrKcHbak.js","../chunks/v5YLNKG-.js","../chunks/Bs2gC6jc.js","../chunks/Djp3mnm5.js","../chunks/D4NhHaOs.js","../chunks/DQOJ18NT.js","../chunks/COxaayR7.js","../chunks/D6P5UyiM.js","../chunks/rFlUt-l9.js","../chunks/Bw0t1Yok.js","../chunks/Dv4MSmCl.js","../chunks/EzLf78vY.js","../chunks/LxaF4LD2.js","../chunks/DgjZP27_.js","../chunks/DmgVh9QE.js","../chunks/B5pjZHOf.js","../chunks/bv1iIWk1.js","../chunks/CX1JGI5D.js","../chunks/DZd6gJy7.js","../chunks/CUEKi1yE.js","../chunks/C8BmVxiO.js","../chunks/DkTq9JOh.js","../chunks/BzE_qfbm.js","../chunks/ckFzXQhv.js","../chunks/DUyBDr87.js","../chunks/66vT34n1.js","../chunks/hi8cSNjq.js","../chunks/9YvG7tFv.js","../chunks/BMk-Lqao.js","../chunks/BLN0A8dL.js","../chunks/aQeO9QTD.js","../chunks/31Wp3w15.js","../chunks/BkSYUJNM.js","../chunks/DlEt6vgh.js","../chunks/B9a9aCD-.js","../chunks/CspAMP-u.js","../chunks/TVq_ULnT.js","../chunks/xHKbaSWM.js","../chunks/DjQ20mEr.js","../chunks/B1der0FQ.js","../chunks/CEdXBasR.js","../chunks/Chk7YAAL.js","../chunks/C4eyRFHZ.js","../chunks/Cgb6qxNH.js","../chunks/BGnN6MdV.js","../chunks/B4OkYPQ2.js","../chunks/QQC62dOK.js","../chunks/B4br06RT.js","../chunks/CKXeP6dW.js","../chunks/D_fWSKhY.js","../chunks/Cr2gjD2F.js","../chunks/DKpmsPfl.js","../chunks/CaVKkSa6.js","../chunks/R_lJGogL.js","../chunks/PPSfcZby.js","../chunks/B1N-tmtC.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/6wNmpEcd.js","../chunks/pDuGEAnG.js","../chunks/J24enNus.js","../chunks/BrScpkSj.js","../chunks/rxpTDz6e.js","../chunks/BHw5JDdy.js","../chunks/BmGeLk_f.js","../chunks/B7EkFjyr.js","../chunks/CL2NbQte.js","../chunks/DKwbefH7.js","../chunks/CPsX1bf4.js","../chunks/9RExefLh.js","../chunks/nat4CE_M.js","../chunks/C5CzMsLd.js","../chunks/CULglh8e.js","../chunks/BTTZ0VTX.js","../chunks/DD55kpYb.js","../chunks/C3oY3BHr.js","../chunks/BEUc1Bmk.js","../chunks/C0FWMiKh.js","../chunks/ZrNa8q0_.js","../chunks/BKEA3Vfw.js","../chunks/DyAp0_on.js","../chunks/DsOzJ4jT.js","../chunks/CLZMpgFW.js","../chunks/DZC6yFSo.js","../chunks/Dlbjp2d6.js","../chunks/GKolV7NZ.js","../chunks/D5gncVW_.js","../chunks/D9yVDWbb.js","../chunks/CRgZChtP.js","../chunks/Dpv_fpRz.js","../chunks/BGHczXK1.js","../chunks/14dRiZGb.js","../chunks/BMldGiHm.js","../chunks/DQBrlPPq.js","../chunks/X36CzGVP.js","../chunks/VMSlSy0z.js","../chunks/wOjtt7e4.js","../chunks/DEzrkiaJ.js","../chunks/DfcbkWHf.js","../chunks/Jn7bmDlP.js","../chunks/KQZAmGp9.js","../chunks/BxQMDF4n.js","../chunks/CgBdKxOH.js","../chunks/Cpc687il.js","../chunks/07VokW4w.js","../chunks/pyiiNWdA.js","../chunks/BsOy4qM9.js","../chunks/CMVj8qxv.js","../chunks/DNnNcX9A.js","../chunks/BWhNUEC9.js","../chunks/DISj-eu1.js","../chunks/D9LEW47t.js","../chunks/CW_merpE.js","../chunks/BENQTHVy.js","../chunks/CqtPF0BE.js","../chunks/CIjT6vRq.js","../chunks/Bbqze1Kn.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/D2xXIs6O.js","../chunks/CbPyuy4o.js","../chunks/WzJ1VaXW.js","../chunks/Bt0B6M-t.js","../chunks/DVWnwiyz.js","../chunks/eOHKmrdd.js","../chunks/BgtvC5K-.js","../chunks/BqMYqny5.js","../chunks/DCdj6Lab.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/R8o6PLv0.js","../chunks/e9q1h14t.js","../chunks/C_SFiQEJ.js","../chunks/DJ5nv-nr.js","../chunks/s7cnuzLu.js","../chunks/DKGgSbGf.js","../chunks/CXaNcm5K.js","../chunks/BMyIyxfC.js","../chunks/BY1MgphT.js","../chunks/gV41CGm5.js","../chunks/BHOVScRB.js","../chunks/DvAKq-6b.js","../chunks/CwP8ieYU.js","../chunks/DrWCKL0n.js","../chunks/D49mDWe8.js","../chunks/Dt52Z_LT.js","../chunks/DsHDw-MJ.js"])))=>i.map(i=>d[i]);
import{_ as Bn}from"../chunks/PPVm8Dsz.js";import"../chunks/DsnmJJEf.js";import{o as xn,a as _a}from"../chunks/Dpk6zK5u.js";import{B as co,E as uo,b6 as fo,b7 as ho,K as vo,o as po,b8 as go,b9 as mo,ba as yo,X as Sa,ao as bo,M as wo,n as $e,aw as fe,v as l,ad as K,p as Me,f as G,a as Le,c as X,r as Y,au as ne,ai as He,u as Ue,A as ht,a6 as he,z as hn,b5 as xa}from"../chunks/f0BBZyOI.js";import{p as _o,c as ae,a as F,f as oe,t as In}from"../chunks/BM4_XJhx.js";import{p as Ne,i as ge,r as Mt,s as Ct,l as On}from"../chunks/Cj7hX0t2.js";import{c as Ee}from"../chunks/jXcRiUVt.js";import{b as Rt}from"../chunks/DcnPTRxH.js";import{b as So,s as Tt}from"../chunks/BWXJCPQd.js";import{a as Or,e as kn,s as yi,d as rn,b as xo}from"../chunks/C_fd3B0-.js";import{d as Pr,c as Tr,S as Ia,I as Pn,n as Tn,s as ui,X as Io,e as ko,f as Co,g as Ao,h as Oo,i as Po,j as To,C as Eo,k as Fo}from"../chunks/CdSlpRwA.js";import{t as Un,k as Do,l as No,m as Mo,n as Lo,L as Ro,o as Vo,S as Nt,h as jo,i as Ho,C as Zi,j as zo,I as Ko,G as ea,F as ta,b as Bo,O as ka,a as qo,d as Ca,c as br,p as Uo,r as Go,M as Wo,V as na,f as $o,e as Yo,g as Jo,s as Qo,q as Xo}from"../chunks/Cy9Bob6h.js";import{s as Ye,a as Bt,i as Cn,I as En}from"../chunks/BNtVXYEz.js";import{g as Zo,d as Er}from"../chunks/BAUKkyyj.js";import{c as $n,B as Pt}from"../chunks/BkXo2ls6.js";import{C as es,D as ts,l as ns,o as rs,z as is,b as wr,B as as,$ as os,a0 as ss,p as xt,c as ls}from"../chunks/zORyCPaX.js";import{I as cs,C as us}from"../chunks/D1GpqJrF.js";import"../chunks/BtaRTE7z.js";import{b as ds}from"../chunks/7oH44jmG.js";import"../chunks/69_IOA4Y.js";import{j as fs}from"../chunks/BHw5JDdy.js";import hs from"../chunks/ByOEwiGd.js";import{s as ra}from"../chunks/waHvktcX.js";import{O as vs}from"../chunks/PYsgr6Cv.js";import{h as Gn}from"../chunks/CHbhs-ip.js";import{h as ia}from"../chunks/D6P5UyiM.js";import"../chunks/CfJ-zj_4.js";import{l as ps}from"../chunks/DMvchwLT.js";import aa from"../chunks/nat4CE_M.js";import"../chunks/20z1kPdE.js";import"../chunks/hffy0Rzx.js";import"../chunks/D6KPPgz5.js";import"../chunks/DISj-eu1.js";import"../chunks/D9LEW47t.js";import"../chunks/BEUc1Bmk.js";import"../chunks/hi8cSNjq.js";import"../chunks/DjQ20mEr.js";import"../chunks/ZrNa8q0_.js";import{j as oa}from"../chunks/Bbqze1Kn.js";import{m as sa}from"../chunks/C0FWMiKh.js";import{a as la,m as ca}from"../chunks/BLN0A8dL.js";import{l as _r}from"../chunks/DLsg3iLa.js";import{C as gs}from"../chunks/ghTEn3F8.js";const ms=()=>performance.now(),$t={tick:w=>requestAnimationFrame(w),now:()=>ms(),tasks:new Set};function Aa(){const w=$t.now();$t.tasks.forEach(t=>{t.c(w)||($t.tasks.delete(t),t.f())}),$t.tasks.size!==0&&$t.tick(Aa)}function ys(w){let t;return $t.tasks.size===0&&$t.tick(Aa),{promise:new Promise(a=>{$t.tasks.add(t={c:w,f:a})}),abort(){$t.tasks.delete(t)}}}function Sr(w,t){Sa(()=>{w.dispatchEvent(new CustomEvent(t))})}function bs(w){if(w==="float")return"cssFloat";if(w==="offset")return"cssOffset";if(w.startsWith("--"))return w;const t=w.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function ua(w){const t={},a=w.split(";");for(const s of a){const[u,h]=s.split(":");if(!u||h===void 0)break;const f=bs(u.trim());t[f]=h.trim()}return t}const ws=w=>w;function Cr(w,t,a,s){var u=(w&mo)!==0,h=(w&yo)!==0,f=u&&h,m=(w&go)!==0,P=f?"both":u?"in":"out",x,A=t.inert,N=t.style.overflow,E,q;function R(){return Sa(()=>x??=a()(t,s?.()??{},{direction:P}))}var M={is_global:m,in(){if(t.inert=A,!u){q?.abort(),q?.reset?.();return}h||E?.abort(),Sr(t,"introstart"),E=di(t,R(),q,1,()=>{Sr(t,"introend"),E?.abort(),E=x=void 0,t.style.overflow=N})},out(j){if(!h){j?.(),x=void 0;return}t.inert=!0,Sr(t,"outrostart"),q=di(t,R(),E,0,()=>{Sr(t,"outroend"),j?.()})},stop:()=>{E?.abort(),q?.abort()}},H=co;if((H.transitions??=[]).push(M),u&&So){var L=m;if(!L){for(var z=H.parent;z&&(z.f&uo)!==0;)for(;(z=z.parent)&&(z.f&fo)===0;);L=!z||(z.f&ho)!==0}L&&vo(()=>{po(()=>M.in())})}}function di(w,t,a,s,u){var h=s===1;if(bo(t)){var f,m=!1;return wo(()=>{if(!m){var H=t({direction:h?"in":"out"});f=di(w,H,a,s,u)}}),{abort:()=>{m=!0,f?.abort()},deactivate:()=>f.deactivate(),reset:()=>f.reset(),t:()=>f.t()}}if(a?.deactivate(),!t?.duration)return u(),{abort:$e,deactivate:$e,reset:$e,t:()=>s};const{delay:P=0,css:x,tick:A,easing:N=ws}=t;var E=[];if(h&&a===void 0&&(A&&A(0,1),x)){var q=ua(x(0,1));E.push(q,q)}var R=()=>1-s,M=w.animate(E,{duration:P,fill:"forwards"});return M.onfinish=()=>{M.cancel();var H=a?.t()??1-s;a?.abort();var L=s-H,z=t.duration*Math.abs(L),j=[];if(z>0){var W=!1;if(x)for(var le=Math.ceil(z/16.666666666666668),re=0;re<=le;re+=1){var se=H+L*N(re/le),me=ua(x(se,1-se));j.push(me),W||=me.overflow==="hidden"}W&&(w.style.overflow="hidden"),R=()=>{var Ae=M.currentTime;return H+L*N(Ae/z)},A&&ys(()=>{if(M.playState!=="running")return!1;var Ae=R();return A(Ae,1-Ae),!0})}M=w.animate(j,{duration:z,fill:"forwards"}),M.onfinish=()=>{R=()=>s,A?.(s,1-s),u()}},{abort:()=>{M&&(M.cancel(),M.effect=null,M.onfinish=$e)},deactivate:()=>{u=$e},reset:()=>{s===0&&A?.(1,0)},t:()=>R()}}const _s=rs({component:"avatar",parts:["root","image","fallback"]}),Ss=new es("Avatar.Root");class bi{static create(t){return Ss.set(new bi(t))}opts;domContext;attachment;constructor(t){this.opts=t,this.domContext=new ts(this.opts.ref),this.loadImage=this.loadImage.bind(this),this.attachment=ns(this.opts.ref)}loadImage(t,a,s){if(this.opts.loadingStatus.current==="loaded")return;let u;const h=new Image;return h.src=t,a!==void 0&&(h.crossOrigin=a),s&&(h.referrerPolicy=s),this.opts.loadingStatus.current="loading",h.onload=()=>{u=this.domContext.setTimeout(()=>{this.opts.loadingStatus.current="loaded"},this.opts.delayMs.current)},h.onerror=()=>{this.opts.loadingStatus.current="error"},()=>{u&&this.domContext.clearTimeout(u)}}#e=fe(()=>({id:this.opts.id.current,[_s.root]:"","data-status":this.opts.loadingStatus.current,...this.attachment}));get props(){return l(this.#e)}set props(t){K(this.#e,t)}}var xs=oe("<div><!></div>");function Is(w,t){const a=_o();Me(t,!0);let s=Ne(t,"delayMs",3,0),u=Ne(t,"loadingStatus",15,"loading"),h=Ne(t,"id",19,()=>is(a)),f=Ne(t,"ref",15,null),m=Mt(t,["$$slots","$$events","$$legacy","delayMs","loadingStatus","onLoadingStatusChange","child","children","id","ref"]);const P=bi.create({delayMs:wr(()=>s()),loadingStatus:wr(()=>u(),R=>{u()!==R&&(u(R),t.onLoadingStatusChange?.(R))}),id:wr(()=>h()),ref:wr(()=>f(),R=>f(R))}),x=fe(()=>as(m,P.props));var A=ae(),N=G(A);{var E=R=>{var M=ae(),H=G(M);Ye(H,()=>t.child,()=>({props:l(x)})),F(R,M)},q=R=>{var M=xs();Or(M,()=>({...l(x)}));var H=X(M);Ye(H,()=>t.children??$e),Y(M),F(R,M)};ge(N,R=>{t.child?R(E):R(q,!1)})}F(w,A),Le()}var ks=oe('<p class="text-sm font-medium"> </p>'),Cs=oe('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function As(w,t){Me(t,!0);let a=ne(null),s=ne(He({x:0,y:0})),u=0;const h=x=>{K(s,{x:x.clientX,y:x.clientY},!0)};Ue(()=>(document.addEventListener("mousemove",h),()=>{document.removeEventListener("mousemove",h)})),Ue(()=>{const x=t.areaSelectionInteractionStore.currentHoveredArea?.id,A=++u;if(!x){K(a,null);return}(async()=>{const N=await t.areaSelectionInteractionStore.getAreaNamesById([x]);A===u&&t.areaSelectionInteractionStore.currentHoveredArea?.id===x&&K(a,N[0]??null,!0)})()});var f=ae(),m=G(f);{var P=x=>{var A=Cs(),N=X(A);Ee(N,()=>Tr,(E,q)=>{q(E,{class:"max-w-xs border !py-2 shadow-lg",children:(R,M)=>{var H=ae(),L=G(H);Ee(L,()=>Pr,(z,j)=>{j(z,{class:"!px-3 !py-0",children:(W,le)=>{var re=ks(),se=X(re,!0);Y(re),ht(()=>Tt(se,l(a))),F(W,re)},$$slots:{default:!0}})}),F(R,H)},$$slots:{default:!0}})}),Y(A),ht(()=>kn(A,`left: ${l(s).x+10}px; top: ${l(s).y-10}px;`)),F(x,A)};ge(m,x=>{l(a)&&x(P)})}F(w,f),Le()}function Os(w,t){Me(t,!0);async function a(s,u){const h=await t.areaSelectionInteractionStore.getAreaNamesById([s]);if(!h||h.length===0||!h[0])return;const f=`Area ${u}: ${h[0]}`;Un.success(f)}Ue(()=>{t.areaSelectionInteractionStore.lastAddedArea&&a(t.areaSelectionInteractionStore.lastAddedArea.id,"added")}),Ue(()=>{t.areaSelectionInteractionStore.lastRemovedArea&&a(t.areaSelectionInteractionStore.lastRemovedArea.id,"removed")}),Le()}var Ps=oe("<div><!></div>");function da(w,t){Me(t,!0);let a=Ne(t,"ref",15,null),s=Mt(t,["$$slots","$$events","$$legacy","ref","variant","children"]);var u=Ps();Or(u,()=>({...s,class:"group/chat-bubble flex max-w-[80%] flex-row place-items-end gap-2 data-[variant='sent']:place-self-end","data-variant":t.variant}));var h=X(u);Ye(h,()=>t.children??$e),Y(u),Rt(u,f=>a(f),()=>a()),F(w,u),Le()}var Ts=oe('<span class="inline-block size-(--loading-dots-size) rounded-full bg-primary svelte-k2x6sv"></span>'),Es=oe('<div class="inline-flex items-center gap-1 svelte-k2x6sv"></div>');function Fs(w,t){let a=Ne(t,"size",3,4);var s=Es();let u;Bt(s,20,()=>({length:3}),Cn,(h,f)=>{var m=Ts();F(h,m)}),Y(s),ht(h=>u=kn(s,"",u,h),[()=>({"--loading-dots-size":`${a()??""}px`})]),F(w,s)}var Ds=oe('<div class="flex size-full place-items-center justify-center"><!></div>'),Ns=oe("<div><!></div>");function ci(w,t){Me(t,!0);let a=Ne(t,"ref",15,null),s=Ne(t,"typing",3,!1),u=Mt(t,["$$slots","$$events","$$legacy","ref","typing","class","children"]);var h=Ns();Or(h,x=>({...u,class:x}),[()=>$n("order-2 rounded-lg bg-secondary p-4 text-sm group-data-[variant='received']/chat-bubble:rounded-bl-none group-data-[variant='sent']/chat-bubble:order-1 group-data-[variant='sent']/chat-bubble:rounded-br-none group-data-[variant='sent']/chat-bubble:bg-primary group-data-[variant='sent']/chat-bubble:text-primary-foreground",t.class)]);var f=X(h);{var m=x=>{var A=Ds(),N=X(A);Fs(N,{}),Y(A),F(x,A)},P=x=>{var A=ae(),N=G(A);Ye(N,()=>t.children??$e),F(x,A)};ge(f,x=>{s()?x(m):x(P,!1)})}Y(h),Rt(h,x=>a(x),()=>a()),F(w,h),Le()}function Ms(w,t){Me(t,!0);let a=Ne(t,"ref",15,null),s=Mt(t,["$$slots","$$events","$$legacy","ref","class"]);var u=ae(),h=G(u);{let f=fe(()=>$n("relative flex size-8 shrink-0 overflow-hidden rounded-full",t.class));Ee(h,()=>Is,(m,P)=>{P(m,Ct({"data-slot":"avatar",get class(){return l(f)}},()=>s,{get ref(){return a()},set ref(x){a(x)}}))})}F(w,u),Le()}function fa(w,t){Me(t,!0);let a=Ne(t,"ref",15,null),s=Mt(t,["$$slots","$$events","$$legacy","ref","class"]);{let u=fe(()=>$n("order-1 group-data-[variant='sent']/chat-bubble:order-2",t.class));Ms(w,Ct({get class(){return l(u)}},()=>s,{get ref(){return a()},set ref(h){a(h)}}))}Le()}function Ls(w,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];En(w,Ct({name:"arrow-down"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Ye(m,()=>t.children??$e),F(u,f)},$$slots:{default:!0}})),Le()}function Oa(w){const t=w-1;return t*t*t+1}function ha(w,{delay:t=0,duration:a=400,easing:s=Oa,axis:u="y"}={}){const h=getComputedStyle(w),f=+h.opacity,m=u==="y"?"height":"width",P=parseFloat(h[m]),x=u==="y"?["top","bottom"]:["left","right"],A=x.map(L=>`${L[0].toUpperCase()}${L.slice(1)}`),N=parseFloat(h[`padding${A[0]}`]),E=parseFloat(h[`padding${A[1]}`]),q=parseFloat(h[`margin${A[0]}`]),R=parseFloat(h[`margin${A[1]}`]),M=parseFloat(h[`border${A[0]}Width`]),H=parseFloat(h[`border${A[1]}Width`]);return{delay:t,duration:a,easing:s,css:L=>`overflow: hidden;opacity: ${Math.min(L*20,1)*f};${m}: ${L*P}px;padding-${x[0]}: ${L*N}px;padding-${x[1]}: ${L*E}px;margin-${x[0]}: ${L*q}px;margin-${x[1]}: ${L*R}px;border-${x[0]}-width: ${L*M}px;border-${x[1]}-width: ${L*H}px;min-${m}: 0`}}function va(w,{delay:t=0,duration:a=400,easing:s=Oa,start:u=0,opacity:h=0}={}){const f=getComputedStyle(w),m=+f.opacity,P=f.transform==="none"?"":f.transform,x=1-u,A=m*(1-h);return{delay:t,duration:a,easing:s,css:(N,E)=>`
			transform: ${P} scale(${1-x*E});
			opacity: ${m-A*E}
		`}}class Rs{#e=ne();#t=ne(0);#n=ne(!1);lastScrollHeight=0;set ref(t){if(K(this.#e,t,!0),!l(this.#e))return;this.lastScrollHeight=l(this.#e).scrollHeight,l(this.#e).scrollTo(0,l(this.#t)?l(this.#t):l(this.#e).scrollHeight),l(this.#e).addEventListener("scroll",()=>{l(this.#e)&&(K(this.#t,l(this.#e).scrollTop,!0),this.disableAutoScroll())}),window.addEventListener("resize",()=>{this.scrollToBottom(!0)}),new MutationObserver(()=>{l(this.#e)&&(l(this.#e).scrollHeight!==this.lastScrollHeight&&this.scrollToBottom(!0),this.lastScrollHeight=l(this.#e).scrollHeight)}).observe(l(this.#e),{childList:!0,subtree:!0})}get ref(){return l(this.#e)}get scrollY(){return l(this.#t)}get isAtBottom(){return l(this.#e)?l(this.#t)+l(this.#e).offsetHeight>=l(this.#e).scrollHeight:!0}disableAutoScroll(){this.isAtBottom?K(this.#n,!1):K(this.#n,!0)}scrollToBottom(t=!1){l(this.#e)&&(t&&l(this.#n)||l(this.#e).scrollTo(0,l(this.#e).scrollHeight))}}var Vs=oe("<div><!></div>"),js=oe('<div class="relative"><div><!></div> <!></div>');function Hs(w,t){Me(t,!0);let a=Ne(t,"ref",15,null),s=Mt(t,["$$slots","$$events","$$legacy","ref","children","class"]),u=ne(!1);const h=new Rs;xn(()=>{K(u,!0)});var f=js(),m=X(f);Or(m,N=>({...s,class:N}),[()=>$n("no-scrollbar flex h-full w-full flex-col gap-4 overflow-y-auto p-4",t.class,{"scroll-smooth":l(u)})]);var P=X(m);Ye(P,()=>t.children??$e),Y(m),Rt(m,N=>a(N),()=>a()),Rt(m,N=>h.ref=N,()=>h?.ref);var x=he(m,2);{var A=N=>{var E=Vs(),q=X(E);Pt(q,{onclick:()=>h.scrollToBottom(),variant:"outline",size:"icon",class:"absolute bottom-2 left-1/2 inline-flex -translate-x-1/2 transform rounded-full shadow-md",children:(R,M)=>{Ls(R,{})},$$slots:{default:!0}}),Y(E),Cr(1,E,()=>va,()=>({start:.85,duration:100,delay:250})),Cr(2,E,()=>va,()=>({start:.85,duration:100})),F(N,E)};ge(x,N=>{h.isAtBottom||N(A)})}Y(f),F(w,f),Le()}function zs(w,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];En(w,Ct({name:"send"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Ye(m,()=>t.children??$e),F(u,f)},$$slots:{default:!0}})),Le()}var Ks=oe(`<p class="break-words whitespace-pre-wrap"> </p> <div class="w-full text-xs group-data-[variant='sent']/chat-bubble:text-end"> </div>`,1),Bs=oe("<!> <!>",1),qs=oe('<p class="break-words whitespace-pre-wrap"> </p>'),Us=oe("<!> <!>",1),Gs=oe("<!> <!>",1),Ws=oe('<div class="chat-container h-full w-full border border-border svelte-1osgd7m"><div class="message-wrapper svelte-1osgd7m"><!></div> <div class="input-wrapper svelte-1osgd7m"><form class="flex shrink-0 items-center gap-2 border-t border-border bg-background p-2"><!> <!></form></div></div>');function $s(w,t){Me(t,!0);const a=1,s=2,u="Sorry, I encountered an error processing your request.",h="How can I help?";let f=ne(""),m=ne(!1),P=ne(""),x=ne(null),A=ne(null),N=ne(null);const E=He([{senderId:a,message:h,sentAt:q(new Date)}]);Ue(()=>{if(l(A)&&l(N)){const ue=l(A),we=l(N),Ie=()=>{const Fe=ue.offsetHeight;we.style.paddingBottom=`${Fe}px`};Ie();const _e=new ResizeObserver(Ie);return _e.observe(ue),()=>{_e.disconnect()}}}),Ue(()=>{E.length,l(P),l(x)&&setTimeout(()=>{const ue=l(x)?.querySelector('[data-slot="scroll-area-viewport"]');ue&&(ue.scrollTop=ue.scrollHeight)},0)});function q(ue){const we=ue.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Ie=ue.getHours()>=12?"PM":"AM";return`${we} ${Ie}`}function R(ue,we){return{message:ue,senderId:we,sentAt:q(new Date)}}function M(ue,we){E.push(R(ue,we))}function H(){K(m,!1),K(P,"")}function L(ue){K(P,l(P)+ue)}async function z(ue){if(ue.preventDefault(),!l(f).trim()||l(m))return;const we=l(f).trim();K(f,""),M(we,s),K(m,!0),K(P,"");try{await t.aiUprnChatbotService.chatStream(we,L)&&l(P)?M(l(P),a):M(u,a)}catch(Ie){console.error("Chat error:",Ie),M(u,a)}finally{H()}}var j=Ws(),W=X(j),le=X(W);Ia(le,{class:"h-full w-full",get ref(){return l(x)},set ref(ue){K(x,ue,!0)},children:(ue,we)=>{var Ie=ae(),_e=G(Ie);Ee(_e,()=>Hs,(Fe,ze)=>{ze(Fe,{children:(Je,ke)=>{var Re=Gs(),be=G(Re);Bt(be,16,()=>E,st=>st,(st,pe)=>{var Be=ae(),de=G(Be);{let ve=fe(()=>pe.senderId===s?"sent":"received");Ee(de,()=>da,(Te,lt)=>{lt(Te,{get variant(){return l(ve)},children:(ee,vt)=>{var Ge=Bs(),ye=G(Ge);Ee(ye,()=>fa,(pt,je)=>{je(pt,{})});var qe=he(ye,2);Ee(qe,()=>ci,(pt,je)=>{je(pt,{class:"flex flex-col gap-1",children:(ct,rt)=>{var Qe=Ks(),Xe=G(Qe),Ze=X(Xe,!0);Y(Xe);var et=he(Xe,2),At=X(et,!0);Y(et),ht(()=>{Tt(Ze,pe.message),Tt(At,pe.sentAt)}),F(ct,Qe)},$$slots:{default:!0}})}),F(ee,Ge)},$$slots:{default:!0}})})}F(st,Be)});var Pe=he(be,2);{var ot=st=>{var pe=ae(),Be=G(pe);Ee(Be,()=>da,(de,ve)=>{ve(de,{variant:"received",children:(Te,lt)=>{var ee=Us(),vt=G(ee);Ee(vt,()=>fa,(ye,qe)=>{qe(ye,{})});var Ge=he(vt,2);Ee(Ge,()=>ci,(ye,qe)=>{qe(ye,{class:"flex flex-col gap-1",children:(pt,je)=>{var ct=ae(),rt=G(ct);{var Qe=Ze=>{var et=qs(),At=X(et,!0);Y(et),ht(()=>Tt(At,l(P))),F(Ze,et)},Xe=Ze=>{var et=ae(),At=G(et);Ee(At,()=>ci,(Vt,Ot)=>{Ot(Vt,{typing:!0})}),F(Ze,et)};ge(rt,Ze=>{l(P)?Ze(Qe):Ze(Xe,!1)})}F(pt,ct)},$$slots:{default:!0}})}),F(Te,ee)},$$slots:{default:!0}})}),F(st,pe)};ge(Pe,st=>{l(m)&&st(ot)})}F(Je,Re)},$$slots:{default:!0}})}),F(ue,Ie)},$$slots:{default:!0}}),Y(W),Rt(W,ue=>K(N,ue),()=>l(N));var re=he(W,2),se=X(re),me=X(se);cs(me,{class:"rounded-full",placeholder:"Type a message...",get disabled(){return l(m)},get value(){return l(f)},set value(ue){K(f,ue,!0)}});var Ae=he(me,2);{let ue=fe(()=>l(f).trim()===""||l(m));Pt(Ae,{type:"submit",variant:"default",size:"icon",class:"shrink-0 rounded-full",get disabled(){return l(ue)},children:(we,Ie)=>{zs(we,{})},$$slots:{default:!0}})}Y(se),Rt(se,ue=>K(A,ue),()=>l(A)),Y(re),Y(j),Zo("submit",se,z),F(w,j),Le()}const tn=Object.freeze({Pending:"pending",InProgress:"in-progress",Completed:"completed",Failed:"failed"}),xr=Object.freeze({Submitted:"SUBMITTED",Queued:"QUEUED",Processing:"IN_PROGRESS",Completed:"COMPLETED",Error:"ERROR"}),Ys=Object.freeze({Success:"success",Error:"error"});var kr={exports:{}},Js=kr.exports,pa;function Qs(){return pa||(pa=1,(function(w,t){(function(a,s){w.exports=s()})(Js,function(){var a=function(e,n){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(e,n)},s=function(){return(s=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function u(e,n,r){for(var i,o=0,c=n.length;o<c;o++)!i&&o in n||((i=i||Array.prototype.slice.call(n,0,o))[o]=n[o]);return e.concat(i||Array.prototype.slice.call(n))}var h=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:os,f=Object.keys,m=Array.isArray;function P(e,n){return typeof n!="object"||f(n).forEach(function(r){e[r]=n[r]}),e}typeof Promise>"u"||h.Promise||(h.Promise=Promise);var x=Object.getPrototypeOf,A={}.hasOwnProperty;function N(e,n){return A.call(e,n)}function E(e,n){typeof n=="function"&&(n=n(x(e))),(typeof Reflect>"u"?f:Reflect.ownKeys)(n).forEach(function(r){R(e,r,n[r])})}var q=Object.defineProperty;function R(e,n,r,i){q(e,n,P(r&&N(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},i))}function M(e){return{from:function(n){return e.prototype=Object.create(n.prototype),R(e.prototype,"constructor",e),{extend:E.bind(null,e.prototype)}}}}var H=Object.getOwnPropertyDescriptor,L=[].slice;function z(e,n,r){return L.call(e,n,r)}function j(e,n){return n(e)}function W(e){if(!e)throw new Error("Assertion Failed")}function le(e){h.setImmediate?setImmediate(e):setTimeout(e,0)}function re(e,n){if(typeof n=="string"&&N(e,n))return e[n];if(!n)return e;if(typeof n!="string"){for(var r=[],i=0,o=n.length;i<o;++i){var c=re(e,n[i]);r.push(c)}return r}var d=n.indexOf(".");if(d!==-1){var v=e[n.substr(0,d)];return v==null?void 0:re(v,n.substr(d+1))}}function se(e,n,r){if(e&&n!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof n!="string"&&"length"in n){W(typeof r!="string"&&"length"in r);for(var i=0,o=n.length;i<o;++i)se(e,n[i],r[i])}else{var c,d,v=n.indexOf(".");v!==-1?(c=n.substr(0,v),(d=n.substr(v+1))===""?r===void 0?m(e)&&!isNaN(parseInt(c))?e.splice(c,1):delete e[c]:e[c]=r:se(v=!(v=e[c])||!N(e,c)?e[c]={}:v,d,r)):r===void 0?m(e)&&!isNaN(parseInt(n))?e.splice(n,1):delete e[n]:e[n]=r}}function me(e){var n,r={};for(n in e)N(e,n)&&(r[n]=e[n]);return r}var Ae=[].concat;function ue(e){return Ae.apply([],e)}var it="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ue([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(n){return n+e+"Array"})}))).filter(function(e){return h[e]}),we=new Set(it.map(function(e){return h[e]})),Ie=null;function _e(e){return Ie=new WeakMap,e=(function n(r){if(!r||typeof r!="object")return r;var i=Ie.get(r);if(i)return i;if(m(r)){i=[],Ie.set(r,i);for(var o=0,c=r.length;o<c;++o)i.push(n(r[o]))}else if(we.has(r.constructor))i=r;else{var d,v=x(r);for(d in i=v===Object.prototype?{}:Object.create(v),Ie.set(r,i),r)N(r,d)&&(i[d]=n(r[d]))}return i})(e),Ie=null,e}var Fe={}.toString;function ze(e){return Fe.call(e).slice(8,-1)}var Je=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ke=typeof Je=="symbol"?function(e){var n;return e!=null&&(n=e[Je])&&n.apply(e)}:function(){return null};function Re(e,n){return n=e.indexOf(n),0<=n&&e.splice(n,1),0<=n}var be={};function Pe(e){var n,r,i,o;if(arguments.length===1){if(m(e))return e.slice();if(this===be&&typeof e=="string")return[e];if(o=ke(e)){for(r=[];!(i=o.next()).done;)r.push(i.value);return r}if(e==null)return[e];if(typeof(n=e.length)!="number")return[e];for(r=new Array(n);n--;)r[n]=e[n];return r}for(n=arguments.length,r=new Array(n);n--;)r[n]=arguments[n];return r}var ot=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},jt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Lt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(jt),st={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function pe(e,n){this.name=e,this.message=n}function Be(e,n){return e+". Errors: "+Object.keys(n).map(function(r){return n[r].toString()}).filter(function(r,i,o){return o.indexOf(r)===i}).join(`
`)}function de(e,n,r,i){this.failures=n,this.failedKeys=i,this.successCount=r,this.message=Be(e,n)}function ve(e,n){this.name="BulkError",this.failures=Object.keys(n).map(function(r){return n[r]}),this.failuresByPos=n,this.message=Be(e,this.failures)}M(pe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),M(de).from(pe),M(ve).from(pe);var Te=Lt.reduce(function(e,n){return e[n]=n+"Error",e},{}),lt=pe,ee=Lt.reduce(function(e,n){var r=n+"Error";function i(o,c){this.name=r,o?typeof o=="string"?(this.message="".concat(o).concat(c?`
 `+c:""),this.inner=c||null):typeof o=="object"&&(this.message="".concat(o.name," ").concat(o.message),this.inner=o):(this.message=st[n]||r,this.inner=null)}return M(i).from(lt),e[n]=i,e},{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var vt=jt.reduce(function(e,n){return e[n+"Error"]=ee[n],e},{}),Ge=Lt.reduce(function(e,n){return["Syntax","Type","Range"].indexOf(n)===-1&&(e[n+"Error"]=ee[n]),e},{});function ye(){}function qe(e){return e}function pt(e,n){return e==null||e===qe?n:function(r){return n(e(r))}}function je(e,n){return function(){e.apply(this,arguments),n.apply(this,arguments)}}function ct(e,n){return e===ye?n:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var c=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?je(i,this.onsuccess):i),o&&(this.onerror=this.onerror?je(o,this.onerror):o),c!==void 0?c:r}}function rt(e,n){return e===ye?n:function(){e.apply(this,arguments);var r=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?je(r,this.onsuccess):r),i&&(this.onerror=this.onerror?je(i,this.onerror):i)}}function Qe(e,n){return e===ye?n:function(r){var i=e.apply(this,arguments);P(r,i);var o=this.onsuccess,c=this.onerror;return this.onsuccess=null,this.onerror=null,r=n.apply(this,arguments),o&&(this.onsuccess=this.onsuccess?je(o,this.onsuccess):o),c&&(this.onerror=this.onerror?je(c,this.onerror):c),i===void 0?r===void 0?void 0:r:P(i,r)}}function Xe(e,n){return e===ye?n:function(){return n.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Ze(e,n){return e===ye?n:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var i=this,o=arguments.length,c=new Array(o);o--;)c[o]=arguments[o];return r.then(function(){return n.apply(i,c)})}return n.apply(this,arguments)}}Ge.ModifyError=de,Ge.DexieError=pe,Ge.BulkError=ve;var et=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function At(e){et=e}var Vt={},Ot=100,it=typeof Promise>"u"?[]:(function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,x(e),e];var n=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[n,x(n),e]})(),jt=it[0],Lt=it[1],it=it[2],Lt=Lt&&Lt.then,gt=jt&&jt.constructor,It=!!it,ut=function(e,n){Fn.push([e,n]),Ht&&(queueMicrotask(ja),Ht=!1)},mt=!0,Ht=!0,qt=[],vn=[],Ut=qe,Et={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ye,pgp:!1,env:{},finalize:ye},ce=Et,Fn=[],on=0,Yn=[];function te(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var n=this._PSD=ce;if(typeof e!="function"){if(e!==Vt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Dr(this,this._value))}this._state=null,this._value=null,++n.ref,(function r(i,o){try{o(function(c){if(i._state===null){if(c===i)throw new TypeError("A promise cannot be resolved with itself.");var d=i._lib&&pn();c&&typeof c.then=="function"?r(i,function(v,g){c instanceof te?c._then(v,g):c.then(v,g)}):(i._state=!0,i._value=c,_i(i)),d&&gn()}},Dr.bind(null,i))}catch(c){Dr(i,c)}})(this,e)}var Fr={get:function(){var e=ce,n=Zn;function r(i,o){var c=this,d=!e.global&&(e!==ce||n!==Zn),v=d&&!Jt(),g=new te(function(y,I){Nr(c,new wi(xi(i,e,d,v),xi(o,e,d,v),y,I,e))});return this._consoleTask&&(g._consoleTask=this._consoleTask),g}return r.prototype=Vt,r},set:function(e){R(this,"then",e&&e.prototype===Vt?Fr:{get:function(){return e},set:Fr.set})}};function wi(e,n,r,i,o){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof n=="function"?n:null,this.resolve=r,this.reject=i,this.psd=o}function Dr(e,n){var r,i;vn.push(n),e._state===null&&(r=e._lib&&pn(),n=Ut(n),e._state=!1,e._value=n,i=e,qt.some(function(o){return o._value===i._value})||qt.push(i),_i(e),r&&gn())}function _i(e){var n=e._listeners;e._listeners=[];for(var r=0,i=n.length;r<i;++r)Nr(e,n[r]);var o=e._PSD;--o.ref||o.finalize(),on===0&&(++on,ut(function(){--on==0&&Mr()},[]))}function Nr(e,n){if(e._state!==null){var r=e._state?n.onFulfilled:n.onRejected;if(r===null)return(e._state?n.resolve:n.reject)(e._value);++n.psd.ref,++on,ut(Va,[r,e,n])}else e._listeners.push(n)}function Va(e,n,r){try{var i,o=n._value;!n._state&&vn.length&&(vn=[]),i=et&&n._consoleTask?n._consoleTask.run(function(){return e(o)}):e(o),n._state||vn.indexOf(o)!==-1||(function(c){for(var d=qt.length;d;)if(qt[--d]._value===c._value)return qt.splice(d,1)})(n),r.resolve(i)}catch(c){r.reject(c)}finally{--on==0&&Mr(),--r.psd.ref||r.psd.finalize()}}function ja(){sn(Et,function(){pn()&&gn()})}function pn(){var e=mt;return Ht=mt=!1,e}function gn(){var e,n,r;do for(;0<Fn.length;)for(e=Fn,Fn=[],r=e.length,n=0;n<r;++n){var i=e[n];i[0].apply(null,i[1])}while(0<Fn.length);Ht=mt=!0}function Mr(){var e=qt;qt=[],e.forEach(function(i){i._PSD.onunhandled.call(null,i._value,i)});for(var n=Yn.slice(0),r=n.length;r;)n[--r]()}function Jn(e){return new te(Vt,!1,e)}function tt(e,n){var r=ce;return function(){var i=pn(),o=ce;try{return Qt(r,!0),e.apply(this,arguments)}catch(c){n&&n(c)}finally{Qt(o,!1),i&&gn()}}}E(te.prototype,{then:Fr,_then:function(e,n){Nr(this,new wi(null,null,e,n,ce))},catch:function(e){if(arguments.length===1)return this.then(null,e);var n=e,r=arguments[1];return typeof n=="function"?this.then(null,function(i){return(i instanceof n?r:Jn)(i)}):this.then(null,function(i){return(i&&i.name===n?r:Jn)(i)})},finally:function(e){return this.then(function(n){return te.resolve(e()).then(function(){return n})},function(n){return te.resolve(e()).then(function(){return Jn(n)})})},timeout:function(e,n){var r=this;return e<1/0?new te(function(i,o){var c=setTimeout(function(){return o(new ee.Timeout(n))},e);r.then(i,o).finally(clearTimeout.bind(null,c))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&R(te.prototype,Symbol.toStringTag,"Dexie.Promise"),Et.env=Si(),E(te,{all:function(){var e=Pe.apply(null,arguments).map(er);return new te(function(n,r){e.length===0&&n([]);var i=e.length;e.forEach(function(o,c){return te.resolve(o).then(function(d){e[c]=d,--i||n(e)},r)})})},resolve:function(e){return e instanceof te?e:e&&typeof e.then=="function"?new te(function(n,r){e.then(n,r)}):new te(Vt,!0,e)},reject:Jn,race:function(){var e=Pe.apply(null,arguments).map(er);return new te(function(n,r){e.map(function(i){return te.resolve(i).then(n,r)})})},PSD:{get:function(){return ce},set:function(e){return ce=e}},totalEchoes:{get:function(){return Zn}},newPSD:Yt,usePSD:sn,scheduler:{get:function(){return ut},set:function(e){ut=e}},rejectionMapper:{get:function(){return Ut},set:function(e){Ut=e}},follow:function(e,n){return new te(function(r,i){return Yt(function(o,c){var d=ce;d.unhandleds=[],d.onunhandled=c,d.finalize=je(function(){var v,g=this;v=function(){g.unhandleds.length===0?o():c(g.unhandleds[0])},Yn.push(function y(){v(),Yn.splice(Yn.indexOf(y),1)}),++on,ut(function(){--on==0&&Mr()},[])},d.finalize),e()},n,r,i)})}}),gt&&(gt.allSettled&&R(te,"allSettled",function(){var e=Pe.apply(null,arguments).map(er);return new te(function(n){e.length===0&&n([]);var r=e.length,i=new Array(r);e.forEach(function(o,c){return te.resolve(o).then(function(d){return i[c]={status:"fulfilled",value:d}},function(d){return i[c]={status:"rejected",reason:d}}).then(function(){return--r||n(i)})})})}),gt.any&&typeof AggregateError<"u"&&R(te,"any",function(){var e=Pe.apply(null,arguments).map(er);return new te(function(n,r){e.length===0&&r(new AggregateError([]));var i=e.length,o=new Array(i);e.forEach(function(c,d){return te.resolve(c).then(function(v){return n(v)},function(v){o[d]=v,--i||r(new AggregateError(o))})})})}),gt.withResolvers&&(te.withResolvers=gt.withResolvers));var yt={awaits:0,echoes:0,id:0},Ha=0,Qn=[],Xn=0,Zn=0,za=0;function Yt(e,n,r,i){var o=ce,c=Object.create(o);return c.parent=o,c.ref=0,c.global=!1,c.id=++za,Et.env,c.env=It?{Promise:te,PromiseProp:{value:te,configurable:!0,writable:!0},all:te.all,race:te.race,allSettled:te.allSettled,any:te.any,resolve:te.resolve,reject:te.reject}:{},n&&P(c,n),++o.ref,c.finalize=function(){--this.parent.ref||this.parent.finalize()},i=sn(c,e,r,i),c.ref===0&&c.finalize(),i}function mn(){return yt.id||(yt.id=++Ha),++yt.awaits,yt.echoes+=Ot,yt.id}function Jt(){return!!yt.awaits&&(--yt.awaits==0&&(yt.id=0),yt.echoes=yt.awaits*Ot,!0)}function er(e){return yt.echoes&&e&&e.constructor===gt?(mn(),e.then(function(n){return Jt(),n},function(n){return Jt(),dt(n)})):e}function Ka(){var e=Qn[Qn.length-1];Qn.pop(),Qt(e,!1)}function Qt(e,n){var r,i=ce;(n?!yt.echoes||Xn++&&e===ce:!Xn||--Xn&&e===ce)||queueMicrotask(n?(function(o){++Zn,yt.echoes&&--yt.echoes!=0||(yt.echoes=yt.awaits=yt.id=0),Qn.push(ce),Qt(o,!0)}).bind(null,e):Ka),e!==ce&&(ce=e,i===Et&&(Et.env=Si()),It&&(r=Et.env.Promise,n=e.env,(i.global||e.global)&&(Object.defineProperty(h,"Promise",n.PromiseProp),r.all=n.all,r.race=n.race,r.resolve=n.resolve,r.reject=n.reject,n.allSettled&&(r.allSettled=n.allSettled),n.any&&(r.any=n.any))))}function Si(){var e=h.Promise;return It?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(h,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function sn(e,n,r,i,o){var c=ce;try{return Qt(e,!0),n(r,i,o)}finally{Qt(c,!1)}}function xi(e,n,r,i){return typeof e!="function"?e:function(){var o=ce;r&&mn(),Qt(n,!0);try{return e.apply(this,arguments)}finally{Qt(o,!1),i&&queueMicrotask(Jt)}}}function Lr(e){Promise===gt&&yt.echoes===0?Xn===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Lt).indexOf("[native code]")===-1&&(mn=Jt=ye);var dt=te.reject,ln="ï¿¿",Gt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ii="String expected.",yn=[],tr="__dbnames",Rr="readonly",Vr="readwrite";function cn(e,n){return e?n?function(){return e.apply(this,arguments)&&n.apply(this,arguments)}:e:n}var ki={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function nr(e){return typeof e!="string"||/\./.test(e)?function(n){return n}:function(n){return n[e]===void 0&&e in n&&delete(n=_e(n))[e],n}}function Ci(){throw ee.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function De(e,n){try{var r=Ai(e),i=Ai(n);if(r!==i)return r==="Array"?1:i==="Array"?-1:r==="binary"?1:i==="binary"?-1:r==="string"?1:i==="string"?-1:r==="Date"?1:i!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return n<e?1:e<n?-1:0;case"binary":return(function(o,c){for(var d=o.length,v=c.length,g=d<v?d:v,y=0;y<g;++y)if(o[y]!==c[y])return o[y]<c[y]?-1:1;return d===v?0:d<v?-1:1})(Oi(e),Oi(n));case"Array":return(function(o,c){for(var d=o.length,v=c.length,g=d<v?d:v,y=0;y<g;++y){var I=De(o[y],c[y]);if(I!==0)return I}return d===v?0:d<v?-1:1})(e,n)}}catch{}return NaN}function Ai(e){var n=typeof e;return n!="object"?n:ArrayBuffer.isView(e)?"binary":(e=ze(e),e==="ArrayBuffer"?"binary":e)}function Oi(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function rr(e,n,r){var i=e.schema.yProps;return i?(n&&0<r.numFailures&&(n=n.filter(function(o,c){return!r.failures[c]})),Promise.all(i.map(function(o){return o=o.updatesTable,n?e.db.table(o).where("k").anyOf(n).delete():e.db.table(o).clear()})).then(function(){return r})):r}var Dn=(Pi.prototype.execute=function(e){var n=this["@@propmod"];if(n.add!==void 0){var r=n.add;if(m(r))return u(u([],m(e)?e:[],!0),r).sort();if(typeof r=="number")return(Number(e)||0)+r;if(typeof r=="bigint")try{return BigInt(e)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(n.remove!==void 0){var i=n.remove;if(m(i))return m(e)?e.filter(function(o){return!i.includes(o)}).sort():[];if(typeof i=="number")return Number(e)-i;if(typeof i=="bigint")try{return BigInt(e)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}return r=(r=n.replacePrefix)===null||r===void 0?void 0:r[0],r&&typeof e=="string"&&e.startsWith(r)?n.replacePrefix[1]+e.substring(r.length):e},Pi);function Pi(e){this["@@propmod"]=e}function Ti(e,n){for(var r=f(n),i=r.length,o=!1,c=0;c<i;++c){var d=r[c],v=n[d],g=re(e,d);v instanceof Dn?(se(e,d,v.execute(g)),o=!0):g!==v&&(se(e,d,v),o=!0)}return o}var Ei=(We.prototype._trans=function(e,n,r){var i=this._tx||ce.trans,o=this.name,c=et&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function d(y,I,p){if(!p.schema[o])throw new ee.NotFound("Table "+o+" not part of transaction");return n(p.idbtrans,p)}var v=pn();try{var g=i&&i.db._novip===this.db._novip?i===ce.trans?i._promise(e,d,r):Yt(function(){return i._promise(e,d,r)},{trans:i,transless:ce.transless||ce}):(function y(I,p,C,b){if(I.idbdb&&(I._state.openComplete||ce.letThrough||I._vip)){var _=I._createTransaction(p,C,I._dbSchema);try{_.create(),I._state.PR1398_maxLoop=3}catch(S){return S.name===Te.InvalidState&&I.isOpen()&&0<--I._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),I.close({disableAutoOpen:!1}),I.open().then(function(){return y(I,p,C,b)})):dt(S)}return _._promise(p,function(S,k){return Yt(function(){return ce.trans=_,b(S,k,_)})}).then(function(S){if(p==="readwrite")try{_.idbtrans.commit()}catch{}return p==="readonly"?S:_._completion.then(function(){return S})})}if(I._state.openComplete)return dt(new ee.DatabaseClosed(I._state.dbOpenError));if(!I._state.isBeingOpened){if(!I._state.autoOpen)return dt(new ee.DatabaseClosed);I.open().catch(ye)}return I._state.dbReadyPromise.then(function(){return y(I,p,C,b)})})(this.db,e,[this.name],d);return c&&(g._consoleTask=c,g=g.catch(function(y){return console.trace(y),dt(y)})),g}finally{v&&gn()}},We.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):e==null?dt(new ee.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(o){return r.hook.reading.fire(o)})}).then(n)},We.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(m(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var n=f(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(v){if(v.compound&&n.every(function(y){return 0<=v.keyPath.indexOf(y)})){for(var g=0;g<n.length;++g)if(n.indexOf(v.keyPath[g])===-1)return!1;return!0}return!1}).sort(function(v,g){return v.keyPath.length-g.keyPath.length})[0];if(r&&this.db._maxKey!==ln){var c=r.keyPath.slice(0,n.length);return this.where(c).equals(c.map(function(g){return e[g]}))}!r&&et&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(n.join("+"),"]"));var i=this.schema.idxByName;function o(v,g){return De(v,g)===0}var d=n.reduce(function(p,g){var y=p[0],I=p[1],p=i[g],C=e[g];return[y||p,y||!p?cn(I,p&&p.multi?function(b){return b=re(b,g),m(b)&&b.some(function(_){return o(C,_)})}:function(b){return o(C,re(b,g))}):I]},[null,null]),c=d[0],d=d[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(d):r?this.filter(d):this.where(n).equals("")},We.prototype.filter=function(e){return this.toCollection().and(e)},We.prototype.count=function(e){return this.toCollection().count(e)},We.prototype.offset=function(e){return this.toCollection().offset(e)},We.prototype.limit=function(e){return this.toCollection().limit(e)},We.prototype.each=function(e){return this.toCollection().each(e)},We.prototype.toArray=function(e){return this.toCollection().toArray(e)},We.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},We.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,m(e)?"[".concat(e.join("+"),"]"):e))},We.prototype.reverse=function(){return this.toCollection().reverse()},We.prototype.mapToClass=function(e){var n,r=this.db,i=this.name;function o(){return n!==null&&n.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Ci&&((function(g,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function I(){this.constructor=g}a(g,y),g.prototype=y===null?Object.create(y):(I.prototype=y.prototype,new I)})(o,n=e),Object.defineProperty(o.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),o.prototype.table=function(){return i},e=o);for(var c=new Set,d=e.prototype;d;d=x(d))Object.getOwnPropertyNames(d).forEach(function(g){return c.add(g)});function v(g){if(!g)return g;var y,I=Object.create(e.prototype);for(y in g)if(!c.has(y))try{I[y]=g[y]}catch{}return I}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),e},We.prototype.defineClass=function(){return this.mapToClass(function(e){P(this,e)})},We.prototype.add=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,c=i.keyPath,d=e;return c&&o&&(d=nr(c)(e)),this._trans("readwrite",function(v){return r.core.mutate({trans:v,type:"add",keys:n!=null?[n]:null,values:[d]})}).then(function(v){return v.numFailures?te.reject(v.failures[0]):v.lastResult}).then(function(v){if(c)try{se(e,c,v)}catch{}return v})},We.prototype.upsert=function(e,n){var r=this,i=this.schema.primKey.keyPath;return this._trans("readwrite",function(o){return r.core.get({trans:o,key:e}).then(function(c){var d=c??{};return Ti(d,n),i&&se(d,i,e),r.core.mutate({trans:o,type:"put",values:[d],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[n]}}).then(function(v){return v.numFailures?te.reject(v.failures[0]):!!c})})})},We.prototype.update=function(e,n){return typeof e!="object"||m(e)?this.where(":id").equals(e).modify(n):(e=re(e,this.schema.primKey.keyPath),e===void 0?dt(new ee.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(n))},We.prototype.put=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,c=i.keyPath,d=e;return c&&o&&(d=nr(c)(e)),this._trans("readwrite",function(v){return r.core.mutate({trans:v,type:"put",values:[d],keys:n!=null?[n]:null})}).then(function(v){return v.numFailures?te.reject(v.failures[0]):v.lastResult}).then(function(v){if(c)try{se(e,c,v)}catch{}return v})},We.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]}).then(function(i){return rr(n,[e],i)}).then(function(i){return i.numFailures?te.reject(i.failures[0]):void 0})})},We.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:ki}).then(function(r){return rr(e,null,r)})}).then(function(n){return n.numFailures?te.reject(n.failures[0]):void 0})},We.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(o){return n.hook.reading.fire(o)})})})},We.prototype.bulkAdd=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0,c=(r=r||(o?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",function(d){var y=i.schema.primKey,v=y.auto,y=y.keyPath;if(y&&o)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,y=y&&v?e.map(nr(y)):e;return i.core.mutate({trans:d,type:"add",keys:o,values:y,wantResults:c}).then(function(_){var p=_.numFailures,C=_.results,b=_.lastResult,_=_.failures;if(p===0)return c?C:b;throw new ve("".concat(i.name,".bulkAdd(): ").concat(p," of ").concat(g," operations failed"),_)})})},We.prototype.bulkPut=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0,c=(r=r||(o?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",function(d){var y=i.schema.primKey,v=y.auto,y=y.keyPath;if(y&&o)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,y=y&&v?e.map(nr(y)):e;return i.core.mutate({trans:d,type:"put",keys:o,values:y,wantResults:c}).then(function(_){var p=_.numFailures,C=_.results,b=_.lastResult,_=_.failures;if(p===0)return c?C:b;throw new ve("".concat(i.name,".bulkPut(): ").concat(p," of ").concat(g," operations failed"),_)})})},We.prototype.bulkUpdate=function(e){var n=this,r=this.core,i=e.map(function(d){return d.key}),o=e.map(function(d){return d.changes}),c=[];return this._trans("readwrite",function(d){return r.getMany({trans:d,keys:i,cache:"clone"}).then(function(v){var g=[],y=[];e.forEach(function(p,C){var b=p.key,_=p.changes,S=v[C];if(S){for(var k=0,O=Object.keys(_);k<O.length;k++){var T=O[k],D=_[T];if(T===n.schema.primKey.keyPath){if(De(D,b)!==0)throw new ee.Constraint("Cannot update primary key in bulkUpdate()")}else se(S,T,D)}c.push(C),g.push(b),y.push(S)}});var I=g.length;return r.mutate({trans:d,type:"put",keys:g,values:y,updates:{keys:i,changeSpecs:o}}).then(function(p){var C=p.numFailures,b=p.failures;if(C===0)return I;for(var _=0,S=Object.keys(b);_<S.length;_++){var k,O=S[_],T=c[Number(O)];T!=null&&(k=b[O],delete b[O],b[T]=k)}throw new ve("".concat(n.name,".bulkUpdate(): ").concat(C," of ").concat(I," operations failed"),b)})})})},We.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e}).then(function(o){return rr(n,e,o)})}).then(function(d){var o=d.numFailures,c=d.lastResult,d=d.failures;if(o===0)return c;throw new ve("".concat(n.name,".bulkDelete(): ").concat(o," of ").concat(r," operations failed"),d)})},We);function We(){}function Nn(e){function n(d,v){if(v){for(var g=arguments.length,y=new Array(g-1);--g;)y[g-1]=arguments[g];return r[d].subscribe.apply(null,y),e}if(typeof d=="string")return r[d]}var r={};n.addEventType=c;for(var i=1,o=arguments.length;i<o;++i)c(arguments[i]);return n;function c(d,v,g){if(typeof d!="object"){var y;v=v||Xe;var I={subscribers:[],fire:g=g||ye,subscribe:function(p){I.subscribers.indexOf(p)===-1&&(I.subscribers.push(p),I.fire=v(I.fire,p))},unsubscribe:function(p){I.subscribers=I.subscribers.filter(function(C){return C!==p}),I.fire=I.subscribers.reduce(v,g)}};return r[d]=n[d]=I}f(y=d).forEach(function(p){var C=y[p];if(m(C))c(p,y[p][0],y[p][1]);else{if(C!=="asap")throw new ee.InvalidArgument("Invalid event config");var b=c(p,qe,function(){for(var _=arguments.length,S=new Array(_);_--;)S[_]=arguments[_];b.subscribers.forEach(function(k){le(function(){k.apply(null,S)})})})}})}}function Mn(e,n){return M(n).from({prototype:e}),n}function bn(e,n){return!(e.filter||e.algorithm||e.or)&&(n?e.justLimit:!e.replayFilter)}function jr(e,n){e.filter=cn(e.filter,n)}function Hr(e,n,r){var i=e.replayFilter;e.replayFilter=i?function(){return cn(i(),n())}:n,e.justLimit=r&&!i}function ir(e,n){if(e.isPrimKey)return n.primaryKey;var r=n.getIndexByKeyPath(e.index);if(!r)throw new ee.Schema("KeyPath "+e.index+" on object store "+n.name+" is not indexed");return r}function Fi(e,n,r){var i=ir(e,n.schema);return n.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:i,range:e.range}})}function ar(e,n,r,i){var o=e.replayFilter?cn(e.filter,e.replayFilter()):e.filter;if(e.or){var c={},d=function(v,g,y){var I,p;o&&!o(g,y,function(C){return g.stop(C)},function(C){return g.fail(C)})||((p=""+(I=g.primaryKey))=="[object ArrayBuffer]"&&(p=""+new Uint8Array(I)),N(c,p)||(c[p]=!0,n(v,g,y)))};return Promise.all([e.or._iterate(d,r),Di(Fi(e,i,r),e.algorithm,d,!e.keysOnly&&e.valueMapper)])}return Di(Fi(e,i,r),cn(e.algorithm,o),n,!e.keysOnly&&e.valueMapper)}function Di(e,n,r,i){var o=tt(i?function(c,d,v){return r(i(c),d,v)}:r);return e.then(function(c){if(c)return c.start(function(){var d=function(){return c.continue()};n&&!n(c,function(v){return d=v},function(v){c.stop(v),d=ye},function(v){c.fail(v),d=ye})||o(c.value,c,function(v){return d=v}),d()})})}var Ba=(Ve.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,dt.bind(null,r.error)):r.table._trans("readonly",e).then(n)},Ve.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,dt.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},Ve.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=cn(n.algorithm,e)},Ve.prototype._iterate=function(e,n){return ar(this._ctx,e,n,this._ctx.table.core)},Ve.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&P(r,e),n._ctx=r,n},Ve.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ve.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return ar(n,e,r,n.table.core)})},Ve.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,o=i.table.core;if(bn(i,!0))return o.count({trans:r,query:{index:ir(i,o.schema),range:i.range}}).then(function(d){return Math.min(d,i.limit)});var c=0;return ar(i,function(){return++c,!1},r,o).then(function(){return c})}).then(e)},Ve.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],o=r.length-1;function c(g,y){return y?c(g[r[y]],y-1):g[i]}var d=this._ctx.dir==="next"?1:-1;function v(g,y){return De(c(g,o),c(y,o))*d}return this.toArray(function(g){return g.sort(v)}).then(n)},Ve.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&bn(i,!0)&&0<i.limit){var o=i.valueMapper,c=ir(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:c,range:i.range}}).then(function(v){return v=v.result,o?v.map(o):v})}var d=[];return ar(i,function(v){return d.push(v)},r,i.table.core).then(function(){return d})},e)},Ve.prototype.offset=function(e){var n=this._ctx;return e<=0||(n.offset+=e,bn(n)?Hr(n,function(){var r=e;return function(i,o){return r===0||(r===1?--r:o(function(){i.advance(r),r=0}),!1)}}):Hr(n,function(){var r=e;return function(){return--r<0}})),this},Ve.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Hr(this._ctx,function(){var n=e;return function(r,i,o){return--n<=0&&i(o),0<=n}},!0),this},Ve.prototype.until=function(e,n){return jr(this._ctx,function(r,i,o){return!e(r.value)||(i(o),n)}),this},Ve.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},Ve.prototype.last=function(e){return this.reverse().first(e)},Ve.prototype.filter=function(e){var n;return jr(this._ctx,function(r){return e(r.value)}),(n=this._ctx).isMatch=cn(n.isMatch,e),this},Ve.prototype.and=function(e){return this.filter(e)},Ve.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Ve.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ve.prototype.desc=function(){return this.reverse()},Ve.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},Ve.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Ve.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},Ve.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.key)}).then(function(){return r}).then(e)},Ve.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&bn(n,!0)&&0<n.limit)return this._read(function(i){var o=ir(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:o,range:n.range}})}).then(function(i){return i.result}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.primaryKey)}).then(function(){return r}).then(e)},Ve.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Ve.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},Ve.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Ve.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var n={};return jr(this._ctx,function(o){var i=o.primaryKey.toString(),o=N(n,i);return n[i]=!0,!o}),this},Ve.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var o=typeof e=="function"?e:function(S){return Ti(S,e)},c=r.table.core,y=c.schema.primaryKey,d=y.outbound,v=y.extractKey,g=200,y=n.db._options.modifyChunkSize;y&&(g=typeof y=="object"?y[c.name]||y["*"]||200:y);function I(S,T){var O=T.failures,T=T.numFailures;C+=S-T;for(var D=0,V=f(O);D<V.length;D++){var U=V[D];p.push(O[U])}}var p=[],C=0,b=[],_=e===Ni;return n.clone().primaryKeys().then(function(S){function k(T){var D=Math.min(g,S.length-T),V=S.slice(T,T+D);return(_?Promise.resolve([]):c.getMany({trans:i,keys:V,cache:"immutable"})).then(function(U){var Q=[],B=[],$=d?[]:null,Z=_?V:[];if(!_)for(var J=0;J<D;++J){var ie=U[J],xe={value:_e(ie),primKey:S[T+J]};o.call(xe,xe.value,xe)!==!1&&(xe.value==null?Z.push(S[T+J]):d||De(v(ie),v(xe.value))===0?(B.push(xe.value),d&&$.push(S[T+J])):(Z.push(S[T+J]),Q.push(xe.value)))}return Promise.resolve(0<Q.length&&c.mutate({trans:i,type:"add",values:Q}).then(function(Ce){for(var Oe in Ce.failures)Z.splice(parseInt(Oe),1);I(Q.length,Ce)})).then(function(){return(0<B.length||O&&typeof e=="object")&&c.mutate({trans:i,type:"put",keys:$,values:B,criteria:O,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<T}).then(function(Ce){return I(B.length,Ce)})}).then(function(){return(0<Z.length||O&&_)&&c.mutate({trans:i,type:"delete",keys:Z,criteria:O,isAdditionalChunk:0<T}).then(function(Ce){return rr(r.table,Z,Ce)}).then(function(Ce){return I(Z.length,Ce)})}).then(function(){return S.length>T+D&&k(T+g)})})}var O=bn(r)&&r.limit===1/0&&(typeof e!="function"||_)&&{index:r.index,range:r.range};return k(0).then(function(){if(0<p.length)throw new de("Error modifying one or more objects",p,C,b);return S.length})})})},Ve.prototype.delete=function(){var e=this._ctx,n=e.range;return!bn(e)||e.table.schema.yProps||!e.isPrimKey&&n.type!==3?this.modify(Ni):this._write(function(r){var i=e.table.core.schema.primaryKey,o=n;return e.table.core.count({trans:r,query:{index:i,range:o}}).then(function(c){return e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(function(g){var v=g.failures,g=g.numFailures;if(g)throw new de("Could not delete some values",Object.keys(v).map(function(y){return v[y]}),c-g);return c-g})})})},Ve);function Ve(){}var Ni=function(e,n){return n.value=null};function qa(e,n){return e<n?-1:e===n?0:1}function Ua(e,n){return n<e?-1:e===n?0:1}function Ft(e,n,r){return e=e instanceof Li?new e.Collection(e):e,e._ctx.error=new(r||TypeError)(n),e}function wn(e){return new e.Collection(e,function(){return Mi("")}).limit(0)}function or(e,n,r,i){var o,c,d,v,g,y,I,p=r.length;if(!r.every(function(_){return typeof _=="string"}))return Ft(e,Ii);function C(_){o=_==="next"?function(k){return k.toUpperCase()}:function(k){return k.toLowerCase()},c=_==="next"?function(k){return k.toLowerCase()}:function(k){return k.toUpperCase()},d=_==="next"?qa:Ua;var S=r.map(function(k){return{lower:c(k),upper:o(k)}}).sort(function(k,O){return d(k.lower,O.lower)});v=S.map(function(k){return k.upper}),g=S.map(function(k){return k.lower}),I=(y=_)==="next"?"":i}C("next"),e=new e.Collection(e,function(){return Xt(v[0],g[p-1]+i)}),e._ondirectionchange=function(_){C(_)};var b=0;return e._addAlgorithm(function(_,S,k){var O=_.key;if(typeof O!="string")return!1;var T=c(O);if(n(T,g,b))return!0;for(var D=null,V=b;V<p;++V){var U=(function(Q,B,$,Z,J,ie){for(var xe=Math.min(Q.length,Z.length),Ce=-1,Oe=0;Oe<xe;++Oe){var Dt=B[Oe];if(Dt!==Z[Oe])return J(Q[Oe],$[Oe])<0?Q.substr(0,Oe)+$[Oe]+$.substr(Oe+1):J(Q[Oe],Z[Oe])<0?Q.substr(0,Oe)+Z[Oe]+$.substr(Oe+1):0<=Ce?Q.substr(0,Ce)+B[Ce]+$.substr(Ce+1):null;J(Q[Oe],Dt)<0&&(Ce=Oe)}return xe<Z.length&&ie==="next"?Q+$.substr(Q.length):xe<Q.length&&ie==="prev"?Q.substr(0,$.length):Ce<0?null:Q.substr(0,Ce)+Z[Ce]+$.substr(Ce+1)})(O,T,v[V],g[V],d,y);U===null&&D===null?b=V+1:(D===null||0<d(D,U))&&(D=U)}return S(D!==null?function(){_.continue(D+I)}:k),!1}),e}function Xt(e,n,r,i){return{type:2,lower:e,upper:n,lowerOpen:r,upperOpen:i}}function Mi(e){return{type:1,lower:e,upper:e}}var Li=(Object.defineProperty(bt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),bt.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return 0<this._cmp(e,n)||this._cmp(e,n)===0&&(r||i)&&(!r||!i)?wn(this):new this.Collection(this,function(){return Xt(e,n,!r,!i)})}catch{return Ft(this,Gt)}},bt.prototype.equals=function(e){return e==null?Ft(this,Gt):new this.Collection(this,function(){return Mi(e)})},bt.prototype.above=function(e){return e==null?Ft(this,Gt):new this.Collection(this,function(){return Xt(e,void 0,!0)})},bt.prototype.aboveOrEqual=function(e){return e==null?Ft(this,Gt):new this.Collection(this,function(){return Xt(e,void 0,!1)})},bt.prototype.below=function(e){return e==null?Ft(this,Gt):new this.Collection(this,function(){return Xt(void 0,e,!1,!0)})},bt.prototype.belowOrEqual=function(e){return e==null?Ft(this,Gt):new this.Collection(this,function(){return Xt(void 0,e)})},bt.prototype.startsWith=function(e){return typeof e!="string"?Ft(this,Ii):this.between(e,e+ln,!0,!0)},bt.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):or(this,function(n,r){return n.indexOf(r[0])===0},[e],ln)},bt.prototype.equalsIgnoreCase=function(e){return or(this,function(n,r){return n===r[0]},[e],"")},bt.prototype.anyOfIgnoreCase=function(){var e=Pe.apply(be,arguments);return e.length===0?wn(this):or(this,function(n,r){return r.indexOf(n)!==-1},e,"")},bt.prototype.startsWithAnyOfIgnoreCase=function(){var e=Pe.apply(be,arguments);return e.length===0?wn(this):or(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,ln)},bt.prototype.anyOf=function(){var e=this,n=Pe.apply(be,arguments),r=this._cmp;try{n.sort(r)}catch{return Ft(this,Gt)}if(n.length===0)return wn(this);var i=new this.Collection(this,function(){return Xt(n[0],n[n.length-1])});i._ondirectionchange=function(c){r=c==="next"?e._ascending:e._descending,n.sort(r)};var o=0;return i._addAlgorithm(function(c,d,v){for(var g=c.key;0<r(g,n[o]);)if(++o===n.length)return d(v),!1;return r(g,n[o])===0||(d(function(){c.continue(n[o])}),!1)}),i},bt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},bt.prototype.noneOf=function(){var e=Pe.apply(be,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ft(this,Gt)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[-1/0,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},bt.prototype.inAnyRange=function(O,n){var r=this,i=this._cmp,o=this._ascending,c=this._descending,d=this._min,v=this._max;if(O.length===0)return wn(this);if(!O.every(function(T){return T[0]!==void 0&&T[1]!==void 0&&o(T[0],T[1])<=0}))return Ft(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);var g=!n||n.includeLowers!==!1,y=n&&n.includeUppers===!0,I,p=o;function C(T,D){return p(T[0],D[0])}try{(I=O.reduce(function(T,D){for(var V=0,U=T.length;V<U;++V){var Q=T[V];if(i(D[0],Q[1])<0&&0<i(D[1],Q[0])){Q[0]=d(Q[0],D[0]),Q[1]=v(Q[1],D[1]);break}}return V===U&&T.push(D),T},[])).sort(C)}catch{return Ft(this,Gt)}var b=0,_=y?function(T){return 0<o(T,I[b][1])}:function(T){return 0<=o(T,I[b][1])},S=g?function(T){return 0<c(T,I[b][0])}:function(T){return 0<=c(T,I[b][0])},k=_,O=new this.Collection(this,function(){return Xt(I[0][0],I[I.length-1][1],!g,!y)});return O._ondirectionchange=function(T){p=T==="next"?(k=_,o):(k=S,c),I.sort(C)},O._addAlgorithm(function(T,D,V){for(var U,Q=T.key;k(Q);)if(++b===I.length)return D(V),!1;return!_(U=Q)&&!S(U)||(r._cmp(Q,I[b][1])===0||r._cmp(Q,I[b][0])===0||D(function(){p===o?T.continue(I[b][0]):T.continue(I[b][1])}),!1)}),O},bt.prototype.startsWithAnyOf=function(){var e=Pe.apply(be,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?wn(this):this.inAnyRange(e.map(function(n){return[n,n+ln]})):Ft(this,"startsWithAnyOf() only works with strings")},bt);function bt(){}function zt(e){return tt(function(n){return Ln(n),e(n.target.error),!1})}function Ln(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Rn="storagemutated",zr="x-storagemutated-1",Zt=Nn(null,Rn),Ga=(Kt.prototype._lock=function(){return W(!ce.global),++this._reculock,this._reculock!==1||ce.global||(ce.lockOwnerFor=this),this},Kt.prototype._unlock=function(){if(W(!ce.global),--this._reculock==0)for(ce.global||(ce.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{sn(e[1],e[0])}catch{}}return this},Kt.prototype._locked=function(){return this._reculock&&ce.lockOwnerFor!==this},Kt.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(W(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(i);case"MissingAPIError":throw new ee.MissingAPI(i.message,i);default:throw new ee.OpenFailed(i)}if(!this.active)throw new ee.TransactionInactive;return W(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=tt(function(o){Ln(o),n._reject(e.error)}),e.onabort=tt(function(o){Ln(o),n.active&&n._reject(new ee.Abort(e.error)),n.active=!1,n.on("abort").fire(o)}),e.oncomplete=tt(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&Zt.storagemutated.fire(e.mutatedParts)}),this},Kt.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return dt(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return dt(new ee.TransactionInactive);if(this._locked())return new te(function(c,d){i._blockedFuncs.push([function(){i._promise(e,n,r).then(c,d)},ce])});if(r)return Yt(function(){var c=new te(function(d,v){i._lock();var g=n(d,v,i);g&&g.then&&g.then(d,v)});return c.finally(function(){return i._unlock()}),c._lib=!0,c});var o=new te(function(c,d){var v=n(c,d,i);v&&v.then&&v.then(c,d)});return o._lib=!0,o},Kt.prototype._root=function(){return this.parent?this.parent._root():this},Kt.prototype.waitFor=function(e){var n,r=this._root(),i=te.resolve(e);r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return i}):(r._waitingFor=i,r._waitingQueue=[],n=r.idbtrans.objectStore(r.storeNames[0]),(function c(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(n.get(-1/0).onsuccess=c)})());var o=r._waitingFor;return new te(function(c,d){i.then(function(v){return r._waitingQueue.push(tt(c.bind(null,v)))},function(v){return r._waitingQueue.push(tt(d.bind(null,v)))}).finally(function(){r._waitingFor===o&&(r._waitingFor=null)})})},Kt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))},Kt.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(N(n,e))return n[e];var r=this.schema[e];if(!r)throw new ee.NotFound("Table "+e+" not part of transaction");return r=new this.db.Table(e,r,this),r.core=this.db.core.table(e),n[e]=r},Kt);function Kt(){}function Kr(e,n,r,i,o,c,d,v){return{name:e,keyPath:n,unique:r,multi:i,auto:o,compound:c,src:(r&&!d?"&":"")+(i?"*":"")+(o?"++":"")+Ri(n),type:v}}function Ri(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Br(e,n,r){return{name:e,primKey:n,indexes:r,mappedClass:null,idxByName:(i=function(o){return[o.name,o]},r.reduce(function(o,c,d){return d=i(c,d),d&&(o[d[0]]=d[1]),o},{}))};var i}var Vn=function(e){try{return e.only([[]]),Vn=function(){return[[]]},[[]]}catch{return Vn=function(){return ln},ln}};function qr(e){return e==null?function(){}:typeof e=="string"?(n=e).split(".").length===1?function(r){return r[n]}:function(r){return re(r,n)}:function(r){return re(r,e)};var n}function Vi(e){return[].slice.call(e)}var Wa=0;function jn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function $a(e,n,g){function i(k){if(k.type===3)return null;if(k.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var b=k.lower,_=k.upper,S=k.lowerOpen,k=k.upperOpen;return b===void 0?_===void 0?null:n.upperBound(_,!!k):_===void 0?n.lowerBound(b,!!S):n.bound(b,_,!!S,!!k)}function o(C){var b,_=C.name;return{name:_,schema:C,mutate:function(S){var k=S.trans,O=S.type,T=S.keys,D=S.values,V=S.range;return new Promise(function(U,Q){U=tt(U);var B=k.objectStore(_),$=B.keyPath==null,Z=O==="put"||O==="add";if(!Z&&O!=="delete"&&O!=="deleteRange")throw new Error("Invalid operation type: "+O);var J,ie=(T||D||{length:1}).length;if(T&&D&&T.length!==D.length)throw new Error("Given keys array must have same length as given values array.");if(ie===0)return U({numFailures:0,failures:{},results:[],lastResult:void 0});function xe(kt){++Dt,Ln(kt)}var Ce=[],Oe=[],Dt=0;if(O==="deleteRange"){if(V.type===4)return U({numFailures:Dt,failures:Oe,results:[],lastResult:void 0});V.type===3?Ce.push(J=B.clear()):Ce.push(J=B.delete(i(V)))}else{var $=Z?$?[D,T]:[D,null]:[T,null],Se=$[0],_t=$[1];if(Z)for(var St=0;St<ie;++St)Ce.push(J=_t&&_t[St]!==void 0?B[O](Se[St],_t[St]):B[O](Se[St])),J.onerror=xe;else for(St=0;St<ie;++St)Ce.push(J=B[O](Se[St])),J.onerror=xe}function yr(kt){kt=kt.target.result,Ce.forEach(function(fn,li){return fn.error!=null&&(Oe[li]=fn.error)}),U({numFailures:Dt,failures:Oe,results:O==="delete"?T:Ce.map(function(fn){return fn.result}),lastResult:kt})}J.onerror=function(kt){xe(kt),yr(kt)},J.onsuccess=yr})},getMany:function(S){var k=S.trans,O=S.keys;return new Promise(function(T,D){T=tt(T);for(var V,U=k.objectStore(_),Q=O.length,B=new Array(Q),$=0,Z=0,J=function(Ce){Ce=Ce.target,B[Ce._pos]=Ce.result,++Z===$&&T(B)},ie=zt(D),xe=0;xe<Q;++xe)O[xe]!=null&&((V=U.get(O[xe]))._pos=xe,V.onsuccess=J,V.onerror=ie,++$);$===0&&T(B)})},get:function(S){var k=S.trans,O=S.key;return new Promise(function(T,D){T=tt(T);var V=k.objectStore(_).get(O);V.onsuccess=function(U){return T(U.target.result)},V.onerror=zt(D)})},query:(b=y,function(S){return new Promise(function(k,O){k=tt(k);var T,D,V,$=S.trans,U=S.values,Q=S.limit,J=S.query,B=Q===1/0?void 0:Q,Z=J.index,J=J.range,$=$.objectStore(_),Z=Z.isPrimaryKey?$:$.index(Z.name),J=i(J);if(Q===0)return k({result:[]});b?((B=U?Z.getAll(J,B):Z.getAllKeys(J,B)).onsuccess=function(ie){return k({result:ie.target.result})},B.onerror=zt(O)):(T=0,D=!U&&"openKeyCursor"in Z?Z.openKeyCursor(J):Z.openCursor(J),V=[],D.onsuccess=function(ie){var xe=D.result;return xe?(V.push(U?xe.value:xe.primaryKey),++T===Q?k({result:V}):void xe.continue()):k({result:V})},D.onerror=zt(O))})}),openCursor:function(S){var k=S.trans,O=S.values,T=S.query,D=S.reverse,V=S.unique;return new Promise(function(U,Q){U=tt(U);var Z=T.index,B=T.range,$=k.objectStore(_),$=Z.isPrimaryKey?$:$.index(Z.name),Z=D?V?"prevunique":"prev":V?"nextunique":"next",J=!O&&"openKeyCursor"in $?$.openKeyCursor(i(B),Z):$.openCursor(i(B),Z);J.onerror=zt(Q),J.onsuccess=tt(function(ie){var xe,Ce,Oe,Dt,Se=J.result;Se?(Se.___id=++Wa,Se.done=!1,xe=Se.continue.bind(Se),Ce=(Ce=Se.continuePrimaryKey)&&Ce.bind(Se),Oe=Se.advance.bind(Se),Dt=function(){throw new Error("Cursor not stopped")},Se.trans=k,Se.stop=Se.continue=Se.continuePrimaryKey=Se.advance=function(){throw new Error("Cursor not started")},Se.fail=tt(Q),Se.next=function(){var _t=this,St=1;return this.start(function(){return St--?_t.continue():_t.stop()}).then(function(){return _t})},Se.start=function(_t){function St(){if(J.result)try{_t()}catch(kt){Se.fail(kt)}else Se.done=!0,Se.start=function(){throw new Error("Cursor behind last entry")},Se.stop()}var yr=new Promise(function(kt,fn){kt=tt(kt),J.onerror=zt(fn),Se.fail=fn,Se.stop=function(li){Se.stop=Se.continue=Se.continuePrimaryKey=Se.advance=Dt,kt(li)}});return J.onsuccess=tt(function(kt){J.onsuccess=St,St()}),Se.continue=xe,Se.continuePrimaryKey=Ce,Se.advance=Oe,St(),yr},U(Se)):U(null)},Q)})},count:function(S){var k=S.query,O=S.trans,T=k.index,D=k.range;return new Promise(function(V,U){var Q=O.objectStore(_),B=T.isPrimaryKey?Q:Q.index(T.name),Q=i(D),B=Q?B.count(Q):B.count();B.onsuccess=tt(function($){return V($.target.result)}),B.onerror=zt(U)})}}}var c,d,v,I=(d=g,v=Vi((c=e).objectStoreNames),{schema:{name:c.name,tables:v.map(function(C){return d.objectStore(C)}).map(function(C){var b=C.keyPath,k=C.autoIncrement,_=m(b),S={},k={name:C.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:b==null,compound:_,keyPath:b,autoIncrement:k,unique:!0,extractKey:qr(b)},indexes:Vi(C.indexNames).map(function(O){return C.index(O)}).map(function(V){var T=V.name,D=V.unique,U=V.multiEntry,V=V.keyPath,U={name:T,compound:m(V),keyPath:V,unique:D,multiEntry:U,extractKey:qr(V)};return S[jn(V)]=U}),getIndexByKeyPath:function(O){return S[jn(O)]}};return S[":id"]=k.primaryKey,b!=null&&(S[jn(b)]=k.primaryKey),k})},hasGetAll:0<v.length&&"getAll"in d.objectStore(v[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),g=I.schema,y=I.hasGetAll,I=g.tables.map(o),p={};return I.forEach(function(C){return p[C.name]=C}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(C){if(!p[C])throw new Error("Table '".concat(C,"' not found"));return p[C]},MIN_KEY:-1/0,MAX_KEY:Vn(n),schema:g}}function Ya(e,n,r,i){var o=r.IDBKeyRange;return r.indexedDB,{dbcore:(i=$a(n,o,i),e.dbcore.reduce(function(c,d){return d=d.create,s(s({},c),d(c))},i))}}function sr(e,i){var r=i.db,i=Ya(e._middlewares,r,e._deps,i);e.core=i.dbcore,e.tables.forEach(function(o){var c=o.name;e.core.schema.tables.some(function(d){return d.name===c})&&(o.core=e.core.table(c),e[c]instanceof e.Table&&(e[c].core=o.core))})}function lr(e,n,r,i){r.forEach(function(o){var c=i[o];n.forEach(function(d){var v=(function g(y,I){return H(y,I)||(y=x(y))&&g(y,I)})(d,o);(!v||"value"in v&&v.value===void 0)&&(d===e.Transaction.prototype||d instanceof e.Transaction?R(d,o,{get:function(){return this.table(o)},set:function(g){q(this,o,{value:g,writable:!0,configurable:!0,enumerable:!0})}}):d[o]=new e.Table(o,c))})})}function Ur(e,n){n.forEach(function(r){for(var i in r)r[i]instanceof e.Table&&delete r[i]})}function Ja(e,n){return e._cfg.version-n._cfg.version}function Qa(e,n,r,i){var o=e._dbSchema;r.objectStoreNames.contains("$meta")&&!o.$meta&&(o.$meta=Br("$meta",Hi("")[0],[]),e._storeNames.push("$meta"));var c=e._createTransaction("readwrite",e._storeNames,o);c.create(r),c._completion.catch(i);var d=c._reject.bind(c),v=ce.transless||ce;Yt(function(){return ce.trans=c,ce.transless=v,n!==0?(sr(e,r),y=n,((g=c).storeNames.includes("$meta")?g.table("$meta").get("version").then(function(I){return I??y}):te.resolve(y)).then(function(I){return C=I,b=c,_=r,S=[],I=(p=e)._versions,k=p._dbSchema=ur(0,p.idbdb,_),(I=I.filter(function(O){return O._cfg.version>=C})).length!==0?(I.forEach(function(O){S.push(function(){var T=k,D=O._cfg.dbschema;dr(p,T,_),dr(p,D,_),k=p._dbSchema=D;var V=Gr(T,D);V.add.forEach(function(Z){Wr(_,Z[0],Z[1].primKey,Z[1].indexes)}),V.change.forEach(function(Z){if(Z.recreate)throw new ee.Upgrade("Not yet support for changing primary key");var J=_.objectStore(Z.name);Z.add.forEach(function(ie){return cr(J,ie)}),Z.change.forEach(function(ie){J.deleteIndex(ie.name),cr(J,ie)}),Z.del.forEach(function(ie){return J.deleteIndex(ie)})});var U=O._cfg.contentUpgrade;if(U&&O._cfg.version>C){sr(p,_),b._memoizedTables={};var Q=me(D);V.del.forEach(function(Z){Q[Z]=T[Z]}),Ur(p,[p.Transaction.prototype]),lr(p,[p.Transaction.prototype],f(Q),Q),b.schema=Q;var B,$=ot(U);return $&&mn(),V=te.follow(function(){var Z;(B=U(b))&&$&&(Z=Jt.bind(null,null),B.then(Z,Z))}),B&&typeof B.then=="function"?te.resolve(B):V.then(function(){return B})}}),S.push(function(T){var D,V,U=O._cfg.dbschema;D=U,V=T,[].slice.call(V.db.objectStoreNames).forEach(function(Q){return D[Q]==null&&V.db.deleteObjectStore(Q)}),Ur(p,[p.Transaction.prototype]),lr(p,[p.Transaction.prototype],p._storeNames,p._dbSchema),b.schema=p._dbSchema}),S.push(function(T){p.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(p.idbdb.version/10)===O._cfg.version?(p.idbdb.deleteObjectStore("$meta"),delete p._dbSchema.$meta,p._storeNames=p._storeNames.filter(function(D){return D!=="$meta"})):T.objectStore("$meta").put(O._cfg.version,"version"))})}),(function O(){return S.length?te.resolve(S.shift()(b.idbtrans)).then(O):te.resolve()})().then(function(){ji(k,_)})):te.resolve();var p,C,b,_,S,k}).catch(d)):(f(o).forEach(function(I){Wr(r,I,o[I].primKey,o[I].indexes)}),sr(e,r),void te.follow(function(){return e.on.populate.fire(c)}).catch(d));var g,y})}function Xa(e,n){ji(e._dbSchema,n),n.db.version%10!=0||n.objectStoreNames.contains("$meta")||n.db.createObjectStore("$meta").add(Math.ceil(n.db.version/10-1),"version");var r=ur(0,e.idbdb,n);dr(e,e._dbSchema,n);for(var i=0,o=Gr(r,e._dbSchema).change;i<o.length;i++){var c=(function(d){if(d.change.length||d.recreate)return console.warn("Unable to patch indexes of table ".concat(d.name," because it has changes on the type of index or primary key.")),{value:void 0};var v=n.objectStore(d.name);d.add.forEach(function(g){et&&console.debug("Dexie upgrade patch: Creating missing index ".concat(d.name,".").concat(g.src)),cr(v,g)})})(o[i]);if(typeof c=="object")return c.value}}function Gr(e,n){var r,i={del:[],add:[],change:[]};for(r in e)n[r]||i.del.push(r);for(r in n){var o=e[r],c=n[r];if(o){var d={name:r,def:c,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(c.primKey.keyPath||"")||o.primKey.auto!==c.primKey.auto)d.recreate=!0,i.change.push(d);else{var v=o.idxByName,g=c.idxByName,y=void 0;for(y in v)g[y]||d.del.push(y);for(y in g){var I=v[y],p=g[y];I?I.src!==p.src&&d.change.push(p):d.add.push(p)}(0<d.del.length||0<d.add.length||0<d.change.length)&&i.change.push(d)}}else i.add.push([r,c])}return i}function Wr(e,n,r,i){var o=e.db.createObjectStore(n,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return i.forEach(function(c){return cr(o,c)}),o}function ji(e,n){f(e).forEach(function(r){n.db.objectStoreNames.contains(r)||(et&&console.debug("Dexie: Creating missing table",r),Wr(n,r,e[r].primKey,e[r].indexes))})}function cr(e,n){e.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function ur(e,n,r){var i={};return z(n.objectStoreNames,0).forEach(function(o){for(var c=r.objectStore(o),d=Kr(Ri(y=c.keyPath),y||"",!0,!1,!!c.autoIncrement,y&&typeof y!="string",!0),v=[],g=0;g<c.indexNames.length;++g){var I=c.index(c.indexNames[g]),y=I.keyPath,I=Kr(I.name,y,!!I.unique,!!I.multiEntry,!1,y&&typeof y!="string",!1);v.push(I)}i[o]=Br(o,d,v)}),i}function dr(e,n,r){for(var i=r.db.objectStoreNames,o=0;o<i.length;++o){var c=i[o],d=r.objectStore(c);e._hasGetAll="getAll"in d;for(var v=0;v<d.indexNames.length;++v){var g=d.indexNames[v],y=d.index(g).keyPath,I=typeof y=="string"?y:"["+z(y).join("+")+"]";!n[c]||(y=n[c].idxByName[I])&&(y.name=g,delete n[c].idxByName[I],n[c].idxByName[g]=y)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&h.WorkerGlobalScope&&h instanceof h.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Hi(e){return e.split(",").map(function(n,r){var c=n.split(":"),i=(o=c[1])===null||o===void 0?void 0:o.trim(),o=(n=c[0].trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return Kr(o,c||null,/\&/.test(n),/\*/.test(n),/\+\+/.test(n),m(c),r===0,i)})}var Za=(_n.prototype._createTableSchema=Br,_n.prototype._parseIndexSyntax=Hi,_n.prototype._parseStoresSpec=function(e,n){var r=this;f(e).forEach(function(i){if(e[i]!==null){var o=r._parseIndexSyntax(e[i]),c=o.shift();if(!c)throw new ee.Schema("Invalid schema for table "+i+": "+e[i]);if(c.unique=!0,c.multi)throw new ee.Schema("Primary key cannot be multiEntry*");o.forEach(function(d){if(d.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")}),o=r._createTableSchema(i,c,o),n[i]=o}})},_n.prototype.stores=function(r){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?P(this._cfg.storesSource,r):r;var r=n._versions,i={},o={};return r.forEach(function(c){P(i,c._cfg.storesSource),o=c._cfg.dbschema={},c._parseStoresSpec(i,o)}),n._dbSchema=o,Ur(n,[n._allTables,n,n.Transaction.prototype]),lr(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],f(o),o),n._storeNames=f(o),this},_n.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Ze(this._cfg.contentUpgrade||ye,e),this},_n);function _n(){}function $r(e,n){var r=e._dbNamesDB;return r||(r=e._dbNamesDB=new Wt(tr,{addons:[],indexedDB:e,IDBKeyRange:n})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function Yr(e){return e&&typeof e.databases=="function"}function Jr(e){return Yt(function(){return ce.letThrough=!0,e()})}function Qr(e){return!("from"in e)}var wt=function(e,n){if(!this){var r=new wt;return e&&"d"in e&&P(r,e),r}P(this,arguments.length?{d:1,from:e,to:1<arguments.length?n:e}:{d:0})};function Hn(e,n,r){var i=De(n,r);if(!isNaN(i)){if(0<i)throw RangeError();if(Qr(e))return P(e,{from:n,to:r,d:1});var o=e.l,i=e.r;if(De(r,e.from)<0)return o?Hn(o,n,r):e.l={from:n,to:r,d:1,l:null,r:null},Ki(e);if(0<De(n,e.to))return i?Hn(i,n,r):e.r={from:n,to:r,d:1,l:null,r:null},Ki(e);De(n,e.from)<0&&(e.from=n,e.l=null,e.d=i?i.d+1:1),0<De(r,e.to)&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1),r=!e.r,o&&!e.l&&zn(e,o),i&&r&&zn(e,i)}}function zn(e,n){Qr(n)||(function r(i,g){var c=g.from,d=g.to,v=g.l,g=g.r;Hn(i,c,d),v&&r(i,v),g&&r(i,g)})(e,n)}function zi(e,n){var r=fr(n),i=r.next();if(i.done)return!1;for(var o=i.value,c=fr(e),d=c.next(o.from),v=d.value;!i.done&&!d.done;){if(De(v.from,o.to)<=0&&0<=De(v.to,o.from))return!0;De(o.from,v.from)<0?o=(i=r.next(v.from)).value:v=(d=c.next(o.from)).value}return!1}function fr(e){var n=Qr(e)?null:{s:0,n:e};return{next:function(r){for(var i=0<arguments.length;n;)switch(n.s){case 0:if(n.s=1,i)for(;n.n.l&&De(r,n.n.from)<0;)n={up:n,n:n.n.l,s:1};else for(;n.n.l;)n={up:n,n:n.n.l,s:1};case 1:if(n.s=2,!i||De(r,n.n.to)<=0)return{value:n.n,done:!1};case 2:if(n.n.r){n.s=3,n={up:n,n:n.n.r,s:0};continue}case 3:n=n.up}return{done:!0}}}}function Ki(e){var n,r,i=(((n=e.r)===null||n===void 0?void 0:n.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),o=1<i?"r":i<-1?"l":"";o&&(n=o=="r"?"l":"r",r=s({},e),i=e[o],e.from=i.from,e.to=i.to,e[o]=i[o],r[o]=i[n],(e[n]=r).d=Bi(r)),e.d=Bi(e)}function Bi(r){var n=r.r,r=r.l;return(n?r?Math.max(n.d,r.d):n.d:r?r.d:0)+1}function hr(e,n){return f(n).forEach(function(r){e[r]?zn(e[r],n[r]):e[r]=(function i(o){var c,d,v={};for(c in o)N(o,c)&&(d=o[c],v[c]=!d||typeof d!="object"||we.has(d.constructor)?d:i(d));return v})(n[r])}),e}function Xr(e,n){return e.all||n.all||Object.keys(e).some(function(r){return n[r]&&zi(n[r],e[r])})}E(wt.prototype,((Lt={add:function(e){return zn(this,e),this},addKey:function(e){return Hn(this,e,e),this},addKeys:function(e){var n=this;return e.forEach(function(r){return Hn(n,r,r)}),this},hasKey:function(e){var n=fr(this).next(e).value;return n&&De(n.from,e)<=0&&0<=De(n.to,e)}})[Je]=function(){return fr(this)},Lt));var un={},Zr={},ei=!1;function vr(e){hr(Zr,e),ei||(ei=!0,setTimeout(function(){ei=!1,ti(Zr,!(Zr={}))},0))}function ti(e,n){n===void 0&&(n=!1);var r=new Set;if(e.all)for(var i=0,o=Object.values(un);i<o.length;i++)qi(d=o[i],e,r,n);else for(var c in e){var d,v=/^idb\:\/\/(.*)\/(.*)\//.exec(c);v&&(c=v[1],v=v[2],(d=un["idb://".concat(c,"/").concat(v)])&&qi(d,e,r,n))}r.forEach(function(g){return g()})}function qi(e,n,r,i){for(var o=[],c=0,d=Object.entries(e.queries.query);c<d.length;c++){for(var v=d[c],g=v[0],y=[],I=0,p=v[1];I<p.length;I++){var C=p[I];Xr(n,C.obsSet)?C.subscribers.forEach(function(k){return r.add(k)}):i&&y.push(C)}i&&o.push([g,y])}if(i)for(var b=0,_=o;b<_.length;b++){var S=_[b],g=S[0],y=S[1];e.queries.query[g]=y}}function eo(e){var n=e._state,r=e._deps.indexedDB;if(n.isBeingOpened||e.idbdb)return n.dbReadyPromise.then(function(){return n.dbOpenError?dt(n.dbOpenError):e});n.isBeingOpened=!0,n.dbOpenError=null,n.openComplete=!1;var i=n.openCanceller,o=Math.round(10*e.verno),c=!1;function d(){if(n.openCanceller!==i)throw new ee.DatabaseClosed("db.open() was cancelled")}function v(){return new te(function(C,b){if(d(),!r)throw new ee.MissingAPI;var _=e.name,S=n.autoSchema||!o?r.open(_):r.open(_,o);if(!S)throw new ee.MissingAPI;S.onerror=zt(b),S.onblocked=tt(e._fireOnBlocked),S.onupgradeneeded=tt(function(k){var O;I=S.transaction,n.autoSchema&&!e._options.allowEmptyDB?(S.onerror=Ln,I.abort(),S.result.close(),(O=r.deleteDatabase(_)).onsuccess=O.onerror=tt(function(){b(new ee.NoSuchDatabase("Database ".concat(_," doesnt exist")))})):(I.onerror=zt(b),k=k.oldVersion>Math.pow(2,62)?0:k.oldVersion,p=k<1,e.idbdb=S.result,c&&Xa(e,I),Qa(e,k/10,I,b))},b),S.onsuccess=tt(function(){I=null;var k,O,T,D,V,U=e.idbdb=S.result,Q=z(U.objectStoreNames);if(0<Q.length)try{var B=U.transaction((D=Q).length===1?D[0]:D,"readonly");if(n.autoSchema)O=U,T=B,(k=e).verno=O.version/10,T=k._dbSchema=ur(0,O,T),k._storeNames=z(O.objectStoreNames,0),lr(k,[k._allTables],f(T),T);else if(dr(e,e._dbSchema,B),((V=Gr(ur(0,(V=e).idbdb,B),V._dbSchema)).add.length||V.change.some(function($){return $.add.length||$.change.length}))&&!c)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),U.close(),o=U.version+1,c=!0,C(v());sr(e,B)}catch{}yn.push(e),U.onversionchange=tt(function($){n.vcFired=!0,e.on("versionchange").fire($)}),U.onclose=tt(function(){e.close({disableAutoOpen:!1})}),p&&(V=e._deps,B=_,U=V.indexedDB,V=V.IDBKeyRange,Yr(U)||B===tr||$r(U,V).put({name:B}).catch(ye)),C()},b)}).catch(function(C){switch(C?.name){case"UnknownError":if(0<n.PR1398_maxLoop)return n.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),v();break;case"VersionError":if(0<o)return o=0,v()}return te.reject(C)})}var g,y=n.dbReadyResolve,I=null,p=!1;return te.race([i,(typeof navigator>"u"?te.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(C){function b(){return indexedDB.databases().finally(C)}g=setInterval(b,100),b()}).finally(function(){return clearInterval(g)}):Promise.resolve()).then(v)]).then(function(){return d(),n.onReadyBeingFired=[],te.resolve(Jr(function(){return e.on.ready.fire(e.vip)})).then(function C(){if(0<n.onReadyBeingFired.length){var b=n.onReadyBeingFired.reduce(Ze,ye);return n.onReadyBeingFired=[],te.resolve(Jr(function(){return b(e.vip)})).then(C)}})}).finally(function(){n.openCanceller===i&&(n.onReadyBeingFired=null,n.isBeingOpened=!1)}).catch(function(C){n.dbOpenError=C;try{I&&I.abort()}catch{}return i===n.openCanceller&&e._close(),dt(C)}).finally(function(){n.openComplete=!0,y()}).then(function(){var C;return p&&(C={},e.tables.forEach(function(b){b.schema.indexes.forEach(function(_){_.name&&(C["idb://".concat(e.name,"/").concat(b.name,"/").concat(_.name)]=new wt(-1/0,[[[]]]))}),C["idb://".concat(e.name,"/").concat(b.name,"/")]=C["idb://".concat(e.name,"/").concat(b.name,"/:dels")]=new wt(-1/0,[[[]]])}),Zt(Rn).fire(C),ti(C,!0)),e})}function ni(e){function n(c){return e.next(c)}var r=o(n),i=o(function(c){return e.throw(c)});function o(c){return function(g){var v=c(g),g=v.value;return v.done?g:g&&typeof g.then=="function"?g.then(r,i):m(g)?Promise.all(g).then(r,i):r(g)}}return o(n)()}function pr(e,n,r){for(var i=m(e)?e.slice():[e],o=0;o<r;++o)i.push(n);return i}var to={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return s(s({},e),{table:function(n){var r=e.table(n),i=r.schema,o={},c=[];function d(p,C,b){var _=jn(p),S=o[_]=o[_]||[],k=p==null?0:typeof p=="string"?1:p.length,O=0<C,O=s(s({},b),{name:O?"".concat(_,"(virtual-from:").concat(b.name,")"):b.name,lowLevelIndex:b,isVirtual:O,keyTail:C,keyLength:k,extractKey:qr(p),unique:!O&&b.unique});return S.push(O),O.isPrimaryKey||c.push(O),1<k&&d(k===2?p[0]:p.slice(0,k-1),C+1,b),S.sort(function(T,D){return T.keyTail-D.keyTail}),O}n=d(i.primaryKey.keyPath,0,i.primaryKey),o[":id"]=[n];for(var v=0,g=i.indexes;v<g.length;v++){var y=g[v];d(y.keyPath,0,y)}function I(p){var C,b=p.query.index;return b.isVirtual?s(s({},p),{query:{index:b.lowLevelIndex,range:(C=p.query.range,b=b.keyTail,{type:C.type===1?2:C.type,lower:pr(C.lower,C.lowerOpen?e.MAX_KEY:e.MIN_KEY,b),lowerOpen:!0,upper:pr(C.upper,C.upperOpen?e.MIN_KEY:e.MAX_KEY,b),upperOpen:!0})}}):p}return s(s({},r),{schema:s(s({},i),{primaryKey:n,indexes:c,getIndexByKeyPath:function(p){return(p=o[jn(p)])&&p[0]}}),count:function(p){return r.count(I(p))},query:function(p){return r.query(I(p))},openCursor:function(p){var C=p.query.index,b=C.keyTail,_=C.isVirtual,S=C.keyLength;return _?r.openCursor(I(p)).then(function(O){return O&&k(O)}):r.openCursor(p);function k(O){return Object.create(O,{continue:{value:function(T){T!=null?O.continue(pr(T,p.reverse?e.MAX_KEY:e.MIN_KEY,b)):p.unique?O.continue(O.key.slice(0,S).concat(p.reverse?e.MIN_KEY:e.MAX_KEY,b)):O.continue()}},continuePrimaryKey:{value:function(T,D){O.continuePrimaryKey(pr(T,e.MAX_KEY,b),D)}},primaryKey:{get:function(){return O.primaryKey}},key:{get:function(){var T=O.key;return S===1?T[0]:T.slice(0,S)}},value:{get:function(){return O.value}}})}}})}})}};function ri(e,n,r,i){return r=r||{},i=i||"",f(e).forEach(function(o){var c,d,v;N(n,o)?(c=e[o],d=n[o],typeof c=="object"&&typeof d=="object"&&c&&d?(v=ze(c))!==ze(d)?r[i+o]=n[o]:v==="Object"?ri(c,d,r,i+o+"."):c!==d&&(r[i+o]=n[o]):c!==d&&(r[i+o]=n[o])):r[i+o]=void 0}),f(n).forEach(function(o){N(e,o)||(r[i+o]=n[o])}),r}function ii(e,n){return n.type==="delete"?n.keys:n.keys||n.values.map(e.extractKey)}var no={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return s(s({},e),{table:function(n){var r=e.table(n),i=r.schema.primaryKey;return s(s({},r),{mutate:function(o){var c=ce.trans,d=c.table(n).hook,v=d.deleting,g=d.creating,y=d.updating;switch(o.type){case"add":if(g.fire===ye)break;return c._promise("readwrite",function(){return I(o)},!0);case"put":if(g.fire===ye&&y.fire===ye)break;return c._promise("readwrite",function(){return I(o)},!0);case"delete":if(v.fire===ye)break;return c._promise("readwrite",function(){return I(o)},!0);case"deleteRange":if(v.fire===ye)break;return c._promise("readwrite",function(){return(function p(C,b,_){return r.query({trans:C,values:!1,query:{index:i,range:b},limit:_}).then(function(S){var k=S.result;return I({type:"delete",keys:k,trans:C}).then(function(O){return 0<O.numFailures?Promise.reject(O.failures[0]):k.length<_?{failures:[],numFailures:0,lastResult:void 0}:p(C,s(s({},b),{lower:k[k.length-1],lowerOpen:!0}),_)})})})(o.trans,o.range,1e4)},!0)}return r.mutate(o);function I(p){var C,b,_,S=ce.trans,k=p.keys||ii(i,p);if(!k)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?s(s({},p),{keys:k}):s({},p)).type!=="delete"&&(p.values=u([],p.values)),p.keys&&(p.keys=u([],p.keys)),C=r,_=k,((b=p).type==="add"?Promise.resolve([]):C.getMany({trans:b.trans,keys:_,cache:"immutable"})).then(function(O){var T=k.map(function(D,V){var U,Q,B,$=O[V],Z={onerror:null,onsuccess:null};return p.type==="delete"?v.fire.call(Z,D,$,S):p.type==="add"||$===void 0?(U=g.fire.call(Z,D,p.values[V],S),D==null&&U!=null&&(p.keys[V]=D=U,i.outbound||se(p.values[V],i.keyPath,D))):(U=ri($,p.values[V]),(Q=y.fire.call(Z,U,D,$,S))&&(B=p.values[V],Object.keys(Q).forEach(function(J){N(B,J)?B[J]=Q[J]:se(B,J,Q[J])}))),Z});return r.mutate(p).then(function(D){for(var V=D.failures,U=D.results,Q=D.numFailures,D=D.lastResult,B=0;B<k.length;++B){var $=(U||k)[B],Z=T[B];$==null?Z.onerror&&Z.onerror(V[B]):Z.onsuccess&&Z.onsuccess(p.type==="put"&&O[B]?p.values[B]:$)}return{failures:V,results:U,numFailures:Q,lastResult:D}}).catch(function(D){return T.forEach(function(V){return V.onerror&&V.onerror(D)}),Promise.reject(D)})})}}})}})}};function Ui(e,n,r){try{if(!n||n.keys.length<e.length)return null;for(var i=[],o=0,c=0;o<n.keys.length&&c<e.length;++o)De(n.keys[o],e[c])===0&&(i.push(r?_e(n.values[o]):n.values[o]),++c);return i.length===e.length?i:null}catch{return null}}var ro={stack:"dbcore",level:-1,create:function(e){return{table:function(n){var r=e.table(n);return s(s({},r),{getMany:function(i){if(!i.cache)return r.getMany(i);var o=Ui(i.keys,i.trans._cache,i.cache==="clone");return o?te.resolve(o):r.getMany(i).then(function(c){return i.trans._cache={keys:i.keys,values:i.cache==="clone"?_e(c):c},c})},mutate:function(i){return i.type!=="add"&&(i.trans._cache=null),r.mutate(i)}})}}}};function Gi(e,n){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!n.schema.primaryKey.outbound}function Wi(e,n){switch(e){case"query":return n.values&&!n.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var io={stack:"dbcore",level:0,name:"Observability",create:function(e){var n=e.schema.name,r=new wt(e.MIN_KEY,e.MAX_KEY);return s(s({},e),{transaction:function(i,o,c){if(ce.subscr&&o!=="readonly")throw new ee.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ce.querier));return e.transaction(i,o,c)},table:function(i){var o=e.table(i),c=o.schema,d=c.primaryKey,p=c.indexes,v=d.extractKey,g=d.outbound,y=d.autoIncrement&&p.filter(function(b){return b.compound&&b.keyPath.includes(d.keyPath)}),I=s(s({},o),{mutate:function(b){function _(J){return J="idb://".concat(n,"/").concat(i,"/").concat(J),D[J]||(D[J]=new wt)}var S,k,O,T=b.trans,D=b.mutatedParts||(b.mutatedParts={}),V=_(""),U=_(":dels"),Q=b.type,Z=b.type==="deleteRange"?[b.range]:b.type==="delete"?[b.keys]:b.values.length<50?[ii(d,b).filter(function(J){return J}),b.values]:[],B=Z[0],$=Z[1],Z=b.trans._cache;return m(B)?(V.addKeys(B),(Z=Q==="delete"||B.length===$.length?Ui(B,Z):null)||U.addKeys(B),(Z||$)&&(S=_,k=Z,O=$,c.indexes.forEach(function(J){var ie=S(J.name||"");function xe(Oe){return Oe!=null?J.extractKey(Oe):null}function Ce(Oe){return J.multiEntry&&m(Oe)?Oe.forEach(function(Dt){return ie.addKey(Dt)}):ie.addKey(Oe)}(k||O).forEach(function(Oe,_t){var Se=k&&xe(k[_t]),_t=O&&xe(O[_t]);De(Se,_t)!==0&&(Se!=null&&Ce(Se),_t!=null&&Ce(_t))})}))):B?($={from:($=B.lower)!==null&&$!==void 0?$:e.MIN_KEY,to:($=B.upper)!==null&&$!==void 0?$:e.MAX_KEY},U.add($),V.add($)):(V.add(r),U.add(r),c.indexes.forEach(function(J){return _(J.name).add(r)})),o.mutate(b).then(function(J){return!B||b.type!=="add"&&b.type!=="put"||(V.addKeys(J.results),y&&y.forEach(function(ie){for(var xe=b.values.map(function(Se){return ie.extractKey(Se)}),Ce=ie.keyPath.findIndex(function(Se){return Se===d.keyPath}),Oe=0,Dt=J.results.length;Oe<Dt;++Oe)xe[Oe][Ce]=J.results[Oe];_(ie.name).addKeys(xe)})),T.mutatedParts=hr(T.mutatedParts||{},D),J})}}),p=function(_){var S=_.query,_=S.index,S=S.range;return[_,new wt((_=S.lower)!==null&&_!==void 0?_:e.MIN_KEY,(S=S.upper)!==null&&S!==void 0?S:e.MAX_KEY)]},C={get:function(b){return[d,new wt(b.key)]},getMany:function(b){return[d,new wt().addKeys(b.keys)]},count:p,query:p,openCursor:p};return f(C).forEach(function(b){I[b]=function(_){var S=ce.subscr,k=!!S,O=Gi(ce,o)&&Wi(b,_)?_.obsSet={}:S;if(k){var T=function($){return $="idb://".concat(n,"/").concat(i,"/").concat($),O[$]||(O[$]=new wt)},D=T(""),V=T(":dels"),S=C[b](_),k=S[0],S=S[1];if((b==="query"&&k.isPrimaryKey&&!_.values?V:T(k.name||"")).add(S),!k.isPrimaryKey){if(b!=="count"){var U=b==="query"&&g&&_.values&&o.query(s(s({},_),{values:!1}));return o[b].apply(this,arguments).then(function($){if(b==="query"){if(g&&_.values)return U.then(function(xe){return xe=xe.result,D.addKeys(xe),$});var Z=_.values?$.result.map(v):$.result;(_.values?D:V).addKeys(Z)}else if(b==="openCursor"){var J=$,ie=_.values;return J&&Object.create(J,{key:{get:function(){return V.addKey(J.primaryKey),J.key}},primaryKey:{get:function(){var xe=J.primaryKey;return V.addKey(xe),xe}},value:{get:function(){return ie&&D.addKey(J.primaryKey),J.value}}})}return $})}V.add(r)}}return o[b].apply(this,arguments)}}),I}})}};function $i(e,n,r){if(r.numFailures===0)return n;if(n.type==="deleteRange")return null;var i=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;return r.numFailures===i?null:(n=s({},n),m(n.keys)&&(n.keys=n.keys.filter(function(o,c){return!(c in r.failures)})),"values"in n&&m(n.values)&&(n.values=n.values.filter(function(o,c){return!(c in r.failures)})),n)}function ai(e,n){return r=e,((i=n).lower===void 0||(i.lowerOpen?0<De(r,i.lower):0<=De(r,i.lower)))&&(e=e,(n=n).upper===void 0||(n.upperOpen?De(e,n.upper)<0:De(e,n.upper)<=0));var r,i}function Yi(e,n,C,i,o,c){if(!C||C.length===0)return e;var d=n.query.index,v=d.multiEntry,g=n.query.range,y=i.schema.primaryKey.extractKey,I=d.extractKey,p=(d.lowLevelIndex||d).extractKey,C=C.reduce(function(b,_){var S=b,k=[];if(_.type==="add"||_.type==="put")for(var O=new wt,T=_.values.length-1;0<=T;--T){var D,V=_.values[T],U=y(V);O.hasKey(U)||(D=I(V),(v&&m(D)?D.some(function(J){return ai(J,g)}):ai(D,g))&&(O.addKey(U),k.push(V)))}switch(_.type){case"add":var Q=new wt().addKeys(n.values?b.map(function(ie){return y(ie)}):b),S=b.concat(n.values?k.filter(function(ie){return ie=y(ie),!Q.hasKey(ie)&&(Q.addKey(ie),!0)}):k.map(function(ie){return y(ie)}).filter(function(ie){return!Q.hasKey(ie)&&(Q.addKey(ie),!0)}));break;case"put":var B=new wt().addKeys(_.values.map(function(ie){return y(ie)}));S=b.filter(function(ie){return!B.hasKey(n.values?y(ie):ie)}).concat(n.values?k:k.map(function(ie){return y(ie)}));break;case"delete":var $=new wt().addKeys(_.keys);S=b.filter(function(ie){return!$.hasKey(n.values?y(ie):ie)});break;case"deleteRange":var Z=_.range;S=b.filter(function(ie){return!ai(y(ie),Z)})}return S},e);return C===e?e:(C.sort(function(b,_){return De(p(b),p(_))||De(y(b),y(_))}),n.limit&&n.limit<1/0&&(C.length>n.limit?C.length=n.limit:e.length===n.limit&&C.length<n.limit&&(o.dirty=!0)),c?Object.freeze(C):C)}function Ji(e,n){return De(e.lower,n.lower)===0&&De(e.upper,n.upper)===0&&!!e.lowerOpen==!!n.lowerOpen&&!!e.upperOpen==!!n.upperOpen}function ao(e,n){return(function(r,i,o,c){if(r===void 0)return i!==void 0?-1:0;if(i===void 0)return 1;if((i=De(r,i))===0){if(o&&c)return 0;if(o)return 1;if(c)return-1}return i})(e.lower,n.lower,e.lowerOpen,n.lowerOpen)<=0&&0<=(function(r,i,o,c){if(r===void 0)return i!==void 0?1:0;if(i===void 0)return-1;if((i=De(r,i))===0){if(o&&c)return 0;if(o)return-1;if(c)return 1}return i})(e.upper,n.upper,e.upperOpen,n.upperOpen)}function oo(e,n,r,i){e.subscribers.add(r),i.addEventListener("abort",function(){var o,c;e.subscribers.delete(r),e.subscribers.size===0&&(o=e,c=n,setTimeout(function(){o.subscribers.size===0&&Re(c,o)},3e3))})}var so={stack:"dbcore",level:0,name:"Cache",create:function(e){var n=e.schema.name;return s(s({},e),{transaction:function(r,i,o){var c,d,v=e.transaction(r,i,o);return i==="readwrite"&&(d=(c=new AbortController).signal,o=function(g){return function(){if(c.abort(),i==="readwrite"){for(var y=new Set,I=0,p=r;I<p.length;I++){var C=p[I],b=un["idb://".concat(n,"/").concat(C)];if(b){var _=e.table(C),S=b.optimisticOps.filter(function(ie){return ie.trans===v});if(v._explicit&&g&&v.mutatedParts)for(var k=0,O=Object.values(b.queries.query);k<O.length;k++)for(var T=0,D=(Q=O[k]).slice();T<D.length;T++)Xr((B=D[T]).obsSet,v.mutatedParts)&&(Re(Q,B),B.subscribers.forEach(function(ie){return y.add(ie)}));else if(0<S.length){b.optimisticOps=b.optimisticOps.filter(function(ie){return ie.trans!==v});for(var V=0,U=Object.values(b.queries.query);V<U.length;V++)for(var Q,B,$,Z=0,J=(Q=U[V]).slice();Z<J.length;Z++)(B=J[Z]).res!=null&&v.mutatedParts&&(g&&!B.dirty?($=Object.isFrozen(B.res),$=Yi(B.res,B.req,S,_,B,$),B.dirty?(Re(Q,B),B.subscribers.forEach(function(ie){return y.add(ie)})):$!==B.res&&(B.res=$,B.promise=te.resolve({result:$}))):(B.dirty&&Re(Q,B),B.subscribers.forEach(function(ie){return y.add(ie)})))}}}y.forEach(function(ie){return ie()})}}},v.addEventListener("abort",o(!1),{signal:d}),v.addEventListener("error",o(!1),{signal:d}),v.addEventListener("complete",o(!0),{signal:d})),v},table:function(r){var i=e.table(r),o=i.schema.primaryKey;return s(s({},i),{mutate:function(c){var d=ce.trans;if(o.outbound||d.db._options.cache==="disabled"||d.explicit||d.idbtrans.mode!=="readwrite")return i.mutate(c);var v=un["idb://".concat(n,"/").concat(r)];return v?(d=i.mutate(c),c.type!=="add"&&c.type!=="put"||!(50<=c.values.length||ii(o,c).some(function(g){return g==null}))?(v.optimisticOps.push(c),c.mutatedParts&&vr(c.mutatedParts),d.then(function(g){0<g.numFailures&&(Re(v.optimisticOps,c),(g=$i(0,c,g))&&v.optimisticOps.push(g),c.mutatedParts&&vr(c.mutatedParts))}),d.catch(function(){Re(v.optimisticOps,c),c.mutatedParts&&vr(c.mutatedParts)})):d.then(function(g){var y=$i(0,s(s({},c),{values:c.values.map(function(I,p){var C;return g.failures[p]?I:(I=(C=o.keyPath)!==null&&C!==void 0&&C.includes(".")?_e(I):s({},I),se(I,o.keyPath,g.results[p]),I)})}),g);v.optimisticOps.push(y),queueMicrotask(function(){return c.mutatedParts&&vr(c.mutatedParts)})}),d):i.mutate(c)},query:function(c){if(!Gi(ce,i)||!Wi("query",c))return i.query(c);var d=((y=ce.trans)===null||y===void 0?void 0:y.db._options.cache)==="immutable",p=ce,v=p.requery,g=p.signal,y=(function(_,S,k,O){var T=un["idb://".concat(_,"/").concat(S)];if(!T)return[];if(!(S=T.queries[k]))return[null,!1,T,null];var D=S[(O.query?O.query.index.name:null)||""];if(!D)return[null,!1,T,null];switch(k){case"query":var V=D.find(function(U){return U.req.limit===O.limit&&U.req.values===O.values&&Ji(U.req.query.range,O.query.range)});return V?[V,!0,T,D]:[D.find(function(U){return("limit"in U.req?U.req.limit:1/0)>=O.limit&&(!O.values||U.req.values)&&ao(U.req.query.range,O.query.range)}),!1,T,D];case"count":return V=D.find(function(U){return Ji(U.req.query.range,O.query.range)}),[V,!!V,T,D]}})(n,r,"query",c),I=y[0],p=y[1],C=y[2],b=y[3];return I&&p?I.obsSet=c.obsSet:(p=i.query(c).then(function(_){var S=_.result;if(I&&(I.res=S),d){for(var k=0,O=S.length;k<O;++k)Object.freeze(S[k]);Object.freeze(S)}else _.result=_e(S);return _}).catch(function(_){return b&&I&&Re(b,I),Promise.reject(_)}),I={obsSet:c.obsSet,promise:p,subscribers:new Set,type:"query",req:c,dirty:!1},b?b.push(I):(b=[I],(C=C||(un["idb://".concat(n,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[c.query.index.name||""]=b)),oo(I,b,v,g),I.promise.then(function(_){return{result:Yi(_.result,c,C?.optimisticOps,i,I,d)}})}})}})}};function gr(e,n){return new Proxy(e,{get:function(r,i,o){return i==="db"?n:Reflect.get(r,i,o)}})}var Wt=(ft.prototype.version=function(e){if(isNaN(e)||e<.1)throw new ee.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(Ja),r.stores({}),this._state.autoSchema=!1,r)},ft.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||ce.letThrough||this._vip)?e():new te(function(r,i){if(n._state.openComplete)return i(new ee.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._state.autoOpen)return void i(new ee.DatabaseClosed);n.open().catch(ye)}n._state.dbReadyPromise.then(r,i)}).then(e)},ft.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,o=e.name;return o&&this.unuse({stack:n,name:o}),e=this._middlewares[n]||(this._middlewares[n]=[]),e.push({stack:n,create:r,level:i??10,name:o}),e.sort(function(c,d){return c.level-d.level}),this},ft.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(o){return i?o.create!==i:!!r&&o.name!==r})),this},ft.prototype.open=function(){var e=this;return sn(Et,function(){return eo(e)})},ft.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,n=yn.indexOf(this);if(0<=n&&yn.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new te(function(r){e.dbReadyResolve=r}),e.openCanceller=new te(function(r,i){e.cancelOpen=i}))},ft.prototype.close=function(r){var n=(r===void 0?{disableAutoOpen:!0}:r).disableAutoOpen,r=this._state;n?(r.isBeingOpened&&r.cancelOpen(new ee.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new ee.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},ft.prototype.delete=function(e){var n=this;e===void 0&&(e={disableAutoOpen:!0});var r=0<arguments.length&&typeof arguments[0]!="object",i=this._state;return new te(function(o,c){function d(){n.close(e);var v=n._deps.indexedDB.deleteDatabase(n.name);v.onsuccess=tt(function(){var g,y,I;g=n._deps,y=n.name,I=g.indexedDB,g=g.IDBKeyRange,Yr(I)||y===tr||$r(I,g).delete(y).catch(ye),o()}),v.onerror=zt(c),v.onblocked=n._fireOnBlocked}if(r)throw new ee.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(d):d()})},ft.prototype.backendDB=function(){return this.idbdb},ft.prototype.isOpen=function(){return this.idbdb!==null},ft.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},ft.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ft.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ft.prototype,"tables",{get:function(){var e=this;return f(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),ft.prototype.transaction=function(){var e=(function(n,r,i){var o=arguments.length;if(o<2)throw new ee.InvalidArgument("Too few arguments");for(var c=new Array(o-1);--o;)c[o-1]=arguments[o];return i=c.pop(),[n,ue(c),i]}).apply(this,arguments);return this._transaction.apply(this,e)},ft.prototype._transaction=function(e,n,r){var i=this,o=ce.trans;o&&o.db===this&&e.indexOf("!")===-1||(o=null);var c,d,v=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(d=n.map(function(y){if(y=y instanceof i.Table?y.name:y,typeof y!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return y}),e=="r"||e===Rr)c=Rr;else{if(e!="rw"&&e!=Vr)throw new ee.InvalidArgument("Invalid transaction mode: "+e);c=Vr}if(o){if(o.mode===Rr&&c===Vr){if(!v)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&d.forEach(function(y){if(o&&o.storeNames.indexOf(y)===-1){if(!v)throw new ee.SubTransaction("Table "+y+" not included in parent transaction.");o=null}}),v&&o&&!o.active&&(o=null)}}catch(y){return o?o._promise(null,function(I,p){p(y)}):dt(y)}var g=(function y(I,p,C,b,_){return te.resolve().then(function(){var S=ce.transless||ce,k=I._createTransaction(p,C,I._dbSchema,b);if(k.explicit=!0,S={trans:k,transless:S},b)k.idbtrans=b.idbtrans;else try{k.create(),k.idbtrans._explicit=!0,I._state.PR1398_maxLoop=3}catch(D){return D.name===Te.InvalidState&&I.isOpen()&&0<--I._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),I.close({disableAutoOpen:!1}),I.open().then(function(){return y(I,p,C,null,_)})):dt(D)}var O,T=ot(_);return T&&mn(),S=te.follow(function(){var D;(O=_.call(k,k))&&(T?(D=Jt.bind(null,null),O.then(D,D)):typeof O.next=="function"&&typeof O.throw=="function"&&(O=ni(O)))},S),(O&&typeof O.then=="function"?te.resolve(O).then(function(D){return k.active?D:dt(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):S.then(function(){return O})).then(function(D){return b&&k._resolve(),k._completion.then(function(){return D})}).catch(function(D){return k._reject(D),dt(D)})})}).bind(null,this,c,d,o,r);return o?o._promise(c,g,"lock"):ce.trans?sn(ce.transless,function(){return i._whenReady(g)}):this._whenReady(g)},ft.prototype.table=function(e){if(!N(this._allTables,e))throw new ee.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},ft);function ft(e,n){var r=this;this._middlewares={},this.verno=0;var i=ft.dependencies;this._options=n=s({addons:ft.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},i=n.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o,c,d,v,g,y={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ye,dbReadyPromise:null,cancelOpen:ye,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};y.dbReadyPromise=new te(function(p){y.dbReadyResolve=p}),y.openCanceller=new te(function(p,C){y.cancelOpen=C}),this._state=y,this.name=e,this.on=Nn(this,"populate","blocked","versionchange","close",{ready:[Ze,ye]}),this.once=function(p,C){var b=function(){for(var _=[],S=0;S<arguments.length;S++)_[S]=arguments[S];r.on(p).unsubscribe(b),C.apply(r,_)};return r.on(p,b)},this.on.ready.subscribe=j(this.on.ready.subscribe,function(p){return function(C,b){ft.vip(function(){var _,S=r._state;S.openComplete?(S.dbOpenError||te.resolve().then(C),b&&p(C)):S.onReadyBeingFired?(S.onReadyBeingFired.push(C),b&&p(C)):(p(C),_=r,b||p(function k(){_.on.ready.unsubscribe(C),_.on.ready.unsubscribe(k)}))})}}),this.Collection=(o=this,Mn(Ba.prototype,function(O,k){this.db=o;var b=ki,_=null;if(k)try{b=k()}catch(T){_=T}var S=O._ctx,k=S.table,O=k.hook.reading.fire;this._ctx={table:k,index:S.index,isPrimKey:!S.index||k.schema.primKey.keyPath&&S.index===k.schema.primKey.name,range:b,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:_,or:S.or,valueMapper:O!==qe?O:null}})),this.Table=(c=this,Mn(Ei.prototype,function(p,C,b){this.db=c,this._tx=b,this.name=p,this.schema=C,this.hook=c._allTables[p]?c._allTables[p].hook:Nn(null,{creating:[ct,ye],reading:[pt,qe],updating:[Qe,ye],deleting:[rt,ye]})})),this.Transaction=(d=this,Mn(Ga.prototype,function(p,C,b,_,S){var k=this;p!=="readonly"&&C.forEach(function(O){O=(O=b[O])===null||O===void 0?void 0:O.yProps,O&&(C=C.concat(O.map(function(T){return T.updatesTable})))}),this.db=d,this.mode=p,this.storeNames=C,this.schema=b,this.chromeTransactionDurability=_,this.idbtrans=null,this.on=Nn(this,"complete","error","abort"),this.parent=S||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new te(function(O,T){k._resolve=O,k._reject=T}),this._completion.then(function(){k.active=!1,k.on.complete.fire()},function(O){var T=k.active;return k.active=!1,k.on.error.fire(O),k.parent?k.parent._reject(O):T&&k.idbtrans&&k.idbtrans.abort(),dt(O)})})),this.Version=(v=this,Mn(Za.prototype,function(p){this.db=v,this._cfg={version:p,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(g=this,Mn(Li.prototype,function(p,C,b){if(this.db=g,this._ctx={table:p,index:C===":id"?null:C,or:b},this._cmp=this._ascending=De,this._descending=function(_,S){return De(S,_)},this._max=function(_,S){return 0<De(_,S)?_:S},this._min=function(_,S){return De(_,S)<0?_:S},this._IDBKeyRange=g._deps.IDBKeyRange,!this._IDBKeyRange)throw new ee.MissingAPI})),this.on("versionchange",function(p){0<p.newVersion?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(p){!p.newVersion||p.newVersion<p.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(p.oldVersion/10))}),this._maxKey=Vn(n.IDBKeyRange),this._createTransaction=function(p,C,b,_){return new r.Transaction(p,C,b,r._options.chromeTransactionDurability,_)},this._fireOnBlocked=function(p){r.on("blocked").fire(p),yn.filter(function(C){return C.name===r.name&&C!==r&&!C._state.vcFired}).map(function(C){return C.on("versionchange").fire(p)})},this.use(ro),this.use(so),this.use(io),this.use(to),this.use(no);var I=new Proxy(this,{get:function(p,C,b){if(C==="_vip")return!0;if(C==="table")return function(S){return gr(r.table(S),I)};var _=Reflect.get(p,C,b);return _ instanceof Ei?gr(_,I):C==="tables"?_.map(function(S){return gr(S,I)}):C==="_createTransaction"?function(){return gr(_.apply(this,arguments),I)}:_}});this.vip=I,i.forEach(function(p){return p(r)})}var mr,Lt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",lo=(oi.prototype.subscribe=function(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})},oi.prototype[Lt]=function(){return this},oi);function oi(e){this._subscribe=e}try{mr={indexedDB:h.indexedDB||h.mozIndexedDB||h.webkitIndexedDB||h.msIndexedDB,IDBKeyRange:h.IDBKeyRange||h.webkitIDBKeyRange}}catch{mr={indexedDB:null,IDBKeyRange:null}}function Qi(e){var n,r=!1,i=new lo(function(o){var c=ot(e),d,v=!1,g={},y={},I={get closed(){return v},unsubscribe:function(){v||(v=!0,d&&d.abort(),p&&Zt.storagemutated.unsubscribe(b))}};o.start&&o.start(I);var p=!1,C=function(){return Lr(_)},b=function(S){hr(g,S),Xr(y,g)&&C()},_=function(){var S,k,O;!v&&mr.indexedDB&&(g={},S={},d&&d.abort(),d=new AbortController,O=(function(T){var D=pn();try{c&&mn();var V=Yt(e,T);return V=c?V.finally(Jt):V}finally{D&&gn()}})(k={subscr:S,signal:d.signal,requery:C,querier:e,trans:null}),Promise.resolve(O).then(function(T){r=!0,n=T,v||k.signal.aborted||(g={},(function(D){for(var V in D)if(N(D,V))return;return 1})(y=S)||p||(Zt(Rn,b),p=!0),Lr(function(){return!v&&o.next&&o.next(T)}))},function(T){r=!1,["DatabaseClosedError","AbortError"].includes(T?.name)||v||Lr(function(){v||o.error&&o.error(T)})}))};return setTimeout(C,0),I});return i.hasValue=function(){return r},i.getValue=function(){return n},i}var dn=Wt;function si(e){var n=en;try{en=!0,Zt.storagemutated.fire(e),ti(e,!0)}finally{en=n}}E(dn,s(s({},Ge),{delete:function(e){return new dn(e,{addons:[]}).delete()},exists:function(e){return new dn(e,{addons:[]}).open().then(function(n){return n.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return n=dn.dependencies,r=n.indexedDB,n=n.IDBKeyRange,(Yr(r)?Promise.resolve(r.databases()).then(function(i){return i.map(function(o){return o.name}).filter(function(o){return o!==tr})}):$r(r,n).toCollection().primaryKeys()).then(e)}catch{return dt(new ee.MissingAPI)}var n,r},defineClass:function(){return function(e){P(this,e)}},ignoreTransaction:function(e){return ce.trans?sn(ce.transless,e):e()},vip:Jr,async:function(e){return function(){try{var n=ni(e.apply(this,arguments));return n&&typeof n.then=="function"?n:te.resolve(n)}catch(r){return dt(r)}}},spawn:function(e,n,r){try{var i=ni(e.apply(r,n||[]));return i&&typeof i.then=="function"?i:te.resolve(i)}catch(o){return dt(o)}},currentTransaction:{get:function(){return ce.trans||null}},waitFor:function(e,n){return n=te.resolve(typeof e=="function"?dn.ignoreTransaction(e):e).timeout(n||6e4),ce.trans?ce.trans.waitFor(n):n},Promise:te,debug:{get:function(){return et},set:function(e){At(e)}},derive:M,extend:P,props:E,override:j,Events:Nn,on:Zt,liveQuery:Qi,extendObservabilitySet:hr,getByKeyPath:re,setByKeyPath:se,delByKeyPath:function(e,n){typeof n=="string"?se(e,n,void 0):"length"in n&&[].map.call(n,function(r){se(e,r,void 0)})},shallowClone:me,deepClone:_e,getObjectDiff:ri,cmp:De,asap:le,minKey:-1/0,addons:[],connections:yn,errnames:Te,dependencies:mr,cache:un,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,n,r){return e+n/Math.pow(10,2*r)})})),dn.maxKey=Vn(dn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Zt(Rn,function(e){en||(e=new CustomEvent(zr,{detail:e}),en=!0,dispatchEvent(e),en=!1)}),addEventListener(zr,function(e){e=e.detail,en||si(e)}));var Sn,en=!1,Xi=function(){};return typeof BroadcastChannel<"u"&&((Xi=function(){(Sn=new BroadcastChannel(zr)).onmessage=function(e){return e.data&&si(e.data)}})(),typeof Sn.unref=="function"&&Sn.unref(),Zt(Rn,function(e){en||Sn.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Wt.disableBfCache&&e.persisted){et&&console.debug("Dexie: handling persisted pagehide"),Sn?.close();for(var n=0,r=yn;n<r.length;n++)r[n].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Wt.disableBfCache&&e.persisted&&(et&&console.debug("Dexie: handling persisted pageshow"),Xi(),si({all:new wt(-1/0,[[]])}))})),te.rejectionMapper=function(e,n){return!e||e instanceof pe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!vt[e.name]?e:(n=new vt[e.name](n||e.message,e),"stack"in e&&R(n,"stack",{get:function(){return this.inner.stack}}),n)},At(et),s(Wt,Object.freeze({__proto__:null,Dexie:Wt,liveQuery:Qi,Entity:Ci,cmp:De,PropModification:Dn,replacePrefix:function(e,n){return new Dn({replacePrefix:[e,n]})},add:function(e){return new Dn({add:e})},remove:function(e){return new Dn({remove:e})},default:Wt,RangeSet:wt,mergeRanges:zn,rangesOverlap:zi}),{default:Wt}),Wt})})(kr)),kr.exports}var Xs=Qs();const fi=ss(Xs),ga=Symbol.for("Dexie"),Ar=globalThis[ga]||(globalThis[ga]=fi);if(fi.semVer!==Ar.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${fi.semVer} and ${Ar.semVer}`);const{liveQuery:Gu,mergeRanges:Wu,rangesOverlap:$u,RangeSet:Yu,cmp:Ju,Entity:Qu,PropModification:Xu,replacePrefix:Zu,add:ed,remove:td,DexieYProvider:nd}=Ar,Wn="current";class Zs extends Ar{uprnSelections;areaSelections;dataSelections;userDownloads;constructor(){super("app-db2"),this.version(2).stores({uprnSelections:"&id",areaSelections:"++id, layerId, *areaIds",dataSelections:"++id, layerId, *fields",userDownloads:"++id, &localId, createdAt"}),this.on("populate",async t=>{if(console.log("[db] Populating database with initial data"),await t.table("uprnSelections").get(Wn)){console.log("[db] Initial UPRN selection already exists");return}await t.table("uprnSelections").add({id:"current",areas:null,data:[]}),console.log("[db] Initial UPRN selection created")})}}const an=new Zs,Pa=async()=>await an.uprnSelections.get(Wn),Kn=async w=>{let t=await Pa();t||(t={id:Wn,areas:null,data:[]},await an.uprnSelections.add(t)),console.log("[db] Updating UPRN selection with patch:",w,"current:",t),await an.uprnSelections.update(Wn,w)},el=async()=>{await an.uprnSelections.put({id:Wn,areas:null,data:[]})},tl=async(w,t,a)=>await an.userDownloads.add({localId:w,areaSelection:t,dataSelections:a,status:tn.Pending,createdAt:Date.now()}),nl=async(w,t,a,s)=>{const u={};t!==void 0&&(u.externalId=t),a!==void 0&&(u.areaSelection=a),s!==void 0&&(u.dataSelections=s),Object.keys(u).length!==0&&await an.userDownloads.where("localId").equals(w).modify(u)},rl=async()=>await an.userDownloads.orderBy("createdAt").reverse().toArray(),il=async w=>await an.userDownloads.where("localId").equals(w).delete();class al{#e=ne(He(new xt));constructor(){this.#t()}addDownload(t){console.log("[downloads-store] Adding download:",t),l(this.#e).set(t.localId,t),tl(t.localId,t.areaSelection,t.dataSelections)}updateDownloadStatus(t){console.log("[downloads-store] Updating download status:",t),l(this.#e).set(t.localId,{...t}),nl(t.localId,t.externalId,t.areaSelection,t.dataSelections)}removeDownload(t){l(this.#e).delete(t),il(t)}getDownloads(){return Array.from(l(this.#e).values())}async#t(){const t=await rl();!t||t.length===0||(console.log("Loaded downloads from DB:",t),t.forEach(a=>{l(this.#e).set(a.localId,{localId:a.localId,status:tn.Pending,areaSelection:a.areaSelection,dataSelections:a.dataSelections})}))}}const qn=new al;function ol(w,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]];Pn(w,Ct({name:"download"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Tn(m,t,"default",{}),F(u,f)},$$slots:{default:!0}}))}var sl=oe('<div class="data-item svelte-v4uih6"><span class="data-name svelte-v4uih6"> </span> <div class="data-actions svelte-v4uih6"><!></div></div>');function hi(w,t){const a=Ne(t,"title",3,"");Tr(w,{class:"data-item-card",children:(s,u)=>{var h=sl(),f=X(h),m=X(f,!0);Y(f);var P=he(f,2),x=X(P);Ye(x,()=>t.children??$e),Y(P),Y(h),ht(()=>{yi(f,"title",a()),Tt(m,a())}),F(s,h)},$$slots:{default:!0}})}var ll=oe("<!> <!> <!> <!>",1),cl=oe('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),ul=oe('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),dl=oe('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function fl(w,t){Me(t,!0);let a=ne(He(new Set));const s=fe(()=>qn.getDownloads()),u={completed:{color:"#059669",text:"Completed",icon:Vo},"in-progress":{color:"#2563eb",text:"In Progress",icon:Ro},failed:{color:"#dc2626",text:"Failed",icon:Lo},pending:{color:"#6b7280",text:"Pending",icon:Mo}};xn(()=>{const H=setInterval(()=>{h()},5e3);return()=>{clearInterval(H)}}),Ue(()=>{if(!l(s)||l(s).length<=0||!t.uprnDownloadService)return;(async()=>{for(const L of l(s)){if(L.externalId||L.status!==tn.Pending)continue;const z={exports:{areaSelectionLayer:{remoteId:L.areaSelection.layerId,areas:L.areaSelection.areaFieldInfos.map(W=>W.code)},dataSelectionLayers:L.dataSelections.map(W=>({remoteId:W.layerId,fields:W.fields.filter(le=>!t.fieldsToHide||!t.fieldsToHide.has(le))}))}};console.log("[downloads-menu] Submitting download request:",z);const j=await t.uprnDownloadService.requestJob(z);if(!j||j.type===Ys.Error){console.error("[downloads-menu] Failed to submit download request.",j);continue}L.externalId=j.guid,L.status=tn.InProgress,qn.updateDownloadStatus(L)}})()});async function h(){if(l(s).length<=0||!t.uprnDownloadService)return;const H={jobs:l(s).filter(z=>z.externalId).map(z=>z.externalId)},L=await t.uprnDownloadService.requestJobStatuses(H);if(!L){console.error("[downloads-menu] Failed to get job statuses.",L);return}for(const z of L.jobs){const j=l(s).find(W=>W.externalId===z.guid);if(!j){console.warn("[downloads-menu] Received job status for unknown download:",z.guid);continue}switch(z.status.type){case xr.Submitted:case xr.Processing:j.status=tn.InProgress;break;case xr.Completed:j.status=tn.Completed;break;case xr.Error:j.status=tn.Failed;break;default:console.warn("[downloads-menu] Unknown job status type:",z.status.type);break}qn.updateDownloadStatus(j)}}function f(H){qn.removeDownload(H)}async function m(H){try{await navigator.clipboard.writeText(H),K(a,new Set(l(a)).add(H),!0),Un.success("URL copied to clipboard"),setTimeout(()=>{const L=new Set(l(a));L.delete(H),K(a,L,!0)},2e3)}catch(L){console.error("Failed to copy URL:",L),Un.error("Failed to copy URL to clipboard")}}function P(H){return u[H]?.color??u.pending.color}function x(H){return u[H]?.text??u.pending.text}function A(H){return u[H]?.icon??u.pending.icon}function N(H){return t.uprnDownloadService.getDownloadUrl(H)}var E=dl(),q=he(X(E),2);{var R=H=>{var L=cl(),z=G(L);Bt(z,21,()=>l(s),Cn,(le,re)=>{{let se=fe(()=>l(re).externalId?l(re).externalId:"Pending...");hi(le,{get title(){return l(se)},children:(me,Ae)=>{var ue=ll(),we=G(ue);{let ke=fe(()=>P(l(re).status)),Re=fe(()=>x(l(re).status));Pt(we,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${l(ke)??""}`},get title(){return l(Re)},disabled:!0,children:(be,Pe)=>{const ot=fe(()=>A(l(re).status));var st=ae(),pe=G(st);{let Be=fe(()=>l(re).status==="in-progress"?"spinning":"");Ee(pe,()=>l(ot),(de,ve)=>{ve(de,{size:14,get class(){return l(Be)}})})}F(be,st)},$$slots:{default:!0}})}var Ie=he(we,2);{var _e=ke=>{Pt(ke,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>m(N(l(re).externalId)),title:"Copy URL to clipboard",children:(Re,be)=>{var Pe=ae(),ot=G(Pe);{var st=Be=>{Do(Be,{size:14})},pe=Be=>{No(Be,{size:14})};ge(ot,Be=>{l(a).has(N(l(re).externalId))?Be(st):Be(pe,!1)})}F(Re,Pe)},$$slots:{default:!0}})};ge(Ie,ke=>{l(re).externalId&&ke(_e)})}var Fe=he(Ie,2);{var ze=ke=>{Pt(ke,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(N(l(re).externalId),"_blank"),title:"Open download",children:(Re,be)=>{ol(Re,{})},$$slots:{default:!0}})};ge(Fe,ke=>{l(re).externalId&&l(re).status==="completed"&&ke(ze)})}var Je=he(Fe,2);Pt(Je,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>f(l(re).localId),title:"Remove from queue",children:(ke,Re)=>{hn();var be=In("Ã");F(ke,be)},$$slots:{default:!0}}),F(me,ue)},$$slots:{default:!0}})}}),Y(z);var j=he(z,2),W=X(j);Y(j),ht(()=>Tt(W,`${l(s).length??""} download(s) in queue`)),F(H,L)},M=H=>{var L=ul();F(H,L)};ge(q,H=>{l(s).length>0?H(R):H(M,!1)})}Y(E),F(w,E),Le()}function hl(w,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"m6 9 6 6 6-6"}]];Pn(w,Ct({name:"chevron-down"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Tn(m,t,"default",{}),F(u,f)},$$slots:{default:!0}}))}function vl(w,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"m15 18-6-6 6-6"}]];Pn(w,Ct({name:"chevron-left"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Tn(m,t,"default",{}),F(u,f)},$$slots:{default:!0}}))}function pl(w,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"m18 15-6-6-6 6"}]];Pn(w,Ct({name:"chevron-up"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Tn(m,t,"default",{}),F(u,f)},$$slots:{default:!0}}))}function gl(w,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];Pn(w,Ct({name:"menu"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Tn(m,t,"default",{}),F(u,f)},$$slots:{default:!0}}))}function ml(w,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];Pn(w,Ct({name:"trash"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Tn(m,t,"default",{}),F(u,f)},$$slots:{default:!0}}))}function yl(w,t){Me(t,!0);{let a=fe(()=>$n("size-7",t.class));Pt(w,{onclick:()=>t.clear(),variant:"destructive",get class(){return l(a)},title:"Clear all selections",children:(s,u)=>{ml(s,{})},$$slots:{default:!0}})}Le()}class bl{#e=ne(He(new xt));get dataSelections(){return l(this.#e)}set dataSelections(t){K(this.#e,t,!0)}addSelection(t){this.dataSelections.set(t.layerId,t)}updateSelection(t,a){const s=this.dataSelections.get(t);if(!s){console.warn(`[data-selection-store] no existing selection for layerId ${t}`);return}s.selectedFieldIds=new Nt(a),this.dataSelections.set(t,{...s})}addOrUpdateSelection(t,a){const s=this.dataSelections.get(t);if(s)s.selectedFieldIds=new Nt(a),this.dataSelections.set(t,{...s});else{const u={layerId:t,selectedFieldIds:new Nt(a)};this.dataSelections.set(t,u)}}removeSelection(t){this.dataSelections.delete(t)}getSelection(t){return this.dataSelections.get(t)}getAllSelections(){return Array.from(this.dataSelections.values())}clearSelections(){this.dataSelections.clear(),console.log("[data-selection-store] selections cleared.")}cleanup(){this.dataSelections.clear()}}var wl=oe('<div class="export-footer svelte-10dgoyk"><div class="export-footer__left svelte-10dgoyk"><p class="text-sm text-muted-foreground svelte-10dgoyk">Click "Export" to begin the download.</p></div> <div class="export-footer__right svelte-10dgoyk"><!> <!></div></div>');function _l(w,t){Me(t,!0);function a(){if(t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size<=0){Un.error("Please select at least one area to export.");return}if(t.dataSelectionStore.getAllSelections().length<=0){Un.error("Please select at least one data layer to export.");return}console.log("Starting export..."),(async()=>{const P=await t.areaSelectionInteractionStore.getAreaCodesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),x=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().map(([q,R],M)=>({id:q,code:P[M]})).toArray(),A={layerId:t.areaSelectionInteractionStore.selectionViewState.layerView?.layer.id||"",areaFieldInfos:x},N=t.dataSelectionStore.getAllSelections().map(q=>({layerId:q.layerId,fields:Array.from(q.selectedFieldIds)})),E=crypto.randomUUID();qn.addDownload({localId:E,status:tn.Pending,areaSelection:A,dataSelections:N}),t.onExportSuccess?.()})()}var s=wl(),u=he(X(s),2),h=X(u);yl(h,{class:"mr-4",get clear(){return t.clearSelections}});var f=he(h,2);Pt(f,{onclick:a,title:"Export",children:(m,P)=>{hn();var x=In("Export");F(m,x)},$$slots:{default:!0}}),Y(u),Y(s),F(w,s),Le()}class Sl{#e=ne(null);get ActiveLayer(){return l(this.#e)}set ActiveLayer(t){K(this.#e,t,!0)}}class xl{#e=ne(!1);get isLoaded(){return l(this.#e)}set isLoaded(t){K(this.#e,t,!0)}#t=ne(null);get data(){return l(this.#t)}set data(t){K(this.#t,t,!0)}#n=fe(()=>{const t=new xt;function a(s){t.set(s.id,s),s.type==="group"&&s.layers.forEach(h=>{a(h)})}return this.data&&this.data.layers.forEach(s=>{a(s)}),t});get dataLookup(){return l(this.#n)}set dataLookup(t){K(this.#n,t)}#r=ne(!1);get loading(){return l(this.#r)}set loading(t){K(this.#r,t,!0)}#i=ne(null);get error(){return l(this.#i)}set error(t){K(this.#i,t,!0)}async initializeAsync(t){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:a,itemId:s,proxy:u}=t;await this.configurePortalAsync(a,u),await this.loadwebmapAsync(s)}catch(a){console.error("Error initializing webmap:",a),this.error=a.message}finally{this.loading=!1}}}async configurePortalAsync(t,a){if(!t||(ra.portalUrl=t,console.log(ra),!a))return;const{addProxyRule:s}=vs;console.log("Adding proxy rule for portal traffic"),s({urlPrefix:a?.urlPrefix,proxyUrl:a?.proxyUrl})}async loadwebmapAsync(t){if(this.data)return;const a=new hs({id:t}),s=new fs({portalItem:a});this.data=s,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}function Il(w,t){w.stopPropagation(),t.onFilterClicked?.(t.layerId)}var kl=oe('<button title="Filter"><!></button>');function Cl(w,t){Me(t,!0);let a=ne(He(t.hasFiltersApplied?.(t.layerId)??!1));Ue(()=>{K(a,t.hasFiltersApplied?.(t.layerId)??!1,!0)});const s=fe(()=>l(a)?jo:Ho);var u=kl();let h;u.__click=[Il,t];var f=X(u);Gn(f,()=>l(s)),Y(u),ht(m=>{h=rn(u,1,"filter-btn svelte-k95pvd",null,h,m),yi(u,"aria-pressed",l(a))},[()=>({active:l(a)})]),F(w,u),Le()}Er(["click"]);var Al=oe('<ul class="selected-list"></ul> <p class="count svelte-81yb5c"> </p>',1),Ol=oe('<p class="no-selection svelte-81yb5c">No areas selected</p>'),Pl=oe("<!> <!>",1),Tl=oe('<ul></ul> <p class="count svelte-81yb5c"> </p>',1),El=oe('<p class="no-selection svelte-81yb5c">No data selected</p>'),Fl=oe('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function Dl(w,t){Me(t,!0);const a=Ne(t,"fieldFilterMenuStore",7);let s=ne(He([]));Ue(()=>{if(!t.areaSelectionInteractionStore){K(s,[],!0);return}if(!t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size){K(s,[],!0);return}(async()=>{const W=await t.areaSelectionInteractionStore.getAreaNamesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),le=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().toArray().map(([se,me])=>({id:se,handle:me})),re=[];for(let se=0;se<W.length;se++)re.push({name:W[se]||"Unknown Area",HighlightAreaInfo:le[se]});K(s,re,!0)})()});function u(j){const W=l(s).findIndex(le=>le.name===j);W!==-1&&t.areaSelectionInteractionStore.removeSelectedArea(l(s)[W]?.HighlightAreaInfo.id)}function h(j){console.log("[export-menu] Removing data selection for layerId:",j),t.dataSelectionStore.removeSelection(j),console.log("[export-menu] Current SelectedData:",ui(t.dataSelectionStore.getAllSelections()))}function f(j){if(a().ActiveLayer?.id===j){a().ActiveLayer=null;return}const W=t.webMapStore.dataLookup.get(j);if(!W){console.warn(`[export-menu] Layer with ID ${j} not found in web map store.`);return}a().ActiveLayer=W}function m(j){const W=t.dataSelectionStore.getSelection(j);return!(!W||!W.selectedFieldIds||W.selectedFieldIds.size===0||W.selectedFieldIds.size===t.webMapStore.dataLookup.get(j)?.fields?.length)}var P=Fl(),x=he(G(P),2),A=X(x),N=X(A,!0);Y(A);var E=he(A,4);{var q=j=>{var W=Al(),le=G(W);Bt(le,21,()=>l(s),Cn,(me,Ae)=>{hi(me,{get title(){return l(Ae).name},children:(ue,we)=>{Pt(ue,{variant:"ghost",size:"sm",class:"area-remove-btn",title:"Remove area",onclick:()=>u(l(Ae).name),children:(Ie,_e)=>{hn();var Fe=In("Ã");F(Ie,Fe)},$$slots:{default:!0}})},$$slots:{default:!0}})}),Y(le);var re=he(le,2),se=X(re);Y(re),ht(()=>Tt(se,`${l(s).length??""} area(s) selected`)),F(j,W)},R=j=>{var W=Ol();F(j,W)};ge(E,j=>{l(s).length>0?j(q):j(R,!1)})}Y(x);var M=he(x,2),H=he(X(M),2);{var L=j=>{var W=Tl(),le=G(W);Bt(le,21,()=>t.dataSelectionStore.getAllSelections(),Cn,(me,Ae)=>{{let ue=fe(()=>t.webMapStore.dataLookup.get(l(Ae).layerId)?.title??"");hi(me,{get title(){return l(ue)},children:(we,Ie)=>{var _e=Pl(),Fe=G(_e);{var ze=ke=>{Cl(ke,{get layerId(){return l(Ae).layerId},onFilterClicked:f,hasFiltersApplied:m})};ge(Fe,ke=>{t.dataSelectionTreeviewConfig?.getItemConfig(l(Ae).layerId)?.showFields&&ke(ze)})}var Je=he(Fe,2);Pt(Je,{variant:"ghost",size:"sm",class:"data-remove-btn",title:"Remove data selection",onclick:()=>h(l(Ae).layerId),children:(ke,Re)=>{hn();var be=In("Ã");F(ke,be)},$$slots:{default:!0}}),F(we,_e)},$$slots:{default:!0}})}}),Y(le);var re=he(le,2),se=X(re);Y(re),ht(me=>Tt(se,`${me??""} data layer(s) selected`),[()=>t.dataSelectionStore.getAllSelections().length]),F(j,W)},z=j=>{var W=El();F(j,W)};ge(H,j=>{t.dataSelectionStore.getAllSelections().length>0?j(L):j(z,!1)})}Y(M),ht(()=>Tt(N,t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer?t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer.title:"No Area Layer Selected")),F(w,P),Le()}function Nl(w,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];En(w,Ct({name:"arrow-down-to-line"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Ye(m,()=>t.children??$e),F(u,f)},$$slots:{default:!0}})),Le()}function Ml(w,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"m18 15-6-6-6 6"}]];En(w,Ct({name:"chevron-up"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Ye(m,()=>t.children??$e),F(u,f)},$$slots:{default:!0}})),Le()}function Ll(w,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]];En(w,Ct({name:"maximize"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Ye(m,()=>t.children??$e),F(u,f)},$$slots:{default:!0}})),Le()}function Rl(w,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]];En(w,Ct({name:"minimize"},()=>a,{get iconNode(){return s},children:(u,h)=>{var f=ae(),m=G(f);Ye(m,()=>t.children??$e),F(u,f)},$$slots:{default:!0}})),Le()}function Vl(w,t){w.target===w.currentTarget&&t()}var jl=(w,t)=>w.key==="Escape"&&t(),Hl=(w,t,a)=>t(l(a).name),zl=oe('<div class="info-icon-container svelte-fp5rsc"><!></div>'),Kl=oe('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),Bl=oe('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),ql=oe("<!> <!>",1),Ul=oe("<!> <!>",1),Gl=oe('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),Wl=oe('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function $l(w,t){Me(t,!0);const a=Ne(t,"fieldFilterMenuStore",7);let s=ne(null),u=ne(He(new Nt)),h=fe(()=>{if(!l(s)||!l(s).fields)return{checked:!1,indeterminate:!1};const R=l(s).fields.length,M=l(u)?.size||0;return M===0?{checked:!1,indeterminate:!1}:M===R?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});Ue(()=>{const R=a().ActiveLayer;if(!R){K(s,null),K(u,new Nt,!0);return}K(s,R,!0);const M=t.dataSelectionStore.getSelection(R.id);M?.selectedFieldIds?K(u,new Nt([...M.selectedFieldIds]),!0):K(u,new Nt,!0)});function f(){m(),a().ActiveLayer=null}function m(){if(!l(s))return;let R=t.dataSelectionStore.getSelection(l(s).id);if(R){if((R.selectedFieldIds===void 0||R.selectedFieldIds===null)&&(R.selectedFieldIds=new Nt),l(u).size===0){t.dataSelectionStore.removeSelection(l(s).id);return}R.selectedFieldIds.clear(),l(u).forEach(M=>{R.selectedFieldIds?.add(M)})}}function P(R){l(s)&&(l(u).has(R)?l(u).delete(R):l(u).add(R))}function x(){if(!l(s)?.fields)return;(l(u)?.size||0)===0?l(s).fields.forEach(M=>{l(u).add(M.name)}):l(u).clear()}function A(){if(!l(s)?.fields)return[];const R=l(s).fields.filter(M=>!t.fieldsToHide.has(M.name.toLowerCase()));return console.log("Filtered fields to show:",R,t.fieldsToHide,l(s).fields),R}var N=ae(),E=G(N);{var q=R=>{var M=Wl();M.__click=[Vl,f],M.__keydown=[jl,f];var H=X(M);Ee(H,()=>Tr,(L,z)=>{z(L,{class:"command-card",children:(j,W)=>{var le=Gl(),re=G(le);re.__click=f;var se=X(re);Io(se,{size:20}),Y(re);var me=he(re,2);Ee(me,()=>Pr,(Ae,ue)=>{ue(Ae,{class:"card-content",children:(we,Ie)=>{var _e=ae(),Fe=G(_e);Ee(Fe,()=>ko,(ze,Je)=>{Je(ze,{children:(ke,Re)=>{var be=Ul(),Pe=G(be);Ee(Pe,()=>Co,(st,pe)=>{pe(st,{placeholder:"Search for fields..."})});var ot=he(Pe,2);Ee(ot,()=>Ao,(st,pe)=>{pe(st,{children:(Be,de)=>{var ve=ql(),Te=G(ve);Ee(Te,()=>Oo,(ee,vt)=>{vt(ee,{children:(Ge,ye)=>{hn();var qe=In("No results found.");F(Ge,qe)},$$slots:{default:!0}})});var lt=he(Te,2);Ee(lt,()=>Po,(ee,vt)=>{vt(ee,{heading:"Fields",children:(Ge,ye)=>{var qe=Bl(),pt=G(qe),je=X(pt);Zi(je,{get checked(){return l(h).checked},get indeterminate(){return l(h).indeterminate},onCheckedChange:x}),hn(2),Y(pt);var ct=he(pt,2);Ee(ct,()=>zo,(Qe,Xe)=>{Xe(Qe,{})});var rt=he(ct,2);Bt(rt,17,A,Cn,(Qe,Xe)=>{var Ze=ae(),et=G(Ze);Ee(et,()=>To,(At,Vt)=>{Vt(At,{class:"field-item",onselect:()=>P(l(Xe).name),children:(Ot,jt)=>{var it=Kl(),gt=X(it);{let Ut=fe(()=>l(u)?.has(l(Xe).name)??!1);Zi(gt,{class:"field-checkbox",get checked(){return l(Ut)},onCheckedChange:()=>P(l(Xe).name)})}var It=he(gt,2);It.__click=[Hl,P,Xe];var ut=X(It),mt=X(ut),Ht=X(mt,!0);Y(mt);var qt=he(mt,2);{var vn=Ut=>{var Et=zl(),ce=X(Et);Gn(ce,()=>Ko),Y(Et),ht(()=>yi(Et,"title",l(Xe).description)),F(Ut,Et)};ge(qt,Ut=>{l(Xe).description&&Ut(vn)})}Y(ut),Y(It),Y(it),ht(()=>Tt(Ht,l(Xe).alias||l(Xe).name)),F(Ot,it)},$$slots:{default:!0}})}),F(Qe,Ze)}),F(Ge,qe)},$$slots:{default:!0}})}),F(Be,ve)},$$slots:{default:!0}})}),F(ke,be)},$$slots:{default:!0}})}),F(we,_e)},$$slots:{default:!0}})}),F(j,le)},$$slots:{default:!0}})}),Y(M),F(R,M)};ge(E,R=>{l(s)&&R(q)})}F(w,N),Le()}Er(["click","keydown"]);class Ta{id;name;children;parent;constructor(t,a,s=[],u=null){this.id=t,this.name=a,this.children=s,this.parent=u}}class at extends Ta{layer;constructor(t,a,s,u=[],h=null){super(t,a,u,h),this.layer=s}}class An extends at{featureLayer;field;constructor(t,a,s,u,h=[],f=null){super(t,a,s,h,f),this.field=u,this.featureLayer=s}}var nt=(w=>(w.Inactive="inactive",w.Indeterminate="indeterminate",w.Active="active",w))(nt||{}),nn=(w=>(w.Hidden="hidden",w.Suspended="suspended",w.Visible="visible",w))(nn||{});class Ea{#e=ne(!1);get initialized(){return l(this.#e)}set initialized(t){K(this.#e,t,!0)}#t=null;#n=null;#r=ne(He([]));#i=fe(()=>{const t=new xt;return this.#S(l(this.#r),t),t});#a=ne(He(new xt));#s=ne(He(new xt));#l=ne(He(new xt));#c=ne(He(new xt));#f=ne(He(new xt));#h=null;initialize(t,a,s,u,h){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!a)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=a,u)for(const f of u)l(this.#f).set(f.id,f);if(h&&(this.#h=h),!t)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#n=s,this.#m(t),K(this.#r,this.#y(t),!0)}getNodeById(t){return this.#u(),l(this.#i).get(t)}getNodes(){return this.#u(),l(this.#r)}getVisibleNodes(){this.#u();const t=[];for(const[a,s]of l(this.#a)){if(!s)continue;const u=l(this.#i).get(a);u&&t.push(u)}return t}getNonHiddenNodes(){return this.#u(),this.#o(l(this.#r))}clearSelections(){this.#u();for(const t of l(this.#a).keys()){l(this.#a).set(t,!1);const a=l(this.#i).get(t);a&&a instanceof at&&(a.layer.visible=!1)}l(this.#c).clear()}#o(t){this.#u();const a=[];for(const s of t){const u=this.#v(s.id);if(!(u&&u.isHidden)&&(a.push(s),s.children?.length)){const h=this.#o(s.children);a.push(...h)}}return a}getVisibilityState(t){return this.#u(),l(this.#a).get(t)??!1}setVisibilityState(t,a){this.#u();const s=l(this.#i).get(t);if(!s)throw new Error(`Tree node not found for ID: ${t}`);if(!(s instanceof at))throw new Error(`Tree node is not a layer node: ${t}`);const u=this.#v(t);if(u?.disableVisibilityToggle||(l(this.#a).set(t,a),s.layer.visible=a,this.updateDrawState(s,a),s instanceof An&&(s.featureLayer.displayField=a?s.field.name:"",a&&this.#h&&(console.log("[TreeviewStore] Applying custom renderer for field:",s.field.name),this.#h.applyCustomRenderer(s.featureLayer,s.field.name))),this.#d(s,a),!u||u.isHidden)||(u.visibilityDependencyIds?.length&&this.#p(s,a),!u.visibilityGroupId))return;const h=u.visibilityGroupId;let f=l(this.#c).get(h);f||(f=[],l(this.#c).set(h,f));const m=this.#g(h);if(!m)throw new Error(`Visibility group config not found for group ID: ${h}`);if(!a){const x=f.indexOf(t);f.splice(x,1);return}const P=x=>{l(this.#a).set(x,!1);const A=l(this.#i).get(x);if(A&&A instanceof at){A.layer.visible=!1,this.updateDrawState(A,!1),this.#d(A,!1);const E=this.#v(x);E&&E.visibilityDependencyIds?.length&&this.#p(A,!1)}const N=f.indexOf(x);N>=0&&f.splice(N,1)};for(;f.length>=m.maxVisibleLayers;){const x=f[0];P(x)}f.push(t),this.#d(s,a),u.visibilityDependencyIds?.length&&this.#p(s,a)}async updateDrawState(t,a){if(!this.#n)return;if(!a){l(this.#s).delete(t.id),l(this.#l).get(t.id)?.remove(),l(this.#l).delete(t.id);return}if(!(t instanceof at)||!(t.layer instanceof ia))return;const s=await this.#n.getLayerView(t.layer);if(!s)return;this.setInitialDrawState(t,s);const u=ps(()=>s.suspended,(h,f)=>{f&&!h?l(this.#s).set(t.id,nn.Visible):!f&&h&&l(this.#s).set(t.id,nn.Suspended)});l(this.#l).set(t.id,u)}getNodeDrawState(t){return this.#u(),l(this.#s).get(t)??nn.Hidden}setInitialDrawState(t,a){!(t instanceof at)||!(t.layer instanceof ia)||a&&(a.suspended?l(this.#s).set(t.id,nn.Suspended):l(this.#s).set(t.id,nn.Visible))}clearDrawStateHandles(){for(const t of l(this.#l).values())t.remove();l(this.#l).clear()}cleanup(){this.initialized=!1,l(this.#a).clear(),l(this.#c).clear(),l(this.#f).clear(),K(this.#r,[],!0),l(this.#i).clear(),l(this.#s).clear(),this.clearDrawStateHandles()}#d(t,a){const s=t.parent;if(s){if(!(s instanceof at)){this.#d(s,a);return}l(this.#a).set(s.id,a),s.layer.visible=a,this.#d(s,a)}}#p(t,a){const s=this.#v(t.id);if(s&&s.visibilityDependencyIds?.length)for(const u of s.visibilityDependencyIds){const h=l(this.#i).get(u);h&&h instanceof at&&(l(this.#a).set(u,a),h.layer.visible=a,this.#d(h,a))}}#g(t){if(t&&this.#t)return this.#t.getVisibilityGroupConfig(t)}#m(t){this.#t&&this.#t.resolveInheritance(t)}#y(t){const a=t.map(s=>this.#w(s,void 0));return this.#b([...a])}#v(t){if(t&&this.#t)return this.#t.getItemConfig(t)}#b(t){t.reverse();for(const a of t)a.children?.length&&this.#b(a.children);return t}#w(t,a){const s=this.#v(t.id);if(s&&s.customConverterId){if(!l(this.#f).has(s.customConverterId))throw new Error(`Custom converter not found: ${s.customConverterId}`);const h=l(this.#f).get(s.customConverterId);if(!h)throw new Error(`Custom converter not found: ${s.customConverterId}`);return h.layerToNode(t,a??null)}const u=new at(t.id,t.title,t,[],a);if(t.visible=s?.disableVisibilityToggle?t.visible:s?.isHidden?!1:s?.isVisibleOnInit??!1,l(this.#a).set(t.id,t.visible),this.updateDrawState(u,t.visible),this.#A(t)&&s?.showFields){const h=t;h.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const f of h.fields??[]){const m=this.#x(f,u);u.children.push(m)}}if(this.#C(t)){const h=t;return u.children=h.layers.toArray().map(f=>this.#w(f,u)),u}if(this.#I(t)){const h=t;if(h.sublayers&&h.sublayers.length>0){const f=h.sublayers;u.children=f.toArray().map(this.#_)}}return u}#x(t,a){const s=this.#k(a.id,t.name),u=new An(s,t.alias||t.name,a.layer,t,[],a),h=this.#v(s);return l(this.#a).set(s,h?.isVisibleOnInit??!1),u}#I(t){return t.type==="map-image"||t.type==="wms"}#_(t){const a=new at(t.uid,t.title,t);return t.sublayers?.length&&(a.children=t.sublayers.toArray().map(this.#_)),a}#S(t,a){for(const s of t)a.set(s.id,s),s.children?.length&&this.#S(s.children,a)}#k(t,a){return`${t}-${a}`}#C(t){return t.type==="group"}#A(t){return t.type==="feature"}#u(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}const Yl='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Jl='<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Ql='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',Fa=(w,t,a,s)=>t?Xl(w,a):a?s?Yl:Jl:Ql,Xl=(w,t)=>{switch(w.type){case"group":return ea;case"feature":return ta;case"tile":return Bo;default:return t?ea:ta}};function Zl(w){const t=w-1;return t*t*t+1}var ec=oe('<div class="relative ml-4 w-full"><div class="tree-guide-line svelte-1y72o5r"></div> <div class="tree-children svelte-1y72o5r"></div></div>'),tc=oe('<div class="w-full"><!> <!></div>');function Da(w,t){const a=Ne(t,"isOpen",3,!1),s=Ne(t,"childNodes",3,null),u=Ne(t,"duration",3,300);var h=tc(),f=X(h);Ye(f,()=>t.content??$e);var m=he(f,2);{var P=x=>{var A=ec(),N=he(X(A),2);Bt(N,21,()=>s()??[],E=>E.id,(E,q)=>{var R=ae(),M=G(R);Ye(M,()=>t.childNode??$e,()=>l(q)),F(E,R)}),Y(N),Y(A),Cr(1,N,()=>ha,()=>({duration:u(),easing:Zl})),Cr(2,N,()=>ha,()=>({duration:u()})),F(x,A)};ge(m,x=>{a()&&s()&&x(P)})}Y(h),F(w,h)}const vi="mb-1 cursor-pointer rounded-md border border-border p-2 text-left",pi="transform-gpu transition-all duration-150 ease-out hover:border-border/50 hover:bg-gray-100 hover:shadow-sm",nc="transition-colors hover:bg-blue-500",gi="text-sm font-normal",mi="bg-card",Na="bg-accent text-accent-foreground",rc="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";function ic(w={}){const{enhancedHover:t=!1,includeFont:a=!1,pressed:s=!1}=w;let u=vi;return t?u+=" "+pi:u+=" "+nc,a&&(u+=" "+gi),s?u+=" "+Na:u+=" "+mi,u}var ac=oe('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),oc=oe('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ma(w,t){const a=`calc(100% - ${t.depth*1}rem)`,s=`${vi} ${pi} ${rc} ${mi} ${gi}`,u=`${vi} ${pi} ${gi}`;var h=ae(),f=G(h);{var m=x=>{qo(x,{get pressed(){return t.pressed},get class(){return s},variant:"outline",get style(){return`width: ${a};`},get onPressedChange(){return t.onclick},children:(A,N)=>{var E=ac(),q=X(E),R=X(q),M=X(R);Gn(M,()=>t.icon),Y(R);var H=he(R,2),L=X(H,!0);Y(H),Y(q);var z=he(q,2);Ye(z,()=>t.children??$e),Y(E),ht(()=>Tt(L,t.name)),F(A,E)},$$slots:{default:!0}})},P=x=>{var A=oc();A.__click=function(...j){t.onclick?.apply(this,j)};var N=X(A),E=X(N),q=X(E);ka(q,{get isOpen(){return t.isOpen}});var R=he(q,2),M=X(R);Gn(M,()=>t.icon),Y(R);var H=he(R,2),L=X(H,!0);Y(H),Y(E);var z=he(E,2);Ye(z,()=>t.children??$e),Y(N),Y(A),ht(()=>{rn(A,1,`${u} ${t.pressed?Na:mi}`),kn(A,`width: ${a};`),Tt(L,t.name)}),F(x,A)};ge(f,x=>{t.isTogglable?x(m):x(P,!1)})}F(w,h)}Er(["click"]);function Ma(w,t){Me(t,!0);const a=M=>{var H=ae(),L=G(H);{var z=j=>{var W=ae(),le=G(W);{var re=me=>{ma(me,{isTogglable:!1,get pressed(){return l(x)},get icon(){return l(A)},get name(){return t.node.name},get depth(){return u()},onclick:R,get isOpen(){return l(P)}})},se=me=>{ma(me,{isTogglable:!0,get pressed(){return l(x)},get icon(){return l(A)},get name(){return t.node.name},get depth(){return u()},onclick:q,get isOpen(){return l(P)}})};ge(le,me=>{f?me(re):me(se,!1)})}F(j,W)};ge(L,j=>{t.treeviewConfigStore.getItemConfig(t.node.id)?.isHidden||j(z)})}F(M,H)},s=(M,H=$e)=>{var L=ae(),z=G(L);{var j=W=>{{let le=fe(()=>u()+1);Ma(W,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return H()},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get getNodeVisibility(){return t.getNodeVisibility},get depth(){return l(le)},get useLayerTypeIcon(){return h()}})}};ge(z,W=>{f&&l(P)&&!t.treeviewConfigStore.getItemConfig(H().id)?.isHidden&&W(j)})}F(M,L)},u=Ne(t,"depth",3,0),h=Ne(t,"useLayerTypeIcon",3,!1),f=!!(t.node.children&&t.node.children.length),m=!f;let P=ne(!1),x=ne(!1),A=ne("");function N(){return!t.node.children||!t.getNodeVisibility?!1:t.node.children.some(M=>{const H=t.getNodeVisibility(M.id);return H!==void 0?H:M instanceof at?M.layer.visible:!1})}Ue(()=>{if(!(!t.node||!(t.node instanceof at))){if(f)K(x,N(),!0);else{const M=t.getNodeVisibility?t.getNodeVisibility(t.node.id):void 0;K(x,M!==void 0?M:t.node.layer.visible,!0)}K(A,Fa(t.node.layer,h(),f,l(P)),!0)}});function E(){!m||!t.onNodeVisibilityChange||f||(K(x,!l(x)),t.onNodeVisibilityChange(t.node,l(x)))}function q(){f||E(),t.onNodeClick?.(t.node)}function R(){K(P,!l(P)),t.onNodeClick?.(t.node)}{let M=fe(()=>f?t.node.children:null);Da(w,{get isOpen(){return l(P)},get content(){return a},get childNodes(){return l(M)},get childNode(){return s}})}Le()}function sc(w,t){Me(t,!0);const a=new Ea;function s(){a.clearSelections()}Ue(()=>{!t.webMap||a.initialized||a.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,null)}),Ue(()=>{a.initialized&&!a.getVisibleNodes().length&&t.areaSelectionStore.layerId&&a.setVisibilityState(t.areaSelectionStore.layerId,!0)}),Ue(()=>{if(!a.initialized||!a.getVisibleNodes().length)return;const P=a.getVisibleNodes().find(x=>x instanceof at&&x.layer instanceof aa);if(!P||!(P instanceof at)){console.warn("Visible node is not a FeatureLayer");return}if(!P.layer||!(P.layer instanceof aa)){console.warn("Visible node layer is not a FeatureLayer",P.layer.type);return}t.areaSelectionStore.setLayerId(P.id)});var u={clearSelections:s},h=ae(),f=G(h);{var m=P=>{var x=ae(),A=G(x);Ee(A,()=>Ca,(N,E)=>{E(N,{children:(q,R)=>{var M=ae(),H=G(M);Bt(H,17,()=>a.getNodes(),L=>L.id,(L,z)=>{Ma(L,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return l(z)},onNodeClick:()=>{},onNodeVisibilityChange:(j,W)=>a.setVisibilityState(j.id,W),getNodeVisibility:j=>a.getVisibilityState(j),depth:0,useLayerTypeIcon:!0})}),F(q,M)},$$slots:{default:!0}})}),F(P,x)};ge(f,P=>{a.initialized&&P(m)})}return F(w,h),Le(u)}class lc{configStore;constructor(t){this.configStore=t}}function cc(w){return w.replace(/&deg;/gi,"Â°").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}class uc extends lc{id="aliasPath";layerToNode(t,a){const s=new at(t.id,t.title,t,[],a),u=this.configStore.getItemConfig(t.id);if(this.#n(t)&&u?.showFields){const h=t;h.loaded||console.warn(`Layer not loaded: ${t.id}`);const f=new Map;for(const m of h.fields??[]){const P=this.configStore.getItemConfig(this.#t(t.id,m.name));!P||P.isHidden||this.#e(m,s,f)}s.children.sort((m,P)=>m.children.length>0&&P.children.length===0?1:m.children.length===0&&P.children.length>0?-1:0)}return s}#e(t,a,s=new Map){const u=this.#t(a.id,t.name),f=cc(t.alias||"")?.split("|").map(E=>E.trim()).filter(Boolean)??[];if(f.length===0){const E=new An(u,t.alias||t.name,a.layer,t,[],a);return a.children.push(E),E}const m=f.slice(0,-1),P=f[f.length-1];let x=a;const A=(E,q)=>{E.children??=[],E.children.includes(q)||E.children.push(q)};for(let E=0;E<m.length;E++){const q=m[E],R=f.slice(0,E+1).join("::"),M=`${a.id}::${R}`;let H=s.get(M);H||(H=new Ta(M,q,[],x),s.set(M,H),A(x,H)),x=H}const N=new An(u,P||t.name,a.layer,t,[],x);return A(x,N),N}#t(t,a){return`${t}-${a}`}#n(t){return t.type==="feature"}}class ya{#e=[];#t=new Map;#n=[];#r=new Map;#i=[];#a=new Map;#s=new Set;constructor(t){if(!t)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=t.items??[],this.#t=new Map(this.#e.map(a=>[a.id,a])),this.#n=t.visibilityGroups??[],this.#r=new Map(this.#n.map(a=>[a.id,a])),this.#i=t.inheritanceGroups??[],this.#a=new Map(this.#i.map(a=>[a.id,a])),t.fieldsToHide&&(this.#s=new Set(t.fieldsToHide.map(a=>a.trim().toLowerCase())))}getItemConfig(t){return this.#t.get(t)}getVisibilityGroupConfig(t){return this.#r.get(t)}getInheritanceGroupConfig(t){return this.#a.get(t)}resolveInheritance(t){if(!(t.length===0||!this.#e||this.#e.length===0))for(const a of t){const s=this.getItemConfig(a.id);this.#l(a,s)}}#l(t,a){const s=this.#c(t,a);if(this.#y(t)&&s.showFields){const u=t;u.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const h of u.fields??[])this.#f(this.#g(t.id,h.name),h.alias||h.name,s)}if(this.#m(t)){const u=t;for(const h of u.layers.toArray())this.#l(h,s)}}#c(t,a){const s=this.#h(t.id,a);return s.type===br.None&&(s.type=Uo(t)),s}#f(t,a,s){const u=this.#h(t,s);return u.type===br.None&&(u.type=br.Field),this.#s.has(a.trim().toLowerCase())&&(u.isHidden=!0),u}#h(t,a){let s=this.getItemConfig(t);const u=s?.inheritanceGroupId?this.getInheritanceGroupConfig(s.inheritanceGroupId):this.getInheritanceGroupConfig(a?.inheritanceGroupId??"");return s={id:t,type:br.None,isDownloadable:this.#o(u,"isDownloadable",s,a,!0),isVisibleOnInit:this.#o(u,"isVisibleOnInit",s,a,!1),isHidden:this.#o(u,"isHidden",s,a,!1),disableVisibilityToggle:this.#o(u,"disableVisibilityToggle",s,a,!1),isOpenOnInit:this.#o(u,"isOpenOnInit",s,a,!1),showFields:this.#o(u,"showFields",s,a,!1),visibilityDependencyIds:this.#o(u,"visibilityDependencyIds",s,a,[]),visibilityGroupId:this.#o(u,"visibilityGroupId",s,a,void 0),customConverterId:this.#o(u,"customConverterId",s,a,void 0),inheritanceGroupId:this.#o(u,"inheritanceGroupId",s,a,void 0)},this.#p(s),this.#d(s),s}#o(t,a,s,u,h){const f=s?.[a];return f!==void 0?f:t?.inheritedProperties.includes(a)&&u?u[a]??h:h}#d(t){if(this.#t.has(t.id))throw new Error(`Item with id ${t.id} already exists.`);this.#e.push(t),this.#t.set(t.id,t)}#p(t){this.#t.has(t.id)&&(this.#e=this.#e.filter(a=>a.id!==t.id),this.#t.delete(t.id))}#g(t,a){return`${t}-${a}`}#m(t){return t.type==="group"}#y(t){return t.type==="feature"}}var dc=oe('<div data-slot="checkbox-indicator" class="text-current transition-none"><!></div>');function fc(w,t){Me(t,!0);let a=Ne(t,"ref",15,null),s=Ne(t,"checked",11,!1),u=Ne(t,"indeterminate",11,!1),h=Mt(t,["$$slots","$$events","$$legacy","ref","checked","indeterminate","class"]),f=ne(He(s())),m=ne(He(u()));Ue(()=>{K(f,s())}),Ue(()=>{K(m,u())});var P=ae(),x=G(P);{const A=(E,q)=>{let R=()=>q?.().checked,M=()=>q?.().indeterminate;var H=dc(),L=X(H);{var z=W=>{Nl(W,{class:"size-3.5"})},j=W=>{var le=ae(),re=G(le);{var se=me=>{Wo(me,{class:"size-3.5"})};ge(re,me=>{M()&&me(se)},!0)}F(W,le)};ge(L,W=>{R()?W(z):W(j,!1)})}Y(H),F(E,H)};let N=fe(()=>ls("peer flex size-4 shrink-0 items-center justify-center rounded-[4px] border border-input shadow-xs transition-shadow outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 data-[state=checked]:border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:bg-input/30 dark:aria-invalid:ring-destructive/40 dark:data-[state=checked]:bg-primary",t.class));Ee(x,()=>Go,(E,q)=>{q(E,Ct({"data-slot":"checkbox",get class(){return l(N)}},()=>h,{get ref(){return a()},set ref(R){a(R)},get checked(){return l(f)},set checked(R){K(f,R,!0)},get indeterminate(){return l(m)},set indeterminate(R){K(m,R,!0)},children:A,$$slots:{default:!0}}))})}F(w,P),Le()}var hc=oe("<div><!></div>");function ba(w,t){Me(t,!0);let a=fe(()=>t.getDownloadState?.(t.node)??nt.Inactive),s=fe(()=>l(a)===nt.Active),u=fe(()=>l(a)===nt.Indeterminate);function h(P){P.stopPropagation();const x=l(a)===nt.Active?nt.Inactive:nt.Active;t.onDownloadStateChanged?.(t.node,x)}var f=hc(),m=X(f);fc(m,{get checked(){return l(s)},get indeterminate(){return l(u)},onclick:h,title:"Download"}),Y(f),F(w,f),Le()}var vc=oe('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function wa(w,t){Me(t,!0);const a=Ne(t,"isFolder",3,!1),s=Ne(t,"isOpen",3,!1),u=`calc(100% - ${t.depth*1}rem)`;var h=vc();h.__click=function(...M){t.onclick?.apply(this,M)};var f=X(h),m=X(f),P=X(m);{var x=M=>{ka(M,{get isOpen(){return s()}})};ge(P,M=>{a()&&M(x)})}var A=he(P,2),N=X(A);Gn(N,()=>t.icon),Y(A);var E=he(A,2),q=X(E,!0);Y(E),Y(m);var R=he(m,2);Ye(R,()=>t.children??$e),Y(f),Y(h),ht(M=>{rn(h,1,M),kn(h,`width: ${u};`),Tt(q,t.name)},[()=>xo(ic({enhancedHover:!0,includeFont:!0}))]),F(w,h),Le()}Er(["click"]);var pc=oe('<div class="flex items-center gap-2"><!> <!></div>'),gc=oe('<div class="flex items-center gap-2"><!> <!></div>');function La(w,t){Me(t,!0);const a=z=>{var j=ae(),W=G(j);{var le=re=>{var se=ae(),me=G(se);{var Ae=we=>{wa(we,{get icon(){return l(E)},get name(){return t.node.name},get depth(){return h()},onclick:L,get isFolder(){return m},get isOpen(){return l(A)},children:_e=>{var Fe=pc(),ze=X(Fe);{var Je=be=>{ba(be,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};ge(ze,be=>{t.isDownloadable&&be(Je)})}var ke=he(ze,2);{var Re=be=>{{let Pe=fe(()=>t.getNodeDrawState?.(t.node.id)===nn.Suspended);na(be,{get checked(){return l(N)},get indeterminate(){return l(Pe)},onCheckedChange:M})}};ge(ke,be=>{P&&be(Re)})}Y(Fe),F(_e,Fe)},$$slots:{default:!0}})},ue=we=>{wa(we,{get icon(){return l(E)},get name(){return t.node.name},get depth(){return h()},onclick:H,get isFolder(){return m},children:_e=>{var Fe=gc(),ze=X(Fe);{var Je=be=>{ba(be,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};ge(ze,be=>{t.isDownloadable&&be(Je)})}var ke=he(ze,2);{var Re=be=>{{let Pe=fe(()=>t.getNodeDrawState?.(t.node.id)===nn.Suspended);na(be,{get checked(){return l(N)},get indeterminate(){return l(Pe)},onCheckedChange:M})}};ge(ke,be=>{P&&be(Re)})}Y(Fe),F(_e,Fe)},$$slots:{default:!0}})};ge(me,we=>{m?we(Ae):we(ue,!1)})}F(re,se)};ge(W,re=>{u()?.getItemConfig(t.node.id)?.isHidden||re(le)})}F(z,j)},s=(z,j=$e)=>{var W=ae(),le=G(W);{var re=se=>{{let me=fe(()=>u()?.getItemConfig(j().id)?.isDownloadable??!0),Ae=fe(()=>h()+1);La(se,{get treeviewConfigStore(){return u()},get node(){return j()},get isDownloadable(){return l(me)},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState},get onFilterClicked(){return t.onFilterClicked},get hasFiltersApplied(){return t.hasFiltersApplied},get getNodeVisibility(){return t.getNodeVisibility},get getNodeDrawState(){return t.getNodeDrawState},get depth(){return l(Ae)},get useLayerTypeIcon(){return f()}})}};ge(le,se=>{m&&l(A)&&!u()?.getItemConfig(j().id)?.isHidden&&se(re)})}F(z,W)},u=Ne(t,"treeviewConfigStore",3,null),h=Ne(t,"depth",3,0),f=Ne(t,"useLayerTypeIcon",3,!1),m=!!(t.node.children&&t.node.children.length),P=!m;let x=!1,A=ne(!1),N=ne(!1),E=ne(""),q=ne(!1),R=ne(!1);Ue(()=>{x||(K(A,u()?.getItemConfig(t.node.id)?.isOpenOnInit??!1,!0),x=!0)}),Ue(()=>{if(!t.node)return;const z=t.getNodeVisibility?t.getNodeVisibility(t.node.id):!1;K(N,z??!1,!0),t.node instanceof at&&K(E,Fa(t.node.layer,f(),m,l(A)),!0)}),Ue(()=>{if(!(t.node instanceof at))return;const z=(t.getDownloadState?.(t.node)===nt.Active&&t.node.layer.type==="feature")??!1;z&&!l(q)?(K(q,!0),K(R,!1)):!z&&l(q)&&(K(R,!0),setTimeout(()=>{K(q,!1),K(R,!1)},180))});function M(){!P||!t.onNodeVisibilityChange||(K(N,!l(N)),t.onNodeVisibilityChange(t.node,l(N)))}function H(){t.onNodeClick?.(t.node)}function L(){K(A,!l(A)),t.onNodeClick?.(t.node)}{let z=fe(()=>m?t.node.children:null);Da(w,{get isOpen(){return l(A)},get content(){return a},get childNodes(){return l(z)},get childNode(){return s}})}Le()}class mc{#e;#t;constructor(t,a){this.#e=t,this.#t=a}updateSelection(t,a){if(!this.#t.getItemConfig(t.id)?.isHidden){if(!(t instanceof at)){this.updateChildrenSelection(t,a);return}if(t instanceof An){this.updateFieldSelection(t,a);return}this.updateLayerSelection(t,a)}}getSelectionState(t){if(!(t instanceof at))return this.determineSelectionStateFromChildren(t);if(this.isGroupLayer(t))return this.determineSelectionStateFromChildren(t);let a;return t instanceof An?(a=this.#e.getSelection(t.featureLayer.id),a&&a.selectedFieldIds.has(t.field.name)?nt.Active:nt.Inactive):(a=this.#e.getSelection(t.id),a?this.isFeatureLayer(t)&&t.children&&t.children.length>0?this.determineSelectionStateFromChildren(t):nt.Active:nt.Inactive)}updateLayerSelection(t,a){let s=this.#e.getSelection(t.id);switch(a){case nt.Active:!s&&!this.isGroupLayer(t)&&(s=this.createAndAddDataSelection(t.id));for(const u of t.children||[])this.updateSelection(u,a);break;case nt.Inactive:s&&!this.isGroupLayer(t)&&this.#e.removeSelection(t.id),this.updateChildrenSelection(t,a);break}}updateFieldSelection(t,a){let s=this.#e.getSelection(t.featureLayer.id);switch(a){case nt.Active:s||(s=this.createAndAddDataSelection(t.featureLayer.id)),this.#e.addOrUpdateSelection(t.featureLayer.id,[...s.selectedFieldIds,t.field.name]);break;case nt.Inactive:{if(!s)break;const u=new Nt(s.selectedFieldIds);u.delete(t.field.name),this.#e.addOrUpdateSelection(t.featureLayer.id,[...u]),u.size===0&&this.#e.removeSelection(s.layerId);break}}}updateChildrenSelection(t,a){for(const s of t.children||[])this.updateSelection(s,a)}determineSelectionStateFromChildren(t){let a=0,s=0;for(const u of t.children||[]){if(this.#t.getItemConfig(u.id)?.isHidden)continue;s++;const f=this.getSelectionState(u);if(f===nt.Active||this.isFeatureLayer(u)&&f!==nt.Inactive)a++;else if(f===nt.Indeterminate)return nt.Indeterminate}return a===0?nt.Inactive:a===s?nt.Active:nt.Indeterminate}createAndAddDataSelection(t){const a={layerId:t,selectedFieldIds:new Nt};return this.#e.addSelection(a),a}isGroupLayer(t){return t instanceof at&&t.layer.type==="group"}isFeatureLayer(t){return t instanceof at&&t.layer.type==="feature"}}function yc(w,t){Me(t,!0);const a=Ne(t,"fieldFilterMenuStore",7);function s(){u.clearSelections()}const u=new Ea,h=new mc(t.dataSelectionStore,t.treeviewConfigStore);Ue(()=>{if(!t.webMap||u.initialized)return;(async()=>{await t.webMap.when(),await f(t.webMap.layers.toArray());const z=new uc(t.treeviewConfigStore);u.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,t.layerViewProvider,[z],t.customRendererService)})()});async function f(L){for(const z of L)z.type==="feature"&&!z.loaded&&await z.load(),z.type==="group"&&await f(z.layers.toArray())}function m(L,z){console.log(`[tree-view] onNodeVisibilityChange: Setting visibility of node ${L.id} to ${z}`),u.setVisibilityState(L.id,z)}function P(L){return u.getNodeDrawState(L)}function x(L,z){h.updateSelection(L,z)}function A(L){return h.getSelectionState(L)}function N(L){if(a().ActiveLayer?.uid===L){a().ActiveLayer=null;return}const j=u.getNodeById(L);!j||!(j instanceof at)||(a().ActiveLayer=j.layer)}function E(L){const z=t.dataSelectionStore.getSelection(L);if(!z?.selectedFieldIds)return!1;const j=u.getNodeById(L);if(!j||!(j instanceof at))return!1;const W=j.layer.fields?.length||0,le=z?.selectedFieldIds.size||0;return le>0&&le!==W}var q={clearSelections:s},R=ae(),M=G(R);{var H=L=>{var z=ae(),j=G(z);Ee(j,()=>Ca,(W,le)=>{le(W,{children:(re,se)=>{var me=ae(),Ae=G(me);Bt(Ae,17,()=>u.getNodes(),ue=>ue.id,(ue,we)=>{{let Ie=fe(()=>t.treeviewConfigStore.getItemConfig(l(we).id)?.isDownloadable??!0);La(ue,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return l(we)},get isDownloadable(){return l(Ie)},onNodeClick:()=>{},onNodeVisibilityChange:m,getNodeVisibility:_e=>u.getVisibilityState(_e),onDownloadStateChanged:x,getDownloadState:A,onFilterClicked:N,hasFiltersApplied:E,getNodeDrawState:P,depth:0,useLayerTypeIcon:!0})}}),F(re,me)},$$slots:{default:!0}})}),F(L,z)};ge(M,L=>{u.initialized&&L(H)})}return F(w,R),Le(q)}class Ra{#e;constructor(t){this.#e=t}async getLayerView(t){return this.#e.whenLayerView(t)}async getLayerViewById(t){const a=this.#e.map?.findLayerById(t);if(a)return this.getLayerView(a)}}class bc{mapView;areaSelectionInteractionStore;interactableLayers;pointerMoveHandle=null;clickHandle=null;leaveHandle=null;enterHandle=null;#e=ne(!0);get pointerInsideMap(){return l(this.#e)}set pointerInsideMap(t){K(this.#e,t,!0)}constructor(t,a,s){console.log("[map-interaction-store] Initializing with MapView"),this.mapView=t,this.areaSelectionInteractionStore=a,this.interactableLayers=s,this.setupHighlights(t),this.setupPointerMoveHandler(t),this.setupClickHandler(t),this.setupLeaveHandler(t),this.setupEnterHandler(t),console.log("[map-interaction-store] Initialized with MapView")}setupHighlights(t){const a={name:"hover",color:"lightgreen",haloOpacity:1,fillOpacity:.2},s={name:"selected",color:"green",haloOpacity:1,fillOpacity:.3};t.highlights.push(a),t.highlights.push(s)}setupPointerMoveHandler(t){this.pointerMoveHandle=t.on("pointer-move",async a=>{if(!this.pointerInsideMap)return;const{results:s}=await t.hitTest(a),u=s[0];if(!u){this.clearHoverHighlight();return}const h=u.graphic,f=h.layer;if(!h||!f||!this.isLayerInteractable(f.title)||h.attributes?.[f.objectIdField]===void 0){this.clearHoverHighlight();return}const m=h.attributes?.[f.objectIdField];if(!(this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.currentHoveredArea.id===m))try{const P=await t.whenLayerView(f);this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P),this.clearHoverHighlight();const x=P;if(!x){console.warn("LayerView is not a FeatureLayerView");return}if(!this.pointerInsideMap)return;const A=x.highlight(h,{name:"hover"});this.areaSelectionInteractionStore.setHoveredArea(m,A)}catch(P){console.error("Error in pointer-move handler:",P),this.clearHoverHighlight()}})}setupClickHandler(t){this.clickHandle=t.on("click",async a=>{const{results:s}=await t.hitTest(a),u=s[0];if(!u)return;const h=u.graphic,f=h.layer;if(!h||!f||!this.isLayerInteractable(f.title)||h.attributes?.[f.objectIdField]===void 0)return;const m=h.attributes?.[f.objectIdField];try{const P=await t.whenLayerView(f),x=P;if(!x){console.warn("Layer is not a FeatureLayerView");return}if(this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P),this.areaSelectionInteractionStore.selectionViewState.areaHandles.get(m))this.areaSelectionInteractionStore.removeSelectedArea(m);else{const N=x.highlight(h,{name:"selected"});this.areaSelectionInteractionStore.addSelectedArea(m,N)}}catch(P){console.error("Error in click handler:",P)}})}setupLeaveHandler(t){this.leaveHandle=t.on("pointer-leave",()=>{this.pointerInsideMap=!1,this.clearHoverHighlight()})}setupEnterHandler(t){this.enterHandle=t.on("pointer-enter",()=>{this.pointerInsideMap=!0})}isLayerInteractable(t){return this.interactableLayers.has(t)}clearHoverHighlight(){this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.clearHoveredArea()}cleanup(){this.pointerMoveHandle&&(this.pointerMoveHandle.remove(),this.pointerMoveHandle=null),this.clickHandle&&(this.clickHandle.remove(),this.clickHandle=null),this.leaveHandle&&(this.leaveHandle.remove(),this.leaveHandle=null),this.enterHandle&&(this.enterHandle.remove(),this.enterHandle=null),this.clearHoverHighlight(),this.pointerInsideMap=!0,this.interactableLayers=new Nt,console.log("[map-interaction-store] cleaned up")}get currentMapView(){return this.mapView}}var wc=oe('<div class="map-view svelte-14z0ybm"></div>');function _c(w,t){Me(t,!0);const a=Ne(t,"mapView",7);let s=ne(null),u=null;const h="streets-vector";let f,m;function P(){if(!a())throw new Error("MapView is not initialized");return new Ra(a())}xn(async()=>{await x(),await E()});async function x(){if(!m){const[{default:L},{default:z},{default:j},{default:W}]=await Promise.all([Bn(()=>import("../chunks/CqdJTlSq.js").then(le=>le.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url),Bn(()=>import("../chunks/Bw0t1Yok.js").then(le=>le.a3),__vite__mapDeps([38,1,2,3,5,39,22,40,20,6,7,41,30,42,18,19,43,8,9,10,11,23,44,45,16,31,46,47,48,24,49,50,14,51,0,4,12,13,15,17,21,25,26,27,28,29,32,33,34,35,36,37,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91]),import.meta.url),Bn(()=>import("../chunks/BHw5JDdy.js").then(le=>le.W),__vite__mapDeps([92,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,93,94,95,96,65,97,98,78,79,69,53,54,55,56,57,58,59,60,61,62,63,99,100,101,68,64,102,103,104,105,67,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,44,45,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176]),import.meta.url),Bn(()=>import("../chunks/nat4CE_M.js"),__vite__mapDeps([99,5,1,2,3,54,22,8,9,10,6,7,11,55,21,18,19,20,37,93,100,101,68,69,64,102,103,104,36,65,105,14,24,67,41,30,42,106,107,108,109,59,110,53,56,57,58,12,60,61,62,63,111,112,113,114,115,116,117,118,119,120,121,122,123,124,94,31,44,45,16,125,126,127,128,129,130,131,132,32,33,34,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,43,149,150,151,152,153,154,155,156,157,158,159,26,160,161,162,15,163,164,165,96,166,167,168,169,170,171,172,173,95]),import.meta.url)]);f=L,m=z}}async function A(){return new f({basemap:h})}async function N(){if(t.webMap)try{if(await x(),await E(),!a()){console.error("MapView is not initialized");return}a().container=u,a().popupEnabled=!1,a().map=t.webMap,console.log("[uprn-map-view] MapView updated with new webMap"),await t.areaSelectionInteractionStore.refreshLayerView(),await t.areaSelectionInteractionStore.refreshAreas()}catch(L){console.error("Error updating MapView with new webMap:",L)}}async function E(){if(!u){console.error("Map container element was not found");return}try{a().container=u,a().popupEnabled=!1,a().map=t.webMap??void 0,a().ui.move("zoom","top-right"),await a().when(),console.log("[uprn-map-view] Map loaded successfully")}catch(L){console.error("Error loading map:",L),await q()}}async function q(){try{const L=await A();a().container=u,a().popupEnabled=!1,a().map=L,await a().when(),console.log("[uprn-map-view] Fallback map loaded")}catch(L){console.error("Error loading fallback map:",L)}}Ue(()=>{t.webMap&&N()}),Ue(()=>{!a()||l(s)||K(s,new bc(a(),t.areaSelectionInteractionStore,t.interactableLayers),!0)});function R(){a()&&a().destroy()}_a(()=>{R()});var M={getLayerViewProvider:P},H=wc();return Rt(H,L=>u=L,()=>u),F(w,H),Le(M)}var Sc=oe('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),xc=oe('<div class="flex min-h-0 flex-1 flex-col"><!></div>');function Ir(w,t){var a=xc(),s=X(a);Ee(s,()=>Pr,(u,h)=>{h(u,{class:"card-content flex min-h-0 flex-1 flex-col overflow-hidden p-0",children:(f,m)=>{var P=Sc(),x=X(P);Ye(x,()=>t.children??$e),Y(P),F(f,P)},$$slots:{default:!0}})}),Y(a),F(w,a)}var Ic=oe("<!> <!>",1),kc=oe('<div class="tab-list-wrapper flex-shrink-0 svelte-rohqkk"><!></div> <!>',1);function Cc(w,t){Me(t,!0);const a=Ne(t,"triggers",19,()=>[]);var s=ae(),u=G(s);Ee(u,()=>$o,(h,f)=>{f(h,{get value(){return t.value},get onValueChange(){return t.onValueChange},class:"flex h-full w-full flex-col",children:(m,P)=>{var x=kc(),A=G(x),N=X(A);Ee(N,()=>Yo,(q,R)=>{R(q,{class:"tab-list",children:(M,H)=>{var L=ae(),z=G(L);Bt(z,17,a,Cn,(j,W,le,re)=>{let se=()=>l(W).value,me=()=>l(W).label;var Ae=Ic(),ue=G(Ae);Ee(ue,()=>Jo,(_e,Fe)=>{Fe(_e,{get value(){return se()},class:"tab-trigger",children:(ze,Je)=>{hn();var ke=In();ht(()=>Tt(ke,me())),F(ze,ke)},$$slots:{default:!0}})});var we=he(ue,2);{var Ie=_e=>{Eo(_e,{class:"separator"})};ge(we,_e=>{se()!==a()[a().length-1]?.value&&_e(Ie)})}F(j,Ae)}),F(M,L)},$$slots:{default:!0}})}),Y(A);var E=he(A,2);Ye(E,()=>t.children??$e),F(m,x)},$$slots:{default:!0}})}),F(w,s),Le()}const Ke=Object.freeze({LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"});var Ac=oe("<!> <div><aside><div><div><!></div></div></aside></div> <!>",1);function Oc(w,t){Me(t,!0);const a=Ne(t,"position",19,()=>Ke.LEFT),s=Ne(t,"openIcon",3,gl),u=8,h="500px",f="var(--header-height, 64px)";let m,P=ne(0),x=ne(He(t.originalSize??h)),A=ne(!1),N=ne(!1);const E=fe(()=>a()===Ke.LEFT||a()===Ke.RIGHT),q=fe(()=>a()===Ke.LEFT||a()===Ke.TOP),R=fe(()=>l(E)?"500px":"100px"),M=fe(()=>t.minSize??l(R)),H=fe(()=>parseFloat(l(M))),L=fe(()=>l(E)?"width":"height"),z=fe(()=>l(E)?"ew-resize":"ns-resize");Ue(()=>{l(N)||(K(x,t.originalSize??l(M),!0),console.log("Sidebar size updated due to minSize/originalSize change:",l(x),t.originalSize))}),xn(()=>{if(!m)return;const de=new ResizeObserver(ve=>{for(const Te of ve)K(P,l(E)?Te.contentRect.width:Te.contentRect.height,!0)});return de.observe(m),()=>de.disconnect()});function j(de){if(!t.isOpen)return;K(A,!0),de.preventDefault();const ve=l(E)?de.clientX:de.clientY,Te=parseFloat(l(x));function lt(vt){const Ge=l(E)?vt.clientX:vt.clientY,ye=l(q)?Ge-ve:ve-Ge,qe=Math.max(l(H),Te+ye);K(x,`${qe}px`),K(N,!0)}function ee(){K(A,!1),document.removeEventListener("mousemove",lt),document.removeEventListener("mouseup",ee),document.body.style.cursor="",document.body.style.userSelect=""}document.addEventListener("mousemove",lt),document.addEventListener("mouseup",ee),document.body.style.cursor=l(z),document.body.style.userSelect="none"}const W=fe(()=>()=>{const de=t.isOpen?l(x):"0px";return{[Ke.LEFT]:{top:f,left:de},[Ke.RIGHT]:{top:f,right:de},[Ke.TOP]:{top:de},[Ke.BOTTOM]:{bottom:de}}[a()]}),le=fe(()=>()=>({[Ke.LEFT]:vl,[Ke.RIGHT]:Qo,[Ke.TOP]:pl,[Ke.BOTTOM]:hl})[a()]),re=fe(()=>()=>{if(!t.isOpen)return{};const de=`${u}px`,ve=t.isOpen?`calc(${l(x)} + ${-u/2}px)`:"0px";return{[Ke.LEFT]:{left:ve,top:"0",width:de,height:"100%"},[Ke.RIGHT]:{right:ve,top:"0",width:de,height:"100%"},[Ke.TOP]:{top:ve,left:"0",height:de,width:"100%"},[Ke.BOTTOM]:{bottom:ve,left:"0",height:de,width:"100%"}}[a()]});function se(de){return Object.entries(de).map(([ve,Te])=>`${ve}: ${Te}`).join("; ")}const me=fe(()=>l(q)?0:1),Ae=fe(()=>()=>t.isOpen?"translate(0, 0)":{[Ke.LEFT]:`translate(-${l(x)}, 0)`,[Ke.RIGHT]:`translate(${l(x)}, 0)`,[Ke.TOP]:`translate(0, -${l(x)})`,[Ke.BOTTOM]:`translate(0, ${l(x)})`}[a()]),ue=fe(()=>()=>{const de=t.isOpen?l(x):"0px";return{[l(L)]:de,order:`${l(me)}`}});var we=Ac(),Ie=G(we);{let de=fe(()=>l(A)?"":"transition-all duration-300"),ve=fe(()=>se(l(W)())),Te=fe(()=>l(A)?"transition: none !important;":""),lt=fe(()=>t.isOpen?"Close sidebar":"Open sidebar");Pt(Ie,{get onclick(){return t.onToggle},variant:"default",size:"icon",get class(){return`fixed z-2 -ml-1 inline-flex size-7 
	shrink-0 items-center justify-center gap-2 overflow-hidden rounded-md bg-background text-sm
	font-medium whitespace-nowrap shadow-none outline-hidden transition-all select-none hover:bg-accent focus-visible:border-ring 
	focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:pointer-events-none disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 ${l(de)??""}`},get style(){return`${l(ve)??""}; pointer-events: auto; ${l(Te)??""}`},get"aria-label"(){return l(lt)},get"aria-expanded"(){return t.isOpen},children:(ee,vt)=>{var Ge=ae(),ye=G(Ge);{var qe=je=>{const ct=fe(()=>l(le)());var rt=ae(),Qe=G(rt);Ee(Qe,()=>l(ct),(Xe,Ze)=>{Ze(Xe,{class:"h-6 w-6 text-primary"})}),F(je,rt)},pt=je=>{const ct=fe(s);var rt=ae(),Qe=G(rt);Ee(Qe,()=>l(ct),(Xe,Ze)=>{Ze(Xe,{class:"h-6 w-6 text-primary"})}),F(je,rt)};ge(ye,je=>{t.isOpen?je(qe):je(pt,!1)})}F(ee,Ge)},$$slots:{default:!0}})}var _e=he(Ie,2);let Fe;var ze=X(_e);let Je;var ke=X(ze);let Re;var be=X(ke);let Pe;var ot=X(be);{var st=de=>{var ve=ae(),Te=G(ve);Ye(Te,()=>t.children),F(de,ve)};ge(ot,de=>{t.children&&de(st)})}Y(be),Y(ke),Y(ze),Rt(ze,de=>m=de,()=>m),Y(_e);var pe=he(_e,2);{var Be=de=>{{let ve=fe(()=>l(E)?"cursor-ew-resize":"cursor-ns-resize"),Te=fe(()=>l(A)?"":"transition-all duration-300"),lt=fe(()=>se(l(re)()));Pt(de,{get class(){return`fixed z-40 border-0 bg-transparent p-0 ring-0 transition-colors outline-none hover:!bg-primary/50 focus-visible:ring-0 ${l(ve)??""} ${l(Te)??""}`},onmousedown:j,"aria-label":"Resize sidebar by dragging",get style(){return`${l(lt)??""}; outline: none !important; box-shadow: none !important; border: none !important;`}})}};ge(pe,de=>{t.isOpen&&de(Be)})}ht((de,ve,Te,lt,ee,vt)=>{Fe=rn(_e,1,"relative z-3 h-full w-full overflow-hidden transition-all duration-300",null,Fe,de),kn(_e,ve),Je=rn(ze,1,"border-r-bg-sidebar-border relative flex border-r-1 bg-sidebar text-sidebar-foreground shadow-lg",null,Je,Te),kn(ze,`${l(L)??""}: ${l(x)??""}; transform: ${lt??""};`),Re=rn(ke,1,"flex overflow-hidden",null,Re,ee),Pe=rn(be,1,"flex overflow-hidden",null,Pe,vt)},[()=>({"h-full":l(E),"w-full":!l(E),"transition-all":!l(A),"duration-300":!l(A)}),()=>se(l(ue)()),()=>({"flex-col":l(E),"flex-row":!l(E),"h-full":l(E),"w-full":!l(E),"border-r":a()===Ke.LEFT,"border-l":a()===Ke.RIGHT,"border-b":a()===Ke.TOP,"border-t":a()===Ke.BOTTOM,"border-sidebar-border":!0,"transition-transform":!l(A),"duration-300":!l(A)}),()=>l(Ae)(),()=>({"flex-col":l(E),"flex-row":!l(E),"h-full":l(E),"w-full":!l(E)}),()=>({"flex-col":l(E),"flex-row":!l(E),"h-full":l(E),"w-full":!l(E)})]),F(w,we),Le()}var Pc=oe('<div><!> <div class="main-content svelte-f4u9lw"><!></div></div>');function Tc(w,t){Me(t,!0);const a=Ne(t,"position",19,()=>Ke.LEFT),s=fe(()=>a()===Ke.TOP||a()===Ke.BOTTOM);var u=Pc();let h;var f=X(u);Oc(f,{get isOpen(){return t.isOpen},get onToggle(){return t.onToggle},get position(){return a()},get originalSize(){return t.originalSize},get minSize(){return t.minSize},get openIcon(){return t.openIcon},children:(A,N)=>{var E=ae(),q=G(E);{var R=M=>{var H=ae(),L=G(H);Ye(L,()=>t.sidebarContent),F(M,H)};ge(q,M=>{t.sidebarContent&&M(R)})}F(A,E)},$$slots:{default:!0}});var m=he(f,2),P=X(m);{var x=A=>{var N=ae(),E=G(N);Ye(E,()=>t.mainContent),F(A,N)};ge(P,A=>{t.mainContent&&A(x)})}Y(m),Y(u),ht(A=>h=rn(u,1,"sidebar-layout svelte-f4u9lw",null,h,A),[()=>({vertical:l(s)})]),F(w,u),Le()}var Ec=oe('<div class="min-w-0 space-y-2 overflow-hidden"><!></div>'),Fc=oe('<div class="w-full flex-1 overflow-hidden pr-1.5 pl-1.5"><!></div>');function Dc(w,t){var a=Fc(),s=X(a);Ia(s,{class:"h-full w-full",children:(u,h)=>{var f=Ec(),m=X(f);{var P=x=>{var A=ae(),N=G(A);Ye(N,()=>t.children),F(x,A)};ge(m,x=>{t.children&&x(P)})}Y(f),F(u,f)},$$slots:{default:!0}}),Y(a),F(w,a)}var Nc=oe('<div class="w-full flex-shrink-0"><!></div>');function Mc(w,t){var a=Nc(),s=X(a);{var u=h=>{var f=ae(),m=G(f);Ye(m,()=>t.children),F(h,f)};ge(s,h=>{t.children&&h(u)})}Y(a),F(w,a)}var Lc=oe('<div class="w-full flex-shrink-0"><!></div>');function Rc(w,t){var a=Lc(),s=X(a);{var u=h=>{var f=ae(),m=G(f);Ye(m,()=>t.children),F(h,f)};ge(s,h=>{t.children&&h(u)})}Y(a),F(w,a)}class Vc{#e=ne(null);get layerId(){return l(this.#e)}set layerId(t){K(this.#e,t,!0)}#t=ne(He(new Nt));get selectedAreaIds(){return l(this.#t)}set selectedAreaIds(t){K(this.#t,t,!0)}setLayerId(t){this.layerId!==t&&(this.layerId=t,this.selectedAreaIds.clear())}addSelectedArea(t){this.selectedAreaIds.add(t)}addSelectedAreas(t){t.forEach(a=>this.selectedAreaIds.add(a))}removeSelectedArea(t){this.selectedAreaIds.delete(t)}clearSelectedAreas(){this.selectedAreaIds.clear()}exportSnapshot(){return{layerId:this.layerId,selectedAreaIds:new Nt(this.selectedAreaIds)}}}class jc{areaSelectionStore;layerViewProvider;#e=ne(He({layerView:null,areaHandles:new xt}));get selectionViewState(){return l(this.#e)}set selectionViewState(t){K(this.#e,t,!0)}#t=ne(null);get lastAddedArea(){return l(this.#t)}set lastAddedArea(t){K(this.#t,t,!0)}#n=ne(null);get lastRemovedArea(){return l(this.#n)}set lastRemovedArea(t){K(this.#n,t,!0)}#r=ne(null);get currentHoveredArea(){return l(this.#r)}set currentHoveredArea(t){K(this.#r,t,!0)}fieldInfos=[];cachedNames=new xt;constructor(t,a){this.areaSelectionStore=t,this.layerViewProvider=a,xa(()=>{Ue(()=>{this.refreshLayerView()}),Ue(()=>{this.refreshAreas()})})}async refreshLayerView(){if(!this.areaSelectionStore.layerId&&this.selectionViewState.layerView!==null){this.resetSelectedLayerView();return}if(this.selectionViewState.layerView?.layer?.id===this.areaSelectionStore.layerId||!this.areaSelectionStore.layerId)return;const t=await this.layerViewProvider.getLayerViewById(this.areaSelectionStore.layerId);t&&this.setSelectedLayerView(t)}async refreshAreas(){const t=this.selectionViewState.layerView;if(!t){this.resetSelectedAreas();return}const a=this.areaSelectionStore.selectedAreaIds,s=this.selectionViewState.areaHandles;for(const u of s.keys())a.has(u)||this.removeSelectedArea(u);for(const u of a){if(s.has(u))continue;const h=t.highlight(u,{name:"selected"});h&&this.addSelectedArea(u,h)}}setFieldInfos(t){this.fieldInfos=t}setSelectedLayerView(t){this.selectionViewState?.layerView!==t&&(this.selectionViewState={layerView:t,areaHandles:new xt},this.resetSelectedAreas())}clearSelectedLayerView(){this.selectionViewState.layerView!==null&&(this.resetSelectedAreas(),this.selectionViewState.layerView=null)}resetSelectedLayerView(){this.selectionViewState={layerView:null,areaHandles:new xt},this.resetSelectedAreas()}resetSelectedAreas(){!this.selectionViewState.layerView&&this.selectionViewState.areaHandles.size===0||(this.selectionViewState.areaHandles.values().forEach(t=>{t.remove()}),this.selectionViewState.areaHandles.clear(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null)}addSelectedArea(t,a){if(!this.selectionViewState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const s={id:t,handle:a};this.lastAddedArea=s,this.selectionViewState.areaHandles.set(t,a),this.areaSelectionStore.addSelectedArea(t)}removeSelectedArea(t){if(!this.selectionViewState){console.warn("[area-selection-interaction-store] no feature layer view is set.");return}const a=this.selectionViewState.areaHandles.get(t);if(!a){console.warn(`[area-selection-interaction-store] no handle found for area ID ${t}.`);return}this.lastRemovedArea={id:t,handle:a},a.remove(),this.selectionViewState.areaHandles.delete(t),this.areaSelectionStore.removeSelectedArea(t)}async getAreaNamesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getNameFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer;let u=this.cachedNames.get(s.uid);u||(u=new xt,this.cachedNames.set(s.uid,u));const h=new Array(t.length),f=new xt,m=[];if(t.forEach((A,N)=>{f.set(A,N);const E=u.get(A);E!==void 0?h[N]=E:m.push(A)}),m.length===0)return h.map(A=>A??"");const P=s.objectIdField,x=await s.queryFeatures({objectIds:m,outFields:[a,P],returnGeometry:!1});for(const A of x.features){const N=A.attributes[P],E=A.attributes[a],q=f.get(N);q!==void 0&&(h[q]=E??"",u.set(N,E??""))}return h.map(A=>A??"")}async getAreaCodesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getCodeFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer,u=s.objectIdField,h=await s.queryFeatures({objectIds:t,outFields:[a,u],returnGeometry:!1}),f=new Array(t.length);for(const m of h.features){const P=m.attributes[u],x=m.attributes[a],A=t.indexOf(P);A!==-1&&(f[A]=x??"")}return f.map(m=>m??"")}setHoveredArea(t,a){t!==this.currentHoveredArea?.id&&(this.currentHoveredArea&&this.clearHoveredArea(),this.currentHoveredArea={id:t,handle:a})}clearHoveredArea(){this.currentHoveredArea&&(this.currentHoveredArea?.handle.remove(),this.currentHoveredArea=null)}getNameFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.nameField;return t||(console.warn(`[area-selection-interaction-store] no name field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}getCodeFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.codeField;return t||(console.warn(`[area-selection-interaction-store] no code field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}clearSelections(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,console.log("[area-selection-interaction-store] selections cleared.")}cleanup(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,this.cachedNames.clear(),this.fieldInfos=[],console.log("[area-selection-interaction-store] cleaned up.")}}const Hc=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];class zc{#e;constructor(t){if(!t)throw new Error("UprnDownloadService endpoints configuration is required");if(!t.baseUrl||!t.healthRoute||!t.requestJobRoute||!t.requestJobStatusesRoute||!t.getAreaSelectionLimitsRoute||!t.fetchDownloadRoute)throw new Error("UprnDownloadService endpoints configuration is incomplete");this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async requestJob(t){try{console.log("[uprn-download-service] requesting job with request:",t);const a=`${this.#e.baseUrl}${this.#e.requestJobRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to request job:",s.statusText,"request:",JSON.stringify(t));return}return await s.json()}catch(a){console.error("Error requesting job:",a);return}}async requestJobStatuses(t){try{const a=`${this.#e.baseUrl}${this.#e.requestJobStatusesRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to get job statuses:",s.statusText);return}return await s.json()}catch(a){console.error("Error getting job statuses:",a);return}}async getSelectionAreaLimits(){try{const t=`${this.#e.baseUrl}${this.#e.getAreaSelectionLimitsRoute}`,a=await fetch(t);if(!a.ok){console.error("Failed to get area selection limits:",a.statusText);return}return await a.json()}catch(t){console.error("Error getting selection area limits:",t);return}}getDownloadUrl(t){const a=this.#e.baseUrl.replace(/\/+$/,""),s=this.#e.fetchDownloadRoute.replace(/\/+$/,"");return`${a}${s}/${encodeURIComponent(t)}`}}class Kc{#e;constructor(t){this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async chat(t){try{const a=`${this.#e.baseUrl}${this.#e.chatRoute}`,u=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!u.ok){console.error("Failed to send chat query:",u.statusText);return}return await u.json()}catch(a){console.error("Error sending chat query:",a);return}}async chatStream(t,a){try{const s=`${this.#e.baseUrl}${this.#e.chatStreamRoute}`,h=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!h.ok)return console.error("Failed to start chat stream:",h.statusText),!1;const f=h.body?.getReader();if(!f)return console.error("No response body reader available"),!1;const m=new TextDecoder;let P=!1;for(;!P;){const{value:x,done:A}=await f.read();if(P=A,x){const N=m.decode(x,{stream:!P});a(N)}}return!0}catch(s){return console.error("Error during chat stream:",s),!1}}}const Bc=Object.freeze({lod00World:{lod:0,scale:591657527591555e-6},lod01World:{lod:1,scale:295828763795777e-6},lod02World:{lod:2,scale:147914381897889e-6},lod03Continent:{lod:3,scale:73957190948944e-6},lod04Continent:{lod:4,scale:36978595474472e-6},lod05Countries:{lod:5,scale:18489297737236e-6},lod06Country:{lod:6,scale:9244648868618e-6},lod07StatesProvinces:{lod:7,scale:4622324434309e-6},lod08Counties:{lod:8,scale:2311162217155e-6},lod09Counties:{lod:9,scale:1155581108577e-6},lod10Country:{lod:10,scale:577790.554289},lod11MetropolitanArea:{lod:11,scale:288895.277144},lod12Cities:{lod:12,scale:144447.638572},lod13City:{lod:13,scale:72223.819286},lod14Town:{lod:14,scale:36111.909643},lod15Neighborhood:{lod:15,scale:18055.954822},lod16Streets:{lod:16,scale:9027.977411},lod17CityBlock:{lod:17,scale:4513.988705},lod18Buildings:{lod:18,scale:2256.994353},lod19Building:{lod:19,scale:1128.497176},lod20Houses:{lod:20,scale:564.248588},lod21Houses:{lod:21,scale:282.124294},lod22Houses:{lod:22,scale:141.062147},lod23HouseProperty:{lod:23,scale:70.5310735}});class qc{#e=null;#t=!1;async init(t){this.#t||(await this.#n(t),this.#t=!0)}async#n(t){const s=await(await fetch(t)).json();this.#e=s}doesFieldHaveCustomRenderer(t,a){this.#c();const s=this.#e.FeatureLayers.find(f=>f.Name===t.title);if(!s)return!1;const u=this.#e.Fields.find(f=>f.FeatureLayerId===s.Id&&f.Name===a);return u?!!this.#e.CustomRenderers_Fields.find(f=>f.FieldId===u.Id):!1}getAllFieldsWithCustomRenderers(t){this.#c();const a=this.#e.FeatureLayers.find(h=>h.Name===t.title);if(!a)return[];const s=this.#e.Fields.filter(h=>h.FeatureLayerId===a.Id),u=[];for(const h of s)this.#e.CustomRenderers_Fields.some(m=>m.FieldId===h.Id)&&u.push(h.Name);return u}async applyCustomRenderer(t,a){this.#c();const s=this.#e.FeatureLayers.find(A=>A.Name===t.title);if(!s)return;const u=this.#e.Fields.find(A=>A.FeatureLayerId===s.Id&&A.Name===a);if(!u){console.warn(`[custom-renderer-service] could not find the field ${a} for feature layer id ${s.Id}`);return}const h=this.#e.CustomRenderers_Fields.find(A=>A.FieldId===u.Id);if(!h){console.warn(`[custom-renderer-service] could not find a custom renderer field for field ${a} in feature layer id ${s.Id}`);return}const f=this.#e.CustomRenderers.find(A=>A.Id===h.CustomRendererId);if(!f)throw new Error(`Could not find a custom renderer with the id ${h.CustomRendererId}`);const m=await this.getRendererClassBreaks(f.ClassBreaksGroupId.toString()),P=await this.getRendererSymbols(f.SymbolsId.toString()),x=this.#i(f.CustomRendererType,P,m,[],a);t.renderer=x,this.setCustomOutlines(t,f.LodsGroupId)}async setCustomOutlines(t,a){const s=this.#e.CustomRenderers_Lods.filter(f=>f.GroupId===a).sort((f,m)=>f.Lod-m.Lod);if(s.length===0){console.warn(`No LODs found for LODs group id ${a}`);return}const u=[],h=Object.values(Bc);s.forEach(f=>{const m=f.OutlineWidth,P=f.Lod,x=this.#r(h,P)-1;u.push({size:m,value:h[x].scale})}),(t.renderer instanceof oa||t.renderer instanceof sa)&&this.#l(t.renderer,u)}async getRendererClassBreaks(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_ClassBreaks.filter(u=>u.GroupId===a).sort((u,h)=>u.Order-h.Order);if(s.length===0)throw new Error(`Could not find a group with the id ${t}`);return s}async getRendererSymbols(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_Symbols.find(f=>f.Id===a);if(!s)throw new Error(`Could not find a symbol with the id ${t}`);const u=this.#e.CustomRenderers_Symbols_Appearances.filter(f=>f.SymbolsId===a).sort((f,m)=>f.Order-m.Order);return{...s,Appearances:u}}#r(t,a){const s=t.findIndex(u=>u.lod===a);return s===-1?0:s<23?s+1:s}#i(t,a,s,u,h){switch(t){case 1:return this.#s(a,u);case 2:return this.#a(h,a,s,u);default:throw new Error(`Unknown renderer type: ${t}`)}}#a(t,a,s,u){const h="ClassMinValue",f="ClassMaxValue",m="SymbolColor",P="OutlineColor",x="OutlineWidth",A=a.Appearances.length,N=new oa({field:t});for(let E=0;E<A;E++){const q=s[E][h],R=s[E][f],M=a.Appearances[E][m],H=a.Appearances[E][P],L=a.Appearances[E][x];N.addClassBreakInfo({minValue:q,maxValue:R,symbol:new la({color:_r.fromHex(M),outline:new ca({color:_r.fromHex(H),width:L})})})}return this.#l(N,u),N}#s(t,a){const s="SymbolColor",u="OutlineColor",h="OutlineWidth",f=t.Appearances[0][s],m=t.Appearances[0][u],P=t.Appearances[0][h],x=new sa({symbol:new la({color:_r.fromHex(f),outline:new ca({color:_r.fromHex(m),width:P})})});return this.#l(x,a),x}#l(t,a){t.visualVariables=[{type:"size",target:"outline",valueExpression:"$view.scale",stops:a}]}#c(){if(!this.#t)throw new Error("CustomRendererService is not initialized");if(!this.#e)throw new Error("Data is not loaded")}}var Uc=oe('<div class="flex w-full items-center justify-between"><div class="font-medium">Chat</div> <div class="flex gap-1"><!> <!></div></div>'),Gc=oe("<!> <!>",1),Wc=oe("<div><!></div>");function $c(w,t){Me(t,!0);const a=Ne(t,"isOpenedOnInit",3,!1);let s=ne(!1),u=ne(He(a())),h=ne(!1),f=ne(void 0),m="300px",P="45px";Ue(()=>{l(s)||!l(f)||(l(u)&&(l(f).style.height=m),K(s,!0))});function x(){l(f)&&(K(u,!l(u)),K(h,!1),l(u)?(P=l(f).style.height,l(f).style.height=m):l(f).style.height=P)}function A(){l(f)&&(K(h,!l(h)),l(h)?(m=l(f).style.height,l(f).style.height="100%"):l(f).style.height=m)}var N=Wc(),E=X(N);Ee(E,()=>Tr,(q,R)=>{R(q,{class:"h-full w-full gap-0 rounded-none py-0 pt-0 pb-0",children:(M,H)=>{var L=Gc(),z=G(L);Ee(z,()=>us,(le,re)=>{re(le,{class:"pt-2",children:(se,me)=>{var Ae=Uc(),ue=he(X(Ae),2),we=X(ue);{var Ie=Fe=>{Pt(Fe,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:A,children:(ze,Je)=>{var ke=ae(),Re=G(ke);{var be=ot=>{Rl(ot,{class:"text-primary"})},Pe=ot=>{Ll(ot,{class:"text-primary"})};ge(Re,ot=>{l(h)?ot(be):ot(Pe,!1)})}F(ze,ke)},$$slots:{default:!0}})};ge(we,Fe=>{l(u)&&Fe(Ie)})}var _e=he(we,2);Pt(_e,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:x,children:(Fe,ze)=>{var Je=ae(),ke=G(Je);{var Re=Pe=>{Ml(Pe,{class:"text-primary"})},be=Pe=>{gs(Pe,{class:"text-primary"})};ge(ke,Pe=>{l(u)?Pe(be,!1):Pe(Re)})}F(Fe,Je)},$$slots:{default:!0}}),Y(ue),Y(Ae),F(se,Ae)},$$slots:{default:!0}})});var j=he(z,2);{var W=le=>{var re=ae(),se=G(re);Ee(se,()=>Pr,(me,Ae)=>{Ae(me,{class:"h-full min-h-[10px] w-full p-0",children:(ue,we)=>{var Ie=ae(),_e=G(Ie);Ye(_e,()=>t.children??$e),F(ue,Ie)},$$slots:{default:!0}})}),F(le,re)};ge(j,le=>{l(u)&&le(W)})}F(M,L)},$$slots:{default:!0}})}),Y(N),Rt(N,q=>K(f,q),()=>l(f)),F(w,N),Le()}class Yc{#e;#t;#n=ne(!1);#r=fe(()=>this.#e.exportSnapshot());#i=fe(()=>{const t=new xt;for(const[a,s]of this.#t.dataSelections)t.set(a,{layerId:s.layerId,selectedFieldIds:s.selectedFieldIds});return t});constructor(t,a){this.#e=t,this.#t=a,xa(()=>{Ue(()=>{console.log("[selection-tracking-store] Detected area selection change"),(async()=>{if(!l(this.#n)){console.log("[selection-tracking-store] Initial load not complete, skipping area selection effect");return}if(l(this.#r)){if(!l(this.#r).layerId){await Kn({areas:null});return}if(!l(this.#r).selectedAreaIds.size){await Kn({areas:null});return}await Kn({areas:l(this.#r)}),console.log("[selection-tracking-store] Area selection updated:",ui(l(this.#r)))}})()}),Ue(()=>{console.log("[selection-tracking-store] Detected data selection change"),(async()=>{if(!l(this.#n)){console.log("[selection-tracking-store] Initial load not complete, skipping data selection effect");return}if(!l(this.#i)||l(this.#i).size===0){console.log("[selection-tracking-store] No data selections, clearing in database"),await Kn({data:[]});return}await Kn({data:l(this.#i).values().toArray()}),console.log("[selection-tracking-store] Data selection updated:",ui(l(this.#i)))})()})})}async loadSelections(){const t=await Pa();if(!t){console.log("[selection-tracking-store] No existing selection found in database"),K(this.#n,!0);return}console.log("[selection-tracking-store] Loaded selection from database:",t),t.areas&&(this.#e.setLayerId(t.areas.layerId),console.log("[selection-tracking-store] (loadSelections) Restoring selected area IDs:",Array.from(t.areas.selectedAreaIds),"layer ID:",this.#e.layerId),this.#e.addSelectedAreas(Array.from(t.areas.selectedAreaIds))),t.data.forEach(a=>{this.#t.addSelection(a)}),K(this.#n,!0)}}var Jc=oe("<!> <!>",1),Qc=oe('<p class="p-4 text-center text-sm text-gray-500">Download service is not available.</p>'),Xc=oe("<div><!></div> <div><!></div> <div><!></div> <div><!></div>",1),Zc=oe("<div><!></div>"),eu=oe('<p class="p-4 text-center text-sm text-gray-500">AI UPRN Chatbot service is not available.</p>'),tu=oe('<div class="relative flex h-full w-full min-w-0 flex-col overflow-visible"><!> <!> <!> <!></div>'),nu=oe("<!> <!> <!> <!>",1);function rd(w,t){Me(t,!0);let a,s,u;const h=He(new xl),f=He(new Sl);let m=ne("define-areas"),P=He(new bl),x=He(new Vc),A=ne(null),N=He(new Yc(x,P)),E=ne(null),q=ne(void 0),R=ne(void 0),M=ne(void 0),H=ne(void 0),L=ne(void 0),z=ne(!1),j=ne(!1),W=ne(He(new Set)),le=ne(He(new Set)),re=ne(!0),se=He(Ke.LEFT);He(Ke.BOTTOM);let me=ne(He([])),Ae=ne(He(typeof window<"u"?window.innerWidth:1280)),ue=fe(()=>Ie(l(me),pe=>pe.originalSize)),we=fe(()=>Ie(l(me),pe=>pe.minSize));function Ie(pe,Be){if(!pe||pe.length===0)return;const ve=[...pe].sort((Te,lt)=>lt.breakpoint-Te.breakpoint).find(Te=>l(Ae)>=Te.breakpoint);return ve?Be(ve):"0"}function _e(){K(re,!l(re))}function Fe(pe){K(m,pe,!0)}function ze(){K(m,"downloads")}function Je(){x.clearSelectedAreas(),P.clearSelections(),a?.clearSelections(),s?.clearSelections(),el()}xn(async()=>{K(M,new qc,!0),await l(M).init(`${ds}/custom-renderers.json`),console.log("[uprn-2/page] CustomRendererService initialized");const pe=await Fo();await N.loadSelections();const[{default:Be}]=await Promise.all([Bn(()=>import("../chunks/Bw0t1Yok.js").then(ve=>ve.a3),__vite__mapDeps([38,1,2,3,5,39,22,40,20,6,7,41,30,42,18,19,43,8,9,10,11,23,44,45,16,31,46,47,48,24,49,50,14,51,0,4,12,13,15,17,21,25,26,27,28,29,32,33,34,35,36,37,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91]),import.meta.url)]);K(E,new Be,!0),K(A,new jc(x,new Ra(l(E))),!0),K(le,new Set((pe.serviceUprn2Config.selectionLayersNameFields||[]).map(ve=>ve.layerName)),!0),l(A).setFieldInfos(pe.serviceUprn2Config.selectionLayersNameFields||[]),K(me,pe.serviceUprn2Config.mainSidebarSizes||[],!0),K(q,new ya(pe.serviceUprn2Config.dataSelectionTreeviewConfig),!0),K(R,new ya(pe.serviceUprn2Config.areaSelectionTreeviewConfig),!0),(async()=>{const ve=pe.serviceUprn2Config.uprnDownloadServiceEndpoints,Te=pe.serviceUprn2Config.aiUprnChatbotServiceEndpoints;K(H,new zc(ve),!0),K(L,new Kc(Te),!0),K(z,await l(H).getHealth(),!0),l(z)?console.log("[uprn-2/page] UPRN Download Service is available"):console.warn("[uprn-2/page] UPRN Download Service is NOT available"),K(j,await l(L).getHealth(),!0),l(j)?console.log("[uprn-2/page] AI UPRN Chatbot Service is available"):console.warn("[uprn-2/page] AI UPRN Chatbot Service is NOT available")})(),K(W,new Set(pe.serviceUprn2Config.dataSelectionTreeviewConfig?.fieldsToHide||[]),!0),await h.initializeAsync({portalUrl:pe.serviceUprn2Config.portalUrl,itemId:pe.serviceUprn2Config.portalItemId||"",proxy:pe.serviceUprn2Config.proxy})}),xn(()=>{const pe=()=>{K(Ae,window.innerWidth,!0)};return window.addEventListener("resize",pe),()=>{window.removeEventListener("resize",pe)}}),_a(()=>{P.cleanup()});var ke=nu(),Re=G(ke);Xo(Re,{});var be=he(Re,2);$l(be,{get dataSelectionStore(){return P},get fieldFilterMenuStore(){return f},get fieldsToHide(){return l(W)}});var Pe=he(be,2);{var ot=pe=>{var Be=Jc(),de=G(Be);As(de,{get areaSelectionInteractionStore(){return l(A)}});var ve=he(de,2);Os(ve,{get areaSelectionInteractionStore(){return l(A)}}),F(pe,Be)};ge(Pe,pe=>{l(A)&&pe(ot)})}var st=he(Pe,2);{const pe=de=>{var ve=tu(),Te=X(ve);Ee(Te,()=>Mc,(Ge,ye)=>{ye(Ge,{children:(qe,pt)=>{Cc(qe,{get value(){return l(m)},get triggers(){return Hc},onValueChange:Fe})},$$slots:{default:!0}})});var lt=he(Te,2);Ee(lt,()=>Dc,(Ge,ye)=>{ye(Ge,{children:(qe,pt)=>{var je=Xc(),ct=G(je),rt=X(ct);Ir(rt,{children:(Ot,jt)=>{var it=ae(),gt=G(it);{var It=ut=>{Rt(sc(ut,{get webMap(){return h.data},get treeviewConfigStore(){return l(R)},get areaSelectionStore(){return x}}),mt=>a=mt,()=>a)};ge(gt,ut=>{h.isLoaded&&ut(It)})}F(Ot,it)}}),Y(ct);var Qe=he(ct,2),Xe=X(Qe);Ir(Xe,{children:(Ot,jt)=>{var it=ae(),gt=G(it);{var It=ut=>{{let mt=fe(()=>u?.getLayerViewProvider());Rt(yc(ut,{get webMap(){return h.data},get dataSelectionStore(){return P},get layerViewProvider(){return l(mt)},get treeviewConfigStore(){return l(q)},get customRendererService(){return l(M)},get fieldFilterMenuStore(){return f}}),Ht=>s=Ht,()=>s)}};ge(gt,ut=>{h.isLoaded&&ut(It)})}F(Ot,it)}}),Y(Qe);var Ze=he(Qe,2),et=X(Ze);Ir(et,{children:(Ot,jt)=>{var it=ae(),gt=G(it);{var It=ut=>{Dl(ut,{get webMapStore(){return h},get areaSelectionInteractionStore(){return l(A)},get dataSelectionStore(){return P},get dataSelectionTreeviewConfig(){return l(q)},get fieldFilterMenuStore(){return f}})};ge(gt,ut=>{l(A)&&h.isLoaded&&ut(It)})}F(Ot,it)}}),Y(Ze);var At=he(Ze,2),Vt=X(At);Ir(Vt,{children:(Ot,jt)=>{var it=ae(),gt=G(it);{var It=mt=>{var Ht=Qc();F(mt,Ht)},ut=mt=>{fl(mt,{get webMapStore(){return h},get uprnDownloadService(){return l(H)},get fieldsToHide(){return l(W)}})};ge(gt,mt=>{!l(H)||!l(z)?mt(It):mt(ut,!1)})}F(Ot,it)}}),Y(At),ht(()=>{ct.hidden=l(m)!=="define-areas",Qe.hidden=l(m)!=="select-data",Ze.hidden=l(m)!=="export",At.hidden=l(m)!=="downloads"}),F(qe,je)},$$slots:{default:!0}})});var ee=he(lt,2);Ee(ee,()=>Rc,(Ge,ye)=>{ye(Ge,{children:(qe,pt)=>{var je=Zc(),ct=X(je);{var rt=Qe=>{_l(Qe,{onExportSuccess:ze,clearSelections:Je,get areaSelectionInteractionStore(){return l(A)},get dataSelectionStore(){return P}})};ge(ct,Qe=>{l(A)&&Qe(rt)})}Y(je),ht(()=>je.hidden=l(m)!=="export"),F(qe,je)},$$slots:{default:!0}})});var vt=he(ee,2);$c(vt,{isOpenedOnInit:!0,children:(Ge,ye)=>{var qe=ae(),pt=G(qe);{var je=rt=>{var Qe=eu();F(rt,Qe)},ct=rt=>{$s(rt,{get aiUprnChatbotService(){return l(L)}})};ge(pt,rt=>{!l(L)||!l(j)?rt(je):rt(ct,!1)})}F(Ge,qe)},$$slots:{default:!0}}),Y(ve),F(de,ve)},Be=de=>{var ve=ae(),Te=G(ve);{var lt=ee=>{Rt(_c(ee,{get webMap(){return h.data},get mapView(){return l(E)},get areaSelectionInteractionStore(){return l(A)},get interactableLayers(){return l(le)}}),vt=>u=vt,()=>u)};ge(Te,ee=>{l(A)&&ee(lt)})}F(de,ve)};Ee(st,()=>Tc,(de,ve)=>{ve(de,{get isOpen(){return l(re)},onToggle:_e,get position(){return se},get originalSize(){return l(ue)},get minSize(){return l(we)},sidebarContent:pe,mainContent:Be,$$slots:{sidebarContent:!0,mainContent:!0}})})}F(w,ke),Le()}export{rd as component};
