const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/BEZFO2vt.js","../chunks/BW0zoJTm.js","../chunks/CEBETtrS.js","../chunks/CaNW5Bx0.js","../chunks/CjBjO1Km.js","../chunks/PPVm8Dsz.js","../chunks/BUsxo-Ec.js","../chunks/D0nkGZIM.js","../chunks/CVQPxYbx.js","../chunks/DwerzRSF.js","../chunks/y1GB1Svy.js","../chunks/AlyPEkJM.js","../chunks/DFYTeVXP.js","../chunks/Cn9cIaVC.js","../chunks/BTNr9f9k.js","../chunks/EmFT8XhJ.js","../chunks/jYVHtrPb.js","../chunks/Cp_8tW2x.js","../chunks/BAWfW4Tu.js","../chunks/CumW50Sh.js","../chunks/Ci6C1k20.js","../chunks/bnayRBMH.js","../chunks/TJ-VhDZ5.js","../chunks/B0gOzRRh.js","../chunks/TW8D_o5j.js","../chunks/Oe6SV2kF.js","../chunks/B_yBz6pZ.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/CW6Redn4.js","../chunks/BnQsZfR4.js","../chunks/BYduSOTS.js","../chunks/PJHcqbvL.js","../chunks/DS2ZxNQA.js","../chunks/Djp3mnm5.js","../chunks/DjNaDsmS.js","../chunks/C-w03I0l.js","../chunks/CZyMpCUL.js","../chunks/D9kT-sgB.js","../chunks/Bu0s_rAF.js","../chunks/B87vTgcy.js","../chunks/C3_gy5al.js","../chunks/CfBiQUdY.js","../chunks/BABeDC_w.js","../chunks/Dj-cqQsY.js","../chunks/B128_oTY.js","../chunks/7808le4B.js","../chunks/BwN_j92a.js","../chunks/Bde99gqs.js","../chunks/C7fxqwFZ.js","../chunks/CVwTD0fV.js","../chunks/9eAP65Ji.js","../chunks/mOc398RU.js","../chunks/DPJXGPFY.js","../chunks/B8cN3yAo.js","../chunks/BIj_QgNJ.js","../chunks/q_b6UJoq.js","../chunks/CYI1luaL.js","../chunks/DTEZVyiP.js","../chunks/BCTmL8G8.js","../chunks/DqwAHjQA.js","../chunks/CFxQi9ff.js","../chunks/Ba6e521d.js","../chunks/B45SJMf_.js","../chunks/DvKU1K2H.js","../assets/jsxFactory.CQED0rIl.css","../chunks/CRNKQexD.js","../chunks/DfDynnwy.js","../chunks/Ch4klalT.js","../chunks/0N6-HNAU.js","../chunks/BqXNu7b5.js","../chunks/48RKFPo7.js","../chunks/CTnd5cvu.js","../chunks/PWd9QCpP.js","../chunks/Cgb6qxNH.js","../chunks/fxczVhmx.js","../chunks/_r5V6nso.js","../chunks/TQki0tx9.js","../chunks/B934cuUn.js","../chunks/C1gSvD9v.js","../chunks/CaVKkSa6.js","../chunks/Bb7XCc95.js","../chunks/BrT4CCe6.js","../chunks/B1N-tmtC.js","../chunks/CEtlHNOR.js","../chunks/BZKeGk9D.js","../chunks/D-qJO60r.js","../chunks/QQC62dOK.js","../chunks/Bxxl7NsE.js","../chunks/BpZHOvkG.js","../chunks/DQOO6RKE.js","../chunks/B21jgz5M.js","../chunks/Bi6C4OG6.js","../chunks/teoI27Zt.js","../chunks/D-YQ4CHs.js","../chunks/DpAKiq6K.js","../chunks/XEmGDYB_.js","../chunks/BVFIxAn9.js","../chunks/CAO_3SU9.js","../chunks/CglP3OMz.js","../chunks/DCBLidga.js","../chunks/DhMSIuCj.js","../chunks/CSXZNpHb.js","../chunks/xXH_AyYh.js","../chunks/CHAiFIco.js","../chunks/6Jo1niE7.js","../chunks/DjNuiUVf.js","../chunks/CpqG7TFG.js","../chunks/D_dxbuU-.js","../chunks/jQbrml54.js","../chunks/uHWM1awI.js","../chunks/CYEJx0Wq.js","../chunks/BteoTDFn.js","../chunks/B7Ex7sMf.js","../chunks/DocBEfKB.js","../chunks/B2jVc7id.js","../chunks/Da4sQo3R.js","../chunks/CAGdFHZB.js","../chunks/DzvuCIKa.js","../chunks/Bu0Dv00G.js","../chunks/Bo5l4fk8.js","../chunks/TEMnSu_8.js","../chunks/CQmZIYPi.js","../chunks/DsEHuRPb.js","../chunks/BARRAGjD.js","../chunks/DwIB5gq4.js","../chunks/BjGHVp5Q.js","../chunks/lEIzcqu9.js","../chunks/CtIxBnU3.js","../chunks/gJDQstGQ.js","../chunks/Cl8hT7Dy.js","../chunks/hngUoOdp.js","../chunks/BlT3hoGo.js","../chunks/DZpEp5b3.js","../chunks/GKolV7NZ.js","../chunks/PiqJyY-Z.js","../chunks/CWQ4Sji6.js","../chunks/Cc8znHts.js","../chunks/C9Yzh9th.js","../chunks/CMFr2xVw.js","../chunks/B8kDL1f4.js","../chunks/Bo-exx2O.js","../chunks/BFHafdW6.js","../chunks/D5cGnOsZ.js","../chunks/CCtOv0E5.js","../chunks/DhzudQro.js","../chunks/Qzt__3Yd.js","../chunks/mx71iuXv.js","../chunks/E5yhiq2t.js","../chunks/B2om5830.js","../chunks/CrUuvTSr.js","../chunks/DNQVkPqp.js","../chunks/WCLBMBm-.js","../chunks/BveQ3Yw2.js","../chunks/EGFv0f86.js","../chunks/BDRaqLVR.js","../chunks/BlaSF0Se.js","../chunks/mBdPBegd.js","../chunks/Cu3emot3.js","../chunks/qyF9FwQ9.js","../chunks/XI-Li77m.js","../chunks/DS8kW6UP.js","../chunks/1BM1gK8E.js","../chunks/DPb6J-GU.js","../chunks/BxTLSXBH.js","../chunks/BGyY2giR.js","../chunks/D28RTRrm.js","../chunks/C65Zrur8.js","../chunks/DwnB9djr.js","../chunks/CUTkbj50.js","../chunks/DE7psHTV.js","../chunks/Fla_WrMr.js","../chunks/CVRs03iK.js","../chunks/g8mGjH5g.js","../chunks/D1UBzOg5.js","../chunks/C8HgMPMV.js","../chunks/BqUxlKJa.js","../chunks/CzWdKr8p.js","../chunks/C2FvnhIN.js","../chunks/B0DG5wVw.js","../chunks/CaYZrGFV.js"])))=>i.map(i=>d[i]);
import{_ as Vr}from"../chunks/PPVm8Dsz.js";import"../chunks/DsnmJJEf.js";import{o as Rr,a as ya}from"../chunks/B12Xl85d.js";import{R as co,E as uo,b9 as fo,ba as ho,z as vo,o as po,bb as go,bc as mo,bd as yo,Y as ba,aB as bo,B as wo,n as Ke,a8 as Ce,v as u,ar as B,p as De,f as X,a as Ne,c as ee,r as $,aG as ne,av as Re,u as je,T as ct,a7 as ue,W as ur,b8 as wa}from"../chunks/l2HDBFeU.js";import{p as _o,c as de,a as T,f as ae,t as wr}from"../chunks/D3mgKXxP.js";import{p as Ve,i as he,r as Tt,s as Rt,l as _a}from"../chunks/amrQSy0T.js";import{c as Oe}from"../chunks/BULd4hFL.js";import{b as Lt}from"../chunks/CPWKExeQ.js";import{b as So,s as Ct}from"../chunks/CPxvWa6q.js";import{a as Sn,d as xn,s as hi,b as vi,e as xo}from"../chunks/B2XAts-z.js";import{C as In}from"../chunks/CJ2y2uxK.js";import{C as kn}from"../chunks/Cgb8ZoOw.js";import{t as Mr,k as Io,l as ko,m as Co,L as Ao,n as Po,S as Ft,h as Oo,i as Eo,C as Ji,j as Fo,I as To,G as Qi,F as $i,b as Do,O as Sa,a as No,d as xa,c as hn,o as Vo,q as Lo,M as Ro,V as Xi,f as Mo,e as jo,g as Ho,p as Ko}from"../chunks/C9zeASjK.js";import{s as Qe,e as qt,i as _r}from"../chunks/Dv6QOWAw.js";import{g as qo,e as Cn}from"../chunks/7Q11sfri.js";import{c as Kr,B as Nt}from"../chunks/Cycc-Qfx.js";import{C as Bo,D as zo,x as Uo,F as Go,k as Wo,a as vn,m as Yo,S as wt}from"../chunks/p_qY5EvW.js";import{I as xr}from"../chunks/D9YRtp1B.js";import{I as Jo}from"../chunks/BhD6znWj.js";import{S as Ia,I as ka,s as Ca,j as ai,f as Qo,g as $o,h as Xo,i as Zo}from"../chunks/xE6fRQiE.js";import{S as es}from"../chunks/DqC0T5S3.js";import{c as ts,g as rs}from"../chunks/Cpj98o6Y.js";import"../chunks/Cq3Rk-Cw.js";import{b as ns}from"../chunks/DJwqbrH9.js";import"../chunks/B17Q6ahh.js";import"../chunks/69_IOA4Y.js";import{b as is}from"../chunks/DpAKiq6K.js";import as from"../chunks/EmFT8XhJ.js";import{s as Zi}from"../chunks/CEBETtrS.js";import{O as os}from"../chunks/D0nkGZIM.js";import{h as jr}from"../chunks/fvInIvwb.js";import{X as ss,a as ls,b as cs,C as us,g as ds}from"../chunks/B6ZgDL00.js";import{b as ea}from"../chunks/BTNr9f9k.js";import"../chunks/f0xzAPHF.js";import{l as fs}from"../chunks/DwerzRSF.js";import ta from"../chunks/DhMSIuCj.js";import"../chunks/CaNW5Bx0.js";import"../chunks/BW0zoJTm.js";import"../chunks/bnayRBMH.js";import"../chunks/Bu0Dv00G.js";import"../chunks/Bo5l4fk8.js";import"../chunks/DwIB5gq4.js";import"../chunks/C7fxqwFZ.js";import"../chunks/48RKFPo7.js";import{d as hs,a as ra,S as vs}from"../chunks/Kx36ldNz.js";import{c as ps}from"../chunks/DzE4wJgV.js";import"../chunks/lEIzcqu9.js";import{j as na}from"../chunks/CrUuvTSr.js";import{p as ia}from"../chunks/BjGHVp5Q.js";import{a as aa,m as oa}from"../chunks/mOc398RU.js";import{u as pn}from"../chunks/CumW50Sh.js";import{C as gs}from"../chunks/DZKQrLuw.js";import{C as ms}from"../chunks/DKLaM0Lv.js";const ys=()=>performance.now(),Wt={tick:I=>requestAnimationFrame(I),now:()=>ys(),tasks:new Set};function Aa(){const I=Wt.now();Wt.tasks.forEach(t=>{t.c(I)||(Wt.tasks.delete(t),t.f())}),Wt.tasks.size!==0&&Wt.tick(Aa)}function bs(I){let t;return Wt.tasks.size===0&&Wt.tick(Aa),{promise:new Promise(a=>{Wt.tasks.add(t={c:I,f:a})}),abort(){Wt.tasks.delete(t)}}}function gn(I,t){ba(()=>{I.dispatchEvent(new CustomEvent(t))})}function ws(I){if(I==="float")return"cssFloat";if(I==="offset")return"cssOffset";if(I.startsWith("--"))return I;const t=I.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function sa(I){const t={},a=I.split(";");for(const s of a){const[c,f]=s.split(":");if(!c||f===void 0)break;const h=ws(c.trim());t[h]=f.trim()}return t}const _s=I=>I;function wn(I,t,a,s){var c=(I&mo)!==0,f=(I&yo)!==0,h=c&&f,b=(I&go)!==0,P=h?"both":c?"in":"out",C,O=t.inert,D=t.style.overflow,N,W;function M(){return ba(()=>C??=a()(t,s?.()??{},{direction:P}))}var L={is_global:b,in(){if(t.inert=O,!c){W?.abort(),W?.reset?.();return}f||N?.abort(),gn(t,"introstart"),N=oi(t,M(),W,1,()=>{gn(t,"introend"),N?.abort(),N=C=void 0,t.style.overflow=D})},out(j){if(!f){j?.(),C=void 0;return}t.inert=!0,gn(t,"outrostart"),W=oi(t,M(),N,0,()=>{gn(t,"outroend"),j?.()})},stop:()=>{N?.abort(),W?.abort()}},K=co;if((K.transitions??=[]).push(L),c&&So){var V=b;if(!V){for(var H=K.parent;H&&(H.f&uo)!==0;)for(;(H=H.parent)&&(H.f&fo)===0;);V=!H||(H.f&ho)!==0}V&&vo(()=>{po(()=>L.in())})}}function oi(I,t,a,s,c){var f=s===1;if(bo(t)){var h,b=!1;return wo(()=>{if(!b){var K=t({direction:f?"in":"out"});h=oi(I,K,a,s,c)}}),{abort:()=>{b=!0,h?.abort()},deactivate:()=>h.deactivate(),reset:()=>h.reset(),t:()=>h.t()}}if(a?.deactivate(),!t?.duration)return c(),{abort:Ke,deactivate:Ke,reset:Ke,t:()=>s};const{delay:P=0,css:C,tick:O,easing:D=_s}=t;var N=[];if(f&&a===void 0&&(O&&O(0,1),C)){var W=sa(C(0,1));N.push(W,W)}var M=()=>1-s,L=I.animate(N,{duration:P,fill:"forwards"});return L.onfinish=()=>{L.cancel();var K=a?.t()??1-s;a?.abort();var V=s-K,H=t.duration*Math.abs(V),j=[];if(H>0){var U=!1;if(C)for(var le=Math.ceil(H/16.666666666666668),te=0;te<=le;te+=1){var oe=K+V*D(te/le),ve=sa(C(oe,1-oe));j.push(ve),U||=ve.overflow==="hidden"}U&&(I.style.overflow="hidden"),M=()=>{var Ie=L.currentTime;return K+V*D(Ie/H)},O&&bs(()=>{if(L.playState!=="running")return!1;var Ie=M();return O(Ie,1-Ie),!0})}L=I.animate(j,{duration:H,fill:"forwards"}),L.onfinish=()=>{M=()=>s,O?.(s,1-s),c()}},{abort:()=>{L&&(L.cancel(),L.effect=null,L.onfinish=Ke)},deactivate:()=>{c=Ke},reset:()=>{s===0&&O?.(1,0)},t:()=>M()}}const Ss=Go({component:"avatar",parts:["root","image","fallback"]}),xs=new Bo("Avatar.Root");class pi{static create(t){return xs.set(new pi(t))}opts;domContext;attachment;constructor(t){this.opts=t,this.domContext=new zo(this.opts.ref),this.loadImage=this.loadImage.bind(this),this.attachment=Uo(this.opts.ref)}loadImage(t,a,s){if(this.opts.loadingStatus.current==="loaded")return;let c;const f=new Image;return f.src=t,a!==void 0&&(f.crossOrigin=a),s&&(f.referrerPolicy=s),this.opts.loadingStatus.current="loading",f.onload=()=>{c=this.domContext.setTimeout(()=>{this.opts.loadingStatus.current="loaded"},this.opts.delayMs.current)},f.onerror=()=>{this.opts.loadingStatus.current="error"},()=>{c&&this.domContext.clearTimeout(c)}}#e=Ce(()=>({id:this.opts.id.current,[Ss.root]:"","data-status":this.opts.loadingStatus.current,...this.attachment}));get props(){return u(this.#e)}set props(t){B(this.#e,t)}}var Is=ae("<div><!></div>");function ks(I,t){const a=_o();De(t,!0);let s=Ve(t,"delayMs",3,0),c=Ve(t,"loadingStatus",15,"loading"),f=Ve(t,"id",19,()=>Wo(a)),h=Ve(t,"ref",15,null),b=Tt(t,["$$slots","$$events","$$legacy","delayMs","loadingStatus","onLoadingStatusChange","child","children","id","ref"]);const P=pi.create({delayMs:vn(()=>s()),loadingStatus:vn(()=>c(),M=>{c()!==M&&(c(M),t.onLoadingStatusChange?.(M))}),id:vn(()=>f()),ref:vn(()=>h(),M=>h(M))}),C=Ce(()=>Yo(b,P.props));var O=de(),D=X(O);{var N=M=>{var L=de(),K=X(L);Qe(K,()=>t.child,()=>({props:u(C)})),T(M,L)},W=M=>{var L=Is();Sn(L,()=>({...u(C)}));var K=ee(L);Qe(K,()=>t.children??Ke),$(L),T(M,L)};he(D,M=>{t.child?M(N):M(W,!1)})}T(I,O),Ne()}var Cs=ae('<p class="text-sm font-medium"> </p>'),As=ae('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function Ps(I,t){De(t,!0);let a=ne(null),s=ne(Re({x:0,y:0})),c=0;const f=C=>{B(s,{x:C.clientX,y:C.clientY},!0)};je(()=>(document.addEventListener("mousemove",f),()=>{document.removeEventListener("mousemove",f)})),je(()=>{const C=t.areaSelectionInteractionStore.currentHoveredArea?.id,O=++c;if(!C){B(a,null);return}(async()=>{const D=await t.areaSelectionInteractionStore.getAreaNamesById([C]);O===c&&t.areaSelectionInteractionStore.currentHoveredArea?.id===C&&B(a,D[0]??null,!0)})()});var h=de(),b=X(h);{var P=C=>{var O=As(),D=ee(O);Oe(D,()=>In,(N,W)=>{W(N,{class:"max-w-xs border !py-2 shadow-lg",children:(M,L)=>{var K=de(),V=X(K);Oe(V,()=>kn,(H,j)=>{j(H,{class:"!px-3 !py-0",children:(U,le)=>{var te=Cs(),oe=ee(te,!0);$(te),ct(()=>Ct(oe,u(a))),T(U,te)},$$slots:{default:!0}})}),T(M,K)},$$slots:{default:!0}})}),$(O),ct(()=>xn(O,`left: ${u(s).x+10}px; top: ${u(s).y-10}px;`)),T(C,O)};he(b,C=>{u(a)&&C(P)})}T(I,h),Ne()}function Os(I,t){De(t,!0);async function a(s,c){const f=await t.areaSelectionInteractionStore.getAreaNamesById([s]);if(!f||f.length===0||!f[0])return;const h=`Area ${c}: ${f[0]}`;Mr.success(h)}je(()=>{t.areaSelectionInteractionStore.lastAddedArea&&a(t.areaSelectionInteractionStore.lastAddedArea.id,"added")}),je(()=>{t.areaSelectionInteractionStore.lastRemovedArea&&a(t.areaSelectionInteractionStore.lastRemovedArea.id,"removed")}),Ne()}var Es=ae("<div><!></div>");function la(I,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Tt(t,["$$slots","$$events","$$legacy","ref","variant","children"]);var c=Es();Sn(c,()=>({...s,class:"group/chat-bubble flex max-w-[80%] flex-row place-items-end gap-2 data-[variant='sent']:place-self-end","data-variant":t.variant}));var f=ee(c);Qe(f,()=>t.children??Ke),$(c),Lt(c,h=>a(h),()=>a()),T(I,c),Ne()}var Fs=ae('<span class="inline-block size-(--loading-dots-size) rounded-full bg-primary svelte-k2x6sv"></span>'),Ts=ae('<div class="inline-flex items-center gap-1 svelte-k2x6sv"></div>');function Ds(I,t){let a=Ve(t,"size",3,4);var s=Ts();let c;qt(s,20,()=>({length:3}),_r,(f,h)=>{var b=Fs();T(f,b)}),$(s),ct(f=>c=xn(s,"",c,f),[()=>({"--loading-dots-size":`${a()??""}px`})]),T(I,s)}var Ns=ae('<div class="flex size-full place-items-center justify-center"><!></div>'),Vs=ae("<div><!></div>");function ii(I,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Ve(t,"typing",3,!1),c=Tt(t,["$$slots","$$events","$$legacy","ref","typing","class","children"]);var f=Vs();Sn(f,C=>({...c,class:C}),[()=>Kr("order-2 rounded-lg bg-secondary p-4 text-sm group-data-[variant='received']/chat-bubble:rounded-bl-none group-data-[variant='sent']/chat-bubble:order-1 group-data-[variant='sent']/chat-bubble:rounded-br-none group-data-[variant='sent']/chat-bubble:bg-primary group-data-[variant='sent']/chat-bubble:text-primary-foreground",t.class)]);var h=ee(f);{var b=C=>{var O=Ns(),D=ee(O);Ds(D,{}),$(O),T(C,O)},P=C=>{var O=de(),D=X(O);Qe(D,()=>t.children??Ke),T(C,O)};he(h,C=>{s()?C(b):C(P,!1)})}$(f),Lt(f,C=>a(C),()=>a()),T(I,f),Ne()}function Ls(I,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Tt(t,["$$slots","$$events","$$legacy","ref","class"]);var c=de(),f=X(c);{let h=Ce(()=>Kr("relative flex size-8 shrink-0 overflow-hidden rounded-full",t.class));Oe(f,()=>ks,(b,P)=>{P(b,Rt({"data-slot":"avatar",get class(){return u(h)}},()=>s,{get ref(){return a()},set ref(C){a(C)}}))})}T(I,c),Ne()}function ca(I,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Tt(t,["$$slots","$$events","$$legacy","ref","class"]);{let c=Ce(()=>Kr("order-1 group-data-[variant='sent']/chat-bubble:order-2",t.class));Ls(I,Rt({get class(){return u(c)}},()=>s,{get ref(){return a()},set ref(f){a(f)}}))}Ne()}function Rs(I,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];xr(I,Rt({name:"arrow-down"},()=>a,{get iconNode(){return s},children:(c,f)=>{var h=de(),b=X(h);Qe(b,()=>t.children??Ke),T(c,h)},$$slots:{default:!0}})),Ne()}function Pa(I){const t=I-1;return t*t*t+1}function ua(I,{delay:t=0,duration:a=400,easing:s=Pa,axis:c="y"}={}){const f=getComputedStyle(I),h=+f.opacity,b=c==="y"?"height":"width",P=parseFloat(f[b]),C=c==="y"?["top","bottom"]:["left","right"],O=C.map(V=>`${V[0].toUpperCase()}${V.slice(1)}`),D=parseFloat(f[`padding${O[0]}`]),N=parseFloat(f[`padding${O[1]}`]),W=parseFloat(f[`margin${O[0]}`]),M=parseFloat(f[`margin${O[1]}`]),L=parseFloat(f[`border${O[0]}Width`]),K=parseFloat(f[`border${O[1]}Width`]);return{delay:t,duration:a,easing:s,css:V=>`overflow: hidden;opacity: ${Math.min(V*20,1)*h};${b}: ${V*P}px;padding-${C[0]}: ${V*D}px;padding-${C[1]}: ${V*N}px;margin-${C[0]}: ${V*W}px;margin-${C[1]}: ${V*M}px;border-${C[0]}-width: ${V*L}px;border-${C[1]}-width: ${V*K}px;min-${b}: 0`}}function da(I,{delay:t=0,duration:a=400,easing:s=Pa,start:c=0,opacity:f=0}={}){const h=getComputedStyle(I),b=+h.opacity,P=h.transform==="none"?"":h.transform,C=1-c,O=b*(1-f);return{delay:t,duration:a,easing:s,css:(D,N)=>`
			transform: ${P} scale(${1-C*N});
			opacity: ${b-O*N}
		`}}class Ms{#e=ne();#t=ne(0);#r=ne(!1);lastScrollHeight=0;set ref(t){if(B(this.#e,t,!0),!u(this.#e))return;this.lastScrollHeight=u(this.#e).scrollHeight,u(this.#e).scrollTo(0,u(this.#t)?u(this.#t):u(this.#e).scrollHeight),u(this.#e).addEventListener("scroll",()=>{u(this.#e)&&(B(this.#t,u(this.#e).scrollTop,!0),this.disableAutoScroll())}),window.addEventListener("resize",()=>{this.scrollToBottom(!0)}),new MutationObserver(()=>{u(this.#e)&&(u(this.#e).scrollHeight!==this.lastScrollHeight&&this.scrollToBottom(!0),this.lastScrollHeight=u(this.#e).scrollHeight)}).observe(u(this.#e),{childList:!0,subtree:!0})}get ref(){return u(this.#e)}get scrollY(){return u(this.#t)}get isAtBottom(){return u(this.#e)?u(this.#t)+u(this.#e).offsetHeight>=u(this.#e).scrollHeight:!0}disableAutoScroll(){this.isAtBottom?B(this.#r,!1):B(this.#r,!0)}scrollToBottom(t=!1){u(this.#e)&&(t&&u(this.#r)||u(this.#e).scrollTo(0,u(this.#e).scrollHeight))}}var js=ae("<div><!></div>"),Hs=ae('<div class="relative"><div><!></div> <!></div>');function Ks(I,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Tt(t,["$$slots","$$events","$$legacy","ref","children","class"]),c=ne(!1);const f=new Ms;Rr(()=>{B(c,!0)});var h=Hs(),b=ee(h);Sn(b,D=>({...s,class:D}),[()=>Kr("no-scrollbar flex h-full w-full flex-col gap-4 overflow-y-auto p-4",t.class,{"scroll-smooth":u(c)})]);var P=ee(b);Qe(P,()=>t.children??Ke),$(b),Lt(b,D=>a(D),()=>a()),Lt(b,D=>f.ref=D,()=>f?.ref);var C=ue(b,2);{var O=D=>{var N=js(),W=ee(N);Nt(W,{onclick:()=>f.scrollToBottom(),variant:"outline",size:"icon",class:"absolute bottom-2 left-1/2 inline-flex -translate-x-1/2 transform rounded-full shadow-md",children:(M,L)=>{Rs(M,{})},$$slots:{default:!0}}),$(N),wn(1,N,()=>da,()=>({start:.85,duration:100,delay:250})),wn(2,N,()=>da,()=>({start:.85,duration:100})),T(D,N)};he(C,D=>{f.isAtBottom||D(O)})}$(h),T(I,h),Ne()}function qs(I,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];xr(I,Rt({name:"send"},()=>a,{get iconNode(){return s},children:(c,f)=>{var h=de(),b=X(h);Qe(b,()=>t.children??Ke),T(c,h)},$$slots:{default:!0}})),Ne()}var Bs=ae(`<p class="break-words whitespace-pre-wrap"> </p> <div class="w-full text-xs group-data-[variant='sent']/chat-bubble:text-end"> </div>`,1),zs=ae("<!> <!>",1),Us=ae('<p class="break-words whitespace-pre-wrap"> </p>'),Gs=ae("<!> <!>",1),Ws=ae("<!> <!>",1),Ys=ae('<div class="chat-container h-full w-full border border-border svelte-1osgd7m"><div class="message-wrapper svelte-1osgd7m"><!></div> <div class="input-wrapper svelte-1osgd7m"><form class="flex shrink-0 items-center gap-2 border-t border-border bg-background p-2"><!> <!></form></div></div>');function Js(I,t){De(t,!0);const a=1,s=2,c="Sorry, I encountered an error processing your request.",f="How can I help?";let h=ne(""),b=ne(!1),P=ne(""),C=ne(null),O=ne(null),D=ne(null);const N=Re([{senderId:a,message:f,sentAt:W(new Date)}]);je(()=>{if(u(O)&&u(D)){const ce=u(O),ye=u(D),Se=()=>{const Fe=ce.offsetHeight;ye.style.paddingBottom=`${Fe}px`};Se();const _e=new ResizeObserver(Se);return _e.observe(ce),()=>{_e.disconnect()}}}),je(()=>{N.length,u(P),u(C)&&setTimeout(()=>{const ce=u(C)?.querySelector('[data-slot="scroll-area-viewport"]');ce&&(ce.scrollTop=ce.scrollHeight)},0)});function W(ce){const ye=ce.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Se=ce.getHours()>=12?"PM":"AM";return`${ye} ${Se}`}function M(ce,ye){return{message:ce,senderId:ye,sentAt:W(new Date)}}function L(ce,ye){N.push(M(ce,ye))}function K(){B(b,!1),B(P,"")}function V(ce){B(P,u(P)+ce)}async function H(ce){if(ce.preventDefault(),!u(h).trim()||u(b))return;const ye=u(h).trim();B(h,""),L(ye,s),B(b,!0),B(P,"");try{await t.aiUprnChatbotService.chatStream(ye,V)&&u(P)?L(u(P),a):L(c,a)}catch(Se){console.error("Chat error:",Se),L(c,a)}finally{K()}}var j=Ys(),U=ee(j),le=ee(U);Ia(le,{class:"h-full w-full",get ref(){return u(C)},set ref(ce){B(C,ce,!0)},children:(ce,ye)=>{var Se=de(),_e=X(Se);Oe(_e,()=>Ks,(Fe,Be)=>{Be(Fe,{children:($e,ke)=>{var Le=Ws(),ge=X(Le);qt(ge,16,()=>N,ot=>ot,(ot,fe)=>{var Me=de(),Xe=X(Me);{let Ae=Ce(()=>fe.senderId===s?"sent":"received");Oe(Xe,()=>la,(et,At)=>{At(et,{get variant(){return u(Ae)},children:(re,xt)=>{var tt=zs(),pe=X(tt);Oe(pe,()=>ca,(gt,ze)=>{ze(gt,{})});var qe=ue(pe,2);Oe(qe,()=>ii,(gt,ze)=>{ze(gt,{class:"flex flex-col gap-1",children:(ut,pt)=>{var rt=Bs(),st=X(rt),lt=ee(st,!0);$(st);var Ue=ue(st,2),It=ee(Ue,!0);$(Ue),ct(()=>{Ct(lt,fe.message),Ct(It,fe.sentAt)}),T(ut,rt)},$$slots:{default:!0}})}),T(re,tt)},$$slots:{default:!0}})})}T(ot,Me)});var Ee=ue(ge,2);{var at=ot=>{var fe=de(),Me=X(fe);Oe(Me,()=>la,(Xe,Ae)=>{Ae(Xe,{variant:"received",children:(et,At)=>{var re=Gs(),xt=X(re);Oe(xt,()=>ca,(pe,qe)=>{qe(pe,{})});var tt=ue(xt,2);Oe(tt,()=>ii,(pe,qe)=>{qe(pe,{class:"flex flex-col gap-1",children:(gt,ze)=>{var ut=de(),pt=X(ut);{var rt=lt=>{var Ue=Us(),It=ee(Ue,!0);$(Ue),ct(()=>Ct(It,u(P))),T(lt,Ue)},st=lt=>{var Ue=de(),It=X(Ue);Oe(It,()=>ii,(Vt,kt)=>{kt(Vt,{typing:!0})}),T(lt,Ue)};he(pt,lt=>{u(P)?lt(rt):lt(st,!1)})}T(gt,ut)},$$slots:{default:!0}})}),T(et,re)},$$slots:{default:!0}})}),T(ot,fe)};he(Ee,ot=>{u(b)&&ot(at)})}T($e,Le)},$$slots:{default:!0}})}),T(ce,Se)},$$slots:{default:!0}}),$(U),Lt(U,ce=>B(D,ce),()=>u(D));var te=ue(U,2),oe=ee(te),ve=ee(oe);Jo(ve,{class:"rounded-full",placeholder:"Type a message...",get disabled(){return u(b)},get value(){return u(h)},set value(ce){B(h,ce,!0)}});var Ie=ue(ve,2);{let ce=Ce(()=>u(h).trim()===""||u(b));Nt(Ie,{type:"submit",variant:"default",size:"icon",class:"shrink-0 rounded-full",get disabled(){return u(ce)},children:(ye,Se)=>{qs(ye,{})},$$slots:{default:!0}})}$(oe),Lt(oe,ce=>B(O,ce),()=>u(O)),$(te),$(j),qo("submit",oe,H),T(I,j),Ne()}const er=Object.freeze({Pending:"pending",InProgress:"in-progress",Completed:"completed",Failed:"failed"}),mn=Object.freeze({Submitted:"SUBMITTED",Queued:"QUEUED",Processing:"IN_PROGRESS",Completed:"COMPLETED",Error:"ERROR"}),Qs=Object.freeze({Success:"success",Error:"error"});var bn={exports:{}},$s=bn.exports,fa;function Xs(){return fa||(fa=1,(function(I,t){(function(a,s){I.exports=s()})($s,function(){var a=function(e,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(e,r)},s=function(){return(s=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)};function c(e,r,n){for(var i,o=0,l=r.length;o<l;o++)!i&&o in r||((i=i||Array.prototype.slice.call(r,0,o))[o]=r[o]);return e.concat(i||Array.prototype.slice.call(r))}var f=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:ts,h=Object.keys,b=Array.isArray;function P(e,r){return typeof r!="object"||h(r).forEach(function(n){e[n]=r[n]}),e}typeof Promise>"u"||f.Promise||(f.Promise=Promise);var C=Object.getPrototypeOf,O={}.hasOwnProperty;function D(e,r){return O.call(e,r)}function N(e,r){typeof r=="function"&&(r=r(C(e))),(typeof Reflect>"u"?h:Reflect.ownKeys)(r).forEach(function(n){M(e,n,r[n])})}var W=Object.defineProperty;function M(e,r,n,i){W(e,r,P(n&&D(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},i))}function L(e){return{from:function(r){return e.prototype=Object.create(r.prototype),M(e.prototype,"constructor",e),{extend:N.bind(null,e.prototype)}}}}var K=Object.getOwnPropertyDescriptor,V=[].slice;function H(e,r,n){return V.call(e,r,n)}function j(e,r){return r(e)}function U(e){if(!e)throw new Error("Assertion Failed")}function le(e){f.setImmediate?setImmediate(e):setTimeout(e,0)}function te(e,r){if(typeof r=="string"&&D(e,r))return e[r];if(!r)return e;if(typeof r!="string"){for(var n=[],i=0,o=r.length;i<o;++i){var l=te(e,r[i]);n.push(l)}return n}var d=r.indexOf(".");if(d!==-1){var v=e[r.substr(0,d)];return v==null?void 0:te(v,r.substr(d+1))}}function oe(e,r,n){if(e&&r!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof r!="string"&&"length"in r){U(typeof n!="string"&&"length"in n);for(var i=0,o=r.length;i<o;++i)oe(e,r[i],n[i])}else{var l,d,v=r.indexOf(".");v!==-1?(l=r.substr(0,v),(d=r.substr(v+1))===""?n===void 0?b(e)&&!isNaN(parseInt(l))?e.splice(l,1):delete e[l]:e[l]=n:oe(v=!(v=e[l])||!D(e,l)?e[l]={}:v,d,n)):n===void 0?b(e)&&!isNaN(parseInt(r))?e.splice(r,1):delete e[r]:e[r]=n}}function ve(e){var r,n={};for(r in e)D(e,r)&&(n[r]=e[r]);return n}var Ie=[].concat;function ce(e){return Ie.apply([],e)}var Ye="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ce([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(r){return r+e+"Array"})}))).filter(function(e){return f[e]}),ye=new Set(Ye.map(function(e){return f[e]})),Se=null;function _e(e){return Se=new WeakMap,e=(function r(n){if(!n||typeof n!="object")return n;var i=Se.get(n);if(i)return i;if(b(n)){i=[],Se.set(n,i);for(var o=0,l=n.length;o<l;++o)i.push(r(n[o]))}else if(ye.has(n.constructor))i=n;else{var d,v=C(n);for(d in i=v===Object.prototype?{}:Object.create(v),Se.set(n,i),n)D(n,d)&&(i[d]=r(n[d]))}return i})(e),Se=null,e}var Fe={}.toString;function Be(e){return Fe.call(e).slice(8,-1)}var $e=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ke=typeof $e=="symbol"?function(e){var r;return e!=null&&(r=e[$e])&&r.apply(e)}:function(){return null};function Le(e,r){return r=e.indexOf(r),0<=r&&e.splice(r,1),0<=r}var ge={};function Ee(e){var r,n,i,o;if(arguments.length===1){if(b(e))return e.slice();if(this===ge&&typeof e=="string")return[e];if(o=ke(e)){for(n=[];!(i=o.next()).done;)n.push(i.value);return n}if(e==null)return[e];if(typeof(r=e.length)!="number")return[e];for(n=new Array(r);r--;)n[r]=e[r];return n}for(r=arguments.length,n=new Array(r);r--;)n[r]=arguments[r];return n}var at=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Mt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Dt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Mt),ot={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function fe(e,r){this.name=e,this.message=r}function Me(e,r){return e+". Errors: "+Object.keys(r).map(function(n){return r[n].toString()}).filter(function(n,i,o){return o.indexOf(n)===i}).join(`
`)}function Xe(e,r,n,i){this.failures=r,this.failedKeys=i,this.successCount=n,this.message=Me(e,r)}function Ae(e,r){this.name="BulkError",this.failures=Object.keys(r).map(function(n){return r[n]}),this.failuresByPos=r,this.message=Me(e,this.failures)}L(fe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),L(Xe).from(fe),L(Ae).from(fe);var et=Dt.reduce(function(e,r){return e[r]=r+"Error",e},{}),At=fe,re=Dt.reduce(function(e,r){var n=r+"Error";function i(o,l){this.name=n,o?typeof o=="string"?(this.message="".concat(o).concat(l?`
 `+l:""),this.inner=l||null):typeof o=="object"&&(this.message="".concat(o.name," ").concat(o.message),this.inner=o):(this.message=ot[r]||n,this.inner=null)}return L(i).from(At),e[r]=i,e},{});re.Syntax=SyntaxError,re.Type=TypeError,re.Range=RangeError;var xt=Mt.reduce(function(e,r){return e[r+"Error"]=re[r],e},{}),tt=Dt.reduce(function(e,r){return["Syntax","Type","Range"].indexOf(r)===-1&&(e[r+"Error"]=re[r]),e},{});function pe(){}function qe(e){return e}function gt(e,r){return e==null||e===qe?r:function(n){return r(e(n))}}function ze(e,r){return function(){e.apply(this,arguments),r.apply(this,arguments)}}function ut(e,r){return e===pe?r:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var l=r.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ze(i,this.onsuccess):i),o&&(this.onerror=this.onerror?ze(o,this.onerror):o),l!==void 0?l:n}}function pt(e,r){return e===pe?r:function(){e.apply(this,arguments);var n=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,r.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ze(n,this.onsuccess):n),i&&(this.onerror=this.onerror?ze(i,this.onerror):i)}}function rt(e,r){return e===pe?r:function(n){var i=e.apply(this,arguments);P(n,i);var o=this.onsuccess,l=this.onerror;return this.onsuccess=null,this.onerror=null,n=r.apply(this,arguments),o&&(this.onsuccess=this.onsuccess?ze(o,this.onsuccess):o),l&&(this.onerror=this.onerror?ze(l,this.onerror):l),i===void 0?n===void 0?void 0:n:P(i,n)}}function st(e,r){return e===pe?r:function(){return r.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function lt(e,r){return e===pe?r:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var i=this,o=arguments.length,l=new Array(o);o--;)l[o]=arguments[o];return n.then(function(){return r.apply(i,l)})}return r.apply(this,arguments)}}tt.ModifyError=Xe,tt.DexieError=fe,tt.BulkError=Ae;var Ue=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function It(e){Ue=e}var Vt={},kt=100,Ye=typeof Promise>"u"?[]:(function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,C(e),e];var r=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[r,C(r),e]})(),Mt=Ye[0],Dt=Ye[1],Ye=Ye[2],Dt=Dt&&Dt.then,dt=Mt&&Mt.constructor,_t=!!Ye,Ze=function(e,r){Ir.push([e,r]),jt&&(queueMicrotask(ja),jt=!1)},ft=!0,jt=!0,Bt=[],dr=[],zt=qe,Pt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pe,pgp:!1,env:{},finalize:pe},se=Pt,Ir=[],nr=0,qr=[];function Z(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var r=this._PSD=se;if(typeof e!="function"){if(e!==Vt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Pn(this,this._value))}this._state=null,this._value=null,++r.ref,(function n(i,o){try{o(function(l){if(i._state===null){if(l===i)throw new TypeError("A promise cannot be resolved with itself.");var d=i._lib&&fr();l&&typeof l.then=="function"?n(i,function(v,g){l instanceof Z?l._then(v,g):l.then(v,g)}):(i._state=!0,i._value=l,mi(i)),d&&hr()}},Pn.bind(null,i))}catch(l){Pn(i,l)}})(this,e)}var An={get:function(){var e=se,r=Gr;function n(i,o){var l=this,d=!e.global&&(e!==se||r!==Gr),v=d&&!Jt(),g=new Z(function(m,S){On(l,new gi(bi(i,e,d,v),bi(o,e,d,v),m,S,e))});return this._consoleTask&&(g._consoleTask=this._consoleTask),g}return n.prototype=Vt,n},set:function(e){M(this,"then",e&&e.prototype===Vt?An:{get:function(){return e},set:An.set})}};function gi(e,r,n,i,o){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof r=="function"?r:null,this.resolve=n,this.reject=i,this.psd=o}function Pn(e,r){var n,i;dr.push(r),e._state===null&&(n=e._lib&&fr(),r=zt(r),e._state=!1,e._value=r,i=e,Bt.some(function(o){return o._value===i._value})||Bt.push(i),mi(e),n&&hr())}function mi(e){var r=e._listeners;e._listeners=[];for(var n=0,i=r.length;n<i;++n)On(e,r[n]);var o=e._PSD;--o.ref||o.finalize(),nr===0&&(++nr,Ze(function(){--nr==0&&En()},[]))}function On(e,r){if(e._state!==null){var n=e._state?r.onFulfilled:r.onRejected;if(n===null)return(e._state?r.resolve:r.reject)(e._value);++r.psd.ref,++nr,Ze(Ma,[n,e,r])}else e._listeners.push(r)}function Ma(e,r,n){try{var i,o=r._value;!r._state&&dr.length&&(dr=[]),i=Ue&&r._consoleTask?r._consoleTask.run(function(){return e(o)}):e(o),r._state||dr.indexOf(o)!==-1||(function(l){for(var d=Bt.length;d;)if(Bt[--d]._value===l._value)return Bt.splice(d,1)})(r),n.resolve(i)}catch(l){n.reject(l)}finally{--nr==0&&En(),--n.psd.ref||n.psd.finalize()}}function ja(){ir(Pt,function(){fr()&&hr()})}function fr(){var e=ft;return jt=ft=!1,e}function hr(){var e,r,n;do for(;0<Ir.length;)for(e=Ir,Ir=[],n=e.length,r=0;r<n;++r){var i=e[r];i[0].apply(null,i[1])}while(0<Ir.length);jt=ft=!0}function En(){var e=Bt;Bt=[],e.forEach(function(i){i._PSD.onunhandled.call(null,i._value,i)});for(var r=qr.slice(0),n=r.length;n;)r[--n]()}function Br(e){return new Z(Vt,!1,e)}function Ge(e,r){var n=se;return function(){var i=fr(),o=se;try{return Qt(n,!0),e.apply(this,arguments)}catch(l){r&&r(l)}finally{Qt(o,!1),i&&hr()}}}N(Z.prototype,{then:An,_then:function(e,r){On(this,new gi(null,null,e,r,se))},catch:function(e){if(arguments.length===1)return this.then(null,e);var r=e,n=arguments[1];return typeof r=="function"?this.then(null,function(i){return(i instanceof r?n:Br)(i)}):this.then(null,function(i){return(i&&i.name===r?n:Br)(i)})},finally:function(e){return this.then(function(r){return Z.resolve(e()).then(function(){return r})},function(r){return Z.resolve(e()).then(function(){return Br(r)})})},timeout:function(e,r){var n=this;return e<1/0?new Z(function(i,o){var l=setTimeout(function(){return o(new re.Timeout(r))},e);n.then(i,o).finally(clearTimeout.bind(null,l))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&M(Z.prototype,Symbol.toStringTag,"Dexie.Promise"),Pt.env=yi(),N(Z,{all:function(){var e=Ee.apply(null,arguments).map(Wr);return new Z(function(r,n){e.length===0&&r([]);var i=e.length;e.forEach(function(o,l){return Z.resolve(o).then(function(d){e[l]=d,--i||r(e)},n)})})},resolve:function(e){return e instanceof Z?e:e&&typeof e.then=="function"?new Z(function(r,n){e.then(r,n)}):new Z(Vt,!0,e)},reject:Br,race:function(){var e=Ee.apply(null,arguments).map(Wr);return new Z(function(r,n){e.map(function(i){return Z.resolve(i).then(r,n)})})},PSD:{get:function(){return se},set:function(e){return se=e}},totalEchoes:{get:function(){return Gr}},newPSD:Yt,usePSD:ir,scheduler:{get:function(){return Ze},set:function(e){Ze=e}},rejectionMapper:{get:function(){return zt},set:function(e){zt=e}},follow:function(e,r){return new Z(function(n,i){return Yt(function(o,l){var d=se;d.unhandleds=[],d.onunhandled=l,d.finalize=ze(function(){var v,g=this;v=function(){g.unhandleds.length===0?o():l(g.unhandleds[0])},qr.push(function m(){v(),qr.splice(qr.indexOf(m),1)}),++nr,Ze(function(){--nr==0&&En()},[])},d.finalize),e()},r,n,i)})}}),dt&&(dt.allSettled&&M(Z,"allSettled",function(){var e=Ee.apply(null,arguments).map(Wr);return new Z(function(r){e.length===0&&r([]);var n=e.length,i=new Array(n);e.forEach(function(o,l){return Z.resolve(o).then(function(d){return i[l]={status:"fulfilled",value:d}},function(d){return i[l]={status:"rejected",reason:d}}).then(function(){return--n||r(i)})})})}),dt.any&&typeof AggregateError<"u"&&M(Z,"any",function(){var e=Ee.apply(null,arguments).map(Wr);return new Z(function(r,n){e.length===0&&n(new AggregateError([]));var i=e.length,o=new Array(i);e.forEach(function(l,d){return Z.resolve(l).then(function(v){return r(v)},function(v){o[d]=v,--i||n(new AggregateError(o))})})})}),dt.withResolvers&&(Z.withResolvers=dt.withResolvers));var ht={awaits:0,echoes:0,id:0},Ha=0,zr=[],Ur=0,Gr=0,Ka=0;function Yt(e,r,n,i){var o=se,l=Object.create(o);return l.parent=o,l.ref=0,l.global=!1,l.id=++Ka,Pt.env,l.env=_t?{Promise:Z,PromiseProp:{value:Z,configurable:!0,writable:!0},all:Z.all,race:Z.race,allSettled:Z.allSettled,any:Z.any,resolve:Z.resolve,reject:Z.reject}:{},r&&P(l,r),++o.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()},i=ir(l,e,n,i),l.ref===0&&l.finalize(),i}function vr(){return ht.id||(ht.id=++Ha),++ht.awaits,ht.echoes+=kt,ht.id}function Jt(){return!!ht.awaits&&(--ht.awaits==0&&(ht.id=0),ht.echoes=ht.awaits*kt,!0)}function Wr(e){return ht.echoes&&e&&e.constructor===dt?(vr(),e.then(function(r){return Jt(),r},function(r){return Jt(),nt(r)})):e}function qa(){var e=zr[zr.length-1];zr.pop(),Qt(e,!1)}function Qt(e,r){var n,i=se;(r?!ht.echoes||Ur++&&e===se:!Ur||--Ur&&e===se)||queueMicrotask(r?(function(o){++Gr,ht.echoes&&--ht.echoes!=0||(ht.echoes=ht.awaits=ht.id=0),zr.push(se),Qt(o,!0)}).bind(null,e):qa),e!==se&&(se=e,i===Pt&&(Pt.env=yi()),_t&&(n=Pt.env.Promise,r=e.env,(i.global||e.global)&&(Object.defineProperty(f,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any&&(n.any=r.any))))}function yi(){var e=f.Promise;return _t?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(f,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ir(e,r,n,i,o){var l=se;try{return Qt(e,!0),r(n,i,o)}finally{Qt(l,!1)}}function bi(e,r,n,i){return typeof e!="function"?e:function(){var o=se;n&&vr(),Qt(r,!0);try{return e.apply(this,arguments)}finally{Qt(o,!1),i&&queueMicrotask(Jt)}}}function Fn(e){Promise===dt&&ht.echoes===0?Ur===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Dt).indexOf("[native code]")===-1&&(vr=Jt=pe);var nt=Z.reject,ar="ï¿¿",Ut="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",wi="String expected.",pr=[],Yr="__dbnames",Tn="readonly",Dn="readwrite";function or(e,r){return e?r?function(){return e.apply(this,arguments)&&r.apply(this,arguments)}:e:r}var _i={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Jr(e){return typeof e!="string"||/\./.test(e)?function(r){return r}:function(r){return r[e]===void 0&&e in r&&delete(r=_e(r))[e],r}}function Si(){throw re.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Pe(e,r){try{var n=xi(e),i=xi(r);if(n!==i)return n==="Array"?1:i==="Array"?-1:n==="binary"?1:i==="binary"?-1:n==="string"?1:i==="string"?-1:n==="Date"?1:i!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return r<e?1:e<r?-1:0;case"binary":return(function(o,l){for(var d=o.length,v=l.length,g=d<v?d:v,m=0;m<g;++m)if(o[m]!==l[m])return o[m]<l[m]?-1:1;return d===v?0:d<v?-1:1})(Ii(e),Ii(r));case"Array":return(function(o,l){for(var d=o.length,v=l.length,g=d<v?d:v,m=0;m<g;++m){var S=Pe(o[m],l[m]);if(S!==0)return S}return d===v?0:d<v?-1:1})(e,r)}}catch{}return NaN}function xi(e){var r=typeof e;return r!="object"?r:ArrayBuffer.isView(e)?"binary":(e=Be(e),e==="ArrayBuffer"?"binary":e)}function Ii(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Qr(e,r,n){var i=e.schema.yProps;return i?(r&&0<n.numFailures&&(r=r.filter(function(o,l){return!n.failures[l]})),Promise.all(i.map(function(o){return o=o.updatesTable,r?e.db.table(o).where("k").anyOf(r).delete():e.db.table(o).clear()})).then(function(){return n})):n}var kr=(ki.prototype.execute=function(e){var r=this["@@propmod"];if(r.add!==void 0){var n=r.add;if(b(n))return c(c([],b(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(r.remove!==void 0){var i=r.remove;if(b(i))return b(e)?e.filter(function(o){return!i.includes(o)}).sort():[];if(typeof i=="number")return Number(e)-i;if(typeof i=="bigint")try{return BigInt(e)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}return n=(n=r.replacePrefix)===null||n===void 0?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?r.replacePrefix[1]+e.substring(n.length):e},ki);function ki(e){this["@@propmod"]=e}function Ci(e,r){for(var n=h(r),i=n.length,o=!1,l=0;l<i;++l){var d=n[l],v=r[d],g=te(e,d);v instanceof kr?(oe(e,d,v.execute(g)),o=!0):g!==v&&(oe(e,d,v),o=!0)}return o}var Ai=(He.prototype._trans=function(e,r,n){var i=this._tx||se.trans,o=this.name,l=Ue&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function d(m,S,p){if(!p.schema[o])throw new re.NotFound("Table "+o+" not part of transaction");return r(p.idbtrans,p)}var v=fr();try{var g=i&&i.db._novip===this.db._novip?i===se.trans?i._promise(e,d,n):Yt(function(){return i._promise(e,d,n)},{trans:i,transless:se.transless||se}):(function m(S,p,k,y){if(S.idbdb&&(S._state.openComplete||se.letThrough||S._vip)){var w=S._createTransaction(p,k,S._dbSchema);try{w.create(),S._state.PR1398_maxLoop=3}catch(_){return _.name===et.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return m(S,p,k,y)})):nt(_)}return w._promise(p,function(_,x){return Yt(function(){return se.trans=w,y(_,x,w)})}).then(function(_){if(p==="readwrite")try{w.idbtrans.commit()}catch{}return p==="readonly"?_:w._completion.then(function(){return _})})}if(S._state.openComplete)return nt(new re.DatabaseClosed(S._state.dbOpenError));if(!S._state.isBeingOpened){if(!S._state.autoOpen)return nt(new re.DatabaseClosed);S.open().catch(pe)}return S._state.dbReadyPromise.then(function(){return m(S,p,k,y)})})(this.db,e,[this.name],d);return l&&(g._consoleTask=l,g=g.catch(function(m){return console.trace(m),nt(m)})),g}finally{v&&hr()}},He.prototype.get=function(e,r){var n=this;return e&&e.constructor===Object?this.where(e).first(r):e==null?nt(new re.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return n.core.get({trans:i,key:e}).then(function(o){return n.hook.reading.fire(o)})}).then(r)},He.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(b(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var r=h(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(v){if(v.compound&&r.every(function(m){return 0<=v.keyPath.indexOf(m)})){for(var g=0;g<r.length;++g)if(r.indexOf(v.keyPath[g])===-1)return!1;return!0}return!1}).sort(function(v,g){return v.keyPath.length-g.keyPath.length})[0];if(n&&this.db._maxKey!==ar){var l=n.keyPath.slice(0,r.length);return this.where(l).equals(l.map(function(g){return e[g]}))}!n&&Ue&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(r.join("+"),"]"));var i=this.schema.idxByName;function o(v,g){return Pe(v,g)===0}var d=r.reduce(function(p,g){var m=p[0],S=p[1],p=i[g],k=e[g];return[m||p,m||!p?or(S,p&&p.multi?function(y){return y=te(y,g),b(y)&&y.some(function(w){return o(k,w)})}:function(y){return o(k,te(y,g))}):S]},[null,null]),l=d[0],d=d[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(d):n?this.filter(d):this.where(r).equals("")},He.prototype.filter=function(e){return this.toCollection().and(e)},He.prototype.count=function(e){return this.toCollection().count(e)},He.prototype.offset=function(e){return this.toCollection().offset(e)},He.prototype.limit=function(e){return this.toCollection().limit(e)},He.prototype.each=function(e){return this.toCollection().each(e)},He.prototype.toArray=function(e){return this.toCollection().toArray(e)},He.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},He.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,b(e)?"[".concat(e.join("+"),"]"):e))},He.prototype.reverse=function(){return this.toCollection().reverse()},He.prototype.mapToClass=function(e){var r,n=this.db,i=this.name;function o(){return r!==null&&r.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Si&&((function(g,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function S(){this.constructor=g}a(g,m),g.prototype=m===null?Object.create(m):(S.prototype=m.prototype,new S)})(o,r=e),Object.defineProperty(o.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),o.prototype.table=function(){return i},e=o);for(var l=new Set,d=e.prototype;d;d=C(d))Object.getOwnPropertyNames(d).forEach(function(g){return l.add(g)});function v(g){if(!g)return g;var m,S=Object.create(e.prototype);for(m in g)if(!l.has(m))try{S[m]=g[m]}catch{}return S}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),e},He.prototype.defineClass=function(){return this.mapToClass(function(e){P(this,e)})},He.prototype.add=function(e,r){var n=this,i=this.schema.primKey,o=i.auto,l=i.keyPath,d=e;return l&&o&&(d=Jr(l)(e)),this._trans("readwrite",function(v){return n.core.mutate({trans:v,type:"add",keys:r!=null?[r]:null,values:[d]})}).then(function(v){return v.numFailures?Z.reject(v.failures[0]):v.lastResult}).then(function(v){if(l)try{oe(e,l,v)}catch{}return v})},He.prototype.upsert=function(e,r){var n=this,i=this.schema.primKey.keyPath;return this._trans("readwrite",function(o){return n.core.get({trans:o,key:e}).then(function(l){var d=l??{};return Ci(d,r),i&&oe(d,i,e),n.core.mutate({trans:o,type:"put",values:[d],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[r]}}).then(function(v){return v.numFailures?Z.reject(v.failures[0]):!!l})})})},He.prototype.update=function(e,r){return typeof e!="object"||b(e)?this.where(":id").equals(e).modify(r):(e=te(e,this.schema.primKey.keyPath),e===void 0?nt(new re.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(r))},He.prototype.put=function(e,r){var n=this,i=this.schema.primKey,o=i.auto,l=i.keyPath,d=e;return l&&o&&(d=Jr(l)(e)),this._trans("readwrite",function(v){return n.core.mutate({trans:v,type:"put",values:[d],keys:r!=null?[r]:null})}).then(function(v){return v.numFailures?Z.reject(v.failures[0]):v.lastResult}).then(function(v){if(l)try{oe(e,l,v)}catch{}return v})},He.prototype.delete=function(e){var r=this;return this._trans("readwrite",function(n){return r.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(i){return Qr(r,[e],i)}).then(function(i){return i.numFailures?Z.reject(i.failures[0]):void 0})})},He.prototype.clear=function(){var e=this;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"deleteRange",range:_i}).then(function(n){return Qr(e,null,n)})}).then(function(r){return r.numFailures?Z.reject(r.failures[0]):void 0})},He.prototype.bulkGet=function(e){var r=this;return this._trans("readonly",function(n){return r.core.getMany({keys:e,trans:n}).then(function(i){return i.map(function(o){return r.hook.reading.fire(o)})})})},He.prototype.bulkAdd=function(e,r,n){var i=this,o=Array.isArray(r)?r:void 0,l=(n=n||(o?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",function(d){var m=i.schema.primKey,v=m.auto,m=m.keyPath;if(m&&o)throw new re.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,m=m&&v?e.map(Jr(m)):e;return i.core.mutate({trans:d,type:"add",keys:o,values:m,wantResults:l}).then(function(w){var p=w.numFailures,k=w.results,y=w.lastResult,w=w.failures;if(p===0)return l?k:y;throw new Ae("".concat(i.name,".bulkAdd(): ").concat(p," of ").concat(g," operations failed"),w)})})},He.prototype.bulkPut=function(e,r,n){var i=this,o=Array.isArray(r)?r:void 0,l=(n=n||(o?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",function(d){var m=i.schema.primKey,v=m.auto,m=m.keyPath;if(m&&o)throw new re.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,m=m&&v?e.map(Jr(m)):e;return i.core.mutate({trans:d,type:"put",keys:o,values:m,wantResults:l}).then(function(w){var p=w.numFailures,k=w.results,y=w.lastResult,w=w.failures;if(p===0)return l?k:y;throw new Ae("".concat(i.name,".bulkPut(): ").concat(p," of ").concat(g," operations failed"),w)})})},He.prototype.bulkUpdate=function(e){var r=this,n=this.core,i=e.map(function(d){return d.key}),o=e.map(function(d){return d.changes}),l=[];return this._trans("readwrite",function(d){return n.getMany({trans:d,keys:i,cache:"clone"}).then(function(v){var g=[],m=[];e.forEach(function(p,k){var y=p.key,w=p.changes,_=v[k];if(_){for(var x=0,A=Object.keys(w);x<A.length;x++){var E=A[x],F=w[E];if(E===r.schema.primKey.keyPath){if(Pe(F,y)!==0)throw new re.Constraint("Cannot update primary key in bulkUpdate()")}else oe(_,E,F)}l.push(k),g.push(y),m.push(_)}});var S=g.length;return n.mutate({trans:d,type:"put",keys:g,values:m,updates:{keys:i,changeSpecs:o}}).then(function(p){var k=p.numFailures,y=p.failures;if(k===0)return S;for(var w=0,_=Object.keys(y);w<_.length;w++){var x,A=_[w],E=l[Number(A)];E!=null&&(x=y[A],delete y[A],y[E]=x)}throw new Ae("".concat(r.name,".bulkUpdate(): ").concat(k," of ").concat(S," operations failed"),y)})})})},He.prototype.bulkDelete=function(e){var r=this,n=e.length;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"delete",keys:e}).then(function(o){return Qr(r,e,o)})}).then(function(d){var o=d.numFailures,l=d.lastResult,d=d.failures;if(o===0)return l;throw new Ae("".concat(r.name,".bulkDelete(): ").concat(o," of ").concat(n," operations failed"),d)})},He);function He(){}function Cr(e){function r(d,v){if(v){for(var g=arguments.length,m=new Array(g-1);--g;)m[g-1]=arguments[g];return n[d].subscribe.apply(null,m),e}if(typeof d=="string")return n[d]}var n={};r.addEventType=l;for(var i=1,o=arguments.length;i<o;++i)l(arguments[i]);return r;function l(d,v,g){if(typeof d!="object"){var m;v=v||st;var S={subscribers:[],fire:g=g||pe,subscribe:function(p){S.subscribers.indexOf(p)===-1&&(S.subscribers.push(p),S.fire=v(S.fire,p))},unsubscribe:function(p){S.subscribers=S.subscribers.filter(function(k){return k!==p}),S.fire=S.subscribers.reduce(v,g)}};return n[d]=r[d]=S}h(m=d).forEach(function(p){var k=m[p];if(b(k))l(p,m[p][0],m[p][1]);else{if(k!=="asap")throw new re.InvalidArgument("Invalid event config");var y=l(p,qe,function(){for(var w=arguments.length,_=new Array(w);w--;)_[w]=arguments[w];y.subscribers.forEach(function(x){le(function(){x.apply(null,_)})})})}})}}function Ar(e,r){return L(r).from({prototype:e}),r}function gr(e,r){return!(e.filter||e.algorithm||e.or)&&(r?e.justLimit:!e.replayFilter)}function Nn(e,r){e.filter=or(e.filter,r)}function Vn(e,r,n){var i=e.replayFilter;e.replayFilter=i?function(){return or(i(),r())}:r,e.justLimit=n&&!i}function $r(e,r){if(e.isPrimKey)return r.primaryKey;var n=r.getIndexByKeyPath(e.index);if(!n)throw new re.Schema("KeyPath "+e.index+" on object store "+r.name+" is not indexed");return n}function Pi(e,r,n){var i=$r(e,r.schema);return r.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:i,range:e.range}})}function Xr(e,r,n,i){var o=e.replayFilter?or(e.filter,e.replayFilter()):e.filter;if(e.or){var l={},d=function(v,g,m){var S,p;o&&!o(g,m,function(k){return g.stop(k)},function(k){return g.fail(k)})||((p=""+(S=g.primaryKey))=="[object ArrayBuffer]"&&(p=""+new Uint8Array(S)),D(l,p)||(l[p]=!0,r(v,g,m)))};return Promise.all([e.or._iterate(d,n),Oi(Pi(e,i,n),e.algorithm,d,!e.keysOnly&&e.valueMapper)])}return Oi(Pi(e,i,n),or(e.algorithm,o),r,!e.keysOnly&&e.valueMapper)}function Oi(e,r,n,i){var o=Ge(i?function(l,d,v){return n(i(l),d,v)}:n);return e.then(function(l){if(l)return l.start(function(){var d=function(){return l.continue()};r&&!r(l,function(v){return d=v},function(v){l.stop(v),d=pe},function(v){l.fail(v),d=pe})||o(l.value,l,function(v){return d=v}),d()})})}var Ba=(Te.prototype._read=function(e,r){var n=this._ctx;return n.error?n.table._trans(null,nt.bind(null,n.error)):n.table._trans("readonly",e).then(r)},Te.prototype._write=function(e){var r=this._ctx;return r.error?r.table._trans(null,nt.bind(null,r.error)):r.table._trans("readwrite",e,"locked")},Te.prototype._addAlgorithm=function(e){var r=this._ctx;r.algorithm=or(r.algorithm,e)},Te.prototype._iterate=function(e,r){return Xr(this._ctx,e,r,this._ctx.table.core)},Te.prototype.clone=function(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&P(n,e),r._ctx=n,r},Te.prototype.raw=function(){return this._ctx.valueMapper=null,this},Te.prototype.each=function(e){var r=this._ctx;return this._read(function(n){return Xr(r,e,n,r.table.core)})},Te.prototype.count=function(e){var r=this;return this._read(function(n){var i=r._ctx,o=i.table.core;if(gr(i,!0))return o.count({trans:n,query:{index:$r(i,o.schema),range:i.range}}).then(function(d){return Math.min(d,i.limit)});var l=0;return Xr(i,function(){return++l,!1},n,o).then(function(){return l})}).then(e)},Te.prototype.sortBy=function(e,r){var n=e.split(".").reverse(),i=n[0],o=n.length-1;function l(g,m){return m?l(g[n[m]],m-1):g[i]}var d=this._ctx.dir==="next"?1:-1;function v(g,m){return Pe(l(g,o),l(m,o))*d}return this.toArray(function(g){return g.sort(v)}).then(r)},Te.prototype.toArray=function(e){var r=this;return this._read(function(n){var i=r._ctx;if(i.dir==="next"&&gr(i,!0)&&0<i.limit){var o=i.valueMapper,l=$r(i,i.table.core.schema);return i.table.core.query({trans:n,limit:i.limit,values:!0,query:{index:l,range:i.range}}).then(function(v){return v=v.result,o?v.map(o):v})}var d=[];return Xr(i,function(v){return d.push(v)},n,i.table.core).then(function(){return d})},e)},Te.prototype.offset=function(e){var r=this._ctx;return e<=0||(r.offset+=e,gr(r)?Vn(r,function(){var n=e;return function(i,o){return n===0||(n===1?--n:o(function(){i.advance(n),n=0}),!1)}}):Vn(r,function(){var n=e;return function(){return--n<0}})),this},Te.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Vn(this._ctx,function(){var r=e;return function(n,i,o){return--r<=0&&i(o),0<=r}},!0),this},Te.prototype.until=function(e,r){return Nn(this._ctx,function(n,i,o){return!e(n.value)||(i(o),r)}),this},Te.prototype.first=function(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)},Te.prototype.last=function(e){return this.reverse().first(e)},Te.prototype.filter=function(e){var r;return Nn(this._ctx,function(n){return e(n.value)}),(r=this._ctx).isMatch=or(r.isMatch,e),this},Te.prototype.and=function(e){return this.filter(e)},Te.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Te.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Te.prototype.desc=function(){return this.reverse()},Te.prototype.eachKey=function(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.key,i)})},Te.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Te.prototype.eachPrimaryKey=function(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.primaryKey,i)})},Te.prototype.keys=function(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.key)}).then(function(){return n}).then(e)},Te.prototype.primaryKeys=function(e){var r=this._ctx;if(r.dir==="next"&&gr(r,!0)&&0<r.limit)return this._read(function(i){var o=$r(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:o,range:r.range}})}).then(function(i){return i.result}).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)},Te.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Te.prototype.firstKey=function(e){return this.limit(1).keys(function(r){return r[0]}).then(e)},Te.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Te.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var r={};return Nn(this._ctx,function(o){var i=o.primaryKey.toString(),o=D(r,i);return r[i]=!0,!o}),this},Te.prototype.modify=function(e){var r=this,n=this._ctx;return this._write(function(i){var o=typeof e=="function"?e:function(_){return Ci(_,e)},l=n.table.core,m=l.schema.primaryKey,d=m.outbound,v=m.extractKey,g=200,m=r.db._options.modifyChunkSize;m&&(g=typeof m=="object"?m[l.name]||m["*"]||200:m);function S(_,E){var A=E.failures,E=E.numFailures;k+=_-E;for(var F=0,R=h(A);F<R.length;F++){var z=R[F];p.push(A[z])}}var p=[],k=0,y=[],w=e===Ei;return r.clone().primaryKeys().then(function(_){function x(E){var F=Math.min(g,_.length-E),R=_.slice(E,E+F);return(w?Promise.resolve([]):l.getMany({trans:i,keys:R,cache:"immutable"})).then(function(z){var J=[],q=[],G=d?[]:null,Q=w?R:[];if(!w)for(var Y=0;Y<F;++Y){var ie=z[Y],be={value:_e(ie),primKey:_[E+Y]};o.call(be,be.value,be)!==!1&&(be.value==null?Q.push(_[E+Y]):d||Pe(v(ie),v(be.value))===0?(q.push(be.value),d&&G.push(_[E+Y])):(Q.push(_[E+Y]),J.push(be.value)))}return Promise.resolve(0<J.length&&l.mutate({trans:i,type:"add",values:J}).then(function(we){for(var xe in we.failures)Q.splice(parseInt(xe),1);S(J.length,we)})).then(function(){return(0<q.length||A&&typeof e=="object")&&l.mutate({trans:i,type:"put",keys:G,values:q,criteria:A,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<E}).then(function(we){return S(q.length,we)})}).then(function(){return(0<Q.length||A&&w)&&l.mutate({trans:i,type:"delete",keys:Q,criteria:A,isAdditionalChunk:0<E}).then(function(we){return Qr(n.table,Q,we)}).then(function(we){return S(Q.length,we)})}).then(function(){return _.length>E+F&&x(E+g)})})}var A=gr(n)&&n.limit===1/0&&(typeof e!="function"||w)&&{index:n.index,range:n.range};return x(0).then(function(){if(0<p.length)throw new Xe("Error modifying one or more objects",p,k,y);return _.length})})})},Te.prototype.delete=function(){var e=this._ctx,r=e.range;return!gr(e)||e.table.schema.yProps||!e.isPrimKey&&r.type!==3?this.modify(Ei):this._write(function(n){var i=e.table.core.schema.primaryKey,o=r;return e.table.core.count({trans:n,query:{index:i,range:o}}).then(function(l){return e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(function(g){var v=g.failures,g=g.numFailures;if(g)throw new Xe("Could not delete some values",Object.keys(v).map(function(m){return v[m]}),l-g);return l-g})})})},Te);function Te(){}var Ei=function(e,r){return r.value=null};function za(e,r){return e<r?-1:e===r?0:1}function Ua(e,r){return r<e?-1:e===r?0:1}function Ot(e,r,n){return e=e instanceof Ti?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(r),e}function mr(e){return new e.Collection(e,function(){return Fi("")}).limit(0)}function Zr(e,r,n,i){var o,l,d,v,g,m,S,p=n.length;if(!n.every(function(w){return typeof w=="string"}))return Ot(e,wi);function k(w){o=w==="next"?function(x){return x.toUpperCase()}:function(x){return x.toLowerCase()},l=w==="next"?function(x){return x.toLowerCase()}:function(x){return x.toUpperCase()},d=w==="next"?za:Ua;var _=n.map(function(x){return{lower:l(x),upper:o(x)}}).sort(function(x,A){return d(x.lower,A.lower)});v=_.map(function(x){return x.upper}),g=_.map(function(x){return x.lower}),S=(m=w)==="next"?"":i}k("next"),e=new e.Collection(e,function(){return $t(v[0],g[p-1]+i)}),e._ondirectionchange=function(w){k(w)};var y=0;return e._addAlgorithm(function(w,_,x){var A=w.key;if(typeof A!="string")return!1;var E=l(A);if(r(E,g,y))return!0;for(var F=null,R=y;R<p;++R){var z=(function(J,q,G,Q,Y,ie){for(var be=Math.min(J.length,Q.length),we=-1,xe=0;xe<be;++xe){var Et=q[xe];if(Et!==Q[xe])return Y(J[xe],G[xe])<0?J.substr(0,xe)+G[xe]+G.substr(xe+1):Y(J[xe],Q[xe])<0?J.substr(0,xe)+Q[xe]+G.substr(xe+1):0<=we?J.substr(0,we)+q[we]+G.substr(we+1):null;Y(J[xe],Et)<0&&(we=xe)}return be<Q.length&&ie==="next"?J+G.substr(J.length):be<J.length&&ie==="prev"?J.substr(0,G.length):we<0?null:J.substr(0,we)+Q[we]+G.substr(we+1)})(A,E,v[R],g[R],d,m);z===null&&F===null?y=R+1:(F===null||0<d(F,z))&&(F=z)}return _(F!==null?function(){w.continue(F+S)}:x),!1}),e}function $t(e,r,n,i){return{type:2,lower:e,upper:r,lowerOpen:n,upperOpen:i}}function Fi(e){return{type:1,lower:e,upper:e}}var Ti=(Object.defineProperty(vt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),vt.prototype.between=function(e,r,n,i){n=n!==!1,i=i===!0;try{return 0<this._cmp(e,r)||this._cmp(e,r)===0&&(n||i)&&(!n||!i)?mr(this):new this.Collection(this,function(){return $t(e,r,!n,!i)})}catch{return Ot(this,Ut)}},vt.prototype.equals=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return Fi(e)})},vt.prototype.above=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return $t(e,void 0,!0)})},vt.prototype.aboveOrEqual=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return $t(e,void 0,!1)})},vt.prototype.below=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return $t(void 0,e,!1,!0)})},vt.prototype.belowOrEqual=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return $t(void 0,e)})},vt.prototype.startsWith=function(e){return typeof e!="string"?Ot(this,wi):this.between(e,e+ar,!0,!0)},vt.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Zr(this,function(r,n){return r.indexOf(n[0])===0},[e],ar)},vt.prototype.equalsIgnoreCase=function(e){return Zr(this,function(r,n){return r===n[0]},[e],"")},vt.prototype.anyOfIgnoreCase=function(){var e=Ee.apply(ge,arguments);return e.length===0?mr(this):Zr(this,function(r,n){return n.indexOf(r)!==-1},e,"")},vt.prototype.startsWithAnyOfIgnoreCase=function(){var e=Ee.apply(ge,arguments);return e.length===0?mr(this):Zr(this,function(r,n){return n.some(function(i){return r.indexOf(i)===0})},e,ar)},vt.prototype.anyOf=function(){var e=this,r=Ee.apply(ge,arguments),n=this._cmp;try{r.sort(n)}catch{return Ot(this,Ut)}if(r.length===0)return mr(this);var i=new this.Collection(this,function(){return $t(r[0],r[r.length-1])});i._ondirectionchange=function(l){n=l==="next"?e._ascending:e._descending,r.sort(n)};var o=0;return i._addAlgorithm(function(l,d,v){for(var g=l.key;0<n(g,r[o]);)if(++o===r.length)return d(v),!1;return n(g,r[o])===0||(d(function(){l.continue(r[o])}),!1)}),i},vt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},vt.prototype.noneOf=function(){var e=Ee.apply(ge,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ot(this,Ut)}var r=e.reduce(function(n,i){return n?n.concat([[n[n.length-1][1],i]]):[[-1/0,i]]},null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})},vt.prototype.inAnyRange=function(A,r){var n=this,i=this._cmp,o=this._ascending,l=this._descending,d=this._min,v=this._max;if(A.length===0)return mr(this);if(!A.every(function(E){return E[0]!==void 0&&E[1]!==void 0&&o(E[0],E[1])<=0}))return Ot(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",re.InvalidArgument);var g=!r||r.includeLowers!==!1,m=r&&r.includeUppers===!0,S,p=o;function k(E,F){return p(E[0],F[0])}try{(S=A.reduce(function(E,F){for(var R=0,z=E.length;R<z;++R){var J=E[R];if(i(F[0],J[1])<0&&0<i(F[1],J[0])){J[0]=d(J[0],F[0]),J[1]=v(J[1],F[1]);break}}return R===z&&E.push(F),E},[])).sort(k)}catch{return Ot(this,Ut)}var y=0,w=m?function(E){return 0<o(E,S[y][1])}:function(E){return 0<=o(E,S[y][1])},_=g?function(E){return 0<l(E,S[y][0])}:function(E){return 0<=l(E,S[y][0])},x=w,A=new this.Collection(this,function(){return $t(S[0][0],S[S.length-1][1],!g,!m)});return A._ondirectionchange=function(E){p=E==="next"?(x=w,o):(x=_,l),S.sort(k)},A._addAlgorithm(function(E,F,R){for(var z,J=E.key;x(J);)if(++y===S.length)return F(R),!1;return!w(z=J)&&!_(z)||(n._cmp(J,S[y][1])===0||n._cmp(J,S[y][0])===0||F(function(){p===o?E.continue(S[y][0]):E.continue(S[y][1])}),!1)}),A},vt.prototype.startsWithAnyOf=function(){var e=Ee.apply(ge,arguments);return e.every(function(r){return typeof r=="string"})?e.length===0?mr(this):this.inAnyRange(e.map(function(r){return[r,r+ar]})):Ot(this,"startsWithAnyOf() only works with strings")},vt);function vt(){}function Ht(e){return Ge(function(r){return Pr(r),e(r.target.error),!1})}function Pr(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Or="storagemutated",Ln="x-storagemutated-1",Xt=Cr(null,Or),Ga=(Kt.prototype._lock=function(){return U(!se.global),++this._reculock,this._reculock!==1||se.global||(se.lockOwnerFor=this),this},Kt.prototype._unlock=function(){if(U(!se.global),--this._reculock==0)for(se.global||(se.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ir(e[1],e[0])}catch{}}return this},Kt.prototype._locked=function(){return this._reculock&&se.lockOwnerFor!==this},Kt.prototype.create=function(e){var r=this;if(!this.mode)return this;var n=this.db.idbdb,i=this.db._state.dbOpenError;if(U(!this.idbtrans),!e&&!n)switch(i&&i.name){case"DatabaseClosedError":throw new re.DatabaseClosed(i);case"MissingAPIError":throw new re.MissingAPI(i.message,i);default:throw new re.OpenFailed(i)}if(!this.active)throw new re.TransactionInactive;return U(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ge(function(o){Pr(o),r._reject(e.error)}),e.onabort=Ge(function(o){Pr(o),r.active&&r._reject(new re.Abort(e.error)),r.active=!1,r.on("abort").fire(o)}),e.oncomplete=Ge(function(){r.active=!1,r._resolve(),"mutatedParts"in e&&Xt.storagemutated.fire(e.mutatedParts)}),this},Kt.prototype._promise=function(e,r,n){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return nt(new re.ReadOnly("Transaction is readonly"));if(!this.active)return nt(new re.TransactionInactive);if(this._locked())return new Z(function(l,d){i._blockedFuncs.push([function(){i._promise(e,r,n).then(l,d)},se])});if(n)return Yt(function(){var l=new Z(function(d,v){i._lock();var g=r(d,v,i);g&&g.then&&g.then(d,v)});return l.finally(function(){return i._unlock()}),l._lib=!0,l});var o=new Z(function(l,d){var v=r(l,d,i);v&&v.then&&v.then(l,d)});return o._lib=!0,o},Kt.prototype._root=function(){return this.parent?this.parent._root():this},Kt.prototype.waitFor=function(e){var r,n=this._root(),i=Z.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return i}):(n._waitingFor=i,n._waitingQueue=[],r=n.idbtrans.objectStore(n.storeNames[0]),(function l(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(r.get(-1/0).onsuccess=l)})());var o=n._waitingFor;return new Z(function(l,d){i.then(function(v){return n._waitingQueue.push(Ge(l.bind(null,v)))},function(v){return n._waitingQueue.push(Ge(d.bind(null,v)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},Kt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new re.Abort))},Kt.prototype.table=function(e){var r=this._memoizedTables||(this._memoizedTables={});if(D(r,e))return r[e];var n=this.schema[e];if(!n)throw new re.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),r[e]=n},Kt);function Kt(){}function Rn(e,r,n,i,o,l,d,v){return{name:e,keyPath:r,unique:n,multi:i,auto:o,compound:l,src:(n&&!d?"&":"")+(i?"*":"")+(o?"++":"")+Di(r),type:v}}function Di(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Mn(e,r,n){return{name:e,primKey:r,indexes:n,mappedClass:null,idxByName:(i=function(o){return[o.name,o]},n.reduce(function(o,l,d){return d=i(l,d),d&&(o[d[0]]=d[1]),o},{}))};var i}var Er=function(e){try{return e.only([[]]),Er=function(){return[[]]},[[]]}catch{return Er=function(){return ar},ar}};function jn(e){return e==null?function(){}:typeof e=="string"?(r=e).split(".").length===1?function(n){return n[r]}:function(n){return te(n,r)}:function(n){return te(n,e)};var r}function Ni(e){return[].slice.call(e)}var Wa=0;function Fr(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Ya(e,r,g){function i(x){if(x.type===3)return null;if(x.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var y=x.lower,w=x.upper,_=x.lowerOpen,x=x.upperOpen;return y===void 0?w===void 0?null:r.upperBound(w,!!x):w===void 0?r.lowerBound(y,!!_):r.bound(y,w,!!_,!!x)}function o(k){var y,w=k.name;return{name:w,schema:k,mutate:function(_){var x=_.trans,A=_.type,E=_.keys,F=_.values,R=_.range;return new Promise(function(z,J){z=Ge(z);var q=x.objectStore(w),G=q.keyPath==null,Q=A==="put"||A==="add";if(!Q&&A!=="delete"&&A!=="deleteRange")throw new Error("Invalid operation type: "+A);var Y,ie=(E||F||{length:1}).length;if(E&&F&&E.length!==F.length)throw new Error("Given keys array must have same length as given values array.");if(ie===0)return z({numFailures:0,failures:{},results:[],lastResult:void 0});function be(St){++Et,Pr(St)}var we=[],xe=[],Et=0;if(A==="deleteRange"){if(R.type===4)return z({numFailures:Et,failures:xe,results:[],lastResult:void 0});R.type===3?we.push(Y=q.clear()):we.push(Y=q.delete(i(R)))}else{var G=Q?G?[F,E]:[F,null]:[E,null],me=G[0],yt=G[1];if(Q)for(var bt=0;bt<ie;++bt)we.push(Y=yt&&yt[bt]!==void 0?q[A](me[bt],yt[bt]):q[A](me[bt])),Y.onerror=be;else for(bt=0;bt<ie;++bt)we.push(Y=q[A](me[bt])),Y.onerror=be}function fn(St){St=St.target.result,we.forEach(function(cr,ni){return cr.error!=null&&(xe[ni]=cr.error)}),z({numFailures:Et,failures:xe,results:A==="delete"?E:we.map(function(cr){return cr.result}),lastResult:St})}Y.onerror=function(St){be(St),fn(St)},Y.onsuccess=fn})},getMany:function(_){var x=_.trans,A=_.keys;return new Promise(function(E,F){E=Ge(E);for(var R,z=x.objectStore(w),J=A.length,q=new Array(J),G=0,Q=0,Y=function(we){we=we.target,q[we._pos]=we.result,++Q===G&&E(q)},ie=Ht(F),be=0;be<J;++be)A[be]!=null&&((R=z.get(A[be]))._pos=be,R.onsuccess=Y,R.onerror=ie,++G);G===0&&E(q)})},get:function(_){var x=_.trans,A=_.key;return new Promise(function(E,F){E=Ge(E);var R=x.objectStore(w).get(A);R.onsuccess=function(z){return E(z.target.result)},R.onerror=Ht(F)})},query:(y=m,function(_){return new Promise(function(x,A){x=Ge(x);var E,F,R,G=_.trans,z=_.values,J=_.limit,Y=_.query,q=J===1/0?void 0:J,Q=Y.index,Y=Y.range,G=G.objectStore(w),Q=Q.isPrimaryKey?G:G.index(Q.name),Y=i(Y);if(J===0)return x({result:[]});y?((q=z?Q.getAll(Y,q):Q.getAllKeys(Y,q)).onsuccess=function(ie){return x({result:ie.target.result})},q.onerror=Ht(A)):(E=0,F=!z&&"openKeyCursor"in Q?Q.openKeyCursor(Y):Q.openCursor(Y),R=[],F.onsuccess=function(ie){var be=F.result;return be?(R.push(z?be.value:be.primaryKey),++E===J?x({result:R}):void be.continue()):x({result:R})},F.onerror=Ht(A))})}),openCursor:function(_){var x=_.trans,A=_.values,E=_.query,F=_.reverse,R=_.unique;return new Promise(function(z,J){z=Ge(z);var Q=E.index,q=E.range,G=x.objectStore(w),G=Q.isPrimaryKey?G:G.index(Q.name),Q=F?R?"prevunique":"prev":R?"nextunique":"next",Y=!A&&"openKeyCursor"in G?G.openKeyCursor(i(q),Q):G.openCursor(i(q),Q);Y.onerror=Ht(J),Y.onsuccess=Ge(function(ie){var be,we,xe,Et,me=Y.result;me?(me.___id=++Wa,me.done=!1,be=me.continue.bind(me),we=(we=me.continuePrimaryKey)&&we.bind(me),xe=me.advance.bind(me),Et=function(){throw new Error("Cursor not stopped")},me.trans=x,me.stop=me.continue=me.continuePrimaryKey=me.advance=function(){throw new Error("Cursor not started")},me.fail=Ge(J),me.next=function(){var yt=this,bt=1;return this.start(function(){return bt--?yt.continue():yt.stop()}).then(function(){return yt})},me.start=function(yt){function bt(){if(Y.result)try{yt()}catch(St){me.fail(St)}else me.done=!0,me.start=function(){throw new Error("Cursor behind last entry")},me.stop()}var fn=new Promise(function(St,cr){St=Ge(St),Y.onerror=Ht(cr),me.fail=cr,me.stop=function(ni){me.stop=me.continue=me.continuePrimaryKey=me.advance=Et,St(ni)}});return Y.onsuccess=Ge(function(St){Y.onsuccess=bt,bt()}),me.continue=be,me.continuePrimaryKey=we,me.advance=xe,bt(),fn},z(me)):z(null)},J)})},count:function(_){var x=_.query,A=_.trans,E=x.index,F=x.range;return new Promise(function(R,z){var J=A.objectStore(w),q=E.isPrimaryKey?J:J.index(E.name),J=i(F),q=J?q.count(J):q.count();q.onsuccess=Ge(function(G){return R(G.target.result)}),q.onerror=Ht(z)})}}}var l,d,v,S=(d=g,v=Ni((l=e).objectStoreNames),{schema:{name:l.name,tables:v.map(function(k){return d.objectStore(k)}).map(function(k){var y=k.keyPath,x=k.autoIncrement,w=b(y),_={},x={name:k.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y==null,compound:w,keyPath:y,autoIncrement:x,unique:!0,extractKey:jn(y)},indexes:Ni(k.indexNames).map(function(A){return k.index(A)}).map(function(R){var E=R.name,F=R.unique,z=R.multiEntry,R=R.keyPath,z={name:E,compound:b(R),keyPath:R,unique:F,multiEntry:z,extractKey:jn(R)};return _[Fr(R)]=z}),getIndexByKeyPath:function(A){return _[Fr(A)]}};return _[":id"]=x.primaryKey,y!=null&&(_[Fr(y)]=x.primaryKey),x})},hasGetAll:0<v.length&&"getAll"in d.objectStore(v[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),g=S.schema,m=S.hasGetAll,S=g.tables.map(o),p={};return S.forEach(function(k){return p[k.name]=k}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(k){if(!p[k])throw new Error("Table '".concat(k,"' not found"));return p[k]},MIN_KEY:-1/0,MAX_KEY:Er(r),schema:g}}function Ja(e,r,n,i){var o=n.IDBKeyRange;return n.indexedDB,{dbcore:(i=Ya(r,o,i),e.dbcore.reduce(function(l,d){return d=d.create,s(s({},l),d(l))},i))}}function en(e,i){var n=i.db,i=Ja(e._middlewares,n,e._deps,i);e.core=i.dbcore,e.tables.forEach(function(o){var l=o.name;e.core.schema.tables.some(function(d){return d.name===l})&&(o.core=e.core.table(l),e[l]instanceof e.Table&&(e[l].core=o.core))})}function tn(e,r,n,i){n.forEach(function(o){var l=i[o];r.forEach(function(d){var v=(function g(m,S){return K(m,S)||(m=C(m))&&g(m,S)})(d,o);(!v||"value"in v&&v.value===void 0)&&(d===e.Transaction.prototype||d instanceof e.Transaction?M(d,o,{get:function(){return this.table(o)},set:function(g){W(this,o,{value:g,writable:!0,configurable:!0,enumerable:!0})}}):d[o]=new e.Table(o,l))})})}function Hn(e,r){r.forEach(function(n){for(var i in n)n[i]instanceof e.Table&&delete n[i]})}function Qa(e,r){return e._cfg.version-r._cfg.version}function $a(e,r,n,i){var o=e._dbSchema;n.objectStoreNames.contains("$meta")&&!o.$meta&&(o.$meta=Mn("$meta",Li("")[0],[]),e._storeNames.push("$meta"));var l=e._createTransaction("readwrite",e._storeNames,o);l.create(n),l._completion.catch(i);var d=l._reject.bind(l),v=se.transless||se;Yt(function(){return se.trans=l,se.transless=v,r!==0?(en(e,n),m=r,((g=l).storeNames.includes("$meta")?g.table("$meta").get("version").then(function(S){return S??m}):Z.resolve(m)).then(function(S){return k=S,y=l,w=n,_=[],S=(p=e)._versions,x=p._dbSchema=nn(0,p.idbdb,w),(S=S.filter(function(A){return A._cfg.version>=k})).length!==0?(S.forEach(function(A){_.push(function(){var E=x,F=A._cfg.dbschema;an(p,E,w),an(p,F,w),x=p._dbSchema=F;var R=Kn(E,F);R.add.forEach(function(Q){qn(w,Q[0],Q[1].primKey,Q[1].indexes)}),R.change.forEach(function(Q){if(Q.recreate)throw new re.Upgrade("Not yet support for changing primary key");var Y=w.objectStore(Q.name);Q.add.forEach(function(ie){return rn(Y,ie)}),Q.change.forEach(function(ie){Y.deleteIndex(ie.name),rn(Y,ie)}),Q.del.forEach(function(ie){return Y.deleteIndex(ie)})});var z=A._cfg.contentUpgrade;if(z&&A._cfg.version>k){en(p,w),y._memoizedTables={};var J=ve(F);R.del.forEach(function(Q){J[Q]=E[Q]}),Hn(p,[p.Transaction.prototype]),tn(p,[p.Transaction.prototype],h(J),J),y.schema=J;var q,G=at(z);return G&&vr(),R=Z.follow(function(){var Q;(q=z(y))&&G&&(Q=Jt.bind(null,null),q.then(Q,Q))}),q&&typeof q.then=="function"?Z.resolve(q):R.then(function(){return q})}}),_.push(function(E){var F,R,z=A._cfg.dbschema;F=z,R=E,[].slice.call(R.db.objectStoreNames).forEach(function(J){return F[J]==null&&R.db.deleteObjectStore(J)}),Hn(p,[p.Transaction.prototype]),tn(p,[p.Transaction.prototype],p._storeNames,p._dbSchema),y.schema=p._dbSchema}),_.push(function(E){p.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(p.idbdb.version/10)===A._cfg.version?(p.idbdb.deleteObjectStore("$meta"),delete p._dbSchema.$meta,p._storeNames=p._storeNames.filter(function(F){return F!=="$meta"})):E.objectStore("$meta").put(A._cfg.version,"version"))})}),(function A(){return _.length?Z.resolve(_.shift()(y.idbtrans)).then(A):Z.resolve()})().then(function(){Vi(x,w)})):Z.resolve();var p,k,y,w,_,x}).catch(d)):(h(o).forEach(function(S){qn(n,S,o[S].primKey,o[S].indexes)}),en(e,n),void Z.follow(function(){return e.on.populate.fire(l)}).catch(d));var g,m})}function Xa(e,r){Vi(e._dbSchema,r),r.db.version%10!=0||r.objectStoreNames.contains("$meta")||r.db.createObjectStore("$meta").add(Math.ceil(r.db.version/10-1),"version");var n=nn(0,e.idbdb,r);an(e,e._dbSchema,r);for(var i=0,o=Kn(n,e._dbSchema).change;i<o.length;i++){var l=(function(d){if(d.change.length||d.recreate)return console.warn("Unable to patch indexes of table ".concat(d.name," because it has changes on the type of index or primary key.")),{value:void 0};var v=r.objectStore(d.name);d.add.forEach(function(g){Ue&&console.debug("Dexie upgrade patch: Creating missing index ".concat(d.name,".").concat(g.src)),rn(v,g)})})(o[i]);if(typeof l=="object")return l.value}}function Kn(e,r){var n,i={del:[],add:[],change:[]};for(n in e)r[n]||i.del.push(n);for(n in r){var o=e[n],l=r[n];if(o){var d={name:n,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||o.primKey.auto!==l.primKey.auto)d.recreate=!0,i.change.push(d);else{var v=o.idxByName,g=l.idxByName,m=void 0;for(m in v)g[m]||d.del.push(m);for(m in g){var S=v[m],p=g[m];S?S.src!==p.src&&d.change.push(p):d.add.push(p)}(0<d.del.length||0<d.add.length||0<d.change.length)&&i.change.push(d)}}else i.add.push([n,l])}return i}function qn(e,r,n,i){var o=e.db.createObjectStore(r,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return i.forEach(function(l){return rn(o,l)}),o}function Vi(e,r){h(e).forEach(function(n){r.db.objectStoreNames.contains(n)||(Ue&&console.debug("Dexie: Creating missing table",n),qn(r,n,e[n].primKey,e[n].indexes))})}function rn(e,r){e.createIndex(r.name,r.keyPath,{unique:r.unique,multiEntry:r.multi})}function nn(e,r,n){var i={};return H(r.objectStoreNames,0).forEach(function(o){for(var l=n.objectStore(o),d=Rn(Di(m=l.keyPath),m||"",!0,!1,!!l.autoIncrement,m&&typeof m!="string",!0),v=[],g=0;g<l.indexNames.length;++g){var S=l.index(l.indexNames[g]),m=S.keyPath,S=Rn(S.name,m,!!S.unique,!!S.multiEntry,!1,m&&typeof m!="string",!1);v.push(S)}i[o]=Mn(o,d,v)}),i}function an(e,r,n){for(var i=n.db.objectStoreNames,o=0;o<i.length;++o){var l=i[o],d=n.objectStore(l);e._hasGetAll="getAll"in d;for(var v=0;v<d.indexNames.length;++v){var g=d.indexNames[v],m=d.index(g).keyPath,S=typeof m=="string"?m:"["+H(m).join("+")+"]";!r[l]||(m=r[l].idxByName[S])&&(m.name=g,delete r[l].idxByName[S],r[l].idxByName[g]=m)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&f.WorkerGlobalScope&&f instanceof f.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Li(e){return e.split(",").map(function(r,n){var l=r.split(":"),i=(o=l[1])===null||o===void 0?void 0:o.trim(),o=(r=l[0].trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return Rn(o,l||null,/\&/.test(r),/\*/.test(r),/\+\+/.test(r),b(l),n===0,i)})}var Za=(yr.prototype._createTableSchema=Mn,yr.prototype._parseIndexSyntax=Li,yr.prototype._parseStoresSpec=function(e,r){var n=this;h(e).forEach(function(i){if(e[i]!==null){var o=n._parseIndexSyntax(e[i]),l=o.shift();if(!l)throw new re.Schema("Invalid schema for table "+i+": "+e[i]);if(l.unique=!0,l.multi)throw new re.Schema("Primary key cannot be multiEntry*");o.forEach(function(d){if(d.auto)throw new re.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new re.Schema("Index must have a name and cannot be an empty string")}),o=n._createTableSchema(i,l,o),r[i]=o}})},yr.prototype.stores=function(n){var r=this.db;this._cfg.storesSource=this._cfg.storesSource?P(this._cfg.storesSource,n):n;var n=r._versions,i={},o={};return n.forEach(function(l){P(i,l._cfg.storesSource),o=l._cfg.dbschema={},l._parseStoresSpec(i,o)}),r._dbSchema=o,Hn(r,[r._allTables,r,r.Transaction.prototype]),tn(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],h(o),o),r._storeNames=h(o),this},yr.prototype.upgrade=function(e){return this._cfg.contentUpgrade=lt(this._cfg.contentUpgrade||pe,e),this},yr);function yr(){}function Bn(e,r){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Gt(Yr,{addons:[],indexedDB:e,IDBKeyRange:r})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function zn(e){return e&&typeof e.databases=="function"}function Un(e){return Yt(function(){return se.letThrough=!0,e()})}function Gn(e){return!("from"in e)}var mt=function(e,r){if(!this){var n=new mt;return e&&"d"in e&&P(n,e),n}P(this,arguments.length?{d:1,from:e,to:1<arguments.length?r:e}:{d:0})};function Tr(e,r,n){var i=Pe(r,n);if(!isNaN(i)){if(0<i)throw RangeError();if(Gn(e))return P(e,{from:r,to:n,d:1});var o=e.l,i=e.r;if(Pe(n,e.from)<0)return o?Tr(o,r,n):e.l={from:r,to:n,d:1,l:null,r:null},Mi(e);if(0<Pe(r,e.to))return i?Tr(i,r,n):e.r={from:r,to:n,d:1,l:null,r:null},Mi(e);Pe(r,e.from)<0&&(e.from=r,e.l=null,e.d=i?i.d+1:1),0<Pe(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,o&&!e.l&&Dr(e,o),i&&n&&Dr(e,i)}}function Dr(e,r){Gn(r)||(function n(i,g){var l=g.from,d=g.to,v=g.l,g=g.r;Tr(i,l,d),v&&n(i,v),g&&n(i,g)})(e,r)}function Ri(e,r){var n=on(r),i=n.next();if(i.done)return!1;for(var o=i.value,l=on(e),d=l.next(o.from),v=d.value;!i.done&&!d.done;){if(Pe(v.from,o.to)<=0&&0<=Pe(v.to,o.from))return!0;Pe(o.from,v.from)<0?o=(i=n.next(v.from)).value:v=(d=l.next(o.from)).value}return!1}function on(e){var r=Gn(e)?null:{s:0,n:e};return{next:function(n){for(var i=0<arguments.length;r;)switch(r.s){case 0:if(r.s=1,i)for(;r.n.l&&Pe(n,r.n.from)<0;)r={up:r,n:r.n.l,s:1};else for(;r.n.l;)r={up:r,n:r.n.l,s:1};case 1:if(r.s=2,!i||Pe(n,r.n.to)<=0)return{value:r.n,done:!1};case 2:if(r.n.r){r.s=3,r={up:r,n:r.n.r,s:0};continue}case 3:r=r.up}return{done:!0}}}}function Mi(e){var r,n,i=(((r=e.r)===null||r===void 0?void 0:r.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),o=1<i?"r":i<-1?"l":"";o&&(r=o=="r"?"l":"r",n=s({},e),i=e[o],e.from=i.from,e.to=i.to,e[o]=i[o],n[o]=i[r],(e[r]=n).d=ji(n)),e.d=ji(e)}function ji(n){var r=n.r,n=n.l;return(r?n?Math.max(r.d,n.d):r.d:n?n.d:0)+1}function sn(e,r){return h(r).forEach(function(n){e[n]?Dr(e[n],r[n]):e[n]=(function i(o){var l,d,v={};for(l in o)D(o,l)&&(d=o[l],v[l]=!d||typeof d!="object"||ye.has(d.constructor)?d:i(d));return v})(r[n])}),e}function Wn(e,r){return e.all||r.all||Object.keys(e).some(function(n){return r[n]&&Ri(r[n],e[n])})}N(mt.prototype,((Dt={add:function(e){return Dr(this,e),this},addKey:function(e){return Tr(this,e,e),this},addKeys:function(e){var r=this;return e.forEach(function(n){return Tr(r,n,n)}),this},hasKey:function(e){var r=on(this).next(e).value;return r&&Pe(r.from,e)<=0&&0<=Pe(r.to,e)}})[$e]=function(){return on(this)},Dt));var sr={},Yn={},Jn=!1;function ln(e){sn(Yn,e),Jn||(Jn=!0,setTimeout(function(){Jn=!1,Qn(Yn,!(Yn={}))},0))}function Qn(e,r){r===void 0&&(r=!1);var n=new Set;if(e.all)for(var i=0,o=Object.values(sr);i<o.length;i++)Hi(d=o[i],e,n,r);else for(var l in e){var d,v=/^idb\:\/\/(.*)\/(.*)\//.exec(l);v&&(l=v[1],v=v[2],(d=sr["idb://".concat(l,"/").concat(v)])&&Hi(d,e,n,r))}n.forEach(function(g){return g()})}function Hi(e,r,n,i){for(var o=[],l=0,d=Object.entries(e.queries.query);l<d.length;l++){for(var v=d[l],g=v[0],m=[],S=0,p=v[1];S<p.length;S++){var k=p[S];Wn(r,k.obsSet)?k.subscribers.forEach(function(x){return n.add(x)}):i&&m.push(k)}i&&o.push([g,m])}if(i)for(var y=0,w=o;y<w.length;y++){var _=w[y],g=_[0],m=_[1];e.queries.query[g]=m}}function eo(e){var r=e._state,n=e._deps.indexedDB;if(r.isBeingOpened||e.idbdb)return r.dbReadyPromise.then(function(){return r.dbOpenError?nt(r.dbOpenError):e});r.isBeingOpened=!0,r.dbOpenError=null,r.openComplete=!1;var i=r.openCanceller,o=Math.round(10*e.verno),l=!1;function d(){if(r.openCanceller!==i)throw new re.DatabaseClosed("db.open() was cancelled")}function v(){return new Z(function(k,y){if(d(),!n)throw new re.MissingAPI;var w=e.name,_=r.autoSchema||!o?n.open(w):n.open(w,o);if(!_)throw new re.MissingAPI;_.onerror=Ht(y),_.onblocked=Ge(e._fireOnBlocked),_.onupgradeneeded=Ge(function(x){var A;S=_.transaction,r.autoSchema&&!e._options.allowEmptyDB?(_.onerror=Pr,S.abort(),_.result.close(),(A=n.deleteDatabase(w)).onsuccess=A.onerror=Ge(function(){y(new re.NoSuchDatabase("Database ".concat(w," doesnt exist")))})):(S.onerror=Ht(y),x=x.oldVersion>Math.pow(2,62)?0:x.oldVersion,p=x<1,e.idbdb=_.result,l&&Xa(e,S),$a(e,x/10,S,y))},y),_.onsuccess=Ge(function(){S=null;var x,A,E,F,R,z=e.idbdb=_.result,J=H(z.objectStoreNames);if(0<J.length)try{var q=z.transaction((F=J).length===1?F[0]:F,"readonly");if(r.autoSchema)A=z,E=q,(x=e).verno=A.version/10,E=x._dbSchema=nn(0,A,E),x._storeNames=H(A.objectStoreNames,0),tn(x,[x._allTables],h(E),E);else if(an(e,e._dbSchema,q),((R=Kn(nn(0,(R=e).idbdb,q),R._dbSchema)).add.length||R.change.some(function(G){return G.add.length||G.change.length}))&&!l)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),z.close(),o=z.version+1,l=!0,k(v());en(e,q)}catch{}pr.push(e),z.onversionchange=Ge(function(G){r.vcFired=!0,e.on("versionchange").fire(G)}),z.onclose=Ge(function(){e.close({disableAutoOpen:!1})}),p&&(R=e._deps,q=w,z=R.indexedDB,R=R.IDBKeyRange,zn(z)||q===Yr||Bn(z,R).put({name:q}).catch(pe)),k()},y)}).catch(function(k){switch(k?.name){case"UnknownError":if(0<r.PR1398_maxLoop)return r.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),v();break;case"VersionError":if(0<o)return o=0,v()}return Z.reject(k)})}var g,m=r.dbReadyResolve,S=null,p=!1;return Z.race([i,(typeof navigator>"u"?Z.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(k){function y(){return indexedDB.databases().finally(k)}g=setInterval(y,100),y()}).finally(function(){return clearInterval(g)}):Promise.resolve()).then(v)]).then(function(){return d(),r.onReadyBeingFired=[],Z.resolve(Un(function(){return e.on.ready.fire(e.vip)})).then(function k(){if(0<r.onReadyBeingFired.length){var y=r.onReadyBeingFired.reduce(lt,pe);return r.onReadyBeingFired=[],Z.resolve(Un(function(){return y(e.vip)})).then(k)}})}).finally(function(){r.openCanceller===i&&(r.onReadyBeingFired=null,r.isBeingOpened=!1)}).catch(function(k){r.dbOpenError=k;try{S&&S.abort()}catch{}return i===r.openCanceller&&e._close(),nt(k)}).finally(function(){r.openComplete=!0,m()}).then(function(){var k;return p&&(k={},e.tables.forEach(function(y){y.schema.indexes.forEach(function(w){w.name&&(k["idb://".concat(e.name,"/").concat(y.name,"/").concat(w.name)]=new mt(-1/0,[[[]]]))}),k["idb://".concat(e.name,"/").concat(y.name,"/")]=k["idb://".concat(e.name,"/").concat(y.name,"/:dels")]=new mt(-1/0,[[[]]])}),Xt(Or).fire(k),Qn(k,!0)),e})}function $n(e){function r(l){return e.next(l)}var n=o(r),i=o(function(l){return e.throw(l)});function o(l){return function(g){var v=l(g),g=v.value;return v.done?g:g&&typeof g.then=="function"?g.then(n,i):b(g)?Promise.all(g).then(n,i):n(g)}}return o(r)()}function cn(e,r,n){for(var i=b(e)?e.slice():[e],o=0;o<n;++o)i.push(r);return i}var to={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return s(s({},e),{table:function(r){var n=e.table(r),i=n.schema,o={},l=[];function d(p,k,y){var w=Fr(p),_=o[w]=o[w]||[],x=p==null?0:typeof p=="string"?1:p.length,A=0<k,A=s(s({},y),{name:A?"".concat(w,"(virtual-from:").concat(y.name,")"):y.name,lowLevelIndex:y,isVirtual:A,keyTail:k,keyLength:x,extractKey:jn(p),unique:!A&&y.unique});return _.push(A),A.isPrimaryKey||l.push(A),1<x&&d(x===2?p[0]:p.slice(0,x-1),k+1,y),_.sort(function(E,F){return E.keyTail-F.keyTail}),A}r=d(i.primaryKey.keyPath,0,i.primaryKey),o[":id"]=[r];for(var v=0,g=i.indexes;v<g.length;v++){var m=g[v];d(m.keyPath,0,m)}function S(p){var k,y=p.query.index;return y.isVirtual?s(s({},p),{query:{index:y.lowLevelIndex,range:(k=p.query.range,y=y.keyTail,{type:k.type===1?2:k.type,lower:cn(k.lower,k.lowerOpen?e.MAX_KEY:e.MIN_KEY,y),lowerOpen:!0,upper:cn(k.upper,k.upperOpen?e.MIN_KEY:e.MAX_KEY,y),upperOpen:!0})}}):p}return s(s({},n),{schema:s(s({},i),{primaryKey:r,indexes:l,getIndexByKeyPath:function(p){return(p=o[Fr(p)])&&p[0]}}),count:function(p){return n.count(S(p))},query:function(p){return n.query(S(p))},openCursor:function(p){var k=p.query.index,y=k.keyTail,w=k.isVirtual,_=k.keyLength;return w?n.openCursor(S(p)).then(function(A){return A&&x(A)}):n.openCursor(p);function x(A){return Object.create(A,{continue:{value:function(E){E!=null?A.continue(cn(E,p.reverse?e.MAX_KEY:e.MIN_KEY,y)):p.unique?A.continue(A.key.slice(0,_).concat(p.reverse?e.MIN_KEY:e.MAX_KEY,y)):A.continue()}},continuePrimaryKey:{value:function(E,F){A.continuePrimaryKey(cn(E,e.MAX_KEY,y),F)}},primaryKey:{get:function(){return A.primaryKey}},key:{get:function(){var E=A.key;return _===1?E[0]:E.slice(0,_)}},value:{get:function(){return A.value}}})}}})}})}};function Xn(e,r,n,i){return n=n||{},i=i||"",h(e).forEach(function(o){var l,d,v;D(r,o)?(l=e[o],d=r[o],typeof l=="object"&&typeof d=="object"&&l&&d?(v=Be(l))!==Be(d)?n[i+o]=r[o]:v==="Object"?Xn(l,d,n,i+o+"."):l!==d&&(n[i+o]=r[o]):l!==d&&(n[i+o]=r[o])):n[i+o]=void 0}),h(r).forEach(function(o){D(e,o)||(n[i+o]=r[o])}),n}function Zn(e,r){return r.type==="delete"?r.keys:r.keys||r.values.map(e.extractKey)}var ro={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return s(s({},e),{table:function(r){var n=e.table(r),i=n.schema.primaryKey;return s(s({},n),{mutate:function(o){var l=se.trans,d=l.table(r).hook,v=d.deleting,g=d.creating,m=d.updating;switch(o.type){case"add":if(g.fire===pe)break;return l._promise("readwrite",function(){return S(o)},!0);case"put":if(g.fire===pe&&m.fire===pe)break;return l._promise("readwrite",function(){return S(o)},!0);case"delete":if(v.fire===pe)break;return l._promise("readwrite",function(){return S(o)},!0);case"deleteRange":if(v.fire===pe)break;return l._promise("readwrite",function(){return(function p(k,y,w){return n.query({trans:k,values:!1,query:{index:i,range:y},limit:w}).then(function(_){var x=_.result;return S({type:"delete",keys:x,trans:k}).then(function(A){return 0<A.numFailures?Promise.reject(A.failures[0]):x.length<w?{failures:[],numFailures:0,lastResult:void 0}:p(k,s(s({},y),{lower:x[x.length-1],lowerOpen:!0}),w)})})})(o.trans,o.range,1e4)},!0)}return n.mutate(o);function S(p){var k,y,w,_=se.trans,x=p.keys||Zn(i,p);if(!x)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?s(s({},p),{keys:x}):s({},p)).type!=="delete"&&(p.values=c([],p.values)),p.keys&&(p.keys=c([],p.keys)),k=n,w=x,((y=p).type==="add"?Promise.resolve([]):k.getMany({trans:y.trans,keys:w,cache:"immutable"})).then(function(A){var E=x.map(function(F,R){var z,J,q,G=A[R],Q={onerror:null,onsuccess:null};return p.type==="delete"?v.fire.call(Q,F,G,_):p.type==="add"||G===void 0?(z=g.fire.call(Q,F,p.values[R],_),F==null&&z!=null&&(p.keys[R]=F=z,i.outbound||oe(p.values[R],i.keyPath,F))):(z=Xn(G,p.values[R]),(J=m.fire.call(Q,z,F,G,_))&&(q=p.values[R],Object.keys(J).forEach(function(Y){D(q,Y)?q[Y]=J[Y]:oe(q,Y,J[Y])}))),Q});return n.mutate(p).then(function(F){for(var R=F.failures,z=F.results,J=F.numFailures,F=F.lastResult,q=0;q<x.length;++q){var G=(z||x)[q],Q=E[q];G==null?Q.onerror&&Q.onerror(R[q]):Q.onsuccess&&Q.onsuccess(p.type==="put"&&A[q]?p.values[q]:G)}return{failures:R,results:z,numFailures:J,lastResult:F}}).catch(function(F){return E.forEach(function(R){return R.onerror&&R.onerror(F)}),Promise.reject(F)})})}}})}})}};function Ki(e,r,n){try{if(!r||r.keys.length<e.length)return null;for(var i=[],o=0,l=0;o<r.keys.length&&l<e.length;++o)Pe(r.keys[o],e[l])===0&&(i.push(n?_e(r.values[o]):r.values[o]),++l);return i.length===e.length?i:null}catch{return null}}var no={stack:"dbcore",level:-1,create:function(e){return{table:function(r){var n=e.table(r);return s(s({},n),{getMany:function(i){if(!i.cache)return n.getMany(i);var o=Ki(i.keys,i.trans._cache,i.cache==="clone");return o?Z.resolve(o):n.getMany(i).then(function(l){return i.trans._cache={keys:i.keys,values:i.cache==="clone"?_e(l):l},l})},mutate:function(i){return i.type!=="add"&&(i.trans._cache=null),n.mutate(i)}})}}}};function qi(e,r){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!r.schema.primaryKey.outbound}function Bi(e,r){switch(e){case"query":return r.values&&!r.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var io={stack:"dbcore",level:0,name:"Observability",create:function(e){var r=e.schema.name,n=new mt(e.MIN_KEY,e.MAX_KEY);return s(s({},e),{transaction:function(i,o,l){if(se.subscr&&o!=="readonly")throw new re.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(se.querier));return e.transaction(i,o,l)},table:function(i){var o=e.table(i),l=o.schema,d=l.primaryKey,p=l.indexes,v=d.extractKey,g=d.outbound,m=d.autoIncrement&&p.filter(function(y){return y.compound&&y.keyPath.includes(d.keyPath)}),S=s(s({},o),{mutate:function(y){function w(Y){return Y="idb://".concat(r,"/").concat(i,"/").concat(Y),F[Y]||(F[Y]=new mt)}var _,x,A,E=y.trans,F=y.mutatedParts||(y.mutatedParts={}),R=w(""),z=w(":dels"),J=y.type,Q=y.type==="deleteRange"?[y.range]:y.type==="delete"?[y.keys]:y.values.length<50?[Zn(d,y).filter(function(Y){return Y}),y.values]:[],q=Q[0],G=Q[1],Q=y.trans._cache;return b(q)?(R.addKeys(q),(Q=J==="delete"||q.length===G.length?Ki(q,Q):null)||z.addKeys(q),(Q||G)&&(_=w,x=Q,A=G,l.indexes.forEach(function(Y){var ie=_(Y.name||"");function be(xe){return xe!=null?Y.extractKey(xe):null}function we(xe){return Y.multiEntry&&b(xe)?xe.forEach(function(Et){return ie.addKey(Et)}):ie.addKey(xe)}(x||A).forEach(function(xe,yt){var me=x&&be(x[yt]),yt=A&&be(A[yt]);Pe(me,yt)!==0&&(me!=null&&we(me),yt!=null&&we(yt))})}))):q?(G={from:(G=q.lower)!==null&&G!==void 0?G:e.MIN_KEY,to:(G=q.upper)!==null&&G!==void 0?G:e.MAX_KEY},z.add(G),R.add(G)):(R.add(n),z.add(n),l.indexes.forEach(function(Y){return w(Y.name).add(n)})),o.mutate(y).then(function(Y){return!q||y.type!=="add"&&y.type!=="put"||(R.addKeys(Y.results),m&&m.forEach(function(ie){for(var be=y.values.map(function(me){return ie.extractKey(me)}),we=ie.keyPath.findIndex(function(me){return me===d.keyPath}),xe=0,Et=Y.results.length;xe<Et;++xe)be[xe][we]=Y.results[xe];w(ie.name).addKeys(be)})),E.mutatedParts=sn(E.mutatedParts||{},F),Y})}}),p=function(w){var _=w.query,w=_.index,_=_.range;return[w,new mt((w=_.lower)!==null&&w!==void 0?w:e.MIN_KEY,(_=_.upper)!==null&&_!==void 0?_:e.MAX_KEY)]},k={get:function(y){return[d,new mt(y.key)]},getMany:function(y){return[d,new mt().addKeys(y.keys)]},count:p,query:p,openCursor:p};return h(k).forEach(function(y){S[y]=function(w){var _=se.subscr,x=!!_,A=qi(se,o)&&Bi(y,w)?w.obsSet={}:_;if(x){var E=function(G){return G="idb://".concat(r,"/").concat(i,"/").concat(G),A[G]||(A[G]=new mt)},F=E(""),R=E(":dels"),_=k[y](w),x=_[0],_=_[1];if((y==="query"&&x.isPrimaryKey&&!w.values?R:E(x.name||"")).add(_),!x.isPrimaryKey){if(y!=="count"){var z=y==="query"&&g&&w.values&&o.query(s(s({},w),{values:!1}));return o[y].apply(this,arguments).then(function(G){if(y==="query"){if(g&&w.values)return z.then(function(be){return be=be.result,F.addKeys(be),G});var Q=w.values?G.result.map(v):G.result;(w.values?F:R).addKeys(Q)}else if(y==="openCursor"){var Y=G,ie=w.values;return Y&&Object.create(Y,{key:{get:function(){return R.addKey(Y.primaryKey),Y.key}},primaryKey:{get:function(){var be=Y.primaryKey;return R.addKey(be),be}},value:{get:function(){return ie&&F.addKey(Y.primaryKey),Y.value}}})}return G})}R.add(n)}}return o[y].apply(this,arguments)}}),S}})}};function zi(e,r,n){if(n.numFailures===0)return r;if(r.type==="deleteRange")return null;var i=r.keys?r.keys.length:"values"in r&&r.values?r.values.length:1;return n.numFailures===i?null:(r=s({},r),b(r.keys)&&(r.keys=r.keys.filter(function(o,l){return!(l in n.failures)})),"values"in r&&b(r.values)&&(r.values=r.values.filter(function(o,l){return!(l in n.failures)})),r)}function ei(e,r){return n=e,((i=r).lower===void 0||(i.lowerOpen?0<Pe(n,i.lower):0<=Pe(n,i.lower)))&&(e=e,(r=r).upper===void 0||(r.upperOpen?Pe(e,r.upper)<0:Pe(e,r.upper)<=0));var n,i}function Ui(e,r,k,i,o,l){if(!k||k.length===0)return e;var d=r.query.index,v=d.multiEntry,g=r.query.range,m=i.schema.primaryKey.extractKey,S=d.extractKey,p=(d.lowLevelIndex||d).extractKey,k=k.reduce(function(y,w){var _=y,x=[];if(w.type==="add"||w.type==="put")for(var A=new mt,E=w.values.length-1;0<=E;--E){var F,R=w.values[E],z=m(R);A.hasKey(z)||(F=S(R),(v&&b(F)?F.some(function(Y){return ei(Y,g)}):ei(F,g))&&(A.addKey(z),x.push(R)))}switch(w.type){case"add":var J=new mt().addKeys(r.values?y.map(function(ie){return m(ie)}):y),_=y.concat(r.values?x.filter(function(ie){return ie=m(ie),!J.hasKey(ie)&&(J.addKey(ie),!0)}):x.map(function(ie){return m(ie)}).filter(function(ie){return!J.hasKey(ie)&&(J.addKey(ie),!0)}));break;case"put":var q=new mt().addKeys(w.values.map(function(ie){return m(ie)}));_=y.filter(function(ie){return!q.hasKey(r.values?m(ie):ie)}).concat(r.values?x:x.map(function(ie){return m(ie)}));break;case"delete":var G=new mt().addKeys(w.keys);_=y.filter(function(ie){return!G.hasKey(r.values?m(ie):ie)});break;case"deleteRange":var Q=w.range;_=y.filter(function(ie){return!ei(m(ie),Q)})}return _},e);return k===e?e:(k.sort(function(y,w){return Pe(p(y),p(w))||Pe(m(y),m(w))}),r.limit&&r.limit<1/0&&(k.length>r.limit?k.length=r.limit:e.length===r.limit&&k.length<r.limit&&(o.dirty=!0)),l?Object.freeze(k):k)}function Gi(e,r){return Pe(e.lower,r.lower)===0&&Pe(e.upper,r.upper)===0&&!!e.lowerOpen==!!r.lowerOpen&&!!e.upperOpen==!!r.upperOpen}function ao(e,r){return(function(n,i,o,l){if(n===void 0)return i!==void 0?-1:0;if(i===void 0)return 1;if((i=Pe(n,i))===0){if(o&&l)return 0;if(o)return 1;if(l)return-1}return i})(e.lower,r.lower,e.lowerOpen,r.lowerOpen)<=0&&0<=(function(n,i,o,l){if(n===void 0)return i!==void 0?1:0;if(i===void 0)return-1;if((i=Pe(n,i))===0){if(o&&l)return 0;if(o)return-1;if(l)return 1}return i})(e.upper,r.upper,e.upperOpen,r.upperOpen)}function oo(e,r,n,i){e.subscribers.add(n),i.addEventListener("abort",function(){var o,l;e.subscribers.delete(n),e.subscribers.size===0&&(o=e,l=r,setTimeout(function(){o.subscribers.size===0&&Le(l,o)},3e3))})}var so={stack:"dbcore",level:0,name:"Cache",create:function(e){var r=e.schema.name;return s(s({},e),{transaction:function(n,i,o){var l,d,v=e.transaction(n,i,o);return i==="readwrite"&&(d=(l=new AbortController).signal,o=function(g){return function(){if(l.abort(),i==="readwrite"){for(var m=new Set,S=0,p=n;S<p.length;S++){var k=p[S],y=sr["idb://".concat(r,"/").concat(k)];if(y){var w=e.table(k),_=y.optimisticOps.filter(function(ie){return ie.trans===v});if(v._explicit&&g&&v.mutatedParts)for(var x=0,A=Object.values(y.queries.query);x<A.length;x++)for(var E=0,F=(J=A[x]).slice();E<F.length;E++)Wn((q=F[E]).obsSet,v.mutatedParts)&&(Le(J,q),q.subscribers.forEach(function(ie){return m.add(ie)}));else if(0<_.length){y.optimisticOps=y.optimisticOps.filter(function(ie){return ie.trans!==v});for(var R=0,z=Object.values(y.queries.query);R<z.length;R++)for(var J,q,G,Q=0,Y=(J=z[R]).slice();Q<Y.length;Q++)(q=Y[Q]).res!=null&&v.mutatedParts&&(g&&!q.dirty?(G=Object.isFrozen(q.res),G=Ui(q.res,q.req,_,w,q,G),q.dirty?(Le(J,q),q.subscribers.forEach(function(ie){return m.add(ie)})):G!==q.res&&(q.res=G,q.promise=Z.resolve({result:G}))):(q.dirty&&Le(J,q),q.subscribers.forEach(function(ie){return m.add(ie)})))}}}m.forEach(function(ie){return ie()})}}},v.addEventListener("abort",o(!1),{signal:d}),v.addEventListener("error",o(!1),{signal:d}),v.addEventListener("complete",o(!0),{signal:d})),v},table:function(n){var i=e.table(n),o=i.schema.primaryKey;return s(s({},i),{mutate:function(l){var d=se.trans;if(o.outbound||d.db._options.cache==="disabled"||d.explicit||d.idbtrans.mode!=="readwrite")return i.mutate(l);var v=sr["idb://".concat(r,"/").concat(n)];return v?(d=i.mutate(l),l.type!=="add"&&l.type!=="put"||!(50<=l.values.length||Zn(o,l).some(function(g){return g==null}))?(v.optimisticOps.push(l),l.mutatedParts&&ln(l.mutatedParts),d.then(function(g){0<g.numFailures&&(Le(v.optimisticOps,l),(g=zi(0,l,g))&&v.optimisticOps.push(g),l.mutatedParts&&ln(l.mutatedParts))}),d.catch(function(){Le(v.optimisticOps,l),l.mutatedParts&&ln(l.mutatedParts)})):d.then(function(g){var m=zi(0,s(s({},l),{values:l.values.map(function(S,p){var k;return g.failures[p]?S:(S=(k=o.keyPath)!==null&&k!==void 0&&k.includes(".")?_e(S):s({},S),oe(S,o.keyPath,g.results[p]),S)})}),g);v.optimisticOps.push(m),queueMicrotask(function(){return l.mutatedParts&&ln(l.mutatedParts)})}),d):i.mutate(l)},query:function(l){if(!qi(se,i)||!Bi("query",l))return i.query(l);var d=((m=se.trans)===null||m===void 0?void 0:m.db._options.cache)==="immutable",p=se,v=p.requery,g=p.signal,m=(function(w,_,x,A){var E=sr["idb://".concat(w,"/").concat(_)];if(!E)return[];if(!(_=E.queries[x]))return[null,!1,E,null];var F=_[(A.query?A.query.index.name:null)||""];if(!F)return[null,!1,E,null];switch(x){case"query":var R=F.find(function(z){return z.req.limit===A.limit&&z.req.values===A.values&&Gi(z.req.query.range,A.query.range)});return R?[R,!0,E,F]:[F.find(function(z){return("limit"in z.req?z.req.limit:1/0)>=A.limit&&(!A.values||z.req.values)&&ao(z.req.query.range,A.query.range)}),!1,E,F];case"count":return R=F.find(function(z){return Gi(z.req.query.range,A.query.range)}),[R,!!R,E,F]}})(r,n,"query",l),S=m[0],p=m[1],k=m[2],y=m[3];return S&&p?S.obsSet=l.obsSet:(p=i.query(l).then(function(w){var _=w.result;if(S&&(S.res=_),d){for(var x=0,A=_.length;x<A;++x)Object.freeze(_[x]);Object.freeze(_)}else w.result=_e(_);return w}).catch(function(w){return y&&S&&Le(y,S),Promise.reject(w)}),S={obsSet:l.obsSet,promise:p,subscribers:new Set,type:"query",req:l,dirty:!1},y?y.push(S):(y=[S],(k=k||(sr["idb://".concat(r,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[l.query.index.name||""]=y)),oo(S,y,v,g),S.promise.then(function(w){return{result:Ui(w.result,l,k?.optimisticOps,i,S,d)}})}})}})}};function un(e,r){return new Proxy(e,{get:function(n,i,o){return i==="db"?r:Reflect.get(n,i,o)}})}var Gt=(it.prototype.version=function(e){if(isNaN(e)||e<.1)throw new re.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new re.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var r=this._versions,n=r.filter(function(i){return i._cfg.version===e})[0];return n||(n=new this.Version(e),r.push(n),r.sort(Qa),n.stores({}),this._state.autoSchema=!1,n)},it.prototype._whenReady=function(e){var r=this;return this.idbdb&&(this._state.openComplete||se.letThrough||this._vip)?e():new Z(function(n,i){if(r._state.openComplete)return i(new re.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._state.autoOpen)return void i(new re.DatabaseClosed);r.open().catch(pe)}r._state.dbReadyPromise.then(n,i)}).then(e)},it.prototype.use=function(e){var r=e.stack,n=e.create,i=e.level,o=e.name;return o&&this.unuse({stack:r,name:o}),e=this._middlewares[r]||(this._middlewares[r]=[]),e.push({stack:r,create:n,level:i??10,name:o}),e.sort(function(l,d){return l.level-d.level}),this},it.prototype.unuse=function(e){var r=e.stack,n=e.name,i=e.create;return r&&this._middlewares[r]&&(this._middlewares[r]=this._middlewares[r].filter(function(o){return i?o.create!==i:!!n&&o.name!==n})),this},it.prototype.open=function(){var e=this;return ir(Pt,function(){return eo(e)})},it.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,r=pr.indexOf(this);if(0<=r&&pr.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new Z(function(n){e.dbReadyResolve=n}),e.openCanceller=new Z(function(n,i){e.cancelOpen=i}))},it.prototype.close=function(n){var r=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;r?(n.isBeingOpened&&n.cancelOpen(new re.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new re.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},it.prototype.delete=function(e){var r=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",i=this._state;return new Z(function(o,l){function d(){r.close(e);var v=r._deps.indexedDB.deleteDatabase(r.name);v.onsuccess=Ge(function(){var g,m,S;g=r._deps,m=r.name,S=g.indexedDB,g=g.IDBKeyRange,zn(S)||m===Yr||Bn(S,g).delete(m).catch(pe),o()}),v.onerror=Ht(l),v.onblocked=r._fireOnBlocked}if(n)throw new re.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(d):d()})},it.prototype.backendDB=function(){return this.idbdb},it.prototype.isOpen=function(){return this.idbdb!==null},it.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},it.prototype.hasFailed=function(){return this._state.dbOpenError!==null},it.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(it.prototype,"tables",{get:function(){var e=this;return h(this._allTables).map(function(r){return e._allTables[r]})},enumerable:!1,configurable:!0}),it.prototype.transaction=function(){var e=(function(r,n,i){var o=arguments.length;if(o<2)throw new re.InvalidArgument("Too few arguments");for(var l=new Array(o-1);--o;)l[o-1]=arguments[o];return i=l.pop(),[r,ce(l),i]}).apply(this,arguments);return this._transaction.apply(this,e)},it.prototype._transaction=function(e,r,n){var i=this,o=se.trans;o&&o.db===this&&e.indexOf("!")===-1||(o=null);var l,d,v=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(d=r.map(function(m){if(m=m instanceof i.Table?m.name:m,typeof m!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return m}),e=="r"||e===Tn)l=Tn;else{if(e!="rw"&&e!=Dn)throw new re.InvalidArgument("Invalid transaction mode: "+e);l=Dn}if(o){if(o.mode===Tn&&l===Dn){if(!v)throw new re.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&d.forEach(function(m){if(o&&o.storeNames.indexOf(m)===-1){if(!v)throw new re.SubTransaction("Table "+m+" not included in parent transaction.");o=null}}),v&&o&&!o.active&&(o=null)}}catch(m){return o?o._promise(null,function(S,p){p(m)}):nt(m)}var g=(function m(S,p,k,y,w){return Z.resolve().then(function(){var _=se.transless||se,x=S._createTransaction(p,k,S._dbSchema,y);if(x.explicit=!0,_={trans:x,transless:_},y)x.idbtrans=y.idbtrans;else try{x.create(),x.idbtrans._explicit=!0,S._state.PR1398_maxLoop=3}catch(F){return F.name===et.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return m(S,p,k,null,w)})):nt(F)}var A,E=at(w);return E&&vr(),_=Z.follow(function(){var F;(A=w.call(x,x))&&(E?(F=Jt.bind(null,null),A.then(F,F)):typeof A.next=="function"&&typeof A.throw=="function"&&(A=$n(A)))},_),(A&&typeof A.then=="function"?Z.resolve(A).then(function(F){return x.active?F:nt(new re.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):_.then(function(){return A})).then(function(F){return y&&x._resolve(),x._completion.then(function(){return F})}).catch(function(F){return x._reject(F),nt(F)})})}).bind(null,this,l,d,o,n);return o?o._promise(l,g,"lock"):se.trans?ir(se.transless,function(){return i._whenReady(g)}):this._whenReady(g)},it.prototype.table=function(e){if(!D(this._allTables,e))throw new re.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},it);function it(e,r){var n=this;this._middlewares={},this.verno=0;var i=it.dependencies;this._options=r=s({addons:it.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange},i=r.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o,l,d,v,g,m={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:pe,dbReadyPromise:null,cancelOpen:pe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:r.autoOpen};m.dbReadyPromise=new Z(function(p){m.dbReadyResolve=p}),m.openCanceller=new Z(function(p,k){m.cancelOpen=k}),this._state=m,this.name=e,this.on=Cr(this,"populate","blocked","versionchange","close",{ready:[lt,pe]}),this.once=function(p,k){var y=function(){for(var w=[],_=0;_<arguments.length;_++)w[_]=arguments[_];n.on(p).unsubscribe(y),k.apply(n,w)};return n.on(p,y)},this.on.ready.subscribe=j(this.on.ready.subscribe,function(p){return function(k,y){it.vip(function(){var w,_=n._state;_.openComplete?(_.dbOpenError||Z.resolve().then(k),y&&p(k)):_.onReadyBeingFired?(_.onReadyBeingFired.push(k),y&&p(k)):(p(k),w=n,y||p(function x(){w.on.ready.unsubscribe(k),w.on.ready.unsubscribe(x)}))})}}),this.Collection=(o=this,Ar(Ba.prototype,function(A,x){this.db=o;var y=_i,w=null;if(x)try{y=x()}catch(E){w=E}var _=A._ctx,x=_.table,A=x.hook.reading.fire;this._ctx={table:x,index:_.index,isPrimKey:!_.index||x.schema.primKey.keyPath&&_.index===x.schema.primKey.name,range:y,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:w,or:_.or,valueMapper:A!==qe?A:null}})),this.Table=(l=this,Ar(Ai.prototype,function(p,k,y){this.db=l,this._tx=y,this.name=p,this.schema=k,this.hook=l._allTables[p]?l._allTables[p].hook:Cr(null,{creating:[ut,pe],reading:[gt,qe],updating:[rt,pe],deleting:[pt,pe]})})),this.Transaction=(d=this,Ar(Ga.prototype,function(p,k,y,w,_){var x=this;p!=="readonly"&&k.forEach(function(A){A=(A=y[A])===null||A===void 0?void 0:A.yProps,A&&(k=k.concat(A.map(function(E){return E.updatesTable})))}),this.db=d,this.mode=p,this.storeNames=k,this.schema=y,this.chromeTransactionDurability=w,this.idbtrans=null,this.on=Cr(this,"complete","error","abort"),this.parent=_||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Z(function(A,E){x._resolve=A,x._reject=E}),this._completion.then(function(){x.active=!1,x.on.complete.fire()},function(A){var E=x.active;return x.active=!1,x.on.error.fire(A),x.parent?x.parent._reject(A):E&&x.idbtrans&&x.idbtrans.abort(),nt(A)})})),this.Version=(v=this,Ar(Za.prototype,function(p){this.db=v,this._cfg={version:p,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(g=this,Ar(Ti.prototype,function(p,k,y){if(this.db=g,this._ctx={table:p,index:k===":id"?null:k,or:y},this._cmp=this._ascending=Pe,this._descending=function(w,_){return Pe(_,w)},this._max=function(w,_){return 0<Pe(w,_)?w:_},this._min=function(w,_){return Pe(w,_)<0?w:_},this._IDBKeyRange=g._deps.IDBKeyRange,!this._IDBKeyRange)throw new re.MissingAPI})),this.on("versionchange",function(p){0<p.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(p){!p.newVersion||p.newVersion<p.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(p.oldVersion/10))}),this._maxKey=Er(r.IDBKeyRange),this._createTransaction=function(p,k,y,w){return new n.Transaction(p,k,y,n._options.chromeTransactionDurability,w)},this._fireOnBlocked=function(p){n.on("blocked").fire(p),pr.filter(function(k){return k.name===n.name&&k!==n&&!k._state.vcFired}).map(function(k){return k.on("versionchange").fire(p)})},this.use(no),this.use(so),this.use(io),this.use(to),this.use(ro);var S=new Proxy(this,{get:function(p,k,y){if(k==="_vip")return!0;if(k==="table")return function(_){return un(n.table(_),S)};var w=Reflect.get(p,k,y);return w instanceof Ai?un(w,S):k==="tables"?w.map(function(_){return un(_,S)}):k==="_createTransaction"?function(){return un(w.apply(this,arguments),S)}:w}});this.vip=S,i.forEach(function(p){return p(n)})}var dn,Dt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",lo=(ti.prototype.subscribe=function(e,r,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:r,complete:n})},ti.prototype[Dt]=function(){return this},ti);function ti(e){this._subscribe=e}try{dn={indexedDB:f.indexedDB||f.mozIndexedDB||f.webkitIndexedDB||f.msIndexedDB,IDBKeyRange:f.IDBKeyRange||f.webkitIDBKeyRange}}catch{dn={indexedDB:null,IDBKeyRange:null}}function Wi(e){var r,n=!1,i=new lo(function(o){var l=at(e),d,v=!1,g={},m={},S={get closed(){return v},unsubscribe:function(){v||(v=!0,d&&d.abort(),p&&Xt.storagemutated.unsubscribe(y))}};o.start&&o.start(S);var p=!1,k=function(){return Fn(w)},y=function(_){sn(g,_),Wn(m,g)&&k()},w=function(){var _,x,A;!v&&dn.indexedDB&&(g={},_={},d&&d.abort(),d=new AbortController,A=(function(E){var F=fr();try{l&&vr();var R=Yt(e,E);return R=l?R.finally(Jt):R}finally{F&&hr()}})(x={subscr:_,signal:d.signal,requery:k,querier:e,trans:null}),Promise.resolve(A).then(function(E){n=!0,r=E,v||x.signal.aborted||(g={},(function(F){for(var R in F)if(D(F,R))return;return 1})(m=_)||p||(Xt(Or,y),p=!0),Fn(function(){return!v&&o.next&&o.next(E)}))},function(E){n=!1,["DatabaseClosedError","AbortError"].includes(E?.name)||v||Fn(function(){v||o.error&&o.error(E)})}))};return setTimeout(k,0),S});return i.hasValue=function(){return n},i.getValue=function(){return r},i}var lr=Gt;function ri(e){var r=Zt;try{Zt=!0,Xt.storagemutated.fire(e),Qn(e,!0)}finally{Zt=r}}N(lr,s(s({},tt),{delete:function(e){return new lr(e,{addons:[]}).delete()},exists:function(e){return new lr(e,{addons:[]}).open().then(function(r){return r.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return r=lr.dependencies,n=r.indexedDB,r=r.IDBKeyRange,(zn(n)?Promise.resolve(n.databases()).then(function(i){return i.map(function(o){return o.name}).filter(function(o){return o!==Yr})}):Bn(n,r).toCollection().primaryKeys()).then(e)}catch{return nt(new re.MissingAPI)}var r,n},defineClass:function(){return function(e){P(this,e)}},ignoreTransaction:function(e){return se.trans?ir(se.transless,e):e()},vip:Un,async:function(e){return function(){try{var r=$n(e.apply(this,arguments));return r&&typeof r.then=="function"?r:Z.resolve(r)}catch(n){return nt(n)}}},spawn:function(e,r,n){try{var i=$n(e.apply(n,r||[]));return i&&typeof i.then=="function"?i:Z.resolve(i)}catch(o){return nt(o)}},currentTransaction:{get:function(){return se.trans||null}},waitFor:function(e,r){return r=Z.resolve(typeof e=="function"?lr.ignoreTransaction(e):e).timeout(r||6e4),se.trans?se.trans.waitFor(r):r},Promise:Z,debug:{get:function(){return Ue},set:function(e){It(e)}},derive:L,extend:P,props:N,override:j,Events:Cr,on:Xt,liveQuery:Wi,extendObservabilitySet:sn,getByKeyPath:te,setByKeyPath:oe,delByKeyPath:function(e,r){typeof r=="string"?oe(e,r,void 0):"length"in r&&[].map.call(r,function(n){oe(e,n,void 0)})},shallowClone:ve,deepClone:_e,getObjectDiff:Xn,cmp:Pe,asap:le,minKey:-1/0,addons:[],connections:pr,errnames:et,dependencies:dn,cache:sr,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,r,n){return e+r/Math.pow(10,2*n)})})),lr.maxKey=Er(lr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Xt(Or,function(e){Zt||(e=new CustomEvent(Ln,{detail:e}),Zt=!0,dispatchEvent(e),Zt=!1)}),addEventListener(Ln,function(e){e=e.detail,Zt||ri(e)}));var br,Zt=!1,Yi=function(){};return typeof BroadcastChannel<"u"&&((Yi=function(){(br=new BroadcastChannel(Ln)).onmessage=function(e){return e.data&&ri(e.data)}})(),typeof br.unref=="function"&&br.unref(),Xt(Or,function(e){Zt||br.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Gt.disableBfCache&&e.persisted){Ue&&console.debug("Dexie: handling persisted pagehide"),br?.close();for(var r=0,n=pr;r<n.length;r++)n[r].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Gt.disableBfCache&&e.persisted&&(Ue&&console.debug("Dexie: handling persisted pageshow"),Yi(),ri({all:new mt(-1/0,[[]])}))})),Z.rejectionMapper=function(e,r){return!e||e instanceof fe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!xt[e.name]?e:(r=new xt[e.name](r||e.message,e),"stack"in e&&M(r,"stack",{get:function(){return this.inner.stack}}),r)},It(Ue),s(Gt,Object.freeze({__proto__:null,Dexie:Gt,liveQuery:Wi,Entity:Si,cmp:Pe,PropModification:kr,replacePrefix:function(e,r){return new kr({replacePrefix:[e,r]})},add:function(e){return new kr({add:e})},remove:function(e){return new kr({remove:e})},default:Gt,RangeSet:mt,mergeRanges:Dr,rangesOverlap:Ri}),{default:Gt}),Gt})})(bn)),bn.exports}var Zs=Xs();const si=rs(Zs),ha=Symbol.for("Dexie"),_n=globalThis[ha]||(globalThis[ha]=si);if(si.semVer!==_n.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${si.semVer} and ${_n.semVer}`);const{liveQuery:Yu,mergeRanges:Ju,rangesOverlap:Qu,RangeSet:$u,cmp:Xu,Entity:Zu,PropModification:ed,replacePrefix:td,add:rd,remove:nd,DexieYProvider:id}=_n,Hr="current";class el extends _n{uprnSelections;areaSelections;dataSelections;userDownloads;constructor(){super("app-db2"),this.version(2).stores({uprnSelections:"&id",areaSelections:"++id, layerId, *areaIds",dataSelections:"++id, layerId, *fields",userDownloads:"++id, &localId, createdAt"}),this.on("populate",async t=>{if(console.log("[db] Populating database with initial data"),await t.table("uprnSelections").get(Hr)){console.log("[db] Initial UPRN selection already exists");return}await t.table("uprnSelections").add({id:"current",areas:null,data:[]}),console.log("[db] Initial UPRN selection created")})}}const rr=new el,Oa=async()=>await rr.uprnSelections.get(Hr),Nr=async I=>{let t=await Oa();t||(t={id:Hr,areas:null,data:[]},await rr.uprnSelections.add(t)),console.log("[db] Updating UPRN selection with patch:",I,"current:",t),await rr.uprnSelections.update(Hr,I)},tl=async()=>{await rr.uprnSelections.put({id:Hr,areas:null,data:[]})},rl=async(I,t,a)=>await rr.userDownloads.add({localId:I,areaSelection:t,dataSelections:a,status:er.Pending,createdAt:Date.now()}),nl=async(I,t,a,s)=>{const c={};t!==void 0&&(c.externalId=t),a!==void 0&&(c.areaSelection=a),s!==void 0&&(c.dataSelections=s),Object.keys(c).length!==0&&await rr.userDownloads.where("localId").equals(I).modify(c)},il=async()=>await rr.userDownloads.orderBy("createdAt").reverse().toArray(),al=async I=>await rr.userDownloads.where("localId").equals(I).delete();class ol{#e=ne(Re(new wt));constructor(){this.#t()}addDownload(t){console.log("[downloads-store] Adding download:",t),u(this.#e).set(t.localId,t),rl(t.localId,t.areaSelection,t.dataSelections)}updateDownloadStatus(t){console.log("[downloads-store] Updating download status:",t),u(this.#e).set(t.localId,{...t}),nl(t.localId,t.externalId,t.areaSelection,t.dataSelections)}removeDownload(t){u(this.#e).delete(t),al(t)}getDownloads(){return Array.from(u(this.#e).values())}async#t(){const t=await il();!t||t.length===0||(console.log("Loaded downloads from DB:",t),t.forEach(a=>{u(this.#e).set(a.localId,{localId:a.localId,status:er.Pending,areaSelection:a.areaSelection,dataSelections:a.dataSelections})}))}}const Lr=new ol;function sl(I,t){const a=_a(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]];ka(I,Rt({name:"download"},()=>a,{get iconNode(){return s},children:(c,f)=>{var h=de(),b=X(h);Ca(b,t,"default",{}),T(c,h)},$$slots:{default:!0}}))}var ll=ae('<div class="data-item svelte-v4uih6"><span class="data-name svelte-v4uih6"> </span> <div class="data-actions svelte-v4uih6"><!></div></div>');function li(I,t){const a=Ve(t,"title",3,"");In(I,{class:"data-item-card",children:(s,c)=>{var f=ll(),h=ee(f),b=ee(h,!0);$(h);var P=ue(h,2),C=ee(P);Qe(C,()=>t.children??Ke),$(P),$(f),ct(()=>{hi(h,"title",a()),Ct(b,a())}),T(s,f)},$$slots:{default:!0}})}var cl=ae("<!> <!> <!> <!>",1),ul=ae('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),dl=ae('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),fl=ae('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function hl(I,t){De(t,!0);let a=ne(Re(new Set));const s=Ce(()=>Lr.getDownloads()),c={completed:{color:"#059669",text:"Completed",icon:Po},"in-progress":{color:"#2563eb",text:"In Progress",icon:Ao},failed:{color:"#dc2626",text:"Failed",icon:Co},pending:{color:"#6b7280",text:"Pending",icon:es}};Rr(()=>{const K=setInterval(()=>{f()},5e3);return()=>{clearInterval(K)}}),je(()=>{if(!u(s)||u(s).length<=0||!t.uprnDownloadService)return;(async()=>{for(const V of u(s)){if(V.externalId||V.status!==er.Pending)continue;const H={exports:{areaSelectionLayer:{remoteId:V.areaSelection.layerId,areas:V.areaSelection.areaFieldInfos.map(U=>U.code)},dataSelectionLayers:V.dataSelections.map(U=>({remoteId:U.layerId,fields:U.fields.filter(le=>!t.fieldsToHide||!t.fieldsToHide.has(le))}))}};console.log("[downloads-menu] Submitting download request:",H);const j=await t.uprnDownloadService.requestJob(H);if(!j||j.type===Qs.Error){console.error("[downloads-menu] Failed to submit download request.",j);continue}V.externalId=j.guid,V.status=er.InProgress,Lr.updateDownloadStatus(V)}})()});async function f(){if(u(s).length<=0||!t.uprnDownloadService)return;const K={jobs:u(s).filter(H=>H.externalId).map(H=>H.externalId)},V=await t.uprnDownloadService.requestJobStatuses(K);if(!V){console.error("[downloads-menu] Failed to get job statuses.",V);return}for(const H of V.jobs){const j=u(s).find(U=>U.externalId===H.guid);if(!j){console.warn("[downloads-menu] Received job status for unknown download:",H.guid);continue}switch(H.status.type){case mn.Submitted:case mn.Processing:j.status=er.InProgress;break;case mn.Completed:j.status=er.Completed;break;case mn.Error:j.status=er.Failed;break;default:console.warn("[downloads-menu] Unknown job status type:",H.status.type);break}Lr.updateDownloadStatus(j)}}function h(K){Lr.removeDownload(K)}async function b(K){try{await navigator.clipboard.writeText(K),B(a,new Set(u(a)).add(K),!0),Mr.success("URL copied to clipboard"),setTimeout(()=>{const V=new Set(u(a));V.delete(K),B(a,V,!0)},2e3)}catch(V){console.error("Failed to copy URL:",V),Mr.error("Failed to copy URL to clipboard")}}function P(K){return c[K]?.color??c.pending.color}function C(K){return c[K]?.text??c.pending.text}function O(K){return c[K]?.icon??c.pending.icon}function D(K){return t.uprnDownloadService.getDownloadUrl(K)}var N=fl(),W=ue(ee(N),2);{var M=K=>{var V=ul(),H=X(V);qt(H,21,()=>u(s),_r,(le,te)=>{{let oe=Ce(()=>u(te).externalId?u(te).externalId:"Pending...");li(le,{get title(){return u(oe)},children:(ve,Ie)=>{var ce=cl(),ye=X(ce);{let ke=Ce(()=>P(u(te).status)),Le=Ce(()=>C(u(te).status));Nt(ye,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${u(ke)??""}`},get title(){return u(Le)},disabled:!0,children:(ge,Ee)=>{const at=Ce(()=>O(u(te).status));var ot=de(),fe=X(ot);{let Me=Ce(()=>u(te).status==="in-progress"?"spinning":"");Oe(fe,()=>u(at),(Xe,Ae)=>{Ae(Xe,{size:14,get class(){return u(Me)}})})}T(ge,ot)},$$slots:{default:!0}})}var Se=ue(ye,2);{var _e=ke=>{Nt(ke,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>b(D(u(te).externalId)),title:"Copy URL to clipboard",children:(Le,ge)=>{var Ee=de(),at=X(Ee);{var ot=Me=>{Io(Me,{size:14})},fe=Me=>{ko(Me,{size:14})};he(at,Me=>{u(a).has(D(u(te).externalId))?Me(ot):Me(fe,!1)})}T(Le,Ee)},$$slots:{default:!0}})};he(Se,ke=>{u(te).externalId&&ke(_e)})}var Fe=ue(Se,2);{var Be=ke=>{Nt(ke,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(D(u(te).externalId),"_blank"),title:"Open download",children:(Le,ge)=>{sl(Le,{})},$$slots:{default:!0}})};he(Fe,ke=>{u(te).externalId&&u(te).status==="completed"&&ke(Be)})}var $e=ue(Fe,2);Nt($e,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>h(u(te).localId),title:"Remove from queue",children:(ke,Le)=>{ur();var ge=wr("Ã");T(ke,ge)},$$slots:{default:!0}}),T(ve,ce)},$$slots:{default:!0}})}}),$(H);var j=ue(H,2),U=ee(j);$(j),ct(()=>Ct(U,`${u(s).length??""} download(s) in queue`)),T(K,V)},L=K=>{var V=dl();T(K,V)};he(W,K=>{u(s).length>0?K(M):K(L,!1)})}$(N),T(I,N),Ne()}function vl(I,t){const a=_a(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];ka(I,Rt({name:"trash"},()=>a,{get iconNode(){return s},children:(c,f)=>{var h=de(),b=X(h);Ca(b,t,"default",{}),T(c,h)},$$slots:{default:!0}}))}function pl(I,t){De(t,!0);{let a=Ce(()=>Kr("size-7 border-1 border-destructive",t.class));Nt(I,{onclick:()=>t.clear(),variant:"ghost",get class(){return u(a)},title:"Clear all selections",children:(s,c)=>{vl(s,{class:"text-destructive"})},$$slots:{default:!0}})}Ne()}class gl{#e=ne(Re(new wt));get dataSelections(){return u(this.#e)}set dataSelections(t){B(this.#e,t,!0)}addSelection(t){this.dataSelections.set(t.layerId,t)}updateSelection(t,a){const s=this.dataSelections.get(t);if(!s){console.warn(`[data-selection-store] no existing selection for layerId ${t}`);return}s.selectedFieldIds=new Ft(a),this.dataSelections.set(t,{...s})}addOrUpdateSelection(t,a){const s=this.dataSelections.get(t);if(s)s.selectedFieldIds=new Ft(a),this.dataSelections.set(t,{...s});else{const c={layerId:t,selectedFieldIds:new Ft(a)};this.dataSelections.set(t,c)}}removeSelection(t){this.dataSelections.delete(t)}getSelection(t){return this.dataSelections.get(t)}getAllSelections(){return Array.from(this.dataSelections.values())}clearSelections(){this.dataSelections.clear(),console.log("[data-selection-store] selections cleared.")}cleanup(){this.dataSelections.clear()}}var ml=ae('<div class="export-footer svelte-10dgoyk"><div class="export-footer__left svelte-10dgoyk"><p class="text-sm text-muted-foreground svelte-10dgoyk">Click "Export" to begin the download.</p></div> <div class="export-footer__right svelte-10dgoyk"><!> <!></div></div>');function yl(I,t){De(t,!0);function a(){if(t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size<=0){Mr.error("Please select at least one area to export.");return}if(t.dataSelectionStore.getAllSelections().length<=0){Mr.error("Please select at least one data layer to export.");return}console.log("Starting export..."),(async()=>{const P=await t.areaSelectionInteractionStore.getAreaCodesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),C=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().map(([W,M],L)=>({id:W,code:P[L]})).toArray(),O={layerId:t.areaSelectionInteractionStore.selectionViewState.layerView?.layer.id||"",areaFieldInfos:C},D=t.dataSelectionStore.getAllSelections().map(W=>({layerId:W.layerId,fields:Array.from(W.selectedFieldIds)})),N=crypto.randomUUID();Lr.addDownload({localId:N,status:er.Pending,areaSelection:O,dataSelections:D}),t.onExportSuccess?.()})()}var s=ml(),c=ue(ee(s),2),f=ee(c);pl(f,{class:"mr-4",get clear(){return t.clearSelections}});var h=ue(f,2);Nt(h,{onclick:a,title:"Export",children:(b,P)=>{ur();var C=wr("Export");T(b,C)},$$slots:{default:!0}}),$(c),$(s),T(I,s),Ne()}class bl{#e=ne(null);get ActiveLayer(){return u(this.#e)}set ActiveLayer(t){B(this.#e,t,!0)}}class wl{#e=ne(!1);get isLoaded(){return u(this.#e)}set isLoaded(t){B(this.#e,t,!0)}#t=ne(null);get data(){return u(this.#t)}set data(t){B(this.#t,t,!0)}#r=Ce(()=>{const t=new wt;function a(s){t.set(s.id,s),s.type==="group"&&s.layers.forEach(f=>{a(f)})}return this.data&&this.data.layers.forEach(s=>{a(s)}),t});get dataLookup(){return u(this.#r)}set dataLookup(t){B(this.#r,t)}#n=ne(!1);get loading(){return u(this.#n)}set loading(t){B(this.#n,t,!0)}#i=ne(null);get error(){return u(this.#i)}set error(t){B(this.#i,t,!0)}async initializeAsync(t){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:a,itemId:s,proxy:c}=t;await this.configurePortalAsync(a,c),await this.loadwebmapAsync(s)}catch(a){console.error("Error initializing webmap:",a),this.error=a.message}finally{this.loading=!1}}}async configurePortalAsync(t,a){if(!t||(Zi.portalUrl=t,console.log(Zi),!a))return;const{addProxyRule:s}=os;console.log("Adding proxy rule for portal traffic"),s({urlPrefix:a?.urlPrefix,proxyUrl:a?.proxyUrl})}async loadwebmapAsync(t){if(this.data)return;const a=new as({id:t}),s=new is({portalItem:a});this.data=s,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}function _l(I,t){I.stopPropagation(),t.onFilterClicked?.(t.layerId)}var Sl=ae('<button title="Filter"><!></button>');function xl(I,t){De(t,!0);let a=ne(Re(t.hasFiltersApplied?.(t.layerId)??!1));je(()=>{B(a,t.hasFiltersApplied?.(t.layerId)??!1,!0)});const s=Ce(()=>u(a)?Oo:Eo);var c=Sl();let f;c.__click=[_l,t];var h=ee(c);jr(h,()=>u(s)),$(c),ct(b=>{f=vi(c,1,"filter-btn svelte-k95pvd",null,f,b),hi(c,"aria-pressed",u(a))},[()=>({active:u(a)})]),T(I,c),Ne()}Cn(["click"]);var Il=ae('<ul class="selected-list"></ul> <p class="count svelte-81yb5c"> </p>',1),kl=ae('<p class="no-selection svelte-81yb5c">No areas selected</p>'),Cl=ae("<!> <!>",1),Al=ae('<ul></ul> <p class="count svelte-81yb5c"> </p>',1),Pl=ae('<p class="no-selection svelte-81yb5c">No data selected</p>'),Ol=ae('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function El(I,t){De(t,!0);const a=Ve(t,"fieldFilterMenuStore",7);let s=ne(Re([]));je(()=>{if(!t.areaSelectionInteractionStore){B(s,[],!0);return}if(!t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size){B(s,[],!0);return}(async()=>{const U=await t.areaSelectionInteractionStore.getAreaNamesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),le=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().toArray().map(([oe,ve])=>({id:oe,handle:ve})),te=[];for(let oe=0;oe<U.length;oe++)te.push({name:U[oe]||"Unknown Area",HighlightAreaInfo:le[oe]});B(s,te,!0)})()});function c(j){const U=u(s).findIndex(le=>le.name===j);U!==-1&&t.areaSelectionInteractionStore.removeSelectedArea(u(s)[U]?.HighlightAreaInfo.id)}function f(j){console.log("[export-menu] Removing data selection for layerId:",j),t.dataSelectionStore.removeSelection(j),console.log("[export-menu] Current SelectedData:",ai(t.dataSelectionStore.getAllSelections()))}function h(j){if(a().ActiveLayer?.id===j){a().ActiveLayer=null;return}const U=t.webMapStore.dataLookup.get(j);if(!U){console.warn(`[export-menu] Layer with ID ${j} not found in web map store.`);return}a().ActiveLayer=U}function b(j){const U=t.dataSelectionStore.getSelection(j);return!(!U||!U.selectedFieldIds||U.selectedFieldIds.size===0||U.selectedFieldIds.size===t.webMapStore.dataLookup.get(j)?.fields?.length)}var P=Ol(),C=ue(X(P),2),O=ee(C),D=ee(O,!0);$(O);var N=ue(O,4);{var W=j=>{var U=Il(),le=X(U);qt(le,21,()=>u(s),_r,(ve,Ie)=>{li(ve,{get title(){return u(Ie).name},children:(ce,ye)=>{Nt(ce,{variant:"ghost",size:"sm",class:"area-remove-btn",title:"Remove area",onclick:()=>c(u(Ie).name),children:(Se,_e)=>{ur();var Fe=wr("Ã");T(Se,Fe)},$$slots:{default:!0}})},$$slots:{default:!0}})}),$(le);var te=ue(le,2),oe=ee(te);$(te),ct(()=>Ct(oe,`${u(s).length??""} area(s) selected`)),T(j,U)},M=j=>{var U=kl();T(j,U)};he(N,j=>{u(s).length>0?j(W):j(M,!1)})}$(C);var L=ue(C,2),K=ue(ee(L),2);{var V=j=>{var U=Al(),le=X(U);qt(le,21,()=>t.dataSelectionStore.getAllSelections(),_r,(ve,Ie)=>{{let ce=Ce(()=>t.webMapStore.dataLookup.get(u(Ie).layerId)?.title??"");li(ve,{get title(){return u(ce)},children:(ye,Se)=>{var _e=Cl(),Fe=X(_e);{var Be=ke=>{xl(ke,{get layerId(){return u(Ie).layerId},onFilterClicked:h,hasFiltersApplied:b})};he(Fe,ke=>{t.dataSelectionTreeviewConfig?.getItemConfig(u(Ie).layerId)?.showFields&&ke(Be)})}var $e=ue(Fe,2);Nt($e,{variant:"ghost",size:"sm",class:"data-remove-btn",title:"Remove data selection",onclick:()=>f(u(Ie).layerId),children:(ke,Le)=>{ur();var ge=wr("Ã");T(ke,ge)},$$slots:{default:!0}}),T(ye,_e)},$$slots:{default:!0}})}}),$(le);var te=ue(le,2),oe=ee(te);$(te),ct(ve=>Ct(oe,`${ve??""} data layer(s) selected`),[()=>t.dataSelectionStore.getAllSelections().length]),T(j,U)},H=j=>{var U=Pl();T(j,U)};he(K,j=>{t.dataSelectionStore.getAllSelections().length>0?j(V):j(H,!1)})}$(L),ct(()=>Ct(D,t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer?t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer.title:"No Area Layer Selected")),T(I,P),Ne()}function Fl(I,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];xr(I,Rt({name:"arrow-down-to-line"},()=>a,{get iconNode(){return s},children:(c,f)=>{var h=de(),b=X(h);Qe(b,()=>t.children??Ke),T(c,h)},$$slots:{default:!0}})),Ne()}function Tl(I,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"m18 15-6-6-6 6"}]];xr(I,Rt({name:"chevron-up"},()=>a,{get iconNode(){return s},children:(c,f)=>{var h=de(),b=X(h);Qe(b,()=>t.children??Ke),T(c,h)},$$slots:{default:!0}})),Ne()}function Dl(I,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]];xr(I,Rt({name:"maximize"},()=>a,{get iconNode(){return s},children:(c,f)=>{var h=de(),b=X(h);Qe(b,()=>t.children??Ke),T(c,h)},$$slots:{default:!0}})),Ne()}function Nl(I,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]];xr(I,Rt({name:"minimize"},()=>a,{get iconNode(){return s},children:(c,f)=>{var h=de(),b=X(h);Qe(b,()=>t.children??Ke),T(c,h)},$$slots:{default:!0}})),Ne()}function Vl(I,t){I.target===I.currentTarget&&t()}var Ll=(I,t)=>I.key==="Escape"&&t(),Rl=(I,t,a)=>t(u(a).name),Ml=ae('<div class="info-icon-container svelte-fp5rsc"><!></div>'),jl=ae('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),Hl=ae('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),Kl=ae("<!> <!>",1),ql=ae("<!> <!>",1),Bl=ae('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),zl=ae('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Ul(I,t){De(t,!0);const a=Ve(t,"fieldFilterMenuStore",7);let s=ne(null),c=ne(Re(new Ft)),f=Ce(()=>{if(!u(s)||!u(s).fields)return{checked:!1,indeterminate:!1};const M=u(s).fields.length,L=u(c)?.size||0;return L===0?{checked:!1,indeterminate:!1}:L===M?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});je(()=>{const M=a().ActiveLayer;if(!M){B(s,null),B(c,new Ft,!0);return}B(s,M,!0);const L=t.dataSelectionStore.getSelection(M.id);L?.selectedFieldIds?B(c,new Ft([...L.selectedFieldIds]),!0):B(c,new Ft,!0)});function h(){b(),a().ActiveLayer=null}function b(){if(!u(s))return;let M=t.dataSelectionStore.getSelection(u(s).id);if(M){if((M.selectedFieldIds===void 0||M.selectedFieldIds===null)&&(M.selectedFieldIds=new Ft),u(c).size===0){t.dataSelectionStore.removeSelection(u(s).id);return}M.selectedFieldIds.clear(),u(c).forEach(L=>{M.selectedFieldIds?.add(L)})}}function P(M){u(s)&&(u(c).has(M)?u(c).delete(M):u(c).add(M))}function C(){if(!u(s)?.fields)return;(u(c)?.size||0)===0?u(s).fields.forEach(L=>{u(c).add(L.name)}):u(c).clear()}function O(){if(!u(s)?.fields)return[];const M=u(s).fields.filter(L=>!t.fieldsToHide.has(L.name.toLowerCase()));return console.log("Filtered fields to show:",M,t.fieldsToHide,u(s).fields),M}var D=de(),N=X(D);{var W=M=>{var L=zl();L.__click=[Vl,h],L.__keydown=[Ll,h];var K=ee(L);Oe(K,()=>In,(V,H)=>{H(V,{class:"command-card",children:(j,U)=>{var le=Bl(),te=X(le);te.__click=h;var oe=ee(te);ss(oe,{size:20}),$(te);var ve=ue(te,2);Oe(ve,()=>kn,(Ie,ce)=>{ce(Ie,{class:"card-content",children:(ye,Se)=>{var _e=de(),Fe=X(_e);Oe(Fe,()=>Qo,(Be,$e)=>{$e(Be,{children:(ke,Le)=>{var ge=ql(),Ee=X(ge);Oe(Ee,()=>ls,(ot,fe)=>{fe(ot,{placeholder:"Search for fields..."})});var at=ue(Ee,2);Oe(at,()=>$o,(ot,fe)=>{fe(ot,{children:(Me,Xe)=>{var Ae=Kl(),et=X(Ae);Oe(et,()=>Xo,(re,xt)=>{xt(re,{children:(tt,pe)=>{ur();var qe=wr("No results found.");T(tt,qe)},$$slots:{default:!0}})});var At=ue(et,2);Oe(At,()=>cs,(re,xt)=>{xt(re,{heading:"Fields",children:(tt,pe)=>{var qe=Hl(),gt=X(qe),ze=ee(gt);Ji(ze,{get checked(){return u(f).checked},get indeterminate(){return u(f).indeterminate},onCheckedChange:C}),ur(2),$(gt);var ut=ue(gt,2);Oe(ut,()=>Fo,(rt,st)=>{st(rt,{})});var pt=ue(ut,2);qt(pt,17,O,_r,(rt,st)=>{var lt=de(),Ue=X(lt);Oe(Ue,()=>Zo,(It,Vt)=>{Vt(It,{class:"field-item",onselect:()=>P(u(st).name),children:(kt,Mt)=>{var Ye=jl(),dt=ee(Ye);{let zt=Ce(()=>u(c)?.has(u(st).name)??!1);Ji(dt,{class:"field-checkbox",get checked(){return u(zt)},onCheckedChange:()=>P(u(st).name)})}var _t=ue(dt,2);_t.__click=[Rl,P,st];var Ze=ee(_t),ft=ee(Ze),jt=ee(ft,!0);$(ft);var Bt=ue(ft,2);{var dr=zt=>{var Pt=Ml(),se=ee(Pt);jr(se,()=>To),$(Pt),ct(()=>hi(Pt,"title",u(st).description)),T(zt,Pt)};he(Bt,zt=>{u(st).description&&zt(dr)})}$(Ze),$(_t),$(Ye),ct(()=>Ct(jt,u(st).alias||u(st).name)),T(kt,Ye)},$$slots:{default:!0}})}),T(rt,lt)}),T(tt,qe)},$$slots:{default:!0}})}),T(Me,Ae)},$$slots:{default:!0}})}),T(ke,ge)},$$slots:{default:!0}})}),T(ye,_e)},$$slots:{default:!0}})}),T(j,le)},$$slots:{default:!0}})}),$(L),T(M,L)};he(N,M=>{u(s)&&M(W)})}T(I,D),Ne()}Cn(["click","keydown"]);class Ea{id;name;children;parent;constructor(t,a,s=[],c=null){this.id=t,this.name=a,this.children=s,this.parent=c}}class Je extends Ea{layer;constructor(t,a,s,c=[],f=null){super(t,a,c,f),this.layer=s}}class Sr extends Je{featureLayer;field;constructor(t,a,s,c,f=[],h=null){super(t,a,s,f,h),this.field=c,this.featureLayer=s}}var We=(I=>(I.Inactive="inactive",I.Indeterminate="indeterminate",I.Active="active",I))(We||{}),tr=(I=>(I.Hidden="hidden",I.Suspended="suspended",I.Visible="visible",I))(tr||{});class Fa{#e=ne(!1);get initialized(){return u(this.#e)}set initialized(t){B(this.#e,t,!0)}#t=null;#r=null;#n=ne(Re([]));#i=Ce(()=>{const t=new wt;return this.#S(u(this.#n),t),t});#a=ne(Re(new wt));#s=ne(Re(new wt));#l=ne(Re(new wt));#c=ne(Re(new wt));#f=ne(Re(new wt));#h=null;initialize(t,a,s,c,f){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!a)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=a,c)for(const h of c)u(this.#f).set(h.id,h);if(f&&(this.#h=f),!t)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#r=s,this.#m(t),B(this.#n,this.#y(t),!0)}getNodeById(t){return this.#u(),u(this.#i).get(t)}getNodes(){return this.#u(),u(this.#n)}getVisibleNodes(){this.#u();const t=[];for(const[a,s]of u(this.#a)){if(!s)continue;const c=u(this.#i).get(a);c&&t.push(c)}return t}getNonHiddenNodes(){return this.#u(),this.#o(u(this.#n))}clearSelections(){this.#u();for(const t of u(this.#a).keys()){u(this.#a).set(t,!1);const a=u(this.#i).get(t);a&&a instanceof Je&&(a.layer.visible=!1)}u(this.#c).clear()}#o(t){this.#u();const a=[];for(const s of t){const c=this.#v(s.id);if(!(c&&c.isHidden)&&(a.push(s),s.children?.length)){const f=this.#o(s.children);a.push(...f)}}return a}getVisibilityState(t){return this.#u(),u(this.#a).get(t)??!1}setVisibilityState(t,a){this.#u();const s=u(this.#i).get(t);if(!s)throw new Error(`Tree node not found for ID: ${t}`);if(!(s instanceof Je))throw new Error(`Tree node is not a layer node: ${t}`);const c=this.#v(t);if(c?.disableVisibilityToggle||(u(this.#a).set(t,a),s.layer.visible=a,this.updateDrawState(s,a),s instanceof Sr&&(s.featureLayer.displayField=a?s.field.name:"",a&&this.#h&&(console.log("[TreeviewStore] Applying custom renderer for field:",s.field.name),this.#h.applyCustomRenderer(s.featureLayer,s.field.name))),this.#d(s,a),!c||c.isHidden)||(c.visibilityDependencyIds?.length&&this.#p(s,a),!c.visibilityGroupId))return;const f=c.visibilityGroupId;let h=u(this.#c).get(f);h||(h=[],u(this.#c).set(f,h));const b=this.#g(f);if(!b)throw new Error(`Visibility group config not found for group ID: ${f}`);if(!a){const C=h.indexOf(t);h.splice(C,1);return}const P=C=>{u(this.#a).set(C,!1);const O=u(this.#i).get(C);if(O&&O instanceof Je){O.layer.visible=!1,this.updateDrawState(O,!1),this.#d(O,!1);const N=this.#v(C);N&&N.visibilityDependencyIds?.length&&this.#p(O,!1)}const D=h.indexOf(C);D>=0&&h.splice(D,1)};for(;h.length>=b.maxVisibleLayers;){const C=h[0];P(C)}h.push(t),this.#d(s,a),c.visibilityDependencyIds?.length&&this.#p(s,a)}async updateDrawState(t,a){if(!this.#r)return;if(!a){u(this.#s).delete(t.id),u(this.#l).get(t.id)?.remove(),u(this.#l).delete(t.id);return}if(!(t instanceof Je)||!(t.layer instanceof ea))return;const s=await this.#r.getLayerView(t.layer);if(!s)return;this.setInitialDrawState(t,s);const c=fs(()=>s.suspended,(f,h)=>{h&&!f?u(this.#s).set(t.id,tr.Visible):!h&&f&&u(this.#s).set(t.id,tr.Suspended)});u(this.#l).set(t.id,c)}getNodeDrawState(t){return this.#u(),u(this.#s).get(t)??tr.Hidden}setInitialDrawState(t,a){!(t instanceof Je)||!(t.layer instanceof ea)||a&&(a.suspended?u(this.#s).set(t.id,tr.Suspended):u(this.#s).set(t.id,tr.Visible))}clearDrawStateHandles(){for(const t of u(this.#l).values())t.remove();u(this.#l).clear()}cleanup(){this.initialized=!1,u(this.#a).clear(),u(this.#c).clear(),u(this.#f).clear(),B(this.#n,[],!0),u(this.#i).clear(),u(this.#s).clear(),this.clearDrawStateHandles()}#d(t,a){const s=t.parent;if(s){if(!(s instanceof Je)){this.#d(s,a);return}u(this.#a).set(s.id,a),s.layer.visible=a,this.#d(s,a)}}#p(t,a){const s=this.#v(t.id);if(s&&s.visibilityDependencyIds?.length)for(const c of s.visibilityDependencyIds){const f=u(this.#i).get(c);f&&f instanceof Je&&(u(this.#a).set(c,a),f.layer.visible=a,this.#d(f,a))}}#g(t){if(t&&this.#t)return this.#t.getVisibilityGroupConfig(t)}#m(t){this.#t&&this.#t.resolveInheritance(t)}#y(t){const a=t.map(s=>this.#w(s,void 0));return this.#b([...a])}#v(t){if(t&&this.#t)return this.#t.getItemConfig(t)}#b(t){t.reverse();for(const a of t)a.children?.length&&this.#b(a.children);return t}#w(t,a){const s=this.#v(t.id);if(s&&s.customConverterId){if(!u(this.#f).has(s.customConverterId))throw new Error(`Custom converter not found: ${s.customConverterId}`);const f=u(this.#f).get(s.customConverterId);if(!f)throw new Error(`Custom converter not found: ${s.customConverterId}`);return f.layerToNode(t,a??null)}const c=new Je(t.id,t.title,t,[],a);if(t.visible=s?.disableVisibilityToggle?t.visible:s?.isHidden?!1:s?.isVisibleOnInit??!1,u(this.#a).set(t.id,t.visible),this.updateDrawState(c,t.visible),this.#A(t)&&s?.showFields){const f=t;f.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const h of f.fields??[]){const b=this.#x(h,c);c.children.push(b)}}if(this.#C(t)){const f=t;return c.children=f.layers.toArray().map(h=>this.#w(h,c)),c}if(this.#I(t)){const f=t;if(f.sublayers&&f.sublayers.length>0){const h=f.sublayers;c.children=h.toArray().map(this.#_)}}return c}#x(t,a){const s=this.#k(a.id,t.name),c=new Sr(s,t.alias||t.name,a.layer,t,[],a),f=this.#v(s);return u(this.#a).set(s,f?.isVisibleOnInit??!1),c}#I(t){return t.type==="map-image"||t.type==="wms"}#_(t){const a=new Je(t.uid,t.title,t);return t.sublayers?.length&&(a.children=t.sublayers.toArray().map(this.#_)),a}#S(t,a){for(const s of t)a.set(s.id,s),s.children?.length&&this.#S(s.children,a)}#k(t,a){return`${t}-${a}`}#C(t){return t.type==="group"}#A(t){return t.type==="feature"}#u(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}const Gl='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Wl='<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Yl='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',Ta=(I,t,a,s)=>t?Jl(I,a):a?s?Gl:Wl:Yl,Jl=(I,t)=>{switch(I.type){case"group":return Qi;case"feature":return $i;case"tile":return Do;default:return t?Qi:$i}};function Ql(I){const t=I-1;return t*t*t+1}var $l=ae('<div class="relative ml-4 w-full"><div class="tree-guide-line svelte-1y72o5r"></div> <div class="tree-children svelte-1y72o5r"></div></div>'),Xl=ae('<div class="w-full"><!> <!></div>');function Da(I,t){const a=Ve(t,"isOpen",3,!1),s=Ve(t,"childNodes",3,null),c=Ve(t,"duration",3,300);var f=Xl(),h=ee(f);Qe(h,()=>t.content??Ke);var b=ue(h,2);{var P=C=>{var O=$l(),D=ue(ee(O),2);qt(D,21,()=>s()??[],N=>N.id,(N,W)=>{var M=de(),L=X(M);Qe(L,()=>t.childNode??Ke,()=>u(W)),T(N,M)}),$(D),$(O),wn(1,D,()=>ua,()=>({duration:c(),easing:Ql})),wn(2,D,()=>ua,()=>({duration:c()})),T(C,O)};he(b,C=>{a()&&s()&&C(P)})}$(f),T(I,f)}const ci="mb-1 cursor-pointer rounded-md border border-border p-2 text-left",ui="transition-all duration-150 hover:border-border/50 hover:bg-gray-100 hover:shadow-sm",Zl="transition-colors hover:bg-blue-500",di="text-sm font-normal",fi="bg-card",Na="bg-accent text-accent-foreground",ec="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";function tc(I={}){const{enhancedHover:t=!1,includeFont:a=!1,pressed:s=!1}=I;let c=ci;return t?c+=" "+ui:c+=" "+Zl,a&&(c+=" "+di),s?c+=" "+Na:c+=" "+fi,c}var rc=ae('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),nc=ae('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function va(I,t){const a=`calc(100% - ${t.depth*1}rem)`,s=`${ci} ${ui} ${ec} ${fi} ${di}`,c=`${ci} ${ui} ${di}`;var f=de(),h=X(f);{var b=C=>{No(C,{get pressed(){return t.pressed},get class(){return s},variant:"outline",get style(){return`width: ${a};`},get onPressedChange(){return t.onclick},children:(O,D)=>{var N=rc(),W=ee(N),M=ee(W),L=ee(M);jr(L,()=>t.icon),$(M);var K=ue(M,2),V=ee(K,!0);$(K),$(W);var H=ue(W,2);Qe(H,()=>t.children??Ke),$(N),ct(()=>Ct(V,t.name)),T(O,N)},$$slots:{default:!0}})},P=C=>{var O=nc();O.__click=function(...j){t.onclick?.apply(this,j)};var D=ee(O),N=ee(D),W=ee(N);Sa(W,{get isOpen(){return t.isOpen}});var M=ue(W,2),L=ee(M);jr(L,()=>t.icon),$(M);var K=ue(M,2),V=ee(K,!0);$(K),$(N);var H=ue(N,2);Qe(H,()=>t.children??Ke),$(D),$(O),ct(()=>{vi(O,1,`${c} ${t.pressed?Na:fi}`),xn(O,`width: ${a};`),Ct(V,t.name)}),T(C,O)};he(h,C=>{t.isTogglable?C(b):C(P,!1)})}T(I,f)}Cn(["click"]);function Va(I,t){De(t,!0);const a=L=>{var K=de(),V=X(K);{var H=j=>{var U=de(),le=X(U);{var te=ve=>{va(ve,{isTogglable:!1,get pressed(){return u(C)},get icon(){return u(O)},get name(){return t.node.name},get depth(){return c()},onclick:M,get isOpen(){return u(P)}})},oe=ve=>{va(ve,{isTogglable:!0,get pressed(){return u(C)},get icon(){return u(O)},get name(){return t.node.name},get depth(){return c()},onclick:W,get isOpen(){return u(P)}})};he(le,ve=>{h?ve(te):ve(oe,!1)})}T(j,U)};he(V,j=>{t.treeviewConfigStore.getItemConfig(t.node.id)?.isHidden||j(H)})}T(L,K)},s=(L,K=Ke)=>{var V=de(),H=X(V);{var j=U=>{{let le=Ce(()=>c()+1);Va(U,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return K()},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get getNodeVisibility(){return t.getNodeVisibility},get depth(){return u(le)},get useLayerTypeIcon(){return f()}})}};he(H,U=>{h&&u(P)&&!t.treeviewConfigStore.getItemConfig(K().id)?.isHidden&&U(j)})}T(L,V)},c=Ve(t,"depth",3,0),f=Ve(t,"useLayerTypeIcon",3,!1),h=!!(t.node.children&&t.node.children.length),b=!h;let P=ne(!1),C=ne(!1),O=ne("");function D(){return!t.node.children||!t.getNodeVisibility?!1:t.node.children.some(L=>{const K=t.getNodeVisibility(L.id);return K!==void 0?K:L instanceof Je?L.layer.visible:!1})}je(()=>{if(!(!t.node||!(t.node instanceof Je))){if(h)B(C,D(),!0);else{const L=t.getNodeVisibility?t.getNodeVisibility(t.node.id):void 0;B(C,L!==void 0?L:t.node.layer.visible,!0)}B(O,Ta(t.node.layer,f(),h,u(P)),!0)}});function N(){!b||!t.onNodeVisibilityChange||h||(B(C,!u(C)),t.onNodeVisibilityChange(t.node,u(C)))}function W(){h||N(),t.onNodeClick?.(t.node)}function M(){B(P,!u(P)),t.onNodeClick?.(t.node)}{let L=Ce(()=>h?t.node.children:null);Da(I,{get isOpen(){return u(P)},get content(){return a},get childNodes(){return u(L)},get childNode(){return s}})}Ne()}function ic(I,t){De(t,!0);const a=new Fa;function s(){a.clearSelections()}je(()=>{!t.webMap||a.initialized||a.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,null)}),je(()=>{a.initialized&&!a.getVisibleNodes().length&&t.areaSelectionStore.layerId&&a.setVisibilityState(t.areaSelectionStore.layerId,!0)}),je(()=>{if(!a.initialized||!a.getVisibleNodes().length)return;const P=a.getVisibleNodes().find(C=>C instanceof Je&&C.layer instanceof ta);if(!P||!(P instanceof Je)){console.warn("Visible node is not a FeatureLayer");return}if(!P.layer||!(P.layer instanceof ta)){console.warn("Visible node layer is not a FeatureLayer",P.layer.type);return}t.areaSelectionStore.setLayerId(P.id)});var c={clearSelections:s},f=de(),h=X(f);{var b=P=>{var C=de(),O=X(C);Oe(O,()=>xa,(D,N)=>{N(D,{children:(W,M)=>{var L=de(),K=X(L);qt(K,17,()=>a.getNodes(),V=>V.id,(V,H)=>{Va(V,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return u(H)},onNodeClick:()=>{},onNodeVisibilityChange:(j,U)=>a.setVisibilityState(j.id,U),getNodeVisibility:j=>a.getVisibilityState(j),depth:0,useLayerTypeIcon:!0})}),T(W,L)},$$slots:{default:!0}})}),T(P,C)};he(h,P=>{a.initialized&&P(b)})}return T(I,f),Ne(c)}class ac{configStore;constructor(t){this.configStore=t}}class oc extends ac{id="aliasPath";layerToNode(t,a){const s=new Je(t.id,t.title,t,[],a),c=this.configStore.getItemConfig(t.id);if(this.#r(t)&&c?.showFields){const f=t;f.loaded||console.warn(`Layer not loaded: ${t.id}`);const h=new Map;for(const b of f.fields??[]){const P=this.configStore.getItemConfig(this.#t(t.id,b.name));!P||P.isHidden||this.#e(b,s,h)}s.children.sort((b,P)=>b.children.length>0&&P.children.length===0?1:b.children.length===0&&P.children.length>0?-1:0)}return s}#e(t,a,s=new Map){const c=this.#t(a.id,t.name),h=hs(t.alias||"")?.split("|").map(N=>N.trim()).filter(Boolean)??[];if(h.length===0){const N=new Sr(c,t.alias||t.name,a.layer,t,[],a);return a.children.push(N),N}const b=h.slice(0,-1),P=h[h.length-1];let C=a;const O=(N,W)=>{N.children??=[],N.children.includes(W)||N.children.push(W)};for(let N=0;N<b.length;N++){const W=b[N],M=h.slice(0,N+1).join("::"),L=`${a.id}::${M}`;let K=s.get(L);K||(K=new Ea(L,W,[],C),s.set(L,K),O(C,K)),C=K}const D=new Sr(c,P||t.name,a.layer,t,[],C);return O(C,D),D}#t(t,a){return`${t}-${a}`}#r(t){return t.type==="feature"}}class pa{#e=[];#t=new Map;#r=[];#n=new Map;#i=[];#a=new Map;#s=new Set;constructor(t){if(!t)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=t.items??[],this.#t=new Map(this.#e.map(a=>[a.id,a])),this.#r=t.visibilityGroups??[],this.#n=new Map(this.#r.map(a=>[a.id,a])),this.#i=t.inheritanceGroups??[],this.#a=new Map(this.#i.map(a=>[a.id,a])),t.fieldsToHide&&(this.#s=new Set(t.fieldsToHide.map(a=>a.trim().toLowerCase())))}getItemConfig(t){return this.#t.get(t)}getVisibilityGroupConfig(t){return this.#n.get(t)}getInheritanceGroupConfig(t){return this.#a.get(t)}resolveInheritance(t){if(!(t.length===0||!this.#e||this.#e.length===0))for(const a of t){const s=this.getItemConfig(a.id);this.#l(a,s)}}#l(t,a){const s=this.#c(t,a);if(this.#y(t)&&s.showFields){const c=t;c.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const f of c.fields??[])this.#f(this.#g(t.id,f.name),f.alias||f.name,s)}if(this.#m(t)){const c=t;for(const f of c.layers.toArray())this.#l(f,s)}}#c(t,a){const s=this.#h(t.id,a);return s.type===hn.None&&(s.type=Vo(t)),s}#f(t,a,s){const c=this.#h(t,s);return c.type===hn.None&&(c.type=hn.Field),this.#s.has(a.trim().toLowerCase())&&(c.isHidden=!0),c}#h(t,a){let s=this.getItemConfig(t);const c=s?.inheritanceGroupId?this.getInheritanceGroupConfig(s.inheritanceGroupId):this.getInheritanceGroupConfig(a?.inheritanceGroupId??"");return s={id:t,type:hn.None,isDownloadable:this.#o(c,"isDownloadable",s,a,!0),isVisibleOnInit:this.#o(c,"isVisibleOnInit",s,a,!1),isHidden:this.#o(c,"isHidden",s,a,!1),disableVisibilityToggle:this.#o(c,"disableVisibilityToggle",s,a,!1),isOpenOnInit:this.#o(c,"isOpenOnInit",s,a,!1),showFields:this.#o(c,"showFields",s,a,!1),visibilityDependencyIds:this.#o(c,"visibilityDependencyIds",s,a,[]),visibilityGroupId:this.#o(c,"visibilityGroupId",s,a,void 0),customConverterId:this.#o(c,"customConverterId",s,a,void 0),inheritanceGroupId:this.#o(c,"inheritanceGroupId",s,a,void 0)},this.#p(s),this.#d(s),s}#o(t,a,s,c,f){const h=s?.[a];return h!==void 0?h:t?.inheritedProperties.includes(a)&&c?c[a]??f:f}#d(t){if(this.#t.has(t.id))throw new Error(`Item with id ${t.id} already exists.`);this.#e.push(t),this.#t.set(t.id,t)}#p(t){this.#t.has(t.id)&&(this.#e=this.#e.filter(a=>a.id!==t.id),this.#t.delete(t.id))}#g(t,a){return`${t}-${a}`}#m(t){return t.type==="group"}#y(t){return t.type==="feature"}}var sc=ae('<div data-slot="checkbox-indicator" class="text-current transition-none"><!></div>');function lc(I,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Ve(t,"checked",11,!1),c=Ve(t,"indeterminate",11,!1),f=Tt(t,["$$slots","$$events","$$legacy","ref","checked","indeterminate","class"]),h=ne(Re(s())),b=ne(Re(c()));je(()=>{B(h,s())}),je(()=>{B(b,c())});var P=de(),C=X(P);{const O=(N,W)=>{let M=()=>W?.().checked,L=()=>W?.().indeterminate;var K=sc(),V=ee(K);{var H=U=>{Fl(U,{class:"size-3.5"})},j=U=>{var le=de(),te=X(le);{var oe=ve=>{Ro(ve,{class:"size-3.5"})};he(te,ve=>{L()&&ve(oe)},!0)}T(U,le)};he(V,U=>{M()?U(H):U(j,!1)})}$(K),T(N,K)};let D=Ce(()=>ps("peer flex size-4 shrink-0 items-center justify-center rounded-[4px] border border-input shadow-xs transition-shadow outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 data-[state=checked]:border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:bg-input/30 dark:aria-invalid:ring-destructive/40 dark:data-[state=checked]:bg-primary",t.class));Oe(C,()=>Lo,(N,W)=>{W(N,Rt({"data-slot":"checkbox",get class(){return u(D)}},()=>f,{get ref(){return a()},set ref(M){a(M)},get checked(){return u(h)},set checked(M){B(h,M,!0)},get indeterminate(){return u(b)},set indeterminate(M){B(b,M,!0)},children:O,$$slots:{default:!0}}))})}T(I,P),Ne()}var cc=ae("<div><!></div>");function ga(I,t){De(t,!0);let a=Ce(()=>t.getDownloadState?.(t.node)??We.Inactive),s=Ce(()=>u(a)===We.Active),c=Ce(()=>u(a)===We.Indeterminate);function f(P){P.stopPropagation();const C=u(a)===We.Active?We.Inactive:We.Active;t.onDownloadStateChanged?.(t.node,C)}var h=cc(),b=ee(h);lc(b,{get checked(){return u(s)},get indeterminate(){return u(c)},onclick:f,title:"Download"}),$(h),T(I,h),Ne()}var uc=ae('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ma(I,t){De(t,!0);const a=Ve(t,"isFolder",3,!1),s=Ve(t,"isOpen",3,!1),c=`calc(100% - ${t.depth*1}rem)`;var f=uc();f.__click=function(...L){t.onclick?.apply(this,L)};var h=ee(f),b=ee(h),P=ee(b);{var C=L=>{Sa(L,{get isOpen(){return s()}})};he(P,L=>{a()&&L(C)})}var O=ue(P,2),D=ee(O);jr(D,()=>t.icon),$(O);var N=ue(O,2),W=ee(N,!0);$(N),$(b);var M=ue(b,2);Qe(M,()=>t.children??Ke),$(h),$(f),ct(L=>{vi(f,1,L),xn(f,`width: ${c};`),Ct(W,t.name)},[()=>xo(tc({enhancedHover:!0,includeFont:!0}))]),T(I,f),Ne()}Cn(["click"]);var dc=ae('<div class="flex items-center gap-2"><!> <!></div>'),fc=ae('<div class="flex items-center gap-2"><!> <!></div>');function La(I,t){De(t,!0);const a=H=>{var j=de(),U=X(j);{var le=te=>{var oe=de(),ve=X(oe);{var Ie=ye=>{ma(ye,{get icon(){return u(N)},get name(){return t.node.name},get depth(){return f()},onclick:V,get isFolder(){return b},get isOpen(){return u(O)},children:_e=>{var Fe=dc(),Be=ee(Fe);{var $e=ge=>{ga(ge,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};he(Be,ge=>{t.isDownloadable&&ge($e)})}var ke=ue(Be,2);{var Le=ge=>{{let Ee=Ce(()=>t.getNodeDrawState?.(t.node.id)===tr.Suspended);Xi(ge,{get checked(){return u(D)},get indeterminate(){return u(Ee)},onCheckedChange:L})}};he(ke,ge=>{P&&ge(Le)})}$(Fe),T(_e,Fe)},$$slots:{default:!0}})},ce=ye=>{ma(ye,{get icon(){return u(N)},get name(){return t.node.name},get depth(){return f()},onclick:K,get isFolder(){return b},children:_e=>{var Fe=fc(),Be=ee(Fe);{var $e=ge=>{ga(ge,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};he(Be,ge=>{t.isDownloadable&&ge($e)})}var ke=ue(Be,2);{var Le=ge=>{{let Ee=Ce(()=>t.getNodeDrawState?.(t.node.id)===tr.Suspended);Xi(ge,{get checked(){return u(D)},get indeterminate(){return u(Ee)},onCheckedChange:L})}};he(ke,ge=>{P&&ge(Le)})}$(Fe),T(_e,Fe)},$$slots:{default:!0}})};he(ve,ye=>{b?ye(Ie):ye(ce,!1)})}T(te,oe)};he(U,te=>{c()?.getItemConfig(t.node.id)?.isHidden||te(le)})}T(H,j)},s=(H,j=Ke)=>{var U=de(),le=X(U);{var te=oe=>{{let ve=Ce(()=>c()?.getItemConfig(j().id)?.isDownloadable??!0),Ie=Ce(()=>f()+1);La(oe,{get treeviewConfigStore(){return c()},get node(){return j()},get isDownloadable(){return u(ve)},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState},get onFilterClicked(){return t.onFilterClicked},get hasFiltersApplied(){return t.hasFiltersApplied},get getNodeVisibility(){return t.getNodeVisibility},get getNodeDrawState(){return t.getNodeDrawState},get depth(){return u(Ie)},get useLayerTypeIcon(){return h()}})}};he(le,oe=>{b&&u(O)&&!c()?.getItemConfig(j().id)?.isHidden&&oe(te)})}T(H,U)},c=Ve(t,"treeviewConfigStore",3,null),f=Ve(t,"depth",3,0),h=Ve(t,"useLayerTypeIcon",3,!1),b=!!(t.node.children&&t.node.children.length),P=!b;let C=!1,O=ne(!1),D=ne(!1),N=ne(""),W=ne(!1),M=ne(!1);je(()=>{C||(B(O,c()?.getItemConfig(t.node.id)?.isOpenOnInit??!1,!0),C=!0)}),je(()=>{if(!t.node)return;const H=t.getNodeVisibility?t.getNodeVisibility(t.node.id):!1;B(D,H??!1,!0),t.node instanceof Je&&B(N,Ta(t.node.layer,h(),b,u(O)),!0)}),je(()=>{if(!(t.node instanceof Je))return;const H=(t.getDownloadState?.(t.node)===We.Active&&t.node.layer.type==="feature")??!1;H&&!u(W)?(B(W,!0),B(M,!1)):!H&&u(W)&&(B(M,!0),setTimeout(()=>{B(W,!1),B(M,!1)},180))});function L(){!P||!t.onNodeVisibilityChange||(B(D,!u(D)),t.onNodeVisibilityChange(t.node,u(D)))}function K(){t.onNodeClick?.(t.node)}function V(){B(O,!u(O)),t.onNodeClick?.(t.node)}{let H=Ce(()=>b?t.node.children:null);Da(I,{get isOpen(){return u(O)},get content(){return a},get childNodes(){return u(H)},get childNode(){return s}})}Ne()}class hc{#e;#t;constructor(t,a){this.#e=t,this.#t=a}updateSelection(t,a){if(!this.#t.getItemConfig(t.id)?.isHidden){if(!(t instanceof Je)){this.updateChildrenSelection(t,a);return}if(t instanceof Sr){this.updateFieldSelection(t,a);return}this.updateLayerSelection(t,a)}}getSelectionState(t){if(!(t instanceof Je))return this.determineSelectionStateFromChildren(t);if(this.isGroupLayer(t))return this.determineSelectionStateFromChildren(t);let a;return t instanceof Sr?(a=this.#e.getSelection(t.featureLayer.id),a&&a.selectedFieldIds.has(t.field.name)?We.Active:We.Inactive):(a=this.#e.getSelection(t.id),a?this.isFeatureLayer(t)&&t.children&&t.children.length>0?this.determineSelectionStateFromChildren(t):We.Active:We.Inactive)}updateLayerSelection(t,a){let s=this.#e.getSelection(t.id);switch(a){case We.Active:!s&&!this.isGroupLayer(t)&&(s=this.createAndAddDataSelection(t.id));for(const c of t.children||[])this.updateSelection(c,a);break;case We.Inactive:s&&!this.isGroupLayer(t)&&this.#e.removeSelection(t.id),this.updateChildrenSelection(t,a);break}}updateFieldSelection(t,a){let s=this.#e.getSelection(t.featureLayer.id);switch(a){case We.Active:s||(s=this.createAndAddDataSelection(t.featureLayer.id)),this.#e.addOrUpdateSelection(t.featureLayer.id,[...s.selectedFieldIds,t.field.name]);break;case We.Inactive:{if(!s)break;const c=new Ft(s.selectedFieldIds);c.delete(t.field.name),this.#e.addOrUpdateSelection(t.featureLayer.id,[...c]),c.size===0&&this.#e.removeSelection(s.layerId);break}}}updateChildrenSelection(t,a){for(const s of t.children||[])this.updateSelection(s,a)}determineSelectionStateFromChildren(t){let a=0,s=0;for(const c of t.children||[]){if(this.#t.getItemConfig(c.id)?.isHidden)continue;s++;const h=this.getSelectionState(c);if(h===We.Active||this.isFeatureLayer(c)&&h!==We.Inactive)a++;else if(h===We.Indeterminate)return We.Indeterminate}return a===0?We.Inactive:a===s?We.Active:We.Indeterminate}createAndAddDataSelection(t){const a={layerId:t,selectedFieldIds:new Ft};return this.#e.addSelection(a),a}isGroupLayer(t){return t instanceof Je&&t.layer.type==="group"}isFeatureLayer(t){return t instanceof Je&&t.layer.type==="feature"}}function vc(I,t){De(t,!0);const a=Ve(t,"fieldFilterMenuStore",7);function s(){c.clearSelections()}const c=new Fa,f=new hc(t.dataSelectionStore,t.treeviewConfigStore);je(()=>{if(!t.webMap||c.initialized)return;(async()=>{await t.webMap.when(),await h(t.webMap.layers.toArray());const H=new oc(t.treeviewConfigStore);c.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,t.layerViewProvider,[H],t.customRendererService)})()});async function h(V){for(const H of V)H.type==="feature"&&!H.loaded&&await H.load(),H.type==="group"&&await h(H.layers.toArray())}function b(V,H){console.log(`[tree-view] onNodeVisibilityChange: Setting visibility of node ${V.id} to ${H}`),c.setVisibilityState(V.id,H)}function P(V){return c.getNodeDrawState(V)}function C(V,H){f.updateSelection(V,H)}function O(V){return f.getSelectionState(V)}function D(V){if(a().ActiveLayer?.uid===V){a().ActiveLayer=null;return}const j=c.getNodeById(V);!j||!(j instanceof Je)||(a().ActiveLayer=j.layer)}function N(V){const H=t.dataSelectionStore.getSelection(V);if(!H?.selectedFieldIds)return!1;const j=c.getNodeById(V);if(!j||!(j instanceof Je))return!1;const U=j.layer.fields?.length||0,le=H?.selectedFieldIds.size||0;return le>0&&le!==U}var W={clearSelections:s},M=de(),L=X(M);{var K=V=>{var H=de(),j=X(H);Oe(j,()=>xa,(U,le)=>{le(U,{children:(te,oe)=>{var ve=de(),Ie=X(ve);qt(Ie,17,()=>c.getNodes(),ce=>ce.id,(ce,ye)=>{{let Se=Ce(()=>t.treeviewConfigStore.getItemConfig(u(ye).id)?.isDownloadable??!0);La(ce,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return u(ye)},get isDownloadable(){return u(Se)},onNodeClick:()=>{},onNodeVisibilityChange:b,getNodeVisibility:_e=>c.getVisibilityState(_e),onDownloadStateChanged:C,getDownloadState:O,onFilterClicked:D,hasFiltersApplied:N,getNodeDrawState:P,depth:0,useLayerTypeIcon:!0})}}),T(te,ve)},$$slots:{default:!0}})}),T(V,H)};he(L,V=>{c.initialized&&V(K)})}return T(I,M),Ne(W)}class Ra{#e;constructor(t){this.#e=t}async getLayerView(t){return this.#e.whenLayerView(t)}async getLayerViewById(t){const a=this.#e.map?.findLayerById(t);if(a)return this.getLayerView(a)}}class pc{mapView;areaSelectionInteractionStore;interactableLayers;pointerMoveHandle=null;clickHandle=null;leaveHandle=null;enterHandle=null;#e=ne(!0);get pointerInsideMap(){return u(this.#e)}set pointerInsideMap(t){B(this.#e,t,!0)}constructor(t,a,s){console.log("[map-interaction-store] Initializing with MapView"),this.mapView=t,this.areaSelectionInteractionStore=a,this.interactableLayers=s,this.setupHighlights(t),this.setupPointerMoveHandler(t),this.setupClickHandler(t),this.setupLeaveHandler(t),this.setupEnterHandler(t),console.log("[map-interaction-store] Initialized with MapView")}setupHighlights(t){const a={name:"hover",color:"lightgreen",haloOpacity:1,fillOpacity:.2},s={name:"selected",color:"green",haloOpacity:1,fillOpacity:.3};t.highlights.push(a),t.highlights.push(s)}setupPointerMoveHandler(t){this.pointerMoveHandle=t.on("pointer-move",async a=>{if(!this.pointerInsideMap)return;const{results:s}=await t.hitTest(a),c=s[0];if(!c){this.clearHoverHighlight();return}const f=c.graphic,h=f.layer;if(!f||!h||!this.isLayerInteractable(h.title)||f.attributes?.[h.objectIdField]===void 0){this.clearHoverHighlight();return}const b=f.attributes?.[h.objectIdField];if(!(this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.currentHoveredArea.id===b))try{const P=await t.whenLayerView(h);this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P),this.clearHoverHighlight();const C=P;if(!C){console.warn("LayerView is not a FeatureLayerView");return}if(!this.pointerInsideMap)return;const O=C.highlight(f,{name:"hover"});this.areaSelectionInteractionStore.setHoveredArea(b,O)}catch(P){console.error("Error in pointer-move handler:",P),this.clearHoverHighlight()}})}setupClickHandler(t){this.clickHandle=t.on("click",async a=>{const{results:s}=await t.hitTest(a),c=s[0];if(!c)return;const f=c.graphic,h=f.layer;if(!f||!h||!this.isLayerInteractable(h.title)||f.attributes?.[h.objectIdField]===void 0)return;const b=f.attributes?.[h.objectIdField];try{const P=await t.whenLayerView(h),C=P;if(!C){console.warn("Layer is not a FeatureLayerView");return}if(this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P),this.areaSelectionInteractionStore.selectionViewState.areaHandles.get(b))this.areaSelectionInteractionStore.removeSelectedArea(b);else{const D=C.highlight(f,{name:"selected"});this.areaSelectionInteractionStore.addSelectedArea(b,D)}}catch(P){console.error("Error in click handler:",P)}})}setupLeaveHandler(t){this.leaveHandle=t.on("pointer-leave",()=>{this.pointerInsideMap=!1,this.clearHoverHighlight()})}setupEnterHandler(t){this.enterHandle=t.on("pointer-enter",()=>{this.pointerInsideMap=!0})}isLayerInteractable(t){return this.interactableLayers.has(t)}clearHoverHighlight(){this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.clearHoveredArea()}cleanup(){this.pointerMoveHandle&&(this.pointerMoveHandle.remove(),this.pointerMoveHandle=null),this.clickHandle&&(this.clickHandle.remove(),this.clickHandle=null),this.leaveHandle&&(this.leaveHandle.remove(),this.leaveHandle=null),this.enterHandle&&(this.enterHandle.remove(),this.enterHandle=null),this.clearHoverHighlight(),this.pointerInsideMap=!0,this.interactableLayers=new Ft,console.log("[map-interaction-store] cleaned up")}get currentMapView(){return this.mapView}}var gc=ae('<div class="map-view svelte-14z0ybm"></div>');function mc(I,t){De(t,!0);const a=Ve(t,"mapView",7);let s=ne(null),c=null;const f="streets-vector";let h,b;function P(){if(!a())throw new Error("MapView is not initialized");return new Ra(a())}Rr(async()=>{await C(),await N()});async function C(){if(!b){const[{default:V},{default:H},{default:j},{default:U}]=await Promise.all([Vr(()=>import("../chunks/BEZFO2vt.js").then(le=>le.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url),Vr(()=>import("../chunks/CZyMpCUL.js").then(le=>le.a2),__vite__mapDeps([37,1,2,3,5,38,39,24,40,21,6,7,41,31,32,42,19,20,43,8,9,10,11,22,44,45,16,46,47,48,49,23,50,51,52,53,12,54,55,56,57,58,59,33,60,61,62,25,63,64,65,66,14,67,0,4,13,15,17,18,26,27,28,29,30,34,35,36,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94]),import.meta.url),Vr(()=>import("../chunks/DpAKiq6K.js").then(le=>le.W),__vite__mapDeps([95,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,38,39,40,41,42,43,96,97,98,69,99,100,78,79,73,47,48,49,50,51,52,53,54,55,56,57,58,59,101,102,103,72,104,44,45,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,71,121,68,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,64,175,176,177,178,179,180]),import.meta.url),Vr(()=>import("../chunks/DhMSIuCj.js"),__vite__mapDeps([101,5,1,2,3,48,24,8,9,10,6,7,11,49,23,19,20,21,96,102,103,72,73,47,41,31,32,42,50,51,52,53,12,54,55,56,57,58,59,104,14,44,45,16,105,106,33,107,108,109,110,111,112,34,35,113,114,115,25,116,117,118,119,120,71,121,68,122,123,124,69,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,97,146,147,148,149,150,151,152,153,43,154,155,156,157,158,159,160,161,162,163,27,164,165,166,15,167,168,169,98,170,171,172,173,174,64,175,176,177]),import.meta.url)]);h=V,b=H}}async function O(){return new h({basemap:f})}async function D(){if(t.webMap)try{if(await C(),await N(),!a()){console.error("MapView is not initialized");return}a().container=c,a().popupEnabled=!1,a().map=t.webMap,console.log("[uprn-map-view] MapView updated with new webMap"),await t.areaSelectionInteractionStore.refreshLayerView(),await t.areaSelectionInteractionStore.refreshAreas()}catch(V){console.error("Error updating MapView with new webMap:",V)}}async function N(){if(!c){console.error("Map container element was not found");return}try{a().container=c,a().popupEnabled=!1,a().map=t.webMap??void 0,a().ui.move("zoom","top-right"),await a().when(),console.log("[uprn-map-view] Map loaded successfully")}catch(V){console.error("Error loading map:",V),await W()}}async function W(){try{const V=await O();a().container=c,a().popupEnabled=!1,a().map=V,await a().when(),console.log("[uprn-map-view] Fallback map loaded")}catch(V){console.error("Error loading fallback map:",V)}}je(()=>{t.webMap&&D()}),je(()=>{!a()||u(s)||B(s,new pc(a(),t.areaSelectionInteractionStore,t.interactableLayers),!0)});function M(){a()&&a().destroy()}ya(()=>{M()});var L={getLayerViewProvider:P},K=gc();return Lt(K,V=>c=V,()=>c),T(I,K),Ne(L)}var yc=ae('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),bc=ae('<div class="flex min-h-0 flex-1 flex-col"><!></div>');function yn(I,t){var a=bc(),s=ee(a);Oe(s,()=>kn,(c,f)=>{f(c,{class:"card-content flex min-h-0 flex-1 flex-col overflow-hidden p-0",children:(h,b)=>{var P=yc(),C=ee(P);Qe(C,()=>t.children??Ke),$(P),T(h,P)},$$slots:{default:!0}})}),$(a),T(I,a)}var wc=ae("<!> <!>",1),_c=ae('<div class="tab-list-wrapper flex-shrink-0 svelte-rohqkk"><!></div> <!>',1);function Sc(I,t){De(t,!0);const a=Ve(t,"triggers",19,()=>[]);var s=de(),c=X(s);Oe(c,()=>Mo,(f,h)=>{h(f,{get value(){return t.value},get onValueChange(){return t.onValueChange},class:"flex h-full w-full flex-col",children:(b,P)=>{var C=_c(),O=X(C),D=ee(O);Oe(D,()=>jo,(W,M)=>{M(W,{class:"tab-list",children:(L,K)=>{var V=de(),H=X(V);qt(H,17,a,_r,(j,U,le,te)=>{let oe=()=>u(U).value,ve=()=>u(U).label;var Ie=wc(),ce=X(Ie);Oe(ce,()=>Ho,(_e,Fe)=>{Fe(_e,{get value(){return oe()},class:"tab-trigger",children:(Be,$e)=>{ur();var ke=wr();ct(()=>Ct(ke,ve())),T(Be,ke)},$$slots:{default:!0}})});var ye=ue(ce,2);{var Se=_e=>{us(_e,{class:"separator"})};he(ye,_e=>{oe()!==a()[a().length-1]?.value&&_e(Se)})}T(j,Ie)}),T(L,V)},$$slots:{default:!0}})}),$(O);var N=ue(O,2);Qe(N,()=>t.children??Ke),T(b,C)},$$slots:{default:!0}})}),T(I,s),Ne()}var xc=ae('<div class="min-w-0 space-y-2 overflow-hidden"><!></div>'),Ic=ae('<div class="w-full flex-1 overflow-hidden pr-1.5 pl-1.5"><!></div>');function kc(I,t){var a=Ic(),s=ee(a);Ia(s,{class:"h-full w-full",children:(c,f)=>{var h=xc(),b=ee(h);{var P=C=>{var O=de(),D=X(O);Qe(D,()=>t.children),T(C,O)};he(b,C=>{t.children&&C(P)})}$(h),T(c,h)},$$slots:{default:!0}}),$(a),T(I,a)}var Cc=ae('<div class="w-full flex-shrink-0"><!></div>');function Ac(I,t){var a=Cc(),s=ee(a);{var c=f=>{var h=de(),b=X(h);Qe(b,()=>t.children),T(f,h)};he(s,f=>{t.children&&f(c)})}$(a),T(I,a)}var Pc=ae('<div class="w-full flex-shrink-0"><!></div>');function Oc(I,t){var a=Pc(),s=ee(a);{var c=f=>{var h=de(),b=X(h);Qe(b,()=>t.children),T(f,h)};he(s,f=>{t.children&&f(c)})}$(a),T(I,a)}class Ec{#e=ne(null);get layerId(){return u(this.#e)}set layerId(t){B(this.#e,t,!0)}#t=ne(Re(new Ft));get selectedAreaIds(){return u(this.#t)}set selectedAreaIds(t){B(this.#t,t,!0)}setLayerId(t){this.layerId!==t&&(this.layerId=t,this.selectedAreaIds.clear())}addSelectedArea(t){this.selectedAreaIds.add(t)}addSelectedAreas(t){t.forEach(a=>this.selectedAreaIds.add(a))}removeSelectedArea(t){this.selectedAreaIds.delete(t)}clearSelectedAreas(){this.selectedAreaIds.clear()}exportSnapshot(){return{layerId:this.layerId,selectedAreaIds:new Ft(this.selectedAreaIds)}}}class Fc{areaSelectionStore;layerViewProvider;#e=ne(Re({layerView:null,areaHandles:new wt}));get selectionViewState(){return u(this.#e)}set selectionViewState(t){B(this.#e,t,!0)}#t=ne(null);get lastAddedArea(){return u(this.#t)}set lastAddedArea(t){B(this.#t,t,!0)}#r=ne(null);get lastRemovedArea(){return u(this.#r)}set lastRemovedArea(t){B(this.#r,t,!0)}#n=ne(null);get currentHoveredArea(){return u(this.#n)}set currentHoveredArea(t){B(this.#n,t,!0)}fieldInfos=[];cachedNames=new wt;constructor(t,a){this.areaSelectionStore=t,this.layerViewProvider=a,wa(()=>{je(()=>{this.refreshLayerView()}),je(()=>{this.refreshAreas()})})}async refreshLayerView(){if(!this.areaSelectionStore.layerId&&this.selectionViewState.layerView!==null){this.resetSelectedLayerView();return}if(this.selectionViewState.layerView?.layer?.id===this.areaSelectionStore.layerId||!this.areaSelectionStore.layerId)return;const t=await this.layerViewProvider.getLayerViewById(this.areaSelectionStore.layerId);t&&this.setSelectedLayerView(t)}async refreshAreas(){const t=this.selectionViewState.layerView;if(!t){this.resetSelectedAreas();return}const a=this.areaSelectionStore.selectedAreaIds,s=this.selectionViewState.areaHandles;for(const c of s.keys())a.has(c)||this.removeSelectedArea(c);for(const c of a){if(s.has(c))continue;const f=t.highlight(c,{name:"selected"});f&&this.addSelectedArea(c,f)}}setFieldInfos(t){this.fieldInfos=t}setSelectedLayerView(t){this.selectionViewState?.layerView!==t&&(this.selectionViewState={layerView:t,areaHandles:new wt},this.resetSelectedAreas())}clearSelectedLayerView(){this.selectionViewState.layerView!==null&&(this.resetSelectedAreas(),this.selectionViewState.layerView=null)}resetSelectedLayerView(){this.selectionViewState={layerView:null,areaHandles:new wt},this.resetSelectedAreas()}resetSelectedAreas(){!this.selectionViewState.layerView&&this.selectionViewState.areaHandles.size===0||(this.selectionViewState.areaHandles.values().forEach(t=>{t.remove()}),this.selectionViewState.areaHandles.clear(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null)}addSelectedArea(t,a){if(!this.selectionViewState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const s={id:t,handle:a};this.lastAddedArea=s,this.selectionViewState.areaHandles.set(t,a),this.areaSelectionStore.addSelectedArea(t)}removeSelectedArea(t){if(!this.selectionViewState){console.warn("[area-selection-interaction-store] no feature layer view is set.");return}const a=this.selectionViewState.areaHandles.get(t);if(!a){console.warn(`[area-selection-interaction-store] no handle found for area ID ${t}.`);return}this.lastRemovedArea={id:t,handle:a},a.remove(),this.selectionViewState.areaHandles.delete(t),this.areaSelectionStore.removeSelectedArea(t)}async getAreaNamesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getNameFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer;let c=this.cachedNames.get(s.uid);c||(c=new wt,this.cachedNames.set(s.uid,c));const f=new Array(t.length),h=new wt,b=[];if(t.forEach((O,D)=>{h.set(O,D);const N=c.get(O);N!==void 0?f[D]=N:b.push(O)}),b.length===0)return f.map(O=>O??"");const P=s.objectIdField,C=await s.queryFeatures({objectIds:b,outFields:[a,P],returnGeometry:!1});for(const O of C.features){const D=O.attributes[P],N=O.attributes[a],W=h.get(D);W!==void 0&&(f[W]=N??"",c.set(D,N??""))}return f.map(O=>O??"")}async getAreaCodesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getCodeFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer,c=s.objectIdField,f=await s.queryFeatures({objectIds:t,outFields:[a,c],returnGeometry:!1}),h=new Array(t.length);for(const b of f.features){const P=b.attributes[c],C=b.attributes[a],O=t.indexOf(P);O!==-1&&(h[O]=C??"")}return h.map(b=>b??"")}setHoveredArea(t,a){t!==this.currentHoveredArea?.id&&(this.currentHoveredArea&&this.clearHoveredArea(),this.currentHoveredArea={id:t,handle:a})}clearHoveredArea(){this.currentHoveredArea&&(this.currentHoveredArea?.handle.remove(),this.currentHoveredArea=null)}getNameFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.nameField;return t||(console.warn(`[area-selection-interaction-store] no name field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}getCodeFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.codeField;return t||(console.warn(`[area-selection-interaction-store] no code field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}clearSelections(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,console.log("[area-selection-interaction-store] selections cleared.")}cleanup(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,this.cachedNames.clear(),this.fieldInfos=[],console.log("[area-selection-interaction-store] cleaned up.")}}const Tc=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];class Dc{#e;constructor(t){if(!t)throw new Error("UprnDownloadService endpoints configuration is required");if(!t.baseUrl||!t.healthRoute||!t.requestJobRoute||!t.requestJobStatusesRoute||!t.getAreaSelectionLimitsRoute||!t.fetchDownloadRoute)throw new Error("UprnDownloadService endpoints configuration is incomplete");this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async requestJob(t){try{console.log("[uprn-download-service] requesting job with request:",t);const a=`${this.#e.baseUrl}${this.#e.requestJobRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to request job:",s.statusText,"request:",JSON.stringify(t));return}return await s.json()}catch(a){console.error("Error requesting job:",a);return}}async requestJobStatuses(t){try{const a=`${this.#e.baseUrl}${this.#e.requestJobStatusesRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to get job statuses:",s.statusText);return}return await s.json()}catch(a){console.error("Error getting job statuses:",a);return}}async getSelectionAreaLimits(){try{const t=`${this.#e.baseUrl}${this.#e.getAreaSelectionLimitsRoute}`,a=await fetch(t);if(!a.ok){console.error("Failed to get area selection limits:",a.statusText);return}return await a.json()}catch(t){console.error("Error getting selection area limits:",t);return}}getDownloadUrl(t){const a=this.#e.baseUrl.replace(/\/+$/,""),s=this.#e.fetchDownloadRoute.replace(/\/+$/,"");return`${a}${s}/${encodeURIComponent(t)}`}}class Nc{#e;constructor(t){this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async chat(t){try{const a=`${this.#e.baseUrl}${this.#e.chatRoute}`,c=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!c.ok){console.error("Failed to send chat query:",c.statusText);return}return await c.json()}catch(a){console.error("Error sending chat query:",a);return}}async chatStream(t,a){try{const s=`${this.#e.baseUrl}${this.#e.chatStreamRoute}`,f=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!f.ok)return console.error("Failed to start chat stream:",f.statusText),!1;const h=f.body?.getReader();if(!h)return console.error("No response body reader available"),!1;const b=new TextDecoder;let P=!1;for(;!P;){const{value:C,done:O}=await h.read();if(P=O,C){const D=b.decode(C,{stream:!P});a(D)}}return!0}catch(s){return console.error("Error during chat stream:",s),!1}}}const Vc=Object.freeze({lod00World:{lod:0,scale:591657527591555e-6},lod01World:{lod:1,scale:295828763795777e-6},lod02World:{lod:2,scale:147914381897889e-6},lod03Continent:{lod:3,scale:73957190948944e-6},lod04Continent:{lod:4,scale:36978595474472e-6},lod05Countries:{lod:5,scale:18489297737236e-6},lod06Country:{lod:6,scale:9244648868618e-6},lod07StatesProvinces:{lod:7,scale:4622324434309e-6},lod08Counties:{lod:8,scale:2311162217155e-6},lod09Counties:{lod:9,scale:1155581108577e-6},lod10Country:{lod:10,scale:577790.554289},lod11MetropolitanArea:{lod:11,scale:288895.277144},lod12Cities:{lod:12,scale:144447.638572},lod13City:{lod:13,scale:72223.819286},lod14Town:{lod:14,scale:36111.909643},lod15Neighborhood:{lod:15,scale:18055.954822},lod16Streets:{lod:16,scale:9027.977411},lod17CityBlock:{lod:17,scale:4513.988705},lod18Buildings:{lod:18,scale:2256.994353},lod19Building:{lod:19,scale:1128.497176},lod20Houses:{lod:20,scale:564.248588},lod21Houses:{lod:21,scale:282.124294},lod22Houses:{lod:22,scale:141.062147},lod23HouseProperty:{lod:23,scale:70.5310735}});class Lc{#e=null;#t=!1;async init(t){this.#t||(await this.#r(t),this.#t=!0)}async#r(t){const s=await(await fetch(t)).json();this.#e=s}doesFieldHaveCustomRenderer(t,a){this.#c();const s=this.#e.FeatureLayers.find(h=>h.Name===t.title);if(!s)return!1;const c=this.#e.Fields.find(h=>h.FeatureLayerId===s.Id&&h.Name===a);return c?!!this.#e.CustomRenderers_Fields.find(h=>h.FieldId===c.Id):!1}getAllFieldsWithCustomRenderers(t){this.#c();const a=this.#e.FeatureLayers.find(f=>f.Name===t.title);if(!a)return[];const s=this.#e.Fields.filter(f=>f.FeatureLayerId===a.Id),c=[];for(const f of s)this.#e.CustomRenderers_Fields.some(b=>b.FieldId===f.Id)&&c.push(f.Name);return c}async applyCustomRenderer(t,a){this.#c();const s=this.#e.FeatureLayers.find(O=>O.Name===t.title);if(!s)return;const c=this.#e.Fields.find(O=>O.FeatureLayerId===s.Id&&O.Name===a);if(!c){console.warn(`[custom-renderer-service] could not find the field ${a} for feature layer id ${s.Id}`);return}const f=this.#e.CustomRenderers_Fields.find(O=>O.FieldId===c.Id);if(!f){console.warn(`[custom-renderer-service] could not find a custom renderer field for field ${a} in feature layer id ${s.Id}`);return}const h=this.#e.CustomRenderers.find(O=>O.Id===f.CustomRendererId);if(!h)throw new Error(`Could not find a custom renderer with the id ${f.CustomRendererId}`);const b=await this.getRendererClassBreaks(h.ClassBreaksGroupId.toString()),P=await this.getRendererSymbols(h.SymbolsId.toString()),C=this.#i(h.CustomRendererType,P,b,[],a);t.renderer=C,this.setCustomOutlines(t,h.LodsGroupId)}async setCustomOutlines(t,a){const s=this.#e.CustomRenderers_Lods.filter(h=>h.GroupId===a).sort((h,b)=>h.Lod-b.Lod);if(s.length===0){console.warn(`No LODs found for LODs group id ${a}`);return}const c=[],f=Object.values(Vc);s.forEach(h=>{const b=h.OutlineWidth,P=h.Lod,C=this.#n(f,P)-1;c.push({size:b,value:f[C].scale})}),(t.renderer instanceof na||t.renderer instanceof ia)&&this.#l(t.renderer,c)}async getRendererClassBreaks(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_ClassBreaks.filter(c=>c.GroupId===a).sort((c,f)=>c.Order-f.Order);if(s.length===0)throw new Error(`Could not find a group with the id ${t}`);return s}async getRendererSymbols(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_Symbols.find(h=>h.Id===a);if(!s)throw new Error(`Could not find a symbol with the id ${t}`);const c=this.#e.CustomRenderers_Symbols_Appearances.filter(h=>h.SymbolsId===a).sort((h,b)=>h.Order-b.Order);return{...s,Appearances:c}}#n(t,a){const s=t.findIndex(c=>c.lod===a);return s===-1?0:s<23?s+1:s}#i(t,a,s,c,f){switch(t){case 1:return this.#s(a,c);case 2:return this.#a(f,a,s,c);default:throw new Error(`Unknown renderer type: ${t}`)}}#a(t,a,s,c){const f="ClassMinValue",h="ClassMaxValue",b="SymbolColor",P="OutlineColor",C="OutlineWidth",O=a.Appearances.length,D=new na({field:t});for(let N=0;N<O;N++){const W=s[N][f],M=s[N][h],L=a.Appearances[N][b],K=a.Appearances[N][P],V=a.Appearances[N][C];D.addClassBreakInfo({minValue:W,maxValue:M,symbol:new aa({color:pn.fromHex(L),outline:new oa({color:pn.fromHex(K),width:V})})})}return this.#l(D,c),D}#s(t,a){const s="SymbolColor",c="OutlineColor",f="OutlineWidth",h=t.Appearances[0][s],b=t.Appearances[0][c],P=t.Appearances[0][f],C=new ia({symbol:new aa({color:pn.fromHex(h),outline:new oa({color:pn.fromHex(b),width:P})})});return this.#l(C,a),C}#l(t,a){t.visualVariables=[{type:"size",target:"outline",valueExpression:"$view.scale",stops:a}]}#c(){if(!this.#t)throw new Error("CustomRendererService is not initialized");if(!this.#e)throw new Error("Data is not loaded")}}var Rc=ae('<div class="flex w-full items-center justify-between"><div class="font-medium">Chat</div> <div class="flex gap-1"><!> <!></div></div>'),Mc=ae("<!> <!>",1),jc=ae("<div><!></div>");function Hc(I,t){De(t,!0);const a=Ve(t,"isOpenedOnInit",3,!1);let s=ne(!1),c=ne(Re(a())),f=ne(!1),h=ne(void 0),b="300px",P="45px";je(()=>{u(s)||!u(h)||(u(c)&&(u(h).style.height=b),B(s,!0))});function C(){u(h)&&(B(c,!u(c)),B(f,!1),u(c)?(P=u(h).style.height,u(h).style.height=b):u(h).style.height=P)}function O(){u(h)&&(B(f,!u(f)),u(f)?(b=u(h).style.height,u(h).style.height="100%"):u(h).style.height=b)}var D=jc(),N=ee(D);Oe(N,()=>In,(W,M)=>{M(W,{class:"h-full w-full gap-0 rounded-none py-0 pt-0 pb-0",children:(L,K)=>{var V=Mc(),H=X(V);Oe(H,()=>gs,(le,te)=>{te(le,{class:"pt-2",children:(oe,ve)=>{var Ie=Rc(),ce=ue(ee(Ie),2),ye=ee(ce);{var Se=Fe=>{Nt(Fe,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:O,children:(Be,$e)=>{var ke=de(),Le=X(ke);{var ge=at=>{Nl(at,{class:"text-primary"})},Ee=at=>{Dl(at,{class:"text-primary"})};he(Le,at=>{u(f)?at(ge):at(Ee,!1)})}T(Be,ke)},$$slots:{default:!0}})};he(ye,Fe=>{u(c)&&Fe(Se)})}var _e=ue(ye,2);Nt(_e,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:C,children:(Fe,Be)=>{var $e=de(),ke=X($e);{var Le=Ee=>{Tl(Ee,{class:"text-primary"})},ge=Ee=>{ms(Ee,{class:"text-primary"})};he(ke,Ee=>{u(c)?Ee(ge,!1):Ee(Le)})}T(Fe,$e)},$$slots:{default:!0}}),$(ce),$(Ie),T(oe,Ie)},$$slots:{default:!0}})});var j=ue(H,2);{var U=le=>{var te=de(),oe=X(te);Oe(oe,()=>kn,(ve,Ie)=>{Ie(ve,{class:"h-full min-h-[10px] w-full p-0",children:(ce,ye)=>{var Se=de(),_e=X(Se);Qe(_e,()=>t.children??Ke),T(ce,Se)},$$slots:{default:!0}})}),T(le,te)};he(j,le=>{u(c)&&le(U)})}T(L,V)},$$slots:{default:!0}})}),$(D),Lt(D,W=>B(h,W),()=>u(h)),T(I,D),Ne()}class Kc{#e;#t;#r=ne(!1);#n=Ce(()=>this.#e.exportSnapshot());#i=Ce(()=>{const t=new wt;for(const[a,s]of this.#t.dataSelections)t.set(a,{layerId:s.layerId,selectedFieldIds:s.selectedFieldIds});return t});constructor(t,a){this.#e=t,this.#t=a,wa(()=>{je(()=>{console.log("[selection-tracking-store] Detected area selection change"),(async()=>{if(!u(this.#r)){console.log("[selection-tracking-store] Initial load not complete, skipping area selection effect");return}if(u(this.#n)){if(!u(this.#n).layerId){await Nr({areas:null});return}if(!u(this.#n).selectedAreaIds.size){await Nr({areas:null});return}await Nr({areas:u(this.#n)}),console.log("[selection-tracking-store] Area selection updated:",ai(u(this.#n)))}})()}),je(()=>{console.log("[selection-tracking-store] Detected data selection change"),(async()=>{if(!u(this.#r)){console.log("[selection-tracking-store] Initial load not complete, skipping data selection effect");return}if(!u(this.#i)||u(this.#i).size===0){console.log("[selection-tracking-store] No data selections, clearing in database"),await Nr({data:[]});return}await Nr({data:u(this.#i).values().toArray()}),console.log("[selection-tracking-store] Data selection updated:",ai(u(this.#i)))})()})})}async loadSelections(){const t=await Oa();if(!t){console.log("[selection-tracking-store] No existing selection found in database"),B(this.#r,!0);return}console.log("[selection-tracking-store] Loaded selection from database:",t),t.areas&&(this.#e.setLayerId(t.areas.layerId),console.log("[selection-tracking-store] (loadSelections) Restoring selected area IDs:",Array.from(t.areas.selectedAreaIds),"layer ID:",this.#e.layerId),this.#e.addSelectedAreas(Array.from(t.areas.selectedAreaIds))),t.data.forEach(a=>{this.#t.addSelection(a)}),B(this.#r,!0)}}var qc=ae("<!> <!>",1),Bc=ae('<p class="p-4 text-center text-sm text-gray-500">Download service is not available.</p>'),zc=ae("<div><!></div> <div><!></div> <div><!></div> <div><!></div>",1),Uc=ae("<div><!></div>"),Gc=ae('<p class="p-4 text-center text-sm text-gray-500">AI UPRN Chatbot service is not available.</p>'),Wc=ae('<div class="relative flex h-full w-full min-w-0 flex-col overflow-visible"><!> <!> <!> <!></div>'),Yc=ae("<!> <!> <!> <!>",1);function ad(I,t){De(t,!0);let a,s,c;const f=Re(new wl),h=Re(new bl);let b=ne("define-areas"),P=Re(new gl),C=Re(new Ec),O=ne(null),D=Re(new Kc(C,P)),N=ne(null),W=ne(void 0),M=ne(void 0),L=ne(void 0),K=ne(void 0),V=ne(void 0),H=ne(!1),j=ne(!1),U=ne(Re(new Set)),le=ne(Re(new Set)),te=ne(!0),oe=Re(ra.LEFT);Re(ra.BOTTOM);let ve=ne(Re([])),Ie=ne(Re(typeof window<"u"?window.innerWidth:1280)),ce=Ce(()=>Se(u(ve),fe=>fe.originalSize)),ye=Ce(()=>Se(u(ve),fe=>fe.minSize));function Se(fe,Me){if(!fe||fe.length===0)return;const Ae=[...fe].sort((et,At)=>At.breakpoint-et.breakpoint).find(et=>u(Ie)>=et.breakpoint);return Ae?Me(Ae):"0"}function _e(){B(te,!u(te))}function Fe(fe){B(b,fe,!0)}function Be(){B(b,"downloads")}function $e(){C.clearSelectedAreas(),P.clearSelections(),a?.clearSelections(),s?.clearSelections(),tl()}Rr(async()=>{B(L,new Lc,!0),await u(L).init(`${ns}/custom-renderers.json`),console.log("[uprn-2/page] CustomRendererService initialized");const fe=await ds();await D.loadSelections();const[{default:Me}]=await Promise.all([Vr(()=>import("../chunks/CZyMpCUL.js").then(Ae=>Ae.a2),__vite__mapDeps([37,1,2,3,5,38,39,24,40,21,6,7,41,31,32,42,19,20,43,8,9,10,11,22,44,45,16,46,47,48,49,23,50,51,52,53,12,54,55,56,57,58,59,33,60,61,62,25,63,64,65,66,14,67,0,4,13,15,17,18,26,27,28,29,30,34,35,36,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94]),import.meta.url)]);B(N,new Me,!0),B(O,new Fc(C,new Ra(u(N))),!0),B(le,new Set((fe.serviceUprn2Config.selectionLayersNameFields||[]).map(Ae=>Ae.layerName)),!0),u(O).setFieldInfos(fe.serviceUprn2Config.selectionLayersNameFields||[]),B(ve,fe.serviceUprn2Config.mainSidebarSizes||[],!0),B(W,new pa(fe.serviceUprn2Config.dataSelectionTreeviewConfig),!0),B(M,new pa(fe.serviceUprn2Config.areaSelectionTreeviewConfig),!0),(async()=>{const Ae=fe.serviceUprn2Config.uprnDownloadServiceEndpoints,et=fe.serviceUprn2Config.aiUprnChatbotServiceEndpoints;B(K,new Dc(Ae),!0),B(V,new Nc(et),!0),B(H,await u(K).getHealth(),!0),u(H)?console.log("[uprn-2/page] UPRN Download Service is available"):console.warn("[uprn-2/page] UPRN Download Service is NOT available"),B(j,await u(V).getHealth(),!0),u(j)?console.log("[uprn-2/page] AI UPRN Chatbot Service is available"):console.warn("[uprn-2/page] AI UPRN Chatbot Service is NOT available")})(),B(U,new Set(fe.serviceUprn2Config.dataSelectionTreeviewConfig?.fieldsToHide||[]),!0),await f.initializeAsync({portalUrl:fe.serviceUprn2Config.portalUrl,itemId:fe.serviceUprn2Config.portalItemId||"",proxy:fe.serviceUprn2Config.proxy})}),Rr(()=>{const fe=()=>{B(Ie,window.innerWidth,!0)};return window.addEventListener("resize",fe),()=>{window.removeEventListener("resize",fe)}}),ya(()=>{P.cleanup()});var ke=Yc(),Le=X(ke);Ko(Le,{});var ge=ue(Le,2);Ul(ge,{get dataSelectionStore(){return P},get fieldFilterMenuStore(){return h},get fieldsToHide(){return u(U)}});var Ee=ue(ge,2);{var at=fe=>{var Me=qc(),Xe=X(Me);Ps(Xe,{get areaSelectionInteractionStore(){return u(O)}});var Ae=ue(Xe,2);Os(Ae,{get areaSelectionInteractionStore(){return u(O)}}),T(fe,Me)};he(Ee,fe=>{u(O)&&fe(at)})}var ot=ue(Ee,2);{const fe=Xe=>{var Ae=Wc(),et=ee(Ae);Oe(et,()=>Ac,(tt,pe)=>{pe(tt,{children:(qe,gt)=>{Sc(qe,{get value(){return u(b)},get triggers(){return Tc},onValueChange:Fe})},$$slots:{default:!0}})});var At=ue(et,2);Oe(At,()=>kc,(tt,pe)=>{pe(tt,{children:(qe,gt)=>{var ze=zc(),ut=X(ze),pt=ee(ut);yn(pt,{children:(kt,Mt)=>{var Ye=de(),dt=X(Ye);{var _t=Ze=>{Lt(ic(Ze,{get webMap(){return f.data},get treeviewConfigStore(){return u(M)},get areaSelectionStore(){return C}}),ft=>a=ft,()=>a)};he(dt,Ze=>{f.isLoaded&&Ze(_t)})}T(kt,Ye)}}),$(ut);var rt=ue(ut,2),st=ee(rt);yn(st,{children:(kt,Mt)=>{var Ye=de(),dt=X(Ye);{var _t=Ze=>{{let ft=Ce(()=>c?.getLayerViewProvider());Lt(vc(Ze,{get webMap(){return f.data},get dataSelectionStore(){return P},get layerViewProvider(){return u(ft)},get treeviewConfigStore(){return u(W)},get customRendererService(){return u(L)},get fieldFilterMenuStore(){return h}}),jt=>s=jt,()=>s)}};he(dt,Ze=>{f.isLoaded&&Ze(_t)})}T(kt,Ye)}}),$(rt);var lt=ue(rt,2),Ue=ee(lt);yn(Ue,{children:(kt,Mt)=>{var Ye=de(),dt=X(Ye);{var _t=Ze=>{El(Ze,{get webMapStore(){return f},get areaSelectionInteractionStore(){return u(O)},get dataSelectionStore(){return P},get dataSelectionTreeviewConfig(){return u(W)},get fieldFilterMenuStore(){return h}})};he(dt,Ze=>{u(O)&&f.isLoaded&&Ze(_t)})}T(kt,Ye)}}),$(lt);var It=ue(lt,2),Vt=ee(It);yn(Vt,{children:(kt,Mt)=>{var Ye=de(),dt=X(Ye);{var _t=ft=>{var jt=Bc();T(ft,jt)},Ze=ft=>{hl(ft,{get webMapStore(){return f},get uprnDownloadService(){return u(K)},get fieldsToHide(){return u(U)}})};he(dt,ft=>{!u(K)||!u(H)?ft(_t):ft(Ze,!1)})}T(kt,Ye)}}),$(It),ct(()=>{ut.hidden=u(b)!=="define-areas",rt.hidden=u(b)!=="select-data",lt.hidden=u(b)!=="export",It.hidden=u(b)!=="downloads"}),T(qe,ze)},$$slots:{default:!0}})});var re=ue(At,2);Oe(re,()=>Oc,(tt,pe)=>{pe(tt,{children:(qe,gt)=>{var ze=Uc(),ut=ee(ze);{var pt=rt=>{yl(rt,{onExportSuccess:Be,clearSelections:$e,get areaSelectionInteractionStore(){return u(O)},get dataSelectionStore(){return P}})};he(ut,rt=>{u(O)&&rt(pt)})}$(ze),ct(()=>ze.hidden=u(b)!=="export"),T(qe,ze)},$$slots:{default:!0}})});var xt=ue(re,2);Hc(xt,{isOpenedOnInit:!0,children:(tt,pe)=>{var qe=de(),gt=X(qe);{var ze=pt=>{var rt=Gc();T(pt,rt)},ut=pt=>{Js(pt,{get aiUprnChatbotService(){return u(V)}})};he(gt,pt=>{!u(V)||!u(j)?pt(ze):pt(ut,!1)})}T(tt,qe)},$$slots:{default:!0}}),$(Ae),T(Xe,Ae)},Me=Xe=>{var Ae=de(),et=X(Ae);{var At=re=>{Lt(mc(re,{get webMap(){return f.data},get mapView(){return u(N)},get areaSelectionInteractionStore(){return u(O)},get interactableLayers(){return u(le)}}),xt=>c=xt,()=>c)};he(et,re=>{u(O)&&re(At)})}T(Xe,Ae)};Oe(ot,()=>vs,(Xe,Ae)=>{Ae(Xe,{get isOpen(){return u(te)},onToggle:_e,get position(){return oe},get originalSize(){return u(ce)},get minSize(){return u(ye)},sidebarContent:fe,mainContent:Me,$$slots:{sidebarContent:!0,mainContent:!0}})})}T(I,ke),Ne()}export{ad as component};
