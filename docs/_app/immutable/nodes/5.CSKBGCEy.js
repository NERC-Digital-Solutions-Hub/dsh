const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CTSXUDU4.js","../chunks/BoGhUpgK.js","../chunks/BO0zSyDw.js","../chunks/k6TpQ-vv.js","../chunks/BPpQzyjj.js","../chunks/PPVm8Dsz.js","../chunks/f3N8RNee.js","../chunks/CzvYEThE.js","../chunks/B5lVMRid.js","../chunks/DSPk0Ak5.js","../chunks/ju9f9SUf.js","../chunks/BTaqRh0J.js","../chunks/DHt-b6sf.js","../chunks/Bz8ODP7-.js","../chunks/llusru1W.js","../chunks/DGk5f3jX.js","../chunks/COfsMC1A.js","../chunks/DBjaQYpy.js","../chunks/Cq4_PSk6.js","../chunks/CBgN-qFR.js","../chunks/CWFjSrE_.js","../chunks/DrxIuXKq.js","../chunks/DwAWIrQ2.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/BIm8jKWl.js","../chunks/n6gGuowy.js","../chunks/CBPf5Xzi.js","../chunks/Cl5lrJ4c.js","../chunks/QnN3udRX.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/CJvCm90V.js","../chunks/Cdbu9T-_.js","../chunks/C8GVJd0n.js","../chunks/CHGTeQb_.js","../chunks/B4g-elGr.js","../chunks/Djp3mnm5.js","../chunks/Cib3qNiz.js","../chunks/DQOJ18NT.js","../chunks/BTUuMPnq.js","../chunks/tx3veOlo.js","../chunks/6MRGLEa9.js","../chunks/Ctqntsjr.js","../chunks/DFgO6MsE.js","../chunks/D9-ZcQjt.js","../chunks/EzLf78vY.js","../chunks/DOsAn7Yf.js","../chunks/DkeL9hOQ.js","../chunks/D4KQ_m3g.js","../chunks/BbfXAn2G.js","../chunks/B_6CEWka.js","../chunks/CJj3LawI.js","../chunks/DZd6gJy7.js","../chunks/ByDk2C3L.js","../chunks/C8BmVxiO.js","../chunks/gOAgCB9G.js","../chunks/BwHSc-32.js","../chunks/zhH3jSiH.js","../chunks/zaHqI9Tj.js","../chunks/BWW8flL2.js","../chunks/BCCr_gIb.js","../chunks/mHg8bgsm.js","../chunks/9YvG7tFv.js","../chunks/NvCg0b_A.js","../chunks/DVjOipaJ.js","../chunks/aQeO9QTD.js","../chunks/CtAyxxum.js","../chunks/CNM-_wGD.js","../chunks/TzWrp0a3.js","../chunks/BtaXzzQS.js","../chunks/mWsnnVEe.js","../chunks/4s6HuPM4.js","../chunks/Cb8Bfq8m.js","../chunks/Dbi-wR_H.js","../chunks/CwPahdQ8.js","../chunks/CtIavLKh.js","../chunks/Chk7YAAL.js","../chunks/C4eyRFHZ.js","../chunks/Cgb6qxNH.js","../chunks/CMQCdq-P.js","../chunks/C6RfGsvn.js","../chunks/DE4jip8N.js","../chunks/B7vazsP4.js","../chunks/CWPNGi4f.js","../chunks/DKpmsPfl.js","../chunks/CaVKkSa6.js","../chunks/BbqMB6FF.js","../chunks/bxuKdrAr.js","../chunks/B1N-tmtC.js","../chunks/BKN8xKDd.js","../chunks/DOWGs7Sq.js","../chunks/QQC62dOK.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/C-YJvzJ2.js","../chunks/pDuGEAnG.js","../chunks/BlRWP_y2.js","../chunks/BrScpkSj.js","../chunks/Dqz3n4A5.js","../chunks/rxpTDz6e.js","../chunks/D-YQ4CHs.js","../chunks/Blum7Kcb.js","../chunks/CvEXDeCT.js","../chunks/CrZcHcIt.js","../chunks/CL2NbQte.js","../chunks/iSkrXnNJ.js","../chunks/CnH9SN6T.js","../chunks/DLI8wQwt.js","../chunks/Cj1iE9mV.js","../chunks/C5CzMsLd.js","../chunks/C_xc-C99.js","../chunks/C8NvqbVi.js","../chunks/BCTt2611.js","../chunks/CSl9z7eV.js","../chunks/Dv56mZ8k.js","../chunks/VnM9Pp_d.js","../chunks/pdlPRen1.js","../chunks/Cvx2Ysnw.js","../chunks/CZl6dCr8.js","../chunks/BdxnjgRm.js","../chunks/1BtvFVxW.js","../chunks/DMxdENwc.js","../chunks/GKolV7NZ.js","../chunks/sS3un9eF.js","../chunks/DSj6Oh6Q.js","../chunks/Cw-uT9yH.js","../chunks/B8ILY6Yx.js","../chunks/BUEZRAAA.js","../chunks/waslJc7H.js","../chunks/CsJvZvlf.js","../chunks/S7IPX7F9.js","../chunks/m4EBn0qr.js","../chunks/VMSlSy0z.js","../chunks/L2kocmhm.js","../chunks/Cge7XzSz.js","../chunks/CLMxAYd8.js","../chunks/BYDLOXCx.js","../chunks/SoB7VCOY.js","../chunks/CLNry8mN.js","../chunks/DaZJZ7Sc.js","../chunks/DftQJGSr.js","../chunks/Bz9RVNEI.js","../chunks/DXpWG91y.js","../chunks/BaXkXUaC.js","../chunks/2HsmVb_U.js","../chunks/WWGSNPNJ.js","../chunks/BNsv6dDZ.js","../chunks/D1rQkmxF.js","../chunks/DsBxvFRy.js","../chunks/M1eNWmwK.js","../chunks/CTYPg9Si.js","../chunks/DS1UiprO.js","../chunks/DoEkxHGI.js","../chunks/CyGAOLyZ.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/B9_HOHyf.js","../chunks/B01k5fH9.js","../chunks/3IVfqyjU.js","../chunks/BJO_fRuX.js","../chunks/B8ZGwVPD.js","../chunks/DU3hr2Uj.js","../chunks/DOAJfpyz.js","../chunks/B6Hh54jn.js","../chunks/DKMbv1dP.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/DPphWBnY.js","../chunks/C9pSkFtt.js","../chunks/CWCjLqir.js","../chunks/XbRl34Xf.js","../chunks/Co9e9Hgt.js","../chunks/DIucBLDt.js","../chunks/CRZUTqP7.js","../chunks/kCTIgeNg.js","../chunks/C3wugOzS.js","../chunks/CDwEHRNn.js","../chunks/DTpa4WTm.js","../chunks/dAonUeEu.js","../chunks/ChWPnyip.js","../chunks/DomDtS5e.js","../chunks/ZVybfJ6n.js","../chunks/vY7jDOAJ.js","../chunks/DsHDw-MJ.js"])))=>i.map(i=>d[i]);
import{_ as Bn}from"../chunks/PPVm8Dsz.js";import"../chunks/DsnmJJEf.js";import{o as xn,a as _a}from"../chunks/CAI1efmj.js";import{T as lo,E as co,b8 as uo,b9 as fo,A as ho,t as vo,ba as po,bb as go,bc as mo,Z as Sa,aB as yo,C as bo,n as Qe,u as fe,g as l,ar as B,p as Me,f as $,a as Le,c as ee,r as Q,aG as ne,av as je,o as $e,U as ht,a8 as he,X as hn,b7 as xa}from"../chunks/DpGhc8Gj.js";import{p as wo,c as ae,a as E,f as oe,t as In}from"../chunks/C_cetE6d.js";import{p as Ee,i as pe,r as Lt,s as Ot,l as On}from"../chunks/3HxT6pIY.js";import{c as Te}from"../chunks/BhyMYmPD.js";import{b as Vt}from"../chunks/D0GJM8_m.js";import{b as _o,s as Et}from"../chunks/BtCwYJdv.js";import{a as Or,e as Cn,s as yi,d as rn,b as So}from"../chunks/j9TJGoIn.js";import{C as Pr,a as Tr}from"../chunks/CZWdNerY.js";import{t as Un,k as xo,l as Io,m as Co,L as ko,n as Ao,S as Mt,h as Oo,i as Po,C as Zi,j as To,I as Eo,G as ea,F as ta,b as Fo,O as Ia,a as Do,d as Ca,c as br,o as No,q as Mo,M as Lo,V as na,f as Ro,e as Vo,g as jo,r as Ho,p as zo}from"../chunks/DGg_O7Yg.js";import{s as Ze,e as Bt,i as kn}from"../chunks/Cuk_vqaR.js";import{g as Ko,e as Er}from"../chunks/BYeH81q2.js";import{c as $n,B as Tt}from"../chunks/EFWLVfE9.js";import{C as Bo,D as qo,s as Uo,v as Go,J as Wo,a as wr,K as $o}from"../chunks/CGeTtGxF.js";import{I as Pn}from"../chunks/WRl7fYg0.js";import{I as Yo}from"../chunks/D_A9SqOu.js";import{S as Jo,I as Tn,s as En,i as ui,e as Qo,h as Xo,c as Zo,d as es,f as ts,g as ns}from"../chunks/CEI5hwsx.js";import{S as rs}from"../chunks/BzPoaFnL.js";import{S as It}from"../chunks/CcyCibcD.js";import{c as is,g as as}from"../chunks/Cpj98o6Y.js";import"../chunks/Bop_QaMX.js";import{b as os}from"../chunks/D93vC3ha.js";import"../chunks/69_IOA4Y.js";import{j as ss}from"../chunks/Blum7Kcb.js";import ls from"../chunks/CBgN-qFR.js";import{s as ra}from"../chunks/BO0zSyDw.js";import{J as cs}from"../chunks/CzvYEThE.js";import{h as Gn}from"../chunks/BEbjsukk.js";import{X as us,C as ds,g as fs}from"../chunks/BcBvXr0E.js";import{h as ia}from"../chunks/tx3veOlo.js";import"../chunks/aFcgjAp9.js";import{l as hs}from"../chunks/DSPk0Ak5.js";import aa from"../chunks/Cj1iE9mV.js";import"../chunks/BoGhUpgK.js";import"../chunks/k6TpQ-vv.js";import"../chunks/D6KPPgz5.js";import"../chunks/D1rQkmxF.js";import"../chunks/DsBxvFRy.js";import"../chunks/Dv56mZ8k.js";import"../chunks/BCCr_gIb.js";import"../chunks/Dbi-wR_H.js";import{c as vs}from"../chunks/tpP2tQ0M.js";import{S as ps}from"../chunks/CY2eRvAM.js";import"../chunks/pdlPRen1.js";import{j as oa}from"../chunks/CyGAOLyZ.js";import{m as sa}from"../chunks/VnM9Pp_d.js";import{a as la,m as ca}from"../chunks/DVjOipaJ.js";import{l as _r}from"../chunks/DwAWIrQ2.js";import{C as gs}from"../chunks/Cr1MfEHd.js";import{C as ms}from"../chunks/BV2EWAWr.js";const ys=()=>performance.now(),$t={tick:S=>requestAnimationFrame(S),now:()=>ys(),tasks:new Set};function ka(){const S=$t.now();$t.tasks.forEach(t=>{t.c(S)||($t.tasks.delete(t),t.f())}),$t.tasks.size!==0&&$t.tick(ka)}function bs(S){let t;return $t.tasks.size===0&&$t.tick(ka),{promise:new Promise(a=>{$t.tasks.add(t={c:S,f:a})}),abort(){$t.tasks.delete(t)}}}function Sr(S,t){Sa(()=>{S.dispatchEvent(new CustomEvent(t))})}function ws(S){if(S==="float")return"cssFloat";if(S==="offset")return"cssOffset";if(S.startsWith("--"))return S;const t=S.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function ua(S){const t={},a=S.split(";");for(const s of a){const[u,f]=s.split(":");if(!u||f===void 0)break;const h=ws(u.trim());t[h]=f.trim()}return t}const _s=S=>S;function kr(S,t,a,s){var u=(S&go)!==0,f=(S&mo)!==0,h=u&&f,m=(S&po)!==0,P=h?"both":u?"in":"out",k,A=t.inert,F=t.style.overflow,N,j;function R(){return Sa(()=>k??=a()(t,s?.()??{},{direction:P}))}var L={is_global:m,in(){if(t.inert=A,!u){j?.abort(),j?.reset?.();return}f||N?.abort(),Sr(t,"introstart"),N=di(t,R(),j,1,()=>{Sr(t,"introend"),N?.abort(),N=k=void 0,t.style.overflow=F})},out(K){if(!f){K?.(),k=void 0;return}t.inert=!0,Sr(t,"outrostart"),j=di(t,R(),N,0,()=>{Sr(t,"outroend"),K?.()})},stop:()=>{N?.abort(),j?.abort()}},H=lo;if((H.transitions??=[]).push(L),u&&_o){var M=m;if(!M){for(var z=H.parent;z&&(z.f&co)!==0;)for(;(z=z.parent)&&(z.f&uo)===0;);M=!z||(z.f&fo)!==0}M&&ho(()=>{vo(()=>L.in())})}}function di(S,t,a,s,u){var f=s===1;if(yo(t)){var h,m=!1;return bo(()=>{if(!m){var H=t({direction:f?"in":"out"});h=di(S,H,a,s,u)}}),{abort:()=>{m=!0,h?.abort()},deactivate:()=>h.deactivate(),reset:()=>h.reset(),t:()=>h.t()}}if(a?.deactivate(),!t?.duration)return u(),{abort:Qe,deactivate:Qe,reset:Qe,t:()=>s};const{delay:P=0,css:k,tick:A,easing:F=_s}=t;var N=[];if(f&&a===void 0&&(A&&A(0,1),k)){var j=ua(k(0,1));N.push(j,j)}var R=()=>1-s,L=S.animate(N,{duration:P,fill:"forwards"});return L.onfinish=()=>{L.cancel();var H=a?.t()??1-s;a?.abort();var M=s-H,z=t.duration*Math.abs(M),K=[];if(z>0){var G=!1;if(k)for(var le=Math.ceil(z/16.666666666666668),re=0;re<=le;re+=1){var se=H+M*F(re/le),ge=ua(k(se,1-se));K.push(ge),G||=ge.overflow==="hidden"}G&&(S.style.overflow="hidden"),R=()=>{var ke=L.currentTime;return H+M*F(ke/z)},A&&bs(()=>{if(L.playState!=="running")return!1;var ke=R();return A(ke,1-ke),!0})}L=S.animate(K,{duration:z,fill:"forwards"}),L.onfinish=()=>{R=()=>s,A?.(s,1-s),u()}},{abort:()=>{L&&(L.cancel(),L.effect=null,L.onfinish=Qe)},deactivate:()=>{u=Qe},reset:()=>{s===0&&A?.(1,0)},t:()=>R()}}const Ss=Go({component:"avatar",parts:["root","image","fallback"]}),xs=new Bo("Avatar.Root");class bi{static create(t){return xs.set(new bi(t))}opts;domContext;attachment;constructor(t){this.opts=t,this.domContext=new qo(this.opts.ref),this.loadImage=this.loadImage.bind(this),this.attachment=Uo(this.opts.ref)}loadImage(t,a,s){if(this.opts.loadingStatus.current==="loaded")return;let u;const f=new Image;return f.src=t,a!==void 0&&(f.crossOrigin=a),s&&(f.referrerPolicy=s),this.opts.loadingStatus.current="loading",f.onload=()=>{u=this.domContext.setTimeout(()=>{this.opts.loadingStatus.current="loaded"},this.opts.delayMs.current)},f.onerror=()=>{this.opts.loadingStatus.current="error"},()=>{u&&this.domContext.clearTimeout(u)}}#e=fe(()=>({id:this.opts.id.current,[Ss.root]:"","data-status":this.opts.loadingStatus.current,...this.attachment}));get props(){return l(this.#e)}set props(t){B(this.#e,t)}}var Is=oe("<div><!></div>");function Cs(S,t){const a=wo();Me(t,!0);let s=Ee(t,"delayMs",3,0),u=Ee(t,"loadingStatus",15,"loading"),f=Ee(t,"id",19,()=>Wo(a)),h=Ee(t,"ref",15,null),m=Lt(t,["$$slots","$$events","$$legacy","delayMs","loadingStatus","onLoadingStatusChange","child","children","id","ref"]);const P=bi.create({delayMs:wr(()=>s()),loadingStatus:wr(()=>u(),R=>{u()!==R&&(u(R),t.onLoadingStatusChange?.(R))}),id:wr(()=>f()),ref:wr(()=>h(),R=>h(R))}),k=fe(()=>$o(m,P.props));var A=ae(),F=$(A);{var N=R=>{var L=ae(),H=$(L);Ze(H,()=>t.child,()=>({props:l(k)})),E(R,L)},j=R=>{var L=Is();Or(L,()=>({...l(k)}));var H=ee(L);Ze(H,()=>t.children??Qe),Q(L),E(R,L)};pe(F,R=>{t.child?R(N):R(j,!1)})}E(S,A),Le()}var ks=oe('<p class="text-sm font-medium"> </p>'),As=oe('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function Os(S,t){Me(t,!0);let a=ne(null),s=ne(je({x:0,y:0})),u=0;const f=k=>{B(s,{x:k.clientX,y:k.clientY},!0)};$e(()=>(document.addEventListener("mousemove",f),()=>{document.removeEventListener("mousemove",f)})),$e(()=>{const k=t.areaSelectionInteractionStore.currentHoveredArea?.id,A=++u;if(!k){B(a,null);return}(async()=>{const F=await t.areaSelectionInteractionStore.getAreaNamesById([k]);A===u&&t.areaSelectionInteractionStore.currentHoveredArea?.id===k&&B(a,F[0]??null,!0)})()});var h=ae(),m=$(h);{var P=k=>{var A=As(),F=ee(A);Te(F,()=>Tr,(N,j)=>{j(N,{class:"max-w-xs border !py-2 shadow-lg",children:(R,L)=>{var H=ae(),M=$(H);Te(M,()=>Pr,(z,K)=>{K(z,{class:"!px-3 !py-0",children:(G,le)=>{var re=ks(),se=ee(re,!0);Q(re),ht(()=>Et(se,l(a))),E(G,re)},$$slots:{default:!0}})}),E(R,H)},$$slots:{default:!0}})}),Q(A),ht(()=>Cn(A,`left: ${l(s).x+10}px; top: ${l(s).y-10}px;`)),E(k,A)};pe(m,k=>{l(a)&&k(P)})}E(S,h),Le()}function Ps(S,t){Me(t,!0);async function a(s,u){const f=await t.areaSelectionInteractionStore.getAreaNamesById([s]);if(!f||f.length===0||!f[0])return;const h=`Area ${u}: ${f[0]}`;Un.success(h)}$e(()=>{t.areaSelectionInteractionStore.lastAddedArea&&a(t.areaSelectionInteractionStore.lastAddedArea.id,"added")}),$e(()=>{t.areaSelectionInteractionStore.lastRemovedArea&&a(t.areaSelectionInteractionStore.lastRemovedArea.id,"removed")}),Le()}var Ts=oe("<div><!></div>");function da(S,t){Me(t,!0);let a=Ee(t,"ref",15,null),s=Lt(t,["$$slots","$$events","$$legacy","ref","variant","children"]);var u=Ts();Or(u,()=>({...s,class:"group/chat-bubble flex max-w-[80%] flex-row place-items-end gap-2 data-[variant='sent']:place-self-end","data-variant":t.variant}));var f=ee(u);Ze(f,()=>t.children??Qe),Q(u),Vt(u,h=>a(h),()=>a()),E(S,u),Le()}var Es=oe('<span class="inline-block size-(--loading-dots-size) rounded-full bg-primary svelte-k2x6sv"></span>'),Fs=oe('<div class="inline-flex items-center gap-1 svelte-k2x6sv"></div>');function Ds(S,t){let a=Ee(t,"size",3,4);var s=Fs();let u;Bt(s,20,()=>({length:3}),kn,(f,h)=>{var m=Es();E(f,m)}),Q(s),ht(f=>u=Cn(s,"",u,f),[()=>({"--loading-dots-size":`${a()??""}px`})]),E(S,s)}var Ns=oe('<div class="flex size-full place-items-center justify-center"><!></div>'),Ms=oe("<div><!></div>");function ci(S,t){Me(t,!0);let a=Ee(t,"ref",15,null),s=Ee(t,"typing",3,!1),u=Lt(t,["$$slots","$$events","$$legacy","ref","typing","class","children"]);var f=Ms();Or(f,k=>({...u,class:k}),[()=>$n("order-2 rounded-lg bg-secondary p-4 text-sm group-data-[variant='received']/chat-bubble:rounded-bl-none group-data-[variant='sent']/chat-bubble:order-1 group-data-[variant='sent']/chat-bubble:rounded-br-none group-data-[variant='sent']/chat-bubble:bg-primary group-data-[variant='sent']/chat-bubble:text-primary-foreground",t.class)]);var h=ee(f);{var m=k=>{var A=Ns(),F=ee(A);Ds(F,{}),Q(A),E(k,A)},P=k=>{var A=ae(),F=$(A);Ze(F,()=>t.children??Qe),E(k,A)};pe(h,k=>{s()?k(m):k(P,!1)})}Q(f),Vt(f,k=>a(k),()=>a()),E(S,f),Le()}function Ls(S,t){Me(t,!0);let a=Ee(t,"ref",15,null),s=Lt(t,["$$slots","$$events","$$legacy","ref","class"]);var u=ae(),f=$(u);{let h=fe(()=>$n("relative flex size-8 shrink-0 overflow-hidden rounded-full",t.class));Te(f,()=>Cs,(m,P)=>{P(m,Ot({"data-slot":"avatar",get class(){return l(h)}},()=>s,{get ref(){return a()},set ref(k){a(k)}}))})}E(S,u),Le()}function fa(S,t){Me(t,!0);let a=Ee(t,"ref",15,null),s=Lt(t,["$$slots","$$events","$$legacy","ref","class"]);{let u=fe(()=>$n("order-1 group-data-[variant='sent']/chat-bubble:order-2",t.class));Ls(S,Ot({get class(){return l(u)}},()=>s,{get ref(){return a()},set ref(f){a(f)}}))}Le()}function Rs(S,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Lt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];Pn(S,Ot({name:"arrow-down"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);Ze(m,()=>t.children??Qe),E(u,h)},$$slots:{default:!0}})),Le()}function Aa(S){const t=S-1;return t*t*t+1}function ha(S,{delay:t=0,duration:a=400,easing:s=Aa,axis:u="y"}={}){const f=getComputedStyle(S),h=+f.opacity,m=u==="y"?"height":"width",P=parseFloat(f[m]),k=u==="y"?["top","bottom"]:["left","right"],A=k.map(M=>`${M[0].toUpperCase()}${M.slice(1)}`),F=parseFloat(f[`padding${A[0]}`]),N=parseFloat(f[`padding${A[1]}`]),j=parseFloat(f[`margin${A[0]}`]),R=parseFloat(f[`margin${A[1]}`]),L=parseFloat(f[`border${A[0]}Width`]),H=parseFloat(f[`border${A[1]}Width`]);return{delay:t,duration:a,easing:s,css:M=>`overflow: hidden;opacity: ${Math.min(M*20,1)*h};${m}: ${M*P}px;padding-${k[0]}: ${M*F}px;padding-${k[1]}: ${M*N}px;margin-${k[0]}: ${M*j}px;margin-${k[1]}: ${M*R}px;border-${k[0]}-width: ${M*L}px;border-${k[1]}-width: ${M*H}px;min-${m}: 0`}}function va(S,{delay:t=0,duration:a=400,easing:s=Aa,start:u=0,opacity:f=0}={}){const h=getComputedStyle(S),m=+h.opacity,P=h.transform==="none"?"":h.transform,k=1-u,A=m*(1-f);return{delay:t,duration:a,easing:s,css:(F,N)=>`
			transform: ${P} scale(${1-k*N});
			opacity: ${m-A*N}
		`}}class Vs{#e=ne();#t=ne(0);#n=ne(!1);lastScrollHeight=0;set ref(t){if(B(this.#e,t,!0),!l(this.#e))return;this.lastScrollHeight=l(this.#e).scrollHeight,l(this.#e).scrollTo(0,l(this.#t)?l(this.#t):l(this.#e).scrollHeight),l(this.#e).addEventListener("scroll",()=>{l(this.#e)&&(B(this.#t,l(this.#e).scrollTop,!0),this.disableAutoScroll())}),window.addEventListener("resize",()=>{this.scrollToBottom(!0)}),new MutationObserver(()=>{l(this.#e)&&(l(this.#e).scrollHeight!==this.lastScrollHeight&&this.scrollToBottom(!0),this.lastScrollHeight=l(this.#e).scrollHeight)}).observe(l(this.#e),{childList:!0,subtree:!0})}get ref(){return l(this.#e)}get scrollY(){return l(this.#t)}get isAtBottom(){return l(this.#e)?l(this.#t)+l(this.#e).offsetHeight>=l(this.#e).scrollHeight:!0}disableAutoScroll(){this.isAtBottom?B(this.#n,!1):B(this.#n,!0)}scrollToBottom(t=!1){l(this.#e)&&(t&&l(this.#n)||l(this.#e).scrollTo(0,l(this.#e).scrollHeight))}}var js=oe("<div><!></div>"),Hs=oe('<div class="relative"><div><!></div> <!></div>');function zs(S,t){Me(t,!0);let a=Ee(t,"ref",15,null),s=Lt(t,["$$slots","$$events","$$legacy","ref","children","class"]),u=ne(!1);const f=new Vs;xn(()=>{B(u,!0)});var h=Hs(),m=ee(h);Or(m,F=>({...s,class:F}),[()=>$n("no-scrollbar flex h-full w-full flex-col gap-4 overflow-y-auto p-4",t.class,{"scroll-smooth":l(u)})]);var P=ee(m);Ze(P,()=>t.children??Qe),Q(m),Vt(m,F=>a(F),()=>a()),Vt(m,F=>f.ref=F,()=>f?.ref);var k=he(m,2);{var A=F=>{var N=js(),j=ee(N);Tt(j,{onclick:()=>f.scrollToBottom(),variant:"outline",size:"icon",class:"absolute bottom-2 left-1/2 inline-flex -translate-x-1/2 transform rounded-full shadow-md",children:(R,L)=>{Rs(R,{})},$$slots:{default:!0}}),Q(N),kr(1,N,()=>va,()=>({start:.85,duration:100,delay:250})),kr(2,N,()=>va,()=>({start:.85,duration:100})),E(F,N)};pe(k,F=>{f.isAtBottom||F(A)})}Q(h),E(S,h),Le()}function Ks(S,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Lt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];Pn(S,Ot({name:"send"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);Ze(m,()=>t.children??Qe),E(u,h)},$$slots:{default:!0}})),Le()}var Bs=oe(`<p class="break-words whitespace-pre-wrap"> </p> <div class="w-full text-xs group-data-[variant='sent']/chat-bubble:text-end"> </div>`,1),qs=oe("<!> <!>",1),Us=oe('<p class="break-words whitespace-pre-wrap"> </p>'),Gs=oe("<!> <!>",1),Ws=oe("<!> <!>",1),$s=oe('<div class="chat-container h-full w-full border border-border svelte-1osgd7m"><div class="message-wrapper svelte-1osgd7m"><!></div> <div class="input-wrapper svelte-1osgd7m"><form class="flex shrink-0 items-center gap-2 border-t border-border bg-background p-2"><!> <!></form></div></div>');function Ys(S,t){Me(t,!0);const a=1,s=2,u="Sorry, I encountered an error processing your request.",f="How can I help?";let h=ne(""),m=ne(!1),P=ne(""),k=ne(null),A=ne(null),F=ne(null);const N=je([{senderId:a,message:f,sentAt:j(new Date)}]);$e(()=>{if(l(A)&&l(F)){const de=l(A),be=l(F),Ie=()=>{const Fe=de.offsetHeight;be.style.paddingBottom=`${Fe}px`};Ie();const Se=new ResizeObserver(Ie);return Se.observe(de),()=>{Se.disconnect()}}}),$e(()=>{N.length,l(P),l(k)&&setTimeout(()=>{const de=l(k)?.querySelector('[data-slot="scroll-area-viewport"]');de&&(de.scrollTop=de.scrollHeight)},0)});function j(de){const be=de.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Ie=de.getHours()>=12?"PM":"AM";return`${be} ${Ie}`}function R(de,be){return{message:de,senderId:be,sentAt:j(new Date)}}function L(de,be){N.push(R(de,be))}function H(){B(m,!1),B(P,"")}function M(de){B(P,l(P)+de)}async function z(de){if(de.preventDefault(),!l(h).trim()||l(m))return;const be=l(h).trim();B(h,""),L(be,s),B(m,!0),B(P,"");try{await t.aiUprnChatbotService.chatStream(be,M)&&l(P)?L(l(P),a):L(u,a)}catch(Ie){console.error("Chat error:",Ie),L(u,a)}finally{H()}}var K=$s(),G=ee(K),le=ee(G);Jo(le,{class:"h-full w-full",get ref(){return l(k)},set ref(de){B(k,de,!0)},children:(de,be)=>{var Ie=ae(),Se=$(Ie);Te(Se,()=>zs,(Fe,He)=>{He(Fe,{children:(Xe,we)=>{var Re=Ws(),ye=$(Re);Bt(ye,16,()=>N,at=>at,(at,ve)=>{var Ke=ae(),tt=$(Ke);{let Pe=fe(()=>ve.senderId===s?"sent":"received");Te(tt,()=>da,(ce,De)=>{De(ce,{get variant(){return l(Pe)},children:(W,ot)=>{var qe=qs(),me=$(qe);Te(me,()=>fa,(ut,Ue)=>{Ue(ut,{})});var Be=he(me,2);Te(Be,()=>ci,(ut,Ue)=>{Ue(ut,{class:"flex flex-col gap-1",children:(vt,pt)=>{var Ge=Bs(),nt=$(Ge),Ye=ee(nt,!0);Q(nt);var We=he(nt,2),gt=ee(We,!0);Q(We),ht(()=>{Et(Ye,ve.message),Et(gt,ve.sentAt)}),E(vt,Ge)},$$slots:{default:!0}})}),E(W,qe)},$$slots:{default:!0}})})}E(at,Ke)});var Oe=he(ye,2);{var et=at=>{var ve=ae(),Ke=$(ve);Te(Ke,()=>da,(tt,Pe)=>{Pe(tt,{variant:"received",children:(ce,De)=>{var W=Gs(),ot=$(W);Te(ot,()=>fa,(me,Be)=>{Be(me,{})});var qe=he(ot,2);Te(qe,()=>ci,(me,Be)=>{Be(me,{class:"flex flex-col gap-1",children:(ut,Ue)=>{var vt=ae(),pt=$(vt);{var Ge=Ye=>{var We=Us(),gt=ee(We,!0);Q(We),ht(()=>Et(gt,l(P))),E(Ye,We)},nt=Ye=>{var We=ae(),gt=$(We);Te(gt,()=>ci,(Ct,Pt)=>{Pt(Ct,{typing:!0})}),E(Ye,We)};pe(pt,Ye=>{l(P)?Ye(Ge):Ye(nt,!1)})}E(ut,vt)},$$slots:{default:!0}})}),E(ce,W)},$$slots:{default:!0}})}),E(at,ve)};pe(Oe,at=>{l(m)&&at(et)})}E(Xe,Re)},$$slots:{default:!0}})}),E(de,Ie)},$$slots:{default:!0}}),Q(G),Vt(G,de=>B(F,de),()=>l(F));var re=he(G,2),se=ee(re),ge=ee(se);Yo(ge,{class:"rounded-full",placeholder:"Type a message...",get disabled(){return l(m)},get value(){return l(h)},set value(de){B(h,de,!0)}});var ke=he(ge,2);{let de=fe(()=>l(h).trim()===""||l(m));Tt(ke,{type:"submit",variant:"default",size:"icon",class:"shrink-0 rounded-full",get disabled(){return l(de)},children:(be,Ie)=>{Ks(be,{})},$$slots:{default:!0}})}Q(se),Vt(se,de=>B(A,de),()=>l(A)),Q(re),Q(K),Ko("submit",se,z),E(S,K),Le()}const tn=Object.freeze({Pending:"pending",InProgress:"in-progress",Completed:"completed",Failed:"failed"}),xr=Object.freeze({Submitted:"SUBMITTED",Queued:"QUEUED",Processing:"IN_PROGRESS",Completed:"COMPLETED",Error:"ERROR"}),Js=Object.freeze({Success:"success",Error:"error"});var Cr={exports:{}},Qs=Cr.exports,pa;function Xs(){return pa||(pa=1,(function(S,t){(function(a,s){S.exports=s()})(Qs,function(){var a=function(e,n){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(e,n)},s=function(){return(s=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function u(e,n,r){for(var i,o=0,c=n.length;o<c;o++)!i&&o in n||((i=i||Array.prototype.slice.call(n,0,o))[o]=n[o]);return e.concat(i||Array.prototype.slice.call(n))}var f=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:is,h=Object.keys,m=Array.isArray;function P(e,n){return typeof n!="object"||h(n).forEach(function(r){e[r]=n[r]}),e}typeof Promise>"u"||f.Promise||(f.Promise=Promise);var k=Object.getPrototypeOf,A={}.hasOwnProperty;function F(e,n){return A.call(e,n)}function N(e,n){typeof n=="function"&&(n=n(k(e))),(typeof Reflect>"u"?h:Reflect.ownKeys)(n).forEach(function(r){R(e,r,n[r])})}var j=Object.defineProperty;function R(e,n,r,i){j(e,n,P(r&&F(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},i))}function L(e){return{from:function(n){return e.prototype=Object.create(n.prototype),R(e.prototype,"constructor",e),{extend:N.bind(null,e.prototype)}}}}var H=Object.getOwnPropertyDescriptor,M=[].slice;function z(e,n,r){return M.call(e,n,r)}function K(e,n){return n(e)}function G(e){if(!e)throw new Error("Assertion Failed")}function le(e){f.setImmediate?setImmediate(e):setTimeout(e,0)}function re(e,n){if(typeof n=="string"&&F(e,n))return e[n];if(!n)return e;if(typeof n!="string"){for(var r=[],i=0,o=n.length;i<o;++i){var c=re(e,n[i]);r.push(c)}return r}var d=n.indexOf(".");if(d!==-1){var v=e[n.substr(0,d)];return v==null?void 0:re(v,n.substr(d+1))}}function se(e,n,r){if(e&&n!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof n!="string"&&"length"in n){G(typeof r!="string"&&"length"in r);for(var i=0,o=n.length;i<o;++i)se(e,n[i],r[i])}else{var c,d,v=n.indexOf(".");v!==-1?(c=n.substr(0,v),(d=n.substr(v+1))===""?r===void 0?m(e)&&!isNaN(parseInt(c))?e.splice(c,1):delete e[c]:e[c]=r:se(v=!(v=e[c])||!F(e,c)?e[c]={}:v,d,r)):r===void 0?m(e)&&!isNaN(parseInt(n))?e.splice(n,1):delete e[n]:e[n]=r}}function ge(e){var n,r={};for(n in e)F(e,n)&&(r[n]=e[n]);return r}var ke=[].concat;function de(e){return ke.apply([],e)}var st="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(de([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(n){return n+e+"Array"})}))).filter(function(e){return f[e]}),be=new Set(st.map(function(e){return f[e]})),Ie=null;function Se(e){return Ie=new WeakMap,e=(function n(r){if(!r||typeof r!="object")return r;var i=Ie.get(r);if(i)return i;if(m(r)){i=[],Ie.set(r,i);for(var o=0,c=r.length;o<c;++o)i.push(n(r[o]))}else if(be.has(r.constructor))i=r;else{var d,v=k(r);for(d in i=v===Object.prototype?{}:Object.create(v),Ie.set(r,i),r)F(r,d)&&(i[d]=n(r[d]))}return i})(e),Ie=null,e}var Fe={}.toString;function He(e){return Fe.call(e).slice(8,-1)}var Xe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",we=typeof Xe=="symbol"?function(e){var n;return e!=null&&(n=e[Xe])&&n.apply(e)}:function(){return null};function Re(e,n){return n=e.indexOf(n),0<=n&&e.splice(n,1),0<=n}var ye={};function Oe(e){var n,r,i,o;if(arguments.length===1){if(m(e))return e.slice();if(this===ye&&typeof e=="string")return[e];if(o=we(e)){for(r=[];!(i=o.next()).done;)r.push(i.value);return r}if(e==null)return[e];if(typeof(n=e.length)!="number")return[e];for(r=new Array(n);n--;)r[n]=e[n];return r}for(n=arguments.length,r=new Array(n);n--;)r[n]=arguments[n];return r}var et=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},jt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Rt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(jt),at={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ve(e,n){this.name=e,this.message=n}function Ke(e,n){return e+". Errors: "+Object.keys(n).map(function(r){return n[r].toString()}).filter(function(r,i,o){return o.indexOf(r)===i}).join(`
`)}function tt(e,n,r,i){this.failures=n,this.failedKeys=i,this.successCount=r,this.message=Ke(e,n)}function Pe(e,n){this.name="BulkError",this.failures=Object.keys(n).map(function(r){return n[r]}),this.failuresByPos=n,this.message=Ke(e,this.failures)}L(ve).from(Error).extend({toString:function(){return this.name+": "+this.message}}),L(tt).from(ve),L(Pe).from(ve);var ce=Rt.reduce(function(e,n){return e[n]=n+"Error",e},{}),De=ve,W=Rt.reduce(function(e,n){var r=n+"Error";function i(o,c){this.name=r,o?typeof o=="string"?(this.message="".concat(o).concat(c?`
 `+c:""),this.inner=c||null):typeof o=="object"&&(this.message="".concat(o.name," ").concat(o.message),this.inner=o):(this.message=at[n]||r,this.inner=null)}return L(i).from(De),e[n]=i,e},{});W.Syntax=SyntaxError,W.Type=TypeError,W.Range=RangeError;var ot=jt.reduce(function(e,n){return e[n+"Error"]=W[n],e},{}),qe=Rt.reduce(function(e,n){return["Syntax","Type","Range"].indexOf(n)===-1&&(e[n+"Error"]=W[n]),e},{});function me(){}function Be(e){return e}function ut(e,n){return e==null||e===Be?n:function(r){return n(e(r))}}function Ue(e,n){return function(){e.apply(this,arguments),n.apply(this,arguments)}}function vt(e,n){return e===me?n:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var c=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ue(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Ue(o,this.onerror):o),c!==void 0?c:r}}function pt(e,n){return e===me?n:function(){e.apply(this,arguments);var r=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Ue(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Ue(i,this.onerror):i)}}function Ge(e,n){return e===me?n:function(r){var i=e.apply(this,arguments);P(r,i);var o=this.onsuccess,c=this.onerror;return this.onsuccess=null,this.onerror=null,r=n.apply(this,arguments),o&&(this.onsuccess=this.onsuccess?Ue(o,this.onsuccess):o),c&&(this.onerror=this.onerror?Ue(c,this.onerror):c),i===void 0?r===void 0?void 0:r:P(i,r)}}function nt(e,n){return e===me?n:function(){return n.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Ye(e,n){return e===me?n:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var i=this,o=arguments.length,c=new Array(o);o--;)c[o]=arguments[o];return r.then(function(){return n.apply(i,c)})}return n.apply(this,arguments)}}qe.ModifyError=tt,qe.DexieError=ve,qe.BulkError=Pe;var We=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function gt(e){We=e}var Ct={},Pt=100,st=typeof Promise>"u"?[]:(function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,k(e),e];var n=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[n,k(n),e]})(),jt=st[0],Rt=st[1],st=st[2],Rt=Rt&&Rt.then,mt=jt&&jt.constructor,kt=!!st,ct=function(e,n){Fn.push([e,n]),Ht&&(queueMicrotask(Va),Ht=!1)},yt=!0,Ht=!0,qt=[],vn=[],Ut=Be,Ft={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:me,pgp:!1,env:{},finalize:me},ue=Ft,Fn=[],on=0,Yn=[];function te(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var n=this._PSD=ue;if(typeof e!="function"){if(e!==Ct)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Dr(this,this._value))}this._state=null,this._value=null,++n.ref,(function r(i,o){try{o(function(c){if(i._state===null){if(c===i)throw new TypeError("A promise cannot be resolved with itself.");var d=i._lib&&pn();c&&typeof c.then=="function"?r(i,function(v,g){c instanceof te?c._then(v,g):c.then(v,g)}):(i._state=!0,i._value=c,_i(i)),d&&gn()}},Dr.bind(null,i))}catch(c){Dr(i,c)}})(this,e)}var Fr={get:function(){var e=ue,n=Zn;function r(i,o){var c=this,d=!e.global&&(e!==ue||n!==Zn),v=d&&!Jt(),g=new te(function(y,x){Nr(c,new wi(xi(i,e,d,v),xi(o,e,d,v),y,x,e))});return this._consoleTask&&(g._consoleTask=this._consoleTask),g}return r.prototype=Ct,r},set:function(e){R(this,"then",e&&e.prototype===Ct?Fr:{get:function(){return e},set:Fr.set})}};function wi(e,n,r,i,o){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof n=="function"?n:null,this.resolve=r,this.reject=i,this.psd=o}function Dr(e,n){var r,i;vn.push(n),e._state===null&&(r=e._lib&&pn(),n=Ut(n),e._state=!1,e._value=n,i=e,qt.some(function(o){return o._value===i._value})||qt.push(i),_i(e),r&&gn())}function _i(e){var n=e._listeners;e._listeners=[];for(var r=0,i=n.length;r<i;++r)Nr(e,n[r]);var o=e._PSD;--o.ref||o.finalize(),on===0&&(++on,ct(function(){--on==0&&Mr()},[]))}function Nr(e,n){if(e._state!==null){var r=e._state?n.onFulfilled:n.onRejected;if(r===null)return(e._state?n.resolve:n.reject)(e._value);++n.psd.ref,++on,ct(Ra,[r,e,n])}else e._listeners.push(n)}function Ra(e,n,r){try{var i,o=n._value;!n._state&&vn.length&&(vn=[]),i=We&&n._consoleTask?n._consoleTask.run(function(){return e(o)}):e(o),n._state||vn.indexOf(o)!==-1||(function(c){for(var d=qt.length;d;)if(qt[--d]._value===c._value)return qt.splice(d,1)})(n),r.resolve(i)}catch(c){r.reject(c)}finally{--on==0&&Mr(),--r.psd.ref||r.psd.finalize()}}function Va(){sn(Ft,function(){pn()&&gn()})}function pn(){var e=yt;return Ht=yt=!1,e}function gn(){var e,n,r;do for(;0<Fn.length;)for(e=Fn,Fn=[],r=e.length,n=0;n<r;++n){var i=e[n];i[0].apply(null,i[1])}while(0<Fn.length);Ht=yt=!0}function Mr(){var e=qt;qt=[],e.forEach(function(i){i._PSD.onunhandled.call(null,i._value,i)});for(var n=Yn.slice(0),r=n.length;r;)n[--r]()}function Jn(e){return new te(Ct,!1,e)}function rt(e,n){var r=ue;return function(){var i=pn(),o=ue;try{return Qt(r,!0),e.apply(this,arguments)}catch(c){n&&n(c)}finally{Qt(o,!1),i&&gn()}}}N(te.prototype,{then:Fr,_then:function(e,n){Nr(this,new wi(null,null,e,n,ue))},catch:function(e){if(arguments.length===1)return this.then(null,e);var n=e,r=arguments[1];return typeof n=="function"?this.then(null,function(i){return(i instanceof n?r:Jn)(i)}):this.then(null,function(i){return(i&&i.name===n?r:Jn)(i)})},finally:function(e){return this.then(function(n){return te.resolve(e()).then(function(){return n})},function(n){return te.resolve(e()).then(function(){return Jn(n)})})},timeout:function(e,n){var r=this;return e<1/0?new te(function(i,o){var c=setTimeout(function(){return o(new W.Timeout(n))},e);r.then(i,o).finally(clearTimeout.bind(null,c))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&R(te.prototype,Symbol.toStringTag,"Dexie.Promise"),Ft.env=Si(),N(te,{all:function(){var e=Oe.apply(null,arguments).map(er);return new te(function(n,r){e.length===0&&n([]);var i=e.length;e.forEach(function(o,c){return te.resolve(o).then(function(d){e[c]=d,--i||n(e)},r)})})},resolve:function(e){return e instanceof te?e:e&&typeof e.then=="function"?new te(function(n,r){e.then(n,r)}):new te(Ct,!0,e)},reject:Jn,race:function(){var e=Oe.apply(null,arguments).map(er);return new te(function(n,r){e.map(function(i){return te.resolve(i).then(n,r)})})},PSD:{get:function(){return ue},set:function(e){return ue=e}},totalEchoes:{get:function(){return Zn}},newPSD:Yt,usePSD:sn,scheduler:{get:function(){return ct},set:function(e){ct=e}},rejectionMapper:{get:function(){return Ut},set:function(e){Ut=e}},follow:function(e,n){return new te(function(r,i){return Yt(function(o,c){var d=ue;d.unhandleds=[],d.onunhandled=c,d.finalize=Ue(function(){var v,g=this;v=function(){g.unhandleds.length===0?o():c(g.unhandleds[0])},Yn.push(function y(){v(),Yn.splice(Yn.indexOf(y),1)}),++on,ct(function(){--on==0&&Mr()},[])},d.finalize),e()},n,r,i)})}}),mt&&(mt.allSettled&&R(te,"allSettled",function(){var e=Oe.apply(null,arguments).map(er);return new te(function(n){e.length===0&&n([]);var r=e.length,i=new Array(r);e.forEach(function(o,c){return te.resolve(o).then(function(d){return i[c]={status:"fulfilled",value:d}},function(d){return i[c]={status:"rejected",reason:d}}).then(function(){return--r||n(i)})})})}),mt.any&&typeof AggregateError<"u"&&R(te,"any",function(){var e=Oe.apply(null,arguments).map(er);return new te(function(n,r){e.length===0&&r(new AggregateError([]));var i=e.length,o=new Array(i);e.forEach(function(c,d){return te.resolve(c).then(function(v){return n(v)},function(v){o[d]=v,--i||r(new AggregateError(o))})})})}),mt.withResolvers&&(te.withResolvers=mt.withResolvers));var bt={awaits:0,echoes:0,id:0},ja=0,Qn=[],Xn=0,Zn=0,Ha=0;function Yt(e,n,r,i){var o=ue,c=Object.create(o);return c.parent=o,c.ref=0,c.global=!1,c.id=++Ha,Ft.env,c.env=kt?{Promise:te,PromiseProp:{value:te,configurable:!0,writable:!0},all:te.all,race:te.race,allSettled:te.allSettled,any:te.any,resolve:te.resolve,reject:te.reject}:{},n&&P(c,n),++o.ref,c.finalize=function(){--this.parent.ref||this.parent.finalize()},i=sn(c,e,r,i),c.ref===0&&c.finalize(),i}function mn(){return bt.id||(bt.id=++ja),++bt.awaits,bt.echoes+=Pt,bt.id}function Jt(){return!!bt.awaits&&(--bt.awaits==0&&(bt.id=0),bt.echoes=bt.awaits*Pt,!0)}function er(e){return bt.echoes&&e&&e.constructor===mt?(mn(),e.then(function(n){return Jt(),n},function(n){return Jt(),dt(n)})):e}function za(){var e=Qn[Qn.length-1];Qn.pop(),Qt(e,!1)}function Qt(e,n){var r,i=ue;(n?!bt.echoes||Xn++&&e===ue:!Xn||--Xn&&e===ue)||queueMicrotask(n?(function(o){++Zn,bt.echoes&&--bt.echoes!=0||(bt.echoes=bt.awaits=bt.id=0),Qn.push(ue),Qt(o,!0)}).bind(null,e):za),e!==ue&&(ue=e,i===Ft&&(Ft.env=Si()),kt&&(r=Ft.env.Promise,n=e.env,(i.global||e.global)&&(Object.defineProperty(f,"Promise",n.PromiseProp),r.all=n.all,r.race=n.race,r.resolve=n.resolve,r.reject=n.reject,n.allSettled&&(r.allSettled=n.allSettled),n.any&&(r.any=n.any))))}function Si(){var e=f.Promise;return kt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(f,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function sn(e,n,r,i,o){var c=ue;try{return Qt(e,!0),n(r,i,o)}finally{Qt(c,!1)}}function xi(e,n,r,i){return typeof e!="function"?e:function(){var o=ue;r&&mn(),Qt(n,!0);try{return e.apply(this,arguments)}finally{Qt(o,!1),i&&queueMicrotask(Jt)}}}function Lr(e){Promise===mt&&bt.echoes===0?Xn===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Rt).indexOf("[native code]")===-1&&(mn=Jt=me);var dt=te.reject,ln="ï¿¿",Gt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ii="String expected.",yn=[],tr="__dbnames",Rr="readonly",Vr="readwrite";function cn(e,n){return e?n?function(){return e.apply(this,arguments)&&n.apply(this,arguments)}:e:n}var Ci={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function nr(e){return typeof e!="string"||/\./.test(e)?function(n){return n}:function(n){return n[e]===void 0&&e in n&&delete(n=Se(n))[e],n}}function ki(){throw W.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Ne(e,n){try{var r=Ai(e),i=Ai(n);if(r!==i)return r==="Array"?1:i==="Array"?-1:r==="binary"?1:i==="binary"?-1:r==="string"?1:i==="string"?-1:r==="Date"?1:i!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return n<e?1:e<n?-1:0;case"binary":return(function(o,c){for(var d=o.length,v=c.length,g=d<v?d:v,y=0;y<g;++y)if(o[y]!==c[y])return o[y]<c[y]?-1:1;return d===v?0:d<v?-1:1})(Oi(e),Oi(n));case"Array":return(function(o,c){for(var d=o.length,v=c.length,g=d<v?d:v,y=0;y<g;++y){var x=Ne(o[y],c[y]);if(x!==0)return x}return d===v?0:d<v?-1:1})(e,n)}}catch{}return NaN}function Ai(e){var n=typeof e;return n!="object"?n:ArrayBuffer.isView(e)?"binary":(e=He(e),e==="ArrayBuffer"?"binary":e)}function Oi(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function rr(e,n,r){var i=e.schema.yProps;return i?(n&&0<r.numFailures&&(n=n.filter(function(o,c){return!r.failures[c]})),Promise.all(i.map(function(o){return o=o.updatesTable,n?e.db.table(o).where("k").anyOf(n).delete():e.db.table(o).clear()})).then(function(){return r})):r}var Dn=(Pi.prototype.execute=function(e){var n=this["@@propmod"];if(n.add!==void 0){var r=n.add;if(m(r))return u(u([],m(e)?e:[],!0),r).sort();if(typeof r=="number")return(Number(e)||0)+r;if(typeof r=="bigint")try{return BigInt(e)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(n.remove!==void 0){var i=n.remove;if(m(i))return m(e)?e.filter(function(o){return!i.includes(o)}).sort():[];if(typeof i=="number")return Number(e)-i;if(typeof i=="bigint")try{return BigInt(e)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}return r=(r=n.replacePrefix)===null||r===void 0?void 0:r[0],r&&typeof e=="string"&&e.startsWith(r)?n.replacePrefix[1]+e.substring(r.length):e},Pi);function Pi(e){this["@@propmod"]=e}function Ti(e,n){for(var r=h(n),i=r.length,o=!1,c=0;c<i;++c){var d=r[c],v=n[d],g=re(e,d);v instanceof Dn?(se(e,d,v.execute(g)),o=!0):g!==v&&(se(e,d,v),o=!0)}return o}var Ei=(Je.prototype._trans=function(e,n,r){var i=this._tx||ue.trans,o=this.name,c=We&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function d(y,x,p){if(!p.schema[o])throw new W.NotFound("Table "+o+" not part of transaction");return n(p.idbtrans,p)}var v=pn();try{var g=i&&i.db._novip===this.db._novip?i===ue.trans?i._promise(e,d,r):Yt(function(){return i._promise(e,d,r)},{trans:i,transless:ue.transless||ue}):(function y(x,p,C,b){if(x.idbdb&&(x._state.openComplete||ue.letThrough||x._vip)){var w=x._createTransaction(p,C,x._dbSchema);try{w.create(),x._state.PR1398_maxLoop=3}catch(_){return _.name===ce.InvalidState&&x.isOpen()&&0<--x._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),x.close({disableAutoOpen:!1}),x.open().then(function(){return y(x,p,C,b)})):dt(_)}return w._promise(p,function(_,I){return Yt(function(){return ue.trans=w,b(_,I,w)})}).then(function(_){if(p==="readwrite")try{w.idbtrans.commit()}catch{}return p==="readonly"?_:w._completion.then(function(){return _})})}if(x._state.openComplete)return dt(new W.DatabaseClosed(x._state.dbOpenError));if(!x._state.isBeingOpened){if(!x._state.autoOpen)return dt(new W.DatabaseClosed);x.open().catch(me)}return x._state.dbReadyPromise.then(function(){return y(x,p,C,b)})})(this.db,e,[this.name],d);return c&&(g._consoleTask=c,g=g.catch(function(y){return console.trace(y),dt(y)})),g}finally{v&&gn()}},Je.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):e==null?dt(new W.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(o){return r.hook.reading.fire(o)})}).then(n)},Je.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(m(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var n=h(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(v){if(v.compound&&n.every(function(y){return 0<=v.keyPath.indexOf(y)})){for(var g=0;g<n.length;++g)if(n.indexOf(v.keyPath[g])===-1)return!1;return!0}return!1}).sort(function(v,g){return v.keyPath.length-g.keyPath.length})[0];if(r&&this.db._maxKey!==ln){var c=r.keyPath.slice(0,n.length);return this.where(c).equals(c.map(function(g){return e[g]}))}!r&&We&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(n.join("+"),"]"));var i=this.schema.idxByName;function o(v,g){return Ne(v,g)===0}var d=n.reduce(function(p,g){var y=p[0],x=p[1],p=i[g],C=e[g];return[y||p,y||!p?cn(x,p&&p.multi?function(b){return b=re(b,g),m(b)&&b.some(function(w){return o(C,w)})}:function(b){return o(C,re(b,g))}):x]},[null,null]),c=d[0],d=d[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(d):r?this.filter(d):this.where(n).equals("")},Je.prototype.filter=function(e){return this.toCollection().and(e)},Je.prototype.count=function(e){return this.toCollection().count(e)},Je.prototype.offset=function(e){return this.toCollection().offset(e)},Je.prototype.limit=function(e){return this.toCollection().limit(e)},Je.prototype.each=function(e){return this.toCollection().each(e)},Je.prototype.toArray=function(e){return this.toCollection().toArray(e)},Je.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Je.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,m(e)?"[".concat(e.join("+"),"]"):e))},Je.prototype.reverse=function(){return this.toCollection().reverse()},Je.prototype.mapToClass=function(e){var n,r=this.db,i=this.name;function o(){return n!==null&&n.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof ki&&((function(g,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function x(){this.constructor=g}a(g,y),g.prototype=y===null?Object.create(y):(x.prototype=y.prototype,new x)})(o,n=e),Object.defineProperty(o.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),o.prototype.table=function(){return i},e=o);for(var c=new Set,d=e.prototype;d;d=k(d))Object.getOwnPropertyNames(d).forEach(function(g){return c.add(g)});function v(g){if(!g)return g;var y,x=Object.create(e.prototype);for(y in g)if(!c.has(y))try{x[y]=g[y]}catch{}return x}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),e},Je.prototype.defineClass=function(){return this.mapToClass(function(e){P(this,e)})},Je.prototype.add=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,c=i.keyPath,d=e;return c&&o&&(d=nr(c)(e)),this._trans("readwrite",function(v){return r.core.mutate({trans:v,type:"add",keys:n!=null?[n]:null,values:[d]})}).then(function(v){return v.numFailures?te.reject(v.failures[0]):v.lastResult}).then(function(v){if(c)try{se(e,c,v)}catch{}return v})},Je.prototype.upsert=function(e,n){var r=this,i=this.schema.primKey.keyPath;return this._trans("readwrite",function(o){return r.core.get({trans:o,key:e}).then(function(c){var d=c??{};return Ti(d,n),i&&se(d,i,e),r.core.mutate({trans:o,type:"put",values:[d],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[n]}}).then(function(v){return v.numFailures?te.reject(v.failures[0]):!!c})})})},Je.prototype.update=function(e,n){return typeof e!="object"||m(e)?this.where(":id").equals(e).modify(n):(e=re(e,this.schema.primKey.keyPath),e===void 0?dt(new W.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(n))},Je.prototype.put=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,c=i.keyPath,d=e;return c&&o&&(d=nr(c)(e)),this._trans("readwrite",function(v){return r.core.mutate({trans:v,type:"put",values:[d],keys:n!=null?[n]:null})}).then(function(v){return v.numFailures?te.reject(v.failures[0]):v.lastResult}).then(function(v){if(c)try{se(e,c,v)}catch{}return v})},Je.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]}).then(function(i){return rr(n,[e],i)}).then(function(i){return i.numFailures?te.reject(i.failures[0]):void 0})})},Je.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:Ci}).then(function(r){return rr(e,null,r)})}).then(function(n){return n.numFailures?te.reject(n.failures[0]):void 0})},Je.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(o){return n.hook.reading.fire(o)})})})},Je.prototype.bulkAdd=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0,c=(r=r||(o?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",function(d){var y=i.schema.primKey,v=y.auto,y=y.keyPath;if(y&&o)throw new W.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,y=y&&v?e.map(nr(y)):e;return i.core.mutate({trans:d,type:"add",keys:o,values:y,wantResults:c}).then(function(w){var p=w.numFailures,C=w.results,b=w.lastResult,w=w.failures;if(p===0)return c?C:b;throw new Pe("".concat(i.name,".bulkAdd(): ").concat(p," of ").concat(g," operations failed"),w)})})},Je.prototype.bulkPut=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0,c=(r=r||(o?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",function(d){var y=i.schema.primKey,v=y.auto,y=y.keyPath;if(y&&o)throw new W.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,y=y&&v?e.map(nr(y)):e;return i.core.mutate({trans:d,type:"put",keys:o,values:y,wantResults:c}).then(function(w){var p=w.numFailures,C=w.results,b=w.lastResult,w=w.failures;if(p===0)return c?C:b;throw new Pe("".concat(i.name,".bulkPut(): ").concat(p," of ").concat(g," operations failed"),w)})})},Je.prototype.bulkUpdate=function(e){var n=this,r=this.core,i=e.map(function(d){return d.key}),o=e.map(function(d){return d.changes}),c=[];return this._trans("readwrite",function(d){return r.getMany({trans:d,keys:i,cache:"clone"}).then(function(v){var g=[],y=[];e.forEach(function(p,C){var b=p.key,w=p.changes,_=v[C];if(_){for(var I=0,O=Object.keys(w);I<O.length;I++){var T=O[I],D=w[T];if(T===n.schema.primKey.keyPath){if(Ne(D,b)!==0)throw new W.Constraint("Cannot update primary key in bulkUpdate()")}else se(_,T,D)}c.push(C),g.push(b),y.push(_)}});var x=g.length;return r.mutate({trans:d,type:"put",keys:g,values:y,updates:{keys:i,changeSpecs:o}}).then(function(p){var C=p.numFailures,b=p.failures;if(C===0)return x;for(var w=0,_=Object.keys(b);w<_.length;w++){var I,O=_[w],T=c[Number(O)];T!=null&&(I=b[O],delete b[O],b[T]=I)}throw new Pe("".concat(n.name,".bulkUpdate(): ").concat(C," of ").concat(x," operations failed"),b)})})})},Je.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e}).then(function(o){return rr(n,e,o)})}).then(function(d){var o=d.numFailures,c=d.lastResult,d=d.failures;if(o===0)return c;throw new Pe("".concat(n.name,".bulkDelete(): ").concat(o," of ").concat(r," operations failed"),d)})},Je);function Je(){}function Nn(e){function n(d,v){if(v){for(var g=arguments.length,y=new Array(g-1);--g;)y[g-1]=arguments[g];return r[d].subscribe.apply(null,y),e}if(typeof d=="string")return r[d]}var r={};n.addEventType=c;for(var i=1,o=arguments.length;i<o;++i)c(arguments[i]);return n;function c(d,v,g){if(typeof d!="object"){var y;v=v||nt;var x={subscribers:[],fire:g=g||me,subscribe:function(p){x.subscribers.indexOf(p)===-1&&(x.subscribers.push(p),x.fire=v(x.fire,p))},unsubscribe:function(p){x.subscribers=x.subscribers.filter(function(C){return C!==p}),x.fire=x.subscribers.reduce(v,g)}};return r[d]=n[d]=x}h(y=d).forEach(function(p){var C=y[p];if(m(C))c(p,y[p][0],y[p][1]);else{if(C!=="asap")throw new W.InvalidArgument("Invalid event config");var b=c(p,Be,function(){for(var w=arguments.length,_=new Array(w);w--;)_[w]=arguments[w];b.subscribers.forEach(function(I){le(function(){I.apply(null,_)})})})}})}}function Mn(e,n){return L(n).from({prototype:e}),n}function bn(e,n){return!(e.filter||e.algorithm||e.or)&&(n?e.justLimit:!e.replayFilter)}function jr(e,n){e.filter=cn(e.filter,n)}function Hr(e,n,r){var i=e.replayFilter;e.replayFilter=i?function(){return cn(i(),n())}:n,e.justLimit=r&&!i}function ir(e,n){if(e.isPrimKey)return n.primaryKey;var r=n.getIndexByKeyPath(e.index);if(!r)throw new W.Schema("KeyPath "+e.index+" on object store "+n.name+" is not indexed");return r}function Fi(e,n,r){var i=ir(e,n.schema);return n.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:i,range:e.range}})}function ar(e,n,r,i){var o=e.replayFilter?cn(e.filter,e.replayFilter()):e.filter;if(e.or){var c={},d=function(v,g,y){var x,p;o&&!o(g,y,function(C){return g.stop(C)},function(C){return g.fail(C)})||((p=""+(x=g.primaryKey))=="[object ArrayBuffer]"&&(p=""+new Uint8Array(x)),F(c,p)||(c[p]=!0,n(v,g,y)))};return Promise.all([e.or._iterate(d,r),Di(Fi(e,i,r),e.algorithm,d,!e.keysOnly&&e.valueMapper)])}return Di(Fi(e,i,r),cn(e.algorithm,o),n,!e.keysOnly&&e.valueMapper)}function Di(e,n,r,i){var o=rt(i?function(c,d,v){return r(i(c),d,v)}:r);return e.then(function(c){if(c)return c.start(function(){var d=function(){return c.continue()};n&&!n(c,function(v){return d=v},function(v){c.stop(v),d=me},function(v){c.fail(v),d=me})||o(c.value,c,function(v){return d=v}),d()})})}var Ka=(Ve.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,dt.bind(null,r.error)):r.table._trans("readonly",e).then(n)},Ve.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,dt.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},Ve.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=cn(n.algorithm,e)},Ve.prototype._iterate=function(e,n){return ar(this._ctx,e,n,this._ctx.table.core)},Ve.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&P(r,e),n._ctx=r,n},Ve.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ve.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return ar(n,e,r,n.table.core)})},Ve.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,o=i.table.core;if(bn(i,!0))return o.count({trans:r,query:{index:ir(i,o.schema),range:i.range}}).then(function(d){return Math.min(d,i.limit)});var c=0;return ar(i,function(){return++c,!1},r,o).then(function(){return c})}).then(e)},Ve.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],o=r.length-1;function c(g,y){return y?c(g[r[y]],y-1):g[i]}var d=this._ctx.dir==="next"?1:-1;function v(g,y){return Ne(c(g,o),c(y,o))*d}return this.toArray(function(g){return g.sort(v)}).then(n)},Ve.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&bn(i,!0)&&0<i.limit){var o=i.valueMapper,c=ir(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:c,range:i.range}}).then(function(v){return v=v.result,o?v.map(o):v})}var d=[];return ar(i,function(v){return d.push(v)},r,i.table.core).then(function(){return d})},e)},Ve.prototype.offset=function(e){var n=this._ctx;return e<=0||(n.offset+=e,bn(n)?Hr(n,function(){var r=e;return function(i,o){return r===0||(r===1?--r:o(function(){i.advance(r),r=0}),!1)}}):Hr(n,function(){var r=e;return function(){return--r<0}})),this},Ve.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Hr(this._ctx,function(){var n=e;return function(r,i,o){return--n<=0&&i(o),0<=n}},!0),this},Ve.prototype.until=function(e,n){return jr(this._ctx,function(r,i,o){return!e(r.value)||(i(o),n)}),this},Ve.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},Ve.prototype.last=function(e){return this.reverse().first(e)},Ve.prototype.filter=function(e){var n;return jr(this._ctx,function(r){return e(r.value)}),(n=this._ctx).isMatch=cn(n.isMatch,e),this},Ve.prototype.and=function(e){return this.filter(e)},Ve.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Ve.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ve.prototype.desc=function(){return this.reverse()},Ve.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},Ve.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Ve.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},Ve.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.key)}).then(function(){return r}).then(e)},Ve.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&bn(n,!0)&&0<n.limit)return this._read(function(i){var o=ir(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:o,range:n.range}})}).then(function(i){return i.result}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.primaryKey)}).then(function(){return r}).then(e)},Ve.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Ve.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},Ve.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Ve.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var n={};return jr(this._ctx,function(o){var i=o.primaryKey.toString(),o=F(n,i);return n[i]=!0,!o}),this},Ve.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var o=typeof e=="function"?e:function(_){return Ti(_,e)},c=r.table.core,y=c.schema.primaryKey,d=y.outbound,v=y.extractKey,g=200,y=n.db._options.modifyChunkSize;y&&(g=typeof y=="object"?y[c.name]||y["*"]||200:y);function x(_,T){var O=T.failures,T=T.numFailures;C+=_-T;for(var D=0,V=h(O);D<V.length;D++){var U=V[D];p.push(O[U])}}var p=[],C=0,b=[],w=e===Ni;return n.clone().primaryKeys().then(function(_){function I(T){var D=Math.min(g,_.length-T),V=_.slice(T,T+D);return(w?Promise.resolve([]):c.getMany({trans:i,keys:V,cache:"immutable"})).then(function(U){var X=[],q=[],Y=d?[]:null,Z=w?V:[];if(!w)for(var J=0;J<D;++J){var ie=U[J],xe={value:Se(ie),primKey:_[T+J]};o.call(xe,xe.value,xe)!==!1&&(xe.value==null?Z.push(_[T+J]):d||Ne(v(ie),v(xe.value))===0?(q.push(xe.value),d&&Y.push(_[T+J])):(Z.push(_[T+J]),X.push(xe.value)))}return Promise.resolve(0<X.length&&c.mutate({trans:i,type:"add",values:X}).then(function(Ce){for(var Ae in Ce.failures)Z.splice(parseInt(Ae),1);x(X.length,Ce)})).then(function(){return(0<q.length||O&&typeof e=="object")&&c.mutate({trans:i,type:"put",keys:Y,values:q,criteria:O,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<T}).then(function(Ce){return x(q.length,Ce)})}).then(function(){return(0<Z.length||O&&w)&&c.mutate({trans:i,type:"delete",keys:Z,criteria:O,isAdditionalChunk:0<T}).then(function(Ce){return rr(r.table,Z,Ce)}).then(function(Ce){return x(Z.length,Ce)})}).then(function(){return _.length>T+D&&I(T+g)})})}var O=bn(r)&&r.limit===1/0&&(typeof e!="function"||w)&&{index:r.index,range:r.range};return I(0).then(function(){if(0<p.length)throw new tt("Error modifying one or more objects",p,C,b);return _.length})})})},Ve.prototype.delete=function(){var e=this._ctx,n=e.range;return!bn(e)||e.table.schema.yProps||!e.isPrimKey&&n.type!==3?this.modify(Ni):this._write(function(r){var i=e.table.core.schema.primaryKey,o=n;return e.table.core.count({trans:r,query:{index:i,range:o}}).then(function(c){return e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(function(g){var v=g.failures,g=g.numFailures;if(g)throw new tt("Could not delete some values",Object.keys(v).map(function(y){return v[y]}),c-g);return c-g})})})},Ve);function Ve(){}var Ni=function(e,n){return n.value=null};function Ba(e,n){return e<n?-1:e===n?0:1}function qa(e,n){return n<e?-1:e===n?0:1}function Dt(e,n,r){return e=e instanceof Li?new e.Collection(e):e,e._ctx.error=new(r||TypeError)(n),e}function wn(e){return new e.Collection(e,function(){return Mi("")}).limit(0)}function or(e,n,r,i){var o,c,d,v,g,y,x,p=r.length;if(!r.every(function(w){return typeof w=="string"}))return Dt(e,Ii);function C(w){o=w==="next"?function(I){return I.toUpperCase()}:function(I){return I.toLowerCase()},c=w==="next"?function(I){return I.toLowerCase()}:function(I){return I.toUpperCase()},d=w==="next"?Ba:qa;var _=r.map(function(I){return{lower:c(I),upper:o(I)}}).sort(function(I,O){return d(I.lower,O.lower)});v=_.map(function(I){return I.upper}),g=_.map(function(I){return I.lower}),x=(y=w)==="next"?"":i}C("next"),e=new e.Collection(e,function(){return Xt(v[0],g[p-1]+i)}),e._ondirectionchange=function(w){C(w)};var b=0;return e._addAlgorithm(function(w,_,I){var O=w.key;if(typeof O!="string")return!1;var T=c(O);if(n(T,g,b))return!0;for(var D=null,V=b;V<p;++V){var U=(function(X,q,Y,Z,J,ie){for(var xe=Math.min(X.length,Z.length),Ce=-1,Ae=0;Ae<xe;++Ae){var Nt=q[Ae];if(Nt!==Z[Ae])return J(X[Ae],Y[Ae])<0?X.substr(0,Ae)+Y[Ae]+Y.substr(Ae+1):J(X[Ae],Z[Ae])<0?X.substr(0,Ae)+Z[Ae]+Y.substr(Ae+1):0<=Ce?X.substr(0,Ce)+q[Ce]+Y.substr(Ce+1):null;J(X[Ae],Nt)<0&&(Ce=Ae)}return xe<Z.length&&ie==="next"?X+Y.substr(X.length):xe<X.length&&ie==="prev"?X.substr(0,Y.length):Ce<0?null:X.substr(0,Ce)+Z[Ce]+Y.substr(Ce+1)})(O,T,v[V],g[V],d,y);U===null&&D===null?b=V+1:(D===null||0<d(D,U))&&(D=U)}return _(D!==null?function(){w.continue(D+x)}:I),!1}),e}function Xt(e,n,r,i){return{type:2,lower:e,upper:n,lowerOpen:r,upperOpen:i}}function Mi(e){return{type:1,lower:e,upper:e}}var Li=(Object.defineProperty(wt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),wt.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return 0<this._cmp(e,n)||this._cmp(e,n)===0&&(r||i)&&(!r||!i)?wn(this):new this.Collection(this,function(){return Xt(e,n,!r,!i)})}catch{return Dt(this,Gt)}},wt.prototype.equals=function(e){return e==null?Dt(this,Gt):new this.Collection(this,function(){return Mi(e)})},wt.prototype.above=function(e){return e==null?Dt(this,Gt):new this.Collection(this,function(){return Xt(e,void 0,!0)})},wt.prototype.aboveOrEqual=function(e){return e==null?Dt(this,Gt):new this.Collection(this,function(){return Xt(e,void 0,!1)})},wt.prototype.below=function(e){return e==null?Dt(this,Gt):new this.Collection(this,function(){return Xt(void 0,e,!1,!0)})},wt.prototype.belowOrEqual=function(e){return e==null?Dt(this,Gt):new this.Collection(this,function(){return Xt(void 0,e)})},wt.prototype.startsWith=function(e){return typeof e!="string"?Dt(this,Ii):this.between(e,e+ln,!0,!0)},wt.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):or(this,function(n,r){return n.indexOf(r[0])===0},[e],ln)},wt.prototype.equalsIgnoreCase=function(e){return or(this,function(n,r){return n===r[0]},[e],"")},wt.prototype.anyOfIgnoreCase=function(){var e=Oe.apply(ye,arguments);return e.length===0?wn(this):or(this,function(n,r){return r.indexOf(n)!==-1},e,"")},wt.prototype.startsWithAnyOfIgnoreCase=function(){var e=Oe.apply(ye,arguments);return e.length===0?wn(this):or(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,ln)},wt.prototype.anyOf=function(){var e=this,n=Oe.apply(ye,arguments),r=this._cmp;try{n.sort(r)}catch{return Dt(this,Gt)}if(n.length===0)return wn(this);var i=new this.Collection(this,function(){return Xt(n[0],n[n.length-1])});i._ondirectionchange=function(c){r=c==="next"?e._ascending:e._descending,n.sort(r)};var o=0;return i._addAlgorithm(function(c,d,v){for(var g=c.key;0<r(g,n[o]);)if(++o===n.length)return d(v),!1;return r(g,n[o])===0||(d(function(){c.continue(n[o])}),!1)}),i},wt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},wt.prototype.noneOf=function(){var e=Oe.apply(ye,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Dt(this,Gt)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[-1/0,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},wt.prototype.inAnyRange=function(O,n){var r=this,i=this._cmp,o=this._ascending,c=this._descending,d=this._min,v=this._max;if(O.length===0)return wn(this);if(!O.every(function(T){return T[0]!==void 0&&T[1]!==void 0&&o(T[0],T[1])<=0}))return Dt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",W.InvalidArgument);var g=!n||n.includeLowers!==!1,y=n&&n.includeUppers===!0,x,p=o;function C(T,D){return p(T[0],D[0])}try{(x=O.reduce(function(T,D){for(var V=0,U=T.length;V<U;++V){var X=T[V];if(i(D[0],X[1])<0&&0<i(D[1],X[0])){X[0]=d(X[0],D[0]),X[1]=v(X[1],D[1]);break}}return V===U&&T.push(D),T},[])).sort(C)}catch{return Dt(this,Gt)}var b=0,w=y?function(T){return 0<o(T,x[b][1])}:function(T){return 0<=o(T,x[b][1])},_=g?function(T){return 0<c(T,x[b][0])}:function(T){return 0<=c(T,x[b][0])},I=w,O=new this.Collection(this,function(){return Xt(x[0][0],x[x.length-1][1],!g,!y)});return O._ondirectionchange=function(T){p=T==="next"?(I=w,o):(I=_,c),x.sort(C)},O._addAlgorithm(function(T,D,V){for(var U,X=T.key;I(X);)if(++b===x.length)return D(V),!1;return!w(U=X)&&!_(U)||(r._cmp(X,x[b][1])===0||r._cmp(X,x[b][0])===0||D(function(){p===o?T.continue(x[b][0]):T.continue(x[b][1])}),!1)}),O},wt.prototype.startsWithAnyOf=function(){var e=Oe.apply(ye,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?wn(this):this.inAnyRange(e.map(function(n){return[n,n+ln]})):Dt(this,"startsWithAnyOf() only works with strings")},wt);function wt(){}function zt(e){return rt(function(n){return Ln(n),e(n.target.error),!1})}function Ln(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Rn="storagemutated",zr="x-storagemutated-1",Zt=Nn(null,Rn),Ua=(Kt.prototype._lock=function(){return G(!ue.global),++this._reculock,this._reculock!==1||ue.global||(ue.lockOwnerFor=this),this},Kt.prototype._unlock=function(){if(G(!ue.global),--this._reculock==0)for(ue.global||(ue.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{sn(e[1],e[0])}catch{}}return this},Kt.prototype._locked=function(){return this._reculock&&ue.lockOwnerFor!==this},Kt.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(G(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new W.DatabaseClosed(i);case"MissingAPIError":throw new W.MissingAPI(i.message,i);default:throw new W.OpenFailed(i)}if(!this.active)throw new W.TransactionInactive;return G(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=rt(function(o){Ln(o),n._reject(e.error)}),e.onabort=rt(function(o){Ln(o),n.active&&n._reject(new W.Abort(e.error)),n.active=!1,n.on("abort").fire(o)}),e.oncomplete=rt(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&Zt.storagemutated.fire(e.mutatedParts)}),this},Kt.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return dt(new W.ReadOnly("Transaction is readonly"));if(!this.active)return dt(new W.TransactionInactive);if(this._locked())return new te(function(c,d){i._blockedFuncs.push([function(){i._promise(e,n,r).then(c,d)},ue])});if(r)return Yt(function(){var c=new te(function(d,v){i._lock();var g=n(d,v,i);g&&g.then&&g.then(d,v)});return c.finally(function(){return i._unlock()}),c._lib=!0,c});var o=new te(function(c,d){var v=n(c,d,i);v&&v.then&&v.then(c,d)});return o._lib=!0,o},Kt.prototype._root=function(){return this.parent?this.parent._root():this},Kt.prototype.waitFor=function(e){var n,r=this._root(),i=te.resolve(e);r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return i}):(r._waitingFor=i,r._waitingQueue=[],n=r.idbtrans.objectStore(r.storeNames[0]),(function c(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(n.get(-1/0).onsuccess=c)})());var o=r._waitingFor;return new te(function(c,d){i.then(function(v){return r._waitingQueue.push(rt(c.bind(null,v)))},function(v){return r._waitingQueue.push(rt(d.bind(null,v)))}).finally(function(){r._waitingFor===o&&(r._waitingFor=null)})})},Kt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new W.Abort))},Kt.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(F(n,e))return n[e];var r=this.schema[e];if(!r)throw new W.NotFound("Table "+e+" not part of transaction");return r=new this.db.Table(e,r,this),r.core=this.db.core.table(e),n[e]=r},Kt);function Kt(){}function Kr(e,n,r,i,o,c,d,v){return{name:e,keyPath:n,unique:r,multi:i,auto:o,compound:c,src:(r&&!d?"&":"")+(i?"*":"")+(o?"++":"")+Ri(n),type:v}}function Ri(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Br(e,n,r){return{name:e,primKey:n,indexes:r,mappedClass:null,idxByName:(i=function(o){return[o.name,o]},r.reduce(function(o,c,d){return d=i(c,d),d&&(o[d[0]]=d[1]),o},{}))};var i}var Vn=function(e){try{return e.only([[]]),Vn=function(){return[[]]},[[]]}catch{return Vn=function(){return ln},ln}};function qr(e){return e==null?function(){}:typeof e=="string"?(n=e).split(".").length===1?function(r){return r[n]}:function(r){return re(r,n)}:function(r){return re(r,e)};var n}function Vi(e){return[].slice.call(e)}var Ga=0;function jn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Wa(e,n,g){function i(I){if(I.type===3)return null;if(I.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var b=I.lower,w=I.upper,_=I.lowerOpen,I=I.upperOpen;return b===void 0?w===void 0?null:n.upperBound(w,!!I):w===void 0?n.lowerBound(b,!!_):n.bound(b,w,!!_,!!I)}function o(C){var b,w=C.name;return{name:w,schema:C,mutate:function(_){var I=_.trans,O=_.type,T=_.keys,D=_.values,V=_.range;return new Promise(function(U,X){U=rt(U);var q=I.objectStore(w),Y=q.keyPath==null,Z=O==="put"||O==="add";if(!Z&&O!=="delete"&&O!=="deleteRange")throw new Error("Invalid operation type: "+O);var J,ie=(T||D||{length:1}).length;if(T&&D&&T.length!==D.length)throw new Error("Given keys array must have same length as given values array.");if(ie===0)return U({numFailures:0,failures:{},results:[],lastResult:void 0});function xe(At){++Nt,Ln(At)}var Ce=[],Ae=[],Nt=0;if(O==="deleteRange"){if(V.type===4)return U({numFailures:Nt,failures:Ae,results:[],lastResult:void 0});V.type===3?Ce.push(J=q.clear()):Ce.push(J=q.delete(i(V)))}else{var Y=Z?Y?[D,T]:[D,null]:[T,null],_e=Y[0],St=Y[1];if(Z)for(var xt=0;xt<ie;++xt)Ce.push(J=St&&St[xt]!==void 0?q[O](_e[xt],St[xt]):q[O](_e[xt])),J.onerror=xe;else for(xt=0;xt<ie;++xt)Ce.push(J=q[O](_e[xt])),J.onerror=xe}function yr(At){At=At.target.result,Ce.forEach(function(fn,li){return fn.error!=null&&(Ae[li]=fn.error)}),U({numFailures:Nt,failures:Ae,results:O==="delete"?T:Ce.map(function(fn){return fn.result}),lastResult:At})}J.onerror=function(At){xe(At),yr(At)},J.onsuccess=yr})},getMany:function(_){var I=_.trans,O=_.keys;return new Promise(function(T,D){T=rt(T);for(var V,U=I.objectStore(w),X=O.length,q=new Array(X),Y=0,Z=0,J=function(Ce){Ce=Ce.target,q[Ce._pos]=Ce.result,++Z===Y&&T(q)},ie=zt(D),xe=0;xe<X;++xe)O[xe]!=null&&((V=U.get(O[xe]))._pos=xe,V.onsuccess=J,V.onerror=ie,++Y);Y===0&&T(q)})},get:function(_){var I=_.trans,O=_.key;return new Promise(function(T,D){T=rt(T);var V=I.objectStore(w).get(O);V.onsuccess=function(U){return T(U.target.result)},V.onerror=zt(D)})},query:(b=y,function(_){return new Promise(function(I,O){I=rt(I);var T,D,V,Y=_.trans,U=_.values,X=_.limit,J=_.query,q=X===1/0?void 0:X,Z=J.index,J=J.range,Y=Y.objectStore(w),Z=Z.isPrimaryKey?Y:Y.index(Z.name),J=i(J);if(X===0)return I({result:[]});b?((q=U?Z.getAll(J,q):Z.getAllKeys(J,q)).onsuccess=function(ie){return I({result:ie.target.result})},q.onerror=zt(O)):(T=0,D=!U&&"openKeyCursor"in Z?Z.openKeyCursor(J):Z.openCursor(J),V=[],D.onsuccess=function(ie){var xe=D.result;return xe?(V.push(U?xe.value:xe.primaryKey),++T===X?I({result:V}):void xe.continue()):I({result:V})},D.onerror=zt(O))})}),openCursor:function(_){var I=_.trans,O=_.values,T=_.query,D=_.reverse,V=_.unique;return new Promise(function(U,X){U=rt(U);var Z=T.index,q=T.range,Y=I.objectStore(w),Y=Z.isPrimaryKey?Y:Y.index(Z.name),Z=D?V?"prevunique":"prev":V?"nextunique":"next",J=!O&&"openKeyCursor"in Y?Y.openKeyCursor(i(q),Z):Y.openCursor(i(q),Z);J.onerror=zt(X),J.onsuccess=rt(function(ie){var xe,Ce,Ae,Nt,_e=J.result;_e?(_e.___id=++Ga,_e.done=!1,xe=_e.continue.bind(_e),Ce=(Ce=_e.continuePrimaryKey)&&Ce.bind(_e),Ae=_e.advance.bind(_e),Nt=function(){throw new Error("Cursor not stopped")},_e.trans=I,_e.stop=_e.continue=_e.continuePrimaryKey=_e.advance=function(){throw new Error("Cursor not started")},_e.fail=rt(X),_e.next=function(){var St=this,xt=1;return this.start(function(){return xt--?St.continue():St.stop()}).then(function(){return St})},_e.start=function(St){function xt(){if(J.result)try{St()}catch(At){_e.fail(At)}else _e.done=!0,_e.start=function(){throw new Error("Cursor behind last entry")},_e.stop()}var yr=new Promise(function(At,fn){At=rt(At),J.onerror=zt(fn),_e.fail=fn,_e.stop=function(li){_e.stop=_e.continue=_e.continuePrimaryKey=_e.advance=Nt,At(li)}});return J.onsuccess=rt(function(At){J.onsuccess=xt,xt()}),_e.continue=xe,_e.continuePrimaryKey=Ce,_e.advance=Ae,xt(),yr},U(_e)):U(null)},X)})},count:function(_){var I=_.query,O=_.trans,T=I.index,D=I.range;return new Promise(function(V,U){var X=O.objectStore(w),q=T.isPrimaryKey?X:X.index(T.name),X=i(D),q=X?q.count(X):q.count();q.onsuccess=rt(function(Y){return V(Y.target.result)}),q.onerror=zt(U)})}}}var c,d,v,x=(d=g,v=Vi((c=e).objectStoreNames),{schema:{name:c.name,tables:v.map(function(C){return d.objectStore(C)}).map(function(C){var b=C.keyPath,I=C.autoIncrement,w=m(b),_={},I={name:C.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:b==null,compound:w,keyPath:b,autoIncrement:I,unique:!0,extractKey:qr(b)},indexes:Vi(C.indexNames).map(function(O){return C.index(O)}).map(function(V){var T=V.name,D=V.unique,U=V.multiEntry,V=V.keyPath,U={name:T,compound:m(V),keyPath:V,unique:D,multiEntry:U,extractKey:qr(V)};return _[jn(V)]=U}),getIndexByKeyPath:function(O){return _[jn(O)]}};return _[":id"]=I.primaryKey,b!=null&&(_[jn(b)]=I.primaryKey),I})},hasGetAll:0<v.length&&"getAll"in d.objectStore(v[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),g=x.schema,y=x.hasGetAll,x=g.tables.map(o),p={};return x.forEach(function(C){return p[C.name]=C}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(C){if(!p[C])throw new Error("Table '".concat(C,"' not found"));return p[C]},MIN_KEY:-1/0,MAX_KEY:Vn(n),schema:g}}function $a(e,n,r,i){var o=r.IDBKeyRange;return r.indexedDB,{dbcore:(i=Wa(n,o,i),e.dbcore.reduce(function(c,d){return d=d.create,s(s({},c),d(c))},i))}}function sr(e,i){var r=i.db,i=$a(e._middlewares,r,e._deps,i);e.core=i.dbcore,e.tables.forEach(function(o){var c=o.name;e.core.schema.tables.some(function(d){return d.name===c})&&(o.core=e.core.table(c),e[c]instanceof e.Table&&(e[c].core=o.core))})}function lr(e,n,r,i){r.forEach(function(o){var c=i[o];n.forEach(function(d){var v=(function g(y,x){return H(y,x)||(y=k(y))&&g(y,x)})(d,o);(!v||"value"in v&&v.value===void 0)&&(d===e.Transaction.prototype||d instanceof e.Transaction?R(d,o,{get:function(){return this.table(o)},set:function(g){j(this,o,{value:g,writable:!0,configurable:!0,enumerable:!0})}}):d[o]=new e.Table(o,c))})})}function Ur(e,n){n.forEach(function(r){for(var i in r)r[i]instanceof e.Table&&delete r[i]})}function Ya(e,n){return e._cfg.version-n._cfg.version}function Ja(e,n,r,i){var o=e._dbSchema;r.objectStoreNames.contains("$meta")&&!o.$meta&&(o.$meta=Br("$meta",Hi("")[0],[]),e._storeNames.push("$meta"));var c=e._createTransaction("readwrite",e._storeNames,o);c.create(r),c._completion.catch(i);var d=c._reject.bind(c),v=ue.transless||ue;Yt(function(){return ue.trans=c,ue.transless=v,n!==0?(sr(e,r),y=n,((g=c).storeNames.includes("$meta")?g.table("$meta").get("version").then(function(x){return x??y}):te.resolve(y)).then(function(x){return C=x,b=c,w=r,_=[],x=(p=e)._versions,I=p._dbSchema=ur(0,p.idbdb,w),(x=x.filter(function(O){return O._cfg.version>=C})).length!==0?(x.forEach(function(O){_.push(function(){var T=I,D=O._cfg.dbschema;dr(p,T,w),dr(p,D,w),I=p._dbSchema=D;var V=Gr(T,D);V.add.forEach(function(Z){Wr(w,Z[0],Z[1].primKey,Z[1].indexes)}),V.change.forEach(function(Z){if(Z.recreate)throw new W.Upgrade("Not yet support for changing primary key");var J=w.objectStore(Z.name);Z.add.forEach(function(ie){return cr(J,ie)}),Z.change.forEach(function(ie){J.deleteIndex(ie.name),cr(J,ie)}),Z.del.forEach(function(ie){return J.deleteIndex(ie)})});var U=O._cfg.contentUpgrade;if(U&&O._cfg.version>C){sr(p,w),b._memoizedTables={};var X=ge(D);V.del.forEach(function(Z){X[Z]=T[Z]}),Ur(p,[p.Transaction.prototype]),lr(p,[p.Transaction.prototype],h(X),X),b.schema=X;var q,Y=et(U);return Y&&mn(),V=te.follow(function(){var Z;(q=U(b))&&Y&&(Z=Jt.bind(null,null),q.then(Z,Z))}),q&&typeof q.then=="function"?te.resolve(q):V.then(function(){return q})}}),_.push(function(T){var D,V,U=O._cfg.dbschema;D=U,V=T,[].slice.call(V.db.objectStoreNames).forEach(function(X){return D[X]==null&&V.db.deleteObjectStore(X)}),Ur(p,[p.Transaction.prototype]),lr(p,[p.Transaction.prototype],p._storeNames,p._dbSchema),b.schema=p._dbSchema}),_.push(function(T){p.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(p.idbdb.version/10)===O._cfg.version?(p.idbdb.deleteObjectStore("$meta"),delete p._dbSchema.$meta,p._storeNames=p._storeNames.filter(function(D){return D!=="$meta"})):T.objectStore("$meta").put(O._cfg.version,"version"))})}),(function O(){return _.length?te.resolve(_.shift()(b.idbtrans)).then(O):te.resolve()})().then(function(){ji(I,w)})):te.resolve();var p,C,b,w,_,I}).catch(d)):(h(o).forEach(function(x){Wr(r,x,o[x].primKey,o[x].indexes)}),sr(e,r),void te.follow(function(){return e.on.populate.fire(c)}).catch(d));var g,y})}function Qa(e,n){ji(e._dbSchema,n),n.db.version%10!=0||n.objectStoreNames.contains("$meta")||n.db.createObjectStore("$meta").add(Math.ceil(n.db.version/10-1),"version");var r=ur(0,e.idbdb,n);dr(e,e._dbSchema,n);for(var i=0,o=Gr(r,e._dbSchema).change;i<o.length;i++){var c=(function(d){if(d.change.length||d.recreate)return console.warn("Unable to patch indexes of table ".concat(d.name," because it has changes on the type of index or primary key.")),{value:void 0};var v=n.objectStore(d.name);d.add.forEach(function(g){We&&console.debug("Dexie upgrade patch: Creating missing index ".concat(d.name,".").concat(g.src)),cr(v,g)})})(o[i]);if(typeof c=="object")return c.value}}function Gr(e,n){var r,i={del:[],add:[],change:[]};for(r in e)n[r]||i.del.push(r);for(r in n){var o=e[r],c=n[r];if(o){var d={name:r,def:c,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(c.primKey.keyPath||"")||o.primKey.auto!==c.primKey.auto)d.recreate=!0,i.change.push(d);else{var v=o.idxByName,g=c.idxByName,y=void 0;for(y in v)g[y]||d.del.push(y);for(y in g){var x=v[y],p=g[y];x?x.src!==p.src&&d.change.push(p):d.add.push(p)}(0<d.del.length||0<d.add.length||0<d.change.length)&&i.change.push(d)}}else i.add.push([r,c])}return i}function Wr(e,n,r,i){var o=e.db.createObjectStore(n,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return i.forEach(function(c){return cr(o,c)}),o}function ji(e,n){h(e).forEach(function(r){n.db.objectStoreNames.contains(r)||(We&&console.debug("Dexie: Creating missing table",r),Wr(n,r,e[r].primKey,e[r].indexes))})}function cr(e,n){e.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function ur(e,n,r){var i={};return z(n.objectStoreNames,0).forEach(function(o){for(var c=r.objectStore(o),d=Kr(Ri(y=c.keyPath),y||"",!0,!1,!!c.autoIncrement,y&&typeof y!="string",!0),v=[],g=0;g<c.indexNames.length;++g){var x=c.index(c.indexNames[g]),y=x.keyPath,x=Kr(x.name,y,!!x.unique,!!x.multiEntry,!1,y&&typeof y!="string",!1);v.push(x)}i[o]=Br(o,d,v)}),i}function dr(e,n,r){for(var i=r.db.objectStoreNames,o=0;o<i.length;++o){var c=i[o],d=r.objectStore(c);e._hasGetAll="getAll"in d;for(var v=0;v<d.indexNames.length;++v){var g=d.indexNames[v],y=d.index(g).keyPath,x=typeof y=="string"?y:"["+z(y).join("+")+"]";!n[c]||(y=n[c].idxByName[x])&&(y.name=g,delete n[c].idxByName[x],n[c].idxByName[g]=y)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&f.WorkerGlobalScope&&f instanceof f.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Hi(e){return e.split(",").map(function(n,r){var c=n.split(":"),i=(o=c[1])===null||o===void 0?void 0:o.trim(),o=(n=c[0].trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return Kr(o,c||null,/\&/.test(n),/\*/.test(n),/\+\+/.test(n),m(c),r===0,i)})}var Xa=(_n.prototype._createTableSchema=Br,_n.prototype._parseIndexSyntax=Hi,_n.prototype._parseStoresSpec=function(e,n){var r=this;h(e).forEach(function(i){if(e[i]!==null){var o=r._parseIndexSyntax(e[i]),c=o.shift();if(!c)throw new W.Schema("Invalid schema for table "+i+": "+e[i]);if(c.unique=!0,c.multi)throw new W.Schema("Primary key cannot be multiEntry*");o.forEach(function(d){if(d.auto)throw new W.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new W.Schema("Index must have a name and cannot be an empty string")}),o=r._createTableSchema(i,c,o),n[i]=o}})},_n.prototype.stores=function(r){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?P(this._cfg.storesSource,r):r;var r=n._versions,i={},o={};return r.forEach(function(c){P(i,c._cfg.storesSource),o=c._cfg.dbschema={},c._parseStoresSpec(i,o)}),n._dbSchema=o,Ur(n,[n._allTables,n,n.Transaction.prototype]),lr(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],h(o),o),n._storeNames=h(o),this},_n.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Ye(this._cfg.contentUpgrade||me,e),this},_n);function _n(){}function $r(e,n){var r=e._dbNamesDB;return r||(r=e._dbNamesDB=new Wt(tr,{addons:[],indexedDB:e,IDBKeyRange:n})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function Yr(e){return e&&typeof e.databases=="function"}function Jr(e){return Yt(function(){return ue.letThrough=!0,e()})}function Qr(e){return!("from"in e)}var _t=function(e,n){if(!this){var r=new _t;return e&&"d"in e&&P(r,e),r}P(this,arguments.length?{d:1,from:e,to:1<arguments.length?n:e}:{d:0})};function Hn(e,n,r){var i=Ne(n,r);if(!isNaN(i)){if(0<i)throw RangeError();if(Qr(e))return P(e,{from:n,to:r,d:1});var o=e.l,i=e.r;if(Ne(r,e.from)<0)return o?Hn(o,n,r):e.l={from:n,to:r,d:1,l:null,r:null},Ki(e);if(0<Ne(n,e.to))return i?Hn(i,n,r):e.r={from:n,to:r,d:1,l:null,r:null},Ki(e);Ne(n,e.from)<0&&(e.from=n,e.l=null,e.d=i?i.d+1:1),0<Ne(r,e.to)&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1),r=!e.r,o&&!e.l&&zn(e,o),i&&r&&zn(e,i)}}function zn(e,n){Qr(n)||(function r(i,g){var c=g.from,d=g.to,v=g.l,g=g.r;Hn(i,c,d),v&&r(i,v),g&&r(i,g)})(e,n)}function zi(e,n){var r=fr(n),i=r.next();if(i.done)return!1;for(var o=i.value,c=fr(e),d=c.next(o.from),v=d.value;!i.done&&!d.done;){if(Ne(v.from,o.to)<=0&&0<=Ne(v.to,o.from))return!0;Ne(o.from,v.from)<0?o=(i=r.next(v.from)).value:v=(d=c.next(o.from)).value}return!1}function fr(e){var n=Qr(e)?null:{s:0,n:e};return{next:function(r){for(var i=0<arguments.length;n;)switch(n.s){case 0:if(n.s=1,i)for(;n.n.l&&Ne(r,n.n.from)<0;)n={up:n,n:n.n.l,s:1};else for(;n.n.l;)n={up:n,n:n.n.l,s:1};case 1:if(n.s=2,!i||Ne(r,n.n.to)<=0)return{value:n.n,done:!1};case 2:if(n.n.r){n.s=3,n={up:n,n:n.n.r,s:0};continue}case 3:n=n.up}return{done:!0}}}}function Ki(e){var n,r,i=(((n=e.r)===null||n===void 0?void 0:n.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),o=1<i?"r":i<-1?"l":"";o&&(n=o=="r"?"l":"r",r=s({},e),i=e[o],e.from=i.from,e.to=i.to,e[o]=i[o],r[o]=i[n],(e[n]=r).d=Bi(r)),e.d=Bi(e)}function Bi(r){var n=r.r,r=r.l;return(n?r?Math.max(n.d,r.d):n.d:r?r.d:0)+1}function hr(e,n){return h(n).forEach(function(r){e[r]?zn(e[r],n[r]):e[r]=(function i(o){var c,d,v={};for(c in o)F(o,c)&&(d=o[c],v[c]=!d||typeof d!="object"||be.has(d.constructor)?d:i(d));return v})(n[r])}),e}function Xr(e,n){return e.all||n.all||Object.keys(e).some(function(r){return n[r]&&zi(n[r],e[r])})}N(_t.prototype,((Rt={add:function(e){return zn(this,e),this},addKey:function(e){return Hn(this,e,e),this},addKeys:function(e){var n=this;return e.forEach(function(r){return Hn(n,r,r)}),this},hasKey:function(e){var n=fr(this).next(e).value;return n&&Ne(n.from,e)<=0&&0<=Ne(n.to,e)}})[Xe]=function(){return fr(this)},Rt));var un={},Zr={},ei=!1;function vr(e){hr(Zr,e),ei||(ei=!0,setTimeout(function(){ei=!1,ti(Zr,!(Zr={}))},0))}function ti(e,n){n===void 0&&(n=!1);var r=new Set;if(e.all)for(var i=0,o=Object.values(un);i<o.length;i++)qi(d=o[i],e,r,n);else for(var c in e){var d,v=/^idb\:\/\/(.*)\/(.*)\//.exec(c);v&&(c=v[1],v=v[2],(d=un["idb://".concat(c,"/").concat(v)])&&qi(d,e,r,n))}r.forEach(function(g){return g()})}function qi(e,n,r,i){for(var o=[],c=0,d=Object.entries(e.queries.query);c<d.length;c++){for(var v=d[c],g=v[0],y=[],x=0,p=v[1];x<p.length;x++){var C=p[x];Xr(n,C.obsSet)?C.subscribers.forEach(function(I){return r.add(I)}):i&&y.push(C)}i&&o.push([g,y])}if(i)for(var b=0,w=o;b<w.length;b++){var _=w[b],g=_[0],y=_[1];e.queries.query[g]=y}}function Za(e){var n=e._state,r=e._deps.indexedDB;if(n.isBeingOpened||e.idbdb)return n.dbReadyPromise.then(function(){return n.dbOpenError?dt(n.dbOpenError):e});n.isBeingOpened=!0,n.dbOpenError=null,n.openComplete=!1;var i=n.openCanceller,o=Math.round(10*e.verno),c=!1;function d(){if(n.openCanceller!==i)throw new W.DatabaseClosed("db.open() was cancelled")}function v(){return new te(function(C,b){if(d(),!r)throw new W.MissingAPI;var w=e.name,_=n.autoSchema||!o?r.open(w):r.open(w,o);if(!_)throw new W.MissingAPI;_.onerror=zt(b),_.onblocked=rt(e._fireOnBlocked),_.onupgradeneeded=rt(function(I){var O;x=_.transaction,n.autoSchema&&!e._options.allowEmptyDB?(_.onerror=Ln,x.abort(),_.result.close(),(O=r.deleteDatabase(w)).onsuccess=O.onerror=rt(function(){b(new W.NoSuchDatabase("Database ".concat(w," doesnt exist")))})):(x.onerror=zt(b),I=I.oldVersion>Math.pow(2,62)?0:I.oldVersion,p=I<1,e.idbdb=_.result,c&&Qa(e,x),Ja(e,I/10,x,b))},b),_.onsuccess=rt(function(){x=null;var I,O,T,D,V,U=e.idbdb=_.result,X=z(U.objectStoreNames);if(0<X.length)try{var q=U.transaction((D=X).length===1?D[0]:D,"readonly");if(n.autoSchema)O=U,T=q,(I=e).verno=O.version/10,T=I._dbSchema=ur(0,O,T),I._storeNames=z(O.objectStoreNames,0),lr(I,[I._allTables],h(T),T);else if(dr(e,e._dbSchema,q),((V=Gr(ur(0,(V=e).idbdb,q),V._dbSchema)).add.length||V.change.some(function(Y){return Y.add.length||Y.change.length}))&&!c)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),U.close(),o=U.version+1,c=!0,C(v());sr(e,q)}catch{}yn.push(e),U.onversionchange=rt(function(Y){n.vcFired=!0,e.on("versionchange").fire(Y)}),U.onclose=rt(function(){e.close({disableAutoOpen:!1})}),p&&(V=e._deps,q=w,U=V.indexedDB,V=V.IDBKeyRange,Yr(U)||q===tr||$r(U,V).put({name:q}).catch(me)),C()},b)}).catch(function(C){switch(C?.name){case"UnknownError":if(0<n.PR1398_maxLoop)return n.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),v();break;case"VersionError":if(0<o)return o=0,v()}return te.reject(C)})}var g,y=n.dbReadyResolve,x=null,p=!1;return te.race([i,(typeof navigator>"u"?te.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(C){function b(){return indexedDB.databases().finally(C)}g=setInterval(b,100),b()}).finally(function(){return clearInterval(g)}):Promise.resolve()).then(v)]).then(function(){return d(),n.onReadyBeingFired=[],te.resolve(Jr(function(){return e.on.ready.fire(e.vip)})).then(function C(){if(0<n.onReadyBeingFired.length){var b=n.onReadyBeingFired.reduce(Ye,me);return n.onReadyBeingFired=[],te.resolve(Jr(function(){return b(e.vip)})).then(C)}})}).finally(function(){n.openCanceller===i&&(n.onReadyBeingFired=null,n.isBeingOpened=!1)}).catch(function(C){n.dbOpenError=C;try{x&&x.abort()}catch{}return i===n.openCanceller&&e._close(),dt(C)}).finally(function(){n.openComplete=!0,y()}).then(function(){var C;return p&&(C={},e.tables.forEach(function(b){b.schema.indexes.forEach(function(w){w.name&&(C["idb://".concat(e.name,"/").concat(b.name,"/").concat(w.name)]=new _t(-1/0,[[[]]]))}),C["idb://".concat(e.name,"/").concat(b.name,"/")]=C["idb://".concat(e.name,"/").concat(b.name,"/:dels")]=new _t(-1/0,[[[]]])}),Zt(Rn).fire(C),ti(C,!0)),e})}function ni(e){function n(c){return e.next(c)}var r=o(n),i=o(function(c){return e.throw(c)});function o(c){return function(g){var v=c(g),g=v.value;return v.done?g:g&&typeof g.then=="function"?g.then(r,i):m(g)?Promise.all(g).then(r,i):r(g)}}return o(n)()}function pr(e,n,r){for(var i=m(e)?e.slice():[e],o=0;o<r;++o)i.push(n);return i}var eo={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return s(s({},e),{table:function(n){var r=e.table(n),i=r.schema,o={},c=[];function d(p,C,b){var w=jn(p),_=o[w]=o[w]||[],I=p==null?0:typeof p=="string"?1:p.length,O=0<C,O=s(s({},b),{name:O?"".concat(w,"(virtual-from:").concat(b.name,")"):b.name,lowLevelIndex:b,isVirtual:O,keyTail:C,keyLength:I,extractKey:qr(p),unique:!O&&b.unique});return _.push(O),O.isPrimaryKey||c.push(O),1<I&&d(I===2?p[0]:p.slice(0,I-1),C+1,b),_.sort(function(T,D){return T.keyTail-D.keyTail}),O}n=d(i.primaryKey.keyPath,0,i.primaryKey),o[":id"]=[n];for(var v=0,g=i.indexes;v<g.length;v++){var y=g[v];d(y.keyPath,0,y)}function x(p){var C,b=p.query.index;return b.isVirtual?s(s({},p),{query:{index:b.lowLevelIndex,range:(C=p.query.range,b=b.keyTail,{type:C.type===1?2:C.type,lower:pr(C.lower,C.lowerOpen?e.MAX_KEY:e.MIN_KEY,b),lowerOpen:!0,upper:pr(C.upper,C.upperOpen?e.MIN_KEY:e.MAX_KEY,b),upperOpen:!0})}}):p}return s(s({},r),{schema:s(s({},i),{primaryKey:n,indexes:c,getIndexByKeyPath:function(p){return(p=o[jn(p)])&&p[0]}}),count:function(p){return r.count(x(p))},query:function(p){return r.query(x(p))},openCursor:function(p){var C=p.query.index,b=C.keyTail,w=C.isVirtual,_=C.keyLength;return w?r.openCursor(x(p)).then(function(O){return O&&I(O)}):r.openCursor(p);function I(O){return Object.create(O,{continue:{value:function(T){T!=null?O.continue(pr(T,p.reverse?e.MAX_KEY:e.MIN_KEY,b)):p.unique?O.continue(O.key.slice(0,_).concat(p.reverse?e.MIN_KEY:e.MAX_KEY,b)):O.continue()}},continuePrimaryKey:{value:function(T,D){O.continuePrimaryKey(pr(T,e.MAX_KEY,b),D)}},primaryKey:{get:function(){return O.primaryKey}},key:{get:function(){var T=O.key;return _===1?T[0]:T.slice(0,_)}},value:{get:function(){return O.value}}})}}})}})}};function ri(e,n,r,i){return r=r||{},i=i||"",h(e).forEach(function(o){var c,d,v;F(n,o)?(c=e[o],d=n[o],typeof c=="object"&&typeof d=="object"&&c&&d?(v=He(c))!==He(d)?r[i+o]=n[o]:v==="Object"?ri(c,d,r,i+o+"."):c!==d&&(r[i+o]=n[o]):c!==d&&(r[i+o]=n[o])):r[i+o]=void 0}),h(n).forEach(function(o){F(e,o)||(r[i+o]=n[o])}),r}function ii(e,n){return n.type==="delete"?n.keys:n.keys||n.values.map(e.extractKey)}var to={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return s(s({},e),{table:function(n){var r=e.table(n),i=r.schema.primaryKey;return s(s({},r),{mutate:function(o){var c=ue.trans,d=c.table(n).hook,v=d.deleting,g=d.creating,y=d.updating;switch(o.type){case"add":if(g.fire===me)break;return c._promise("readwrite",function(){return x(o)},!0);case"put":if(g.fire===me&&y.fire===me)break;return c._promise("readwrite",function(){return x(o)},!0);case"delete":if(v.fire===me)break;return c._promise("readwrite",function(){return x(o)},!0);case"deleteRange":if(v.fire===me)break;return c._promise("readwrite",function(){return(function p(C,b,w){return r.query({trans:C,values:!1,query:{index:i,range:b},limit:w}).then(function(_){var I=_.result;return x({type:"delete",keys:I,trans:C}).then(function(O){return 0<O.numFailures?Promise.reject(O.failures[0]):I.length<w?{failures:[],numFailures:0,lastResult:void 0}:p(C,s(s({},b),{lower:I[I.length-1],lowerOpen:!0}),w)})})})(o.trans,o.range,1e4)},!0)}return r.mutate(o);function x(p){var C,b,w,_=ue.trans,I=p.keys||ii(i,p);if(!I)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?s(s({},p),{keys:I}):s({},p)).type!=="delete"&&(p.values=u([],p.values)),p.keys&&(p.keys=u([],p.keys)),C=r,w=I,((b=p).type==="add"?Promise.resolve([]):C.getMany({trans:b.trans,keys:w,cache:"immutable"})).then(function(O){var T=I.map(function(D,V){var U,X,q,Y=O[V],Z={onerror:null,onsuccess:null};return p.type==="delete"?v.fire.call(Z,D,Y,_):p.type==="add"||Y===void 0?(U=g.fire.call(Z,D,p.values[V],_),D==null&&U!=null&&(p.keys[V]=D=U,i.outbound||se(p.values[V],i.keyPath,D))):(U=ri(Y,p.values[V]),(X=y.fire.call(Z,U,D,Y,_))&&(q=p.values[V],Object.keys(X).forEach(function(J){F(q,J)?q[J]=X[J]:se(q,J,X[J])}))),Z});return r.mutate(p).then(function(D){for(var V=D.failures,U=D.results,X=D.numFailures,D=D.lastResult,q=0;q<I.length;++q){var Y=(U||I)[q],Z=T[q];Y==null?Z.onerror&&Z.onerror(V[q]):Z.onsuccess&&Z.onsuccess(p.type==="put"&&O[q]?p.values[q]:Y)}return{failures:V,results:U,numFailures:X,lastResult:D}}).catch(function(D){return T.forEach(function(V){return V.onerror&&V.onerror(D)}),Promise.reject(D)})})}}})}})}};function Ui(e,n,r){try{if(!n||n.keys.length<e.length)return null;for(var i=[],o=0,c=0;o<n.keys.length&&c<e.length;++o)Ne(n.keys[o],e[c])===0&&(i.push(r?Se(n.values[o]):n.values[o]),++c);return i.length===e.length?i:null}catch{return null}}var no={stack:"dbcore",level:-1,create:function(e){return{table:function(n){var r=e.table(n);return s(s({},r),{getMany:function(i){if(!i.cache)return r.getMany(i);var o=Ui(i.keys,i.trans._cache,i.cache==="clone");return o?te.resolve(o):r.getMany(i).then(function(c){return i.trans._cache={keys:i.keys,values:i.cache==="clone"?Se(c):c},c})},mutate:function(i){return i.type!=="add"&&(i.trans._cache=null),r.mutate(i)}})}}}};function Gi(e,n){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!n.schema.primaryKey.outbound}function Wi(e,n){switch(e){case"query":return n.values&&!n.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var ro={stack:"dbcore",level:0,name:"Observability",create:function(e){var n=e.schema.name,r=new _t(e.MIN_KEY,e.MAX_KEY);return s(s({},e),{transaction:function(i,o,c){if(ue.subscr&&o!=="readonly")throw new W.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ue.querier));return e.transaction(i,o,c)},table:function(i){var o=e.table(i),c=o.schema,d=c.primaryKey,p=c.indexes,v=d.extractKey,g=d.outbound,y=d.autoIncrement&&p.filter(function(b){return b.compound&&b.keyPath.includes(d.keyPath)}),x=s(s({},o),{mutate:function(b){function w(J){return J="idb://".concat(n,"/").concat(i,"/").concat(J),D[J]||(D[J]=new _t)}var _,I,O,T=b.trans,D=b.mutatedParts||(b.mutatedParts={}),V=w(""),U=w(":dels"),X=b.type,Z=b.type==="deleteRange"?[b.range]:b.type==="delete"?[b.keys]:b.values.length<50?[ii(d,b).filter(function(J){return J}),b.values]:[],q=Z[0],Y=Z[1],Z=b.trans._cache;return m(q)?(V.addKeys(q),(Z=X==="delete"||q.length===Y.length?Ui(q,Z):null)||U.addKeys(q),(Z||Y)&&(_=w,I=Z,O=Y,c.indexes.forEach(function(J){var ie=_(J.name||"");function xe(Ae){return Ae!=null?J.extractKey(Ae):null}function Ce(Ae){return J.multiEntry&&m(Ae)?Ae.forEach(function(Nt){return ie.addKey(Nt)}):ie.addKey(Ae)}(I||O).forEach(function(Ae,St){var _e=I&&xe(I[St]),St=O&&xe(O[St]);Ne(_e,St)!==0&&(_e!=null&&Ce(_e),St!=null&&Ce(St))})}))):q?(Y={from:(Y=q.lower)!==null&&Y!==void 0?Y:e.MIN_KEY,to:(Y=q.upper)!==null&&Y!==void 0?Y:e.MAX_KEY},U.add(Y),V.add(Y)):(V.add(r),U.add(r),c.indexes.forEach(function(J){return w(J.name).add(r)})),o.mutate(b).then(function(J){return!q||b.type!=="add"&&b.type!=="put"||(V.addKeys(J.results),y&&y.forEach(function(ie){for(var xe=b.values.map(function(_e){return ie.extractKey(_e)}),Ce=ie.keyPath.findIndex(function(_e){return _e===d.keyPath}),Ae=0,Nt=J.results.length;Ae<Nt;++Ae)xe[Ae][Ce]=J.results[Ae];w(ie.name).addKeys(xe)})),T.mutatedParts=hr(T.mutatedParts||{},D),J})}}),p=function(w){var _=w.query,w=_.index,_=_.range;return[w,new _t((w=_.lower)!==null&&w!==void 0?w:e.MIN_KEY,(_=_.upper)!==null&&_!==void 0?_:e.MAX_KEY)]},C={get:function(b){return[d,new _t(b.key)]},getMany:function(b){return[d,new _t().addKeys(b.keys)]},count:p,query:p,openCursor:p};return h(C).forEach(function(b){x[b]=function(w){var _=ue.subscr,I=!!_,O=Gi(ue,o)&&Wi(b,w)?w.obsSet={}:_;if(I){var T=function(Y){return Y="idb://".concat(n,"/").concat(i,"/").concat(Y),O[Y]||(O[Y]=new _t)},D=T(""),V=T(":dels"),_=C[b](w),I=_[0],_=_[1];if((b==="query"&&I.isPrimaryKey&&!w.values?V:T(I.name||"")).add(_),!I.isPrimaryKey){if(b!=="count"){var U=b==="query"&&g&&w.values&&o.query(s(s({},w),{values:!1}));return o[b].apply(this,arguments).then(function(Y){if(b==="query"){if(g&&w.values)return U.then(function(xe){return xe=xe.result,D.addKeys(xe),Y});var Z=w.values?Y.result.map(v):Y.result;(w.values?D:V).addKeys(Z)}else if(b==="openCursor"){var J=Y,ie=w.values;return J&&Object.create(J,{key:{get:function(){return V.addKey(J.primaryKey),J.key}},primaryKey:{get:function(){var xe=J.primaryKey;return V.addKey(xe),xe}},value:{get:function(){return ie&&D.addKey(J.primaryKey),J.value}}})}return Y})}V.add(r)}}return o[b].apply(this,arguments)}}),x}})}};function $i(e,n,r){if(r.numFailures===0)return n;if(n.type==="deleteRange")return null;var i=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;return r.numFailures===i?null:(n=s({},n),m(n.keys)&&(n.keys=n.keys.filter(function(o,c){return!(c in r.failures)})),"values"in n&&m(n.values)&&(n.values=n.values.filter(function(o,c){return!(c in r.failures)})),n)}function ai(e,n){return r=e,((i=n).lower===void 0||(i.lowerOpen?0<Ne(r,i.lower):0<=Ne(r,i.lower)))&&(e=e,(n=n).upper===void 0||(n.upperOpen?Ne(e,n.upper)<0:Ne(e,n.upper)<=0));var r,i}function Yi(e,n,C,i,o,c){if(!C||C.length===0)return e;var d=n.query.index,v=d.multiEntry,g=n.query.range,y=i.schema.primaryKey.extractKey,x=d.extractKey,p=(d.lowLevelIndex||d).extractKey,C=C.reduce(function(b,w){var _=b,I=[];if(w.type==="add"||w.type==="put")for(var O=new _t,T=w.values.length-1;0<=T;--T){var D,V=w.values[T],U=y(V);O.hasKey(U)||(D=x(V),(v&&m(D)?D.some(function(J){return ai(J,g)}):ai(D,g))&&(O.addKey(U),I.push(V)))}switch(w.type){case"add":var X=new _t().addKeys(n.values?b.map(function(ie){return y(ie)}):b),_=b.concat(n.values?I.filter(function(ie){return ie=y(ie),!X.hasKey(ie)&&(X.addKey(ie),!0)}):I.map(function(ie){return y(ie)}).filter(function(ie){return!X.hasKey(ie)&&(X.addKey(ie),!0)}));break;case"put":var q=new _t().addKeys(w.values.map(function(ie){return y(ie)}));_=b.filter(function(ie){return!q.hasKey(n.values?y(ie):ie)}).concat(n.values?I:I.map(function(ie){return y(ie)}));break;case"delete":var Y=new _t().addKeys(w.keys);_=b.filter(function(ie){return!Y.hasKey(n.values?y(ie):ie)});break;case"deleteRange":var Z=w.range;_=b.filter(function(ie){return!ai(y(ie),Z)})}return _},e);return C===e?e:(C.sort(function(b,w){return Ne(p(b),p(w))||Ne(y(b),y(w))}),n.limit&&n.limit<1/0&&(C.length>n.limit?C.length=n.limit:e.length===n.limit&&C.length<n.limit&&(o.dirty=!0)),c?Object.freeze(C):C)}function Ji(e,n){return Ne(e.lower,n.lower)===0&&Ne(e.upper,n.upper)===0&&!!e.lowerOpen==!!n.lowerOpen&&!!e.upperOpen==!!n.upperOpen}function io(e,n){return(function(r,i,o,c){if(r===void 0)return i!==void 0?-1:0;if(i===void 0)return 1;if((i=Ne(r,i))===0){if(o&&c)return 0;if(o)return 1;if(c)return-1}return i})(e.lower,n.lower,e.lowerOpen,n.lowerOpen)<=0&&0<=(function(r,i,o,c){if(r===void 0)return i!==void 0?1:0;if(i===void 0)return-1;if((i=Ne(r,i))===0){if(o&&c)return 0;if(o)return-1;if(c)return 1}return i})(e.upper,n.upper,e.upperOpen,n.upperOpen)}function ao(e,n,r,i){e.subscribers.add(r),i.addEventListener("abort",function(){var o,c;e.subscribers.delete(r),e.subscribers.size===0&&(o=e,c=n,setTimeout(function(){o.subscribers.size===0&&Re(c,o)},3e3))})}var oo={stack:"dbcore",level:0,name:"Cache",create:function(e){var n=e.schema.name;return s(s({},e),{transaction:function(r,i,o){var c,d,v=e.transaction(r,i,o);return i==="readwrite"&&(d=(c=new AbortController).signal,o=function(g){return function(){if(c.abort(),i==="readwrite"){for(var y=new Set,x=0,p=r;x<p.length;x++){var C=p[x],b=un["idb://".concat(n,"/").concat(C)];if(b){var w=e.table(C),_=b.optimisticOps.filter(function(ie){return ie.trans===v});if(v._explicit&&g&&v.mutatedParts)for(var I=0,O=Object.values(b.queries.query);I<O.length;I++)for(var T=0,D=(X=O[I]).slice();T<D.length;T++)Xr((q=D[T]).obsSet,v.mutatedParts)&&(Re(X,q),q.subscribers.forEach(function(ie){return y.add(ie)}));else if(0<_.length){b.optimisticOps=b.optimisticOps.filter(function(ie){return ie.trans!==v});for(var V=0,U=Object.values(b.queries.query);V<U.length;V++)for(var X,q,Y,Z=0,J=(X=U[V]).slice();Z<J.length;Z++)(q=J[Z]).res!=null&&v.mutatedParts&&(g&&!q.dirty?(Y=Object.isFrozen(q.res),Y=Yi(q.res,q.req,_,w,q,Y),q.dirty?(Re(X,q),q.subscribers.forEach(function(ie){return y.add(ie)})):Y!==q.res&&(q.res=Y,q.promise=te.resolve({result:Y}))):(q.dirty&&Re(X,q),q.subscribers.forEach(function(ie){return y.add(ie)})))}}}y.forEach(function(ie){return ie()})}}},v.addEventListener("abort",o(!1),{signal:d}),v.addEventListener("error",o(!1),{signal:d}),v.addEventListener("complete",o(!0),{signal:d})),v},table:function(r){var i=e.table(r),o=i.schema.primaryKey;return s(s({},i),{mutate:function(c){var d=ue.trans;if(o.outbound||d.db._options.cache==="disabled"||d.explicit||d.idbtrans.mode!=="readwrite")return i.mutate(c);var v=un["idb://".concat(n,"/").concat(r)];return v?(d=i.mutate(c),c.type!=="add"&&c.type!=="put"||!(50<=c.values.length||ii(o,c).some(function(g){return g==null}))?(v.optimisticOps.push(c),c.mutatedParts&&vr(c.mutatedParts),d.then(function(g){0<g.numFailures&&(Re(v.optimisticOps,c),(g=$i(0,c,g))&&v.optimisticOps.push(g),c.mutatedParts&&vr(c.mutatedParts))}),d.catch(function(){Re(v.optimisticOps,c),c.mutatedParts&&vr(c.mutatedParts)})):d.then(function(g){var y=$i(0,s(s({},c),{values:c.values.map(function(x,p){var C;return g.failures[p]?x:(x=(C=o.keyPath)!==null&&C!==void 0&&C.includes(".")?Se(x):s({},x),se(x,o.keyPath,g.results[p]),x)})}),g);v.optimisticOps.push(y),queueMicrotask(function(){return c.mutatedParts&&vr(c.mutatedParts)})}),d):i.mutate(c)},query:function(c){if(!Gi(ue,i)||!Wi("query",c))return i.query(c);var d=((y=ue.trans)===null||y===void 0?void 0:y.db._options.cache)==="immutable",p=ue,v=p.requery,g=p.signal,y=(function(w,_,I,O){var T=un["idb://".concat(w,"/").concat(_)];if(!T)return[];if(!(_=T.queries[I]))return[null,!1,T,null];var D=_[(O.query?O.query.index.name:null)||""];if(!D)return[null,!1,T,null];switch(I){case"query":var V=D.find(function(U){return U.req.limit===O.limit&&U.req.values===O.values&&Ji(U.req.query.range,O.query.range)});return V?[V,!0,T,D]:[D.find(function(U){return("limit"in U.req?U.req.limit:1/0)>=O.limit&&(!O.values||U.req.values)&&io(U.req.query.range,O.query.range)}),!1,T,D];case"count":return V=D.find(function(U){return Ji(U.req.query.range,O.query.range)}),[V,!!V,T,D]}})(n,r,"query",c),x=y[0],p=y[1],C=y[2],b=y[3];return x&&p?x.obsSet=c.obsSet:(p=i.query(c).then(function(w){var _=w.result;if(x&&(x.res=_),d){for(var I=0,O=_.length;I<O;++I)Object.freeze(_[I]);Object.freeze(_)}else w.result=Se(_);return w}).catch(function(w){return b&&x&&Re(b,x),Promise.reject(w)}),x={obsSet:c.obsSet,promise:p,subscribers:new Set,type:"query",req:c,dirty:!1},b?b.push(x):(b=[x],(C=C||(un["idb://".concat(n,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[c.query.index.name||""]=b)),ao(x,b,v,g),x.promise.then(function(w){return{result:Yi(w.result,c,C?.optimisticOps,i,x,d)}})}})}})}};function gr(e,n){return new Proxy(e,{get:function(r,i,o){return i==="db"?n:Reflect.get(r,i,o)}})}var Wt=(ft.prototype.version=function(e){if(isNaN(e)||e<.1)throw new W.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new W.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(Ya),r.stores({}),this._state.autoSchema=!1,r)},ft.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||ue.letThrough||this._vip)?e():new te(function(r,i){if(n._state.openComplete)return i(new W.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._state.autoOpen)return void i(new W.DatabaseClosed);n.open().catch(me)}n._state.dbReadyPromise.then(r,i)}).then(e)},ft.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,o=e.name;return o&&this.unuse({stack:n,name:o}),e=this._middlewares[n]||(this._middlewares[n]=[]),e.push({stack:n,create:r,level:i??10,name:o}),e.sort(function(c,d){return c.level-d.level}),this},ft.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(o){return i?o.create!==i:!!r&&o.name!==r})),this},ft.prototype.open=function(){var e=this;return sn(Ft,function(){return Za(e)})},ft.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,n=yn.indexOf(this);if(0<=n&&yn.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new te(function(r){e.dbReadyResolve=r}),e.openCanceller=new te(function(r,i){e.cancelOpen=i}))},ft.prototype.close=function(r){var n=(r===void 0?{disableAutoOpen:!0}:r).disableAutoOpen,r=this._state;n?(r.isBeingOpened&&r.cancelOpen(new W.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new W.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},ft.prototype.delete=function(e){var n=this;e===void 0&&(e={disableAutoOpen:!0});var r=0<arguments.length&&typeof arguments[0]!="object",i=this._state;return new te(function(o,c){function d(){n.close(e);var v=n._deps.indexedDB.deleteDatabase(n.name);v.onsuccess=rt(function(){var g,y,x;g=n._deps,y=n.name,x=g.indexedDB,g=g.IDBKeyRange,Yr(x)||y===tr||$r(x,g).delete(y).catch(me),o()}),v.onerror=zt(c),v.onblocked=n._fireOnBlocked}if(r)throw new W.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(d):d()})},ft.prototype.backendDB=function(){return this.idbdb},ft.prototype.isOpen=function(){return this.idbdb!==null},ft.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},ft.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ft.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ft.prototype,"tables",{get:function(){var e=this;return h(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),ft.prototype.transaction=function(){var e=(function(n,r,i){var o=arguments.length;if(o<2)throw new W.InvalidArgument("Too few arguments");for(var c=new Array(o-1);--o;)c[o-1]=arguments[o];return i=c.pop(),[n,de(c),i]}).apply(this,arguments);return this._transaction.apply(this,e)},ft.prototype._transaction=function(e,n,r){var i=this,o=ue.trans;o&&o.db===this&&e.indexOf("!")===-1||(o=null);var c,d,v=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(d=n.map(function(y){if(y=y instanceof i.Table?y.name:y,typeof y!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return y}),e=="r"||e===Rr)c=Rr;else{if(e!="rw"&&e!=Vr)throw new W.InvalidArgument("Invalid transaction mode: "+e);c=Vr}if(o){if(o.mode===Rr&&c===Vr){if(!v)throw new W.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&d.forEach(function(y){if(o&&o.storeNames.indexOf(y)===-1){if(!v)throw new W.SubTransaction("Table "+y+" not included in parent transaction.");o=null}}),v&&o&&!o.active&&(o=null)}}catch(y){return o?o._promise(null,function(x,p){p(y)}):dt(y)}var g=(function y(x,p,C,b,w){return te.resolve().then(function(){var _=ue.transless||ue,I=x._createTransaction(p,C,x._dbSchema,b);if(I.explicit=!0,_={trans:I,transless:_},b)I.idbtrans=b.idbtrans;else try{I.create(),I.idbtrans._explicit=!0,x._state.PR1398_maxLoop=3}catch(D){return D.name===ce.InvalidState&&x.isOpen()&&0<--x._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),x.close({disableAutoOpen:!1}),x.open().then(function(){return y(x,p,C,null,w)})):dt(D)}var O,T=et(w);return T&&mn(),_=te.follow(function(){var D;(O=w.call(I,I))&&(T?(D=Jt.bind(null,null),O.then(D,D)):typeof O.next=="function"&&typeof O.throw=="function"&&(O=ni(O)))},_),(O&&typeof O.then=="function"?te.resolve(O).then(function(D){return I.active?D:dt(new W.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):_.then(function(){return O})).then(function(D){return b&&I._resolve(),I._completion.then(function(){return D})}).catch(function(D){return I._reject(D),dt(D)})})}).bind(null,this,c,d,o,r);return o?o._promise(c,g,"lock"):ue.trans?sn(ue.transless,function(){return i._whenReady(g)}):this._whenReady(g)},ft.prototype.table=function(e){if(!F(this._allTables,e))throw new W.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},ft);function ft(e,n){var r=this;this._middlewares={},this.verno=0;var i=ft.dependencies;this._options=n=s({addons:ft.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},i=n.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o,c,d,v,g,y={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:me,dbReadyPromise:null,cancelOpen:me,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};y.dbReadyPromise=new te(function(p){y.dbReadyResolve=p}),y.openCanceller=new te(function(p,C){y.cancelOpen=C}),this._state=y,this.name=e,this.on=Nn(this,"populate","blocked","versionchange","close",{ready:[Ye,me]}),this.once=function(p,C){var b=function(){for(var w=[],_=0;_<arguments.length;_++)w[_]=arguments[_];r.on(p).unsubscribe(b),C.apply(r,w)};return r.on(p,b)},this.on.ready.subscribe=K(this.on.ready.subscribe,function(p){return function(C,b){ft.vip(function(){var w,_=r._state;_.openComplete?(_.dbOpenError||te.resolve().then(C),b&&p(C)):_.onReadyBeingFired?(_.onReadyBeingFired.push(C),b&&p(C)):(p(C),w=r,b||p(function I(){w.on.ready.unsubscribe(C),w.on.ready.unsubscribe(I)}))})}}),this.Collection=(o=this,Mn(Ka.prototype,function(O,I){this.db=o;var b=Ci,w=null;if(I)try{b=I()}catch(T){w=T}var _=O._ctx,I=_.table,O=I.hook.reading.fire;this._ctx={table:I,index:_.index,isPrimKey:!_.index||I.schema.primKey.keyPath&&_.index===I.schema.primKey.name,range:b,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:w,or:_.or,valueMapper:O!==Be?O:null}})),this.Table=(c=this,Mn(Ei.prototype,function(p,C,b){this.db=c,this._tx=b,this.name=p,this.schema=C,this.hook=c._allTables[p]?c._allTables[p].hook:Nn(null,{creating:[vt,me],reading:[ut,Be],updating:[Ge,me],deleting:[pt,me]})})),this.Transaction=(d=this,Mn(Ua.prototype,function(p,C,b,w,_){var I=this;p!=="readonly"&&C.forEach(function(O){O=(O=b[O])===null||O===void 0?void 0:O.yProps,O&&(C=C.concat(O.map(function(T){return T.updatesTable})))}),this.db=d,this.mode=p,this.storeNames=C,this.schema=b,this.chromeTransactionDurability=w,this.idbtrans=null,this.on=Nn(this,"complete","error","abort"),this.parent=_||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new te(function(O,T){I._resolve=O,I._reject=T}),this._completion.then(function(){I.active=!1,I.on.complete.fire()},function(O){var T=I.active;return I.active=!1,I.on.error.fire(O),I.parent?I.parent._reject(O):T&&I.idbtrans&&I.idbtrans.abort(),dt(O)})})),this.Version=(v=this,Mn(Xa.prototype,function(p){this.db=v,this._cfg={version:p,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(g=this,Mn(Li.prototype,function(p,C,b){if(this.db=g,this._ctx={table:p,index:C===":id"?null:C,or:b},this._cmp=this._ascending=Ne,this._descending=function(w,_){return Ne(_,w)},this._max=function(w,_){return 0<Ne(w,_)?w:_},this._min=function(w,_){return Ne(w,_)<0?w:_},this._IDBKeyRange=g._deps.IDBKeyRange,!this._IDBKeyRange)throw new W.MissingAPI})),this.on("versionchange",function(p){0<p.newVersion?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(p){!p.newVersion||p.newVersion<p.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(p.oldVersion/10))}),this._maxKey=Vn(n.IDBKeyRange),this._createTransaction=function(p,C,b,w){return new r.Transaction(p,C,b,r._options.chromeTransactionDurability,w)},this._fireOnBlocked=function(p){r.on("blocked").fire(p),yn.filter(function(C){return C.name===r.name&&C!==r&&!C._state.vcFired}).map(function(C){return C.on("versionchange").fire(p)})},this.use(no),this.use(oo),this.use(ro),this.use(eo),this.use(to);var x=new Proxy(this,{get:function(p,C,b){if(C==="_vip")return!0;if(C==="table")return function(_){return gr(r.table(_),x)};var w=Reflect.get(p,C,b);return w instanceof Ei?gr(w,x):C==="tables"?w.map(function(_){return gr(_,x)}):C==="_createTransaction"?function(){return gr(w.apply(this,arguments),x)}:w}});this.vip=x,i.forEach(function(p){return p(r)})}var mr,Rt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",so=(oi.prototype.subscribe=function(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})},oi.prototype[Rt]=function(){return this},oi);function oi(e){this._subscribe=e}try{mr={indexedDB:f.indexedDB||f.mozIndexedDB||f.webkitIndexedDB||f.msIndexedDB,IDBKeyRange:f.IDBKeyRange||f.webkitIDBKeyRange}}catch{mr={indexedDB:null,IDBKeyRange:null}}function Qi(e){var n,r=!1,i=new so(function(o){var c=et(e),d,v=!1,g={},y={},x={get closed(){return v},unsubscribe:function(){v||(v=!0,d&&d.abort(),p&&Zt.storagemutated.unsubscribe(b))}};o.start&&o.start(x);var p=!1,C=function(){return Lr(w)},b=function(_){hr(g,_),Xr(y,g)&&C()},w=function(){var _,I,O;!v&&mr.indexedDB&&(g={},_={},d&&d.abort(),d=new AbortController,O=(function(T){var D=pn();try{c&&mn();var V=Yt(e,T);return V=c?V.finally(Jt):V}finally{D&&gn()}})(I={subscr:_,signal:d.signal,requery:C,querier:e,trans:null}),Promise.resolve(O).then(function(T){r=!0,n=T,v||I.signal.aborted||(g={},(function(D){for(var V in D)if(F(D,V))return;return 1})(y=_)||p||(Zt(Rn,b),p=!0),Lr(function(){return!v&&o.next&&o.next(T)}))},function(T){r=!1,["DatabaseClosedError","AbortError"].includes(T?.name)||v||Lr(function(){v||o.error&&o.error(T)})}))};return setTimeout(C,0),x});return i.hasValue=function(){return r},i.getValue=function(){return n},i}var dn=Wt;function si(e){var n=en;try{en=!0,Zt.storagemutated.fire(e),ti(e,!0)}finally{en=n}}N(dn,s(s({},qe),{delete:function(e){return new dn(e,{addons:[]}).delete()},exists:function(e){return new dn(e,{addons:[]}).open().then(function(n){return n.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return n=dn.dependencies,r=n.indexedDB,n=n.IDBKeyRange,(Yr(r)?Promise.resolve(r.databases()).then(function(i){return i.map(function(o){return o.name}).filter(function(o){return o!==tr})}):$r(r,n).toCollection().primaryKeys()).then(e)}catch{return dt(new W.MissingAPI)}var n,r},defineClass:function(){return function(e){P(this,e)}},ignoreTransaction:function(e){return ue.trans?sn(ue.transless,e):e()},vip:Jr,async:function(e){return function(){try{var n=ni(e.apply(this,arguments));return n&&typeof n.then=="function"?n:te.resolve(n)}catch(r){return dt(r)}}},spawn:function(e,n,r){try{var i=ni(e.apply(r,n||[]));return i&&typeof i.then=="function"?i:te.resolve(i)}catch(o){return dt(o)}},currentTransaction:{get:function(){return ue.trans||null}},waitFor:function(e,n){return n=te.resolve(typeof e=="function"?dn.ignoreTransaction(e):e).timeout(n||6e4),ue.trans?ue.trans.waitFor(n):n},Promise:te,debug:{get:function(){return We},set:function(e){gt(e)}},derive:L,extend:P,props:N,override:K,Events:Nn,on:Zt,liveQuery:Qi,extendObservabilitySet:hr,getByKeyPath:re,setByKeyPath:se,delByKeyPath:function(e,n){typeof n=="string"?se(e,n,void 0):"length"in n&&[].map.call(n,function(r){se(e,r,void 0)})},shallowClone:ge,deepClone:Se,getObjectDiff:ri,cmp:Ne,asap:le,minKey:-1/0,addons:[],connections:yn,errnames:ce,dependencies:mr,cache:un,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,n,r){return e+n/Math.pow(10,2*r)})})),dn.maxKey=Vn(dn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Zt(Rn,function(e){en||(e=new CustomEvent(zr,{detail:e}),en=!0,dispatchEvent(e),en=!1)}),addEventListener(zr,function(e){e=e.detail,en||si(e)}));var Sn,en=!1,Xi=function(){};return typeof BroadcastChannel<"u"&&((Xi=function(){(Sn=new BroadcastChannel(zr)).onmessage=function(e){return e.data&&si(e.data)}})(),typeof Sn.unref=="function"&&Sn.unref(),Zt(Rn,function(e){en||Sn.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Wt.disableBfCache&&e.persisted){We&&console.debug("Dexie: handling persisted pagehide"),Sn?.close();for(var n=0,r=yn;n<r.length;n++)r[n].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Wt.disableBfCache&&e.persisted&&(We&&console.debug("Dexie: handling persisted pageshow"),Xi(),si({all:new _t(-1/0,[[]])}))})),te.rejectionMapper=function(e,n){return!e||e instanceof ve||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ot[e.name]?e:(n=new ot[e.name](n||e.message,e),"stack"in e&&R(n,"stack",{get:function(){return this.inner.stack}}),n)},gt(We),s(Wt,Object.freeze({__proto__:null,Dexie:Wt,liveQuery:Qi,Entity:ki,cmp:Ne,PropModification:Dn,replacePrefix:function(e,n){return new Dn({replacePrefix:[e,n]})},add:function(e){return new Dn({add:e})},remove:function(e){return new Dn({remove:e})},default:Wt,RangeSet:_t,mergeRanges:zn,rangesOverlap:zi}),{default:Wt}),Wt})})(Cr)),Cr.exports}var Zs=Xs();const fi=as(Zs),ga=Symbol.for("Dexie"),Ar=globalThis[ga]||(globalThis[ga]=fi);if(fi.semVer!==Ar.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${fi.semVer} and ${Ar.semVer}`);const{liveQuery:Zu,mergeRanges:ed,rangesOverlap:td,RangeSet:nd,cmp:rd,Entity:id,PropModification:ad,replacePrefix:od,add:sd,remove:ld,DexieYProvider:cd}=Ar,Wn="current";class el extends Ar{uprnSelections;areaSelections;dataSelections;userDownloads;constructor(){super("app-db2"),this.version(2).stores({uprnSelections:"&id",areaSelections:"++id, layerId, *areaIds",dataSelections:"++id, layerId, *fields",userDownloads:"++id, &localId, createdAt"}),this.on("populate",async t=>{if(console.log("[db] Populating database with initial data"),await t.table("uprnSelections").get(Wn)){console.log("[db] Initial UPRN selection already exists");return}await t.table("uprnSelections").add({id:"current",areas:null,data:[]}),console.log("[db] Initial UPRN selection created")})}}const an=new el,Oa=async()=>await an.uprnSelections.get(Wn),Kn=async S=>{let t=await Oa();t||(t={id:Wn,areas:null,data:[]},await an.uprnSelections.add(t)),console.log("[db] Updating UPRN selection with patch:",S,"current:",t),await an.uprnSelections.update(Wn,S)},tl=async()=>{await an.uprnSelections.put({id:Wn,areas:null,data:[]})},nl=async(S,t,a)=>await an.userDownloads.add({localId:S,areaSelection:t,dataSelections:a,status:tn.Pending,createdAt:Date.now()}),rl=async(S,t,a,s)=>{const u={};t!==void 0&&(u.externalId=t),a!==void 0&&(u.areaSelection=a),s!==void 0&&(u.dataSelections=s),Object.keys(u).length!==0&&await an.userDownloads.where("localId").equals(S).modify(u)},il=async()=>await an.userDownloads.orderBy("createdAt").reverse().toArray(),al=async S=>await an.userDownloads.where("localId").equals(S).delete();class ol{#e=ne(je(new It));constructor(){this.#t()}addDownload(t){console.log("[downloads-store] Adding download:",t),l(this.#e).set(t.localId,t),nl(t.localId,t.areaSelection,t.dataSelections)}updateDownloadStatus(t){console.log("[downloads-store] Updating download status:",t),l(this.#e).set(t.localId,{...t}),rl(t.localId,t.externalId,t.areaSelection,t.dataSelections)}removeDownload(t){l(this.#e).delete(t),al(t)}getDownloads(){return Array.from(l(this.#e).values())}async#t(){const t=await il();!t||t.length===0||(console.log("Loaded downloads from DB:",t),t.forEach(a=>{l(this.#e).set(a.localId,{localId:a.localId,status:tn.Pending,areaSelection:a.areaSelection,dataSelections:a.dataSelections})}))}}const qn=new ol;function sl(S,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]];Tn(S,Ot({name:"download"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);En(m,t,"default",{}),E(u,h)},$$slots:{default:!0}}))}var ll=oe('<div class="data-item svelte-v4uih6"><span class="data-name svelte-v4uih6"> </span> <div class="data-actions svelte-v4uih6"><!></div></div>');function hi(S,t){const a=Ee(t,"title",3,"");Tr(S,{class:"data-item-card",children:(s,u)=>{var f=ll(),h=ee(f),m=ee(h,!0);Q(h);var P=he(h,2),k=ee(P);Ze(k,()=>t.children??Qe),Q(P),Q(f),ht(()=>{yi(h,"title",a()),Et(m,a())}),E(s,f)},$$slots:{default:!0}})}var cl=oe("<!> <!> <!> <!>",1),ul=oe('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),dl=oe('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),fl=oe('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function hl(S,t){Me(t,!0);let a=ne(je(new Set));const s=fe(()=>qn.getDownloads()),u={completed:{color:"#059669",text:"Completed",icon:Ao},"in-progress":{color:"#2563eb",text:"In Progress",icon:ko},failed:{color:"#dc2626",text:"Failed",icon:Co},pending:{color:"#6b7280",text:"Pending",icon:rs}};xn(()=>{const H=setInterval(()=>{f()},5e3);return()=>{clearInterval(H)}}),$e(()=>{if(!l(s)||l(s).length<=0||!t.uprnDownloadService)return;(async()=>{for(const M of l(s)){if(M.externalId||M.status!==tn.Pending)continue;const z={exports:{areaSelectionLayer:{remoteId:M.areaSelection.layerId,areas:M.areaSelection.areaFieldInfos.map(G=>G.code)},dataSelectionLayers:M.dataSelections.map(G=>({remoteId:G.layerId,fields:G.fields.filter(le=>!t.fieldsToHide||!t.fieldsToHide.has(le))}))}};console.log("[downloads-menu] Submitting download request:",z);const K=await t.uprnDownloadService.requestJob(z);if(!K||K.type===Js.Error){console.error("[downloads-menu] Failed to submit download request.",K);continue}M.externalId=K.guid,M.status=tn.InProgress,qn.updateDownloadStatus(M)}})()});async function f(){if(l(s).length<=0||!t.uprnDownloadService)return;const H={jobs:l(s).filter(z=>z.externalId).map(z=>z.externalId)},M=await t.uprnDownloadService.requestJobStatuses(H);if(!M){console.error("[downloads-menu] Failed to get job statuses.",M);return}for(const z of M.jobs){const K=l(s).find(G=>G.externalId===z.guid);if(!K){console.warn("[downloads-menu] Received job status for unknown download:",z.guid);continue}switch(z.status.type){case xr.Submitted:case xr.Processing:K.status=tn.InProgress;break;case xr.Completed:K.status=tn.Completed;break;case xr.Error:K.status=tn.Failed;break;default:console.warn("[downloads-menu] Unknown job status type:",z.status.type);break}qn.updateDownloadStatus(K)}}function h(H){qn.removeDownload(H)}async function m(H){try{await navigator.clipboard.writeText(H),B(a,new Set(l(a)).add(H),!0),Un.success("URL copied to clipboard"),setTimeout(()=>{const M=new Set(l(a));M.delete(H),B(a,M,!0)},2e3)}catch(M){console.error("Failed to copy URL:",M),Un.error("Failed to copy URL to clipboard")}}function P(H){return u[H]?.color??u.pending.color}function k(H){return u[H]?.text??u.pending.text}function A(H){return u[H]?.icon??u.pending.icon}function F(H){return t.uprnDownloadService.getDownloadUrl(H)}var N=fl(),j=he(ee(N),2);{var R=H=>{var M=ul(),z=$(M);Bt(z,21,()=>l(s),kn,(le,re)=>{{let se=fe(()=>l(re).externalId?l(re).externalId:"Pending...");hi(le,{get title(){return l(se)},children:(ge,ke)=>{var de=cl(),be=$(de);{let we=fe(()=>P(l(re).status)),Re=fe(()=>k(l(re).status));Tt(be,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${l(we)??""}`},get title(){return l(Re)},disabled:!0,children:(ye,Oe)=>{const et=fe(()=>A(l(re).status));var at=ae(),ve=$(at);{let Ke=fe(()=>l(re).status==="in-progress"?"spinning":"");Te(ve,()=>l(et),(tt,Pe)=>{Pe(tt,{size:14,get class(){return l(Ke)}})})}E(ye,at)},$$slots:{default:!0}})}var Ie=he(be,2);{var Se=we=>{Tt(we,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>m(F(l(re).externalId)),title:"Copy URL to clipboard",children:(Re,ye)=>{var Oe=ae(),et=$(Oe);{var at=Ke=>{xo(Ke,{size:14})},ve=Ke=>{Io(Ke,{size:14})};pe(et,Ke=>{l(a).has(F(l(re).externalId))?Ke(at):Ke(ve,!1)})}E(Re,Oe)},$$slots:{default:!0}})};pe(Ie,we=>{l(re).externalId&&we(Se)})}var Fe=he(Ie,2);{var He=we=>{Tt(we,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(F(l(re).externalId),"_blank"),title:"Open download",children:(Re,ye)=>{sl(Re,{})},$$slots:{default:!0}})};pe(Fe,we=>{l(re).externalId&&l(re).status==="completed"&&we(He)})}var Xe=he(Fe,2);Tt(Xe,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>h(l(re).localId),title:"Remove from queue",children:(we,Re)=>{hn();var ye=In("Ã");E(we,ye)},$$slots:{default:!0}}),E(ge,de)},$$slots:{default:!0}})}}),Q(z);var K=he(z,2),G=ee(K);Q(K),ht(()=>Et(G,`${l(s).length??""} download(s) in queue`)),E(H,M)},L=H=>{var M=dl();E(H,M)};pe(j,H=>{l(s).length>0?H(R):H(L,!1)})}Q(N),E(S,N),Le()}function vl(S,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"m6 9 6 6 6-6"}]];Tn(S,Ot({name:"chevron-down"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);En(m,t,"default",{}),E(u,h)},$$slots:{default:!0}}))}function pl(S,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"m15 18-6-6 6-6"}]];Tn(S,Ot({name:"chevron-left"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);En(m,t,"default",{}),E(u,h)},$$slots:{default:!0}}))}function gl(S,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"m18 15-6-6-6 6"}]];Tn(S,Ot({name:"chevron-up"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);En(m,t,"default",{}),E(u,h)},$$slots:{default:!0}}))}function ml(S,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];Tn(S,Ot({name:"menu"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);En(m,t,"default",{}),E(u,h)},$$slots:{default:!0}}))}function yl(S,t){const a=On(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];Tn(S,Ot({name:"trash"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);En(m,t,"default",{}),E(u,h)},$$slots:{default:!0}}))}function bl(S,t){Me(t,!0);{let a=fe(()=>$n("size-7 border-1 border-destructive",t.class));Tt(S,{onclick:()=>t.clear(),variant:"ghost",get class(){return l(a)},title:"Clear all selections",children:(s,u)=>{yl(s,{class:"text-destructive"})},$$slots:{default:!0}})}Le()}class wl{#e=ne(je(new It));get dataSelections(){return l(this.#e)}set dataSelections(t){B(this.#e,t,!0)}addSelection(t){this.dataSelections.set(t.layerId,t)}updateSelection(t,a){const s=this.dataSelections.get(t);if(!s){console.warn(`[data-selection-store] no existing selection for layerId ${t}`);return}s.selectedFieldIds=new Mt(a),this.dataSelections.set(t,{...s})}addOrUpdateSelection(t,a){const s=this.dataSelections.get(t);if(s)s.selectedFieldIds=new Mt(a),this.dataSelections.set(t,{...s});else{const u={layerId:t,selectedFieldIds:new Mt(a)};this.dataSelections.set(t,u)}}removeSelection(t){this.dataSelections.delete(t)}getSelection(t){return this.dataSelections.get(t)}getAllSelections(){return Array.from(this.dataSelections.values())}clearSelections(){this.dataSelections.clear(),console.log("[data-selection-store] selections cleared.")}cleanup(){this.dataSelections.clear()}}var _l=oe('<div class="export-footer svelte-10dgoyk"><div class="export-footer__left svelte-10dgoyk"><p class="text-sm text-muted-foreground svelte-10dgoyk">Click "Export" to begin the download.</p></div> <div class="export-footer__right svelte-10dgoyk"><!> <!></div></div>');function Sl(S,t){Me(t,!0);function a(){if(t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size<=0){Un.error("Please select at least one area to export.");return}if(t.dataSelectionStore.getAllSelections().length<=0){Un.error("Please select at least one data layer to export.");return}console.log("Starting export..."),(async()=>{const P=await t.areaSelectionInteractionStore.getAreaCodesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),k=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().map(([j,R],L)=>({id:j,code:P[L]})).toArray(),A={layerId:t.areaSelectionInteractionStore.selectionViewState.layerView?.layer.id||"",areaFieldInfos:k},F=t.dataSelectionStore.getAllSelections().map(j=>({layerId:j.layerId,fields:Array.from(j.selectedFieldIds)})),N=crypto.randomUUID();qn.addDownload({localId:N,status:tn.Pending,areaSelection:A,dataSelections:F}),t.onExportSuccess?.()})()}var s=_l(),u=he(ee(s),2),f=ee(u);bl(f,{class:"mr-4",get clear(){return t.clearSelections}});var h=he(f,2);Tt(h,{onclick:a,title:"Export",children:(m,P)=>{hn();var k=In("Export");E(m,k)},$$slots:{default:!0}}),Q(u),Q(s),E(S,s),Le()}class xl{#e=ne(null);get ActiveLayer(){return l(this.#e)}set ActiveLayer(t){B(this.#e,t,!0)}}class Il{#e=ne(!1);get isLoaded(){return l(this.#e)}set isLoaded(t){B(this.#e,t,!0)}#t=ne(null);get data(){return l(this.#t)}set data(t){B(this.#t,t,!0)}#n=fe(()=>{const t=new It;function a(s){t.set(s.id,s),s.type==="group"&&s.layers.forEach(f=>{a(f)})}return this.data&&this.data.layers.forEach(s=>{a(s)}),t});get dataLookup(){return l(this.#n)}set dataLookup(t){B(this.#n,t)}#r=ne(!1);get loading(){return l(this.#r)}set loading(t){B(this.#r,t,!0)}#i=ne(null);get error(){return l(this.#i)}set error(t){B(this.#i,t,!0)}async initializeAsync(t){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:a,itemId:s,proxy:u}=t;await this.configurePortalAsync(a,u),await this.loadwebmapAsync(s)}catch(a){console.error("Error initializing webmap:",a),this.error=a.message}finally{this.loading=!1}}}async configurePortalAsync(t,a){if(!t||(ra.portalUrl=t,console.log(ra),!a))return;const{addProxyRule:s}=cs;console.log("Adding proxy rule for portal traffic"),s({urlPrefix:a?.urlPrefix,proxyUrl:a?.proxyUrl})}async loadwebmapAsync(t){if(this.data)return;const a=new ls({id:t}),s=new ss({portalItem:a});this.data=s,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}function Cl(S,t){S.stopPropagation(),t.onFilterClicked?.(t.layerId)}var kl=oe('<button title="Filter"><!></button>');function Al(S,t){Me(t,!0);let a=ne(je(t.hasFiltersApplied?.(t.layerId)??!1));$e(()=>{B(a,t.hasFiltersApplied?.(t.layerId)??!1,!0)});const s=fe(()=>l(a)?Oo:Po);var u=kl();let f;u.__click=[Cl,t];var h=ee(u);Gn(h,()=>l(s)),Q(u),ht(m=>{f=rn(u,1,"filter-btn svelte-k95pvd",null,f,m),yi(u,"aria-pressed",l(a))},[()=>({active:l(a)})]),E(S,u),Le()}Er(["click"]);var Ol=oe('<ul class="selected-list"></ul> <p class="count svelte-81yb5c"> </p>',1),Pl=oe('<p class="no-selection svelte-81yb5c">No areas selected</p>'),Tl=oe("<!> <!>",1),El=oe('<ul></ul> <p class="count svelte-81yb5c"> </p>',1),Fl=oe('<p class="no-selection svelte-81yb5c">No data selected</p>'),Dl=oe('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function Nl(S,t){Me(t,!0);const a=Ee(t,"fieldFilterMenuStore",7);let s=ne(je([]));$e(()=>{if(!t.areaSelectionInteractionStore){B(s,[],!0);return}if(!t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size){B(s,[],!0);return}(async()=>{const G=await t.areaSelectionInteractionStore.getAreaNamesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),le=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().toArray().map(([se,ge])=>({id:se,handle:ge})),re=[];for(let se=0;se<G.length;se++)re.push({name:G[se]||"Unknown Area",HighlightAreaInfo:le[se]});B(s,re,!0)})()});function u(K){const G=l(s).findIndex(le=>le.name===K);G!==-1&&t.areaSelectionInteractionStore.removeSelectedArea(l(s)[G]?.HighlightAreaInfo.id)}function f(K){console.log("[export-menu] Removing data selection for layerId:",K),t.dataSelectionStore.removeSelection(K),console.log("[export-menu] Current SelectedData:",ui(t.dataSelectionStore.getAllSelections()))}function h(K){if(a().ActiveLayer?.id===K){a().ActiveLayer=null;return}const G=t.webMapStore.dataLookup.get(K);if(!G){console.warn(`[export-menu] Layer with ID ${K} not found in web map store.`);return}a().ActiveLayer=G}function m(K){const G=t.dataSelectionStore.getSelection(K);return!(!G||!G.selectedFieldIds||G.selectedFieldIds.size===0||G.selectedFieldIds.size===t.webMapStore.dataLookup.get(K)?.fields?.length)}var P=Dl(),k=he($(P),2),A=ee(k),F=ee(A,!0);Q(A);var N=he(A,4);{var j=K=>{var G=Ol(),le=$(G);Bt(le,21,()=>l(s),kn,(ge,ke)=>{hi(ge,{get title(){return l(ke).name},children:(de,be)=>{Tt(de,{variant:"ghost",size:"sm",class:"area-remove-btn",title:"Remove area",onclick:()=>u(l(ke).name),children:(Ie,Se)=>{hn();var Fe=In("Ã");E(Ie,Fe)},$$slots:{default:!0}})},$$slots:{default:!0}})}),Q(le);var re=he(le,2),se=ee(re);Q(re),ht(()=>Et(se,`${l(s).length??""} area(s) selected`)),E(K,G)},R=K=>{var G=Pl();E(K,G)};pe(N,K=>{l(s).length>0?K(j):K(R,!1)})}Q(k);var L=he(k,2),H=he(ee(L),2);{var M=K=>{var G=El(),le=$(G);Bt(le,21,()=>t.dataSelectionStore.getAllSelections(),kn,(ge,ke)=>{{let de=fe(()=>t.webMapStore.dataLookup.get(l(ke).layerId)?.title??"");hi(ge,{get title(){return l(de)},children:(be,Ie)=>{var Se=Tl(),Fe=$(Se);{var He=we=>{Al(we,{get layerId(){return l(ke).layerId},onFilterClicked:h,hasFiltersApplied:m})};pe(Fe,we=>{t.dataSelectionTreeviewConfig?.getItemConfig(l(ke).layerId)?.showFields&&we(He)})}var Xe=he(Fe,2);Tt(Xe,{variant:"ghost",size:"sm",class:"data-remove-btn",title:"Remove data selection",onclick:()=>f(l(ke).layerId),children:(we,Re)=>{hn();var ye=In("Ã");E(we,ye)},$$slots:{default:!0}}),E(be,Se)},$$slots:{default:!0}})}}),Q(le);var re=he(le,2),se=ee(re);Q(re),ht(ge=>Et(se,`${ge??""} data layer(s) selected`),[()=>t.dataSelectionStore.getAllSelections().length]),E(K,G)},z=K=>{var G=Fl();E(K,G)};pe(H,K=>{t.dataSelectionStore.getAllSelections().length>0?K(M):K(z,!1)})}Q(L),ht(()=>Et(F,t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer?t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer.title:"No Area Layer Selected")),E(S,P),Le()}function Ml(S,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Lt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];Pn(S,Ot({name:"arrow-down-to-line"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);Ze(m,()=>t.children??Qe),E(u,h)},$$slots:{default:!0}})),Le()}function Ll(S,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Lt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"m18 15-6-6-6 6"}]];Pn(S,Ot({name:"chevron-up"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);Ze(m,()=>t.children??Qe),E(u,h)},$$slots:{default:!0}})),Le()}function Rl(S,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Lt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]];Pn(S,Ot({name:"maximize"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);Ze(m,()=>t.children??Qe),E(u,h)},$$slots:{default:!0}})),Le()}function Vl(S,t){Me(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Lt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]];Pn(S,Ot({name:"minimize"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=ae(),m=$(h);Ze(m,()=>t.children??Qe),E(u,h)},$$slots:{default:!0}})),Le()}function jl(S,t){S.target===S.currentTarget&&t()}var Hl=(S,t)=>S.key==="Escape"&&t(),zl=(S,t,a)=>t(l(a).name),Kl=oe('<div class="info-icon-container svelte-fp5rsc"><!></div>'),Bl=oe('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),ql=oe('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),Ul=oe("<!> <!>",1),Gl=oe("<!> <!>",1),Wl=oe('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),$l=oe('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Yl(S,t){Me(t,!0);const a=Ee(t,"fieldFilterMenuStore",7);let s=ne(null),u=ne(je(new Mt)),f=fe(()=>{if(!l(s)||!l(s).fields)return{checked:!1,indeterminate:!1};const R=l(s).fields.length,L=l(u)?.size||0;return L===0?{checked:!1,indeterminate:!1}:L===R?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});$e(()=>{const R=a().ActiveLayer;if(!R){B(s,null),B(u,new Mt,!0);return}B(s,R,!0);const L=t.dataSelectionStore.getSelection(R.id);L?.selectedFieldIds?B(u,new Mt([...L.selectedFieldIds]),!0):B(u,new Mt,!0)});function h(){m(),a().ActiveLayer=null}function m(){if(!l(s))return;let R=t.dataSelectionStore.getSelection(l(s).id);if(R){if((R.selectedFieldIds===void 0||R.selectedFieldIds===null)&&(R.selectedFieldIds=new Mt),l(u).size===0){t.dataSelectionStore.removeSelection(l(s).id);return}R.selectedFieldIds.clear(),l(u).forEach(L=>{R.selectedFieldIds?.add(L)})}}function P(R){l(s)&&(l(u).has(R)?l(u).delete(R):l(u).add(R))}function k(){if(!l(s)?.fields)return;(l(u)?.size||0)===0?l(s).fields.forEach(L=>{l(u).add(L.name)}):l(u).clear()}function A(){if(!l(s)?.fields)return[];const R=l(s).fields.filter(L=>!t.fieldsToHide.has(L.name.toLowerCase()));return console.log("Filtered fields to show:",R,t.fieldsToHide,l(s).fields),R}var F=ae(),N=$(F);{var j=R=>{var L=$l();L.__click=[jl,h],L.__keydown=[Hl,h];var H=ee(L);Te(H,()=>Tr,(M,z)=>{z(M,{class:"command-card",children:(K,G)=>{var le=Wl(),re=$(le);re.__click=h;var se=ee(re);us(se,{size:20}),Q(re);var ge=he(re,2);Te(ge,()=>Pr,(ke,de)=>{de(ke,{class:"card-content",children:(be,Ie)=>{var Se=ae(),Fe=$(Se);Te(Fe,()=>Qo,(He,Xe)=>{Xe(He,{children:(we,Re)=>{var ye=Gl(),Oe=$(ye);Te(Oe,()=>Xo,(at,ve)=>{ve(at,{placeholder:"Search for fields..."})});var et=he(Oe,2);Te(et,()=>Zo,(at,ve)=>{ve(at,{children:(Ke,tt)=>{var Pe=Ul(),ce=$(Pe);Te(ce,()=>es,(W,ot)=>{ot(W,{children:(qe,me)=>{hn();var Be=In("No results found.");E(qe,Be)},$$slots:{default:!0}})});var De=he(ce,2);Te(De,()=>ts,(W,ot)=>{ot(W,{heading:"Fields",children:(qe,me)=>{var Be=ql(),ut=$(Be),Ue=ee(ut);Zi(Ue,{get checked(){return l(f).checked},get indeterminate(){return l(f).indeterminate},onCheckedChange:k}),hn(2),Q(ut);var vt=he(ut,2);Te(vt,()=>To,(Ge,nt)=>{nt(Ge,{})});var pt=he(vt,2);Bt(pt,17,A,kn,(Ge,nt)=>{var Ye=ae(),We=$(Ye);Te(We,()=>ns,(gt,Ct)=>{Ct(gt,{class:"field-item",onselect:()=>P(l(nt).name),children:(Pt,jt)=>{var st=Bl(),mt=ee(st);{let Ut=fe(()=>l(u)?.has(l(nt).name)??!1);Zi(mt,{class:"field-checkbox",get checked(){return l(Ut)},onCheckedChange:()=>P(l(nt).name)})}var kt=he(mt,2);kt.__click=[zl,P,nt];var ct=ee(kt),yt=ee(ct),Ht=ee(yt,!0);Q(yt);var qt=he(yt,2);{var vn=Ut=>{var Ft=Kl(),ue=ee(Ft);Gn(ue,()=>Eo),Q(Ft),ht(()=>yi(Ft,"title",l(nt).description)),E(Ut,Ft)};pe(qt,Ut=>{l(nt).description&&Ut(vn)})}Q(ct),Q(kt),Q(st),ht(()=>Et(Ht,l(nt).alias||l(nt).name)),E(Pt,st)},$$slots:{default:!0}})}),E(Ge,Ye)}),E(qe,Be)},$$slots:{default:!0}})}),E(Ke,Pe)},$$slots:{default:!0}})}),E(we,ye)},$$slots:{default:!0}})}),E(be,Se)},$$slots:{default:!0}})}),E(K,le)},$$slots:{default:!0}})}),Q(L),E(R,L)};pe(N,R=>{l(s)&&R(j)})}E(S,F),Le()}Er(["click","keydown"]);class Pa{id;name;children;parent;constructor(t,a,s=[],u=null){this.id=t,this.name=a,this.children=s,this.parent=u}}class lt extends Pa{layer;constructor(t,a,s,u=[],f=null){super(t,a,u,f),this.layer=s}}class An extends lt{featureLayer;field;constructor(t,a,s,u,f=[],h=null){super(t,a,s,f,h),this.field=u,this.featureLayer=s}}var it=(S=>(S.Inactive="inactive",S.Indeterminate="indeterminate",S.Active="active",S))(it||{}),nn=(S=>(S.Hidden="hidden",S.Suspended="suspended",S.Visible="visible",S))(nn||{});class Ta{#e=ne(!1);get initialized(){return l(this.#e)}set initialized(t){B(this.#e,t,!0)}#t=null;#n=null;#r=ne(je([]));#i=fe(()=>{const t=new It;return this.#S(l(this.#r),t),t});#a=ne(je(new It));#s=ne(je(new It));#l=ne(je(new It));#c=ne(je(new It));#f=ne(je(new It));#h=null;initialize(t,a,s,u,f){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!a)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=a,u)for(const h of u)l(this.#f).set(h.id,h);if(f&&(this.#h=f),!t)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#n=s,this.#m(t),B(this.#r,this.#y(t),!0)}getNodeById(t){return this.#u(),l(this.#i).get(t)}getNodes(){return this.#u(),l(this.#r)}getVisibleNodes(){this.#u();const t=[];for(const[a,s]of l(this.#a)){if(!s)continue;const u=l(this.#i).get(a);u&&t.push(u)}return t}getNonHiddenNodes(){return this.#u(),this.#o(l(this.#r))}clearSelections(){this.#u();for(const t of l(this.#a).keys()){l(this.#a).set(t,!1);const a=l(this.#i).get(t);a&&a instanceof lt&&(a.layer.visible=!1)}l(this.#c).clear()}#o(t){this.#u();const a=[];for(const s of t){const u=this.#v(s.id);if(!(u&&u.isHidden)&&(a.push(s),s.children?.length)){const f=this.#o(s.children);a.push(...f)}}return a}getVisibilityState(t){return this.#u(),l(this.#a).get(t)??!1}setVisibilityState(t,a){this.#u();const s=l(this.#i).get(t);if(!s)throw new Error(`Tree node not found for ID: ${t}`);if(!(s instanceof lt))throw new Error(`Tree node is not a layer node: ${t}`);const u=this.#v(t);if(u?.disableVisibilityToggle||(l(this.#a).set(t,a),s.layer.visible=a,this.updateDrawState(s,a),s instanceof An&&(s.featureLayer.displayField=a?s.field.name:"",a&&this.#h&&(console.log("[TreeviewStore] Applying custom renderer for field:",s.field.name),this.#h.applyCustomRenderer(s.featureLayer,s.field.name))),this.#d(s,a),!u||u.isHidden)||(u.visibilityDependencyIds?.length&&this.#p(s,a),!u.visibilityGroupId))return;const f=u.visibilityGroupId;let h=l(this.#c).get(f);h||(h=[],l(this.#c).set(f,h));const m=this.#g(f);if(!m)throw new Error(`Visibility group config not found for group ID: ${f}`);if(!a){const k=h.indexOf(t);h.splice(k,1);return}const P=k=>{l(this.#a).set(k,!1);const A=l(this.#i).get(k);if(A&&A instanceof lt){A.layer.visible=!1,this.updateDrawState(A,!1),this.#d(A,!1);const N=this.#v(k);N&&N.visibilityDependencyIds?.length&&this.#p(A,!1)}const F=h.indexOf(k);F>=0&&h.splice(F,1)};for(;h.length>=m.maxVisibleLayers;){const k=h[0];P(k)}h.push(t),this.#d(s,a),u.visibilityDependencyIds?.length&&this.#p(s,a)}async updateDrawState(t,a){if(!this.#n)return;if(!a){l(this.#s).delete(t.id),l(this.#l).get(t.id)?.remove(),l(this.#l).delete(t.id);return}if(!(t instanceof lt)||!(t.layer instanceof ia))return;const s=await this.#n.getLayerView(t.layer);if(!s)return;this.setInitialDrawState(t,s);const u=hs(()=>s.suspended,(f,h)=>{h&&!f?l(this.#s).set(t.id,nn.Visible):!h&&f&&l(this.#s).set(t.id,nn.Suspended)});l(this.#l).set(t.id,u)}getNodeDrawState(t){return this.#u(),l(this.#s).get(t)??nn.Hidden}setInitialDrawState(t,a){!(t instanceof lt)||!(t.layer instanceof ia)||a&&(a.suspended?l(this.#s).set(t.id,nn.Suspended):l(this.#s).set(t.id,nn.Visible))}clearDrawStateHandles(){for(const t of l(this.#l).values())t.remove();l(this.#l).clear()}cleanup(){this.initialized=!1,l(this.#a).clear(),l(this.#c).clear(),l(this.#f).clear(),B(this.#r,[],!0),l(this.#i).clear(),l(this.#s).clear(),this.clearDrawStateHandles()}#d(t,a){const s=t.parent;if(s){if(!(s instanceof lt)){this.#d(s,a);return}l(this.#a).set(s.id,a),s.layer.visible=a,this.#d(s,a)}}#p(t,a){const s=this.#v(t.id);if(s&&s.visibilityDependencyIds?.length)for(const u of s.visibilityDependencyIds){const f=l(this.#i).get(u);f&&f instanceof lt&&(l(this.#a).set(u,a),f.layer.visible=a,this.#d(f,a))}}#g(t){if(t&&this.#t)return this.#t.getVisibilityGroupConfig(t)}#m(t){this.#t&&this.#t.resolveInheritance(t)}#y(t){const a=t.map(s=>this.#w(s,void 0));return this.#b([...a])}#v(t){if(t&&this.#t)return this.#t.getItemConfig(t)}#b(t){t.reverse();for(const a of t)a.children?.length&&this.#b(a.children);return t}#w(t,a){const s=this.#v(t.id);if(s&&s.customConverterId){if(!l(this.#f).has(s.customConverterId))throw new Error(`Custom converter not found: ${s.customConverterId}`);const f=l(this.#f).get(s.customConverterId);if(!f)throw new Error(`Custom converter not found: ${s.customConverterId}`);return f.layerToNode(t,a??null)}const u=new lt(t.id,t.title,t,[],a);if(t.visible=s?.disableVisibilityToggle?t.visible:s?.isHidden?!1:s?.isVisibleOnInit??!1,l(this.#a).set(t.id,t.visible),this.updateDrawState(u,t.visible),this.#A(t)&&s?.showFields){const f=t;f.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const h of f.fields??[]){const m=this.#x(h,u);u.children.push(m)}}if(this.#k(t)){const f=t;return u.children=f.layers.toArray().map(h=>this.#w(h,u)),u}if(this.#I(t)){const f=t;if(f.sublayers&&f.sublayers.length>0){const h=f.sublayers;u.children=h.toArray().map(this.#_)}}return u}#x(t,a){const s=this.#C(a.id,t.name),u=new An(s,t.alias||t.name,a.layer,t,[],a),f=this.#v(s);return l(this.#a).set(s,f?.isVisibleOnInit??!1),u}#I(t){return t.type==="map-image"||t.type==="wms"}#_(t){const a=new lt(t.uid,t.title,t);return t.sublayers?.length&&(a.children=t.sublayers.toArray().map(this.#_)),a}#S(t,a){for(const s of t)a.set(s.id,s),s.children?.length&&this.#S(s.children,a)}#C(t,a){return`${t}-${a}`}#k(t){return t.type==="group"}#A(t){return t.type==="feature"}#u(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}const Jl='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Ql='<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Xl='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',Ea=(S,t,a,s)=>t?Zl(S,a):a?s?Jl:Ql:Xl,Zl=(S,t)=>{switch(S.type){case"group":return ea;case"feature":return ta;case"tile":return Fo;default:return t?ea:ta}};function ec(S){const t=S-1;return t*t*t+1}var tc=oe('<div class="relative ml-4 w-full"><div class="tree-guide-line svelte-1y72o5r"></div> <div class="tree-children svelte-1y72o5r"></div></div>'),nc=oe('<div class="w-full"><!> <!></div>');function Fa(S,t){const a=Ee(t,"isOpen",3,!1),s=Ee(t,"childNodes",3,null),u=Ee(t,"duration",3,300);var f=nc(),h=ee(f);Ze(h,()=>t.content??Qe);var m=he(h,2);{var P=k=>{var A=tc(),F=he(ee(A),2);Bt(F,21,()=>s()??[],N=>N.id,(N,j)=>{var R=ae(),L=$(R);Ze(L,()=>t.childNode??Qe,()=>l(j)),E(N,R)}),Q(F),Q(A),kr(1,F,()=>ha,()=>({duration:u(),easing:ec})),kr(2,F,()=>ha,()=>({duration:u()})),E(k,A)};pe(m,k=>{a()&&s()&&k(P)})}Q(f),E(S,f)}const vi="mb-1 cursor-pointer rounded-md border border-border p-2 text-left",pi="transition-all duration-150 hover:border-border/50 hover:bg-gray-100 hover:shadow-sm",rc="transition-colors hover:bg-blue-500",gi="text-sm font-normal",mi="bg-card",Da="bg-accent text-accent-foreground",ic="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";function ac(S={}){const{enhancedHover:t=!1,includeFont:a=!1,pressed:s=!1}=S;let u=vi;return t?u+=" "+pi:u+=" "+rc,a&&(u+=" "+gi),s?u+=" "+Da:u+=" "+mi,u}var oc=oe('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),sc=oe('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ma(S,t){const a=`calc(100% - ${t.depth*1}rem)`,s=`${vi} ${pi} ${ic} ${mi} ${gi}`,u=`${vi} ${pi} ${gi}`;var f=ae(),h=$(f);{var m=k=>{Do(k,{get pressed(){return t.pressed},get class(){return s},variant:"outline",get style(){return`width: ${a};`},get onPressedChange(){return t.onclick},children:(A,F)=>{var N=oc(),j=ee(N),R=ee(j),L=ee(R);Gn(L,()=>t.icon),Q(R);var H=he(R,2),M=ee(H,!0);Q(H),Q(j);var z=he(j,2);Ze(z,()=>t.children??Qe),Q(N),ht(()=>Et(M,t.name)),E(A,N)},$$slots:{default:!0}})},P=k=>{var A=sc();A.__click=function(...K){t.onclick?.apply(this,K)};var F=ee(A),N=ee(F),j=ee(N);Ia(j,{get isOpen(){return t.isOpen}});var R=he(j,2),L=ee(R);Gn(L,()=>t.icon),Q(R);var H=he(R,2),M=ee(H,!0);Q(H),Q(N);var z=he(N,2);Ze(z,()=>t.children??Qe),Q(F),Q(A),ht(()=>{rn(A,1,`${u} ${t.pressed?Da:mi}`),Cn(A,`width: ${a};`),Et(M,t.name)}),E(k,A)};pe(h,k=>{t.isTogglable?k(m):k(P,!1)})}E(S,f)}Er(["click"]);function Na(S,t){Me(t,!0);const a=L=>{var H=ae(),M=$(H);{var z=K=>{var G=ae(),le=$(G);{var re=ge=>{ma(ge,{isTogglable:!1,get pressed(){return l(k)},get icon(){return l(A)},get name(){return t.node.name},get depth(){return u()},onclick:R,get isOpen(){return l(P)}})},se=ge=>{ma(ge,{isTogglable:!0,get pressed(){return l(k)},get icon(){return l(A)},get name(){return t.node.name},get depth(){return u()},onclick:j,get isOpen(){return l(P)}})};pe(le,ge=>{h?ge(re):ge(se,!1)})}E(K,G)};pe(M,K=>{t.treeviewConfigStore.getItemConfig(t.node.id)?.isHidden||K(z)})}E(L,H)},s=(L,H=Qe)=>{var M=ae(),z=$(M);{var K=G=>{{let le=fe(()=>u()+1);Na(G,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return H()},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get getNodeVisibility(){return t.getNodeVisibility},get depth(){return l(le)},get useLayerTypeIcon(){return f()}})}};pe(z,G=>{h&&l(P)&&!t.treeviewConfigStore.getItemConfig(H().id)?.isHidden&&G(K)})}E(L,M)},u=Ee(t,"depth",3,0),f=Ee(t,"useLayerTypeIcon",3,!1),h=!!(t.node.children&&t.node.children.length),m=!h;let P=ne(!1),k=ne(!1),A=ne("");function F(){return!t.node.children||!t.getNodeVisibility?!1:t.node.children.some(L=>{const H=t.getNodeVisibility(L.id);return H!==void 0?H:L instanceof lt?L.layer.visible:!1})}$e(()=>{if(!(!t.node||!(t.node instanceof lt))){if(h)B(k,F(),!0);else{const L=t.getNodeVisibility?t.getNodeVisibility(t.node.id):void 0;B(k,L!==void 0?L:t.node.layer.visible,!0)}B(A,Ea(t.node.layer,f(),h,l(P)),!0)}});function N(){!m||!t.onNodeVisibilityChange||h||(B(k,!l(k)),t.onNodeVisibilityChange(t.node,l(k)))}function j(){h||N(),t.onNodeClick?.(t.node)}function R(){B(P,!l(P)),t.onNodeClick?.(t.node)}{let L=fe(()=>h?t.node.children:null);Fa(S,{get isOpen(){return l(P)},get content(){return a},get childNodes(){return l(L)},get childNode(){return s}})}Le()}function lc(S,t){Me(t,!0);const a=new Ta;function s(){a.clearSelections()}$e(()=>{!t.webMap||a.initialized||a.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,null)}),$e(()=>{a.initialized&&!a.getVisibleNodes().length&&t.areaSelectionStore.layerId&&a.setVisibilityState(t.areaSelectionStore.layerId,!0)}),$e(()=>{if(!a.initialized||!a.getVisibleNodes().length)return;const P=a.getVisibleNodes().find(k=>k instanceof lt&&k.layer instanceof aa);if(!P||!(P instanceof lt)){console.warn("Visible node is not a FeatureLayer");return}if(!P.layer||!(P.layer instanceof aa)){console.warn("Visible node layer is not a FeatureLayer",P.layer.type);return}t.areaSelectionStore.setLayerId(P.id)});var u={clearSelections:s},f=ae(),h=$(f);{var m=P=>{var k=ae(),A=$(k);Te(A,()=>Ca,(F,N)=>{N(F,{children:(j,R)=>{var L=ae(),H=$(L);Bt(H,17,()=>a.getNodes(),M=>M.id,(M,z)=>{Na(M,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return l(z)},onNodeClick:()=>{},onNodeVisibilityChange:(K,G)=>a.setVisibilityState(K.id,G),getNodeVisibility:K=>a.getVisibilityState(K),depth:0,useLayerTypeIcon:!0})}),E(j,L)},$$slots:{default:!0}})}),E(P,k)};pe(h,P=>{a.initialized&&P(m)})}return E(S,f),Le(u)}class cc{configStore;constructor(t){this.configStore=t}}function uc(S){return S.replace(/&deg;/gi,"Â°").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}class dc extends cc{id="aliasPath";layerToNode(t,a){const s=new lt(t.id,t.title,t,[],a),u=this.configStore.getItemConfig(t.id);if(this.#n(t)&&u?.showFields){const f=t;f.loaded||console.warn(`Layer not loaded: ${t.id}`);const h=new Map;for(const m of f.fields??[]){const P=this.configStore.getItemConfig(this.#t(t.id,m.name));!P||P.isHidden||this.#e(m,s,h)}s.children.sort((m,P)=>m.children.length>0&&P.children.length===0?1:m.children.length===0&&P.children.length>0?-1:0)}return s}#e(t,a,s=new Map){const u=this.#t(a.id,t.name),h=uc(t.alias||"")?.split("|").map(N=>N.trim()).filter(Boolean)??[];if(h.length===0){const N=new An(u,t.alias||t.name,a.layer,t,[],a);return a.children.push(N),N}const m=h.slice(0,-1),P=h[h.length-1];let k=a;const A=(N,j)=>{N.children??=[],N.children.includes(j)||N.children.push(j)};for(let N=0;N<m.length;N++){const j=m[N],R=h.slice(0,N+1).join("::"),L=`${a.id}::${R}`;let H=s.get(L);H||(H=new Pa(L,j,[],k),s.set(L,H),A(k,H)),k=H}const F=new An(u,P||t.name,a.layer,t,[],k);return A(k,F),F}#t(t,a){return`${t}-${a}`}#n(t){return t.type==="feature"}}class ya{#e=[];#t=new Map;#n=[];#r=new Map;#i=[];#a=new Map;#s=new Set;constructor(t){if(!t)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=t.items??[],this.#t=new Map(this.#e.map(a=>[a.id,a])),this.#n=t.visibilityGroups??[],this.#r=new Map(this.#n.map(a=>[a.id,a])),this.#i=t.inheritanceGroups??[],this.#a=new Map(this.#i.map(a=>[a.id,a])),t.fieldsToHide&&(this.#s=new Set(t.fieldsToHide.map(a=>a.trim().toLowerCase())))}getItemConfig(t){return this.#t.get(t)}getVisibilityGroupConfig(t){return this.#r.get(t)}getInheritanceGroupConfig(t){return this.#a.get(t)}resolveInheritance(t){if(!(t.length===0||!this.#e||this.#e.length===0))for(const a of t){const s=this.getItemConfig(a.id);this.#l(a,s)}}#l(t,a){const s=this.#c(t,a);if(this.#y(t)&&s.showFields){const u=t;u.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const f of u.fields??[])this.#f(this.#g(t.id,f.name),f.alias||f.name,s)}if(this.#m(t)){const u=t;for(const f of u.layers.toArray())this.#l(f,s)}}#c(t,a){const s=this.#h(t.id,a);return s.type===br.None&&(s.type=No(t)),s}#f(t,a,s){const u=this.#h(t,s);return u.type===br.None&&(u.type=br.Field),this.#s.has(a.trim().toLowerCase())&&(u.isHidden=!0),u}#h(t,a){let s=this.getItemConfig(t);const u=s?.inheritanceGroupId?this.getInheritanceGroupConfig(s.inheritanceGroupId):this.getInheritanceGroupConfig(a?.inheritanceGroupId??"");return s={id:t,type:br.None,isDownloadable:this.#o(u,"isDownloadable",s,a,!0),isVisibleOnInit:this.#o(u,"isVisibleOnInit",s,a,!1),isHidden:this.#o(u,"isHidden",s,a,!1),disableVisibilityToggle:this.#o(u,"disableVisibilityToggle",s,a,!1),isOpenOnInit:this.#o(u,"isOpenOnInit",s,a,!1),showFields:this.#o(u,"showFields",s,a,!1),visibilityDependencyIds:this.#o(u,"visibilityDependencyIds",s,a,[]),visibilityGroupId:this.#o(u,"visibilityGroupId",s,a,void 0),customConverterId:this.#o(u,"customConverterId",s,a,void 0),inheritanceGroupId:this.#o(u,"inheritanceGroupId",s,a,void 0)},this.#p(s),this.#d(s),s}#o(t,a,s,u,f){const h=s?.[a];return h!==void 0?h:t?.inheritedProperties.includes(a)&&u?u[a]??f:f}#d(t){if(this.#t.has(t.id))throw new Error(`Item with id ${t.id} already exists.`);this.#e.push(t),this.#t.set(t.id,t)}#p(t){this.#t.has(t.id)&&(this.#e=this.#e.filter(a=>a.id!==t.id),this.#t.delete(t.id))}#g(t,a){return`${t}-${a}`}#m(t){return t.type==="group"}#y(t){return t.type==="feature"}}var fc=oe('<div data-slot="checkbox-indicator" class="text-current transition-none"><!></div>');function hc(S,t){Me(t,!0);let a=Ee(t,"ref",15,null),s=Ee(t,"checked",11,!1),u=Ee(t,"indeterminate",11,!1),f=Lt(t,["$$slots","$$events","$$legacy","ref","checked","indeterminate","class"]),h=ne(je(s())),m=ne(je(u()));$e(()=>{B(h,s())}),$e(()=>{B(m,u())});var P=ae(),k=$(P);{const A=(N,j)=>{let R=()=>j?.().checked,L=()=>j?.().indeterminate;var H=fc(),M=ee(H);{var z=G=>{Ml(G,{class:"size-3.5"})},K=G=>{var le=ae(),re=$(le);{var se=ge=>{Lo(ge,{class:"size-3.5"})};pe(re,ge=>{L()&&ge(se)},!0)}E(G,le)};pe(M,G=>{R()?G(z):G(K,!1)})}Q(H),E(N,H)};let F=fe(()=>vs("peer flex size-4 shrink-0 items-center justify-center rounded-[4px] border border-input shadow-xs transition-shadow outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 data-[state=checked]:border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:bg-input/30 dark:aria-invalid:ring-destructive/40 dark:data-[state=checked]:bg-primary",t.class));Te(k,()=>Mo,(N,j)=>{j(N,Ot({"data-slot":"checkbox",get class(){return l(F)}},()=>f,{get ref(){return a()},set ref(R){a(R)},get checked(){return l(h)},set checked(R){B(h,R,!0)},get indeterminate(){return l(m)},set indeterminate(R){B(m,R,!0)},children:A,$$slots:{default:!0}}))})}E(S,P),Le()}var vc=oe("<div><!></div>");function ba(S,t){Me(t,!0);let a=fe(()=>t.getDownloadState?.(t.node)??it.Inactive),s=fe(()=>l(a)===it.Active),u=fe(()=>l(a)===it.Indeterminate);function f(P){P.stopPropagation();const k=l(a)===it.Active?it.Inactive:it.Active;t.onDownloadStateChanged?.(t.node,k)}var h=vc(),m=ee(h);hc(m,{get checked(){return l(s)},get indeterminate(){return l(u)},onclick:f,title:"Download"}),Q(h),E(S,h),Le()}var pc=oe('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function wa(S,t){Me(t,!0);const a=Ee(t,"isFolder",3,!1),s=Ee(t,"isOpen",3,!1),u=`calc(100% - ${t.depth*1}rem)`;var f=pc();f.__click=function(...L){t.onclick?.apply(this,L)};var h=ee(f),m=ee(h),P=ee(m);{var k=L=>{Ia(L,{get isOpen(){return s()}})};pe(P,L=>{a()&&L(k)})}var A=he(P,2),F=ee(A);Gn(F,()=>t.icon),Q(A);var N=he(A,2),j=ee(N,!0);Q(N),Q(m);var R=he(m,2);Ze(R,()=>t.children??Qe),Q(h),Q(f),ht(L=>{rn(f,1,L),Cn(f,`width: ${u};`),Et(j,t.name)},[()=>So(ac({enhancedHover:!0,includeFont:!0}))]),E(S,f),Le()}Er(["click"]);var gc=oe('<div class="flex items-center gap-2"><!> <!></div>'),mc=oe('<div class="flex items-center gap-2"><!> <!></div>');function Ma(S,t){Me(t,!0);const a=z=>{var K=ae(),G=$(K);{var le=re=>{var se=ae(),ge=$(se);{var ke=be=>{wa(be,{get icon(){return l(N)},get name(){return t.node.name},get depth(){return f()},onclick:M,get isFolder(){return m},get isOpen(){return l(A)},children:Se=>{var Fe=gc(),He=ee(Fe);{var Xe=ye=>{ba(ye,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};pe(He,ye=>{t.isDownloadable&&ye(Xe)})}var we=he(He,2);{var Re=ye=>{{let Oe=fe(()=>t.getNodeDrawState?.(t.node.id)===nn.Suspended);na(ye,{get checked(){return l(F)},get indeterminate(){return l(Oe)},onCheckedChange:L})}};pe(we,ye=>{P&&ye(Re)})}Q(Fe),E(Se,Fe)},$$slots:{default:!0}})},de=be=>{wa(be,{get icon(){return l(N)},get name(){return t.node.name},get depth(){return f()},onclick:H,get isFolder(){return m},children:Se=>{var Fe=mc(),He=ee(Fe);{var Xe=ye=>{ba(ye,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};pe(He,ye=>{t.isDownloadable&&ye(Xe)})}var we=he(He,2);{var Re=ye=>{{let Oe=fe(()=>t.getNodeDrawState?.(t.node.id)===nn.Suspended);na(ye,{get checked(){return l(F)},get indeterminate(){return l(Oe)},onCheckedChange:L})}};pe(we,ye=>{P&&ye(Re)})}Q(Fe),E(Se,Fe)},$$slots:{default:!0}})};pe(ge,be=>{m?be(ke):be(de,!1)})}E(re,se)};pe(G,re=>{u()?.getItemConfig(t.node.id)?.isHidden||re(le)})}E(z,K)},s=(z,K=Qe)=>{var G=ae(),le=$(G);{var re=se=>{{let ge=fe(()=>u()?.getItemConfig(K().id)?.isDownloadable??!0),ke=fe(()=>f()+1);Ma(se,{get treeviewConfigStore(){return u()},get node(){return K()},get isDownloadable(){return l(ge)},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState},get onFilterClicked(){return t.onFilterClicked},get hasFiltersApplied(){return t.hasFiltersApplied},get getNodeVisibility(){return t.getNodeVisibility},get getNodeDrawState(){return t.getNodeDrawState},get depth(){return l(ke)},get useLayerTypeIcon(){return h()}})}};pe(le,se=>{m&&l(A)&&!u()?.getItemConfig(K().id)?.isHidden&&se(re)})}E(z,G)},u=Ee(t,"treeviewConfigStore",3,null),f=Ee(t,"depth",3,0),h=Ee(t,"useLayerTypeIcon",3,!1),m=!!(t.node.children&&t.node.children.length),P=!m;let k=!1,A=ne(!1),F=ne(!1),N=ne(""),j=ne(!1),R=ne(!1);$e(()=>{k||(B(A,u()?.getItemConfig(t.node.id)?.isOpenOnInit??!1,!0),k=!0)}),$e(()=>{if(!t.node)return;const z=t.getNodeVisibility?t.getNodeVisibility(t.node.id):!1;B(F,z??!1,!0),t.node instanceof lt&&B(N,Ea(t.node.layer,h(),m,l(A)),!0)}),$e(()=>{if(!(t.node instanceof lt))return;const z=(t.getDownloadState?.(t.node)===it.Active&&t.node.layer.type==="feature")??!1;z&&!l(j)?(B(j,!0),B(R,!1)):!z&&l(j)&&(B(R,!0),setTimeout(()=>{B(j,!1),B(R,!1)},180))});function L(){!P||!t.onNodeVisibilityChange||(B(F,!l(F)),t.onNodeVisibilityChange(t.node,l(F)))}function H(){t.onNodeClick?.(t.node)}function M(){B(A,!l(A)),t.onNodeClick?.(t.node)}{let z=fe(()=>m?t.node.children:null);Fa(S,{get isOpen(){return l(A)},get content(){return a},get childNodes(){return l(z)},get childNode(){return s}})}Le()}class yc{#e;#t;constructor(t,a){this.#e=t,this.#t=a}updateSelection(t,a){if(!this.#t.getItemConfig(t.id)?.isHidden){if(!(t instanceof lt)){this.updateChildrenSelection(t,a);return}if(t instanceof An){this.updateFieldSelection(t,a);return}this.updateLayerSelection(t,a)}}getSelectionState(t){if(!(t instanceof lt))return this.determineSelectionStateFromChildren(t);if(this.isGroupLayer(t))return this.determineSelectionStateFromChildren(t);let a;return t instanceof An?(a=this.#e.getSelection(t.featureLayer.id),a&&a.selectedFieldIds.has(t.field.name)?it.Active:it.Inactive):(a=this.#e.getSelection(t.id),a?this.isFeatureLayer(t)&&t.children&&t.children.length>0?this.determineSelectionStateFromChildren(t):it.Active:it.Inactive)}updateLayerSelection(t,a){let s=this.#e.getSelection(t.id);switch(a){case it.Active:!s&&!this.isGroupLayer(t)&&(s=this.createAndAddDataSelection(t.id));for(const u of t.children||[])this.updateSelection(u,a);break;case it.Inactive:s&&!this.isGroupLayer(t)&&this.#e.removeSelection(t.id),this.updateChildrenSelection(t,a);break}}updateFieldSelection(t,a){let s=this.#e.getSelection(t.featureLayer.id);switch(a){case it.Active:s||(s=this.createAndAddDataSelection(t.featureLayer.id)),this.#e.addOrUpdateSelection(t.featureLayer.id,[...s.selectedFieldIds,t.field.name]);break;case it.Inactive:{if(!s)break;const u=new Mt(s.selectedFieldIds);u.delete(t.field.name),this.#e.addOrUpdateSelection(t.featureLayer.id,[...u]),u.size===0&&this.#e.removeSelection(s.layerId);break}}}updateChildrenSelection(t,a){for(const s of t.children||[])this.updateSelection(s,a)}determineSelectionStateFromChildren(t){let a=0,s=0;for(const u of t.children||[]){if(this.#t.getItemConfig(u.id)?.isHidden)continue;s++;const h=this.getSelectionState(u);if(h===it.Active||this.isFeatureLayer(u)&&h!==it.Inactive)a++;else if(h===it.Indeterminate)return it.Indeterminate}return a===0?it.Inactive:a===s?it.Active:it.Indeterminate}createAndAddDataSelection(t){const a={layerId:t,selectedFieldIds:new Mt};return this.#e.addSelection(a),a}isGroupLayer(t){return t instanceof lt&&t.layer.type==="group"}isFeatureLayer(t){return t instanceof lt&&t.layer.type==="feature"}}function bc(S,t){Me(t,!0);const a=Ee(t,"fieldFilterMenuStore",7);function s(){u.clearSelections()}const u=new Ta,f=new yc(t.dataSelectionStore,t.treeviewConfigStore);$e(()=>{if(!t.webMap||u.initialized)return;(async()=>{await t.webMap.when(),await h(t.webMap.layers.toArray());const z=new dc(t.treeviewConfigStore);u.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,t.layerViewProvider,[z],t.customRendererService)})()});async function h(M){for(const z of M)z.type==="feature"&&!z.loaded&&await z.load(),z.type==="group"&&await h(z.layers.toArray())}function m(M,z){console.log(`[tree-view] onNodeVisibilityChange: Setting visibility of node ${M.id} to ${z}`),u.setVisibilityState(M.id,z)}function P(M){return u.getNodeDrawState(M)}function k(M,z){f.updateSelection(M,z)}function A(M){return f.getSelectionState(M)}function F(M){if(a().ActiveLayer?.uid===M){a().ActiveLayer=null;return}const K=u.getNodeById(M);!K||!(K instanceof lt)||(a().ActiveLayer=K.layer)}function N(M){const z=t.dataSelectionStore.getSelection(M);if(!z?.selectedFieldIds)return!1;const K=u.getNodeById(M);if(!K||!(K instanceof lt))return!1;const G=K.layer.fields?.length||0,le=z?.selectedFieldIds.size||0;return le>0&&le!==G}var j={clearSelections:s},R=ae(),L=$(R);{var H=M=>{var z=ae(),K=$(z);Te(K,()=>Ca,(G,le)=>{le(G,{children:(re,se)=>{var ge=ae(),ke=$(ge);Bt(ke,17,()=>u.getNodes(),de=>de.id,(de,be)=>{{let Ie=fe(()=>t.treeviewConfigStore.getItemConfig(l(be).id)?.isDownloadable??!0);Ma(de,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return l(be)},get isDownloadable(){return l(Ie)},onNodeClick:()=>{},onNodeVisibilityChange:m,getNodeVisibility:Se=>u.getVisibilityState(Se),onDownloadStateChanged:k,getDownloadState:A,onFilterClicked:F,hasFiltersApplied:N,getNodeDrawState:P,depth:0,useLayerTypeIcon:!0})}}),E(re,ge)},$$slots:{default:!0}})}),E(M,z)};pe(L,M=>{u.initialized&&M(H)})}return E(S,R),Le(j)}class La{#e;constructor(t){this.#e=t}async getLayerView(t){return this.#e.whenLayerView(t)}async getLayerViewById(t){const a=this.#e.map?.findLayerById(t);if(a)return this.getLayerView(a)}}class wc{mapView;areaSelectionInteractionStore;interactableLayers;pointerMoveHandle=null;clickHandle=null;leaveHandle=null;enterHandle=null;#e=ne(!0);get pointerInsideMap(){return l(this.#e)}set pointerInsideMap(t){B(this.#e,t,!0)}constructor(t,a,s){console.log("[map-interaction-store] Initializing with MapView"),this.mapView=t,this.areaSelectionInteractionStore=a,this.interactableLayers=s,this.setupHighlights(t),this.setupPointerMoveHandler(t),this.setupClickHandler(t),this.setupLeaveHandler(t),this.setupEnterHandler(t),console.log("[map-interaction-store] Initialized with MapView")}setupHighlights(t){const a={name:"hover",color:"lightgreen",haloOpacity:1,fillOpacity:.2},s={name:"selected",color:"green",haloOpacity:1,fillOpacity:.3};t.highlights.push(a),t.highlights.push(s)}setupPointerMoveHandler(t){this.pointerMoveHandle=t.on("pointer-move",async a=>{if(!this.pointerInsideMap)return;const{results:s}=await t.hitTest(a),u=s[0];if(!u){this.clearHoverHighlight();return}const f=u.graphic,h=f.layer;if(!f||!h||!this.isLayerInteractable(h.title)||f.attributes?.[h.objectIdField]===void 0){this.clearHoverHighlight();return}const m=f.attributes?.[h.objectIdField];if(!(this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.currentHoveredArea.id===m))try{const P=await t.whenLayerView(h);this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P),this.clearHoverHighlight();const k=P;if(!k){console.warn("LayerView is not a FeatureLayerView");return}if(!this.pointerInsideMap)return;const A=k.highlight(f,{name:"hover"});this.areaSelectionInteractionStore.setHoveredArea(m,A)}catch(P){console.error("Error in pointer-move handler:",P),this.clearHoverHighlight()}})}setupClickHandler(t){this.clickHandle=t.on("click",async a=>{const{results:s}=await t.hitTest(a),u=s[0];if(!u)return;const f=u.graphic,h=f.layer;if(!f||!h||!this.isLayerInteractable(h.title)||f.attributes?.[h.objectIdField]===void 0)return;const m=f.attributes?.[h.objectIdField];try{const P=await t.whenLayerView(h),k=P;if(!k){console.warn("Layer is not a FeatureLayerView");return}if(this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P),this.areaSelectionInteractionStore.selectionViewState.areaHandles.get(m))this.areaSelectionInteractionStore.removeSelectedArea(m);else{const F=k.highlight(f,{name:"selected"});this.areaSelectionInteractionStore.addSelectedArea(m,F)}}catch(P){console.error("Error in click handler:",P)}})}setupLeaveHandler(t){this.leaveHandle=t.on("pointer-leave",()=>{this.pointerInsideMap=!1,this.clearHoverHighlight()})}setupEnterHandler(t){this.enterHandle=t.on("pointer-enter",()=>{this.pointerInsideMap=!0})}isLayerInteractable(t){return this.interactableLayers.has(t)}clearHoverHighlight(){this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.clearHoveredArea()}cleanup(){this.pointerMoveHandle&&(this.pointerMoveHandle.remove(),this.pointerMoveHandle=null),this.clickHandle&&(this.clickHandle.remove(),this.clickHandle=null),this.leaveHandle&&(this.leaveHandle.remove(),this.leaveHandle=null),this.enterHandle&&(this.enterHandle.remove(),this.enterHandle=null),this.clearHoverHighlight(),this.pointerInsideMap=!0,this.interactableLayers=new Mt,console.log("[map-interaction-store] cleaned up")}get currentMapView(){return this.mapView}}var _c=oe('<div class="map-view svelte-14z0ybm"></div>');function Sc(S,t){Me(t,!0);const a=Ee(t,"mapView",7);let s=ne(null),u=null;const f="streets-vector";let h,m;function P(){if(!a())throw new Error("MapView is not initialized");return new La(a())}xn(async()=>{await k(),await N()});async function k(){if(!m){const[{default:M},{default:z},{default:K},{default:G}]=await Promise.all([Bn(()=>import("../chunks/CTSXUDU4.js").then(le=>le.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43]),import.meta.url),Bn(()=>import("../chunks/DFgO6MsE.js").then(le=>le.a2),__vite__mapDeps([44,1,2,3,5,45,26,46,24,13,6,7,15,47,34,48,22,23,49,8,9,10,11,27,50,51,20,35,36,52,53,54,28,55,56,17,18,57,0,4,12,14,16,19,21,25,29,30,31,32,33,37,38,39,40,41,42,43,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101]),import.meta.url),Bn(()=>import("../chunks/Blum7Kcb.js").then(le=>le.W),__vite__mapDeps([102,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,103,104,105,106,72,107,108,83,84,76,59,60,61,62,63,64,65,66,67,68,69,70,109,110,111,75,71,112,113,114,115,74,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,50,51,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185]),import.meta.url),Bn(()=>import("../chunks/Cj1iE9mV.js"),__vite__mapDeps([109,5,1,2,3,60,26,8,9,10,11,7,13,6,61,25,22,23,24,62,42,103,110,111,75,76,15,71,112,113,114,41,14,43,72,115,17,18,28,74,47,34,48,116,117,118,119,66,120,59,63,64,65,12,67,68,69,70,121,122,123,124,125,126,127,128,129,130,131,132,133,104,35,36,50,51,20,134,135,136,137,138,139,140,141,37,38,39,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,49,158,159,160,161,162,163,164,165,166,167,168,30,169,170,171,19,172,173,174,106,175,176,177,178,179,180,181,182,105]),import.meta.url)]);h=M,m=z}}async function A(){return new h({basemap:f})}async function F(){if(t.webMap)try{if(await k(),await N(),!a()){console.error("MapView is not initialized");return}a().container=u,a().popupEnabled=!1,a().map=t.webMap,console.log("[uprn-map-view] MapView updated with new webMap"),await t.areaSelectionInteractionStore.refreshLayerView(),await t.areaSelectionInteractionStore.refreshAreas()}catch(M){console.error("Error updating MapView with new webMap:",M)}}async function N(){if(!u){console.error("Map container element was not found");return}try{a().container=u,a().popupEnabled=!1,a().map=t.webMap??void 0,a().ui.move("zoom","top-right"),await a().when(),console.log("[uprn-map-view] Map loaded successfully")}catch(M){console.error("Error loading map:",M),await j()}}async function j(){try{const M=await A();a().container=u,a().popupEnabled=!1,a().map=M,await a().when(),console.log("[uprn-map-view] Fallback map loaded")}catch(M){console.error("Error loading fallback map:",M)}}$e(()=>{t.webMap&&F()}),$e(()=>{!a()||l(s)||B(s,new wc(a(),t.areaSelectionInteractionStore,t.interactableLayers),!0)});function R(){a()&&a().destroy()}_a(()=>{R()});var L={getLayerViewProvider:P},H=_c();return Vt(H,M=>u=M,()=>u),E(S,H),Le(L)}var xc=oe('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),Ic=oe('<div class="flex min-h-0 flex-1 flex-col"><!></div>');function Ir(S,t){var a=Ic(),s=ee(a);Te(s,()=>Pr,(u,f)=>{f(u,{class:"card-content flex min-h-0 flex-1 flex-col overflow-hidden p-0",children:(h,m)=>{var P=xc(),k=ee(P);Ze(k,()=>t.children??Qe),Q(P),E(h,P)},$$slots:{default:!0}})}),Q(a),E(S,a)}var Cc=oe("<!> <!>",1),kc=oe('<div class="tab-list-wrapper flex-shrink-0 svelte-rohqkk"><!></div> <!>',1);function Ac(S,t){Me(t,!0);const a=Ee(t,"triggers",19,()=>[]);var s=ae(),u=$(s);Te(u,()=>Ro,(f,h)=>{h(f,{get value(){return t.value},get onValueChange(){return t.onValueChange},class:"flex h-full w-full flex-col",children:(m,P)=>{var k=kc(),A=$(k),F=ee(A);Te(F,()=>Vo,(j,R)=>{R(j,{class:"tab-list",children:(L,H)=>{var M=ae(),z=$(M);Bt(z,17,a,kn,(K,G,le,re)=>{let se=()=>l(G).value,ge=()=>l(G).label;var ke=Cc(),de=$(ke);Te(de,()=>jo,(Se,Fe)=>{Fe(Se,{get value(){return se()},class:"tab-trigger",children:(He,Xe)=>{hn();var we=In();ht(()=>Et(we,ge())),E(He,we)},$$slots:{default:!0}})});var be=he(de,2);{var Ie=Se=>{ds(Se,{class:"separator"})};pe(be,Se=>{se()!==a()[a().length-1]?.value&&Se(Ie)})}E(K,ke)}),E(L,M)},$$slots:{default:!0}})}),Q(A);var N=he(A,2);Ze(N,()=>t.children??Qe),E(m,k)},$$slots:{default:!0}})}),E(S,s),Le()}const ze=Object.freeze({LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"});var Oc=oe("<!> <div><aside><div><div><!></div></div></aside></div> <!>",1);function Pc(S,t){Me(t,!0);const a=Ee(t,"position",19,()=>ze.LEFT),s=Ee(t,"hideToggleButton",3,!1),u=Ee(t,"openIcon",3,ml),f=8,h="500px",m="var(--header-height, 64px)";let P,k=ne(0),A=ne(je(t.originalSize??h)),F=ne(!1),N=ne(!1);const j=fe(()=>a()===ze.LEFT||a()===ze.RIGHT),R=fe(()=>a()===ze.LEFT||a()===ze.TOP),L=fe(()=>l(j)?"500px":"100px"),H=fe(()=>t.minSize??l(L)),M=fe(()=>parseFloat(l(H))),z=fe(()=>l(j)?"width":"height"),K=fe(()=>l(j)?"ew-resize":"ns-resize");$e(()=>{l(N)||(B(A,t.originalSize??l(H),!0),console.log("Sidebar size updated due to minSize/originalSize change:",l(A),t.originalSize))}),xn(()=>{if(!P)return;const ce=new ResizeObserver(De=>{for(const W of De)B(k,l(j)?W.contentRect.width:W.contentRect.height,!0)});return ce.observe(P),()=>ce.disconnect()});function G(ce){if(!t.isOpen)return;B(F,!0),ce.preventDefault();const De=l(j)?ce.clientX:ce.clientY,W=parseFloat(l(A));function ot(me){const Be=l(j)?me.clientX:me.clientY,ut=l(R)?Be-De:De-Be,Ue=Math.max(l(M),W+ut);B(A,`${Ue}px`),B(N,!0)}function qe(){B(F,!1),document.removeEventListener("mousemove",ot),document.removeEventListener("mouseup",qe),document.body.style.cursor="",document.body.style.userSelect=""}document.addEventListener("mousemove",ot),document.addEventListener("mouseup",qe),document.body.style.cursor=l(K),document.body.style.userSelect="none"}const le=fe(()=>()=>{const ce=t.isOpen?l(A):"0px";return{[ze.LEFT]:{top:m,left:ce},[ze.RIGHT]:{top:m,right:ce},[ze.TOP]:{top:ce},[ze.BOTTOM]:{bottom:ce}}[a()]}),re=fe(()=>()=>({[ze.LEFT]:pl,[ze.RIGHT]:Ho,[ze.TOP]:gl,[ze.BOTTOM]:vl})[a()]),se=fe(()=>()=>{if(!t.isOpen)return{};const ce=`${f}px`,De=t.isOpen?`calc(${l(A)} + ${-f/2}px)`:"0px";return{[ze.LEFT]:{left:De,top:"0",width:ce,height:"100%"},[ze.RIGHT]:{right:De,top:"0",width:ce,height:"100%"},[ze.TOP]:{top:De,left:"0",height:ce,width:"100%"},[ze.BOTTOM]:{bottom:De,left:"0",height:ce,width:"100%"}}[a()]});function ge(ce){return Object.entries(ce).map(([De,W])=>`${De}: ${W}`).join("; ")}const ke=fe(()=>l(R)?0:1),de=fe(()=>()=>t.isOpen?"translate(0, 0)":{[ze.LEFT]:`translate(-${l(A)}, 0)`,[ze.RIGHT]:`translate(${l(A)}, 0)`,[ze.TOP]:`translate(0, -${l(A)})`,[ze.BOTTOM]:`translate(0, ${l(A)})`}[a()]),be=fe(()=>()=>{const ce=t.isOpen?l(A):"0px";return{[l(z)]:ce,order:`${l(ke)}`}});var Ie=Oc(),Se=$(Ie);{var Fe=ce=>{{let De=fe(()=>l(F)?"":"transition-all duration-300"),W=fe(()=>ge(l(le)())),ot=fe(()=>l(F)?"transition: none !important;":""),qe=fe(()=>t.isOpen?"Close sidebar":"Open sidebar");Tt(ce,{get onclick(){return t.onToggle},variant:"default",size:"icon",get class(){return`fixed z-2 -ml-1 inline-flex size-7 
	shrink-0 items-center justify-center gap-2 overflow-hidden rounded-md bg-background text-sm
	font-medium whitespace-nowrap shadow-none outline-hidden transition-all select-none hover:bg-accent focus-visible:border-ring 
	focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:pointer-events-none disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 ${l(De)??""}`},get style(){return`${l(W)??""}; pointer-events: auto; ${l(ot)??""}`},get"aria-label"(){return l(qe)},get"aria-expanded"(){return t.isOpen},children:(me,Be)=>{var ut=ae(),Ue=$(ut);{var vt=Ge=>{const nt=fe(()=>l(re)());var Ye=ae(),We=$(Ye);Te(We,()=>l(nt),(gt,Ct)=>{Ct(gt,{class:"h-6 w-6 text-primary"})}),E(Ge,Ye)},pt=Ge=>{const nt=fe(u);var Ye=ae(),We=$(Ye);Te(We,()=>l(nt),(gt,Ct)=>{Ct(gt,{class:"h-6 w-6 text-primary"})}),E(Ge,Ye)};pe(Ue,Ge=>{t.isOpen?Ge(vt):Ge(pt,!1)})}E(me,ut)},$$slots:{default:!0}})}};pe(Se,ce=>{s()||ce(Fe)})}var He=he(Se,2);let Xe;var we=ee(He);let Re;var ye=ee(we);let Oe;var et=ee(ye);let at;var ve=ee(et);{var Ke=ce=>{var De=ae(),W=$(De);Ze(W,()=>t.children),E(ce,De)};pe(ve,ce=>{t.children&&ce(Ke)})}Q(et),Q(ye),Q(we),Vt(we,ce=>P=ce,()=>P),Q(He);var tt=he(He,2);{var Pe=ce=>{{let De=fe(()=>l(j)?"cursor-ew-resize":"cursor-ns-resize"),W=fe(()=>l(F)?"":"transition-all duration-300"),ot=fe(()=>ge(l(se)()));Tt(ce,{get class(){return`fixed z-40 border-0 bg-transparent p-0 ring-0 transition-colors outline-none hover:!bg-primary/50 focus-visible:ring-0 ${l(De)??""} ${l(W)??""}`},onmousedown:G,"aria-label":"Resize sidebar by dragging",get style(){return`${l(ot)??""}; outline: none !important; box-shadow: none !important; border: none !important;`}})}};pe(tt,ce=>{t.isOpen&&ce(Pe)})}ht((ce,De,W,ot,qe,me)=>{Xe=rn(He,1,"relative z-3 h-full w-full overflow-hidden transition-all duration-300",null,Xe,ce),Cn(He,De),Re=rn(we,1,"border-r-bg-sidebar-border relative flex border-r-1 bg-sidebar text-sidebar-foreground shadow-lg",null,Re,W),Cn(we,`${l(z)??""}: ${l(A)??""}; transform: ${ot??""};`),Oe=rn(ye,1,"flex overflow-hidden",null,Oe,qe),at=rn(et,1,"flex overflow-hidden",null,at,me)},[()=>({"h-full":l(j),"w-full":!l(j),"transition-all":!l(F),"duration-300":!l(F)}),()=>ge(l(be)()),()=>({"flex-col":l(j),"flex-row":!l(j),"h-full":l(j),"w-full":!l(j),"border-r":a()===ze.LEFT,"border-l":a()===ze.RIGHT,"border-b":a()===ze.TOP,"border-t":a()===ze.BOTTOM,"border-sidebar-border":!0,"transition-transform":!l(F),"duration-300":!l(F)}),()=>l(de)(),()=>({"flex-col":l(j),"flex-row":!l(j),"h-full":l(j),"w-full":!l(j)}),()=>({"flex-col":l(j),"flex-row":!l(j),"h-full":l(j),"w-full":!l(j)})]),E(S,Ie),Le()}var Tc=oe('<div><!> <div class="main-content svelte-f4u9lw"><!></div></div>');function Ec(S,t){Me(t,!0);const a=Ee(t,"position",19,()=>ze.LEFT),s=Ee(t,"hideToggleButton",3,!1),u=fe(()=>a()===ze.TOP||a()===ze.BOTTOM);var f=Tc();let h;var m=ee(f);Pc(m,{get isOpen(){return t.isOpen},get onToggle(){return t.onToggle},get position(){return a()},get originalSize(){return t.originalSize},get minSize(){return t.minSize},get openIcon(){return t.openIcon},get hideToggleButton(){return s()},children:(F,N)=>{var j=ae(),R=$(j);{var L=H=>{var M=ae(),z=$(M);Ze(z,()=>t.sidebarContent),E(H,M)};pe(R,H=>{t.sidebarContent&&H(L)})}E(F,j)},$$slots:{default:!0}});var P=he(m,2),k=ee(P);{var A=F=>{var N=ae(),j=$(N);Ze(j,()=>t.mainContent),E(F,N)};pe(k,F=>{t.mainContent&&F(A)})}Q(P),Q(f),ht(F=>h=rn(f,1,"sidebar-layout svelte-f4u9lw",null,h,F),[()=>({vertical:l(u)})]),E(S,f),Le()}var Fc=oe('<div class="w-full flex-shrink-0"><!></div>');function Dc(S,t){var a=Fc(),s=ee(a);{var u=f=>{var h=ae(),m=$(h);Ze(m,()=>t.children),E(f,h)};pe(s,f=>{t.children&&f(u)})}Q(a),E(S,a)}var Nc=oe('<div class="w-full flex-shrink-0"><!></div>');function Mc(S,t){var a=Nc(),s=ee(a);{var u=f=>{var h=ae(),m=$(h);Ze(m,()=>t.children),E(f,h)};pe(s,f=>{t.children&&f(u)})}Q(a),E(S,a)}class Lc{#e=ne(null);get layerId(){return l(this.#e)}set layerId(t){B(this.#e,t,!0)}#t=ne(je(new Mt));get selectedAreaIds(){return l(this.#t)}set selectedAreaIds(t){B(this.#t,t,!0)}setLayerId(t){this.layerId!==t&&(this.layerId=t,this.selectedAreaIds.clear())}addSelectedArea(t){this.selectedAreaIds.add(t)}addSelectedAreas(t){t.forEach(a=>this.selectedAreaIds.add(a))}removeSelectedArea(t){this.selectedAreaIds.delete(t)}clearSelectedAreas(){this.selectedAreaIds.clear()}exportSnapshot(){return{layerId:this.layerId,selectedAreaIds:new Mt(this.selectedAreaIds)}}}class Rc{areaSelectionStore;layerViewProvider;#e=ne(je({layerView:null,areaHandles:new It}));get selectionViewState(){return l(this.#e)}set selectionViewState(t){B(this.#e,t,!0)}#t=ne(null);get lastAddedArea(){return l(this.#t)}set lastAddedArea(t){B(this.#t,t,!0)}#n=ne(null);get lastRemovedArea(){return l(this.#n)}set lastRemovedArea(t){B(this.#n,t,!0)}#r=ne(null);get currentHoveredArea(){return l(this.#r)}set currentHoveredArea(t){B(this.#r,t,!0)}fieldInfos=[];cachedNames=new It;constructor(t,a){this.areaSelectionStore=t,this.layerViewProvider=a,xa(()=>{$e(()=>{this.refreshLayerView()}),$e(()=>{this.refreshAreas()})})}async refreshLayerView(){if(!this.areaSelectionStore.layerId&&this.selectionViewState.layerView!==null){this.resetSelectedLayerView();return}if(this.selectionViewState.layerView?.layer?.id===this.areaSelectionStore.layerId||!this.areaSelectionStore.layerId)return;const t=await this.layerViewProvider.getLayerViewById(this.areaSelectionStore.layerId);t&&this.setSelectedLayerView(t)}async refreshAreas(){const t=this.selectionViewState.layerView;if(!t){this.resetSelectedAreas();return}const a=this.areaSelectionStore.selectedAreaIds,s=this.selectionViewState.areaHandles;for(const u of s.keys())a.has(u)||this.removeSelectedArea(u);for(const u of a){if(s.has(u))continue;const f=t.highlight(u,{name:"selected"});f&&this.addSelectedArea(u,f)}}setFieldInfos(t){this.fieldInfos=t}setSelectedLayerView(t){this.selectionViewState?.layerView!==t&&(this.selectionViewState={layerView:t,areaHandles:new It},this.resetSelectedAreas())}clearSelectedLayerView(){this.selectionViewState.layerView!==null&&(this.resetSelectedAreas(),this.selectionViewState.layerView=null)}resetSelectedLayerView(){this.selectionViewState={layerView:null,areaHandles:new It},this.resetSelectedAreas()}resetSelectedAreas(){!this.selectionViewState.layerView&&this.selectionViewState.areaHandles.size===0||(this.selectionViewState.areaHandles.values().forEach(t=>{t.remove()}),this.selectionViewState.areaHandles.clear(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null)}addSelectedArea(t,a){if(!this.selectionViewState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const s={id:t,handle:a};this.lastAddedArea=s,this.selectionViewState.areaHandles.set(t,a),this.areaSelectionStore.addSelectedArea(t)}removeSelectedArea(t){if(!this.selectionViewState){console.warn("[area-selection-interaction-store] no feature layer view is set.");return}const a=this.selectionViewState.areaHandles.get(t);if(!a){console.warn(`[area-selection-interaction-store] no handle found for area ID ${t}.`);return}this.lastRemovedArea={id:t,handle:a},a.remove(),this.selectionViewState.areaHandles.delete(t),this.areaSelectionStore.removeSelectedArea(t)}async getAreaNamesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getNameFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer;let u=this.cachedNames.get(s.uid);u||(u=new It,this.cachedNames.set(s.uid,u));const f=new Array(t.length),h=new It,m=[];if(t.forEach((A,F)=>{h.set(A,F);const N=u.get(A);N!==void 0?f[F]=N:m.push(A)}),m.length===0)return f.map(A=>A??"");const P=s.objectIdField,k=await s.queryFeatures({objectIds:m,outFields:[a,P],returnGeometry:!1});for(const A of k.features){const F=A.attributes[P],N=A.attributes[a],j=h.get(F);j!==void 0&&(f[j]=N??"",u.set(F,N??""))}return f.map(A=>A??"")}async getAreaCodesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getCodeFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer,u=s.objectIdField,f=await s.queryFeatures({objectIds:t,outFields:[a,u],returnGeometry:!1}),h=new Array(t.length);for(const m of f.features){const P=m.attributes[u],k=m.attributes[a],A=t.indexOf(P);A!==-1&&(h[A]=k??"")}return h.map(m=>m??"")}setHoveredArea(t,a){t!==this.currentHoveredArea?.id&&(this.currentHoveredArea&&this.clearHoveredArea(),this.currentHoveredArea={id:t,handle:a})}clearHoveredArea(){this.currentHoveredArea&&(this.currentHoveredArea?.handle.remove(),this.currentHoveredArea=null)}getNameFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.nameField;return t||(console.warn(`[area-selection-interaction-store] no name field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}getCodeFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.codeField;return t||(console.warn(`[area-selection-interaction-store] no code field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}clearSelections(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,console.log("[area-selection-interaction-store] selections cleared.")}cleanup(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,this.cachedNames.clear(),this.fieldInfos=[],console.log("[area-selection-interaction-store] cleaned up.")}}const Vc=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];class jc{#e;constructor(t){if(!t)throw new Error("UprnDownloadService endpoints configuration is required");if(!t.baseUrl||!t.healthRoute||!t.requestJobRoute||!t.requestJobStatusesRoute||!t.getAreaSelectionLimitsRoute||!t.fetchDownloadRoute)throw new Error("UprnDownloadService endpoints configuration is incomplete");this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async requestJob(t){try{console.log("[uprn-download-service] requesting job with request:",t);const a=`${this.#e.baseUrl}${this.#e.requestJobRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to request job:",s.statusText,"request:",JSON.stringify(t));return}return await s.json()}catch(a){console.error("Error requesting job:",a);return}}async requestJobStatuses(t){try{const a=`${this.#e.baseUrl}${this.#e.requestJobStatusesRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to get job statuses:",s.statusText);return}return await s.json()}catch(a){console.error("Error getting job statuses:",a);return}}async getSelectionAreaLimits(){try{const t=`${this.#e.baseUrl}${this.#e.getAreaSelectionLimitsRoute}`,a=await fetch(t);if(!a.ok){console.error("Failed to get area selection limits:",a.statusText);return}return await a.json()}catch(t){console.error("Error getting selection area limits:",t);return}}getDownloadUrl(t){const a=this.#e.baseUrl.replace(/\/+$/,""),s=this.#e.fetchDownloadRoute.replace(/\/+$/,"");return`${a}${s}/${encodeURIComponent(t)}`}}class Hc{#e;constructor(t){this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async chat(t){try{const a=`${this.#e.baseUrl}${this.#e.chatRoute}`,u=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!u.ok){console.error("Failed to send chat query:",u.statusText);return}return await u.json()}catch(a){console.error("Error sending chat query:",a);return}}async chatStream(t,a){try{const s=`${this.#e.baseUrl}${this.#e.chatStreamRoute}`,f=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!f.ok)return console.error("Failed to start chat stream:",f.statusText),!1;const h=f.body?.getReader();if(!h)return console.error("No response body reader available"),!1;const m=new TextDecoder;let P=!1;for(;!P;){const{value:k,done:A}=await h.read();if(P=A,k){const F=m.decode(k,{stream:!P});a(F)}}return!0}catch(s){return console.error("Error during chat stream:",s),!1}}}const zc=Object.freeze({lod00World:{lod:0,scale:591657527591555e-6},lod01World:{lod:1,scale:295828763795777e-6},lod02World:{lod:2,scale:147914381897889e-6},lod03Continent:{lod:3,scale:73957190948944e-6},lod04Continent:{lod:4,scale:36978595474472e-6},lod05Countries:{lod:5,scale:18489297737236e-6},lod06Country:{lod:6,scale:9244648868618e-6},lod07StatesProvinces:{lod:7,scale:4622324434309e-6},lod08Counties:{lod:8,scale:2311162217155e-6},lod09Counties:{lod:9,scale:1155581108577e-6},lod10Country:{lod:10,scale:577790.554289},lod11MetropolitanArea:{lod:11,scale:288895.277144},lod12Cities:{lod:12,scale:144447.638572},lod13City:{lod:13,scale:72223.819286},lod14Town:{lod:14,scale:36111.909643},lod15Neighborhood:{lod:15,scale:18055.954822},lod16Streets:{lod:16,scale:9027.977411},lod17CityBlock:{lod:17,scale:4513.988705},lod18Buildings:{lod:18,scale:2256.994353},lod19Building:{lod:19,scale:1128.497176},lod20Houses:{lod:20,scale:564.248588},lod21Houses:{lod:21,scale:282.124294},lod22Houses:{lod:22,scale:141.062147},lod23HouseProperty:{lod:23,scale:70.5310735}});class Kc{#e=null;#t=!1;async init(t){this.#t||(await this.#n(t),this.#t=!0)}async#n(t){const s=await(await fetch(t)).json();this.#e=s}doesFieldHaveCustomRenderer(t,a){this.#c();const s=this.#e.FeatureLayers.find(h=>h.Name===t.title);if(!s)return!1;const u=this.#e.Fields.find(h=>h.FeatureLayerId===s.Id&&h.Name===a);return u?!!this.#e.CustomRenderers_Fields.find(h=>h.FieldId===u.Id):!1}getAllFieldsWithCustomRenderers(t){this.#c();const a=this.#e.FeatureLayers.find(f=>f.Name===t.title);if(!a)return[];const s=this.#e.Fields.filter(f=>f.FeatureLayerId===a.Id),u=[];for(const f of s)this.#e.CustomRenderers_Fields.some(m=>m.FieldId===f.Id)&&u.push(f.Name);return u}async applyCustomRenderer(t,a){this.#c();const s=this.#e.FeatureLayers.find(A=>A.Name===t.title);if(!s)return;const u=this.#e.Fields.find(A=>A.FeatureLayerId===s.Id&&A.Name===a);if(!u){console.warn(`[custom-renderer-service] could not find the field ${a} for feature layer id ${s.Id}`);return}const f=this.#e.CustomRenderers_Fields.find(A=>A.FieldId===u.Id);if(!f){console.warn(`[custom-renderer-service] could not find a custom renderer field for field ${a} in feature layer id ${s.Id}`);return}const h=this.#e.CustomRenderers.find(A=>A.Id===f.CustomRendererId);if(!h)throw new Error(`Could not find a custom renderer with the id ${f.CustomRendererId}`);const m=await this.getRendererClassBreaks(h.ClassBreaksGroupId.toString()),P=await this.getRendererSymbols(h.SymbolsId.toString()),k=this.#i(h.CustomRendererType,P,m,[],a);t.renderer=k,this.setCustomOutlines(t,h.LodsGroupId)}async setCustomOutlines(t,a){const s=this.#e.CustomRenderers_Lods.filter(h=>h.GroupId===a).sort((h,m)=>h.Lod-m.Lod);if(s.length===0){console.warn(`No LODs found for LODs group id ${a}`);return}const u=[],f=Object.values(zc);s.forEach(h=>{const m=h.OutlineWidth,P=h.Lod,k=this.#r(f,P)-1;u.push({size:m,value:f[k].scale})}),(t.renderer instanceof oa||t.renderer instanceof sa)&&this.#l(t.renderer,u)}async getRendererClassBreaks(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_ClassBreaks.filter(u=>u.GroupId===a).sort((u,f)=>u.Order-f.Order);if(s.length===0)throw new Error(`Could not find a group with the id ${t}`);return s}async getRendererSymbols(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_Symbols.find(h=>h.Id===a);if(!s)throw new Error(`Could not find a symbol with the id ${t}`);const u=this.#e.CustomRenderers_Symbols_Appearances.filter(h=>h.SymbolsId===a).sort((h,m)=>h.Order-m.Order);return{...s,Appearances:u}}#r(t,a){const s=t.findIndex(u=>u.lod===a);return s===-1?0:s<23?s+1:s}#i(t,a,s,u,f){switch(t){case 1:return this.#s(a,u);case 2:return this.#a(f,a,s,u);default:throw new Error(`Unknown renderer type: ${t}`)}}#a(t,a,s,u){const f="ClassMinValue",h="ClassMaxValue",m="SymbolColor",P="OutlineColor",k="OutlineWidth",A=a.Appearances.length,F=new oa({field:t});for(let N=0;N<A;N++){const j=s[N][f],R=s[N][h],L=a.Appearances[N][m],H=a.Appearances[N][P],M=a.Appearances[N][k];F.addClassBreakInfo({minValue:j,maxValue:R,symbol:new la({color:_r.fromHex(L),outline:new ca({color:_r.fromHex(H),width:M})})})}return this.#l(F,u),F}#s(t,a){const s="SymbolColor",u="OutlineColor",f="OutlineWidth",h=t.Appearances[0][s],m=t.Appearances[0][u],P=t.Appearances[0][f],k=new sa({symbol:new la({color:_r.fromHex(h),outline:new ca({color:_r.fromHex(m),width:P})})});return this.#l(k,a),k}#l(t,a){t.visualVariables=[{type:"size",target:"outline",valueExpression:"$view.scale",stops:a}]}#c(){if(!this.#t)throw new Error("CustomRendererService is not initialized");if(!this.#e)throw new Error("Data is not loaded")}}var Bc=oe('<div class="flex w-full items-center justify-between"><div class="font-medium">Chat</div> <div class="flex gap-1"><!> <!></div></div>'),qc=oe("<!> <!>",1),Uc=oe("<div><!></div>");function Gc(S,t){Me(t,!0);const a=Ee(t,"isOpenedOnInit",3,!1);let s=ne(!1),u=ne(je(a())),f=ne(!1),h=ne(void 0),m="300px",P="45px";$e(()=>{l(s)||!l(h)||(l(u)&&(l(h).style.height=m),B(s,!0))});function k(){l(h)&&(B(u,!l(u)),B(f,!1),l(u)?(P=l(h).style.height,l(h).style.height=m):l(h).style.height=P)}function A(){l(h)&&(B(f,!l(f)),l(f)?(m=l(h).style.height,l(h).style.height="100%"):l(h).style.height=m)}var F=Uc(),N=ee(F);Te(N,()=>Tr,(j,R)=>{R(j,{class:"h-full w-full gap-0 rounded-none py-0 pt-0 pb-0",children:(L,H)=>{var M=qc(),z=$(M);Te(z,()=>gs,(le,re)=>{re(le,{class:"pt-2",children:(se,ge)=>{var ke=Bc(),de=he(ee(ke),2),be=ee(de);{var Ie=Fe=>{Tt(Fe,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:A,children:(He,Xe)=>{var we=ae(),Re=$(we);{var ye=et=>{Vl(et,{class:"text-primary"})},Oe=et=>{Rl(et,{class:"text-primary"})};pe(Re,et=>{l(f)?et(ye):et(Oe,!1)})}E(He,we)},$$slots:{default:!0}})};pe(be,Fe=>{l(u)&&Fe(Ie)})}var Se=he(be,2);Tt(Se,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:k,children:(Fe,He)=>{var Xe=ae(),we=$(Xe);{var Re=Oe=>{Ll(Oe,{class:"text-primary"})},ye=Oe=>{ms(Oe,{class:"text-primary"})};pe(we,Oe=>{l(u)?Oe(ye,!1):Oe(Re)})}E(Fe,Xe)},$$slots:{default:!0}}),Q(de),Q(ke),E(se,ke)},$$slots:{default:!0}})});var K=he(z,2);{var G=le=>{var re=ae(),se=$(re);Te(se,()=>Pr,(ge,ke)=>{ke(ge,{class:"h-full min-h-[10px] w-full p-0",children:(de,be)=>{var Ie=ae(),Se=$(Ie);Ze(Se,()=>t.children??Qe),E(de,Ie)},$$slots:{default:!0}})}),E(le,re)};pe(K,le=>{l(u)&&le(G)})}E(L,M)},$$slots:{default:!0}})}),Q(F),Vt(F,j=>B(h,j),()=>l(h)),E(S,F),Le()}class Wc{#e;#t;#n=ne(!1);#r=fe(()=>this.#e.exportSnapshot());#i=fe(()=>{const t=new It;for(const[a,s]of this.#t.dataSelections)t.set(a,{layerId:s.layerId,selectedFieldIds:s.selectedFieldIds});return t});constructor(t,a){this.#e=t,this.#t=a,xa(()=>{$e(()=>{console.log("[selection-tracking-store] Detected area selection change"),(async()=>{if(!l(this.#n)){console.log("[selection-tracking-store] Initial load not complete, skipping area selection effect");return}if(l(this.#r)){if(!l(this.#r).layerId){await Kn({areas:null});return}if(!l(this.#r).selectedAreaIds.size){await Kn({areas:null});return}await Kn({areas:l(this.#r)}),console.log("[selection-tracking-store] Area selection updated:",ui(l(this.#r)))}})()}),$e(()=>{console.log("[selection-tracking-store] Detected data selection change"),(async()=>{if(!l(this.#n)){console.log("[selection-tracking-store] Initial load not complete, skipping data selection effect");return}if(!l(this.#i)||l(this.#i).size===0){console.log("[selection-tracking-store] No data selections, clearing in database"),await Kn({data:[]});return}await Kn({data:l(this.#i).values().toArray()}),console.log("[selection-tracking-store] Data selection updated:",ui(l(this.#i)))})()})})}async loadSelections(){const t=await Oa();if(!t){console.log("[selection-tracking-store] No existing selection found in database"),B(this.#n,!0);return}console.log("[selection-tracking-store] Loaded selection from database:",t),t.areas&&(this.#e.setLayerId(t.areas.layerId),console.log("[selection-tracking-store] (loadSelections) Restoring selected area IDs:",Array.from(t.areas.selectedAreaIds),"layer ID:",this.#e.layerId),this.#e.addSelectedAreas(Array.from(t.areas.selectedAreaIds))),t.data.forEach(a=>{this.#t.addSelection(a)}),B(this.#n,!0)}}var $c=oe("<!> <!>",1),Yc=oe('<p class="p-4 text-center text-sm text-gray-500">Download service is not available.</p>'),Jc=oe("<div><!></div> <div><!></div> <div><!></div> <div><!></div>",1),Qc=oe("<div><!></div>"),Xc=oe('<p class="p-4 text-center text-sm text-gray-500">AI UPRN Chatbot service is not available.</p>'),Zc=oe('<div class="relative flex h-full w-full min-w-0 flex-col overflow-visible"><!> <!> <!> <!></div>'),eu=oe("<!> <!> <!> <!>",1);function ud(S,t){Me(t,!0);let a,s,u;const f=je(new Il),h=je(new xl);let m=ne("define-areas"),P=je(new wl),k=je(new Lc),A=ne(null),F=je(new Wc(k,P)),N=ne(null),j=ne(void 0),R=ne(void 0),L=ne(void 0),H=ne(void 0),M=ne(void 0),z=ne(!1),K=ne(!1),G=ne(je(new Set)),le=ne(je(new Set)),re=ne(!0),se=je(ze.LEFT);je(ze.BOTTOM);let ge=ne(je([])),ke=ne(je(typeof window<"u"?window.innerWidth:1280)),de=fe(()=>Ie(l(ge),ve=>ve.originalSize)),be=fe(()=>Ie(l(ge),ve=>ve.minSize));function Ie(ve,Ke){if(!ve||ve.length===0)return;const Pe=[...ve].sort((ce,De)=>De.breakpoint-ce.breakpoint).find(ce=>l(ke)>=ce.breakpoint);return Pe?Ke(Pe):"0"}function Se(){B(re,!l(re))}function Fe(ve){B(m,ve,!0)}function He(){B(m,"downloads")}function Xe(){k.clearSelectedAreas(),P.clearSelections(),a?.clearSelections(),s?.clearSelections(),tl()}xn(async()=>{B(L,new Kc,!0),await l(L).init(`${os}/custom-renderers.json`),console.log("[uprn-2/page] CustomRendererService initialized");const ve=await fs();await F.loadSelections();const[{default:Ke}]=await Promise.all([Bn(()=>import("../chunks/DFgO6MsE.js").then(Pe=>Pe.a2),__vite__mapDeps([44,1,2,3,5,45,26,46,24,13,6,7,15,47,34,48,22,23,49,8,9,10,11,27,50,51,20,35,36,52,53,54,28,55,56,17,18,57,0,4,12,14,16,19,21,25,29,30,31,32,33,37,38,39,40,41,42,43,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101]),import.meta.url)]);B(N,new Ke,!0),B(A,new Rc(k,new La(l(N))),!0),B(le,new Set((ve.serviceUprn2Config.selectionLayersNameFields||[]).map(Pe=>Pe.layerName)),!0),l(A).setFieldInfos(ve.serviceUprn2Config.selectionLayersNameFields||[]),B(ge,ve.serviceUprn2Config.mainSidebarSizes||[],!0),B(j,new ya(ve.serviceUprn2Config.dataSelectionTreeviewConfig),!0),B(R,new ya(ve.serviceUprn2Config.areaSelectionTreeviewConfig),!0),(async()=>{const Pe=ve.serviceUprn2Config.uprnDownloadServiceEndpoints,ce=ve.serviceUprn2Config.aiUprnChatbotServiceEndpoints;B(H,new jc(Pe),!0),B(M,new Hc(ce),!0),B(z,await l(H).getHealth(),!0),l(z)?console.log("[uprn-2/page] UPRN Download Service is available"):console.warn("[uprn-2/page] UPRN Download Service is NOT available"),B(K,await l(M).getHealth(),!0),l(K)?console.log("[uprn-2/page] AI UPRN Chatbot Service is available"):console.warn("[uprn-2/page] AI UPRN Chatbot Service is NOT available")})(),B(G,new Set(ve.serviceUprn2Config.dataSelectionTreeviewConfig?.fieldsToHide||[]),!0),await f.initializeAsync({portalUrl:ve.serviceUprn2Config.portalUrl,itemId:ve.serviceUprn2Config.portalItemId||"",proxy:ve.serviceUprn2Config.proxy})}),xn(()=>{const ve=()=>{B(ke,window.innerWidth,!0)};return window.addEventListener("resize",ve),()=>{window.removeEventListener("resize",ve)}}),_a(()=>{P.cleanup()});var we=eu(),Re=$(we);zo(Re,{});var ye=he(Re,2);Yl(ye,{get dataSelectionStore(){return P},get fieldFilterMenuStore(){return h},get fieldsToHide(){return l(G)}});var Oe=he(ye,2);{var et=ve=>{var Ke=$c(),tt=$(Ke);Os(tt,{get areaSelectionInteractionStore(){return l(A)}});var Pe=he(tt,2);Ps(Pe,{get areaSelectionInteractionStore(){return l(A)}}),E(ve,Ke)};pe(Oe,ve=>{l(A)&&ve(et)})}var at=he(Oe,2);{const ve=tt=>{var Pe=Zc(),ce=ee(Pe);Te(ce,()=>Dc,(qe,me)=>{me(qe,{children:(Be,ut)=>{Ac(Be,{get value(){return l(m)},get triggers(){return Vc},onValueChange:Fe})},$$slots:{default:!0}})});var De=he(ce,2);Te(De,()=>ps,(qe,me)=>{me(qe,{children:(Be,ut)=>{var Ue=Jc(),vt=$(Ue),pt=ee(vt);Ir(pt,{children:(Pt,jt)=>{var st=ae(),mt=$(st);{var kt=ct=>{Vt(lc(ct,{get webMap(){return f.data},get treeviewConfigStore(){return l(R)},get areaSelectionStore(){return k}}),yt=>a=yt,()=>a)};pe(mt,ct=>{f.isLoaded&&ct(kt)})}E(Pt,st)}}),Q(vt);var Ge=he(vt,2),nt=ee(Ge);Ir(nt,{children:(Pt,jt)=>{var st=ae(),mt=$(st);{var kt=ct=>{{let yt=fe(()=>u?.getLayerViewProvider());Vt(bc(ct,{get webMap(){return f.data},get dataSelectionStore(){return P},get layerViewProvider(){return l(yt)},get treeviewConfigStore(){return l(j)},get customRendererService(){return l(L)},get fieldFilterMenuStore(){return h}}),Ht=>s=Ht,()=>s)}};pe(mt,ct=>{f.isLoaded&&ct(kt)})}E(Pt,st)}}),Q(Ge);var Ye=he(Ge,2),We=ee(Ye);Ir(We,{children:(Pt,jt)=>{var st=ae(),mt=$(st);{var kt=ct=>{Nl(ct,{get webMapStore(){return f},get areaSelectionInteractionStore(){return l(A)},get dataSelectionStore(){return P},get dataSelectionTreeviewConfig(){return l(j)},get fieldFilterMenuStore(){return h}})};pe(mt,ct=>{l(A)&&f.isLoaded&&ct(kt)})}E(Pt,st)}}),Q(Ye);var gt=he(Ye,2),Ct=ee(gt);Ir(Ct,{children:(Pt,jt)=>{var st=ae(),mt=$(st);{var kt=yt=>{var Ht=Yc();E(yt,Ht)},ct=yt=>{hl(yt,{get webMapStore(){return f},get uprnDownloadService(){return l(H)},get fieldsToHide(){return l(G)}})};pe(mt,yt=>{!l(H)||!l(z)?yt(kt):yt(ct,!1)})}E(Pt,st)}}),Q(gt),ht(()=>{vt.hidden=l(m)!=="define-areas",Ge.hidden=l(m)!=="select-data",Ye.hidden=l(m)!=="export",gt.hidden=l(m)!=="downloads"}),E(Be,Ue)},$$slots:{default:!0}})});var W=he(De,2);Te(W,()=>Mc,(qe,me)=>{me(qe,{children:(Be,ut)=>{var Ue=Qc(),vt=ee(Ue);{var pt=Ge=>{Sl(Ge,{onExportSuccess:He,clearSelections:Xe,get areaSelectionInteractionStore(){return l(A)},get dataSelectionStore(){return P}})};pe(vt,Ge=>{l(A)&&Ge(pt)})}Q(Ue),ht(()=>Ue.hidden=l(m)!=="export"),E(Be,Ue)},$$slots:{default:!0}})});var ot=he(W,2);Gc(ot,{isOpenedOnInit:!0,children:(qe,me)=>{var Be=ae(),ut=$(Be);{var Ue=pt=>{var Ge=Xc();E(pt,Ge)},vt=pt=>{Ys(pt,{get aiUprnChatbotService(){return l(M)}})};pe(ut,pt=>{!l(M)||!l(K)?pt(Ue):pt(vt,!1)})}E(qe,Be)},$$slots:{default:!0}}),Q(Pe),E(tt,Pe)},Ke=tt=>{var Pe=ae(),ce=$(Pe);{var De=W=>{Vt(Sc(W,{get webMap(){return f.data},get mapView(){return l(N)},get areaSelectionInteractionStore(){return l(A)},get interactableLayers(){return l(le)}}),ot=>u=ot,()=>u)};pe(ce,W=>{l(A)&&W(De)})}E(tt,Pe)};Te(at,()=>Ec,(tt,Pe)=>{Pe(tt,{get isOpen(){return l(re)},onToggle:Se,get position(){return se},get originalSize(){return l(de)},get minSize(){return l(be)},sidebarContent:ve,mainContent:Ke,$$slots:{sidebarContent:!0,mainContent:!0}})})}E(S,we),Le()}export{ud as component};
