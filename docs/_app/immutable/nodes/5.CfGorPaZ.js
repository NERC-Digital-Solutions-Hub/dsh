const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CyrEfJff.js","../chunks/iFuBOtDF.js","../chunks/DHq0rblm.js","../chunks/BfhsIlKo.js","../chunks/faKFIXLZ.js","../chunks/D9Z9MdNV.js","../chunks/pCx8oau_.js","../chunks/BgvLO-3W.js","../chunks/CBG-jaYw.js","../chunks/C8PpcA25.js","../chunks/DhdgDebw.js","../chunks/Dt5YSiFI.js","../chunks/C1yg1qUQ.js","../chunks/LE72oyNN.js","../chunks/CYi2TAj9.js","../chunks/DgwIrkEl.js","../chunks/DmWTBsn2.js","../chunks/BwKptEmm.js","../chunks/CCzk6ARw.js","../chunks/Dvbl4r8A.js","../chunks/gRIb6kZn.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/Bvto7RYj.js","../chunks/BOB_xkBk.js","../chunks/DFQ1ZjBx.js","../chunks/Cl5lrJ4c.js","../chunks/B0LmsqEq.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/C4HJhmWz.js","../chunks/CDl12u7R.js","../chunks/DYJGs4je.js","../chunks/Djp3mnm5.js","../chunks/Bso-6bUH.js","../chunks/DQOJ18NT.js","../chunks/CLto_E8U.js","../chunks/CxFnk1MP.js","../chunks/D5ew8ajr.js","../chunks/B4aqFq2B.js","../chunks/EzLf78vY.js","../chunks/BPhm6YV-.js","../chunks/BkA6azLD.js","../chunks/hXVs3T0e.js","../chunks/Dytf6RTV.js","../chunks/9YvG7tFv.js","../chunks/B-VZ3wrL.js","../chunks/CaNAmI22.js","../chunks/aQeO9QTD.js","../chunks/BDqMdsvZ.js","../chunks/DJTyCEHv.js","../chunks/BMX0GFJS.js","../chunks/CsLyQp38.js","../chunks/ETfT8J3h.js","../chunks/BQ2D4CO5.js","../chunks/DZd6gJy7.js","../chunks/C7x2MF0l.js","../chunks/C8BmVxiO.js","../chunks/Cr2KJ5IK.js","../chunks/CJ_83qNO.js","../chunks/Ck-szKz5.js","../chunks/BxD4MBPA.js","../chunks/Banwpgrz.js","../chunks/cw1rsUFH.js","../chunks/C0pjifF4.js","../chunks/ok2Sqpw2.js","../chunks/Chk7YAAL.js","../chunks/D0t3l1UW.js","../chunks/Cgb6qxNH.js","../chunks/DsnVlOka.js","../chunks/CrwPCMe2.js","../chunks/QQC62dOK.js","../chunks/C51QhSzO.js","../chunks/BdLvjJaM.js","../chunks/BaYj2Wow.js","../chunks/DphnWQ0e.js","../chunks/DKpmsPfl.js","../chunks/B9RJBcJ2.js","../chunks/8WNRLB3q.js","../chunks/B1N-tmtC.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/Cf9zLCCH.js","../chunks/pDuGEAnG.js","../chunks/CMaiVHma.js","../chunks/BrScpkSj.js","../chunks/rxpTDz6e.js","../chunks/Dl1orkLD.js","../chunks/D_pI6fQj.js","../chunks/zFNEK25s.js","../chunks/CL2NbQte.js","../chunks/D_JYBHfY.js","../chunks/Cvs00xeJ.js","../chunks/Duu7_u0O.js","../chunks/Dmk_Dxvx.js","../chunks/C5CzMsLd.js","../chunks/pyb07plo.js","../chunks/BRLX27Af.js","../chunks/C8NkvdGB.js","../chunks/Cxihbb8M.js","../chunks/BYV4nsB9.js","../chunks/DQ_sR0Oz.js","../chunks/DbyYraQc.js","../chunks/Dj4-5pgM.js","../chunks/BY6Wrw2B.js","../chunks/D-j7oGrU.js","../chunks/ChTYeCcj.js","../chunks/QOzMNXdI.js","../chunks/DoDP5r3i.js","../chunks/GKolV7NZ.js","../chunks/Bs6tEc1N.js","../chunks/DadzvVj2.js","../chunks/BUd8m5s5.js","../chunks/vIRtxQoE.js","../chunks/BeKBFCJY.js","../chunks/4c7MyKAz.js","../chunks/BpFwjkk6.js","../chunks/Glnbxn3o.js","../chunks/DZ__J_Ha.js","../chunks/VMSlSy0z.js","../chunks/DkkI5QKs.js","../chunks/C3cxdwvi.js","../chunks/CTc4Bt11.js","../chunks/pdT4reVn.js","../chunks/D0yCzUdH.js","../chunks/BiM6pph8.js","../chunks/DA_X7pFa.js","../chunks/B_DLPStx.js","../chunks/CZnF4aA7.js","../chunks/CGwv2ov9.js","../chunks/DRnuuSv_.js","../chunks/CGe7GMdJ.js","../chunks/B3MXpedj.js","../chunks/B6WMH48X.js","../chunks/B1pCqEo_.js","../chunks/BrYzRPrF.js","../chunks/Bg3hnFg2.js","../chunks/DYzr77oO.js","../chunks/CMq8eZcm.js","../chunks/N_B-5EBV.js","../chunks/u5nA3ppO.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/4ef240Er.js","../chunks/CXd_PekB.js","../chunks/CNJBC4J4.js","../chunks/Dz-aVBgt.js","../chunks/Bs354Zoz.js","../chunks/CfrNlpsM.js","../chunks/DdSLmJ2d.js","../chunks/BS3H3l-F.js","../chunks/DCdj6Lab.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/CY_HuWbD.js","../chunks/D1FCtSgh.js","../chunks/kAKGzqpF.js","../chunks/C5PvpwSg.js","../chunks/BsB-6bk9.js","../chunks/CaNUsX_h.js","../chunks/CaqllLde.js","../chunks/D7knBxw1.js","../chunks/COKPF4Dy.js","../chunks/BT3t3G5h.js","../chunks/BjiS_nfk.js","../chunks/DvcDHnyV.js","../chunks/DbEhBJ1e.js","../chunks/D9LchIWm.js","../chunks/BK2emRUs.js","../chunks/DnIiJOoS.js","../chunks/DsHDw-MJ.js"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{o as it,a as Tt}from"../chunks/CwlFPufh.js";import{Z as J,u as Y,H as t,aG as O,f as A,b as T,a as i,a0 as K,ah as x,ao as V,a4 as p,a6 as y,c as U,a5 as le,a1 as X,aH as re,at as ne,n as se,aI as he}from"../chunks/J6Bl3sxN.js";import{_ as Ge}from"../chunks/D9Z9MdNV.js";import{p as Q,i as z,a as Dt,b as Vt}from"../chunks/_fywD1i8.js";import{s as oe}from"../chunks/CdsLSXyK.js";import{b as Ue}from"../chunks/RQ99CAyZ.js";import{m as Be,a as Z,O as ot,T as Ft,G as Ke,F as $e,b as Mt,c as lt,t as fe,d as Pt,e as Lt,f as zt,g as Ht,h as Et,i as Ot,j as te,k as ye,p as Gt,S as pe,C as et,l as Ut,I as Bt,n as Rt,o as Wt,q as qt,r as jt,L as Zt,s as Xt,D as Qt,V as tt,W as Yt,u as Jt,v as Kt,w as at}from"../chunks/DDtRs2TW.js";import{B as de,o as Re,F as Se}from"../chunks/D-afBJkb.js";import{c as W}from"../chunks/D5NabK7e.js";import{e as De,d as Ce,s as ge,b as $t}from"../chunks/BYOkOkBz.js";import{s as ae}from"../chunks/D8EIH3Is.js";import{h as _e}from"../chunks/piBjdR0k.js";import{d as ke}from"../chunks/0Hj017KB.js";import{C as ea,a as je,b as Ze,S as ta,c as aa,d as na,X as ra,e as ia,f as oa,g as la,h as sa,i as da,j as ca,k as ua}from"../chunks/CyvILS5C.js";import{B as ve}from"../chunks/hcL2bxKX.js";var va=A('<div class="esri-ui-element svelte-xggl6e"><!></div>'),fa=A('<div class="esri-ui-element svelte-xggl6e"><!></div>'),ga=A('<div class="map-view svelte-xggl6e"></div> <!> <!>',1);function ha(S,e){J(e,!0);const n=Q(e,"webMap",3,null),a=Q(e,"panelPosition",3,"top-left"),r=Q(e,"menuPosition",3,"top-right");let l=null,c=O(null),C=O(null),f=O(null),u=O(!1);const _="streets-vector";let h,v;async function m(){if(!v){const[{default:g},{default:b},{default:G}]=await Promise.all([Ge(()=>import("../chunks/CyrEfJff.js").then(P=>P.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url),Ge(()=>import("../chunks/D5ew8ajr.js").then(P=>P.a3),__vite__mapDeps([38,1,2,3,5,39,24,6,7,22,40,41,42,43,8,9,10,11,44,23,20,21,45,46,47,48,12,13,49,50,51,25,52,53,17,32,54,55,56,26,57,58,15,59,0,4,14,16,18,19,27,28,29,30,31,33,34,35,36,37,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86]),import.meta.url),Ge(()=>import("../chunks/Dl1orkLD.js").then(P=>P.W),__vite__mapDeps([87,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,88,89,90,91,62,92,93,74,75,65,94,95,96,61,97,98,99,100,64,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,52,53,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171]),import.meta.url)]);h=g,v=b}}async function s(g,b){const G=new v({container:b,popupEnabled:!1,map:g});return await G.when(),G}function d(g){g.ui.move("zoom","top-right"),t(C)&&a()&&g.ui.add(t(C),a()),t(f)&&r()&&g.ui.add(t(f),r()),V(u,!0)}async function F(g){const b=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(G=>G.id);console.log("[uprn-map-view] Initializing map interactions with layers:",b),await Be.initializeAsync(g,new Set(b))}async function I(){return new h({basemap:_})}it(async()=>{await m(),await o()});async function k(){if(n())try{if(await m(),await o(),!t(c)){console.error("MapView is not initialized");return}t(c).map=n(),await n().when(),console.log("[uprn-map-view] MapView updated with new webMap")}catch(g){console.error("Error updating MapView with new webMap:",g)}}Y(()=>{n()&&k()});async function o(){if(!l){console.error("Map container element was not found");return}try{V(c,await s(n()??void 0,l),!0),await F(t(c)),d(t(c)),console.log("[uprn-map-view] Map loaded successfully")}catch(g){console.error("Error loading map:",g),await w()}}async function w(){try{const g=await I();V(c,await s(g,l),!0),await F(t(c)),d(t(c)),console.log("[uprn-map-view] Fallback map loaded")}catch(g){console.error("Error loading fallback map:",g)}}Y(()=>{if(!t(c)||!e.areaSelectionTreeviewStore)return;const g=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(b=>b.id);Be.updateInteractableLayers(new Set(g))});async function D(g){if(!t(c))return;const b=await t(c).whenLayerView(g);if(!b){console.warn("Could not get LayerView for the visible node layer");return}Z.setSelectedLayerView(b)}Y(()=>{if(!e.areaSelectionTreeviewStore.getVisibleNodes().length){Z.resetSelectedAreas();return}const g=e.areaSelectionTreeviewStore.getVisibleNodes()[0].layer;if(!g){console.warn("Visible node layer is not a FeatureLayer");return}D(g)});function N(){Be.cleanup(),t(c)&&t(c).destroy()}Tt(()=>{N()});var B=ga(),M=T(B);Ue(M,g=>l=g,()=>l);var H=x(M,2);{var L=g=>{var b=va(),G=p(b);{var P=E=>{var j=U(),$=T(j);oe($,()=>e.panel),i(E,j)};z(G,E=>{t(u)&&E(P)})}y(b),Ue(b,E=>V(C,E),()=>t(C)),i(g,b)};z(H,g=>{e.panel&&g(L)})}var R=x(H,2);{var q=g=>{var b=fa(),G=p(b);{var P=E=>{var j=U(),$=T(j);oe($,()=>e.menu),i(E,j)};z(G,E=>{t(u)&&E(P)})}y(b),Ue(b,E=>V(f,E),()=>t(f)),i(g,b)};z(R,g=>{e.menu&&g(q)})}i(S,B),K()}var ma=A('<div class="tree-node-item svelte-1ehc80l"><!></div>'),ya=A('<div class="tree-children relative ml-4 w-full svelte-1ehc80l"><div class="tree-guide-line tree-guide-line-animate svelte-1ehc80l"></div> <!></div>'),_a=A('<div class="w-full"><!>  <!></div>');function st(S,e){const n=Q(e,"isOpen",3,!1),a=Q(e,"childNodes",3,null);var r=_a(),l=p(r);oe(l,()=>e.content??le);var c=x(l,2);{var C=f=>{var u=ya(),_=x(p(u),2);de(_,19,()=>a()??[],h=>h.id,(h,v,m)=>{var s=ma(),d=p(s);oe(d,()=>e.childNode??le,()=>t(v)),y(s),X(()=>De(s,`animation-delay: ${100+t(m)*50}ms;`)),i(h,s)}),y(u),i(f,u)};z(c,f=>{n()&&a()&&f(C)})}y(r),i(S,r)}const dt="mb-1 cursor-pointer rounded-md border border-border/30 p-2 text-left",ct="transform-gpu transition-all duration-150 ease-out hover:border-border/50 hover:bg-card/70 hover:shadow-sm",wa="transition-colors hover:bg-card/70",We="text-sm font-normal",qe="bg-card/50",ut="bg-accent text-accent-foreground";function ba(S){const{enhancedHover:e=!1,includeFont:n=!1,pressed:a=!1}=S;let r=dt;return e?r+=" "+ct:r+=" "+wa,n&&(r+=" "+We),a?r+=" "+ut:r+=" "+qe,r}const pa="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";var Sa=A('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),Ca=A('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function nt(S,e){const n=`calc(100% - ${e.depth*1}rem)`,a=`${dt} ${ct}`,r=`${a} ${pa} ${qe} ${We}`,l=`${a} ${We}`;var c=U(),C=T(c);{var f=_=>{Ft(_,{get pressed(){return e.pressed},get class(){return r},variant:"outline",get style(){return`width: ${n};`},get onPressedChange(){return e.onclick},children:(h,v)=>{var m=Sa(),s=p(m),d=p(s),F=p(d);_e(F,()=>e.icon),y(d);var I=x(d,2),k=p(I,!0);y(I),y(s);var o=x(s,2);oe(o,()=>e.children??le),y(m),X(()=>ae(k,e.name)),i(h,m)},$$slots:{default:!0}})},u=_=>{var h=Ca();h.__click=function(...w){e.onclick?.apply(this,w)};var v=p(h),m=p(v),s=p(m);ot(s,{get isOpen(){return e.isOpen}});var d=x(s,2),F=p(d);_e(F,()=>e.icon),y(d);var I=x(d,2),k=p(I,!0);y(I),y(m);var o=x(m,2);oe(o,()=>e.children??le),y(v),y(h),X(()=>{Ce(h,1,`${l} ${e.pressed?ut:qe}`),De(h,`width: ${n};`),ae(k,e.name)}),i(_,h)};z(C,_=>{e.isTogglable?_(f):_(u,!1)})}i(S,c)}ke(["click"]);const vt=(S,e,n,a)=>e?ka(S,n):n?a?'<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',ka=(S,e)=>{switch(S.type){case"group":return Ke;case"feature":return $e;case"tile":return Mt;default:return e?Ke:$e}};function ft(S,e){J(e,!0);const n=d=>{var F=U(),I=T(F);{var k=o=>{var w=U(),D=T(w);{var N=M=>{nt(M,{isTogglable:!1,get pressed(){return t(u)},get icon(){return t(_)},get name(){return e.node.name},get depth(){return r()},onclick:s,get isOpen(){return t(f)}})},B=M=>{nt(M,{isTogglable:!0,get pressed(){return t(u)},get icon(){return t(_)},get name(){return e.node.name},get depth(){return r()},onclick:m,get isOpen(){return t(f)}})};z(D,M=>{C?M(N):M(B,!1)})}i(o,w)};z(I,o=>{e.treeviewConfigStore.getItemConfig(e.node.id)?.isHidden||o(k)})}i(d,F)},a=(d,F=le)=>{var I=U(),k=T(I);{var o=w=>{{let D=re(()=>r()+1);ft(w,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return F()},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return t(D)},get useLayerTypeIcon(){return l()}})}};z(k,w=>{C&&t(f)&&!e.treeviewConfigStore.getItemConfig(F().id)?.isHidden&&w(o)})}i(d,I)},r=Q(e,"depth",3,0),l=Q(e,"useLayerTypeIcon",3,!1),c=!!e.node.layer&&"visible"in e.node.layer,C=!!(e.node.children&&e.node.children.length);let f=O(!1),u=O(!1),_=O("");function h(){return!e.node.children||!e.getNodeVisibility?!1:e.node.children.some(d=>{const F=e.getNodeVisibility(d.id);return F!==void 0?F:d.layer.visible})}Y(()=>{if(e.node){if(C)V(u,h(),!0);else{const d=e.getNodeVisibility?e.getNodeVisibility(e.node.id):void 0;V(u,d!==void 0?d:e.node.layer.visible,!0)}V(_,vt(e.node.layer,l(),C,t(f)),!0)}});function v(){!c||!e.onNodeVisibilityChange||C||(V(u,!t(u)),e.onNodeVisibilityChange(e.node,t(u)))}function m(){C||v(),e.onNodeClick?.(e.node)}function s(){V(f,!t(f)),e.onNodeClick?.(e.node)}{let d=re(()=>C?e.node.children:null);st(S,{get isOpen(){return t(f)},get content(){return n},get childNodes(){return t(d)},get childNode(){return a}})}K()}class gt{#e=null;#r=O(ne([]));#a=re(()=>{const e=new Re;return this.#v(t(this.#r),e),e});#t=O(ne(new Re));#o=O(ne(new Re));initialize(e,n){if(!n)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#e=n,!e)throw new Error("TreeviewStore requires a valid array of layers to initialize.");V(this.#r,this.#g(e),!0)}getNodeById(e){return t(this.#a).get(e)}getNodes(){return t(this.#r)}getVisibleNodes(){const e=[];for(const[n,a]of t(this.#t)){if(!a)continue;const r=t(this.#a).get(n);r&&e.push(r)}return e}getNonHiddenNodes(){return this.#l(t(this.#r))}#l(e){const n=[];for(const a of e){const r=this.#s(a.id);if(!(r&&r.isHidden)&&(n.push(a),a.children?.length)){const l=this.#l(a.children);n.push(...l)}}return n}getVisibilityState(e){return t(this.#t).get(e)??!1}setVisibilityState(e,n){const a=t(this.#a).get(e);if(!a)throw new Error(`Tree node not found for ID: ${e}`);if(t(this.#t).set(e,n),a.layer.visible=n,this.#n(a,n),a.visibilityDependencyIds?.length&&this.#i(a,n),!a.visibilityGroupId)return;const r=a.visibilityGroupId;console.log(`Node ${e} is part of visibility group ${r}`);let l=t(this.#o).get(r);l||(l=[],t(this.#o).set(r,l));const c=this.#f(r);if(!c)throw new Error(`Visibility group config not found for group ID: ${r}`);if(!n){const f=l.indexOf(e);l.splice(f,1);return}const C=f=>{t(this.#t).set(f,!1);const u=t(this.#a).get(f);u&&(u.layer.visible=!1,this.#n(u,!1),u.visibilityDependencyIds?.length&&this.#i(u,!1));const _=l.indexOf(f);_>=0&&l.splice(_,1)};for(;l.length>=c.maxVisibleLayers;){const f=l[0];C(f)}l.push(e),this.#n(a,n),a.visibilityDependencyIds?.length&&this.#i(a,n)}#n(e,n){e.parent&&(t(this.#t).set(e.parent.id,n),e.parent.layer.visible=n,this.#n(e.parent,n))}#i(e,n){if(e.visibilityDependencyIds?.length)for(const a of e.visibilityDependencyIds){const r=t(this.#a).get(a);r&&(t(this.#t).set(a,n),r.layer.visible=n,this.#n(r,n))}}#f(e){if(e&&this.#e)return this.#e.getVisibilityGroupConfig(e)}#g(e){const n=e.map(a=>{const r=this.#s(a.id);return this.#c(a,void 0,r)});return this.#d([...n])}#s(e){if(e&&this.#e)return this.#e.getItemConfig(e)}#d(e){e.reverse();for(const n of e)n.children?.length&&this.#d(n.children);return e}#c(e,n,a){const r={id:e.id,name:e.title,layer:e,visibilityDependencyIds:a?.visibilityDependencyIds,visibilityGroupId:a?.visibilityGroupId,children:[],parent:n};if(e.visible=a?.isVisibleOnInit??!1,t(this.#t).set(e.id,e.visible),this.#y(e)){const l=e;return r.children=l.layers.toArray().map(c=>{const C=this.#h(c,a);return this.#c(c,r,C)}),r}if(this.#m(e)){const l=e;if(l.sublayers&&l.sublayers.length>0){const c=l.sublayers;r.children=c.toArray().map(this.#u)}}return r}#h(e,n){if(!this.#e||!n)return;const a=this.#e.getItemConfig(e.id);return{id:e.id,isDownloadable:a?.isDownloadable,isVisibleOnInit:a?.isVisibleOnInit,isHidden:a?.isHidden,visibilityDependencyIds:a?.visibilityDependencyIds??n.visibilityDependencyIds,visibilityGroupId:a?.visibilityGroupId??n.visibilityGroupId}}#m(e){return e.type==="map-image"||e.type==="wms"}#u(e){const n={id:e.uid,name:e.title,layer:e,children:[]};return e.sublayers?.length&&(n.children=e.sublayers.toArray().map(this.#u)),n}#v(e,n){for(const a of e)n.set(a.id,a),a.children?.length&&this.#v(a.children,n)}#y(e){return e.type==="group"}}function xa(S,e){J(e,!0);const n=Q(e,"webMap",3,null);Y(()=>{n()&&e.treeviewStore.initialize(n().layers.toArray(),e.treeviewConfigStore)});var a=U(),r=T(a);W(r,()=>lt,(l,c)=>{c(l,{children:(C,f)=>{var u=U(),_=T(u);de(_,17,()=>e.treeviewStore.getNodes(),h=>h.id,(h,v)=>{ft(h,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return t(v)},onNodeClick:()=>{},onNodeVisibilityChange:(m,s)=>e.treeviewStore.setVisibilityState(m.id,s),getNodeVisibility:m=>e.treeviewStore.getVisibilityState(m),depth:0,useLayerTypeIcon:!0})}),i(C,u)},$$slots:{default:!0}})}),i(S,a),K()}function Ia(S,e){J(e,!0),Y(()=>{if(!Z.lastAddedArea)return;(async()=>{if(Z.lastAddedArea===null)return;const a=await Z.getAreaNamesById([Z.lastAddedArea.id]);!a||a.length===0||!a[0]||fe.success(`Area added: ${a?.[0]}`)})()}),Y(()=>{if(!Z.lastRemovedArea)return;(async()=>{if(Z.lastRemovedArea===null)return;const a=await Z.getAreaNamesById([Z.lastRemovedArea.id]);!a||a.length===0||!a[0]||fe.success(`Area removed: ${a?.[0]}`)})()}),K()}var Na=A("<!> <!>",1),Aa=A("<!> <!>",1);function Ta(S,e){J(e,!0);const n=Q(e,"triggers",19,()=>[]);var a=U(),r=T(a);W(r,()=>Lt,(l,c)=>{c(l,{get value(){return e.value},get onValueChange(){return e.onValueChange},class:"w-full",children:(C,f)=>{var u=Aa(),_=T(u);W(_,()=>Pt,(v,m)=>{m(v,{class:"tab-list",children:(s,d)=>{var F=U(),I=T(F);de(I,17,n,Se,(k,o,w,D)=>{let N=()=>t(o).value,B=()=>t(o).label;var M=Na(),H=T(M);W(H,()=>zt,(q,g)=>{g(q,{get value(){return N()},class:"tab-trigger",children:(b,G)=>{se();var P=he();X(()=>ae(P,B())),i(b,P)},$$slots:{default:!0}})});var L=x(H,2);{var R=q=>{ea(q,{class:"separator"})};z(L,q=>{N()!==n()[n().length-1]?.value&&q(R)})}i(k,M)}),i(s,F)},$$slots:{default:!0}})});var h=x(_,2);oe(h,()=>e.children??le),i(C,u)},$$slots:{default:!0}})}),i(S,a),K()}var Da=A('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),Va=A("<!> <!>",1);function Te(S,e){var n=U(),a=T(n);W(a,()=>Ht,(r,l)=>{l(r,{get value(){return e.value},class:"w-full",children:(c,C)=>{var f=U(),u=T(f);W(u,()=>je,(_,h)=>{h(_,{class:"w-full overflow-hidden",children:(v,m)=>{var s=Va(),d=T(s);W(d,()=>Ze,(k,o)=>{o(k,{class:"card-content overflow-hidden p-0",children:(w,D)=>{ta(w,{class:"h-[400px] w-full",children:(N,B)=>{var M=Da(),H=p(M);oe(H,()=>e.children??le),y(M),i(N,M)},$$slots:{default:!0}})},$$slots:{default:!0}})});var F=x(d,2);{var I=k=>{var o=U(),w=T(o);W(w,()=>aa,(D,N)=>{N(D,{class:"flex items-center justify-between",children:(B,M)=>{var H=U(),L=T(H);oe(L,()=>e.footer),i(B,H)},$$slots:{default:!0}})}),i(k,o)};z(F,k=>{e.footer&&k(I)})}i(v,s)},$$slots:{default:!0}})}),i(c,f)},$$slots:{default:!0}})}),i(S,n)}function Fa(S,e){S.stopPropagation(),e.onFilterClicked?.(e.layerId)}var Ma=A("<button><!></button>");function ht(S,e){J(e,!0);let n=O(ne(e.hasFiltersApplied?.(e.layerId)??!1));Y(()=>{V(n,e.hasFiltersApplied?.(e.layerId)??!1,!0)});const a=re(()=>t(n)?Et:Ot);var r=Ma();let l;r.__click=[Fa,e];var c=p(r);_e(c,()=>t(a)),y(r),X(C=>{l=Ce(r,1,"filter-btn svelte-effqed",null,l,C),ge(r,"aria-pressed",t(n))},[()=>({active:t(n)})]),i(S,r),K()}ke(["click"]);var Pa=A('<li class="area-item svelte-1eawb4y"><span class="area-name svelte-1eawb4y"> </span> <!></li>'),La=A('<ul class="selected-list svelte-1eawb4y"></ul> <p class="count svelte-1eawb4y"> </p>',1),za=A('<p class="no-selection svelte-1eawb4y">No areas selected</p>'),Ha=A('<li class="data-item svelte-1eawb4y"><span class="data-name svelte-1eawb4y"> </span> <div class="data-actions svelte-1eawb4y"><!> <!></div></li>'),Ea=A('<ul class="selected-list svelte-1eawb4y"></ul> <p class="count svelte-1eawb4y"> </p>',1),Oa=A('<p class="no-selection svelte-1eawb4y">No data selected</p>'),Ga=A('<h2 class="svelte-1eawb4y">Export Options</h2> <div class="section svelte-1eawb4y"><h3 class="svelte-1eawb4y"> </h3> <h4 class="svelte-1eawb4y">Selected Areas</h4> <!></div> <div class="section svelte-1eawb4y"><h4 class="svelte-1eawb4y">Selected Data</h4> <!></div>',1);function Ua(S,e){J(e,!0);const n=Q(e,"fieldFilterMenuStore",7);let a=O(ne([]));Y(()=>{if(!Z.layerHighlightState.areaInfos.length){V(a,[],!0);return}(async()=>{const w=await Z.getAreaNamesById(Z.layerHighlightState.areaInfos.map(N=>N.id)),D=[];for(let N=0;N<w.length;N++)D.push({name:w[N]||"Unknown Area",HighlightAreaInfo:Z.layerHighlightState.areaInfos[N]});V(a,D,!0)})()});function r(o){const w=t(a).findIndex(D=>D.name===o);w!==-1&&Z.removeSelectedArea(t(a)[w]?.HighlightAreaInfo.id)}function l(o){console.log("[export-menu] Removing data selection for layerId:",o),te.DataSelections.delete(o),console.log("[export-menu] Current SelectedData:",na(te.DataSelections))}function c(o){n().ActiveLayer?.id===o?n().ActiveLayer=null:n().ActiveLayer=e.webMapStore.dataLookup.get(o)}function C(o){const w=te.DataSelections.get(o);return!(!w||!w.fields||w.fields.size===0||w.fields.size===e.webMapStore.dataLookup.get(o).fields?.length)}var f=Ga(),u=x(T(f),2),_=p(u),h=p(_,!0);y(_);var v=x(_,4);{var m=o=>{var w=La(),D=T(w);de(D,21,()=>t(a),Se,(M,H)=>{var L=Pa(),R=p(L),q=p(R,!0);y(R);var g=x(R,2);ve(g,{variant:"ghost",size:"sm",class:"area-remove-btn",onclick:()=>r(t(H).name),children:(b,G)=>{se();var P=he("×");i(b,P)},$$slots:{default:!0}}),y(L),X(()=>ae(q,t(H).name)),i(M,L)}),y(D);var N=x(D,2),B=p(N);y(N),X(()=>ae(B,`${t(a).length??""} area(s) selected`)),i(o,w)},s=o=>{var w=za();i(o,w)};z(v,o=>{t(a).length>0?o(m):o(s,!1)})}y(u);var d=x(u,2),F=x(p(d),2);{var I=o=>{var w=Ea(),D=T(w);de(D,21,()=>[...te.DataSelections.values()],Se,(M,H)=>{var L=Ha(),R=p(L),q=p(R,!0);y(R);var g=x(R,2),b=p(g);{var G=E=>{ht(E,{get layerId(){return t(H).layerId},onFilterClicked:c,hasFiltersApplied:C})};z(b,E=>{t(H).fields&&E(G)})}var P=x(b,2);ve(P,{variant:"ghost",size:"sm",class:"data-remove-btn",onclick:()=>l(t(H).layerId),children:(E,j)=>{se();var $=he("×");i(E,$)},$$slots:{default:!0}}),y(g),y(L),X(()=>ae(q,t(H).name)),i(M,L)}),y(D);var N=x(D,2),B=p(N);y(N),X(()=>ae(B,`${te.DataSelections.size??""} data layer(s) selected`)),i(o,w)},k=o=>{var w=Oa();i(o,w)};z(F,o=>{te.DataSelections.size>0?o(I):o(k,!1)})}y(d),X(o=>ae(h,o),[()=>e.areaSelectionTreeviewStore.getVisibleNodes()[0]?.layer.title]),i(S,f),K()}var Ba=A('<p class="text-sm text-muted-foreground">Click "Export" to begin the download.</p> <!>',1);function Ra(S,e){J(e,!0);const n=()=>Vt(Gt,"$page",a),[a,r]=Dt();function l(){if(Z.layerHighlightState.areaInfos.length<=0){fe.error("Please select at least one area to export.");return}if(te.DataSelections.size<=0){fe.error("Please select at least one data layer to export.");return}console.log("Starting export..."),fe.info("Export started successfully.",{duration:4e3});const f=crypto.randomUUID();ye.downloads.push({id:f,url:`${n().url}/${f}`,status:"pending"}),e.onExportSuccess?.()}var c=Ba(),C=x(T(c),2);ve(C,{onclick:l,children:(f,u)=>{se();var _=he("Export");i(f,_)},$$slots:{default:!0}}),i(S,c),K(),r()}var Wa=A('<p class="text-sm font-medium"> </p>'),qa=A('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function ja(S,e){J(e,!0);let n=O(null),a=O(ne({x:0,y:0})),r=0;const l=u=>{V(a,{x:u.clientX,y:u.clientY},!0)};Y(()=>(document.addEventListener("mousemove",l),()=>{document.removeEventListener("mousemove",l)})),Y(()=>{const u=Z.currentHoveredArea?.id,_=++r;if(!u){V(n,null);return}(async()=>{const h=await Z.getAreaNamesById([u]);_===r&&Z.currentHoveredArea?.id===u&&V(n,h[0]??null,!0)})()});var c=U(),C=T(c);{var f=u=>{var _=qa(),h=p(_);W(h,()=>je,(v,m)=>{m(v,{class:"max-w-xs border !py-2 shadow-lg",children:(s,d)=>{var F=U(),I=T(F);W(I,()=>Ze,(k,o)=>{o(k,{class:"!px-3 !py-0",children:(w,D)=>{var N=Wa(),B=p(N,!0);y(N),X(()=>ae(B,t(n))),i(w,N)},$$slots:{default:!0}})}),i(s,F)},$$slots:{default:!0}})}),y(_),X(()=>De(_,`left: ${t(a).x+10}px; top: ${t(a).y-10}px;`)),i(u,_)};z(C,u=>{t(n)&&u(f)})}i(S,c),K()}function Za(S,e){S.target===S.currentTarget&&e()}var Xa=(S,e)=>S.key==="Escape"&&e(),Qa=(S,e,n)=>e(t(n).name),Ya=A('<div class="info-icon-container svelte-18b92yu"><!></div>'),Ja=A('<div class="field-content-wrapper svelte-18b92yu"><!> <button class="field-content svelte-18b92yu" tabindex="0"><div class="field-name-container svelte-18b92yu"><span class="field-name svelte-18b92yu"> </span> <!></div></button></div>'),Ka=A('<div class="master-checkbox-container svelte-18b92yu"><!> <span class="master-checkbox-label svelte-18b92yu">Select All Fields</span></div> <!> <!>',1),$a=A("<!> <!>",1),en=A("<!> <!>",1),tn=A('<button class="close-button svelte-18b92yu" aria-label="Close"><!></button> <!>',1),an=A('<div class="card-container svelte-18b92yu" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function nn(S,e){J(e,!0);const n=Q(e,"fieldFilterMenuStore",7);let a=O(null),r=O(ne(new pe)),l=re(()=>{if(!t(a)||!t(a).fields)return{checked:!1,indeterminate:!1};const s=t(a).fields.length,d=t(r)?.size||0;return d===0?{checked:!1,indeterminate:!1}:d===s?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});Y(()=>{console.log("Active Layer to Filter:",n().ActiveLayer);const s=n().ActiveLayer;if(V(a,s,!0),s){const d=te.DataSelections.get(s.id);d?.fields?V(r,new pe([...d.fields]),!0):V(r,new pe,!0)}});function c(){C(),n().ActiveLayer=null}function C(){if(!t(a))return;let s=te.DataSelections.get(t(a).id);if(s){if((s.fields===void 0||s.fields===null)&&(s.fields=new pe),t(r).size===0){te.removeSelection(t(a).id);return}s.fields.clear(),t(r).forEach(d=>{s.fields?.add(d)})}}function f(s){t(a)&&(t(r).has(s)?t(r).delete(s):t(r).add(s))}function u(){if(!t(a)?.fields)return;(t(r)?.size||0)===0?t(a).fields.forEach(d=>{t(r).add(d.name)}):t(r).clear()}function _(){return t(a)?.fields?t(a).fields.filter(s=>!e.fieldsToHide?.has(s.alias?.toLowerCase()??"")):[]}var h=U(),v=T(h);{var m=s=>{var d=an();d.__click=[Za,c],d.__keydown=[Xa,c];var F=p(d);W(F,()=>je,(I,k)=>{k(I,{class:"command-card",children:(o,w)=>{var D=tn(),N=T(D);N.__click=c;var B=p(N);ra(B,{size:20}),y(N);var M=x(N,2);W(M,()=>Ze,(H,L)=>{L(H,{class:"card-content",children:(R,q)=>{var g=U(),b=T(g);W(b,()=>ia,(G,P)=>{P(G,{children:(E,j)=>{var $=en(),ee=T($);W(ee,()=>oa,(ce,ue)=>{ue(ce,{placeholder:"Search for fields..."})});var we=x(ee,2);W(we,()=>la,(ce,ue)=>{ue(ce,{children:(me,Ve)=>{var xe=$a(),Ie=T(xe);W(Ie,()=>sa,(Fe,Me)=>{Me(Fe,{children:(Pe,_t)=>{se();var Ne=he("No results found.");i(Pe,Ne)},$$slots:{default:!0}})});var yt=x(Ie,2);W(yt,()=>da,(Fe,Me)=>{Me(Fe,{heading:"Fields",children:(Pe,_t)=>{var Ne=Ka(),Le=T(Ne),wt=p(Le);et(wt,{get checked(){return t(l).checked},get indeterminate(){return t(l).indeterminate},onCheckedChange:u}),se(2),y(Le);var Xe=x(Le,2);W(Xe,()=>Ut,(ze,ie)=>{ie(ze,{})});var bt=x(Xe,2);de(bt,17,_,Se,(ze,ie)=>{var Qe=U(),pt=T(Qe);W(pt,()=>ca,(St,Ct)=>{Ct(St,{class:"field-item",onselect:()=>f(t(ie).name),children:(kt,Cn)=>{var He=Ja(),Ye=p(He);{let be=re(()=>t(r)?.has(t(ie).name)??!1);et(Ye,{class:"field-checkbox",get checked(){return t(be)},onCheckedChange:()=>f(t(ie).name)})}var Ee=x(Ye,2);Ee.__click=[Qa,f,ie];var Je=p(Ee),Oe=p(Je),xt=p(Oe,!0);y(Oe);var It=x(Oe,2);{var Nt=be=>{var Ae=Ya(),At=p(Ae);_e(At,()=>Bt),y(Ae),X(()=>ge(Ae,"title",t(ie).description)),i(be,Ae)};z(It,be=>{t(ie).description&&be(Nt)})}y(Je),y(Ee),y(He),X(()=>ae(xt,t(ie).alias||t(ie).name)),i(kt,He)},$$slots:{default:!0}})}),i(ze,Qe)}),i(Pe,Ne)},$$slots:{default:!0}})}),i(me,xe)},$$slots:{default:!0}})}),i(E,$)},$$slots:{default:!0}})}),i(R,g)},$$slots:{default:!0}})}),i(o,D)},$$slots:{default:!0}})}),y(d),i(s,d)};z(v,s=>{t(a)&&s(m)})}i(S,h),K()}ke(["click","keydown"]);var rn=A('<li class="download-item svelte-ynwhdm"><div class="download-info svelte-ynwhdm"><span class="download-url svelte-ynwhdm"> </span></div> <div class="download-actions svelte-ynwhdm"><div><!></div> <!> <!> <!></div></li>'),on=A('<ul class="selected-list svelte-ynwhdm"></ul> <p class="count svelte-ynwhdm"> </p>',1),ln=A('<p class="no-selection svelte-ynwhdm">No downloads in queue</p>'),sn=A('<div class="section svelte-ynwhdm"><h4 class="svelte-ynwhdm">Download Queue</h4> <!></div>');function dn(S,e){J(e,!0);let n=O(ne(new Set));function a(v){const m=ye.downloads.findIndex(s=>s.url===v);m!==-1&&ye.downloads.splice(m,1)}async function r(v){try{await navigator.clipboard.writeText(v),V(n,new Set(t(n)).add(v),!0),fe.success("URL copied to clipboard"),setTimeout(()=>{const m=new Set(t(n));m.delete(v),V(n,m,!0)},2e3)}catch(m){console.error("Failed to copy URL:",m),fe.error("Failed to copy URL to clipboard")}}function l(v){switch(v){case"completed":return"#059669";case"in-progress":return"#2563eb";case"failed":return"#dc2626";case"pending":default:return"#6b7280"}}function c(v){switch(v){case"completed":return"Completed";case"in-progress":return"In Progress";case"failed":return"Failed";case"pending":default:return"Pending"}}function C(v){switch(v){case"completed":return Xt;case"in-progress":return Zt;case"failed":return jt;case"pending":default:return qt}}var f=sn(),u=x(p(f),2);{var _=v=>{var m=on(),s=T(m);de(s,21,()=>ye.downloads,Se,(I,k)=>{var o=rn(),w=p(o),D=p(w),N=p(D,!0);y(D),y(w);var B=x(w,2),M=p(B),H=p(M);{let b=re(()=>l(t(k).status));ve(H,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${t(b)??""}`},disabled:!0,children:(G,P)=>{const E=re(()=>C(t(k).status));var j=U(),$=T(j);{let ee=re(()=>t(k).status==="in-progress"?"spinning":"");W($,()=>t(E),(we,ce)=>{ce(we,{size:14,get class(){return t(ee)}})})}i(G,j)},$$slots:{default:!0}})}y(M);var L=x(M,2);ve(L,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>r(t(k).url),title:"Copy URL to clipboard",children:(b,G)=>{var P=U(),E=T(P);{var j=ee=>{Rt(ee,{size:14})},$=ee=>{Wt(ee,{size:14})};z(E,ee=>{t(n).has(t(k).url)?ee(j):ee($,!1)})}i(b,P)},$$slots:{default:!0}});var R=x(L,2);{var q=b=>{ve(b,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(t(k).url,"_blank"),title:"Open download",children:(G,P)=>{se();var E=he("📥");i(G,E)},$$slots:{default:!0}})};z(R,b=>{t(k).status==="completed"&&b(q)})}var g=x(R,2);ve(g,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>a(t(k).url),title:"Remove from queue",children:(b,G)=>{se();var P=he("×");i(b,P)},$$slots:{default:!0}}),y(B),y(o),X(b=>{ge(D,"title",t(k).url),ae(N,t(k).id),ge(M,"title",b)},[()=>c(t(k).status)]),i(I,o)}),y(s);var d=x(s,2),F=p(d);y(d),X(()=>ae(F,`${ye.downloads.length??""} download(s) in queue`)),i(v,m)},h=v=>{var m=ln();i(v,m)};z(u,v=>{ye.downloads.length>0?v(_):v(h,!1)})}y(f),i(S,f),K()}var cn=A('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function rt(S,e){J(e,!0);const n=Q(e,"isGroup",3,!1),a=Q(e,"isOpen",3,!1),r=`calc(100% - ${e.depth*1}rem)`;var l=cn();l.__click=function(...d){e.onclick?.apply(this,d)};var c=p(l),C=p(c),f=p(C);{var u=d=>{ot(d,{get isOpen(){return a()}})};z(f,d=>{n()&&d(u)})}var _=x(f,2),h=p(_);_e(h,()=>e.icon),y(_);var v=x(_,2),m=p(v,!0);y(v),y(C);var s=x(C,2);oe(s,()=>e.children??le),y(c),y(l),X(d=>{Ce(l,1,d),De(l,`width: ${r};`),ae(m,e.name)},[()=>$t(ba({enhancedHover:!0,includeFont:!0}))]),i(S,l),K()}ke(["click"]);function un(S,e,n){S.stopPropagation(),V(e,!t(e)),n.onDownloadStateChanged?.(n.node,t(e))}var vn=A("<button><!></button>");function fn(S,e){J(e,!0);let n=O(ne(e.getDownloadState?.(e.node)??!1));Y(()=>{if(e.getDownloadState){const c=e.getDownloadState(e.node);V(n,c??!1,!0)}});var a=vn();let r;a.__click=[un,n,e];var l=p(a);_e(l,()=>Qt),y(a),X(c=>{r=Ce(a,1,"download-btn svelte-1gynj9v",null,r,c),ge(a,"title",`Download ${e.node.name??""}`),ge(a,"aria-label",`Download ${e.node.name??""}`),ge(a,"aria-pressed",t(n))},[()=>({active:t(n)})]),i(S,a),K()}ke(["click"]);var gn=A('<div class="flex items-center gap-2"><!></div>'),hn=A("<div><!></div>"),mn=A("<!> <!>",1),yn=A('<div class="flex items-center gap-2"><!> <!></div>');function mt(S,e){J(e,!0);const n=I=>{var k=U(),o=T(k);{var w=D=>{var N=U(),B=T(N);{var M=L=>{rt(L,{get icon(){return t(h)},get name(){return e.node.name},get depth(){return l()},onclick:F,isGroup:!0,get isOpen(){return t(u)},children:q=>{var g=gn(),b=p(g);{var G=P=>{tt(P,{get checked(){return t(_)},onCheckedChange:s})};z(b,P=>{f&&P(G)})}y(g),i(q,g)},$$slots:{default:!0}})},H=L=>{rt(L,{get icon(){return t(h)},get name(){return e.node.name},get depth(){return l()},onclick:d,isGroup:!1,children:q=>{var g=yn(),b=p(g);{var G=j=>{var $=mn(),ee=T($);{var we=ue=>{var me=hn();let Ve;var xe=p(me);ht(xe,{get layerId(){return e.node.id},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied}}),y(me),X(Ie=>Ve=Ce(me,1,"filter-transition-wrapper svelte-42m3ms",null,Ve,Ie),[()=>({"fade-in":!t(m),"fade-out":t(m)})]),i(ue,me)};z(ee,ue=>{t(v)&&ue(we)})}var ce=x(ee,2);fn(ce,{get node(){return e.node},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState}}),i(j,$)};z(b,j=>{e.isDownloadable&&j(G)})}var P=x(b,2);{var E=j=>{tt(j,{get checked(){return t(_)},onCheckedChange:s})};z(P,j=>{f&&j(E)})}y(g),i(q,g)},$$slots:{default:!0}})};z(B,L=>{C?L(M):L(H,!1)})}i(D,N)};z(o,D=>{r()?.getItemConfig(e.node.id)?.isHidden||D(w)})}i(I,k)},a=(I,k=le)=>{var o=U(),w=T(o);{var D=N=>{{let B=re(()=>r()?.getItemConfig(k().id)?.isDownloadable??!0),M=re(()=>l()+1);mt(N,{get node(){return k()},get isDownloadable(){return t(B)},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return t(M)},get useLayerTypeIcon(){return c()}})}};z(w,N=>{C&&t(u)&&!r()?.getItemConfig(k().id)?.isHidden&&N(D)})}i(I,o)},r=Q(e,"treeviewConfigStore",3,null),l=Q(e,"depth",3,0),c=Q(e,"useLayerTypeIcon",3,!1),C=!!(e.node.children&&e.node.children.length),f=!!e.node.layer&&"visible"in e.node.layer&&!C;let u=O(!1),_=O(!1),h=O(""),v=O(!1),m=O(!1);Y(()=>{if(!e.node)return;const I=e.getNodeVisibility?e.getNodeVisibility(e.node.id):void 0;V(_,I!==void 0?I:e.node.layer.visible,!0),V(h,vt(e.node.layer,c(),C,t(u)),!0)}),Y(()=>{const I=(e.getDownloadState?.(e.node)&&e.node.layer.type==="feature")??!1;I&&!t(v)?(V(v,!0),V(m,!1)):!I&&t(v)&&(V(m,!0),setTimeout(()=>{V(v,!1),V(m,!1)},180))});function s(){!f||!e.onNodeVisibilityChange||(V(_,!t(_)),e.onNodeVisibilityChange(e.node,t(_)))}function d(){e.onNodeClick?.(e.node)}function F(){V(u,!t(u)),e.onNodeClick?.(e.node)}{let I=re(()=>C?e.node.children:null);st(S,{get isOpen(){return t(u)},get content(){return n},get childNodes(){return t(I)},get childNode(){return a}})}K()}function _n(S,e){J(e,!0);const n=Q(e,"webMap",3,null),a=Q(e,"fieldFilterMenuStore",7),r=new gt;Y(()=>{if(!n())return;(async()=>{await n().when(),r.initialize(n().layers.toArray(),e.treeviewConfigStore),console.log("TreeView initialized with layers:",r.getNodes())})()});function l(h,v){if(v){const m={layerId:h.id,name:h.layer.title||"",fields:new pe(h.layer.fields?.map(s=>s.name)||[])};te.addSelection(m)}else te.removeSelection(h.id)}function c(h){return te.DataSelections.has(h.id)}function C(h){if(a().ActiveLayer?.uid===h)a().ActiveLayer=null;else{const m=r.getNodeById(h)?.layer;a().ActiveLayer=m}}function f(h){const v=te.DataSelections.get(h);if(!v?.fields)return!1;const m=r.getNodeById(h);if(!m)return!1;const s=m.layer.fields?.length||0,d=v.fields.size;return d>0&&d!==s}var u=U(),_=T(u);W(_,()=>lt,(h,v)=>{v(h,{children:(m,s)=>{var d=U(),F=T(d);de(F,17,()=>r.getNodes(),I=>I.id,(I,k)=>{{let o=re(()=>e.treeviewConfigStore.getItemConfig(t(k).id)?.isDownloadable??!1);mt(I,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return t(k)},get isDownloadable(){return t(o)},onNodeClick:()=>{},onNodeVisibilityChange:(w,D)=>r.setVisibilityState(w.id,D),getNodeVisibility:w=>r.getVisibilityState(w),onDownloadStateChanged:l,getDownloadState:c,onFilterClicked:C,hasFiltersApplied:f,depth:0,useLayerTypeIcon:!0})}}),i(m,d)},$$slots:{default:!0}})}),i(S,u),K()}const wn=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];var bn=A("<!> <!> <!> <!>",1),pn=A('<div class="flex w-120 min-w-0 flex-col gap-6"><!></div>'),Sn=A('<!> <!> <!> <!> <div class="map-section svelte-1v5dyfr"><!></div>',1);function Gn(S,e){J(e,!0);const n=o=>{var w=pn(),D=p(w);Ta(D,{get value(){return t(c)},get triggers(){return wn},onValueChange:_,children:(N,B)=>{var M=bn(),H=T(M);Te(H,{value:"define-areas",children:(g,b)=>{xa(g,{get webMap(){return a.data},get treeviewStore(){return l},get treeviewConfigStore(){return t(u)}})}});var L=x(H,2);Te(L,{value:"select-data",children:(g,b)=>{_n(g,{get webMap(){return a.data},get treeviewConfigStore(){return t(f)},get fieldFilterMenuStore(){return r}})}});var R=x(L,2);Te(R,{value:"export",footer:b=>{Ra(b,{onExportSuccess:h})},children:(b,G)=>{Ua(b,{get webMapStore(){return a},get areaSelectionTreeviewStore(){return l},get fieldFilterMenuStore(){return r}})}});var q=x(R,2);Te(q,{value:"downloads",children:(g,b)=>{dn(g,{})}}),i(N,M)},$$slots:{default:!0}}),y(w),i(o,w)},a=ne(new Yt),r=ne(new Jt),l=ne(new gt);let c=O("define-areas"),C=O(ne(new Set)),f=O(void 0),u=O(void 0);it(async()=>{const o=await ua();V(C,new Set(o.fieldsToHide||[]),!0),Z.setNameFields(o.selectionLayersNameFields||[]),V(f,new at(o.dataSelectionTreeviewConfig),!0),V(u,new at(o.areaSelectionTreeviewConfig),!0),await a.initializeAsync({portalUrl:o.portalUrl,itemId:o.portalItemId||"",proxy:o.proxy}),console.log("[page] WebMap loaded")});function _(o){V(c,o,!0)}function h(){V(c,"downloads")}var v=Sn(),m=T(v);Kt(m,{});var s=x(m,2);ja(s,{});var d=x(s,2);nn(d,{get fieldFilterMenuStore(){return r},get fieldsToHide(){return t(C)}});var F=x(d,2);Ia(F,{});var I=x(F,2),k=p(I);ha(k,{get webMap(){return a.data},get areaSelectionTreeviewStore(){return l},panelPosition:"top-left",menuPosition:"top-right",get panel(){return n}}),y(I),i(S,v),K()}export{Gn as component};
