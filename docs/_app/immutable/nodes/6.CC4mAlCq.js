const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/qH7mSRsP.js","../chunks/DtUpcSZL.js","../chunks/DHq0rblm.js","../chunks/BfhsIlKo.js","../chunks/Bfy3IuBS.js","../chunks/D9Z9MdNV.js","../chunks/CVNciJfy.js","../chunks/BgvLO-3W.js","../chunks/BX6uGHh-.js","../chunks/9Ox5__Nz.js","../chunks/Cw1pwOU3.js","../chunks/Ab6_LQF8.js","../chunks/BBF-Q_yj.js","../chunks/wXBmGVea.js","../chunks/CltlN6Gd.js","../chunks/DwaPv9Xz.js","../chunks/AqoYAsfW.js","../chunks/DJm5w1ND.js","../chunks/0hQHE1hW.js","../chunks/CrJspfcO.js","../chunks/b9L_h0zx.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/BsbEhHPI.js","../chunks/Cl5k1y0H.js","../chunks/DpJvGWA2.js","../chunks/Cl5lrJ4c.js","../chunks/DQn9I9lw.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/C4HJhmWz.js","../chunks/CNYcnJ6H.js","../chunks/BTH-nl7Z.js","../chunks/Djp3mnm5.js","../chunks/CZq-58rh.js","../chunks/DQOJ18NT.js","../chunks/Cluoqd2L.js","../chunks/C9qos2z4.js","../chunks/leey51BE.js","../chunks/Dr81SL3o.js","../chunks/EzLf78vY.js","../chunks/BHLr0vjc.js","../chunks/D1_MfKwV.js","../chunks/BcrDfNdP.js","../chunks/D7sMTsX4.js","../chunks/9YvG7tFv.js","../chunks/CaBqhsnl.js","../chunks/D63lrzPI.js","../chunks/aQeO9QTD.js","../chunks/CyjmmkSk.js","../chunks/CrYKsk-d.js","../chunks/BMX0GFJS.js","../chunks/Clb_cEQr.js","../chunks/BBxgwA0n.js","../chunks/C9whXK6h.js","../chunks/DZd6gJy7.js","../chunks/C8GqbwDu.js","../chunks/C8BmVxiO.js","../chunks/CMoLxMUG.js","../chunks/NdScq7k1.js","../chunks/DZLBqSEc.js","../chunks/CF823MtT.js","../chunks/Caz3HfWH.js","../chunks/DQ8jsygj.js","../chunks/BKG_ir21.js","../chunks/B7w94aGg.js","../chunks/Chk7YAAL.js","../chunks/D0t3l1UW.js","../chunks/Cgb6qxNH.js","../chunks/Dod-TrW4.js","../chunks/BHlmUX6D.js","../chunks/QQC62dOK.js","../chunks/jdufh_Jr.js","../chunks/DzaaQIyy.js","../chunks/BqdZpaCH.js","../chunks/7ds_V64K.js","../chunks/DKpmsPfl.js","../chunks/DMCjUwuD.js","../chunks/BbR6Ed1p.js","../chunks/B1N-tmtC.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/CWKudsnk.js","../chunks/pDuGEAnG.js","../chunks/TZ4P8aNX.js","../chunks/BrScpkSj.js","../chunks/rxpTDz6e.js","../chunks/_eTnGSCm.js","../chunks/DoXK2rGs.js","../chunks/CvZv6kXV.js","../chunks/CL2NbQte.js","../chunks/CVUrPSmZ.js","../chunks/rQ-vz-om.js","../chunks/ztX0VfGL.js","../chunks/Bfg4i6t0.js","../chunks/C5CzMsLd.js","../chunks/C-1NjLoF.js","../chunks/xsOdMItc.js","../chunks/CB-CpKdU.js","../chunks/4cy7Pgzl.js","../chunks/D0d9PgA0.js","../chunks/IE6ziWyc.js","../chunks/DIE2lAdj.js","../chunks/Dnb1jllm.js","../chunks/DfNP466Y.js","../chunks/BDichOSX.js","../chunks/hhyMHsiN.js","../chunks/DG4UNhXW.js","../chunks/BmvKMzhd.js","../chunks/GKolV7NZ.js","../chunks/C3ivRrZK.js","../chunks/BMWNXnry.js","../chunks/CPDk_7s0.js","../chunks/DJJBCOBx.js","../chunks/f7qLKxBD.js","../chunks/4c7MyKAz.js","../chunks/B6mrpe4L.js","../chunks/CQkwvB8z.js","../chunks/DrsTwCf6.js","../chunks/VMSlSy0z.js","../chunks/hA7KKITz.js","../chunks/BNqa_sBW.js","../chunks/D-SjBRAN.js","../chunks/DKdVR8l2.js","../chunks/C3u-0iR8.js","../chunks/Be1aPnRM.js","../chunks/DwiUUeYM.js","../chunks/CJ_AbRIx.js","../chunks/CJzbRXVH.js","../chunks/BcmEWPbN.js","../chunks/67YjF2Uj.js","../chunks/E20RW6ho.js","../chunks/LMooF2_P.js","../chunks/BN9Q46Wb.js","../chunks/BLfcSl1a.js","../chunks/Beq0v4pS.js","../chunks/F7GFkUtI.js","../chunks/B3JmDown.js","../chunks/DuNlvCNt.js","../chunks/D4PsiDPW.js","../chunks/BYV3hPBJ.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/DVzBEuww.js","../chunks/Bv088Xi1.js","../chunks/CVBwMHC0.js","../chunks/D6QanDbd.js","../chunks/BzbIPcRT.js","../chunks/CfrNlpsM.js","../chunks/DdSLmJ2d.js","../chunks/BS3H3l-F.js","../chunks/DCdj6Lab.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/Di4P92Bn.js","../chunks/ChlOomCl.js","../chunks/BisUhwxy.js","../chunks/CI5T-kwe.js","../chunks/Bt_bao6a.js","../chunks/mP7O20ng.js","../chunks/Aj7xkMnS.js","../chunks/CXOGofbs.js","../chunks/Bbn5Lc5C.js","../chunks/DmsDaAnS.js","../chunks/C_RZKqoi.js","../chunks/AIZ50nPh.js","../chunks/VStmm7cP.js","../chunks/BbY1p2Nf.js","../chunks/BXAqi3_T.js","../chunks/D8UNv0pX.js","../chunks/DsHDw-MJ.js"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{o as Qe,a as Ot}from"../chunks/CwlFPufh.js";import{c as E,b as x,a as m,Z as J,a5 as de,a0 as $,aG as N,at as Y,H as r,ao as C,u as re,f as T,ah as L,a4 as k,a6 as S,a1 as te,aH as Q,n as ve,aI as we}from"../chunks/J6Bl3sxN.js";import{l as Gt,s as Ye,r as ht,p as X,i as P,a as Rt,b as Ut}from"../chunks/_fywD1i8.js";import{_ as fe}from"../chunks/D9Z9MdNV.js";import{s as oe}from"../chunks/CdsLSXyK.js";import{b as Ne}from"../chunks/RQ99CAyZ.js";import{I as Wt,o as ce,B as ge,F as Ce}from"../chunks/D-afBJkb.js";import{c as Z}from"../chunks/D5NabK7e.js";import{O as vt,T as jt,G as at,F as ot,a as Bt,c as gt,t as ue,d as qt,e as Xt,f as Zt,g as Kt,h as Qt,i as Yt,p as Jt,S as be,C as st,j as $t,I as ei,k as ti,l as ii,m as ri,n as ni,L as ai,o as oi,s as si,M as li,V as lt,b as Le,q as di,r as ci}from"../chunks/vshQgP1V.js";import{e as me,d as Fe,s as Me,b as ui}from"../chunks/BYOkOkBz.js";import{s as ae}from"../chunks/D8EIH3Is.js";import{h as Ie}from"../chunks/piBjdR0k.js";import{d as ke}from"../chunks/0Hj017KB.js";import{I as fi,s as hi,C as vi,b as Je,S as gi,c as mi,d as yi,a as mt,X as wi,e as pi,f as bi,g as _i,h as Si,i as Ci,j as Ii,k as ki}from"../chunks/C9K026e1.js";import{B as he}from"../chunks/hcL2bxKX.js";import{c as Ai}from"../chunks/BbZCh908.js";import{X as xi}from"../chunks/DpacZYin.js";import"../chunks/BEqW7Zwo.js";function Li(c,e){const t=Gt(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const i=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];fi(c,Ye({name:"menu"},()=>t,{get iconNode(){return i},children:(n,a)=>{var o=E(),g=x(o);hi(g,e,"default",{}),m(n,o)},$$slots:{default:!0}}))}function Hi(c,e){J(e,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=ht(e,["$$slots","$$events","$$legacy"]);const i=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];Wt(c,Ye({name:"arrow-down-to-line"},()=>t,{get iconNode(){return i},children:(n,a)=>{var o=E(),g=x(o);oe(g,()=>e.children??de),m(n,o)},$$slots:{default:!0}})),$()}class Vi{#e=N(Y({featureLayerView:null,areaInfos:[]}));get layerHighlightState(){return r(this.#e)}set layerHighlightState(e){C(this.#e,e,!0)}#t=N(null);get lastAddedArea(){return r(this.#t)}set lastAddedArea(e){C(this.#t,e,!0)}#i=N(null);get lastRemovedArea(){return r(this.#i)}set lastRemovedArea(e){C(this.#i,e,!0)}#n=N(null);get currentHoveredArea(){return r(this.#n)}set currentHoveredArea(e){C(this.#n,e,!0)}#r=[];#o=new ce;setNameFields(e){console.log("Setting name fields:",e),this.#r=e}setSelectedLayerView(e){this.layerHighlightState?.featureLayerView!==e&&(this.layerHighlightState&&this.layerHighlightState.areaInfos.forEach(t=>{t.handle.remove()}),this.layerHighlightState={featureLayerView:e,areaInfos:[]})}clearSelectedLayerView(){this.layerHighlightState.featureLayerView!==null&&(this.resetSelectedAreas(),this.layerHighlightState.featureLayerView=null)}resetSelectedAreas(){!this.layerHighlightState.featureLayerView&&this.layerHighlightState.areaInfos.length===0||(this.layerHighlightState&&this.layerHighlightState.areaInfos.forEach(e=>{e.handle.remove()}),this.layerHighlightState={featureLayerView:null,areaInfos:[]})}addSelectedArea(e,t){if(!this.layerHighlightState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const i={id:e,handle:t};this.layerHighlightState.areaInfos.push(i),this.lastAddedArea=i}removeSelectedArea(e){if(!this.layerHighlightState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const t=this.layerHighlightState.areaInfos.findIndex(i=>i.id===e);t!==-1&&(this.lastRemovedArea={id:e,handle:this.layerHighlightState.areaInfos[t].handle},this.layerHighlightState.areaInfos[t].handle.remove(),this.layerHighlightState.areaInfos.splice(t,1))}async getAreaNamesById(e){if(!this.layerHighlightState?.featureLayerView)return[];const t=this.getNameFieldForCurrentLayer();if(!t)return[];const i=this.layerHighlightState.featureLayerView.layer;let n=this.#o.get(i.uid);n||(n=new ce,this.#o.set(i.uid,n));const a=new Array(e.length),o=new ce,g=[];if(e.forEach((v,_)=>{o.set(v,_);const u=n.get(v);u!==void 0?a[_]=u:g.push(v)}),g.length===0)return a.map(v=>v??"");const f=i.objectIdField,h=await i.queryFeatures({objectIds:g,outFields:[t,f],returnGeometry:!1});for(const v of h.features){const _=v.attributes[f],u=v.attributes[t],b=o.get(_);b!==void 0&&(a[b]=u??"",n.set(_,u??""))}return a.map(v=>v??"")}setHoveredArea(e,t){this.currentHoveredArea&&this.clearHoveredArea(),this.currentHoveredArea={id:e,handle:t}}clearHoveredArea(){this.currentHoveredArea&&(this.currentHoveredArea?.handle.remove(),this.currentHoveredArea=null)}getNameFieldForCurrentLayer(){if(!this.layerHighlightState||!this.layerHighlightState.featureLayerView)return null;const e=this.#r.find(t=>t.layerName===this.layerHighlightState?.featureLayerView?.layer?.title)?.field;return e||(console.warn(`SelectedAreasStore: No name field configured for layer ${this.layerHighlightState.featureLayerView.layer.title}`,this.#r),null)}}const O=new Vi;class Ni{#e=N(null);get mapView(){return r(this.#e)}set mapView(e){C(this.#e,e,!0)}#t=N(Y(new Set));get interactableLayers(){return r(this.#t)}set interactableLayers(e){C(this.#t,e,!0)}pointerMoveHandle=null;clickHandle=null;leaveHandle=null;enterHandle=null;#i=N(!1);get isInitialized(){return r(this.#i)}set isInitialized(e){C(this.#i,e,!0)}#n=N(!0);get pointerInsideMap(){return r(this.#n)}set pointerInsideMap(e){C(this.#n,e,!0)}initializationInProgress=!1;async initializeAsync(e,t){if(console.log("[map-interaction-store] Initializing with MapView"),this.mapView===e&&this.isInitialized){console.log("[map-interaction-store] MapView is already initialized"),this.interactableLayers=t;return}if(this.initializationInProgress){console.log("[map-interaction-store] Initialization already in progress");return}this.initializationInProgress=!0,console.log("[map-interaction-store] Cleaning up previous MapView if any"),this.cleanup(),this.mapView=e,this.interactableLayers=t,await e.when(),this.setupHighlights(e),this.setupPointerMoveHandler(e),this.setupClickHandler(e),this.setupLeaveHandler(e),this.setupEnterHandler(e),this.isInitialized=!0,console.log("[map-interaction-store] Initialized with MapView")}updateInteractableLayers(e){this.interactableLayers=e}setupHighlights(e){const t={name:"hover",color:"lightgreen",haloOpacity:1,fillOpacity:.2},i={name:"selected",color:"green",haloOpacity:1,fillOpacity:.3};e.highlights.push(t),e.highlights.push(i)}setupPointerMoveHandler(e){this.pointerMoveHandle=e.on("pointer-move",async t=>{if(!this.pointerInsideMap)return;const{results:i}=await e.hitTest(t),n=i[0];if(!n){this.clearHoverHighlight();return}const a=n.graphic,o=a.layer;if(!a||!o||!this.isLayerInteractable(o.id)||a.attributes?.[o.objectIdField]===void 0){this.clearHoverHighlight();return}const g=a.attributes?.[o.objectIdField];if(!(O.currentHoveredArea&&O.currentHoveredArea.id===g))try{const f=await e.whenLayerView(o);O.layerHighlightState.featureLayerView!==f&&O.setSelectedLayerView(f),this.clearHoverHighlight();const h=f;if(!h){console.warn("LayerView is not a FeatureLayerView");return}if(!this.pointerInsideMap)return;const v=h.highlight(a,{name:"hover"});O.setHoveredArea(g,v)}catch(f){console.error("Error in pointer-move handler:",f),this.clearHoverHighlight()}})}setupClickHandler(e){this.clickHandle=e.on("click",async t=>{const{results:i}=await e.hitTest(t),n=i[0];if(!n)return;const a=n.graphic,o=a.layer;if(!a||!o||!this.isLayerInteractable(o.id)||a.attributes?.[o.objectIdField]===void 0)return;const g=a.attributes?.[o.objectIdField];try{const f=await e.whenLayerView(o),h=f;if(!h){console.warn("Layer is not a FeatureLayerView");return}O.layerHighlightState.featureLayerView!==f&&O.setSelectedLayerView(f);const _=(O.layerHighlightState.areaInfos||[]).find(u=>u.id===g);if(_)O.removeSelectedArea(_.id);else{const u=h.highlight(a,{name:"selected"});O.addSelectedArea(g,u)}}catch(f){console.error("Error in click handler:",f)}})}setupLeaveHandler(e){this.leaveHandle=e.on("pointer-leave",()=>{this.pointerInsideMap=!1,this.clearHoverHighlight()})}setupEnterHandler(e){this.enterHandle=e.on("pointer-enter",()=>{this.pointerInsideMap=!0})}isLayerInteractable(e){return this.interactableLayers.has(e)}clearHoverHighlight(){O.currentHoveredArea&&O.clearHoveredArea()}cleanup(){this.isInitialized&&(this.pointerMoveHandle&&(this.pointerMoveHandle.remove(),this.pointerMoveHandle=null),this.clickHandle&&(this.clickHandle.remove(),this.clickHandle=null),this.leaveHandle&&(this.leaveHandle.remove(),this.leaveHandle=null),this.enterHandle&&(this.enterHandle.remove(),this.enterHandle=null),this.clearHoverHighlight(),this.isInitialized=!1,this.mapView=null,this.pointerInsideMap=!0,this.interactableLayers=new Set,console.log("[map-interaction-store] Cleaned up"))}get currentMapView(){return this.mapView}get initialized(){return this.isInitialized}}const He=new Ni;class yt{id;name;children;parent;constructor(e,t,i=[],n=null){this.id=e,this.name=t,this.children=i,this.parent=n}}class ee extends yt{layer;constructor(e,t,i,n=[],a=null){super(e,t,n,a),this.layer=i}}class ye extends ee{featureLayer;field;constructor(e,t,i,n,a=[],o=null){super(e,t,i,a,o),this.field=n,this.featureLayer=i}}var ie=(c=>(c.Inactive="inactive",c.Indeterminate="indeterminate",c.Active="active",c))(ie||{}),Mi=T('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),Fi=T('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),Ti=T('<div class="map-view svelte-i0p9uk"></div> <!> <!>',1);function zi(c,e){J(e,!0);const t=X(e,"webMap",3,null),i=X(e,"panelPosition",3,"top-left"),n=X(e,"menuPosition",3,"top-right");let a=null,o=N(null),g=N(null),f=N(null),h=N(!1);const v="streets-vector";let _,u;Qe(async()=>{await b(),await s()});async function b(){if(!u){const[{default:A},{default:V},{default:F},{default:B}]=await Promise.all([fe(()=>import("../chunks/qH7mSRsP.js").then(z=>z.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url),fe(()=>import("../chunks/leey51BE.js").then(z=>z.a3),__vite__mapDeps([38,1,2,3,5,39,24,6,7,22,40,41,42,43,8,9,10,11,44,23,20,21,45,46,47,48,12,13,49,50,51,25,52,53,17,32,54,55,56,26,57,58,15,59,0,4,14,16,18,19,27,28,29,30,31,33,34,35,36,37,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86]),import.meta.url),fe(()=>import("../chunks/_eTnGSCm.js").then(z=>z.W),__vite__mapDeps([87,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,88,89,90,91,62,92,93,74,75,65,94,95,96,61,97,98,99,100,64,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,52,53,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171]),import.meta.url),fe(()=>import("../chunks/Bfg4i6t0.js"),__vite__mapDeps([94,5,1,2,3,43,24,6,7,22,8,9,10,11,44,23,20,21,88,95,96,65,61,97,98,99,37,13,62,100,15,26,64,41,42,45,46,47,48,12,49,50,19,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,89,32,52,53,17,120,121,122,123,124,125,126,127,33,34,35,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,51,144,145,146,147,148,149,150,151,152,153,154,28,155,156,157,16,158,159,160,91,161,162,163,164,165,166,167,168,90]),import.meta.url)]);_=A,u=V}}async function w(A,V){const F=new u({container:V,popupEnabled:!1,map:A});return await F.when(),F}function y(A){A.ui.move("zoom","top-right"),r(g)&&i()&&A.ui.add(r(g),i()),r(f)&&n()&&A.ui.add(r(f),n()),C(h,!0)}async function H(){return new _({basemap:v})}async function l(){if(t())try{if(await b(),await s(),!r(o)){console.error("MapView is not initialized");return}r(o).map=t(),console.log("[uprn-map-view] MapView updated with new webMap")}catch(A){console.error("Error updating MapView with new webMap:",A)}}re(()=>{t()&&l()});async function s(){if(!a){console.error("Map container element was not found");return}try{C(o,await w(t()??void 0,a),!0),y(r(o)),console.log("[uprn-map-view] Map loaded successfully")}catch(A){console.error("Error loading map:",A),await d()}}async function d(){try{const A=await H();C(o,await w(A,a),!0),y(r(o)),console.log("[uprn-map-view] Fallback map loaded")}catch(A){console.error("Error loading fallback map:",A)}}re(()=>{if(!r(o)||!e.areaSelectionTreeviewStore.initialized)return;const A=e.areaSelectionTreeviewStore.getNonHiddenNodes().map(V=>V.id);He.initialized?He.updateInteractableLayers(new Set(A)):He.initializeAsync(r(o),new Set(A))});async function p(A){if(!r(o))return;const V=await r(o).whenLayerView(A);if(!V){console.warn("Could not get LayerView for the visible node layer");return}O.setSelectedLayerView(V)}re(()=>{if(!e.areaSelectionTreeviewStore.initialized)return;if(!e.areaSelectionTreeviewStore.getVisibleNodes().length){O.resetSelectedAreas();return}const A=e.areaSelectionTreeviewStore.getVisibleNodes()[0];if(!A||!(A instanceof ee)){console.warn("Visible node is not a FeatureLayer");return}if(!A.layer){console.warn("Visible node layer is not a FeatureLayer");return}p(A.layer)});function I(){He.cleanup(),r(o)&&r(o).destroy()}Ot(()=>{I()});var M=Ti(),j=x(M);Ne(j,A=>a=A,()=>a);var D=L(j,2);{var R=A=>{var V=Mi(),F=k(V);{var B=z=>{var U=E(),W=x(U);oe(W,()=>e.panel),m(z,U)};P(F,z=>{r(h)&&z(B)})}S(V),Ne(V,z=>C(g,z),()=>r(g)),m(A,V)};P(D,A=>{e.panel&&A(R)})}var G=L(D,2);{var q=A=>{var V=Fi(),F=k(V);{var B=z=>{var U=E(),W=x(U);oe(W,()=>e.menu),m(z,U)};P(F,z=>{r(h)&&z(B)})}S(V),Ne(V,z=>C(f,z),()=>r(f)),m(A,V)};P(G,A=>{e.menu&&A(q)})}m(c,M),$()}var Pi=T('<div class="tree-node-item svelte-1x7dzzd"><!></div>'),Di=T('<div class="tree-children relative ml-4 w-full svelte-1x7dzzd"><div class="tree-guide-line tree-guide-line-animate svelte-1x7dzzd"></div> <!></div>'),Ei=T('<div class="w-full"><!>  <!></div>');function wt(c,e){const t=X(e,"isOpen",3,!1),i=X(e,"childNodes",3,null);var n=Ei(),a=k(n);oe(a,()=>e.content??de);var o=L(a,2);{var g=f=>{var h=Di(),v=L(k(h),2);ge(v,19,()=>i()??[],_=>_.id,(_,u,b)=>{var w=Pi(),y=k(w);oe(y,()=>e.childNode??de,()=>r(u)),S(w),te(()=>me(w,`animation-delay: ${100+r(b)*50}ms;`)),m(_,w)}),S(h),m(f,h)};P(o,f=>{t()&&i()&&f(g)})}S(n),m(c,n)}const pt="mb-1 cursor-pointer rounded-md border border-border/30 p-2 text-left",bt="transform-gpu transition-all duration-150 ease-out hover:border-border/50 hover:bg-card/70 hover:shadow-sm",Oi="transition-colors hover:bg-card/70",Ze="text-sm font-normal",Ke="bg-card/50",_t="bg-accent text-accent-foreground";function Gi(c){const{enhancedHover:e=!1,includeFont:t=!1,pressed:i=!1}=c;let n=pt;return e?n+=" "+bt:n+=" "+Oi,t&&(n+=" "+Ze),i?n+=" "+_t:n+=" "+Ke,n}const Ri="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";var Ui=T('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),Wi=T('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function dt(c,e){const t=`calc(100% - ${e.depth*1}rem)`,i=`${pt} ${bt}`,n=`${i} ${Ri} ${Ke} ${Ze}`,a=`${i} ${Ze}`;var o=E(),g=x(o);{var f=v=>{jt(v,{get pressed(){return e.pressed},get class(){return n},variant:"outline",get style(){return`width: ${t};`},get onPressedChange(){return e.onclick},children:(_,u)=>{var b=Ui(),w=k(b),y=k(w),H=k(y);Ie(H,()=>e.icon),S(y);var l=L(y,2),s=k(l,!0);S(l),S(w);var d=L(w,2);oe(d,()=>e.children??de),S(b),te(()=>ae(s,e.name)),m(_,b)},$$slots:{default:!0}})},h=v=>{var _=Wi();_.__click=function(...p){e.onclick?.apply(this,p)};var u=k(_),b=k(u),w=k(b);vt(w,{get isOpen(){return e.isOpen}});var y=L(w,2),H=k(y);Ie(H,()=>e.icon),S(y);var l=L(y,2),s=k(l,!0);S(l),S(b);var d=L(b,2);oe(d,()=>e.children??de),S(u),S(_),te(()=>{Fe(_,1,`${a} ${e.pressed?_t:Ke}`),me(_,`width: ${t};`),ae(s,e.name)}),m(v,_)};P(g,v=>{e.isTogglable?v(f):v(h,!1)})}m(c,o)}ke(["click"]);const St=(c,e,t,i)=>e?ji(c,t):t?i?'<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>':'<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',ji=(c,e)=>{switch(c.type){case"group":return at;case"feature":return ot;case"tile":return Bt;default:return e?at:ot}};function Ct(c,e){J(e,!0);const t=y=>{var H=E(),l=x(H);{var s=d=>{var p=E(),I=x(p);{var M=D=>{dt(D,{isTogglable:!1,get pressed(){return r(h)},get icon(){return r(v)},get name(){return e.node.name},get depth(){return n()},onclick:w,get isOpen(){return r(f)}})},j=D=>{dt(D,{isTogglable:!0,get pressed(){return r(h)},get icon(){return r(v)},get name(){return e.node.name},get depth(){return n()},onclick:b,get isOpen(){return r(f)}})};P(I,D=>{o?D(M):D(j,!1)})}m(d,p)};P(l,d=>{e.treeviewConfigStore.getItemConfig(e.node.id)?.isHidden||d(s)})}m(y,H)},i=(y,H=de)=>{var l=E(),s=x(l);{var d=p=>{{let I=Q(()=>n()+1);Ct(p,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return H()},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return r(I)},get useLayerTypeIcon(){return a()}})}};P(s,p=>{o&&r(f)&&!e.treeviewConfigStore.getItemConfig(H().id)?.isHidden&&p(d)})}m(y,l)},n=X(e,"depth",3,0),a=X(e,"useLayerTypeIcon",3,!1),o=!!(e.node.children&&e.node.children.length),g=!o;let f=N(!1),h=N(!1),v=N("");function _(){return!e.node.children||!e.getNodeVisibility?!1:e.node.children.some(y=>{const H=e.getNodeVisibility(y.id);return H!==void 0?H:y instanceof ee?y.layer.visible:!1})}re(()=>{if(!(!e.node||!(e.node instanceof ee))){if(o)C(h,_(),!0);else{const y=e.getNodeVisibility?e.getNodeVisibility(e.node.id):void 0;C(h,y!==void 0?y:e.node.layer.visible,!0)}C(v,St(e.node.layer,a(),o,r(f)),!0)}});function u(){!g||!e.onNodeVisibilityChange||o||(C(h,!r(h)),e.onNodeVisibilityChange(e.node,r(h)))}function b(){o||u(),e.onNodeClick?.(e.node)}function w(){C(f,!r(f)),e.onNodeClick?.(e.node)}{let y=Q(()=>o?e.node.children:null);wt(c,{get isOpen(){return r(f)},get content(){return t},get childNodes(){return r(y)},get childNode(){return i}})}$()}class It{#e=N(!1);get initialized(){return r(this.#e)}set initialized(e){C(this.#e,e,!0)}#t=null;#i=N(Y([]));#n=Q(()=>{const e=new ce;return this.#w(r(this.#i),e),e});#r=N(Y(new ce));#o=N(Y(new ce));#c=N(Y(new ce));initialize(e,t,i){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!t)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=t,i)for(const n of i)r(this.#c).set(n.id,n);if(!e)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#a(e),C(this.#i,this.#m(e),!0)}getNodeById(e){return this.#d(),r(this.#n).get(e)}getNodes(){return this.#d(),r(this.#i)}getVisibleNodes(){this.#d();const e=[];for(const[t,i]of r(this.#r)){if(!i)continue;const n=r(this.#n).get(t);n&&e.push(n)}return e}getNonHiddenNodes(){return this.#d(),this.#u(r(this.#i))}#u(e){this.#d();const t=[];for(const i of e){const n=this.#s(i.id);if(!(n&&n.isHidden)&&(t.push(i),i.children?.length)){const a=this.#u(i.children);t.push(...a)}}return t}getVisibilityState(e){return this.#d(),r(this.#r).get(e)??!1}setVisibilityState(e,t){this.#d();const i=r(this.#n).get(e);if(!i)throw new Error(`Tree node not found for ID: ${e}`);if(!(i instanceof ee))throw new Error(`Tree node is not a layer node: ${e}`);r(this.#r).set(e,t),i.layer.visible=t,i instanceof ye&&(i.featureLayer.displayField=t?i.field.name:""),this.#l(i,t);const n=this.#s(e);if(!n||n.isHidden||(n.visibilityDependencyIds?.length&&this.#f(i,t),!n.visibilityGroupId))return;const a=n.visibilityGroupId;console.log(`Node ${e} is part of visibility group ${a}`);let o=r(this.#o).get(a);o||(o=[],r(this.#o).set(a,o));const g=this.#h(a);if(!g)throw new Error(`Visibility group config not found for group ID: ${a}`);if(!t){const h=o.indexOf(e);o.splice(h,1);return}const f=h=>{r(this.#r).set(h,!1);const v=r(this.#n).get(h);if(v&&v instanceof ee){v.layer.visible=!1,this.#l(v,!1);const u=this.#s(h);u&&u.visibilityDependencyIds?.length&&this.#f(v,!1)}const _=o.indexOf(h);_>=0&&o.splice(_,1)};for(;o.length>=g.maxVisibleLayers;){const h=o[0];f(h)}o.push(e),this.#l(i,t),n.visibilityDependencyIds?.length&&this.#f(i,t)}#l(e,t){const i=e.parent;!i||!(i instanceof ee)||(r(this.#r).set(i.id,t),i.layer.visible=t,this.#l(i,t))}#f(e,t){const i=this.#s(e.id);if(i&&i.visibilityDependencyIds?.length)for(const n of i.visibilityDependencyIds){const a=r(this.#n).get(n);a&&a instanceof ee&&(r(this.#r).set(n,t),a.layer.visible=t,this.#l(a,t))}}#h(e){if(e&&this.#t)return this.#t.getVisibilityGroupConfig(e)}#a(e){this.#t&&this.#t.resolveInheritance(e)}#m(e){const t=e.map(i=>this.#g(i,void 0));return this.#v([...t])}#s(e){if(e&&this.#t)return this.#t.getItemConfig(e)}#v(e){e.reverse();for(const t of e)t.children?.length&&this.#v(t.children);return e}#g(e,t){const i=this.#s(e.id);if(i&&i.customConverterId){if(!r(this.#c).has(i.customConverterId))throw new Error(`Custom converter not found: ${i.customConverterId}`);const a=r(this.#c).get(i.customConverterId);if(!a)throw new Error(`Custom converter not found: ${i.customConverterId}`);return a.layerToNode(e,t??null)}const n=new ee(e.id,e.title,e,[],t);if(e.visible=i?.isVisibleOnInit??!1,r(this.#r).set(e.id,e.visible),this.#C(e)&&i?.showFields){const a=e;a.loaded||console.warn(`Layer not loaded: ${e.id}`);for(const o of a.fields??[]){const g=this.#p(o,n);n.children.push(g)}}if(this.#S(e)){const a=e;return n.children=a.layers.toArray().map(o=>this.#g(o,n)),n}if(this.#b(e)){const a=e;if(a.sublayers&&a.sublayers.length>0){const o=a.sublayers;n.children=o.toArray().map(this.#y)}}return n}#p(e,t){const i=this.#_(t.id,e.name),n=new ye(i,e.alias||e.name,t.layer,e,[],t),a=this.#s(i);return r(this.#r).set(i,a?.isVisibleOnInit??!1),n}#b(e){return e.type==="map-image"||e.type==="wms"}#y(e){const t=new ee(e.uid,e.title,e);return e.sublayers?.length&&(t.children=e.sublayers.toArray().map(this.#y)),t}#w(e,t){for(const i of e)t.set(i.id,i),i.children?.length&&this.#w(i.children,t)}#_(e,t){return`${e}-${t}`}#S(e){return e.type==="group"}#C(e){return e.type==="feature"}#d(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}function Bi(c,e){J(e,!0);const t=X(e,"webMap",3,null);re(()=>{!t()||e.treeviewStore.initialized||e.treeviewStore.initialize(t().layers.toArray(),e.treeviewConfigStore)});var i=E(),n=x(i);{var a=o=>{var g=E(),f=x(g);Z(f,()=>gt,(h,v)=>{v(h,{children:(_,u)=>{var b=E(),w=x(b);ge(w,17,()=>e.treeviewStore.getNodes(),y=>y.id,(y,H)=>{Ct(y,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return r(H)},onNodeClick:()=>{},onNodeVisibilityChange:(l,s)=>e.treeviewStore.setVisibilityState(l.id,s),getNodeVisibility:l=>e.treeviewStore.getVisibilityState(l),depth:0,useLayerTypeIcon:!0})}),m(_,b)},$$slots:{default:!0}})}),m(o,g)};P(n,o=>{e.treeviewStore.initialized&&o(a)})}m(c,i),$()}function qi(c,e){J(e,!0),re(()=>{if(!O.lastAddedArea)return;(async()=>{if(O.lastAddedArea===null)return;const i=await O.getAreaNamesById([O.lastAddedArea.id]);!i||i.length===0||!i[0]||ue.success(`Area added: ${i?.[0]}`)})()}),re(()=>{if(!O.lastRemovedArea)return;(async()=>{if(O.lastRemovedArea===null)return;const i=await O.getAreaNamesById([O.lastRemovedArea.id]);!i||i.length===0||!i[0]||ue.success(`Area removed: ${i?.[0]}`)})()}),$()}var Xi=T("<!> <!>",1),Zi=T('<div class="tab-list-wrapper svelte-rohqkk"><!></div> <!>',1);function Ki(c,e){J(e,!0);const t=X(e,"triggers",19,()=>[]);var i=E(),n=x(i);Z(n,()=>Xt,(a,o)=>{o(a,{get value(){return e.value},get onValueChange(){return e.onValueChange},class:"w-full",children:(g,f)=>{var h=Zi(),v=x(h),_=k(v);Z(_,()=>qt,(b,w)=>{w(b,{class:"tab-list",children:(y,H)=>{var l=E(),s=x(l);ge(s,17,t,Ce,(d,p,I,M)=>{let j=()=>r(p).value,D=()=>r(p).label;var R=Xi(),G=x(R);Z(G,()=>Zt,(V,F)=>{F(V,{get value(){return j()},class:"tab-trigger",children:(B,z)=>{ve();var U=we();te(()=>ae(U,D())),m(B,U)},$$slots:{default:!0}})});var q=L(G,2);{var A=V=>{vi(V,{class:"separator"})};P(q,V=>{j()!==t()[t().length-1]?.value&&V(A)})}m(d,R)}),m(y,l)},$$slots:{default:!0}})}),S(v);var u=L(v,2);oe(u,()=>e.children??de),m(g,h)},$$slots:{default:!0}})}),m(c,i),$()}var Qi=T('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),Yi=T("<!> <!>",1);function Ve(c,e){var t=E(),i=x(t);Z(i,()=>Kt,(n,a)=>{a(n,{get value(){return e.value},class:"w-full",children:(o,g)=>{var f=Yi(),h=x(f);Z(h,()=>Je,(u,b)=>{b(u,{class:"card-content overflow-hidden p-0",children:(w,y)=>{gi(w,{class:"h-full w-full",children:(H,l)=>{var s=Qi(),d=k(s);oe(d,()=>e.children??de),S(s),m(H,s)},$$slots:{default:!0}})},$$slots:{default:!0}})});var v=L(h,2);{var _=u=>{var b=E(),w=x(b);Z(w,()=>mi,(y,H)=>{H(y,{class:"flex items-center justify-between",children:(l,s)=>{var d=E(),p=x(d);oe(p,()=>e.footer),m(l,d)},$$slots:{default:!0}})}),m(u,b)};P(v,u=>{e.footer&&u(_)})}m(o,f)},$$slots:{default:!0}})}),m(c,t)}class Ji{#e=N(!1);get isLoaded(){return r(this.#e)}set isLoaded(e){C(this.#e,e,!0)}#t=N(null);get data(){return r(this.#t)}set data(e){C(this.#t,e,!0)}#i=Q(()=>{const e=new ce;function t(i){e.set(i.id,i),i.type==="group"&&i.layers.forEach(a=>{t(a)})}return this.data&&this.data.layers.forEach(i=>{t(i)}),e});get dataLookup(){return r(this.#i)}set dataLookup(e){C(this.#i,e)}#n=N(!1);get loading(){return r(this.#n)}set loading(e){C(this.#n,e,!0)}#r=N(null);get error(){return r(this.#r)}set error(e){C(this.#r,e,!0)}async initializeAsync(e){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:t,itemId:i,proxy:n}=e;await this.configurePortalAsync(t,n),await this.loadwebmapAsync(i)}catch(t){console.error("Error initializing webmap:",t),this.error=t.message}finally{this.loading=!1}}}async configurePortalAsync(e,t){if(!e)return;const i=await tr();if(i.portalUrl=e,console.log(i),!t)return;const{addProxyRule:n}=await ir();console.log("Adding proxy rule for portal traffic"),n({urlPrefix:t?.urlPrefix,proxyUrl:t?.proxyUrl})}async loadwebmapAsync(e){if(this.data)return;const[t,i]=await Promise.all([$i(),er()]),n=new i({id:e}),a=new t({portalItem:n});this.data=a,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}let je=null,Be=null,qe=null,Xe=null;async function $i(){return je||(je=fe(()=>import("../chunks/_eTnGSCm.js").then(c=>c.W),__vite__mapDeps([87,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,88,89,90,91,62,92,93,74,75,65,94,95,96,61,97,98,99,100,64,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,52,53,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171]),import.meta.url).then(c=>c.default)),je}async function er(){return Be||(Be=fe(()=>import("../chunks/AqoYAsfW.js"),__vite__mapDeps([16,5,1,2,3,6,7,13,10]),import.meta.url).then(c=>c.default)),Be}async function tr(){return qe||(qe=fe(()=>import("../chunks/DHq0rblm.js").then(c=>c.Z),[],import.meta.url).then(c=>c.default)),qe}async function ir(){return Xe||(Xe=fe(()=>import("../chunks/BgvLO-3W.js").then(c=>c.O),__vite__mapDeps([7,2,3]),import.meta.url)),Xe}class rr{#e=N(Y(new ce));get DataSelections(){return r(this.#e)}set DataSelections(e){C(this.#e,e,!0)}addSelection(e){this.DataSelections.set(e.layerId,e),ue.success(`'${e.name}' Added`)}removeSelection(e){const t=this.DataSelections.get(e);this.DataSelections.delete(e),ue.success(`'${t?.name}' Removed`)}}const K=new rr;function nr(c,e){c.stopPropagation(),e.onFilterClicked?.(e.layerId)}var ar=T("<button><!></button>");function or(c,e){J(e,!0);let t=N(Y(e.hasFiltersApplied?.(e.layerId)??!1));re(()=>{C(t,e.hasFiltersApplied?.(e.layerId)??!1,!0)});const i=Q(()=>r(t)?Qt:Yt);var n=ar();let a;n.__click=[nr,e];var o=k(n);Ie(o,()=>r(i)),S(n),te(g=>{a=Fe(n,1,"filter-btn svelte-k95pvd",null,a,g),Me(n,"aria-pressed",r(t))},[()=>({active:r(t)})]),m(c,n),$()}ke(["click"]);class sr{#e=N(null);get ActiveLayer(){return r(this.#e)}set ActiveLayer(e){C(this.#e,e,!0)}}var lr=T('<li class="area-item svelte-81yb5c"><span class="area-name svelte-81yb5c"> </span> <!></li>'),dr=T('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),cr=T('<p class="no-selection svelte-81yb5c">No areas selected</p>'),ur=T('<li class="data-item svelte-81yb5c"><span class="data-name svelte-81yb5c"> </span> <div class="data-actions svelte-81yb5c"><!> <!></div></li>'),fr=T('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),hr=T('<p class="no-selection svelte-81yb5c">No data selected</p>'),vr=T('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function gr(c,e){J(e,!0);const t=X(e,"fieldFilterMenuStore",7);let i=N(Y([]));re(()=>{if(!O.layerHighlightState.areaInfos.length){C(i,[],!0);return}(async()=>{const p=await O.getAreaNamesById(O.layerHighlightState.areaInfos.map(M=>M.id)),I=[];for(let M=0;M<p.length;M++)I.push({name:p[M]||"Unknown Area",HighlightAreaInfo:O.layerHighlightState.areaInfos[M]});C(i,I,!0)})()});function n(d){const p=r(i).findIndex(I=>I.name===d);p!==-1&&O.removeSelectedArea(r(i)[p]?.HighlightAreaInfo.id)}function a(d){console.log("[export-menu] Removing data selection for layerId:",d),K.DataSelections.delete(d),console.log("[export-menu] Current SelectedData:",yi(K.DataSelections))}function o(d){if(t().ActiveLayer?.id===d){t().ActiveLayer=null;return}const p=e.webMapStore.dataLookup.get(d);if(!p){console.warn(`[export-menu] Layer with ID ${d} not found in web map store.`);return}t().ActiveLayer=p}function g(d){const p=K.DataSelections.get(d);return!(!p||!p.fields||p.fields.size===0||p.fields.size===e.webMapStore.dataLookup.get(d)?.fields?.length)}var f=vr(),h=L(x(f),2),v=k(h),_=k(v,!0);S(v);var u=L(v,4);{var b=d=>{var p=dr(),I=x(p);ge(I,21,()=>r(i),Ce,(D,R)=>{var G=lr(),q=k(G),A=k(q,!0);S(q);var V=L(q,2);he(V,{variant:"ghost",size:"sm",class:"area-remove-btn",onclick:()=>n(r(R).name),children:(F,B)=>{ve();var z=we("×");m(F,z)},$$slots:{default:!0}}),S(G),te(()=>ae(A,r(R).name)),m(D,G)}),S(I);var M=L(I,2),j=k(M);S(M),te(()=>ae(j,`${r(i).length??""} area(s) selected`)),m(d,p)},w=d=>{var p=cr();m(d,p)};P(u,d=>{r(i).length>0?d(b):d(w,!1)})}S(h);var y=L(h,2),H=L(k(y),2);{var l=d=>{var p=fr(),I=x(p);ge(I,21,()=>[...K.DataSelections.values()],Ce,(D,R)=>{var G=ur(),q=k(G),A=k(q,!0);S(q);var V=L(q,2),F=k(V);{var B=U=>{or(U,{get layerId(){return r(R).layerId},onFilterClicked:o,hasFiltersApplied:g})};P(F,U=>{r(R).fields&&U(B)})}var z=L(F,2);he(z,{variant:"ghost",size:"sm",class:"data-remove-btn",onclick:()=>a(r(R).layerId),children:(U,W)=>{ve();var ne=we("×");m(U,ne)},$$slots:{default:!0}}),S(V),S(G),te(()=>ae(A,r(R).name)),m(D,G)}),S(I);var M=L(I,2),j=k(M);S(M),te(()=>ae(j,`${K.DataSelections.size??""} data layer(s) selected`)),m(d,p)},s=d=>{var p=hr();m(d,p)};P(H,d=>{K.DataSelections.size>0?d(l):d(s,!1)})}S(y),te(d=>ae(_,d),[()=>e.areaSelectionTreeviewStore.initialized?e.areaSelectionTreeviewStore.getVisibleNodes()[0]?.name:"Loading..."]),m(c,f),$()}class mr{#e=N(Y([]));get downloads(){return r(this.#e)}set downloads(e){C(this.#e,e,!0)}}const pe=new mr;var yr=T('<p class="text-sm text-muted-foreground">Click "Export" to begin the download.</p> <!>',1);function wr(c,e){J(e,!0);const t=()=>Ut(Jt,"$page",i),[i,n]=Rt();function a(){if(O.layerHighlightState.areaInfos.length<=0){ue.error("Please select at least one area to export.");return}if(K.DataSelections.size<=0){ue.error("Please select at least one data layer to export.");return}console.log("Starting export..."),ue.info("Export started successfully.",{duration:4e3});const f=crypto.randomUUID();pe.downloads.push({id:f,url:`${t().url}/${f}`,status:"pending"}),e.onExportSuccess?.()}var o=yr(),g=L(x(o),2);he(g,{onclick:a,children:(f,h)=>{ve();var v=we("Export");m(f,v)},$$slots:{default:!0}}),m(c,o),$(),n()}var pr=T('<p class="text-sm font-medium"> </p>'),br=T('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function _r(c,e){J(e,!0);let t=N(null),i=N(Y({x:0,y:0})),n=0;const a=h=>{C(i,{x:h.clientX,y:h.clientY},!0)};re(()=>(document.addEventListener("mousemove",a),()=>{document.removeEventListener("mousemove",a)})),re(()=>{const h=O.currentHoveredArea?.id,v=++n;if(!h){C(t,null);return}(async()=>{const _=await O.getAreaNamesById([h]);v===n&&O.currentHoveredArea?.id===h&&C(t,_[0]??null,!0)})()});var o=E(),g=x(o);{var f=h=>{var v=br(),_=k(v);Z(_,()=>mt,(u,b)=>{b(u,{class:"max-w-xs border !py-2 shadow-lg",children:(w,y)=>{var H=E(),l=x(H);Z(l,()=>Je,(s,d)=>{d(s,{class:"!px-3 !py-0",children:(p,I)=>{var M=pr(),j=k(M,!0);S(M),te(()=>ae(j,r(t))),m(p,M)},$$slots:{default:!0}})}),m(w,H)},$$slots:{default:!0}})}),S(v),te(()=>me(v,`left: ${r(i).x+10}px; top: ${r(i).y-10}px;`)),m(h,v)};P(g,h=>{r(t)&&h(f)})}m(c,o),$()}function Sr(c,e){c.target===c.currentTarget&&e()}var Cr=(c,e)=>c.key==="Escape"&&e(),Ir=(c,e,t)=>e(r(t).name),kr=T('<div class="info-icon-container svelte-fp5rsc"><!></div>'),Ar=T('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),xr=T('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),Lr=T("<!> <!>",1),Hr=T("<!> <!>",1),Vr=T('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),Nr=T('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Mr(c,e){J(e,!0);const t=X(e,"fieldFilterMenuStore",7);let i=N(null),n=N(Y(new be)),a=Q(()=>{if(!r(i)||!r(i).fields)return{checked:!1,indeterminate:!1};const w=r(i).fields.length,y=r(n)?.size||0;return y===0?{checked:!1,indeterminate:!1}:y===w?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});re(()=>{console.log("Active Layer to Filter:",t().ActiveLayer);const w=t().ActiveLayer;if(C(i,w,!0),w){const y=K.DataSelections.get(w.id);y?.fields?C(n,new be([...y.fields]),!0):C(n,new be,!0)}});function o(){g(),t().ActiveLayer=null}function g(){if(!r(i))return;let w=K.DataSelections.get(r(i).id);if(w){if((w.fields===void 0||w.fields===null)&&(w.fields=new be),r(n).size===0){K.removeSelection(r(i).id);return}w.fields.clear(),r(n).forEach(y=>{w.fields?.add(y)})}}function f(w){r(i)&&(r(n).has(w)?r(n).delete(w):r(n).add(w))}function h(){if(!r(i)?.fields)return;(r(n)?.size||0)===0?r(i).fields.forEach(y=>{r(n).add(y.name)}):r(n).clear()}function v(){return r(i)?.fields?r(i).fields:[]}var _=E(),u=x(_);{var b=w=>{var y=Nr();y.__click=[Sr,o],y.__keydown=[Cr,o];var H=k(y);Z(H,()=>mt,(l,s)=>{s(l,{class:"command-card",children:(d,p)=>{var I=Vr(),M=x(I);M.__click=o;var j=k(M);wi(j,{size:20}),S(M);var D=L(M,2);Z(D,()=>Je,(R,G)=>{G(R,{class:"card-content",children:(q,A)=>{var V=E(),F=x(V);Z(F,()=>pi,(B,z)=>{z(B,{children:(U,W)=>{var ne=Hr(),se=x(ne);Z(se,()=>bi,(_e,ze)=>{ze(_e,{placeholder:"Search for fields..."})});var Te=L(se,2);Z(Te,()=>_i,(_e,ze)=>{ze(_e,{children:(At,tn)=>{var $e=Lr(),et=x($e);Z(et,()=>Si,(Pe,De)=>{De(Pe,{children:(Ee,Lt)=>{ve();var Ae=we("No results found.");m(Ee,Ae)},$$slots:{default:!0}})});var xt=L(et,2);Z(xt,()=>Ci,(Pe,De)=>{De(Pe,{heading:"Fields",children:(Ee,Lt)=>{var Ae=xr(),Oe=x(Ae),Ht=k(Oe);st(Ht,{get checked(){return r(a).checked},get indeterminate(){return r(a).indeterminate},onCheckedChange:h}),ve(2),S(Oe);var tt=L(Oe,2);Z(tt,()=>$t,(Ge,le)=>{le(Ge,{})});var Vt=L(tt,2);ge(Vt,17,v,Ce,(Ge,le)=>{var it=E(),Nt=x(it);Z(Nt,()=>Ii,(Mt,Ft)=>{Ft(Mt,{class:"field-item",onselect:()=>f(r(le).name),children:(Tt,rn)=>{var Re=Ar(),rt=k(Re);{let Se=Q(()=>r(n)?.has(r(le).name)??!1);st(rt,{class:"field-checkbox",get checked(){return r(Se)},onCheckedChange:()=>f(r(le).name)})}var Ue=L(rt,2);Ue.__click=[Ir,f,le];var nt=k(Ue),We=k(nt),zt=k(We,!0);S(We);var Pt=L(We,2);{var Dt=Se=>{var xe=kr(),Et=k(xe);Ie(Et,()=>ei),S(xe),te(()=>Me(xe,"title",r(le).description)),m(Se,xe)};P(Pt,Se=>{r(le).description&&Se(Dt)})}S(nt),S(Ue),S(Re),te(()=>ae(zt,r(le).alias||r(le).name)),m(Tt,Re)},$$slots:{default:!0}})}),m(Ge,it)}),m(Ee,Ae)},$$slots:{default:!0}})}),m(At,$e)},$$slots:{default:!0}})}),m(U,ne)},$$slots:{default:!0}})}),m(q,V)},$$slots:{default:!0}})}),m(d,I)},$$slots:{default:!0}})}),S(y),m(w,y)};P(u,w=>{r(i)&&w(b)})}m(c,_),$()}ke(["click","keydown"]);var Fr=T('<li class="download-item svelte-vgw5fc"><div class="download-info svelte-vgw5fc"><span class="download-url svelte-vgw5fc"> </span></div> <div class="download-actions svelte-vgw5fc"><div><!></div> <!> <!> <!></div></li>'),Tr=T('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),zr=T('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),Pr=T('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function Dr(c,e){J(e,!0);let t=N(Y(new Set));function i(u){const b=pe.downloads.findIndex(w=>w.url===u);b!==-1&&pe.downloads.splice(b,1)}async function n(u){try{await navigator.clipboard.writeText(u),C(t,new Set(r(t)).add(u),!0),ue.success("URL copied to clipboard"),setTimeout(()=>{const b=new Set(r(t));b.delete(u),C(t,b,!0)},2e3)}catch(b){console.error("Failed to copy URL:",b),ue.error("Failed to copy URL to clipboard")}}function a(u){switch(u){case"completed":return"#059669";case"in-progress":return"#2563eb";case"failed":return"#dc2626";case"pending":default:return"#6b7280"}}function o(u){switch(u){case"completed":return"Completed";case"in-progress":return"In Progress";case"failed":return"Failed";case"pending":default:return"Pending"}}function g(u){switch(u){case"completed":return oi;case"in-progress":return ai;case"failed":return ni;case"pending":default:return ri}}var f=Pr(),h=L(k(f),2);{var v=u=>{var b=Tr(),w=x(b);ge(w,21,()=>pe.downloads,Ce,(l,s)=>{var d=Fr(),p=k(d),I=k(p),M=k(I,!0);S(I),S(p);var j=L(p,2),D=k(j),R=k(D);{let F=Q(()=>a(r(s).status));he(R,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${r(F)??""}`},disabled:!0,children:(B,z)=>{const U=Q(()=>g(r(s).status));var W=E(),ne=x(W);{let se=Q(()=>r(s).status==="in-progress"?"spinning":"");Z(ne,()=>r(U),(Te,_e)=>{_e(Te,{size:14,get class(){return r(se)}})})}m(B,W)},$$slots:{default:!0}})}S(D);var G=L(D,2);he(G,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>n(r(s).url),title:"Copy URL to clipboard",children:(F,B)=>{var z=E(),U=x(z);{var W=se=>{ti(se,{size:14})},ne=se=>{ii(se,{size:14})};P(U,se=>{r(t).has(r(s).url)?se(W):se(ne,!1)})}m(F,z)},$$slots:{default:!0}});var q=L(G,2);{var A=F=>{he(F,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(r(s).url,"_blank"),title:"Open download",children:(B,z)=>{ve();var U=we("📥");m(B,U)},$$slots:{default:!0}})};P(q,F=>{r(s).status==="completed"&&F(A)})}var V=L(q,2);he(V,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>i(r(s).url),title:"Remove from queue",children:(F,B)=>{ve();var z=we("×");m(F,z)},$$slots:{default:!0}}),S(j),S(d),te(F=>{Me(I,"title",r(s).url),ae(M,r(s).id),Me(D,"title",F)},[()=>o(r(s).status)]),m(l,d)}),S(w);var y=L(w,2),H=k(y);S(y),te(()=>ae(H,`${pe.downloads.length??""} download(s) in queue`)),m(u,b)},_=u=>{var b=zr();m(u,b)};P(h,u=>{pe.downloads.length>0?u(v):u(_,!1)})}S(f),m(c,f),$()}var Er=T('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ct(c,e){J(e,!0);const t=X(e,"isFolder",3,!1),i=X(e,"isOpen",3,!1),n=`calc(100% - ${e.depth*1}rem)`;var a=Er();a.__click=function(...y){e.onclick?.apply(this,y)};var o=k(a),g=k(o),f=k(g);{var h=y=>{vt(y,{get isOpen(){return i()}})};P(f,y=>{t()&&y(h)})}var v=L(f,2),_=k(v);Ie(_,()=>e.icon),S(v);var u=L(v,2),b=k(u,!0);S(u),S(g);var w=L(g,2);oe(w,()=>e.children??de),S(o),S(a),te(y=>{Fe(a,1,y),me(a,`width: ${n};`),ae(b,e.name)},[()=>ui(Gi({enhancedHover:!0,includeFont:!0}))]),m(c,a),$()}ke(["click"]);var Or=T('<div data-slot="checkbox-indicator" class="text-current transition-none"><!></div>');function Gr(c,e){J(e,!0);let t=X(e,"ref",15,null),i=X(e,"checked",11,!1),n=X(e,"indeterminate",11,!1),a=ht(e,["$$slots","$$events","$$legacy","ref","checked","indeterminate","class"]),o=N(Y(i())),g=N(Y(n()));re(()=>{C(o,i())}),re(()=>{C(g,n())});var f=E(),h=x(f);{const v=(u,b)=>{let w=()=>b?.().checked,y=()=>b?.().indeterminate;var H=Or(),l=k(H);{var s=p=>{Hi(p,{class:"size-3.5"})},d=p=>{var I=E(),M=x(I);{var j=D=>{li(D,{class:"size-3.5"})};P(M,D=>{y()&&D(j)},!0)}m(p,I)};P(l,p=>{w()?p(s):p(d,!1)})}S(H),m(u,H)};let _=Q(()=>Ai("peer flex size-4 shrink-0 items-center justify-center rounded-[4px] border border-input shadow-xs transition-shadow outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 data-[state=checked]:border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:bg-input/30 dark:aria-invalid:ring-destructive/40 dark:data-[state=checked]:bg-primary",e.class));Z(h,()=>si,(u,b)=>{b(u,Ye({"data-slot":"checkbox",get class(){return r(_)}},()=>a,{get ref(){return t()},set ref(w){t(w)},get checked(){return r(o)},set checked(w){C(o,w,!0)},get indeterminate(){return r(g)},set indeterminate(w){C(g,w,!0)},children:v,$$slots:{default:!0}}))})}m(c,f),$()}var Rr=T("<div><!></div>");function ut(c,e){J(e,!0);let t=Q(()=>e.getDownloadState?.(e.node)??ie.Inactive),i=Q(()=>r(t)===ie.Active),n=Q(()=>r(t)===ie.Indeterminate);function a(f){f.stopPropagation();const h=r(t)===ie.Active?ie.Inactive:ie.Active;e.onDownloadStateChanged?.(e.node,h)}var o=Rr(),g=k(o);Gr(g,{get checked(){return r(i)},get indeterminate(){return r(n)},onclick:a}),S(o),m(c,o),$()}var Ur=T('<div class="flex items-center gap-2"><!> <!></div>'),Wr=T('<div class="flex items-center gap-2"><!> <!></div>');function kt(c,e){J(e,!0);const t=l=>{var s=E(),d=x(s);{var p=I=>{var M=E(),j=x(M);{var D=G=>{ct(G,{get icon(){return r(_)},get name(){return e.node.name},get depth(){return a()},onclick:H,get isFolder(){return g},get isOpen(){return r(h)},children:A=>{var V=Ur(),F=k(V);{var B=W=>{ut(W,{get node(){return e.node},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState}})};P(F,W=>{e.isDownloadable&&W(B)})}var z=L(F,2);{var U=W=>{lt(W,{get checked(){return r(v)},onCheckedChange:w})};P(z,W=>{f&&W(U)})}S(V),m(A,V)},$$slots:{default:!0}})},R=G=>{ct(G,{get icon(){return r(_)},get name(){return e.node.name},get depth(){return a()},onclick:y,get isFolder(){return g},children:A=>{var V=Wr(),F=k(V);{var B=W=>{ut(W,{get node(){return e.node},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState}})};P(F,W=>{e.isDownloadable&&W(B)})}var z=L(F,2);{var U=W=>{lt(W,{get checked(){return r(v)},onCheckedChange:w})};P(z,W=>{f&&W(U)})}S(V),m(A,V)},$$slots:{default:!0}})};P(j,G=>{g?G(D):G(R,!1)})}m(I,M)};P(d,I=>{n()?.getItemConfig(e.node.id)?.isHidden||I(p)})}m(l,s)},i=(l,s=de)=>{var d=E(),p=x(d);{var I=M=>{{let j=Q(()=>n()?.getItemConfig(s().id)?.isDownloadable??!0),D=Q(()=>a()+1);kt(M,{get treeviewConfigStore(){return n()},get node(){return s()},get isDownloadable(){return r(j)},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return r(D)},get useLayerTypeIcon(){return o()}})}};P(p,M=>{g&&r(h)&&!n()?.getItemConfig(s().id)?.isHidden&&M(I)})}m(l,d)},n=X(e,"treeviewConfigStore",3,null),a=X(e,"depth",3,0),o=X(e,"useLayerTypeIcon",3,!1),g=!!(e.node.children&&e.node.children.length),f=!g;let h=N(!1),v=N(!1),_=N(""),u=N(!1),b=N(!1);re(()=>{if(!e.node)return;const l=e.getNodeVisibility?e.getNodeVisibility(e.node.id):!1;C(v,l??!1,!0),e.node instanceof ee&&C(_,St(e.node.layer,o(),g,r(h)),!0)}),re(()=>{if(!(e.node instanceof ee))return;const l=(e.getDownloadState?.(e.node)===ie.Active&&e.node.layer.type==="feature")??!1;l&&!r(u)?(C(u,!0),C(b,!1)):!l&&r(u)&&(C(b,!0),setTimeout(()=>{C(u,!1),C(b,!1)},180))});function w(){!f||!e.onNodeVisibilityChange||(C(v,!r(v)),e.onNodeVisibilityChange(e.node,r(v)))}function y(){e.onNodeClick?.(e.node)}function H(){C(h,!r(h)),e.onNodeClick?.(e.node)}{let l=Q(()=>g?e.node.children:null);wt(c,{get isOpen(){return r(h)},get content(){return t},get childNodes(){return r(l)},get childNode(){return i}})}$()}class jr{configStore;constructor(e){this.configStore=e}}function Br(c){return c.replace(/&deg;/gi,"°").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}class qr extends jr{id="aliasPath";layerToNode(e,t){const i=new ee(e.id,e.title,e,[],t),n=this.configStore.getItemConfig(e.id);if(this.#i(e)&&n?.showFields){const a=e;a.loaded||console.warn(`Layer not loaded: ${e.id}`);const o=new Map;for(const g of a.fields??[]){const f=this.configStore.getItemConfig(this.#t(e.id,g.name));!f||f.isHidden||this.#e(g,i,o)}i.children.sort((g,f)=>g.children.length>0&&f.children.length===0?1:g.children.length===0&&f.children.length>0?-1:0)}return i}#e(e,t,i=new Map){const n=this.#t(t.id,e.name),o=Br(e.alias||"")?.split("|").map(u=>u.trim()).filter(Boolean)??[];if(o.length===0){const u=new ye(n,e.alias||e.name,t.layer,e,[],t);return t.children.push(u),u}const g=o.slice(0,-1),f=o[o.length-1];let h=t;const v=(u,b)=>{u.children??=[],u.children.includes(b)||u.children.push(b)};for(let u=0;u<g.length;u++){const b=g[u],w=o.slice(0,u+1).join("::"),y=`${t.id}::${w}`;let H=i.get(y);H||(H=new yt(y,b,[],h),i.set(y,H),v(h,H)),h=H}const _=new ye(n,f||e.name,t.layer,e,[],h);return v(h,_),_}#t(e,t){return`${e}-${t}`}#i(e){return e.type==="feature"}}function Xr(c,e){J(e,!0);const t=X(e,"webMap",3,null),i=X(e,"fieldFilterMenuStore",7),n=new It;re(()=>{if(!t()||n.initialized)return;(async()=>{await t().when(),await a(t().layers.toArray()),console.log("[data-selection-tree-view] fields to hide:",e.fieldsToHide);const s=new qr(e.treeviewConfigStore);n.initialize(t().layers.toArray(),e.treeviewConfigStore,[s]),console.log("[data-selection-tree-view] Initialized with layers:",n.getNodes())})()});async function a(l){for(const s of l)s.type==="feature"&&!s.loaded&&(await s.load(),console.log("Loaded feature layer:",s.title)),s.type==="group"&&await a(s.layers.toArray())}function o(l,s){if(s===ie.Inactive){l instanceof ee&&l.layer.type!=="group"&&K.removeSelection(l.id),v(l);return}if(l instanceof ee&&l.layer.type!=="group"){let d=K.DataSelections.get(l.id);d||(d={layerId:l.id,name:l.layer.title||"",fields:new be(l.layer.fields?.map(p=>p.name)||[])},K.addSelection(d)),l instanceof ye&&d.fields?.add(l.field.name)}_(l)}function g(l){if(K.DataSelections.get(l.id))return ie.Active;if(l instanceof ye){const I=K.DataSelections.get(l.featureLayer.id);if(I)return I.fields?.has(l.field.name)?ie.Active:ie.Inactive}return f(l)?h(l)?ie.Active:ie.Indeterminate:ie.Inactive}function f(l){if(!(l.children&&l.children.length))return!1;for(const s of l.children)if(g(s)===ie.Active||f(s))return!0;return!1}function h(l){if(!(l.children&&l.children.length))return!1;for(const s of l.children)if(g(s)!==ie.Active)return!1;return!0}function v(l){if(l.children&&l.children.length)for(const s of l.children)K.DataSelections.has(s.id)&&K.removeSelection(s.id),v(s)}function _(l){if(l.children&&l.children.length)for(const s of l.children){if(s instanceof ee){const d=s.layer.id;let p=K.DataSelections.get(d);p||(p={layerId:d,name:s.layer.title||"",fields:new be(s.layer.fields?.map(I=>I.name)||[])},K.addSelection(p)),s instanceof ye&&p.fields?.add(s.field.name)}_(s)}}function u(l){if(i().ActiveLayer?.uid===l){i().ActiveLayer=null;return}const d=n.getNodeById(l);!d||!(d instanceof ee)||(i().ActiveLayer=d.layer)}function b(l){const s=K.DataSelections.get(l);if(!s?.fields)return!1;const d=n.getNodeById(l);if(!d||!(d instanceof ee))return!1;const p=d.layer.fields?.length||0,I=s.fields.size;return I>0&&I!==p}var w=E(),y=x(w);{var H=l=>{var s=E(),d=x(s);Z(d,()=>gt,(p,I)=>{I(p,{children:(M,j)=>{var D=E(),R=x(D);ge(R,17,()=>n.getNodes(),G=>G.id,(G,q)=>{{let A=Q(()=>e.treeviewConfigStore.getItemConfig(r(q).id)?.isDownloadable??!0);kt(G,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return r(q)},get isDownloadable(){return r(A)},onNodeClick:()=>{},onNodeVisibilityChange:(V,F)=>n.setVisibilityState(V.id,F),getNodeVisibility:V=>n.getVisibilityState(V),onDownloadStateChanged:o,getDownloadState:g,onFilterClicked:u,hasFiltersApplied:b,depth:0,useLayerTypeIcon:!0})}}),m(M,D)},$$slots:{default:!0}})}),m(l,s)};P(y,l=>{n.initialized&&l(H)})}m(c,w),$()}class ft{#e=[];#t=new Map;#i=[];#n=new Map;#r=[];#o=new Map;#c=new Set;constructor(e){if(!e)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=e.items??[],this.#t=new Map(this.#e.map(t=>[t.id,t])),this.#i=e.visibilityGroups??[],this.#n=new Map(this.#i.map(t=>[t.id,t])),this.#r=e.inheritanceGroups??[],this.#o=new Map(this.#r.map(t=>[t.id,t])),e.fieldsToHide&&(this.#c=new Set(e.fieldsToHide.map(t=>t.trim().toLowerCase())))}getItemConfig(e){return this.#t.get(e)}getVisibilityGroupConfig(e){return this.#n.get(e)}getInheritanceGroupConfig(e){return this.#o.get(e)}resolveInheritance(e){if(!(e.length===0||!this.#e||this.#e.length===0))for(const t of e)this.#u(t)}#u(e,t){const i=this.#l(e,t);if(this.#g(e)&&i.showFields){const n=e;n.loaded||console.warn(`Layer not loaded: ${e.id}`);for(const a of n.fields??[])this.#f(this.#s(e.id,a.name),a.alias||a.name,i)}if(this.#v(e)){const n=e;for(const a of n.layers.toArray())this.#u(a,i)}}#l(e,t){const i=this.#h(e.id,t);return i.type===Le.None&&(i.type=di(e)),i}#f(e,t,i){const n=this.#h(e,i);return n.type===Le.None&&(n.type=Le.Field),this.#c.has(t.trim().toLowerCase())&&(n.isHidden=!0),n}#h(e,t){let i=this.getItemConfig(e);const n=i!==void 0,a=i?.inheritanceGroupId?this.getInheritanceGroupConfig(i.inheritanceGroupId):this.getInheritanceGroupConfig(t?.inheritanceGroupId??"");return i={id:e,type:Le.None,isDownloadable:this.#a(a,"isDownloadable",i,t,!0),isVisibleOnInit:this.#a(a,"isVisibleOnInit",i,t,!1),isHidden:this.#a(a,"isHidden",i,t,!1),showFields:this.#a(a,"showFields",i,t,!1),visibilityDependencyIds:this.#a(a,"visibilityDependencyIds",i,t,[]),visibilityGroupId:this.#a(a,"visibilityGroupId",i,t,void 0),inheritanceGroupId:this.#a(a,"inheritanceGroupId",i,t,void 0)},n===!1&&this.#m(i),i}#a(e,t,i,n,a){const o=i?.[t];return o!==void 0?o:e?.inheritedProperties.includes(t)&&n?n[t]??a:a}#m(e){if(this.#t.has(e.id))throw new Error(`Item with id ${e.id} already exists.`);this.#e.push(e),this.#t.set(e.id,e)}#s(e,t){return`${e}-${t}`}#v(e){return e.type==="group"}#g(e){return e.type==="feature"}}const Zr=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];function Kr(c,e,t,i,n){if(!e.isOpen)return;C(t,!0),c.preventDefault();const a=c.clientX,o=r(i);function g(h){const v=h.clientX-a,_=Math.max(r(n),o+v);C(i,_,!0)}function f(){C(t,!1),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",f),document.body.style.cursor="",document.body.style.userSelect=""}document.addEventListener("mousemove",g),document.addEventListener("mouseup",f),document.body.style.cursor="ew-resize",document.body.style.userSelect="none"}var Qr=T('<button class="absolute top-0 h-full cursor-ew-resize border-0 bg-transparent p-0 transition-colors hover:bg-primary/50" aria-label="Resize sidebar by dragging" tabindex="-1"></button>'),Yr=T('<!> <aside><div class="flex h-full w-full flex-col"><div class="flex-1 overflow-x-hidden overflow-y-auto p-4"><!></div></div> <!></aside>',1);function Jr(c,e){J(e,!0);const t=X(e,"minWidth",3,"500px");let i,n=N(0),a=N(Y(parseFloat(t()))),o=N(!1);const g=Q(()=>parseFloat(t()));Qe(()=>{if(!i)return;const s=new ResizeObserver(d=>{for(const p of d)C(n,p.contentRect.width,!0)});return s.observe(i),()=>{s.disconnect()}});var f=Yr(),h=x(f);{let s=Q(()=>e.isOpen?"Close sidebar":"Open sidebar");he(h,{get onclick(){return e.onToggle},variant:"default",size:"icon",class:"fixed z-[2] rounded-l-none rounded-r-md shadow-lg hover:scale-105",get style(){return`top: calc(var(--header-height, 64px) + 1rem); left: ${r(n)??""}px; pointer-events: auto; transition: transform 200ms, background-color 200ms;`},get"aria-label"(){return r(s)},get"aria-expanded"(){return e.isOpen},children:(d,p)=>{var I=E(),M=x(I);{var j=R=>{xi(R,{class:"h-6 w-6"})},D=R=>{Li(R,{class:"h-6 w-6"})};P(M,R=>{e.isOpen?R(j):R(D,!1)})}m(d,I)},$$slots:{default:!0}})}var v=L(h,2);let _;var u=k(v),b=k(u);me(b,"padding-right: 16px;");var w=k(b);{var y=s=>{var d=E(),p=x(d);oe(p,()=>e.children),m(s,d)};P(w,s=>{e.children&&s(y)})}S(b),S(u);var H=L(u,2);{var l=s=>{var d=Qr();d.__mousedown=[Kr,e,o,a,g],me(d,"width: 8px; right: -4px;"),m(s,d)};P(H,s=>{e.isOpen&&s(l)})}S(v),Ne(v,s=>i=s,()=>i),te(s=>{_=Fe(v,1,"relative flex h-full flex-col border-r border-sidebar-border bg-card text-card-foreground shadow-lg ease-in-out",null,_,s),me(v,`width: ${e.isOpen?`${r(a)}px`:"0"}; overflow: hidden;`)},[()=>({"transition-all":!r(o),"duration-300":!r(o)})]),m(c,f),$()}ke(["mousedown"]);var $r=T("<!> <!> <!> <!>",1),en=T('<!> <!> <!> <!> <div class="layout-container svelte-1xwk4vv"><!> <div class="map-section svelte-1xwk4vv"><!></div></div>',1);function Cn(c,e){J(e,!0);const t=Y(new Ji),i=Y(new sr),n=Y(new It);let a=N("define-areas"),o=N(void 0),g=N(void 0),f=N(!0);function h(){C(f,!r(f))}Qe(async()=>{const I=await ki();O.setNameFields(I.serviceUprn2Config.selectionLayersNameFields||[]),C(o,new ft(I.serviceUprn2Config.dataSelectionTreeviewConfig),!0),C(g,new ft(I.serviceUprn2Config.areaSelectionTreeviewConfig),!0),await t.initializeAsync({portalUrl:I.serviceUprn2Config.portalUrl,itemId:I.serviceUprn2Config.portalItemId||"",proxy:I.serviceUprn2Config.proxy}),console.log("[page] WebMap loaded")});function v(I){C(a,I,!0)}function _(){C(a,"downloads")}var u=en(),b=x(u);ci(b,{});var w=L(b,2);_r(w,{});var y=L(w,2);Mr(y,{get fieldFilterMenuStore(){return i}});var H=L(y,2);qi(H,{});var l=L(H,2),s=k(l);Jr(s,{get isOpen(){return r(f)},onToggle:h,children:(I,M)=>{Ki(I,{get value(){return r(a)},get triggers(){return Zr},onValueChange:v,children:(j,D)=>{var R=$r(),G=x(R);Ve(G,{value:"define-areas",children:(F,B)=>{var z=E(),U=x(z);{var W=ne=>{Bi(ne,{get webMap(){return t.data},get treeviewStore(){return n},get treeviewConfigStore(){return r(g)}})};P(U,ne=>{t.isLoaded&&ne(W)})}m(F,z)}});var q=L(G,2);Ve(q,{value:"select-data",children:(F,B)=>{var z=E(),U=x(z);{var W=ne=>{Xr(ne,{get webMap(){return t.data},get treeviewConfigStore(){return r(o)},get fieldFilterMenuStore(){return i}})};P(U,ne=>{t.isLoaded&&ne(W)})}m(F,z)}});var A=L(q,2);Ve(A,{value:"export",footer:B=>{wr(B,{onExportSuccess:_})},children:(B,z)=>{gr(B,{get webMapStore(){return t},get areaSelectionTreeviewStore(){return n},get fieldFilterMenuStore(){return i}})}});var V=L(A,2);Ve(V,{value:"downloads",children:(F,B)=>{Dr(F,{})}}),m(j,R)},$$slots:{default:!0}})},$$slots:{default:!0}});var d=L(s,2),p=k(d);zi(p,{get webMap(){return t.data},get areaSelectionTreeviewStore(){return n},panelPosition:"top-left",menuPosition:"top-right"}),S(d),S(l),m(c,u),$()}export{Cn as component};
