const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/DEOvtJTU.js","../chunks/Vj4mvAVU.js","../chunks/BzZgUCJc.js","../chunks/C9_KfL0q.js","../chunks/BENksArx.js","../chunks/PPVm8Dsz.js","../chunks/2lNp6ocP.js","../chunks/COT3swUQ.js","../chunks/C8hxyIL3.js","../chunks/Dk327Tp9.js","../chunks/BnPTyMeN.js","../chunks/BjBhzReJ.js","../chunks/sk86Thi9.js","../chunks/Cp_8tW2x.js","../chunks/Dk1M-oAR.js","../chunks/CG8mvJXA.js","../chunks/bnayRBMH.js","../chunks/DVQSlXGu.js","../chunks/C_6u-7oR.js","../chunks/4IwU-EsI.js","../chunks/ftSj4mLm.js","../chunks/C4EMZbGB.js","../chunks/C0wm8_Yw.js","../chunks/B0eu-fbb.js","../chunks/B9nIsD3S.js","../chunks/CzWAt4g0.js","../chunks/UqbOlSMV.js","../chunks/DoIA9CGd.js","../chunks/M4qysLGv.js","../chunks/C1twrN1D.js","../chunks/S3S9Anr9.js","../chunks/B87vTgcy.js","../chunks/gZG02UZC.js","../chunks/GQvgDxtD.js","../chunks/C_47UTfN.js","../chunks/PxYv24B5.js","../chunks/BoT0RYPL.js","../chunks/BvM93aWS.js","../chunks/CMMpJcky.js","../chunks/CKggWTKP.js","../chunks/DOBtub6T.js","../assets/index.CQED0rIl.css","../chunks/BLGt4B9U.js","../chunks/CGG5FC2i.js","../chunks/BsLIrku2.js","../chunks/Cgb6qxNH.js","../chunks/D0Rgllmn.js","../chunks/CLYjPj8f.js","../chunks/DMyEwpZ7.js","../chunks/CzOxgXA2.js","../chunks/NYdGXCME.js","../chunks/CaVKkSa6.js","../chunks/Bw4cpTDq.js","../chunks/CVUrXWRd.js","../chunks/B1N-tmtC.js","../chunks/BLm5eF_H.js","../chunks/Kj1kSaMb.js","../chunks/D-qJO60r.js","../chunks/QQC62dOK.js","../chunks/Bxxl7NsE.js","../chunks/BiFQGX-g.js","../chunks/DQOO6RKE.js","../chunks/Di21xG__.js","../chunks/Bi6C4OG6.js","../chunks/C7e3Z5XT.js","../chunks/D-YQ4CHs.js","../chunks/DV4ulai0.js","../chunks/ClYjbYd3.js","../chunks/SipYeE6d.js","../chunks/NuXSk11s.js","../chunks/EuPM2Bn5.js","../chunks/27f2e1RQ.js","../chunks/Y76Vt63c.js","../chunks/t_tu4wIv.js","../chunks/CJtY45Hw.js","../chunks/mN8laSOl.js","../chunks/CkVPG3BZ.js","../chunks/DcmXlxzz.js","../chunks/CHSyNxB1.js","../chunks/YLUGga6J.js","../chunks/TZ9RRHSP.js","../chunks/CAvCwia8.js","../chunks/D9LglmIz.js","../chunks/CWaspPwN.js","../chunks/CMhXfT0w.js","../chunks/CVIfIBiS.js","../chunks/BLib0ZeX.js","../chunks/DW1fCRVi.js","../chunks/CyyW12qt.js","../chunks/Dpaauiqf.js","../chunks/BjbIDE_h.js","../chunks/BwohOwse.js","../chunks/BJC3eUGR.js","../chunks/DEsyqKt2.js","../chunks/qyF9FwQ9.js","../chunks/XI-Li77m.js","../chunks/v30FylAf.js","../chunks/D9xQIC-X.js","../chunks/DM8BboCx.js","../chunks/Co60mJWM.js","../chunks/BnJLlvU3.js","../chunks/B7J2Z1sc.js","../chunks/CaYZrGFV.js"])))=>i.map(i=>d[i]);
import{_ as tt}from"../chunks/PPVm8Dsz.js";import"../chunks/DsnmJJEf.js";import{o as it,a as er}from"../chunks/BYioFqV3.js";import{X as br,E as _r,b9 as Cr,ba as Ir,F as xr,y as kr,bb as Ar,bc as Fr,bd as Nr,a2 as tr,av as Dr,H as Lr,n as Z,a0 as H,g as i,b,p as G,f as x,c as W,d as k,r as I,s as A,aA as K,w as $,Y as de,ad as L,$ as We,a_ as Tr}from"../chunks/B2F6Pk8S.js";import{p as Pr,c as P,a as u,f as F,t as Je}from"../chunks/KNKeYQjk.js";import{p as Q,i as M,r as Ne,l as rr,s as Re}from"../chunks/DFlZBb29.js";import{c as q}from"../chunks/BTae8W_h.js";import{b as Oe}from"../chunks/DhXi0Nij.js";import{b as Mr,s as Ae}from"../chunks/C-40Yk8K.js";import{a as wt,d as St,s as Dt,b as Lt,f as Er}from"../chunks/C8UZuUxL.js";import{C as pt}from"../chunks/BWhd0375.js";import{C as yt}from"../chunks/BThHSjUx.js";import{t as nt,k as Or,l as Rr,L as Vr,m as zr,h as Hr,i as Ur,C as Pt,j as jr,I as qr,G as Mt,F as Et,b as Br,O as ir,a as Gr,d as nr,c as ct,n as Wr,o as Jr,M as Yr,V as Ot,e as Qr,f as Xr,g as Kr,S as Zr}from"../chunks/DMnwanN4.js";import{s as ae,e as Ue,i as Ye}from"../chunks/JpH1FSdS.js";import{g as $r,e as bt}from"../chunks/rkAxu3Vb.js";import{c as st,B as De}from"../chunks/DbTWuTOT.js";import{C as ei,D as ti,k as ri,l as ii,g as ni,a as ut,m as ai,S as ze}from"../chunks/DUM1FjaQ.js";import{I as Xe}from"../chunks/DwxO6ufW.js";import{I as oi}from"../chunks/DMhZouf8.js";import{I as ar,s as or,S as si}from"../chunks/Df6mFAvN.js";import{S as li,C as di}from"../chunks/DuOOOIcW.js";import{D as ci,M as ui,L as sr,A as fi,a as vi,S as hi}from"../chunks/OtEcU-oW.js";import"../chunks/DOQDy2VN.js";import{b as gi}from"../chunks/g8ZFDn54.js";import"../chunks/B17Q6ahh.js";import"../chunks/69_IOA4Y.js";import{s as Ct,f as mi,g as wi,h as Si,i as pi}from"../chunks/BtRw6kqc.js";import{b as yi}from"../chunks/DV4ulai0.js";import bi from"../chunks/sk86Thi9.js";import{s as Rt}from"../chunks/BzZgUCJc.js";import{J as _i}from"../chunks/COT3swUQ.js";import{h as at}from"../chunks/CtgqUNVW.js";import{X as Ci,a as Ii,b as xi,C as ki,g as Ai}from"../chunks/CZfuPs9d.js";import{S as He}from"../chunks/wtjXtfpR.js";import{b as Vt}from"../chunks/BjBhzReJ.js";import"../chunks/B_4bysEW.js";import{a as Fi}from"../chunks/C8hxyIL3.js";import{z as zt}from"../chunks/ClYjbYd3.js";import"../chunks/C9_KfL0q.js";import"../chunks/Vj4mvAVU.js";import"../chunks/bnayRBMH.js";import"../chunks/t_tu4wIv.js";import"../chunks/CJtY45Hw.js";import"../chunks/gZG02UZC.js";import"../chunks/C_47UTfN.js";import{d as Ni}from"../chunks/C8hn-AFl.js";import{c as Di}from"../chunks/hfyial1y.js";import{a as Ht,S as Li}from"../chunks/yqqQgnp0.js";import"../chunks/CkVPG3BZ.js";import{j as Ut}from"../chunks/DW1fCRVi.js";import{p as jt}from"../chunks/mN8laSOl.js";import{a as qt,m as Bt}from"../chunks/GQvgDxtD.js";import{u as ft}from"../chunks/CG8mvJXA.js";import{C as Ti}from"../chunks/D6L7pGPv.js";import{C as Pi}from"../chunks/CZFfMZWJ.js";const Mi=()=>performance.now(),je={tick:s=>requestAnimationFrame(s),now:()=>Mi(),tasks:new Set};function lr(){const s=je.now();je.tasks.forEach(e=>{e.c(s)||(je.tasks.delete(e),e.f())}),je.tasks.size!==0&&je.tick(lr)}function Ei(s){let e;return je.tasks.size===0&&je.tick(lr),{promise:new Promise(t=>{je.tasks.add(e={c:s,f:t})}),abort(){je.tasks.delete(e)}}}function vt(s,e){tr(()=>{s.dispatchEvent(new CustomEvent(e))})}function Oi(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const e=s.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Gt(s){const e={},t=s.split(";");for(const r of t){const[n,a]=r.split(":");if(!n||a===void 0)break;const o=Oi(n.trim());e[o]=a.trim()}return e}const Ri=s=>s;function mt(s,e,t,r){var n=(s&Fr)!==0,a=(s&Nr)!==0,o=n&&a,l=(s&Ar)!==0,f=o?"both":n?"in":"out",d,c=e.inert,S=e.style.overflow,g,C;function m(){return tr(()=>d??=t()(e,r?.()??{},{direction:f}))}var h={is_global:l,in(){if(e.inert=c,!n){C?.abort(),C?.reset?.();return}a||g?.abort(),vt(e,"introstart"),g=It(e,m(),C,1,()=>{vt(e,"introend"),g?.abort(),g=d=void 0,e.style.overflow=S})},out(w){if(!a){w?.(),d=void 0;return}e.inert=!0,vt(e,"outrostart"),C=It(e,m(),g,0,()=>{vt(e,"outroend"),w?.()})},stop:()=>{g?.abort(),C?.abort()}},p=br;if((p.transitions??=[]).push(h),n&&Mr){var v=l;if(!v){for(var y=p.parent;y&&(y.f&_r)!==0;)for(;(y=y.parent)&&(y.f&Cr)===0;);v=!y||(y.f&Ir)!==0}v&&xr(()=>{kr(()=>h.in())})}}function It(s,e,t,r,n){var a=r===1;if(Dr(e)){var o,l=!1;return Lr(()=>{if(!l){var p=e({direction:a?"in":"out"});o=It(s,p,t,r,n)}}),{abort:()=>{l=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(t?.deactivate(),!e?.duration)return n(),{abort:Z,deactivate:Z,reset:Z,t:()=>r};const{delay:f=0,css:d,tick:c,easing:S=Ri}=e;var g=[];if(a&&t===void 0&&(c&&c(0,1),d)){var C=Gt(d(0,1));g.push(C,C)}var m=()=>1-r,h=s.animate(g,{duration:f,fill:"forwards"});return h.onfinish=()=>{h.cancel();var p=t?.t()??1-r;t?.abort();var v=r-p,y=e.duration*Math.abs(v),w=[];if(y>0){var _=!1;if(d)for(var D=Math.ceil(y/16.666666666666668),N=0;N<=D;N+=1){var E=p+v*S(N/D),R=Gt(d(E,1-E));w.push(R),_||=R.overflow==="hidden"}_&&(s.style.overflow="hidden"),m=()=>{var U=h.currentTime;return p+v*S(U/y)},c&&Ei(()=>{if(h.playState!=="running")return!1;var U=m();return c(U,1-U),!0})}h=s.animate(w,{duration:y,fill:"forwards"}),h.onfinish=()=>{m=()=>r,c?.(r,1-r),n()}},{abort:()=>{h&&(h.cancel(),h.effect=null,h.onfinish=Z)},deactivate:()=>{n=Z},reset:()=>{r===0&&c?.(1,0)},t:()=>m()}}const Vi=ii({component:"avatar",parts:["root","image","fallback"]}),zi=new ei("Avatar.Root");class Tt{static create(e){return zi.set(new Tt(e))}opts;domContext;attachment;constructor(e){this.opts=e,this.domContext=new ti(this.opts.ref),this.loadImage=this.loadImage.bind(this),this.attachment=ri(this.opts.ref)}loadImage(e,t,r){if(this.opts.loadingStatus.current==="loaded")return;let n;const a=new Image;return a.src=e,t!==void 0&&(a.crossOrigin=t),r&&(a.referrerPolicy=r),this.opts.loadingStatus.current="loading",a.onload=()=>{n=this.domContext.setTimeout(()=>{this.opts.loadingStatus.current="loaded"},this.opts.delayMs.current)},a.onerror=()=>{this.opts.loadingStatus.current="error"},()=>{n&&this.domContext.clearTimeout(n)}}#e=H(()=>({id:this.opts.id.current,[Vi.root]:"","data-status":this.opts.loadingStatus.current,...this.attachment}));get props(){return i(this.#e)}set props(e){b(this.#e,e)}}var Hi=F("<div><!></div>");function Ui(s,e){const t=Pr();G(e,!0);let r=Q(e,"delayMs",3,0),n=Q(e,"loadingStatus",15,"loading"),a=Q(e,"id",19,()=>ni(t)),o=Q(e,"ref",15,null),l=Ne(e,["$$slots","$$events","$$legacy","delayMs","loadingStatus","onLoadingStatusChange","child","children","id","ref"]);const f=Tt.create({delayMs:ut(()=>r()),loadingStatus:ut(()=>n(),m=>{n()!==m&&(n(m),e.onLoadingStatusChange?.(m))}),id:ut(()=>a()),ref:ut(()=>o(),m=>o(m))}),d=H(()=>ai(l,f.props));var c=P(),S=x(c);{var g=m=>{var h=P(),p=x(h);ae(p,()=>e.child,()=>({props:i(d)})),u(m,h)},C=m=>{var h=Hi();wt(h,()=>({...i(d)}));var p=k(h);ae(p,()=>e.children??Z),I(h),u(m,h)};M(S,m=>{e.child?m(g):m(C,!1)})}u(s,c),W()}function ji(s,e){const t=rr(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const r=[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]];ar(s,Re({name:"download"},()=>t,{get iconNode(){return r},children:(n,a)=>{var o=P(),l=x(o);or(l,e,"default",{}),u(n,o)},$$slots:{default:!0}}))}function qi(s,e){const t=rr(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const r=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];ar(s,Re({name:"trash"},()=>t,{get iconNode(){return r},children:(n,a)=>{var o=P(),l=x(o);or(l,e,"default",{}),u(n,o)},$$slots:{default:!0}}))}var Bi=F('<div class="w-full flex-shrink-0"><!></div>');function Gi(s,e){var t=Bi(),r=k(t);{var n=a=>{var o=P(),l=x(o);ae(l,()=>e.children),u(a,o)};M(r,a=>{e.children&&a(n)})}I(t),u(s,t)}var Wi=F('<div class="w-full flex-shrink-0"><!></div>');function Ji(s,e){var t=Wi(),r=k(t);{var n=a=>{var o=P(),l=x(o);ae(l,()=>e.children),u(a,o)};M(r,a=>{e.children&&a(n)})}I(t),u(s,t)}function Yi(s,e){G(e,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=Ne(e,["$$slots","$$events","$$legacy"]);const r=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];Xe(s,Re({name:"arrow-down-to-line"},()=>t,{get iconNode(){return r},children:(n,a)=>{var o=P(),l=x(o);ae(l,()=>e.children??Z),u(n,o)},$$slots:{default:!0}})),W()}function Qi(s,e){G(e,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=Ne(e,["$$slots","$$events","$$legacy"]);const r=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];Xe(s,Re({name:"arrow-down"},()=>t,{get iconNode(){return r},children:(n,a)=>{var o=P(),l=x(o);ae(l,()=>e.children??Z),u(n,o)},$$slots:{default:!0}})),W()}function Xi(s,e){G(e,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=Ne(e,["$$slots","$$events","$$legacy"]);const r=[["path",{d:"m18 15-6-6-6 6"}]];Xe(s,Re({name:"chevron-up"},()=>t,{get iconNode(){return r},children:(n,a)=>{var o=P(),l=x(o);ae(l,()=>e.children??Z),u(n,o)},$$slots:{default:!0}})),W()}function Ki(s,e){G(e,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=Ne(e,["$$slots","$$events","$$legacy"]);const r=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]];Xe(s,Re({name:"maximize"},()=>t,{get iconNode(){return r},children:(n,a)=>{var o=P(),l=x(o);ae(l,()=>e.children??Z),u(n,o)},$$slots:{default:!0}})),W()}function Zi(s,e){G(e,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=Ne(e,["$$slots","$$events","$$legacy"]);const r=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]];Xe(s,Re({name:"minimize"},()=>t,{get iconNode(){return r},children:(n,a)=>{var o=P(),l=x(o);ae(l,()=>e.children??Z),u(n,o)},$$slots:{default:!0}})),W()}function $i(s,e){G(e,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=Ne(e,["$$slots","$$events","$$legacy"]);const r=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];Xe(s,Re({name:"send"},()=>t,{get iconNode(){return r},children:(n,a)=>{var o=P(),l=x(o);ae(l,()=>e.children??Z),u(n,o)},$$slots:{default:!0}})),W()}var en=F('<p class="text-sm font-medium"> </p>'),tn=F('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function rn(s,e){G(e,!0);let t=A(null),r=A(K({x:0,y:0})),n=0;const a=d=>{b(r,{x:d.clientX,y:d.clientY},!0)};$(()=>(document.addEventListener("mousemove",a),()=>{document.removeEventListener("mousemove",a)})),$(()=>{const d=e.areaSelectionInteractionStore.currentHoveredArea?.id,c=++n;if(!d){b(t,null);return}(async()=>{const S=await e.areaSelectionInteractionStore.getAreaNamesById([d]);c===n&&e.areaSelectionInteractionStore.currentHoveredArea?.id===d&&b(t,S[0]??null,!0)})()});var o=P(),l=x(o);{var f=d=>{var c=tn(),S=k(c);q(S,()=>pt,(g,C)=>{C(g,{class:"max-w-xs border !py-2 shadow-lg",children:(m,h)=>{var p=P(),v=x(p);q(v,()=>yt,(y,w)=>{w(y,{class:"!px-3 !py-0",children:(_,D)=>{var N=en(),E=k(N,!0);I(N),de(()=>Ae(E,i(t))),u(_,N)},$$slots:{default:!0}})}),u(m,p)},$$slots:{default:!0}})}),I(c),de(()=>St(c,`left: ${i(r).x+10}px; top: ${i(r).y-10}px;`)),u(d,c)};M(l,d=>{i(t)&&d(f)})}u(s,o),W()}function nn(s,e){G(e,!0);async function t(r,n){const a=await e.areaSelectionInteractionStore.getAreaNamesById([r]);if(!a||a.length===0||!a[0])return;const o=`Area ${n}: ${a[0]}`;nt.success(o)}$(()=>{e.areaSelectionInteractionStore.lastAddedArea&&t(e.areaSelectionInteractionStore.lastAddedArea.id,"added")}),$(()=>{e.areaSelectionInteractionStore.lastRemovedArea&&t(e.areaSelectionInteractionStore.lastRemovedArea.id,"removed")}),W()}var an=F("<div><!></div>");function Wt(s,e){G(e,!0);let t=Q(e,"ref",15,null),r=Ne(e,["$$slots","$$events","$$legacy","ref","variant","children"]);var n=an();wt(n,()=>({...r,class:"group/chat-bubble flex max-w-[80%] flex-row place-items-end gap-2 data-[variant='sent']:place-self-end","data-variant":e.variant}));var a=k(n);ae(a,()=>e.children??Z),I(n),Oe(n,o=>t(o),()=>t()),u(s,n),W()}var on=F('<span class="inline-block size-(--loading-dots-size) rounded-full bg-primary svelte-k2x6sv"></span>'),sn=F('<div class="inline-flex items-center gap-1 svelte-k2x6sv"></div>');function ln(s,e){let t=Q(e,"size",3,4);var r=sn();let n;Ue(r,20,()=>({length:3}),Ye,(a,o)=>{var l=on();u(a,l)}),I(r),de(a=>n=St(r,"",n,a),[()=>({"--loading-dots-size":`${t()??""}px`})]),u(s,r)}var dn=F('<div class="flex size-full place-items-center justify-center"><!></div>'),cn=F("<div><!></div>");function _t(s,e){G(e,!0);let t=Q(e,"ref",15,null),r=Q(e,"typing",3,!1),n=Ne(e,["$$slots","$$events","$$legacy","ref","typing","class","children"]);var a=cn();wt(a,d=>({...n,class:d}),[()=>st("order-2 rounded-lg bg-secondary p-4 text-sm group-data-[variant='received']/chat-bubble:rounded-bl-none group-data-[variant='sent']/chat-bubble:order-1 group-data-[variant='sent']/chat-bubble:rounded-br-none group-data-[variant='sent']/chat-bubble:bg-primary group-data-[variant='sent']/chat-bubble:text-primary-foreground",e.class)]);var o=k(a);{var l=d=>{var c=dn(),S=k(c);ln(S,{}),I(c),u(d,c)},f=d=>{var c=P(),S=x(c);ae(S,()=>e.children??Z),u(d,c)};M(o,d=>{r()?d(l):d(f,!1)})}I(a),Oe(a,d=>t(d),()=>t()),u(s,a),W()}function un(s,e){G(e,!0);let t=Q(e,"ref",15,null),r=Ne(e,["$$slots","$$events","$$legacy","ref","class"]);var n=P(),a=x(n);{let o=H(()=>st("relative flex size-8 shrink-0 overflow-hidden rounded-full",e.class));q(a,()=>Ui,(l,f)=>{f(l,Re({"data-slot":"avatar",get class(){return i(o)}},()=>r,{get ref(){return t()},set ref(d){t(d)}}))})}u(s,n),W()}function Jt(s,e){G(e,!0);let t=Q(e,"ref",15,null),r=Ne(e,["$$slots","$$events","$$legacy","ref","class"]);{let n=H(()=>st("order-1 group-data-[variant='sent']/chat-bubble:order-2",e.class));un(s,Re({get class(){return i(n)}},()=>r,{get ref(){return t()},set ref(a){t(a)}}))}W()}function dr(s){const e=s-1;return e*e*e+1}function Yt(s,{delay:e=0,duration:t=400,easing:r=dr,axis:n="y"}={}){const a=getComputedStyle(s),o=+a.opacity,l=n==="y"?"height":"width",f=parseFloat(a[l]),d=n==="y"?["top","bottom"]:["left","right"],c=d.map(v=>`${v[0].toUpperCase()}${v.slice(1)}`),S=parseFloat(a[`padding${c[0]}`]),g=parseFloat(a[`padding${c[1]}`]),C=parseFloat(a[`margin${c[0]}`]),m=parseFloat(a[`margin${c[1]}`]),h=parseFloat(a[`border${c[0]}Width`]),p=parseFloat(a[`border${c[1]}Width`]);return{delay:e,duration:t,easing:r,css:v=>`overflow: hidden;opacity: ${Math.min(v*20,1)*o};${l}: ${v*f}px;padding-${d[0]}: ${v*S}px;padding-${d[1]}: ${v*g}px;margin-${d[0]}: ${v*C}px;margin-${d[1]}: ${v*m}px;border-${d[0]}-width: ${v*h}px;border-${d[1]}-width: ${v*p}px;min-${l}: 0`}}function Qt(s,{delay:e=0,duration:t=400,easing:r=dr,start:n=0,opacity:a=0}={}){const o=getComputedStyle(s),l=+o.opacity,f=o.transform==="none"?"":o.transform,d=1-n,c=l*(1-a);return{delay:e,duration:t,easing:r,css:(S,g)=>`
			transform: ${f} scale(${1-d*g});
			opacity: ${l-c*g}
		`}}class fn{#e=A();#t=A(0);#r=A(!1);lastScrollHeight=0;set ref(e){if(b(this.#e,e,!0),!i(this.#e))return;this.lastScrollHeight=i(this.#e).scrollHeight,i(this.#e).scrollTo(0,i(this.#t)?i(this.#t):i(this.#e).scrollHeight),i(this.#e).addEventListener("scroll",()=>{i(this.#e)&&(b(this.#t,i(this.#e).scrollTop,!0),this.disableAutoScroll())}),window.addEventListener("resize",()=>{this.scrollToBottom(!0)}),new MutationObserver(()=>{i(this.#e)&&(i(this.#e).scrollHeight!==this.lastScrollHeight&&this.scrollToBottom(!0),this.lastScrollHeight=i(this.#e).scrollHeight)}).observe(i(this.#e),{childList:!0,subtree:!0})}get ref(){return i(this.#e)}get scrollY(){return i(this.#t)}get isAtBottom(){return i(this.#e)?i(this.#t)+i(this.#e).offsetHeight>=i(this.#e).scrollHeight:!0}disableAutoScroll(){this.isAtBottom?b(this.#r,!1):b(this.#r,!0)}scrollToBottom(e=!1){i(this.#e)&&(e&&i(this.#r)||i(this.#e).scrollTo(0,i(this.#e).scrollHeight))}}var vn=F("<div><!></div>"),hn=F('<div class="relative"><div><!></div> <!></div>');function gn(s,e){G(e,!0);let t=Q(e,"ref",15,null),r=Ne(e,["$$slots","$$events","$$legacy","ref","children","class"]),n=A(!1);const a=new fn;it(()=>{b(n,!0)});var o=hn(),l=k(o);wt(l,S=>({...r,class:S}),[()=>st("no-scrollbar flex h-full w-full flex-col gap-4 overflow-y-auto p-4",e.class,{"scroll-smooth":i(n)})]);var f=k(l);ae(f,()=>e.children??Z),I(l),Oe(l,S=>t(S),()=>t()),Oe(l,S=>a.ref=S,()=>a?.ref);var d=L(l,2);{var c=S=>{var g=vn(),C=k(g);De(C,{onclick:()=>a.scrollToBottom(),variant:"outline",size:"icon",class:"absolute bottom-2 left-1/2 inline-flex -translate-x-1/2 transform rounded-full shadow-md",children:(m,h)=>{Qi(m,{})},$$slots:{default:!0}}),I(g),mt(1,g,()=>Qt,()=>({start:.85,duration:100,delay:250})),mt(2,g,()=>Qt,()=>({start:.85,duration:100})),u(S,g)};M(d,S=>{a.isAtBottom||S(c)})}I(o),u(s,o),W()}var mn=F(`<p class="break-words whitespace-pre-wrap"> </p> <div class="w-full text-xs group-data-[variant='sent']/chat-bubble:text-end"> </div>`,1),wn=F("<!> <!>",1),Sn=F('<p class="break-words whitespace-pre-wrap"> </p>'),pn=F("<!> <!>",1),yn=F("<!> <!>",1),bn=F('<div class="chat-container h-full w-full border border-border svelte-1osgd7m"><div class="message-wrapper svelte-1osgd7m"><!></div> <div class="input-wrapper svelte-1osgd7m"><form class="flex shrink-0 items-center gap-2 border-t border-border bg-background p-2"><!> <!></form></div></div>');function _n(s,e){G(e,!0);const t=1,r=2,n="Sorry, I encountered an error processing your request.",a="How can I help?";let o=A(""),l=A(!1),f=A(""),d=A(null),c=A(null),S=A(null);const g=K([{senderId:t,message:a,sentAt:C(new Date)}]);$(()=>{if(i(c)&&i(S)){const T=i(c),V=i(S),B=()=>{const Y=T.offsetHeight;V.style.paddingBottom=`${Y}px`};B();const J=new ResizeObserver(B);return J.observe(T),()=>{J.disconnect()}}}),$(()=>{g.length,i(f),i(d)&&setTimeout(()=>{const T=i(d)?.querySelector('[data-slot="scroll-area-viewport"]');T&&(T.scrollTop=T.scrollHeight)},0)});function C(T){const V=T.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),B=T.getHours()>=12?"PM":"AM";return`${V} ${B}`}function m(T,V){return{message:T,senderId:V,sentAt:C(new Date)}}function h(T,V){g.push(m(T,V))}function p(){b(l,!1),b(f,"")}function v(T){b(f,i(f)+T)}async function y(T){if(T.preventDefault(),!i(o).trim()||i(l))return;const V=i(o).trim();b(o,""),h(V,r),b(l,!0),b(f,"");try{await e.aiUprnChatbotService.chatStream(V,v)&&i(f)?h(i(f),t):h(n,t)}catch(B){console.error("Chat error:",B),h(n,t)}finally{p()}}var w=bn(),_=k(w),D=k(_);si(D,{class:"h-full w-full",get ref(){return i(d)},set ref(T){b(d,T,!0)},children:(T,V)=>{var B=P(),J=x(B);q(J,()=>gn,(Y,oe)=>{oe(Y,{children:(ce,j)=>{var ne=yn(),z=x(ne);Ue(z,16,()=>g,ue=>ue,(ue,O)=>{var te=P(),ve=x(te);{let X=H(()=>O.senderId===r?"sent":"received");q(ve,()=>Wt,(he,Le)=>{Le(he,{get variant(){return i(X)},children:(be,Te)=>{var me=wn(),_e=x(me);q(_e,()=>Jt,(xe,we)=>{we(xe,{})});var se=L(_e,2);q(se,()=>_t,(xe,we)=>{we(xe,{class:"flex flex-col gap-1",children:(Se,Ce)=>{var le=mn(),fe=x(le),pe=k(fe,!0);I(fe);var Fe=L(fe,2),Pe=k(Fe,!0);I(Fe),de(()=>{Ae(pe,O.message),Ae(Pe,O.sentAt)}),u(Se,le)},$$slots:{default:!0}})}),u(be,me)},$$slots:{default:!0}})})}u(ue,te)});var ee=L(z,2);{var ge=ue=>{var O=P(),te=x(O);q(te,()=>Wt,(ve,X)=>{X(ve,{variant:"received",children:(he,Le)=>{var be=pn(),Te=x(be);q(Te,()=>Jt,(_e,se)=>{se(_e,{})});var me=L(Te,2);q(me,()=>_t,(_e,se)=>{se(_e,{class:"flex flex-col gap-1",children:(xe,we)=>{var Se=P(),Ce=x(Se);{var le=pe=>{var Fe=Sn(),Pe=k(Fe,!0);I(Fe),de(()=>Ae(Pe,i(f))),u(pe,Fe)},fe=pe=>{var Fe=P(),Pe=x(Fe);q(Pe,()=>_t,(Ke,Me)=>{Me(Ke,{typing:!0})}),u(pe,Fe)};M(Ce,pe=>{i(f)?pe(le):pe(fe,!1)})}u(xe,Se)},$$slots:{default:!0}})}),u(he,be)},$$slots:{default:!0}})}),u(ue,O)};M(ee,ue=>{i(l)&&ue(ge)})}u(ce,ne)},$$slots:{default:!0}})}),u(T,B)},$$slots:{default:!0}}),I(_),Oe(_,T=>b(S,T),()=>i(S));var N=L(_,2),E=k(N),R=k(E);oi(R,{class:"rounded-full",placeholder:"Type a message...",get disabled(){return i(l)},get value(){return i(o)},set value(T){b(o,T,!0)}});var U=L(R,2);{let T=H(()=>i(o).trim()===""||i(l));De(U,{type:"submit",variant:"default",size:"icon",class:"shrink-0 rounded-full",get disabled(){return i(T)},children:(V,B)=>{$i(V,{})},$$slots:{default:!0}})}I(E),Oe(E,T=>b(c,T),()=>i(c)),I(N),I(w),$r("submit",E,y),u(s,w),W()}const qe=Object.freeze({Pending:"pending",InProgress:"in-progress",Completed:"completed",Failed:"failed"}),ht=Object.freeze({Submitted:"SUBMITTED",Queued:"QUEUED",Processing:"IN_PROGRESS",Completed:"COMPLETED",Error:"ERROR"}),Cn=Object.freeze({Success:"success",Error:"error"}),ot="current";class In extends ci{uprnSelections;areaSelections;dataSelections;userDownloads;constructor(){super("app-db2"),this.version(2).stores({uprnSelections:"&id",areaSelections:"++id, layerId, *areaIds",dataSelections:"++id, layerId, *fields",userDownloads:"++id, &localId, createdAt"}),this.on("populate",async e=>{if(console.log("[db] Populating database with initial data"),await e.table("uprnSelections").get(ot)){console.log("[db] Initial UPRN selection already exists");return}await e.table("uprnSelections").add({id:"current",areas:null,data:[]}),console.log("[db] Initial UPRN selection created")})}}const Ge=new In,cr=async()=>await Ge.uprnSelections.get(ot),et=async s=>{let e=await cr();e||(e={id:ot,areas:null,data:[]},await Ge.uprnSelections.add(e)),console.log("[db] Updating UPRN selection with patch:",s,"current:",e),await Ge.uprnSelections.update(ot,s)},xn=async()=>{await Ge.uprnSelections.put({id:ot,areas:null,data:[]})},kn=async(s,e,t)=>await Ge.userDownloads.add({localId:s,areaSelection:e,dataSelections:t,status:qe.Pending,createdAt:Date.now()}),An=async(s,e,t,r)=>{const n={};e!==void 0&&(n.externalId=e),t!==void 0&&(n.areaSelection=t),r!==void 0&&(n.dataSelections=r),Object.keys(n).length!==0&&await Ge.userDownloads.where("localId").equals(s).modify(n)},Fn=async()=>await Ge.userDownloads.orderBy("createdAt").reverse().toArray(),Nn=async s=>await Ge.userDownloads.where("localId").equals(s).delete();class Dn{#e=A(K(new ze));constructor(){this.#t()}addDownload(e){console.log("[downloads-store] Adding download:",e),i(this.#e).set(e.localId,e),kn(e.localId,e.areaSelection,e.dataSelections)}updateDownloadStatus(e){console.log("[downloads-store] Updating download status:",e),i(this.#e).set(e.localId,{...e}),An(e.localId,e.externalId,e.areaSelection,e.dataSelections)}removeDownload(e){i(this.#e).delete(e),Nn(e)}getDownloads(){return Array.from(i(this.#e).values())}async#t(){const e=await Fn();!e||e.length===0||(console.log("Loaded downloads from DB:",e),e.forEach(t=>{i(this.#e).set(t.localId,{localId:t.localId,status:qe.Pending,areaSelection:t.areaSelection,dataSelections:t.dataSelections})}))}}const rt=new Dn;var Ln=F('<div class="data-item svelte-v4uih6"><span class="data-name svelte-v4uih6"> </span> <div class="data-actions svelte-v4uih6"><!></div></div>');function xt(s,e){const t=Q(e,"title",3,"");pt(s,{class:"data-item-card",children:(r,n)=>{var a=Ln(),o=k(a),l=k(o,!0);I(o);var f=L(o,2),d=k(f);ae(d,()=>e.children??Z),I(f),I(a),de(()=>{Dt(o,"title",t()),Ae(l,t())}),u(r,a)},$$slots:{default:!0}})}var Tn=F("<!> <!> <!> <!>",1),Pn=F('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),Mn=F('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),En=F('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function On(s,e){G(e,!0);let t=A(K(new Set));const r=H(()=>rt.getDownloads()),n={completed:{color:"#059669",text:"Completed",icon:zr},"in-progress":{color:"#2563eb",text:"In Progress",icon:Vr},failed:{color:"#dc2626",text:"Failed",icon:di},pending:{color:"#6b7280",text:"Pending",icon:li}};it(()=>{const p=setInterval(()=>{a()},5e3);return()=>{clearInterval(p)}}),$(()=>{if(!i(r)||i(r).length<=0||!e.uprnDownloadService)return;(async()=>{for(const v of i(r)){if(v.externalId||v.status!==qe.Pending)continue;const y={exports:{areaSelectionLayer:{remoteId:v.areaSelection.layerId,areas:v.areaSelection.areaFieldInfos.map(_=>_.code)},dataSelectionLayers:v.dataSelections.map(_=>({remoteId:_.layerId,fields:_.fields.filter(D=>!e.fieldsToHide||!e.fieldsToHide.has(D))}))}};console.log("[downloads-menu] Submitting download request:",y);const w=await e.uprnDownloadService.requestJob(y);if(!w||w.type===Cn.Error){console.error("[downloads-menu] Failed to submit download request.",w);continue}v.externalId=w.guid,v.status=qe.InProgress,rt.updateDownloadStatus(v)}})()});async function a(){if(i(r).length<=0||!e.uprnDownloadService)return;const p={jobs:i(r).filter(y=>y.externalId).map(y=>y.externalId)},v=await e.uprnDownloadService.requestJobStatuses(p);if(!v){console.error("[downloads-menu] Failed to get job statuses.",v);return}for(const y of v.jobs){const w=i(r).find(_=>_.externalId===y.guid);if(!w){console.warn("[downloads-menu] Received job status for unknown download:",y.guid);continue}switch(y.status.type){case ht.Submitted:case ht.Processing:w.status=qe.InProgress;break;case ht.Completed:w.status=qe.Completed;break;case ht.Error:w.status=qe.Failed;break;default:console.warn("[downloads-menu] Unknown job status type:",y.status.type);break}rt.updateDownloadStatus(w)}}function o(p){rt.removeDownload(p)}async function l(p){try{await navigator.clipboard.writeText(p),b(t,new Set(i(t)).add(p),!0),nt.success("URL copied to clipboard"),setTimeout(()=>{const v=new Set(i(t));v.delete(p),b(t,v,!0)},2e3)}catch(v){console.error("Failed to copy URL:",v),nt.error("Failed to copy URL to clipboard")}}function f(p){return n[p]?.color??n.pending.color}function d(p){return n[p]?.text??n.pending.text}function c(p){return n[p]?.icon??n.pending.icon}function S(p){return e.uprnDownloadService.getDownloadUrl(p)}var g=En(),C=L(k(g),2);{var m=p=>{var v=Pn(),y=x(v);Ue(y,21,()=>i(r),Ye,(D,N)=>{{let E=H(()=>i(N).externalId?i(N).externalId:"Pending...");xt(D,{get title(){return i(E)},children:(R,U)=>{var T=Tn(),V=x(T);{let j=H(()=>f(i(N).status)),ne=H(()=>d(i(N).status));De(V,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${i(j)??""}`},get title(){return i(ne)},disabled:!0,children:(z,ee)=>{const ge=H(()=>c(i(N).status));var ue=P(),O=x(ue);{let te=H(()=>i(N).status==="in-progress"?"spinning":"");q(O,()=>i(ge),(ve,X)=>{X(ve,{size:14,get class(){return i(te)}})})}u(z,ue)},$$slots:{default:!0}})}var B=L(V,2);{var J=j=>{De(j,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>l(S(i(N).externalId)),title:"Copy URL to clipboard",children:(ne,z)=>{var ee=P(),ge=x(ee);{var ue=te=>{Or(te,{size:14})},O=te=>{Rr(te,{size:14})};M(ge,te=>{i(t).has(S(i(N).externalId))?te(ue):te(O,!1)})}u(ne,ee)},$$slots:{default:!0}})};M(B,j=>{i(N).externalId&&j(J)})}var Y=L(B,2);{var oe=j=>{De(j,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(S(i(N).externalId),"_blank"),title:"Open download",children:(ne,z)=>{ji(ne,{})},$$slots:{default:!0}})};M(Y,j=>{i(N).externalId&&i(N).status==="completed"&&j(oe)})}var ce=L(Y,2);De(ce,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>o(i(N).localId),title:"Remove from queue",children:(j,ne)=>{We();var z=Je("Ã—");u(j,z)},$$slots:{default:!0}}),u(R,T)},$$slots:{default:!0}})}}),I(y);var w=L(y,2),_=k(w);I(w),de(()=>Ae(_,`${i(r).length??""} download(s) in queue`)),u(p,v)},h=p=>{var v=Mn();u(p,v)};M(C,p=>{i(r).length>0?p(m):p(h,!1)})}I(g),u(s,g),W()}function Rn(s,e){G(e,!0);{let t=H(()=>st("size-7 border-1 border-destructive",e.class));De(s,{onclick:()=>e.clear(),variant:"ghost",get class(){return i(t)},title:"Clear all selections",children:(r,n)=>{qi(r,{class:"text-destructive"})},$$slots:{default:!0}})}W()}class Vn{#e=A(K(new ze));get dataSelections(){return i(this.#e)}set dataSelections(e){b(this.#e,e,!0)}addSelection(e){this.dataSelections.set(e.layerId,e)}updateSelection(e,t){const r=this.dataSelections.get(e);if(!r){console.warn(`[data-selection-store] no existing selection for layerId ${e}`);return}r.selectedFieldIds=new He(t),this.dataSelections.set(e,{...r})}addOrUpdateSelection(e,t){const r=this.dataSelections.get(e);if(r)r.selectedFieldIds=new He(t),this.dataSelections.set(e,{...r});else{const n={layerId:e,selectedFieldIds:new He(t)};this.dataSelections.set(e,n)}}removeSelection(e){this.dataSelections.delete(e)}getSelection(e){return this.dataSelections.get(e)}getAllSelections(){return Array.from(this.dataSelections.values())}clearSelections(){this.dataSelections.clear(),console.log("[data-selection-store] selections cleared.")}cleanup(){this.dataSelections.clear()}}var zn=F('<div class="export-footer svelte-10dgoyk"><div class="export-footer__left svelte-10dgoyk"><p class="text-sm text-muted-foreground svelte-10dgoyk">Click "Export" to begin the download.</p></div> <div class="export-footer__right svelte-10dgoyk"><!> <!></div></div>');function Hn(s,e){G(e,!0);function t(){if(e.areaSelectionInteractionStore.selectionViewState?.areaHandles.size<=0){nt.error("Please select at least one area to export.");return}if(e.dataSelectionStore.getAllSelections().length<=0){nt.error("Please select at least one data layer to export.");return}console.log("Starting export..."),(async()=>{const f=await e.areaSelectionInteractionStore.getAreaCodesById(e.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),d=e.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().map(([C,m],h)=>({id:C,code:f[h]})).toArray(),c={layerId:e.areaSelectionInteractionStore.selectionViewState.layerView?.layer.id||"",areaFieldInfos:d},S=e.dataSelectionStore.getAllSelections().map(C=>({layerId:C.layerId,fields:Array.from(C.selectedFieldIds)})),g=crypto.randomUUID();rt.addDownload({localId:g,status:qe.Pending,areaSelection:c,dataSelections:S}),e.onExportSuccess?.()})()}var r=zn(),n=L(k(r),2),a=k(n);Rn(a,{class:"mr-4",get clear(){return e.clearSelections}});var o=L(a,2);De(o,{onclick:t,title:"Export",children:(l,f)=>{We();var d=Je("Export");u(l,d)},$$slots:{default:!0}}),I(n),I(r),u(s,r),W()}class Un{#e=A(null);get ActiveLayer(){return i(this.#e)}set ActiveLayer(e){b(this.#e,e,!0)}}class jn{#e=A(!1);get isLoaded(){return i(this.#e)}set isLoaded(e){b(this.#e,e,!0)}#t=A(null);get data(){return i(this.#t)}set data(e){b(this.#t,e,!0)}#r=H(()=>{const e=new ze;function t(r){e.set(r.id,r),r.type==="group"&&r.layers.forEach(a=>{t(a)})}return this.data&&this.data.layers.forEach(r=>{t(r)}),e});get dataLookup(){return i(this.#r)}set dataLookup(e){b(this.#r,e)}#n=A(!1);get loading(){return i(this.#n)}set loading(e){b(this.#n,e,!0)}#i=A(null);get error(){return i(this.#i)}set error(e){b(this.#i,e,!0)}async initializeAsync(e){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:t,itemId:r,proxy:n}=e;await this.configurePortalAsync(t,n),await this.loadwebmapAsync(r)}catch(t){console.error("Error initializing webmap:",t),this.error=t.message}finally{this.loading=!1}}}async configurePortalAsync(e,t){if(!e||(Rt.portalUrl=e,console.log(Rt),!t))return;const{addProxyRule:r}=_i;console.log("Adding proxy rule for portal traffic"),r({urlPrefix:t?.urlPrefix,proxyUrl:t?.proxyUrl})}async loadwebmapAsync(e){if(this.data)return;const t=new bi({id:e}),r=new yi({portalItem:t});this.data=r,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}function qn(s,e){s.stopPropagation(),e.onFilterClicked?.(e.layerId)}var Bn=F('<button title="Filter"><!></button>');function Gn(s,e){G(e,!0);let t=A(K(e.hasFiltersApplied?.(e.layerId)??!1));$(()=>{b(t,e.hasFiltersApplied?.(e.layerId)??!1,!0)});const r=H(()=>i(t)?Hr:Ur);var n=Bn();let a;n.__click=[qn,e];var o=k(n);at(o,()=>i(r)),I(n),de(l=>{a=Lt(n,1,"filter-btn svelte-k95pvd",null,a,l),Dt(n,"aria-pressed",i(t))},[()=>({active:i(t)})]),u(s,n),W()}bt(["click"]);var Wn=F('<ul class="selected-list"></ul> <p class="count svelte-81yb5c"> </p>',1),Jn=F('<p class="no-selection svelte-81yb5c">No areas selected</p>'),Yn=F("<!> <!>",1),Qn=F('<ul></ul> <p class="count svelte-81yb5c"> </p>',1),Xn=F('<p class="no-selection svelte-81yb5c">No data selected</p>'),Kn=F('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function Zn(s,e){G(e,!0);const t=Q(e,"fieldFilterMenuStore",7);let r=A(K([]));$(()=>{if(!e.areaSelectionInteractionStore){b(r,[],!0);return}if(!e.areaSelectionInteractionStore.selectionViewState?.areaHandles.size){b(r,[],!0);return}(async()=>{const _=await e.areaSelectionInteractionStore.getAreaNamesById(e.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),D=e.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().toArray().map(([E,R])=>({id:E,handle:R})),N=[];for(let E=0;E<_.length;E++)N.push({name:_[E]||"Unknown Area",HighlightAreaInfo:D[E]});b(r,N,!0)})()});function n(w){const _=i(r).findIndex(D=>D.name===w);_!==-1&&e.areaSelectionInteractionStore.removeSelectedArea(i(r)[_]?.HighlightAreaInfo.id)}function a(w){console.log("[export-menu] Removing data selection for layerId:",w),e.dataSelectionStore.removeSelection(w),console.log("[export-menu] Current SelectedData:",Ct(e.dataSelectionStore.getAllSelections()))}function o(w){if(t().ActiveLayer?.id===w){t().ActiveLayer=null;return}const _=e.webMapStore.dataLookup.get(w);if(!_){console.warn(`[export-menu] Layer with ID ${w} not found in web map store.`);return}t().ActiveLayer=_}function l(w){const _=e.dataSelectionStore.getSelection(w);return!(!_||!_.selectedFieldIds||_.selectedFieldIds.size===0||_.selectedFieldIds.size===e.webMapStore.dataLookup.get(w)?.fields?.length)}var f=Kn(),d=L(x(f),2),c=k(d),S=k(c,!0);I(c);var g=L(c,4);{var C=w=>{var _=Wn(),D=x(_);Ue(D,21,()=>i(r),Ye,(R,U)=>{xt(R,{get title(){return i(U).name},children:(T,V)=>{De(T,{variant:"ghost",size:"sm",class:"area-remove-btn",title:"Remove area",onclick:()=>n(i(U).name),children:(B,J)=>{We();var Y=Je("Ã—");u(B,Y)},$$slots:{default:!0}})},$$slots:{default:!0}})}),I(D);var N=L(D,2),E=k(N);I(N),de(()=>Ae(E,`${i(r).length??""} area(s) selected`)),u(w,_)},m=w=>{var _=Jn();u(w,_)};M(g,w=>{i(r).length>0?w(C):w(m,!1)})}I(d);var h=L(d,2),p=L(k(h),2);{var v=w=>{var _=Qn(),D=x(_);Ue(D,21,()=>e.dataSelectionStore.getAllSelections(),Ye,(R,U)=>{{let T=H(()=>e.webMapStore.dataLookup.get(i(U).layerId)?.title??"");xt(R,{get title(){return i(T)},children:(V,B)=>{var J=Yn(),Y=x(J);{var oe=j=>{Gn(j,{get layerId(){return i(U).layerId},onFilterClicked:o,hasFiltersApplied:l})};M(Y,j=>{e.dataSelectionTreeviewConfig?.getItemConfig(i(U).layerId)?.showFields&&j(oe)})}var ce=L(Y,2);De(ce,{variant:"ghost",size:"sm",class:"data-remove-btn",title:"Remove data selection",onclick:()=>a(i(U).layerId),children:(j,ne)=>{We();var z=Je("Ã—");u(j,z)},$$slots:{default:!0}}),u(V,J)},$$slots:{default:!0}})}}),I(D);var N=L(D,2),E=k(N);I(N),de(R=>Ae(E,`${R??""} data layer(s) selected`),[()=>e.dataSelectionStore.getAllSelections().length]),u(w,_)},y=w=>{var _=Xn();u(w,_)};M(p,w=>{e.dataSelectionStore.getAllSelections().length>0?w(v):w(y,!1)})}I(h),de(()=>Ae(S,e.areaSelectionInteractionStore.selectionViewState?.layerView?.layer?e.areaSelectionInteractionStore.selectionViewState?.layerView?.layer.title:"No Area Layer Selected")),u(s,f),W()}function $n(s,e){s.target===s.currentTarget&&e()}var ea=(s,e)=>s.key==="Escape"&&e(),ta=(s,e,t)=>e(i(t).name),ra=F('<div class="info-icon-container svelte-fp5rsc"><!></div>'),ia=F('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),na=F('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),aa=F("<!> <!>",1),oa=F("<!> <!>",1),sa=F('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),la=F('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function da(s,e){G(e,!0);const t=Q(e,"fieldFilterMenuStore",7);let r=A(null),n=A(K(new He)),a=H(()=>{if(!i(r)||!i(r).fields)return{checked:!1,indeterminate:!1};const m=i(r).fields.length,h=i(n)?.size||0;return h===0?{checked:!1,indeterminate:!1}:h===m?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});$(()=>{const m=t().ActiveLayer;if(!m){b(r,null),b(n,new He,!0);return}b(r,m,!0);const h=e.dataSelectionStore.getSelection(m.id);h?.selectedFieldIds?b(n,new He([...h.selectedFieldIds]),!0):b(n,new He,!0)});function o(){l(),t().ActiveLayer=null}function l(){if(!i(r))return;let m=e.dataSelectionStore.getSelection(i(r).id);if(m){if((m.selectedFieldIds===void 0||m.selectedFieldIds===null)&&(m.selectedFieldIds=new He),i(n).size===0){e.dataSelectionStore.removeSelection(i(r).id);return}m.selectedFieldIds.clear(),i(n).forEach(h=>{m.selectedFieldIds?.add(h)})}}function f(m){i(r)&&(i(n).has(m)?i(n).delete(m):i(n).add(m))}function d(){if(!i(r)?.fields)return;(i(n)?.size||0)===0?i(r).fields.forEach(h=>{i(n).add(h.name)}):i(n).clear()}function c(){if(!i(r)?.fields)return[];const m=i(r).fields.filter(h=>!e.fieldsToHide.has(h.name.toLowerCase()));return console.log("Filtered fields to show:",m,e.fieldsToHide,i(r).fields),m}var S=P(),g=x(S);{var C=m=>{var h=la();h.__click=[$n,o],h.__keydown=[ea,o];var p=k(h);q(p,()=>pt,(v,y)=>{y(v,{class:"command-card",children:(w,_)=>{var D=sa(),N=x(D);N.__click=o;var E=k(N);Ci(E,{size:20}),I(N);var R=L(N,2);q(R,()=>yt,(U,T)=>{T(U,{class:"card-content",children:(V,B)=>{var J=P(),Y=x(J);q(Y,()=>mi,(oe,ce)=>{ce(oe,{children:(j,ne)=>{var z=oa(),ee=x(z);q(ee,()=>Ii,(ue,O)=>{O(ue,{placeholder:"Search for fields..."})});var ge=L(ee,2);q(ge,()=>wi,(ue,O)=>{O(ue,{children:(te,ve)=>{var X=aa(),he=x(X);q(he,()=>Si,(be,Te)=>{Te(be,{children:(me,_e)=>{We();var se=Je("No results found.");u(me,se)},$$slots:{default:!0}})});var Le=L(he,2);q(Le,()=>xi,(be,Te)=>{Te(be,{heading:"Fields",children:(me,_e)=>{var se=na(),xe=x(se),we=k(xe);Pt(we,{get checked(){return i(a).checked},get indeterminate(){return i(a).indeterminate},onCheckedChange:d}),We(2),I(xe);var Se=L(xe,2);q(Se,()=>jr,(le,fe)=>{fe(le,{})});var Ce=L(Se,2);Ue(Ce,17,c,Ye,(le,fe)=>{var pe=P(),Fe=x(pe);q(Fe,()=>pi,(Pe,Ke)=>{Ke(Pe,{class:"field-item",onselect:()=>f(i(fe).name),children:(Me,lt)=>{var Ie=ia(),Ve=k(Ie);{let $e=H(()=>i(n)?.has(i(fe).name)??!1);Pt(Ve,{class:"field-checkbox",get checked(){return i($e)},onCheckedChange:()=>f(i(fe).name)})}var Ee=L(Ve,2);Ee.__click=[ta,f,fe];var ye=k(Ee),ke=k(ye),Ze=k(ke,!0);I(ke);var Sr=L(ke,2);{var pr=$e=>{var dt=ra(),yr=k(dt);at(yr,()=>qr),I(dt),de(()=>Dt(dt,"title",i(fe).description)),u($e,dt)};M(Sr,$e=>{i(fe).description&&$e(pr)})}I(ye),I(Ee),I(Ie),de(()=>Ae(Ze,i(fe).alias||i(fe).name)),u(Me,Ie)},$$slots:{default:!0}})}),u(le,pe)}),u(me,se)},$$slots:{default:!0}})}),u(te,X)},$$slots:{default:!0}})}),u(j,z)},$$slots:{default:!0}})}),u(V,J)},$$slots:{default:!0}})}),u(w,D)},$$slots:{default:!0}})}),I(h),u(m,h)};M(g,m=>{i(r)&&m(C)})}u(s,S),W()}bt(["click","keydown"]);class ur{id;name;children;parent;constructor(e,t,r=[],n=null){this.id=e,this.name=t,this.children=r,this.parent=n}}class ie extends ur{layer;constructor(e,t,r,n=[],a=null){super(e,t,n,a),this.layer=r}}class Qe extends ie{featureLayer;field;constructor(e,t,r,n,a=[],o=null){super(e,t,r,a,o),this.field=n,this.featureLayer=r}}var re=(s=>(s.Inactive="inactive",s.Indeterminate="indeterminate",s.Active="active",s))(re||{}),Be=(s=>(s.Hidden="hidden",s.Suspended="suspended",s.Visible="visible",s))(Be||{});class fr{#e=A(!1);get initialized(){return i(this.#e)}set initialized(e){b(this.#e,e,!0)}#t=null;#r=null;#n=A(K([]));#i=H(()=>{const e=new ze;return this.#_(i(this.#n),e),e});#a=A(K(new ze));#s=A(K(new ze));#l=A(K(new ze));#d=A(K(new ze));#f=A(K(new ze));#v=null;initialize(e,t,r,n,a){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!t)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=t,n)for(const o of n)i(this.#f).set(o.id,o);if(a&&(this.#v=a),!e)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#r=r,this.#w(e),b(this.#n,this.#S(e),!0)}getNodeById(e){return this.#c(),i(this.#i).get(e)}getNodes(){return this.#c(),i(this.#n)}getVisibleNodes(){this.#c();const e=[];for(const[t,r]of i(this.#a)){if(!r)continue;const n=i(this.#i).get(t);n&&e.push(n)}return e}getNonHiddenNodes(){return this.#c(),this.#o(i(this.#n))}clearSelections(){this.#c();for(const e of i(this.#a).keys()){i(this.#a).set(e,!1);const t=i(this.#i).get(e);t&&t instanceof ie&&(t.layer.visible=!1)}i(this.#d).clear()}#o(e){this.#c();const t=[];for(const r of e){const n=this.#h(r.id);if(!(n&&n.isHidden)&&(t.push(r),r.children?.length)){const a=this.#o(r.children);t.push(...a)}}return t}getVisibilityState(e){return this.#c(),i(this.#a).get(e)??!1}setVisibilityState(e,t){this.#c();const r=i(this.#i).get(e);if(!r)throw new Error(`Tree node not found for ID: ${e}`);if(!(r instanceof ie))throw new Error(`Tree node is not a layer node: ${e}`);const n=this.#h(e);if(n?.disableVisibilityToggle||(i(this.#a).set(e,t),r.layer.visible=t,this.updateDrawState(r,t),r instanceof Qe&&(r.featureLayer.displayField=t?r.field.name:"",t&&this.#v&&(console.log("[TreeviewStore] Applying custom renderer for field:",r.field.name),this.#v.applyCustomRenderer(r.featureLayer,r.field.name))),this.#u(r,t),!n||n.isHidden)||(n.visibilityDependencyIds?.length&&this.#g(r,t),!n.visibilityGroupId))return;const a=n.visibilityGroupId;let o=i(this.#d).get(a);o||(o=[],i(this.#d).set(a,o));const l=this.#m(a);if(!l)throw new Error(`Visibility group config not found for group ID: ${a}`);if(!t){const d=o.indexOf(e);o.splice(d,1);return}const f=d=>{i(this.#a).set(d,!1);const c=i(this.#i).get(d);if(c&&c instanceof ie){c.layer.visible=!1,this.updateDrawState(c,!1),this.#u(c,!1);const g=this.#h(d);g&&g.visibilityDependencyIds?.length&&this.#g(c,!1)}const S=o.indexOf(d);S>=0&&o.splice(S,1)};for(;o.length>=l.maxVisibleLayers;){const d=o[0];f(d)}o.push(e),this.#u(r,t),n.visibilityDependencyIds?.length&&this.#g(r,t)}async updateDrawState(e,t){if(!this.#r)return;if(!t){i(this.#s).delete(e.id),i(this.#l).get(e.id)?.remove(),i(this.#l).delete(e.id);return}if(!(e instanceof ie)||!(e.layer instanceof Vt))return;const r=await this.#r.getLayerView(e.layer);if(!r)return;this.setInitialDrawState(e,r);const n=Fi(()=>r.suspended,(a,o)=>{o&&!a?i(this.#s).set(e.id,Be.Visible):!o&&a&&i(this.#s).set(e.id,Be.Suspended)});i(this.#l).set(e.id,n)}getNodeDrawState(e){return this.#c(),i(this.#s).get(e)??Be.Hidden}setInitialDrawState(e,t){!(e instanceof ie)||!(e.layer instanceof Vt)||t&&(t.suspended?i(this.#s).set(e.id,Be.Suspended):i(this.#s).set(e.id,Be.Visible))}clearDrawStateHandles(){for(const e of i(this.#l).values())e.remove();i(this.#l).clear()}cleanup(){this.initialized=!1,i(this.#a).clear(),i(this.#d).clear(),i(this.#f).clear(),b(this.#n,[],!0),i(this.#i).clear(),i(this.#s).clear(),this.clearDrawStateHandles()}#u(e,t){const r=e.parent;if(r){if(!(r instanceof ie)){this.#u(r,t);return}i(this.#a).set(r.id,t),r.layer.visible=t,this.#u(r,t)}}#g(e,t){const r=this.#h(e.id);if(r&&r.visibilityDependencyIds?.length)for(const n of r.visibilityDependencyIds){const a=i(this.#i).get(n);a&&a instanceof ie&&(i(this.#a).set(n,t),a.layer.visible=t,this.#u(a,t))}}#m(e){if(e&&this.#t)return this.#t.getVisibilityGroupConfig(e)}#w(e){this.#t&&this.#t.resolveInheritance(e)}#S(e){const t=e.map(r=>this.#y(r,void 0));return this.#p([...t])}#h(e){if(e&&this.#t)return this.#t.getItemConfig(e)}#p(e){e.reverse();for(const t of e)t.children?.length&&this.#p(t.children);return e}#y(e,t){const r=this.#h(e.id);if(r&&r.customConverterId){if(!i(this.#f).has(r.customConverterId))throw new Error(`Custom converter not found: ${r.customConverterId}`);const a=i(this.#f).get(r.customConverterId);if(!a)throw new Error(`Custom converter not found: ${r.customConverterId}`);return a.layerToNode(e,t??null)}const n=new ie(e.id,e.title,e,[],t);if(e.visible=r?.disableVisibilityToggle?e.visible:r?.isHidden?!1:r?.isVisibleOnInit??!1,i(this.#a).set(e.id,e.visible),this.updateDrawState(n,e.visible),this.#A(e)&&r?.showFields){const a=e;a.loaded||console.warn(`Layer not loaded: ${e.id}`);for(const o of a.fields??[]){const l=this.#C(o,n);n.children.push(l)}}if(this.#k(e)){const a=e;return n.children=a.layers.toArray().map(o=>this.#y(o,n)),n}if(this.#I(e)){const a=e;if(a.sublayers&&a.sublayers.length>0){const o=a.sublayers;n.children=o.toArray().map(this.#b)}}return n}#C(e,t){const r=this.#x(t.id,e.name),n=new Qe(r,e.alias||e.name,t.layer,e,[],t),a=this.#h(r);return i(this.#a).set(r,a?.isVisibleOnInit??!1),n}#I(e){return e.type==="map-image"||e.type==="wms"}#b(e){const t=new ie(e.uid,e.title,e);return e.sublayers?.length&&(t.children=e.sublayers.toArray().map(this.#b)),t}#_(e,t){for(const r of e)t.set(r.id,r),r.children?.length&&this.#_(r.children,t)}#x(e,t){return`${e}-${t}`}#k(e){return e.type==="group"}#A(e){return e.type==="feature"}#c(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}const ca='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',ua='<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',fa='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',vr=(s,e,t,r)=>e?va(s,t):t?r?ca:ua:fa,va=(s,e)=>{switch(s.type){case"group":return Mt;case"feature":return Et;case"tile":return Br;default:return e?Mt:Et}};function ha(s){const e=s-1;return e*e*e+1}var ga=F('<div class="relative ml-4 w-full"><div class="tree-guide-line svelte-1y72o5r"></div> <div class="tree-children svelte-1y72o5r"></div></div>'),ma=F('<div class="w-full"><!> <!></div>');function hr(s,e){const t=Q(e,"isOpen",3,!1),r=Q(e,"childNodes",3,null),n=Q(e,"duration",3,300);var a=ma(),o=k(a);ae(o,()=>e.content??Z);var l=L(o,2);{var f=d=>{var c=ga(),S=L(k(c),2);Ue(S,21,()=>r()??[],g=>g.id,(g,C)=>{var m=P(),h=x(m);ae(h,()=>e.childNode??Z,()=>i(C)),u(g,m)}),I(S),I(c),mt(1,S,()=>Yt,()=>({duration:n(),easing:ha})),mt(2,S,()=>Yt,()=>({duration:n()})),u(d,c)};M(l,d=>{t()&&r()&&d(f)})}I(a),u(s,a)}const kt="mb-1 cursor-pointer rounded-md border border-border p-2 text-left",At="transition-all duration-150 hover:border-border/50 hover:bg-gray-100 hover:shadow-sm",wa="transition-colors hover:bg-blue-500",Ft="text-sm font-normal",Nt="bg-card",gr="bg-accent text-accent-foreground",Sa="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";function pa(s={}){const{enhancedHover:e=!1,includeFont:t=!1,pressed:r=!1}=s;let n=kt;return e?n+=" "+At:n+=" "+wa,t&&(n+=" "+Ft),r?n+=" "+gr:n+=" "+Nt,n}var ya=F('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),ba=F('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function Xt(s,e){const t=`calc(100% - ${e.depth*1}rem)`,r=`${kt} ${At} ${Sa} ${Nt} ${Ft}`,n=`${kt} ${At} ${Ft}`;var a=P(),o=x(a);{var l=d=>{Gr(d,{get pressed(){return e.pressed},get class(){return r},variant:"outline",get style(){return`width: ${t};`},get onPressedChange(){return e.onclick},children:(c,S)=>{var g=ya(),C=k(g),m=k(C),h=k(m);at(h,()=>e.icon),I(m);var p=L(m,2),v=k(p,!0);I(p),I(C);var y=L(C,2);ae(y,()=>e.children??Z),I(g),de(()=>Ae(v,e.name)),u(c,g)},$$slots:{default:!0}})},f=d=>{var c=ba();c.__click=function(...w){e.onclick?.apply(this,w)};var S=k(c),g=k(S),C=k(g);ir(C,{get isOpen(){return e.isOpen}});var m=L(C,2),h=k(m);at(h,()=>e.icon),I(m);var p=L(m,2),v=k(p,!0);I(p),I(g);var y=L(g,2);ae(y,()=>e.children??Z),I(S),I(c),de(()=>{Lt(c,1,`${n} ${e.pressed?gr:Nt}`),St(c,`width: ${t};`),Ae(v,e.name)}),u(d,c)};M(o,d=>{e.isTogglable?d(l):d(f,!1)})}u(s,a)}bt(["click"]);function mr(s,e){G(e,!0);const t=h=>{var p=P(),v=x(p);{var y=w=>{var _=P(),D=x(_);{var N=R=>{Xt(R,{isTogglable:!1,get pressed(){return i(d)},get icon(){return i(c)},get name(){return e.node.name},get depth(){return n()},onclick:m,get isOpen(){return i(f)}})},E=R=>{Xt(R,{isTogglable:!0,get pressed(){return i(d)},get icon(){return i(c)},get name(){return e.node.name},get depth(){return n()},onclick:C,get isOpen(){return i(f)}})};M(D,R=>{o?R(N):R(E,!1)})}u(w,_)};M(v,w=>{e.treeviewConfigStore.getItemConfig(e.node.id)?.isHidden||w(y)})}u(h,p)},r=(h,p=Z)=>{var v=P(),y=x(v);{var w=_=>{{let D=H(()=>n()+1);mr(_,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return p()},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get getNodeVisibility(){return e.getNodeVisibility},get depth(){return i(D)},get useLayerTypeIcon(){return a()}})}};M(y,_=>{o&&i(f)&&!e.treeviewConfigStore.getItemConfig(p().id)?.isHidden&&_(w)})}u(h,v)},n=Q(e,"depth",3,0),a=Q(e,"useLayerTypeIcon",3,!1),o=!!(e.node.children&&e.node.children.length),l=!o;let f=A(!1),d=A(!1),c=A("");function S(){return!e.node.children||!e.getNodeVisibility?!1:e.node.children.some(h=>{const p=e.getNodeVisibility(h.id);return p!==void 0?p:h instanceof ie?h.layer.visible:!1})}$(()=>{if(!(!e.node||!(e.node instanceof ie))){if(o)b(d,S(),!0);else{const h=e.getNodeVisibility?e.getNodeVisibility(e.node.id):void 0;b(d,h!==void 0?h:e.node.layer.visible,!0)}b(c,vr(e.node.layer,a(),o,i(f)),!0)}});function g(){!l||!e.onNodeVisibilityChange||o||(b(d,!i(d)),e.onNodeVisibilityChange(e.node,i(d)))}function C(){o||g(),e.onNodeClick?.(e.node)}function m(){b(f,!i(f)),e.onNodeClick?.(e.node)}{let h=H(()=>o?e.node.children:null);hr(s,{get isOpen(){return i(f)},get content(){return t},get childNodes(){return i(h)},get childNode(){return r}})}W()}function _a(s,e){G(e,!0);const t=new fr;function r(){t.clearSelections()}$(()=>{!e.webMap||t.initialized||t.initialize(e.webMap.layers.toArray(),e.treeviewConfigStore,null)}),$(()=>{t.initialized&&!t.getVisibleNodes().length&&e.areaSelectionStore.layerId&&t.setVisibilityState(e.areaSelectionStore.layerId,!0)}),$(()=>{if(!t.initialized||!t.getVisibleNodes().length)return;const f=t.getVisibleNodes().find(d=>d instanceof ie&&d.layer instanceof zt);if(!f||!(f instanceof ie)){console.warn("Visible node is not a FeatureLayer");return}if(!f.layer||!(f.layer instanceof zt)){console.warn("Visible node layer is not a FeatureLayer",f.layer.type);return}e.areaSelectionStore.setLayerId(f.id)});var n={clearSelections:r},a=P(),o=x(a);{var l=f=>{var d=P(),c=x(d);q(c,()=>nr,(S,g)=>{g(S,{children:(C,m)=>{var h=P(),p=x(h);Ue(p,17,()=>t.getNodes(),v=>v.id,(v,y)=>{mr(v,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return i(y)},onNodeClick:()=>{},onNodeVisibilityChange:(w,_)=>t.setVisibilityState(w.id,_),getNodeVisibility:w=>t.getVisibilityState(w),depth:0,useLayerTypeIcon:!0})}),u(C,h)},$$slots:{default:!0}})}),u(f,d)};M(o,f=>{t.initialized&&f(l)})}return u(s,a),W(n)}class Ca{configStore;constructor(e){this.configStore=e}}class Ia extends Ca{id="aliasPath";layerToNode(e,t){const r=new ie(e.id,e.title,e,[],t),n=this.configStore.getItemConfig(e.id);if(this.#r(e)&&n?.showFields){const a=e;a.loaded||console.warn(`Layer not loaded: ${e.id}`);const o=new Map;for(const l of a.fields??[]){const f=this.configStore.getItemConfig(this.#t(e.id,l.name));!f||f.isHidden||this.#e(l,r,o)}r.children.sort((l,f)=>l.children.length>0&&f.children.length===0?1:l.children.length===0&&f.children.length>0?-1:0)}return r}#e(e,t,r=new Map){const n=this.#t(t.id,e.name),o=Ni(e.alias||"")?.split("|").map(g=>g.trim()).filter(Boolean)??[];if(o.length===0){const g=new Qe(n,e.alias||e.name,t.layer,e,[],t);return t.children.push(g),g}const l=o.slice(0,-1),f=o[o.length-1];let d=t;const c=(g,C)=>{g.children??=[],g.children.includes(C)||g.children.push(C)};for(let g=0;g<l.length;g++){const C=l[g],m=o.slice(0,g+1).join("::"),h=`${t.id}::${m}`;let p=r.get(h);p||(p=new ur(h,C,[],d),r.set(h,p),c(d,p)),d=p}const S=new Qe(n,f||e.name,t.layer,e,[],d);return c(d,S),S}#t(e,t){return`${e}-${t}`}#r(e){return e.type==="feature"}}class Kt{#e=[];#t=new Map;#r=[];#n=new Map;#i=[];#a=new Map;#s=new Set;constructor(e){if(!e)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=e.items??[],this.#t=new Map(this.#e.map(t=>[t.id,t])),this.#r=e.visibilityGroups??[],this.#n=new Map(this.#r.map(t=>[t.id,t])),this.#i=e.inheritanceGroups??[],this.#a=new Map(this.#i.map(t=>[t.id,t])),e.fieldsToHide&&(this.#s=new Set(e.fieldsToHide.map(t=>t.trim().toLowerCase())))}getItemConfig(e){return this.#t.get(e)}getVisibilityGroupConfig(e){return this.#n.get(e)}getInheritanceGroupConfig(e){return this.#a.get(e)}resolveInheritance(e){if(!(e.length===0||!this.#e||this.#e.length===0))for(const t of e){const r=this.getItemConfig(t.id);this.#l(t,r)}}#l(e,t){const r=this.#d(e,t);if(this.#S(e)&&r.showFields){const n=e;n.loaded||console.warn(`Layer not loaded: ${e.id}`);for(const a of n.fields??[])this.#f(this.#m(e.id,a.name),a.alias||a.name,r)}if(this.#w(e)){const n=e;for(const a of n.layers.toArray())this.#l(a,r)}}#d(e,t){const r=this.#v(e.id,t);return r.type===ct.None&&(r.type=Wr(e)),r}#f(e,t,r){const n=this.#v(e,r);return n.type===ct.None&&(n.type=ct.Field),this.#s.has(t.trim().toLowerCase())&&(n.isHidden=!0),n}#v(e,t){let r=this.getItemConfig(e);const n=r?.inheritanceGroupId?this.getInheritanceGroupConfig(r.inheritanceGroupId):this.getInheritanceGroupConfig(t?.inheritanceGroupId??"");return r={id:e,type:ct.None,isDownloadable:this.#o(n,"isDownloadable",r,t,!0),isVisibleOnInit:this.#o(n,"isVisibleOnInit",r,t,!1),isHidden:this.#o(n,"isHidden",r,t,!1),disableVisibilityToggle:this.#o(n,"disableVisibilityToggle",r,t,!1),isOpenOnInit:this.#o(n,"isOpenOnInit",r,t,!1),showFields:this.#o(n,"showFields",r,t,!1),visibilityDependencyIds:this.#o(n,"visibilityDependencyIds",r,t,[]),visibilityGroupId:this.#o(n,"visibilityGroupId",r,t,void 0),customConverterId:this.#o(n,"customConverterId",r,t,void 0),inheritanceGroupId:this.#o(n,"inheritanceGroupId",r,t,void 0)},this.#g(r),this.#u(r),r}#o(e,t,r,n,a){const o=r?.[t];return o!==void 0?o:e?.inheritedProperties.includes(t)&&n?n[t]??a:a}#u(e){if(this.#t.has(e.id))throw new Error(`Item with id ${e.id} already exists.`);this.#e.push(e),this.#t.set(e.id,e)}#g(e){this.#t.has(e.id)&&(this.#e=this.#e.filter(t=>t.id!==e.id),this.#t.delete(e.id))}#m(e,t){return`${e}-${t}`}#w(e){return e.type==="group"}#S(e){return e.type==="feature"}}var xa=F('<div data-slot="checkbox-indicator" class="text-current transition-none"><!></div>');function ka(s,e){G(e,!0);let t=Q(e,"ref",15,null),r=Q(e,"checked",11,!1),n=Q(e,"indeterminate",11,!1),a=Ne(e,["$$slots","$$events","$$legacy","ref","checked","indeterminate","class"]),o=A(K(r())),l=A(K(n()));$(()=>{b(o,r())}),$(()=>{b(l,n())});var f=P(),d=x(f);{const c=(g,C)=>{let m=()=>C?.().checked,h=()=>C?.().indeterminate;var p=xa(),v=k(p);{var y=_=>{Yi(_,{class:"size-3.5"})},w=_=>{var D=P(),N=x(D);{var E=R=>{Yr(R,{class:"size-3.5"})};M(N,R=>{h()&&R(E)},!0)}u(_,D)};M(v,_=>{m()?_(y):_(w,!1)})}I(p),u(g,p)};let S=H(()=>Di("peer flex size-4 shrink-0 items-center justify-center rounded-[4px] border border-input shadow-xs transition-shadow outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 data-[state=checked]:border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:bg-input/30 dark:aria-invalid:ring-destructive/40 dark:data-[state=checked]:bg-primary",e.class));q(d,()=>Jr,(g,C)=>{C(g,Re({"data-slot":"checkbox",get class(){return i(S)}},()=>a,{get ref(){return t()},set ref(m){t(m)},get checked(){return i(o)},set checked(m){b(o,m,!0)},get indeterminate(){return i(l)},set indeterminate(m){b(l,m,!0)},children:c,$$slots:{default:!0}}))})}u(s,f),W()}var Aa=F("<div><!></div>");function Zt(s,e){G(e,!0);let t=H(()=>e.getDownloadState?.(e.node)??re.Inactive),r=H(()=>i(t)===re.Active),n=H(()=>i(t)===re.Indeterminate);function a(f){f.stopPropagation();const d=i(t)===re.Active?re.Inactive:re.Active;e.onDownloadStateChanged?.(e.node,d)}var o=Aa(),l=k(o);ka(l,{get checked(){return i(r)},get indeterminate(){return i(n)},onclick:a,title:"Download"}),I(o),u(s,o),W()}var Fa=F('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function $t(s,e){G(e,!0);const t=Q(e,"isFolder",3,!1),r=Q(e,"isOpen",3,!1),n=`calc(100% - ${e.depth*1}rem)`;var a=Fa();a.__click=function(...h){e.onclick?.apply(this,h)};var o=k(a),l=k(o),f=k(l);{var d=h=>{ir(h,{get isOpen(){return r()}})};M(f,h=>{t()&&h(d)})}var c=L(f,2),S=k(c);at(S,()=>e.icon),I(c);var g=L(c,2),C=k(g,!0);I(g),I(l);var m=L(l,2);ae(m,()=>e.children??Z),I(o),I(a),de(h=>{Lt(a,1,h),St(a,`width: ${n};`),Ae(C,e.name)},[()=>Er(pa({enhancedHover:!0,includeFont:!0}))]),u(s,a),W()}bt(["click"]);var Na=F('<div class="flex items-center gap-2"><!> <!></div>'),Da=F('<div class="flex items-center gap-2"><!> <!></div>');function wr(s,e){G(e,!0);const t=y=>{var w=P(),_=x(w);{var D=N=>{var E=P(),R=x(E);{var U=V=>{$t(V,{get icon(){return i(g)},get name(){return e.node.name},get depth(){return a()},onclick:v,get isFolder(){return l},get isOpen(){return i(c)},children:J=>{var Y=Na(),oe=k(Y);{var ce=z=>{Zt(z,{get node(){return e.node},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState}})};M(oe,z=>{e.isDownloadable&&z(ce)})}var j=L(oe,2);{var ne=z=>{{let ee=H(()=>e.getNodeDrawState?.(e.node.id)===Be.Suspended);Ot(z,{get checked(){return i(S)},get indeterminate(){return i(ee)},onCheckedChange:h})}};M(j,z=>{f&&z(ne)})}I(Y),u(J,Y)},$$slots:{default:!0}})},T=V=>{$t(V,{get icon(){return i(g)},get name(){return e.node.name},get depth(){return a()},onclick:p,get isFolder(){return l},children:J=>{var Y=Da(),oe=k(Y);{var ce=z=>{Zt(z,{get node(){return e.node},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState}})};M(oe,z=>{e.isDownloadable&&z(ce)})}var j=L(oe,2);{var ne=z=>{{let ee=H(()=>e.getNodeDrawState?.(e.node.id)===Be.Suspended);Ot(z,{get checked(){return i(S)},get indeterminate(){return i(ee)},onCheckedChange:h})}};M(j,z=>{f&&z(ne)})}I(Y),u(J,Y)},$$slots:{default:!0}})};M(R,V=>{l?V(U):V(T,!1)})}u(N,E)};M(_,N=>{n()?.getItemConfig(e.node.id)?.isHidden||N(D)})}u(y,w)},r=(y,w=Z)=>{var _=P(),D=x(_);{var N=E=>{{let R=H(()=>n()?.getItemConfig(w().id)?.isDownloadable??!0),U=H(()=>a()+1);wr(E,{get treeviewConfigStore(){return n()},get node(){return w()},get isDownloadable(){return i(R)},get onNodeClick(){return e.onNodeClick},get onNodeVisibilityChange(){return e.onNodeVisibilityChange},get onDownloadStateChanged(){return e.onDownloadStateChanged},get getDownloadState(){return e.getDownloadState},get onFilterClicked(){return e.onFilterClicked},get hasFiltersApplied(){return e.hasFiltersApplied},get getNodeVisibility(){return e.getNodeVisibility},get getNodeDrawState(){return e.getNodeDrawState},get depth(){return i(U)},get useLayerTypeIcon(){return o()}})}};M(D,E=>{l&&i(c)&&!n()?.getItemConfig(w().id)?.isHidden&&E(N)})}u(y,_)},n=Q(e,"treeviewConfigStore",3,null),a=Q(e,"depth",3,0),o=Q(e,"useLayerTypeIcon",3,!1),l=!!(e.node.children&&e.node.children.length),f=!l;let d=!1,c=A(!1),S=A(!1),g=A(""),C=A(!1),m=A(!1);$(()=>{d||(b(c,n()?.getItemConfig(e.node.id)?.isOpenOnInit??!1,!0),d=!0)}),$(()=>{if(!e.node)return;const y=e.getNodeVisibility?e.getNodeVisibility(e.node.id):!1;b(S,y??!1,!0),e.node instanceof ie&&b(g,vr(e.node.layer,o(),l,i(c)),!0)}),$(()=>{if(!(e.node instanceof ie))return;const y=(e.getDownloadState?.(e.node)===re.Active&&e.node.layer.type==="feature")??!1;y&&!i(C)?(b(C,!0),b(m,!1)):!y&&i(C)&&(b(m,!0),setTimeout(()=>{b(C,!1),b(m,!1)},180))});function h(){!f||!e.onNodeVisibilityChange||(b(S,!i(S)),e.onNodeVisibilityChange(e.node,i(S)))}function p(){e.onNodeClick?.(e.node)}function v(){b(c,!i(c)),e.onNodeClick?.(e.node)}{let y=H(()=>l?e.node.children:null);hr(s,{get isOpen(){return i(c)},get content(){return t},get childNodes(){return i(y)},get childNode(){return r}})}W()}class La{#e;#t;constructor(e,t){this.#e=e,this.#t=t}updateSelection(e,t){if(!this.#t.getItemConfig(e.id)?.isHidden){if(!(e instanceof ie)){this.updateChildrenSelection(e,t);return}if(e instanceof Qe){this.updateFieldSelection(e,t);return}this.updateLayerSelection(e,t)}}getSelectionState(e){if(!(e instanceof ie))return this.determineSelectionStateFromChildren(e);if(this.isGroupLayer(e))return this.determineSelectionStateFromChildren(e);let t;return e instanceof Qe?(t=this.#e.getSelection(e.featureLayer.id),t&&t.selectedFieldIds.has(e.field.name)?re.Active:re.Inactive):(t=this.#e.getSelection(e.id),t?this.isFeatureLayer(e)&&e.children&&e.children.length>0?this.determineSelectionStateFromChildren(e):re.Active:re.Inactive)}updateLayerSelection(e,t){let r=this.#e.getSelection(e.id);switch(t){case re.Active:!r&&!this.isGroupLayer(e)&&(r=this.createAndAddDataSelection(e.id));for(const n of e.children||[])this.updateSelection(n,t);break;case re.Inactive:r&&!this.isGroupLayer(e)&&this.#e.removeSelection(e.id),this.updateChildrenSelection(e,t);break}}updateFieldSelection(e,t){let r=this.#e.getSelection(e.featureLayer.id);switch(t){case re.Active:r||(r=this.createAndAddDataSelection(e.featureLayer.id)),this.#e.addOrUpdateSelection(e.featureLayer.id,[...r.selectedFieldIds,e.field.name]);break;case re.Inactive:{if(!r)break;const n=new He(r.selectedFieldIds);n.delete(e.field.name),this.#e.addOrUpdateSelection(e.featureLayer.id,[...n]),n.size===0&&this.#e.removeSelection(r.layerId);break}}}updateChildrenSelection(e,t){for(const r of e.children||[])this.updateSelection(r,t)}determineSelectionStateFromChildren(e){let t=0,r=0;for(const n of e.children||[]){if(this.#t.getItemConfig(n.id)?.isHidden)continue;r++;const o=this.getSelectionState(n);if(o===re.Active||this.isFeatureLayer(n)&&o!==re.Inactive)t++;else if(o===re.Indeterminate)return re.Indeterminate}return t===0?re.Inactive:t===r?re.Active:re.Indeterminate}createAndAddDataSelection(e){const t={layerId:e,selectedFieldIds:new He};return this.#e.addSelection(t),t}isGroupLayer(e){return e instanceof ie&&e.layer.type==="group"}isFeatureLayer(e){return e instanceof ie&&e.layer.type==="feature"}}function Ta(s,e){G(e,!0);const t=Q(e,"fieldFilterMenuStore",7);function r(){n.clearSelections()}const n=new fr,a=new La(e.dataSelectionStore,e.treeviewConfigStore);$(()=>{if(!e.webMap||n.initialized)return;(async()=>{await e.webMap.when(),await o(e.webMap.layers.toArray());const y=new Ia(e.treeviewConfigStore);n.initialize(e.webMap.layers.toArray(),e.treeviewConfigStore,e.layerViewProvider,[y],e.customRendererService)})()});async function o(v){for(const y of v)y.type==="feature"&&!y.loaded&&await y.load(),y.type==="group"&&await o(y.layers.toArray())}function l(v,y){console.log(`[tree-view] onNodeVisibilityChange: Setting visibility of node ${v.id} to ${y}`),n.setVisibilityState(v.id,y)}function f(v){return n.getNodeDrawState(v)}function d(v,y){a.updateSelection(v,y)}function c(v){return a.getSelectionState(v)}function S(v){if(t().ActiveLayer?.uid===v){t().ActiveLayer=null;return}const w=n.getNodeById(v);!w||!(w instanceof ie)||(t().ActiveLayer=w.layer)}function g(v){const y=e.dataSelectionStore.getSelection(v);if(!y?.selectedFieldIds)return!1;const w=n.getNodeById(v);if(!w||!(w instanceof ie))return!1;const _=w.layer.fields?.length||0,D=y?.selectedFieldIds.size||0;return D>0&&D!==_}var C={clearSelections:r},m=P(),h=x(m);{var p=v=>{var y=P(),w=x(y);q(w,()=>nr,(_,D)=>{D(_,{children:(N,E)=>{var R=P(),U=x(R);Ue(U,17,()=>n.getNodes(),T=>T.id,(T,V)=>{{let B=H(()=>e.treeviewConfigStore.getItemConfig(i(V).id)?.isDownloadable??!0);wr(T,{get treeviewConfigStore(){return e.treeviewConfigStore},get node(){return i(V)},get isDownloadable(){return i(B)},onNodeClick:()=>{},onNodeVisibilityChange:l,getNodeVisibility:J=>n.getVisibilityState(J),onDownloadStateChanged:d,getDownloadState:c,onFilterClicked:S,hasFiltersApplied:g,getNodeDrawState:f,depth:0,useLayerTypeIcon:!0})}}),u(N,R)},$$slots:{default:!0}})}),u(v,y)};M(h,v=>{n.initialized&&v(p)})}return u(s,m),W(C)}var Pa=F('<div class="map-view svelte-14z0ybm"></div>');function Ma(s,e){G(e,!0);const t=Q(e,"mapView",7);let r=A(null),n=null;const a="streets-vector";let o,l;function f(){if(!t())throw new Error("MapView is not initialized");return new sr(t())}it(async()=>{await d(),await g()});async function d(){if(!l){const[{default:v},{default:y},{default:w},{default:_}]=await Promise.all([tt(()=>import("../chunks/DEOvtJTU.js").then(D=>D.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]),import.meta.url),tt(()=>import("../chunks/M4qysLGv.js").then(D=>D.a2),__vite__mapDeps([28,1,2,3,5,29,30,18,31,16,6,7,32,8,9,15,20,33,34,11,17,35,25,36,37,38,19,39,40,41,42,43,0,4,10,12,13,14,21,22,23,24,26,27,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65]),import.meta.url),tt(()=>import("../chunks/DV4ulai0.js").then(D=>D.W),__vite__mapDeps([66,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,29,30,31,32,33,34,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,49,50,100,101,102]),import.meta.url),tt(()=>import("../chunks/ClYjbYd3.js").then(D=>D.aq),__vite__mapDeps([67,5,1,2,3,32,18,8,7,9,6,15,16,20,33,68,69,70,19,71,34,11,72,73,25,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,12]),import.meta.url)]);o=v,l=y}}async function c(){return new o({basemap:a})}async function S(){if(e.webMap)try{if(await d(),await g(),!t()){console.error("MapView is not initialized");return}t().container=n,t().popupEnabled=!1,t().map=e.webMap,console.log("[uprn-map-view] MapView updated with new webMap"),await e.areaSelectionInteractionStore.refreshLayerView(),await e.areaSelectionInteractionStore.refreshAreas()}catch(v){console.error("Error updating MapView with new webMap:",v)}}async function g(){if(!n){console.error("Map container element was not found");return}try{t().container=n,t().popupEnabled=!1,t().map=e.webMap??void 0,t().ui.move("zoom","top-right"),await t().when(),console.log("[uprn-map-view] Map loaded successfully")}catch(v){console.error("Error loading map:",v),await C()}}async function C(){try{const v=await c();t().container=n,t().popupEnabled=!1,t().map=v,await t().when(),console.log("[uprn-map-view] Fallback map loaded")}catch(v){console.error("Error loading fallback map:",v)}}$(()=>{e.webMap&&S()}),$(()=>{!t()||i(r)||b(r,new ui(t(),e.areaSelectionInteractionStore,e.interactableLayers),!0)});function m(){t()&&t().destroy()}er(()=>{m()});var h={getLayerViewProvider:f},p=Pa();return Oe(p,v=>n=v,()=>n),u(s,p),W(h)}var Ea=F('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),Oa=F('<div class="flex min-h-0 flex-1 flex-col"><!></div>');function gt(s,e){var t=Oa(),r=k(t);q(r,()=>yt,(n,a)=>{a(n,{class:"card-content flex min-h-0 flex-1 flex-col overflow-hidden p-0",children:(o,l)=>{var f=Ea(),d=k(f);ae(d,()=>e.children??Z),I(f),u(o,f)},$$slots:{default:!0}})}),I(t),u(s,t)}var Ra=F("<!> <!>",1),Va=F('<div class="tab-list-wrapper flex-shrink-0 svelte-rohqkk"><!></div> <!>',1);function za(s,e){G(e,!0);const t=Q(e,"triggers",19,()=>[]);var r=P(),n=x(r);q(n,()=>Qr,(a,o)=>{o(a,{get value(){return e.value},get onValueChange(){return e.onValueChange},class:"flex h-full w-full flex-col",children:(l,f)=>{var d=Va(),c=x(d),S=k(c);q(S,()=>Xr,(C,m)=>{m(C,{class:"tab-list",children:(h,p)=>{var v=P(),y=x(v);Ue(y,17,t,Ye,(w,_,D,N)=>{let E=()=>i(_).value,R=()=>i(_).label;var U=Ra(),T=x(U);q(T,()=>Kr,(J,Y)=>{Y(J,{get value(){return E()},class:"tab-trigger",children:(oe,ce)=>{We();var j=Je();de(()=>Ae(j,R())),u(oe,j)},$$slots:{default:!0}})});var V=L(T,2);{var B=J=>{ki(J,{class:"separator"})};M(V,J=>{E()!==t()[t().length-1]?.value&&J(B)})}u(w,U)}),u(h,v)},$$slots:{default:!0}})}),I(c);var g=L(c,2);ae(g,()=>e.children??Z),u(l,d)},$$slots:{default:!0}})}),u(s,r),W()}const Ha=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];class Ua{#e;constructor(e){if(!e)throw new Error("UprnDownloadService endpoints configuration is required");if(!e.baseUrl||!e.healthRoute||!e.requestJobRoute||!e.requestJobStatusesRoute||!e.getAreaSelectionLimitsRoute||!e.fetchDownloadRoute)throw new Error("UprnDownloadService endpoints configuration is incomplete");this.#e=e}async getHealth(){try{const e=`${this.#e.baseUrl}${this.#e.healthRoute}`,t=await fetch(e);return t.ok?(await t.json()).status==="ok":!1}catch(e){return console.error("Health check failed:",e),!1}}async requestJob(e){try{console.log("[uprn-download-service] requesting job with request:",e);const t=`${this.#e.baseUrl}${this.#e.requestJobRoute}`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){console.error("Failed to request job:",r.statusText,"request:",JSON.stringify(e));return}return await r.json()}catch(t){console.error("Error requesting job:",t);return}}async requestJobStatuses(e){try{const t=`${this.#e.baseUrl}${this.#e.requestJobStatusesRoute}`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){console.error("Failed to get job statuses:",r.statusText);return}return await r.json()}catch(t){console.error("Error getting job statuses:",t);return}}async getSelectionAreaLimits(){try{const e=`${this.#e.baseUrl}${this.#e.getAreaSelectionLimitsRoute}`,t=await fetch(e);if(!t.ok){console.error("Failed to get area selection limits:",t.statusText);return}return await t.json()}catch(e){console.error("Error getting selection area limits:",e);return}}getDownloadUrl(e){const t=this.#e.baseUrl.replace(/\/+$/,""),r=this.#e.fetchDownloadRoute.replace(/\/+$/,"");return`${t}${r}/${encodeURIComponent(e)}`}}class ja{#e;constructor(e){this.#e=e}async getHealth(){try{const e=`${this.#e.baseUrl}${this.#e.healthRoute}`,t=await fetch(e);return t.ok?(await t.json()).status==="ok":!1}catch(e){return console.error("Health check failed:",e),!1}}async chat(e){try{const t=`${this.#e.baseUrl}${this.#e.chatRoute}`,n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})});if(!n.ok){console.error("Failed to send chat query:",n.statusText);return}return await n.json()}catch(t){console.error("Error sending chat query:",t);return}}async chatStream(e,t){try{const r=`${this.#e.baseUrl}${this.#e.chatStreamRoute}`,a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})});if(!a.ok)return console.error("Failed to start chat stream:",a.statusText),!1;const o=a.body?.getReader();if(!o)return console.error("No response body reader available"),!1;const l=new TextDecoder;let f=!1;for(;!f;){const{value:d,done:c}=await o.read();if(f=c,d){const S=l.decode(d,{stream:!f});t(S)}}return!0}catch(r){return console.error("Error during chat stream:",r),!1}}}const qa=Object.freeze({lod00World:{lod:0,scale:591657527591555e-6},lod01World:{lod:1,scale:295828763795777e-6},lod02World:{lod:2,scale:147914381897889e-6},lod03Continent:{lod:3,scale:73957190948944e-6},lod04Continent:{lod:4,scale:36978595474472e-6},lod05Countries:{lod:5,scale:18489297737236e-6},lod06Country:{lod:6,scale:9244648868618e-6},lod07StatesProvinces:{lod:7,scale:4622324434309e-6},lod08Counties:{lod:8,scale:2311162217155e-6},lod09Counties:{lod:9,scale:1155581108577e-6},lod10Country:{lod:10,scale:577790.554289},lod11MetropolitanArea:{lod:11,scale:288895.277144},lod12Cities:{lod:12,scale:144447.638572},lod13City:{lod:13,scale:72223.819286},lod14Town:{lod:14,scale:36111.909643},lod15Neighborhood:{lod:15,scale:18055.954822},lod16Streets:{lod:16,scale:9027.977411},lod17CityBlock:{lod:17,scale:4513.988705},lod18Buildings:{lod:18,scale:2256.994353},lod19Building:{lod:19,scale:1128.497176},lod20Houses:{lod:20,scale:564.248588},lod21Houses:{lod:21,scale:282.124294},lod22Houses:{lod:22,scale:141.062147},lod23HouseProperty:{lod:23,scale:70.5310735}});class Ba{#e=null;#t=!1;async init(e){this.#t||(await this.#r(e),this.#t=!0)}async#r(e){const r=await(await fetch(e)).json();this.#e=r}doesFieldHaveCustomRenderer(e,t){this.#d();const r=this.#e.FeatureLayers.find(o=>o.Name===e.title);if(!r)return!1;const n=this.#e.Fields.find(o=>o.FeatureLayerId===r.Id&&o.Name===t);return n?!!this.#e.CustomRenderers_Fields.find(o=>o.FieldId===n.Id):!1}getAllFieldsWithCustomRenderers(e){this.#d();const t=this.#e.FeatureLayers.find(a=>a.Name===e.title);if(!t)return[];const r=this.#e.Fields.filter(a=>a.FeatureLayerId===t.Id),n=[];for(const a of r)this.#e.CustomRenderers_Fields.some(l=>l.FieldId===a.Id)&&n.push(a.Name);return n}async applyCustomRenderer(e,t){this.#d();const r=this.#e.FeatureLayers.find(c=>c.Name===e.title);if(!r)return;const n=this.#e.Fields.find(c=>c.FeatureLayerId===r.Id&&c.Name===t);if(!n){console.warn(`[custom-renderer-service] could not find the field ${t} for feature layer id ${r.Id}`);return}const a=this.#e.CustomRenderers_Fields.find(c=>c.FieldId===n.Id);if(!a){console.warn(`[custom-renderer-service] could not find a custom renderer field for field ${t} in feature layer id ${r.Id}`);return}const o=this.#e.CustomRenderers.find(c=>c.Id===a.CustomRendererId);if(!o)throw new Error(`Could not find a custom renderer with the id ${a.CustomRendererId}`);const l=await this.getRendererClassBreaks(o.ClassBreaksGroupId.toString()),f=await this.getRendererSymbols(o.SymbolsId.toString()),d=this.#i(o.CustomRendererType,f,l,[],t);e.renderer=d,this.setCustomOutlines(e,o.LodsGroupId)}async setCustomOutlines(e,t){const r=this.#e.CustomRenderers_Lods.filter(o=>o.GroupId===t).sort((o,l)=>o.Lod-l.Lod);if(r.length===0){console.warn(`No LODs found for LODs group id ${t}`);return}const n=[],a=Object.values(qa);r.forEach(o=>{const l=o.OutlineWidth,f=o.Lod,d=this.#n(a,f)-1;n.push({size:l,value:a[d].scale})}),(e.renderer instanceof Ut||e.renderer instanceof jt)&&this.#l(e.renderer,n)}async getRendererClassBreaks(e){const t=parseInt(e,10),r=this.#e.CustomRenderers_ClassBreaks.filter(n=>n.GroupId===t).sort((n,a)=>n.Order-a.Order);if(r.length===0)throw new Error(`Could not find a group with the id ${e}`);return r}async getRendererSymbols(e){const t=parseInt(e,10),r=this.#e.CustomRenderers_Symbols.find(o=>o.Id===t);if(!r)throw new Error(`Could not find a symbol with the id ${e}`);const n=this.#e.CustomRenderers_Symbols_Appearances.filter(o=>o.SymbolsId===t).sort((o,l)=>o.Order-l.Order);return{...r,Appearances:n}}#n(e,t){const r=e.findIndex(n=>n.lod===t);return r===-1?0:r<23?r+1:r}#i(e,t,r,n,a){switch(e){case 1:return this.#s(t,n);case 2:return this.#a(a,t,r,n);default:throw new Error(`Unknown renderer type: ${e}`)}}#a(e,t,r,n){const a="ClassMinValue",o="ClassMaxValue",l="SymbolColor",f="OutlineColor",d="OutlineWidth",c=t.Appearances.length,S=new Ut({field:e});for(let g=0;g<c;g++){const C=r[g][a],m=r[g][o],h=t.Appearances[g][l],p=t.Appearances[g][f],v=t.Appearances[g][d];S.addClassBreakInfo({minValue:C,maxValue:m,symbol:new qt({color:ft.fromHex(h),outline:new Bt({color:ft.fromHex(p),width:v})})})}return this.#l(S,n),S}#s(e,t){const r="SymbolColor",n="OutlineColor",a="OutlineWidth",o=e.Appearances[0][r],l=e.Appearances[0][n],f=e.Appearances[0][a],d=new jt({symbol:new qt({color:ft.fromHex(o),outline:new Bt({color:ft.fromHex(l),width:f})})});return this.#l(d,t),d}#l(e,t){e.visualVariables=[{type:"size",target:"outline",valueExpression:"$view.scale",stops:t}]}#d(){if(!this.#t)throw new Error("CustomRendererService is not initialized");if(!this.#e)throw new Error("Data is not loaded")}}var Ga=F('<div class="flex w-full items-center justify-between"><div class="font-medium">Chat</div> <div class="flex gap-1"><!> <!></div></div>'),Wa=F("<!> <!>",1),Ja=F("<div><!></div>");function Ya(s,e){G(e,!0);const t=Q(e,"isOpenedOnInit",3,!1);let r=A(!1),n=A(K(t())),a=A(!1),o=A(void 0),l="300px",f="45px";$(()=>{i(r)||!i(o)||(i(n)&&(i(o).style.height=l),b(r,!0))});function d(){i(o)&&(b(n,!i(n)),b(a,!1),i(n)?(f=i(o).style.height,i(o).style.height=l):i(o).style.height=f)}function c(){i(o)&&(b(a,!i(a)),i(a)?(l=i(o).style.height,i(o).style.height="100%"):i(o).style.height=l)}var S=Ja(),g=k(S);q(g,()=>pt,(C,m)=>{m(C,{class:"h-full w-full gap-0 rounded-none py-0 pt-0 pb-0",children:(h,p)=>{var v=Wa(),y=x(v);q(y,()=>Ti,(D,N)=>{N(D,{class:"pt-2",children:(E,R)=>{var U=Ga(),T=L(k(U),2),V=k(T);{var B=Y=>{De(Y,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:c,children:(oe,ce)=>{var j=P(),ne=x(j);{var z=ge=>{Zi(ge,{class:"text-primary"})},ee=ge=>{Ki(ge,{class:"text-primary"})};M(ne,ge=>{i(a)?ge(z):ge(ee,!1)})}u(oe,j)},$$slots:{default:!0}})};M(V,Y=>{i(n)&&Y(B)})}var J=L(V,2);De(J,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:d,children:(Y,oe)=>{var ce=P(),j=x(ce);{var ne=ee=>{Xi(ee,{class:"text-primary"})},z=ee=>{Pi(ee,{class:"text-primary"})};M(j,ee=>{i(n)?ee(z,!1):ee(ne)})}u(Y,ce)},$$slots:{default:!0}}),I(T),I(U),u(E,U)},$$slots:{default:!0}})});var w=L(y,2);{var _=D=>{var N=P(),E=x(N);q(E,()=>yt,(R,U)=>{U(R,{class:"h-full min-h-[10px] w-full p-0",children:(T,V)=>{var B=P(),J=x(B);ae(J,()=>e.children??Z),u(T,B)},$$slots:{default:!0}})}),u(D,N)};M(w,D=>{i(n)&&D(_)})}u(h,v)},$$slots:{default:!0}})}),I(S),Oe(S,C=>b(o,C),()=>i(o)),u(s,S),W()}class Qa{#e;#t;#r=A(!1);#n=H(()=>this.#e.exportSnapshot());#i=H(()=>{const e=new ze;for(const[t,r]of this.#t.dataSelections)e.set(t,{layerId:r.layerId,selectedFieldIds:r.selectedFieldIds});return e});constructor(e,t){this.#e=e,this.#t=t,Tr(()=>{$(()=>{console.log("[selection-tracking-store] Detected area selection change"),(async()=>{if(!i(this.#r)){console.log("[selection-tracking-store] Initial load not complete, skipping area selection effect");return}if(i(this.#n)){if(!i(this.#n).layerId){await et({areas:null});return}if(!i(this.#n).selectedAreaIds.size){await et({areas:null});return}await et({areas:i(this.#n)}),console.log("[selection-tracking-store] Area selection updated:",Ct(i(this.#n)))}})()}),$(()=>{console.log("[selection-tracking-store] Detected data selection change"),(async()=>{if(!i(this.#r)){console.log("[selection-tracking-store] Initial load not complete, skipping data selection effect");return}if(!i(this.#i)||i(this.#i).size===0){console.log("[selection-tracking-store] No data selections, clearing in database"),await et({data:[]});return}await et({data:i(this.#i).values().toArray()}),console.log("[selection-tracking-store] Data selection updated:",Ct(i(this.#i)))})()})})}async loadSelections(){const e=await cr();if(!e){console.log("[selection-tracking-store] No existing selection found in database"),b(this.#r,!0);return}console.log("[selection-tracking-store] Loaded selection from database:",e),e.areas&&(this.#e.setLayerId(e.areas.layerId),console.log("[selection-tracking-store] (loadSelections) Restoring selected area IDs:",Array.from(e.areas.selectedAreaIds),"layer ID:",this.#e.layerId),this.#e.addSelectedAreas(Array.from(e.areas.selectedAreaIds))),e.data.forEach(t=>{this.#t.addSelection(t)}),b(this.#r,!0)}}var Xa=F("<!> <!>",1),Ka=F('<p class="p-4 text-center text-sm text-gray-500">Download service is not available.</p>'),Za=F("<div><!></div> <div><!></div> <div><!></div> <div><!></div>",1),$a=F("<div><!></div>"),eo=F('<p class="p-4 text-center text-sm text-gray-500">AI UPRN Chatbot service is not available.</p>'),to=F('<div class="relative flex h-full w-full min-w-0 flex-col overflow-visible"><!> <!> <!> <!></div>'),ro=F("<!> <!> <!> <!>",1);function as(s,e){G(e,!0);let t,r,n;const a=K(new jn),o=K(new Un);let l=A("define-areas"),f=K(new Vn),d=K(new fi),c=A(null),S=K(new Qa(d,f)),g=A(null),C=A(void 0),m=A(void 0),h=A(void 0),p=A(void 0),v=A(void 0),y=A(!1),w=A(!1),_=A(K(new Set)),D=A(K(new Set)),N=A(!0),E=K(Ht.LEFT);K(Ht.BOTTOM);let R=A(K([])),U=A(K(typeof window<"u"?window.innerWidth:1280)),T=H(()=>B(i(R),O=>O.originalSize)),V=H(()=>B(i(R),O=>O.minSize));function B(O,te){if(!O||O.length===0)return;const X=[...O].sort((he,Le)=>Le.breakpoint-he.breakpoint).find(he=>i(U)>=he.breakpoint);return X?te(X):"0"}function J(){b(N,!i(N))}function Y(O){b(l,O,!0)}function oe(){b(l,"downloads")}function ce(){d.clearSelectedAreas(),f.clearSelections(),t?.clearSelections(),r?.clearSelections(),xn()}it(async()=>{b(h,new Ba,!0),await i(h).init(`${gi}/custom-renderers.json`),console.log("[uprn-2/page] CustomRendererService initialized");const O=await Ai();await S.loadSelections();const[{default:te}]=await Promise.all([tt(()=>import("../chunks/M4qysLGv.js").then(X=>X.a2),__vite__mapDeps([28,1,2,3,5,29,30,18,31,16,6,7,32,8,9,15,20,33,34,11,17,35,25,36,37,38,19,39,40,41,42,43,0,4,10,12,13,14,21,22,23,24,26,27,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65]),import.meta.url)]);b(g,new te,!0),b(c,new vi(d,new sr(i(g))),!0),b(D,new Set((O.serviceUprn2Config.selectionLayersNameFields||[]).map(X=>X.layerName)),!0),i(c).setFieldInfos(O.serviceUprn2Config.selectionLayersNameFields||[]),b(R,O.serviceUprn2Config.mainSidebarSizes||[],!0),b(C,new Kt(O.serviceUprn2Config.dataSelectionTreeviewConfig),!0),b(m,new Kt(O.serviceUprn2Config.areaSelectionTreeviewConfig),!0),(async()=>{const X=O.serviceUprn2Config.uprnDownloadServiceEndpoints,he=O.serviceUprn2Config.aiUprnChatbotServiceEndpoints;b(p,new Ua(X),!0),b(v,new ja(he),!0),b(y,await i(p).getHealth(),!0),i(y)?console.log("[uprn-2/page] UPRN Download Service is available"):console.warn("[uprn-2/page] UPRN Download Service is NOT available"),b(w,await i(v).getHealth(),!0),i(w)?console.log("[uprn-2/page] AI UPRN Chatbot Service is available"):console.warn("[uprn-2/page] AI UPRN Chatbot Service is NOT available")})(),b(_,new Set(O.serviceUprn2Config.dataSelectionTreeviewConfig?.fieldsToHide||[]),!0),await a.initializeAsync({portalUrl:O.serviceUprn2Config.portalUrl,itemId:O.serviceUprn2Config.portalItemId||"",proxy:O.serviceUprn2Config.proxy})}),it(()=>{const O=()=>{b(U,window.innerWidth,!0)};return window.addEventListener("resize",O),()=>{window.removeEventListener("resize",O)}}),er(()=>{f.cleanup()});var j=ro(),ne=x(j);Zr(ne,{});var z=L(ne,2);da(z,{get dataSelectionStore(){return f},get fieldFilterMenuStore(){return o},get fieldsToHide(){return i(_)}});var ee=L(z,2);{var ge=O=>{var te=Xa(),ve=x(te);rn(ve,{get areaSelectionInteractionStore(){return i(c)}});var X=L(ve,2);nn(X,{get areaSelectionInteractionStore(){return i(c)}}),u(O,te)};M(ee,O=>{i(c)&&O(ge)})}var ue=L(ee,2);{const O=ve=>{var X=to(),he=k(X);q(he,()=>Gi,(me,_e)=>{_e(me,{children:(se,xe)=>{za(se,{get value(){return i(l)},get triggers(){return Ha},onValueChange:Y})},$$slots:{default:!0}})});var Le=L(he,2);q(Le,()=>hi,(me,_e)=>{_e(me,{children:(se,xe)=>{var we=Za(),Se=x(we),Ce=k(Se);gt(Ce,{children:(Me,lt)=>{var Ie=P(),Ve=x(Ie);{var Ee=ye=>{Oe(_a(ye,{get webMap(){return a.data},get treeviewConfigStore(){return i(m)},get areaSelectionStore(){return d}}),ke=>t=ke,()=>t)};M(Ve,ye=>{a.isLoaded&&ye(Ee)})}u(Me,Ie)}}),I(Se);var le=L(Se,2),fe=k(le);gt(fe,{children:(Me,lt)=>{var Ie=P(),Ve=x(Ie);{var Ee=ye=>{{let ke=H(()=>n?.getLayerViewProvider());Oe(Ta(ye,{get webMap(){return a.data},get dataSelectionStore(){return f},get layerViewProvider(){return i(ke)},get treeviewConfigStore(){return i(C)},get customRendererService(){return i(h)},get fieldFilterMenuStore(){return o}}),Ze=>r=Ze,()=>r)}};M(Ve,ye=>{a.isLoaded&&ye(Ee)})}u(Me,Ie)}}),I(le);var pe=L(le,2),Fe=k(pe);gt(Fe,{children:(Me,lt)=>{var Ie=P(),Ve=x(Ie);{var Ee=ye=>{Zn(ye,{get webMapStore(){return a},get areaSelectionInteractionStore(){return i(c)},get dataSelectionStore(){return f},get dataSelectionTreeviewConfig(){return i(C)},get fieldFilterMenuStore(){return o}})};M(Ve,ye=>{i(c)&&a.isLoaded&&ye(Ee)})}u(Me,Ie)}}),I(pe);var Pe=L(pe,2),Ke=k(Pe);gt(Ke,{children:(Me,lt)=>{var Ie=P(),Ve=x(Ie);{var Ee=ke=>{var Ze=Ka();u(ke,Ze)},ye=ke=>{On(ke,{get webMapStore(){return a},get uprnDownloadService(){return i(p)},get fieldsToHide(){return i(_)}})};M(Ve,ke=>{!i(p)||!i(y)?ke(Ee):ke(ye,!1)})}u(Me,Ie)}}),I(Pe),de(()=>{Se.hidden=i(l)!=="define-areas",le.hidden=i(l)!=="select-data",pe.hidden=i(l)!=="export",Pe.hidden=i(l)!=="downloads"}),u(se,we)},$$slots:{default:!0}})});var be=L(Le,2);q(be,()=>Ji,(me,_e)=>{_e(me,{children:(se,xe)=>{var we=$a(),Se=k(we);{var Ce=le=>{Hn(le,{onExportSuccess:oe,clearSelections:ce,get areaSelectionInteractionStore(){return i(c)},get dataSelectionStore(){return f}})};M(Se,le=>{i(c)&&le(Ce)})}I(we),de(()=>we.hidden=i(l)!=="export"),u(se,we)},$$slots:{default:!0}})});var Te=L(be,2);Ya(Te,{isOpenedOnInit:!0,children:(me,_e)=>{var se=P(),xe=x(se);{var we=Ce=>{var le=eo();u(Ce,le)},Se=Ce=>{_n(Ce,{get aiUprnChatbotService(){return i(v)}})};M(xe,Ce=>{!i(v)||!i(w)?Ce(we):Ce(Se,!1)})}u(me,se)},$$slots:{default:!0}}),I(X),u(ve,X)},te=ve=>{var X=P(),he=x(X);{var Le=be=>{Oe(Ma(be,{get webMap(){return a.data},get mapView(){return i(g)},get areaSelectionInteractionStore(){return i(c)},get interactableLayers(){return i(D)}}),Te=>n=Te,()=>n)};M(he,be=>{i(c)&&be(Le)})}u(ve,X)};q(ue,()=>Li,(ve,X)=>{X(ve,{get isOpen(){return i(N)},onToggle:J,get position(){return E},get originalSize(){return i(T)},get minSize(){return i(V)},sidebarContent:O,mainContent:te,$$slots:{sidebarContent:!0,mainContent:!0}})})}u(s,j),W()}export{as as component};
