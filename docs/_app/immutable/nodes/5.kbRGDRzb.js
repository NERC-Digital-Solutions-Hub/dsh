const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/tWIlYmLc.js","../chunks/DEfw6_ef.js","../chunks/BsH20_Vs.js","../chunks/Cg-g7sfq.js","../chunks/CxlgmuS0.js","../chunks/PPVm8Dsz.js","../chunks/CbSHxjnO.js","../chunks/CuDkSQ9K.js","../chunks/H0QphIdm.js","../chunks/CYlsogSb.js","../chunks/DiDKkOPS.js","../chunks/CupCqN7H.js","../chunks/XDfhPTz9.js","../chunks/i1FBtECX.js","../chunks/DEofI9xF.js","../chunks/CXxgNwmb.js","../chunks/BvZUr92_.js","../chunks/ClNG7cqw.js","../chunks/CpmMRAq-.js","../chunks/Cp_8tW2x.js","../chunks/BsdKzw5M.js","../chunks/C_0-aHjr.js","../chunks/Ci6C1k20.js","../chunks/bnayRBMH.js","../chunks/62qj6Kpw.js","../chunks/CErz6YiP.js","../chunks/GBH_ff3h.js","../chunks/Oe6SV2kF.js","../chunks/CTb2irFk.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/3slrYEkV.js","../chunks/D0AGBp4m.js","../chunks/BXgHj_R5.js","../chunks/v-Ii51UH.js","../chunks/FGXSRGVg.js","../chunks/C0i3V7C8.js","../chunks/Djp3mnm5.js","../chunks/DKyYFRGo.js","../chunks/DYawoE1a.js","../chunks/DBuKqDYo.js","../chunks/B48eeFnl.js","../chunks/BYatnZGe.js","../chunks/B87vTgcy.js","../chunks/6L2SN8qu.js","../chunks/CVfonb79.js","../chunks/wCjEFJCX.js","../chunks/D3qbIiMo.js","../chunks/Bc4mpJhY.js","../chunks/DQaHheF0.js","../chunks/DV4r8n6I.js","../chunks/B2U_oPpb.js","../chunks/CNDan-Rx.js","../chunks/DGDScQxG.js","../chunks/CVwTD0fV.js","../chunks/D2jIvlkk.js","../chunks/Bwyp3dnI.js","../chunks/DPJXGPFY.js","../chunks/ExwrXyXn.js","../chunks/BGpT5vjv.js","../chunks/q_b6UJoq.js","../chunks/ktuqrY34.js","../chunks/Ctgqef5D.js","../chunks/CMiA3YQc.js","../chunks/DS9C8gJc.js","../chunks/fHzmurrr.js","../chunks/WNRSLWWh.js","../chunks/D7sjVwUC.js","../chunks/DvKU1K2H.js","../chunks/BlOilgcx.js","../assets/index.CQED0rIl.css","../chunks/DqbAVxMv.js","../chunks/B_nYcLPE.js","../chunks/Dsdk2tBG.js","../chunks/Cs8pR8So.js","../chunks/BgGtT-vP.js","../chunks/Bdxq8yCu.js","../chunks/DrKQjMrE.js","../chunks/DzMNFj8U.js","../chunks/Cgb6qxNH.js","../chunks/Bz66wGT9.js","../chunks/Bc6r6iEs.js","../chunks/F0BUsLjt.js","../chunks/CnMVBO6H.js","../chunks/D_njKkhs.js","../chunks/CaVKkSa6.js","../chunks/lHHrw-Fy.js","../chunks/B8u0uflR.js","../chunks/B1N-tmtC.js","../chunks/DfmE7muS.js","../chunks/CawG38_V.js","../chunks/D-qJO60r.js","../chunks/QQC62dOK.js","../chunks/Bxxl7NsE.js","../chunks/B2f5VqqG.js","../chunks/DQOO6RKE.js","../chunks/B-bZALxR.js","../chunks/Bi6C4OG6.js","../chunks/CJXkYEXo.js","../chunks/D-YQ4CHs.js","../chunks/CVaFVXl_.js","../chunks/DmBOxXOl.js","../chunks/DRBpbFTt.js","../chunks/CIVnWVW-.js","../chunks/l8ODxJLy.js","../chunks/BXmoyKZo.js","../chunks/kwrskX6P.js","../chunks/CSXZNpHb.js","../chunks/B5sfERVE.js","../chunks/DYatL6-0.js","../chunks/SKHDfhet.js","../chunks/x-rwtYAj.js","../chunks/CnMl1gv8.js","../chunks/S1-2yIgm.js","../chunks/_Pe164bs.js","../chunks/CuL02vTr.js","../chunks/DgVWghap.js","../chunks/-RG-nG9T.js","../chunks/fsKfK0sy.js","../chunks/DQbAsBwU.js","../chunks/spAbxKnx.js","../chunks/CX3ZFNfL.js","../chunks/BmF0IJ7E.js","../chunks/36uNJNa5.js","../chunks/CEKE62pQ.js","../chunks/B5qWImIY.js","../chunks/CiTlTuUs.js","../chunks/CNS1QZY8.js","../chunks/CbFgluc7.js","../chunks/B5Hsb4hi.js","../chunks/C0kKYzrM.js","../chunks/kRFlM29_.js","../chunks/CzKZmtx0.js","../chunks/DLaSncW_.js","../chunks/ByqZcsO_.js","../chunks/4JtatMd6.js","../chunks/rk55UWB4.js","../chunks/queAb42C.js","../chunks/B6ZUGniA.js","../chunks/Dlz37zDM.js","../chunks/GKolV7NZ.js","../chunks/BBdCmBkR.js","../chunks/vZpAfLDx.js","../chunks/x3RVuiyh.js","../chunks/88DWifGA.js","../chunks/Bmgo1H0I.js","../chunks/8AGV1qtY.js","../chunks/92klRbLe.js","../chunks/DJbTxK2-.js","../chunks/ggylUvPH.js","../chunks/Cto6YqlL.js","../chunks/DhzudQro.js","../chunks/BNpAlv8J.js","../chunks/BeANzU7s.js","../chunks/B_Z9OVhx.js","../chunks/DJ9aDd4R.js","../chunks/DKwqxe3-.js","../chunks/D8ujzhvG.js","../chunks/BZQvkt3k.js","../chunks/DLLlF3RK.js","../chunks/Dt79-m9U.js","../chunks/CcIpjlrY.js","../chunks/m4Bs3uz7.js","../chunks/B5rM3F5M.js","../chunks/JCteah4Q.js","../chunks/qyF9FwQ9.js","../chunks/XI-Li77m.js","../chunks/BmnLPdqE.js","../chunks/BTIdS9sW.js","../chunks/DPb6J-GU.js","../chunks/CEe-6-vO.js","../chunks/wviEkgi6.js","../chunks/LY0Drczk.js","../chunks/CKHFt-LJ.js","../chunks/CHyjlL6-.js","../chunks/BfrB-kUx.js","../chunks/DzoO0ETS.js","../chunks/noHA0x_k.js","../chunks/CxJOUKnC.js","../chunks/BJ6k9N22.js","../chunks/DOTCkzsN.js","../chunks/HwIixIZ0.js","../chunks/DVPBzQS7.js","../chunks/0vDwWQHq.js","../chunks/WnwY1cq9.js","../chunks/BZA5O26k.js","../chunks/CaYZrGFV.js"])))=>i.map(i=>d[i]);
import{_ as Vr}from"../chunks/PPVm8Dsz.js";import"../chunks/DsnmJJEf.js";import{o as Rr,a as ya}from"../chunks/CsvHgo6E.js";import{d as lo,E as co,b9 as uo,ba as fo,K as ho,A as vo,bb as po,bc as go,bd as mo,Z as ba,as as yo,M as bo,n as Ke,X as Ce,F as c,ar as B,p as De,f as Z,a as Ne,c as ee,r as X,aG as ne,ax as Re,y as je,t as ct,a8 as ue,l as ur,b8 as wa}from"../chunks/C2G-U2Rp.js";import{p as wo,c as de,a as T,f as ae,t as wr}from"../chunks/Bw9dopYk.js";import{p as Ve,i as ve,r as Tt,s as Rt,l as _a}from"../chunks/BwRR2sz5.js";import{c as Oe}from"../chunks/YPopVK-T.js";import{b as Lt}from"../chunks/Ck-qfSU1.js";import{b as _o,s as Ct}from"../chunks/VHBl3xBG.js";import{a as Sn,e as xn,s as hi,b as vi,f as So}from"../chunks/P7z0ujPM.js";import{C as In}from"../chunks/RFbR4QUt.js";import{C as kn}from"../chunks/DHKFkDmX.js";import{t as Mr,k as xo,l as Io,L as ko,m as Co,S as Ft,h as Ao,i as Po,C as Ji,j as Oo,I as Eo,G as Qi,F as Xi,b as Fo,O as Sa,a as To,d as xa,c as hn,n as Do,p as No,M as Vo,V as $i,e as Lo,f as Ro,g as Mo,o as jo}from"../chunks/DnwXDgRb.js";import{s as Ze,e as qt,i as _r}from"../chunks/DDY_L61N.js";import{e as Ho,f as Cn}from"../chunks/B7MCGzuW.js";import{c as Kr,B as Nt}from"../chunks/B-p-siuQ.js";import{C as Ko,D as qo,k as Bo,l as zo,g as Uo,a as vn,m as Go}from"../chunks/Dywrsv9N.js";import{I as xr}from"../chunks/Ctr-s97A.js";import{I as Wo}from"../chunks/B5JPQk27.js";import{S as Yo,I as Ia,s as ka}from"../chunks/ByBLjScv.js";import{S as Jo,C as Qo}from"../chunks/BH_a3QLS.js";import{S as wt}from"../chunks/BbM6OCzS.js";import{c as Xo,g as $o}from"../chunks/Cpj98o6Y.js";import"../chunks/B46RYxSG.js";import{b as Zo}from"../chunks/Gfo-GZxB.js";import"../chunks/B17Q6ahh.js";import"../chunks/69_IOA4Y.js";import{s as ai,f as es,g as ts,h as rs,i as ns}from"../chunks/BODOddys.js";import{b as is}from"../chunks/CVaFVXl_.js";import as from"../chunks/ClNG7cqw.js";import{s as Zi}from"../chunks/BsH20_Vs.js";import{O as os}from"../chunks/CuDkSQ9K.js";import{h as jr}from"../chunks/Dn9W2mAS.js";import{X as ss,a as ls,b as cs,C as us,g as ds}from"../chunks/2odzE28I.js";import{b as ea}from"../chunks/CXxgNwmb.js";import"../chunks/CgiVD3Wm.js";import{l as fs}from"../chunks/CYlsogSb.js";import ta from"../chunks/kwrskX6P.js";import"../chunks/Cg-g7sfq.js";import"../chunks/DEfw6_ef.js";import"../chunks/bnayRBMH.js";import"../chunks/B5qWImIY.js";import"../chunks/CiTlTuUs.js";import"../chunks/kRFlM29_.js";import"../chunks/CNDan-Rx.js";import"../chunks/Bdxq8yCu.js";import{d as hs}from"../chunks/C8hn-AFl.js";import{c as vs}from"../chunks/DjSD7d6X.js";import{a as ra,S as ps}from"../chunks/D0uXYRFJ.js";import{S as gs}from"../chunks/DjsiyCSJ.js";import"../chunks/DLaSncW_.js";import{j as na}from"../chunks/DKwqxe3-.js";import{p as ia}from"../chunks/CzKZmtx0.js";import{a as aa,m as oa}from"../chunks/Bwyp3dnI.js";import{u as pn}from"../chunks/C_0-aHjr.js";import{C as ms}from"../chunks/BgLEWwdJ.js";import{C as ys}from"../chunks/4TVPsGnO.js";const bs=()=>performance.now(),Wt={tick:k=>requestAnimationFrame(k),now:()=>bs(),tasks:new Set};function Ca(){const k=Wt.now();Wt.tasks.forEach(t=>{t.c(k)||(Wt.tasks.delete(t),t.f())}),Wt.tasks.size!==0&&Wt.tick(Ca)}function ws(k){let t;return Wt.tasks.size===0&&Wt.tick(Ca),{promise:new Promise(a=>{Wt.tasks.add(t={c:k,f:a})}),abort(){Wt.tasks.delete(t)}}}function gn(k,t){ba(()=>{k.dispatchEvent(new CustomEvent(t))})}function _s(k){if(k==="float")return"cssFloat";if(k==="offset")return"cssOffset";if(k.startsWith("--"))return k;const t=k.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function sa(k){const t={},a=k.split(";");for(const s of a){const[u,f]=s.split(":");if(!u||f===void 0)break;const h=_s(u.trim());t[h]=f.trim()}return t}const Ss=k=>k;function wn(k,t,a,s){var u=(k&go)!==0,f=(k&mo)!==0,h=u&&f,b=(k&po)!==0,P=h?"both":u?"in":"out",A,E=t.inert,V=t.style.overflow,D,W;function M(){return ba(()=>A??=a()(t,s?.()??{},{direction:P}))}var L={is_global:b,in(){if(t.inert=E,!u){W?.abort(),W?.reset?.();return}f||D?.abort(),gn(t,"introstart"),D=oi(t,M(),W,1,()=>{gn(t,"introend"),D?.abort(),D=A=void 0,t.style.overflow=V})},out(j){if(!f){j?.(),A=void 0;return}t.inert=!0,gn(t,"outrostart"),W=oi(t,M(),D,0,()=>{gn(t,"outroend"),j?.()})},stop:()=>{D?.abort(),W?.abort()}},K=lo;if((K.transitions??=[]).push(L),u&&_o){var N=b;if(!N){for(var H=K.parent;H&&(H.f&co)!==0;)for(;(H=H.parent)&&(H.f&uo)===0;);N=!H||(H.f&fo)!==0}N&&ho(()=>{vo(()=>L.in())})}}function oi(k,t,a,s,u){var f=s===1;if(yo(t)){var h,b=!1;return bo(()=>{if(!b){var K=t({direction:f?"in":"out"});h=oi(k,K,a,s,u)}}),{abort:()=>{b=!0,h?.abort()},deactivate:()=>h.deactivate(),reset:()=>h.reset(),t:()=>h.t()}}if(a?.deactivate(),!t?.duration)return u(),{abort:Ke,deactivate:Ke,reset:Ke,t:()=>s};const{delay:P=0,css:A,tick:E,easing:V=Ss}=t;var D=[];if(f&&a===void 0&&(E&&E(0,1),A)){var W=sa(A(0,1));D.push(W,W)}var M=()=>1-s,L=k.animate(D,{duration:P,fill:"forwards"});return L.onfinish=()=>{L.cancel();var K=a?.t()??1-s;a?.abort();var N=s-K,H=t.duration*Math.abs(N),j=[];if(H>0){var U=!1;if(A)for(var le=Math.ceil(H/16.666666666666668),te=0;te<=le;te+=1){var oe=K+N*V(te/le),he=sa(A(oe,1-oe));j.push(he),U||=he.overflow==="hidden"}U&&(k.style.overflow="hidden"),M=()=>{var Ie=L.currentTime;return K+N*V(Ie/H)},E&&ws(()=>{if(L.playState!=="running")return!1;var Ie=M();return E(Ie,1-Ie),!0})}L=k.animate(j,{duration:H,fill:"forwards"}),L.onfinish=()=>{M=()=>s,E?.(s,1-s),u()}},{abort:()=>{L&&(L.cancel(),L.effect=null,L.onfinish=Ke)},deactivate:()=>{u=Ke},reset:()=>{s===0&&E?.(1,0)},t:()=>M()}}const xs=zo({component:"avatar",parts:["root","image","fallback"]}),Is=new Ko("Avatar.Root");class pi{static create(t){return Is.set(new pi(t))}opts;domContext;attachment;constructor(t){this.opts=t,this.domContext=new qo(this.opts.ref),this.loadImage=this.loadImage.bind(this),this.attachment=Bo(this.opts.ref)}loadImage(t,a,s){if(this.opts.loadingStatus.current==="loaded")return;let u;const f=new Image;return f.src=t,a!==void 0&&(f.crossOrigin=a),s&&(f.referrerPolicy=s),this.opts.loadingStatus.current="loading",f.onload=()=>{u=this.domContext.setTimeout(()=>{this.opts.loadingStatus.current="loaded"},this.opts.delayMs.current)},f.onerror=()=>{this.opts.loadingStatus.current="error"},()=>{u&&this.domContext.clearTimeout(u)}}#e=Ce(()=>({id:this.opts.id.current,[xs.root]:"","data-status":this.opts.loadingStatus.current,...this.attachment}));get props(){return c(this.#e)}set props(t){B(this.#e,t)}}var ks=ae("<div><!></div>");function Cs(k,t){const a=wo();De(t,!0);let s=Ve(t,"delayMs",3,0),u=Ve(t,"loadingStatus",15,"loading"),f=Ve(t,"id",19,()=>Uo(a)),h=Ve(t,"ref",15,null),b=Tt(t,["$$slots","$$events","$$legacy","delayMs","loadingStatus","onLoadingStatusChange","child","children","id","ref"]);const P=pi.create({delayMs:vn(()=>s()),loadingStatus:vn(()=>u(),M=>{u()!==M&&(u(M),t.onLoadingStatusChange?.(M))}),id:vn(()=>f()),ref:vn(()=>h(),M=>h(M))}),A=Ce(()=>Go(b,P.props));var E=de(),V=Z(E);{var D=M=>{var L=de(),K=Z(L);Ze(K,()=>t.child,()=>({props:c(A)})),T(M,L)},W=M=>{var L=ks();Sn(L,()=>({...c(A)}));var K=ee(L);Ze(K,()=>t.children??Ke),X(L),T(M,L)};ve(V,M=>{t.child?M(D):M(W,!1)})}T(k,E),Ne()}var As=ae('<p class="text-sm font-medium"> </p>'),Ps=ae('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function Os(k,t){De(t,!0);let a=ne(null),s=ne(Re({x:0,y:0})),u=0;const f=A=>{B(s,{x:A.clientX,y:A.clientY},!0)};je(()=>(document.addEventListener("mousemove",f),()=>{document.removeEventListener("mousemove",f)})),je(()=>{const A=t.areaSelectionInteractionStore.currentHoveredArea?.id,E=++u;if(!A){B(a,null);return}(async()=>{const V=await t.areaSelectionInteractionStore.getAreaNamesById([A]);E===u&&t.areaSelectionInteractionStore.currentHoveredArea?.id===A&&B(a,V[0]??null,!0)})()});var h=de(),b=Z(h);{var P=A=>{var E=Ps(),V=ee(E);Oe(V,()=>In,(D,W)=>{W(D,{class:"max-w-xs border !py-2 shadow-lg",children:(M,L)=>{var K=de(),N=Z(K);Oe(N,()=>kn,(H,j)=>{j(H,{class:"!px-3 !py-0",children:(U,le)=>{var te=As(),oe=ee(te,!0);X(te),ct(()=>Ct(oe,c(a))),T(U,te)},$$slots:{default:!0}})}),T(M,K)},$$slots:{default:!0}})}),X(E),ct(()=>xn(E,`left: ${c(s).x+10}px; top: ${c(s).y-10}px;`)),T(A,E)};ve(b,A=>{c(a)&&A(P)})}T(k,h),Ne()}function Es(k,t){De(t,!0);async function a(s,u){const f=await t.areaSelectionInteractionStore.getAreaNamesById([s]);if(!f||f.length===0||!f[0])return;const h=`Area ${u}: ${f[0]}`;Mr.success(h)}je(()=>{t.areaSelectionInteractionStore.lastAddedArea&&a(t.areaSelectionInteractionStore.lastAddedArea.id,"added")}),je(()=>{t.areaSelectionInteractionStore.lastRemovedArea&&a(t.areaSelectionInteractionStore.lastRemovedArea.id,"removed")}),Ne()}var Fs=ae("<div><!></div>");function la(k,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Tt(t,["$$slots","$$events","$$legacy","ref","variant","children"]);var u=Fs();Sn(u,()=>({...s,class:"group/chat-bubble flex max-w-[80%] flex-row place-items-end gap-2 data-[variant='sent']:place-self-end","data-variant":t.variant}));var f=ee(u);Ze(f,()=>t.children??Ke),X(u),Lt(u,h=>a(h),()=>a()),T(k,u),Ne()}var Ts=ae('<span class="inline-block size-(--loading-dots-size) rounded-full bg-primary svelte-k2x6sv"></span>'),Ds=ae('<div class="inline-flex items-center gap-1 svelte-k2x6sv"></div>');function Ns(k,t){let a=Ve(t,"size",3,4);var s=Ds();let u;qt(s,20,()=>({length:3}),_r,(f,h)=>{var b=Ts();T(f,b)}),X(s),ct(f=>u=xn(s,"",u,f),[()=>({"--loading-dots-size":`${a()??""}px`})]),T(k,s)}var Vs=ae('<div class="flex size-full place-items-center justify-center"><!></div>'),Ls=ae("<div><!></div>");function ii(k,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Ve(t,"typing",3,!1),u=Tt(t,["$$slots","$$events","$$legacy","ref","typing","class","children"]);var f=Ls();Sn(f,A=>({...u,class:A}),[()=>Kr("order-2 rounded-lg bg-secondary p-4 text-sm group-data-[variant='received']/chat-bubble:rounded-bl-none group-data-[variant='sent']/chat-bubble:order-1 group-data-[variant='sent']/chat-bubble:rounded-br-none group-data-[variant='sent']/chat-bubble:bg-primary group-data-[variant='sent']/chat-bubble:text-primary-foreground",t.class)]);var h=ee(f);{var b=A=>{var E=Vs(),V=ee(E);Ns(V,{}),X(E),T(A,E)},P=A=>{var E=de(),V=Z(E);Ze(V,()=>t.children??Ke),T(A,E)};ve(h,A=>{s()?A(b):A(P,!1)})}X(f),Lt(f,A=>a(A),()=>a()),T(k,f),Ne()}function Rs(k,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Tt(t,["$$slots","$$events","$$legacy","ref","class"]);var u=de(),f=Z(u);{let h=Ce(()=>Kr("relative flex size-8 shrink-0 overflow-hidden rounded-full",t.class));Oe(f,()=>Cs,(b,P)=>{P(b,Rt({"data-slot":"avatar",get class(){return c(h)}},()=>s,{get ref(){return a()},set ref(A){a(A)}}))})}T(k,u),Ne()}function ca(k,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Tt(t,["$$slots","$$events","$$legacy","ref","class"]);{let u=Ce(()=>Kr("order-1 group-data-[variant='sent']/chat-bubble:order-2",t.class));Rs(k,Rt({get class(){return c(u)}},()=>s,{get ref(){return a()},set ref(f){a(f)}}))}Ne()}function Ms(k,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];xr(k,Rt({name:"arrow-down"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=de(),b=Z(h);Ze(b,()=>t.children??Ke),T(u,h)},$$slots:{default:!0}})),Ne()}function Aa(k){const t=k-1;return t*t*t+1}function ua(k,{delay:t=0,duration:a=400,easing:s=Aa,axis:u="y"}={}){const f=getComputedStyle(k),h=+f.opacity,b=u==="y"?"height":"width",P=parseFloat(f[b]),A=u==="y"?["top","bottom"]:["left","right"],E=A.map(N=>`${N[0].toUpperCase()}${N.slice(1)}`),V=parseFloat(f[`padding${E[0]}`]),D=parseFloat(f[`padding${E[1]}`]),W=parseFloat(f[`margin${E[0]}`]),M=parseFloat(f[`margin${E[1]}`]),L=parseFloat(f[`border${E[0]}Width`]),K=parseFloat(f[`border${E[1]}Width`]);return{delay:t,duration:a,easing:s,css:N=>`overflow: hidden;opacity: ${Math.min(N*20,1)*h};${b}: ${N*P}px;padding-${A[0]}: ${N*V}px;padding-${A[1]}: ${N*D}px;margin-${A[0]}: ${N*W}px;margin-${A[1]}: ${N*M}px;border-${A[0]}-width: ${N*L}px;border-${A[1]}-width: ${N*K}px;min-${b}: 0`}}function da(k,{delay:t=0,duration:a=400,easing:s=Aa,start:u=0,opacity:f=0}={}){const h=getComputedStyle(k),b=+h.opacity,P=h.transform==="none"?"":h.transform,A=1-u,E=b*(1-f);return{delay:t,duration:a,easing:s,css:(V,D)=>`
			transform: ${P} scale(${1-A*D});
			opacity: ${b-E*D}
		`}}class js{#e=ne();#t=ne(0);#r=ne(!1);lastScrollHeight=0;set ref(t){if(B(this.#e,t,!0),!c(this.#e))return;this.lastScrollHeight=c(this.#e).scrollHeight,c(this.#e).scrollTo(0,c(this.#t)?c(this.#t):c(this.#e).scrollHeight),c(this.#e).addEventListener("scroll",()=>{c(this.#e)&&(B(this.#t,c(this.#e).scrollTop,!0),this.disableAutoScroll())}),window.addEventListener("resize",()=>{this.scrollToBottom(!0)}),new MutationObserver(()=>{c(this.#e)&&(c(this.#e).scrollHeight!==this.lastScrollHeight&&this.scrollToBottom(!0),this.lastScrollHeight=c(this.#e).scrollHeight)}).observe(c(this.#e),{childList:!0,subtree:!0})}get ref(){return c(this.#e)}get scrollY(){return c(this.#t)}get isAtBottom(){return c(this.#e)?c(this.#t)+c(this.#e).offsetHeight>=c(this.#e).scrollHeight:!0}disableAutoScroll(){this.isAtBottom?B(this.#r,!1):B(this.#r,!0)}scrollToBottom(t=!1){c(this.#e)&&(t&&c(this.#r)||c(this.#e).scrollTo(0,c(this.#e).scrollHeight))}}var Hs=ae("<div><!></div>"),Ks=ae('<div class="relative"><div><!></div> <!></div>');function qs(k,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Tt(t,["$$slots","$$events","$$legacy","ref","children","class"]),u=ne(!1);const f=new js;Rr(()=>{B(u,!0)});var h=Ks(),b=ee(h);Sn(b,V=>({...s,class:V}),[()=>Kr("no-scrollbar flex h-full w-full flex-col gap-4 overflow-y-auto p-4",t.class,{"scroll-smooth":c(u)})]);var P=ee(b);Ze(P,()=>t.children??Ke),X(b),Lt(b,V=>a(V),()=>a()),Lt(b,V=>f.ref=V,()=>f?.ref);var A=ue(b,2);{var E=V=>{var D=Hs(),W=ee(D);Nt(W,{onclick:()=>f.scrollToBottom(),variant:"outline",size:"icon",class:"absolute bottom-2 left-1/2 inline-flex -translate-x-1/2 transform rounded-full shadow-md",children:(M,L)=>{Ms(M,{})},$$slots:{default:!0}}),X(D),wn(1,D,()=>da,()=>({start:.85,duration:100,delay:250})),wn(2,D,()=>da,()=>({start:.85,duration:100})),T(V,D)};ve(A,V=>{f.isAtBottom||V(E)})}X(h),T(k,h),Ne()}function Bs(k,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];xr(k,Rt({name:"send"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=de(),b=Z(h);Ze(b,()=>t.children??Ke),T(u,h)},$$slots:{default:!0}})),Ne()}var zs=ae(`<p class="break-words whitespace-pre-wrap"> </p> <div class="w-full text-xs group-data-[variant='sent']/chat-bubble:text-end"> </div>`,1),Us=ae("<!> <!>",1),Gs=ae('<p class="break-words whitespace-pre-wrap"> </p>'),Ws=ae("<!> <!>",1),Ys=ae("<!> <!>",1),Js=ae('<div class="chat-container h-full w-full border border-border svelte-1osgd7m"><div class="message-wrapper svelte-1osgd7m"><!></div> <div class="input-wrapper svelte-1osgd7m"><form class="flex shrink-0 items-center gap-2 border-t border-border bg-background p-2"><!> <!></form></div></div>');function Qs(k,t){De(t,!0);const a=1,s=2,u="Sorry, I encountered an error processing your request.",f="How can I help?";let h=ne(""),b=ne(!1),P=ne(""),A=ne(null),E=ne(null),V=ne(null);const D=Re([{senderId:a,message:f,sentAt:W(new Date)}]);je(()=>{if(c(E)&&c(V)){const ce=c(E),ye=c(V),Se=()=>{const Fe=ce.offsetHeight;ye.style.paddingBottom=`${Fe}px`};Se();const _e=new ResizeObserver(Se);return _e.observe(ce),()=>{_e.disconnect()}}}),je(()=>{D.length,c(P),c(A)&&setTimeout(()=>{const ce=c(A)?.querySelector('[data-slot="scroll-area-viewport"]');ce&&(ce.scrollTop=ce.scrollHeight)},0)});function W(ce){const ye=ce.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Se=ce.getHours()>=12?"PM":"AM";return`${ye} ${Se}`}function M(ce,ye){return{message:ce,senderId:ye,sentAt:W(new Date)}}function L(ce,ye){D.push(M(ce,ye))}function K(){B(b,!1),B(P,"")}function N(ce){B(P,c(P)+ce)}async function H(ce){if(ce.preventDefault(),!c(h).trim()||c(b))return;const ye=c(h).trim();B(h,""),L(ye,s),B(b,!0),B(P,"");try{await t.aiUprnChatbotService.chatStream(ye,N)&&c(P)?L(c(P),a):L(u,a)}catch(Se){console.error("Chat error:",Se),L(u,a)}finally{K()}}var j=Js(),U=ee(j),le=ee(U);Yo(le,{class:"h-full w-full",get ref(){return c(A)},set ref(ce){B(A,ce,!0)},children:(ce,ye)=>{var Se=de(),_e=Z(Se);Oe(_e,()=>qs,(Fe,Be)=>{Be(Fe,{children:(Qe,ke)=>{var Le=Ys(),ge=Z(Le);qt(ge,16,()=>D,ot=>ot,(ot,fe)=>{var Me=de(),Xe=Z(Me);{let Ae=Ce(()=>fe.senderId===s?"sent":"received");Oe(Xe,()=>la,(et,At)=>{At(et,{get variant(){return c(Ae)},children:(re,xt)=>{var tt=Us(),pe=Z(tt);Oe(pe,()=>ca,(gt,ze)=>{ze(gt,{})});var qe=ue(pe,2);Oe(qe,()=>ii,(gt,ze)=>{ze(gt,{class:"flex flex-col gap-1",children:(ut,pt)=>{var rt=zs(),st=Z(rt),lt=ee(st,!0);X(st);var Ue=ue(st,2),It=ee(Ue,!0);X(Ue),ct(()=>{Ct(lt,fe.message),Ct(It,fe.sentAt)}),T(ut,rt)},$$slots:{default:!0}})}),T(re,tt)},$$slots:{default:!0}})})}T(ot,Me)});var Ee=ue(ge,2);{var at=ot=>{var fe=de(),Me=Z(fe);Oe(Me,()=>la,(Xe,Ae)=>{Ae(Xe,{variant:"received",children:(et,At)=>{var re=Ws(),xt=Z(re);Oe(xt,()=>ca,(pe,qe)=>{qe(pe,{})});var tt=ue(xt,2);Oe(tt,()=>ii,(pe,qe)=>{qe(pe,{class:"flex flex-col gap-1",children:(gt,ze)=>{var ut=de(),pt=Z(ut);{var rt=lt=>{var Ue=Gs(),It=ee(Ue,!0);X(Ue),ct(()=>Ct(It,c(P))),T(lt,Ue)},st=lt=>{var Ue=de(),It=Z(Ue);Oe(It,()=>ii,(Vt,kt)=>{kt(Vt,{typing:!0})}),T(lt,Ue)};ve(pt,lt=>{c(P)?lt(rt):lt(st,!1)})}T(gt,ut)},$$slots:{default:!0}})}),T(et,re)},$$slots:{default:!0}})}),T(ot,fe)};ve(Ee,ot=>{c(b)&&ot(at)})}T(Qe,Le)},$$slots:{default:!0}})}),T(ce,Se)},$$slots:{default:!0}}),X(U),Lt(U,ce=>B(V,ce),()=>c(V));var te=ue(U,2),oe=ee(te),he=ee(oe);Wo(he,{class:"rounded-full",placeholder:"Type a message...",get disabled(){return c(b)},get value(){return c(h)},set value(ce){B(h,ce,!0)}});var Ie=ue(he,2);{let ce=Ce(()=>c(h).trim()===""||c(b));Nt(Ie,{type:"submit",variant:"default",size:"icon",class:"shrink-0 rounded-full",get disabled(){return c(ce)},children:(ye,Se)=>{Bs(ye,{})},$$slots:{default:!0}})}X(oe),Lt(oe,ce=>B(E,ce),()=>c(E)),X(te),X(j),Ho("submit",oe,H),T(k,j),Ne()}const er=Object.freeze({Pending:"pending",InProgress:"in-progress",Completed:"completed",Failed:"failed"}),mn=Object.freeze({Submitted:"SUBMITTED",Queued:"QUEUED",Processing:"IN_PROGRESS",Completed:"COMPLETED",Error:"ERROR"}),Xs=Object.freeze({Success:"success",Error:"error"});var bn={exports:{}},$s=bn.exports,fa;function Zs(){return fa||(fa=1,(function(k,t){(function(a,s){k.exports=s()})($s,function(){var a=function(e,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(e,r)},s=function(){return(s=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)};function u(e,r,n){for(var i,o=0,l=r.length;o<l;o++)!i&&o in r||((i=i||Array.prototype.slice.call(r,0,o))[o]=r[o]);return e.concat(i||Array.prototype.slice.call(r))}var f=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Xo,h=Object.keys,b=Array.isArray;function P(e,r){return typeof r!="object"||h(r).forEach(function(n){e[n]=r[n]}),e}typeof Promise>"u"||f.Promise||(f.Promise=Promise);var A=Object.getPrototypeOf,E={}.hasOwnProperty;function V(e,r){return E.call(e,r)}function D(e,r){typeof r=="function"&&(r=r(A(e))),(typeof Reflect>"u"?h:Reflect.ownKeys)(r).forEach(function(n){M(e,n,r[n])})}var W=Object.defineProperty;function M(e,r,n,i){W(e,r,P(n&&V(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},i))}function L(e){return{from:function(r){return e.prototype=Object.create(r.prototype),M(e.prototype,"constructor",e),{extend:D.bind(null,e.prototype)}}}}var K=Object.getOwnPropertyDescriptor,N=[].slice;function H(e,r,n){return N.call(e,r,n)}function j(e,r){return r(e)}function U(e){if(!e)throw new Error("Assertion Failed")}function le(e){f.setImmediate?setImmediate(e):setTimeout(e,0)}function te(e,r){if(typeof r=="string"&&V(e,r))return e[r];if(!r)return e;if(typeof r!="string"){for(var n=[],i=0,o=r.length;i<o;++i){var l=te(e,r[i]);n.push(l)}return n}var d=r.indexOf(".");if(d!==-1){var v=e[r.substr(0,d)];return v==null?void 0:te(v,r.substr(d+1))}}function oe(e,r,n){if(e&&r!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof r!="string"&&"length"in r){U(typeof n!="string"&&"length"in n);for(var i=0,o=r.length;i<o;++i)oe(e,r[i],n[i])}else{var l,d,v=r.indexOf(".");v!==-1?(l=r.substr(0,v),(d=r.substr(v+1))===""?n===void 0?b(e)&&!isNaN(parseInt(l))?e.splice(l,1):delete e[l]:e[l]=n:oe(v=!(v=e[l])||!V(e,l)?e[l]={}:v,d,n)):n===void 0?b(e)&&!isNaN(parseInt(r))?e.splice(r,1):delete e[r]:e[r]=n}}function he(e){var r,n={};for(r in e)V(e,r)&&(n[r]=e[r]);return n}var Ie=[].concat;function ce(e){return Ie.apply([],e)}var Ye="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ce([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(r){return r+e+"Array"})}))).filter(function(e){return f[e]}),ye=new Set(Ye.map(function(e){return f[e]})),Se=null;function _e(e){return Se=new WeakMap,e=(function r(n){if(!n||typeof n!="object")return n;var i=Se.get(n);if(i)return i;if(b(n)){i=[],Se.set(n,i);for(var o=0,l=n.length;o<l;++o)i.push(r(n[o]))}else if(ye.has(n.constructor))i=n;else{var d,v=A(n);for(d in i=v===Object.prototype?{}:Object.create(v),Se.set(n,i),n)V(n,d)&&(i[d]=r(n[d]))}return i})(e),Se=null,e}var Fe={}.toString;function Be(e){return Fe.call(e).slice(8,-1)}var Qe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ke=typeof Qe=="symbol"?function(e){var r;return e!=null&&(r=e[Qe])&&r.apply(e)}:function(){return null};function Le(e,r){return r=e.indexOf(r),0<=r&&e.splice(r,1),0<=r}var ge={};function Ee(e){var r,n,i,o;if(arguments.length===1){if(b(e))return e.slice();if(this===ge&&typeof e=="string")return[e];if(o=ke(e)){for(n=[];!(i=o.next()).done;)n.push(i.value);return n}if(e==null)return[e];if(typeof(r=e.length)!="number")return[e];for(n=new Array(r);r--;)n[r]=e[r];return n}for(r=arguments.length,n=new Array(r);r--;)n[r]=arguments[r];return n}var at=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Mt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Dt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Mt),ot={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function fe(e,r){this.name=e,this.message=r}function Me(e,r){return e+". Errors: "+Object.keys(r).map(function(n){return r[n].toString()}).filter(function(n,i,o){return o.indexOf(n)===i}).join(`
`)}function Xe(e,r,n,i){this.failures=r,this.failedKeys=i,this.successCount=n,this.message=Me(e,r)}function Ae(e,r){this.name="BulkError",this.failures=Object.keys(r).map(function(n){return r[n]}),this.failuresByPos=r,this.message=Me(e,this.failures)}L(fe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),L(Xe).from(fe),L(Ae).from(fe);var et=Dt.reduce(function(e,r){return e[r]=r+"Error",e},{}),At=fe,re=Dt.reduce(function(e,r){var n=r+"Error";function i(o,l){this.name=n,o?typeof o=="string"?(this.message="".concat(o).concat(l?`
 `+l:""),this.inner=l||null):typeof o=="object"&&(this.message="".concat(o.name," ").concat(o.message),this.inner=o):(this.message=ot[r]||n,this.inner=null)}return L(i).from(At),e[r]=i,e},{});re.Syntax=SyntaxError,re.Type=TypeError,re.Range=RangeError;var xt=Mt.reduce(function(e,r){return e[r+"Error"]=re[r],e},{}),tt=Dt.reduce(function(e,r){return["Syntax","Type","Range"].indexOf(r)===-1&&(e[r+"Error"]=re[r]),e},{});function pe(){}function qe(e){return e}function gt(e,r){return e==null||e===qe?r:function(n){return r(e(n))}}function ze(e,r){return function(){e.apply(this,arguments),r.apply(this,arguments)}}function ut(e,r){return e===pe?r:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var l=r.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ze(i,this.onsuccess):i),o&&(this.onerror=this.onerror?ze(o,this.onerror):o),l!==void 0?l:n}}function pt(e,r){return e===pe?r:function(){e.apply(this,arguments);var n=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,r.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ze(n,this.onsuccess):n),i&&(this.onerror=this.onerror?ze(i,this.onerror):i)}}function rt(e,r){return e===pe?r:function(n){var i=e.apply(this,arguments);P(n,i);var o=this.onsuccess,l=this.onerror;return this.onsuccess=null,this.onerror=null,n=r.apply(this,arguments),o&&(this.onsuccess=this.onsuccess?ze(o,this.onsuccess):o),l&&(this.onerror=this.onerror?ze(l,this.onerror):l),i===void 0?n===void 0?void 0:n:P(i,n)}}function st(e,r){return e===pe?r:function(){return r.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function lt(e,r){return e===pe?r:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var i=this,o=arguments.length,l=new Array(o);o--;)l[o]=arguments[o];return n.then(function(){return r.apply(i,l)})}return r.apply(this,arguments)}}tt.ModifyError=Xe,tt.DexieError=fe,tt.BulkError=Ae;var Ue=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function It(e){Ue=e}var Vt={},kt=100,Ye=typeof Promise>"u"?[]:(function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,A(e),e];var r=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[r,A(r),e]})(),Mt=Ye[0],Dt=Ye[1],Ye=Ye[2],Dt=Dt&&Dt.then,dt=Mt&&Mt.constructor,_t=!!Ye,$e=function(e,r){Ir.push([e,r]),jt&&(queueMicrotask(Ma),jt=!1)},ft=!0,jt=!0,Bt=[],dr=[],zt=qe,Pt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pe,pgp:!1,env:{},finalize:pe},se=Pt,Ir=[],nr=0,qr=[];function $(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var r=this._PSD=se;if(typeof e!="function"){if(e!==Vt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Pn(this,this._value))}this._state=null,this._value=null,++r.ref,(function n(i,o){try{o(function(l){if(i._state===null){if(l===i)throw new TypeError("A promise cannot be resolved with itself.");var d=i._lib&&fr();l&&typeof l.then=="function"?n(i,function(v,g){l instanceof $?l._then(v,g):l.then(v,g)}):(i._state=!0,i._value=l,mi(i)),d&&hr()}},Pn.bind(null,i))}catch(l){Pn(i,l)}})(this,e)}var An={get:function(){var e=se,r=Gr;function n(i,o){var l=this,d=!e.global&&(e!==se||r!==Gr),v=d&&!Jt(),g=new $(function(m,S){On(l,new gi(bi(i,e,d,v),bi(o,e,d,v),m,S,e))});return this._consoleTask&&(g._consoleTask=this._consoleTask),g}return n.prototype=Vt,n},set:function(e){M(this,"then",e&&e.prototype===Vt?An:{get:function(){return e},set:An.set})}};function gi(e,r,n,i,o){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof r=="function"?r:null,this.resolve=n,this.reject=i,this.psd=o}function Pn(e,r){var n,i;dr.push(r),e._state===null&&(n=e._lib&&fr(),r=zt(r),e._state=!1,e._value=r,i=e,Bt.some(function(o){return o._value===i._value})||Bt.push(i),mi(e),n&&hr())}function mi(e){var r=e._listeners;e._listeners=[];for(var n=0,i=r.length;n<i;++n)On(e,r[n]);var o=e._PSD;--o.ref||o.finalize(),nr===0&&(++nr,$e(function(){--nr==0&&En()},[]))}function On(e,r){if(e._state!==null){var n=e._state?r.onFulfilled:r.onRejected;if(n===null)return(e._state?r.resolve:r.reject)(e._value);++r.psd.ref,++nr,$e(Ra,[n,e,r])}else e._listeners.push(r)}function Ra(e,r,n){try{var i,o=r._value;!r._state&&dr.length&&(dr=[]),i=Ue&&r._consoleTask?r._consoleTask.run(function(){return e(o)}):e(o),r._state||dr.indexOf(o)!==-1||(function(l){for(var d=Bt.length;d;)if(Bt[--d]._value===l._value)return Bt.splice(d,1)})(r),n.resolve(i)}catch(l){n.reject(l)}finally{--nr==0&&En(),--n.psd.ref||n.psd.finalize()}}function Ma(){ir(Pt,function(){fr()&&hr()})}function fr(){var e=ft;return jt=ft=!1,e}function hr(){var e,r,n;do for(;0<Ir.length;)for(e=Ir,Ir=[],n=e.length,r=0;r<n;++r){var i=e[r];i[0].apply(null,i[1])}while(0<Ir.length);jt=ft=!0}function En(){var e=Bt;Bt=[],e.forEach(function(i){i._PSD.onunhandled.call(null,i._value,i)});for(var r=qr.slice(0),n=r.length;n;)r[--n]()}function Br(e){return new $(Vt,!1,e)}function Ge(e,r){var n=se;return function(){var i=fr(),o=se;try{return Qt(n,!0),e.apply(this,arguments)}catch(l){r&&r(l)}finally{Qt(o,!1),i&&hr()}}}D($.prototype,{then:An,_then:function(e,r){On(this,new gi(null,null,e,r,se))},catch:function(e){if(arguments.length===1)return this.then(null,e);var r=e,n=arguments[1];return typeof r=="function"?this.then(null,function(i){return(i instanceof r?n:Br)(i)}):this.then(null,function(i){return(i&&i.name===r?n:Br)(i)})},finally:function(e){return this.then(function(r){return $.resolve(e()).then(function(){return r})},function(r){return $.resolve(e()).then(function(){return Br(r)})})},timeout:function(e,r){var n=this;return e<1/0?new $(function(i,o){var l=setTimeout(function(){return o(new re.Timeout(r))},e);n.then(i,o).finally(clearTimeout.bind(null,l))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&M($.prototype,Symbol.toStringTag,"Dexie.Promise"),Pt.env=yi(),D($,{all:function(){var e=Ee.apply(null,arguments).map(Wr);return new $(function(r,n){e.length===0&&r([]);var i=e.length;e.forEach(function(o,l){return $.resolve(o).then(function(d){e[l]=d,--i||r(e)},n)})})},resolve:function(e){return e instanceof $?e:e&&typeof e.then=="function"?new $(function(r,n){e.then(r,n)}):new $(Vt,!0,e)},reject:Br,race:function(){var e=Ee.apply(null,arguments).map(Wr);return new $(function(r,n){e.map(function(i){return $.resolve(i).then(r,n)})})},PSD:{get:function(){return se},set:function(e){return se=e}},totalEchoes:{get:function(){return Gr}},newPSD:Yt,usePSD:ir,scheduler:{get:function(){return $e},set:function(e){$e=e}},rejectionMapper:{get:function(){return zt},set:function(e){zt=e}},follow:function(e,r){return new $(function(n,i){return Yt(function(o,l){var d=se;d.unhandleds=[],d.onunhandled=l,d.finalize=ze(function(){var v,g=this;v=function(){g.unhandleds.length===0?o():l(g.unhandleds[0])},qr.push(function m(){v(),qr.splice(qr.indexOf(m),1)}),++nr,$e(function(){--nr==0&&En()},[])},d.finalize),e()},r,n,i)})}}),dt&&(dt.allSettled&&M($,"allSettled",function(){var e=Ee.apply(null,arguments).map(Wr);return new $(function(r){e.length===0&&r([]);var n=e.length,i=new Array(n);e.forEach(function(o,l){return $.resolve(o).then(function(d){return i[l]={status:"fulfilled",value:d}},function(d){return i[l]={status:"rejected",reason:d}}).then(function(){return--n||r(i)})})})}),dt.any&&typeof AggregateError<"u"&&M($,"any",function(){var e=Ee.apply(null,arguments).map(Wr);return new $(function(r,n){e.length===0&&n(new AggregateError([]));var i=e.length,o=new Array(i);e.forEach(function(l,d){return $.resolve(l).then(function(v){return r(v)},function(v){o[d]=v,--i||n(new AggregateError(o))})})})}),dt.withResolvers&&($.withResolvers=dt.withResolvers));var ht={awaits:0,echoes:0,id:0},ja=0,zr=[],Ur=0,Gr=0,Ha=0;function Yt(e,r,n,i){var o=se,l=Object.create(o);return l.parent=o,l.ref=0,l.global=!1,l.id=++Ha,Pt.env,l.env=_t?{Promise:$,PromiseProp:{value:$,configurable:!0,writable:!0},all:$.all,race:$.race,allSettled:$.allSettled,any:$.any,resolve:$.resolve,reject:$.reject}:{},r&&P(l,r),++o.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()},i=ir(l,e,n,i),l.ref===0&&l.finalize(),i}function vr(){return ht.id||(ht.id=++ja),++ht.awaits,ht.echoes+=kt,ht.id}function Jt(){return!!ht.awaits&&(--ht.awaits==0&&(ht.id=0),ht.echoes=ht.awaits*kt,!0)}function Wr(e){return ht.echoes&&e&&e.constructor===dt?(vr(),e.then(function(r){return Jt(),r},function(r){return Jt(),nt(r)})):e}function Ka(){var e=zr[zr.length-1];zr.pop(),Qt(e,!1)}function Qt(e,r){var n,i=se;(r?!ht.echoes||Ur++&&e===se:!Ur||--Ur&&e===se)||queueMicrotask(r?(function(o){++Gr,ht.echoes&&--ht.echoes!=0||(ht.echoes=ht.awaits=ht.id=0),zr.push(se),Qt(o,!0)}).bind(null,e):Ka),e!==se&&(se=e,i===Pt&&(Pt.env=yi()),_t&&(n=Pt.env.Promise,r=e.env,(i.global||e.global)&&(Object.defineProperty(f,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any&&(n.any=r.any))))}function yi(){var e=f.Promise;return _t?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(f,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ir(e,r,n,i,o){var l=se;try{return Qt(e,!0),r(n,i,o)}finally{Qt(l,!1)}}function bi(e,r,n,i){return typeof e!="function"?e:function(){var o=se;n&&vr(),Qt(r,!0);try{return e.apply(this,arguments)}finally{Qt(o,!1),i&&queueMicrotask(Jt)}}}function Fn(e){Promise===dt&&ht.echoes===0?Ur===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Dt).indexOf("[native code]")===-1&&(vr=Jt=pe);var nt=$.reject,ar="ï¿¿",Ut="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",wi="String expected.",pr=[],Yr="__dbnames",Tn="readonly",Dn="readwrite";function or(e,r){return e?r?function(){return e.apply(this,arguments)&&r.apply(this,arguments)}:e:r}var _i={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Jr(e){return typeof e!="string"||/\./.test(e)?function(r){return r}:function(r){return r[e]===void 0&&e in r&&delete(r=_e(r))[e],r}}function Si(){throw re.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Pe(e,r){try{var n=xi(e),i=xi(r);if(n!==i)return n==="Array"?1:i==="Array"?-1:n==="binary"?1:i==="binary"?-1:n==="string"?1:i==="string"?-1:n==="Date"?1:i!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return r<e?1:e<r?-1:0;case"binary":return(function(o,l){for(var d=o.length,v=l.length,g=d<v?d:v,m=0;m<g;++m)if(o[m]!==l[m])return o[m]<l[m]?-1:1;return d===v?0:d<v?-1:1})(Ii(e),Ii(r));case"Array":return(function(o,l){for(var d=o.length,v=l.length,g=d<v?d:v,m=0;m<g;++m){var S=Pe(o[m],l[m]);if(S!==0)return S}return d===v?0:d<v?-1:1})(e,r)}}catch{}return NaN}function xi(e){var r=typeof e;return r!="object"?r:ArrayBuffer.isView(e)?"binary":(e=Be(e),e==="ArrayBuffer"?"binary":e)}function Ii(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Qr(e,r,n){var i=e.schema.yProps;return i?(r&&0<n.numFailures&&(r=r.filter(function(o,l){return!n.failures[l]})),Promise.all(i.map(function(o){return o=o.updatesTable,r?e.db.table(o).where("k").anyOf(r).delete():e.db.table(o).clear()})).then(function(){return n})):n}var kr=(ki.prototype.execute=function(e){var r=this["@@propmod"];if(r.add!==void 0){var n=r.add;if(b(n))return u(u([],b(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(r.remove!==void 0){var i=r.remove;if(b(i))return b(e)?e.filter(function(o){return!i.includes(o)}).sort():[];if(typeof i=="number")return Number(e)-i;if(typeof i=="bigint")try{return BigInt(e)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}return n=(n=r.replacePrefix)===null||n===void 0?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?r.replacePrefix[1]+e.substring(n.length):e},ki);function ki(e){this["@@propmod"]=e}function Ci(e,r){for(var n=h(r),i=n.length,o=!1,l=0;l<i;++l){var d=n[l],v=r[d],g=te(e,d);v instanceof kr?(oe(e,d,v.execute(g)),o=!0):g!==v&&(oe(e,d,v),o=!0)}return o}var Ai=(He.prototype._trans=function(e,r,n){var i=this._tx||se.trans,o=this.name,l=Ue&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function d(m,S,p){if(!p.schema[o])throw new re.NotFound("Table "+o+" not part of transaction");return r(p.idbtrans,p)}var v=fr();try{var g=i&&i.db._novip===this.db._novip?i===se.trans?i._promise(e,d,n):Yt(function(){return i._promise(e,d,n)},{trans:i,transless:se.transless||se}):(function m(S,p,I,y){if(S.idbdb&&(S._state.openComplete||se.letThrough||S._vip)){var w=S._createTransaction(p,I,S._dbSchema);try{w.create(),S._state.PR1398_maxLoop=3}catch(_){return _.name===et.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return m(S,p,I,y)})):nt(_)}return w._promise(p,function(_,x){return Yt(function(){return se.trans=w,y(_,x,w)})}).then(function(_){if(p==="readwrite")try{w.idbtrans.commit()}catch{}return p==="readonly"?_:w._completion.then(function(){return _})})}if(S._state.openComplete)return nt(new re.DatabaseClosed(S._state.dbOpenError));if(!S._state.isBeingOpened){if(!S._state.autoOpen)return nt(new re.DatabaseClosed);S.open().catch(pe)}return S._state.dbReadyPromise.then(function(){return m(S,p,I,y)})})(this.db,e,[this.name],d);return l&&(g._consoleTask=l,g=g.catch(function(m){return console.trace(m),nt(m)})),g}finally{v&&hr()}},He.prototype.get=function(e,r){var n=this;return e&&e.constructor===Object?this.where(e).first(r):e==null?nt(new re.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return n.core.get({trans:i,key:e}).then(function(o){return n.hook.reading.fire(o)})}).then(r)},He.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(b(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var r=h(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(v){if(v.compound&&r.every(function(m){return 0<=v.keyPath.indexOf(m)})){for(var g=0;g<r.length;++g)if(r.indexOf(v.keyPath[g])===-1)return!1;return!0}return!1}).sort(function(v,g){return v.keyPath.length-g.keyPath.length})[0];if(n&&this.db._maxKey!==ar){var l=n.keyPath.slice(0,r.length);return this.where(l).equals(l.map(function(g){return e[g]}))}!n&&Ue&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(r.join("+"),"]"));var i=this.schema.idxByName;function o(v,g){return Pe(v,g)===0}var d=r.reduce(function(p,g){var m=p[0],S=p[1],p=i[g],I=e[g];return[m||p,m||!p?or(S,p&&p.multi?function(y){return y=te(y,g),b(y)&&y.some(function(w){return o(I,w)})}:function(y){return o(I,te(y,g))}):S]},[null,null]),l=d[0],d=d[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(d):n?this.filter(d):this.where(r).equals("")},He.prototype.filter=function(e){return this.toCollection().and(e)},He.prototype.count=function(e){return this.toCollection().count(e)},He.prototype.offset=function(e){return this.toCollection().offset(e)},He.prototype.limit=function(e){return this.toCollection().limit(e)},He.prototype.each=function(e){return this.toCollection().each(e)},He.prototype.toArray=function(e){return this.toCollection().toArray(e)},He.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},He.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,b(e)?"[".concat(e.join("+"),"]"):e))},He.prototype.reverse=function(){return this.toCollection().reverse()},He.prototype.mapToClass=function(e){var r,n=this.db,i=this.name;function o(){return r!==null&&r.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Si&&((function(g,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function S(){this.constructor=g}a(g,m),g.prototype=m===null?Object.create(m):(S.prototype=m.prototype,new S)})(o,r=e),Object.defineProperty(o.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),o.prototype.table=function(){return i},e=o);for(var l=new Set,d=e.prototype;d;d=A(d))Object.getOwnPropertyNames(d).forEach(function(g){return l.add(g)});function v(g){if(!g)return g;var m,S=Object.create(e.prototype);for(m in g)if(!l.has(m))try{S[m]=g[m]}catch{}return S}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),e},He.prototype.defineClass=function(){return this.mapToClass(function(e){P(this,e)})},He.prototype.add=function(e,r){var n=this,i=this.schema.primKey,o=i.auto,l=i.keyPath,d=e;return l&&o&&(d=Jr(l)(e)),this._trans("readwrite",function(v){return n.core.mutate({trans:v,type:"add",keys:r!=null?[r]:null,values:[d]})}).then(function(v){return v.numFailures?$.reject(v.failures[0]):v.lastResult}).then(function(v){if(l)try{oe(e,l,v)}catch{}return v})},He.prototype.upsert=function(e,r){var n=this,i=this.schema.primKey.keyPath;return this._trans("readwrite",function(o){return n.core.get({trans:o,key:e}).then(function(l){var d=l??{};return Ci(d,r),i&&oe(d,i,e),n.core.mutate({trans:o,type:"put",values:[d],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[r]}}).then(function(v){return v.numFailures?$.reject(v.failures[0]):!!l})})})},He.prototype.update=function(e,r){return typeof e!="object"||b(e)?this.where(":id").equals(e).modify(r):(e=te(e,this.schema.primKey.keyPath),e===void 0?nt(new re.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(r))},He.prototype.put=function(e,r){var n=this,i=this.schema.primKey,o=i.auto,l=i.keyPath,d=e;return l&&o&&(d=Jr(l)(e)),this._trans("readwrite",function(v){return n.core.mutate({trans:v,type:"put",values:[d],keys:r!=null?[r]:null})}).then(function(v){return v.numFailures?$.reject(v.failures[0]):v.lastResult}).then(function(v){if(l)try{oe(e,l,v)}catch{}return v})},He.prototype.delete=function(e){var r=this;return this._trans("readwrite",function(n){return r.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(i){return Qr(r,[e],i)}).then(function(i){return i.numFailures?$.reject(i.failures[0]):void 0})})},He.prototype.clear=function(){var e=this;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"deleteRange",range:_i}).then(function(n){return Qr(e,null,n)})}).then(function(r){return r.numFailures?$.reject(r.failures[0]):void 0})},He.prototype.bulkGet=function(e){var r=this;return this._trans("readonly",function(n){return r.core.getMany({keys:e,trans:n}).then(function(i){return i.map(function(o){return r.hook.reading.fire(o)})})})},He.prototype.bulkAdd=function(e,r,n){var i=this,o=Array.isArray(r)?r:void 0,l=(n=n||(o?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",function(d){var m=i.schema.primKey,v=m.auto,m=m.keyPath;if(m&&o)throw new re.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,m=m&&v?e.map(Jr(m)):e;return i.core.mutate({trans:d,type:"add",keys:o,values:m,wantResults:l}).then(function(w){var p=w.numFailures,I=w.results,y=w.lastResult,w=w.failures;if(p===0)return l?I:y;throw new Ae("".concat(i.name,".bulkAdd(): ").concat(p," of ").concat(g," operations failed"),w)})})},He.prototype.bulkPut=function(e,r,n){var i=this,o=Array.isArray(r)?r:void 0,l=(n=n||(o?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",function(d){var m=i.schema.primKey,v=m.auto,m=m.keyPath;if(m&&o)throw new re.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,m=m&&v?e.map(Jr(m)):e;return i.core.mutate({trans:d,type:"put",keys:o,values:m,wantResults:l}).then(function(w){var p=w.numFailures,I=w.results,y=w.lastResult,w=w.failures;if(p===0)return l?I:y;throw new Ae("".concat(i.name,".bulkPut(): ").concat(p," of ").concat(g," operations failed"),w)})})},He.prototype.bulkUpdate=function(e){var r=this,n=this.core,i=e.map(function(d){return d.key}),o=e.map(function(d){return d.changes}),l=[];return this._trans("readwrite",function(d){return n.getMany({trans:d,keys:i,cache:"clone"}).then(function(v){var g=[],m=[];e.forEach(function(p,I){var y=p.key,w=p.changes,_=v[I];if(_){for(var x=0,C=Object.keys(w);x<C.length;x++){var O=C[x],F=w[O];if(O===r.schema.primKey.keyPath){if(Pe(F,y)!==0)throw new re.Constraint("Cannot update primary key in bulkUpdate()")}else oe(_,O,F)}l.push(I),g.push(y),m.push(_)}});var S=g.length;return n.mutate({trans:d,type:"put",keys:g,values:m,updates:{keys:i,changeSpecs:o}}).then(function(p){var I=p.numFailures,y=p.failures;if(I===0)return S;for(var w=0,_=Object.keys(y);w<_.length;w++){var x,C=_[w],O=l[Number(C)];O!=null&&(x=y[C],delete y[C],y[O]=x)}throw new Ae("".concat(r.name,".bulkUpdate(): ").concat(I," of ").concat(S," operations failed"),y)})})})},He.prototype.bulkDelete=function(e){var r=this,n=e.length;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"delete",keys:e}).then(function(o){return Qr(r,e,o)})}).then(function(d){var o=d.numFailures,l=d.lastResult,d=d.failures;if(o===0)return l;throw new Ae("".concat(r.name,".bulkDelete(): ").concat(o," of ").concat(n," operations failed"),d)})},He);function He(){}function Cr(e){function r(d,v){if(v){for(var g=arguments.length,m=new Array(g-1);--g;)m[g-1]=arguments[g];return n[d].subscribe.apply(null,m),e}if(typeof d=="string")return n[d]}var n={};r.addEventType=l;for(var i=1,o=arguments.length;i<o;++i)l(arguments[i]);return r;function l(d,v,g){if(typeof d!="object"){var m;v=v||st;var S={subscribers:[],fire:g=g||pe,subscribe:function(p){S.subscribers.indexOf(p)===-1&&(S.subscribers.push(p),S.fire=v(S.fire,p))},unsubscribe:function(p){S.subscribers=S.subscribers.filter(function(I){return I!==p}),S.fire=S.subscribers.reduce(v,g)}};return n[d]=r[d]=S}h(m=d).forEach(function(p){var I=m[p];if(b(I))l(p,m[p][0],m[p][1]);else{if(I!=="asap")throw new re.InvalidArgument("Invalid event config");var y=l(p,qe,function(){for(var w=arguments.length,_=new Array(w);w--;)_[w]=arguments[w];y.subscribers.forEach(function(x){le(function(){x.apply(null,_)})})})}})}}function Ar(e,r){return L(r).from({prototype:e}),r}function gr(e,r){return!(e.filter||e.algorithm||e.or)&&(r?e.justLimit:!e.replayFilter)}function Nn(e,r){e.filter=or(e.filter,r)}function Vn(e,r,n){var i=e.replayFilter;e.replayFilter=i?function(){return or(i(),r())}:r,e.justLimit=n&&!i}function Xr(e,r){if(e.isPrimKey)return r.primaryKey;var n=r.getIndexByKeyPath(e.index);if(!n)throw new re.Schema("KeyPath "+e.index+" on object store "+r.name+" is not indexed");return n}function Pi(e,r,n){var i=Xr(e,r.schema);return r.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:i,range:e.range}})}function $r(e,r,n,i){var o=e.replayFilter?or(e.filter,e.replayFilter()):e.filter;if(e.or){var l={},d=function(v,g,m){var S,p;o&&!o(g,m,function(I){return g.stop(I)},function(I){return g.fail(I)})||((p=""+(S=g.primaryKey))=="[object ArrayBuffer]"&&(p=""+new Uint8Array(S)),V(l,p)||(l[p]=!0,r(v,g,m)))};return Promise.all([e.or._iterate(d,n),Oi(Pi(e,i,n),e.algorithm,d,!e.keysOnly&&e.valueMapper)])}return Oi(Pi(e,i,n),or(e.algorithm,o),r,!e.keysOnly&&e.valueMapper)}function Oi(e,r,n,i){var o=Ge(i?function(l,d,v){return n(i(l),d,v)}:n);return e.then(function(l){if(l)return l.start(function(){var d=function(){return l.continue()};r&&!r(l,function(v){return d=v},function(v){l.stop(v),d=pe},function(v){l.fail(v),d=pe})||o(l.value,l,function(v){return d=v}),d()})})}var qa=(Te.prototype._read=function(e,r){var n=this._ctx;return n.error?n.table._trans(null,nt.bind(null,n.error)):n.table._trans("readonly",e).then(r)},Te.prototype._write=function(e){var r=this._ctx;return r.error?r.table._trans(null,nt.bind(null,r.error)):r.table._trans("readwrite",e,"locked")},Te.prototype._addAlgorithm=function(e){var r=this._ctx;r.algorithm=or(r.algorithm,e)},Te.prototype._iterate=function(e,r){return $r(this._ctx,e,r,this._ctx.table.core)},Te.prototype.clone=function(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&P(n,e),r._ctx=n,r},Te.prototype.raw=function(){return this._ctx.valueMapper=null,this},Te.prototype.each=function(e){var r=this._ctx;return this._read(function(n){return $r(r,e,n,r.table.core)})},Te.prototype.count=function(e){var r=this;return this._read(function(n){var i=r._ctx,o=i.table.core;if(gr(i,!0))return o.count({trans:n,query:{index:Xr(i,o.schema),range:i.range}}).then(function(d){return Math.min(d,i.limit)});var l=0;return $r(i,function(){return++l,!1},n,o).then(function(){return l})}).then(e)},Te.prototype.sortBy=function(e,r){var n=e.split(".").reverse(),i=n[0],o=n.length-1;function l(g,m){return m?l(g[n[m]],m-1):g[i]}var d=this._ctx.dir==="next"?1:-1;function v(g,m){return Pe(l(g,o),l(m,o))*d}return this.toArray(function(g){return g.sort(v)}).then(r)},Te.prototype.toArray=function(e){var r=this;return this._read(function(n){var i=r._ctx;if(i.dir==="next"&&gr(i,!0)&&0<i.limit){var o=i.valueMapper,l=Xr(i,i.table.core.schema);return i.table.core.query({trans:n,limit:i.limit,values:!0,query:{index:l,range:i.range}}).then(function(v){return v=v.result,o?v.map(o):v})}var d=[];return $r(i,function(v){return d.push(v)},n,i.table.core).then(function(){return d})},e)},Te.prototype.offset=function(e){var r=this._ctx;return e<=0||(r.offset+=e,gr(r)?Vn(r,function(){var n=e;return function(i,o){return n===0||(n===1?--n:o(function(){i.advance(n),n=0}),!1)}}):Vn(r,function(){var n=e;return function(){return--n<0}})),this},Te.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Vn(this._ctx,function(){var r=e;return function(n,i,o){return--r<=0&&i(o),0<=r}},!0),this},Te.prototype.until=function(e,r){return Nn(this._ctx,function(n,i,o){return!e(n.value)||(i(o),r)}),this},Te.prototype.first=function(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)},Te.prototype.last=function(e){return this.reverse().first(e)},Te.prototype.filter=function(e){var r;return Nn(this._ctx,function(n){return e(n.value)}),(r=this._ctx).isMatch=or(r.isMatch,e),this},Te.prototype.and=function(e){return this.filter(e)},Te.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Te.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Te.prototype.desc=function(){return this.reverse()},Te.prototype.eachKey=function(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.key,i)})},Te.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Te.prototype.eachPrimaryKey=function(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.primaryKey,i)})},Te.prototype.keys=function(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.key)}).then(function(){return n}).then(e)},Te.prototype.primaryKeys=function(e){var r=this._ctx;if(r.dir==="next"&&gr(r,!0)&&0<r.limit)return this._read(function(i){var o=Xr(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:o,range:r.range}})}).then(function(i){return i.result}).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)},Te.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Te.prototype.firstKey=function(e){return this.limit(1).keys(function(r){return r[0]}).then(e)},Te.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Te.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var r={};return Nn(this._ctx,function(o){var i=o.primaryKey.toString(),o=V(r,i);return r[i]=!0,!o}),this},Te.prototype.modify=function(e){var r=this,n=this._ctx;return this._write(function(i){var o=typeof e=="function"?e:function(_){return Ci(_,e)},l=n.table.core,m=l.schema.primaryKey,d=m.outbound,v=m.extractKey,g=200,m=r.db._options.modifyChunkSize;m&&(g=typeof m=="object"?m[l.name]||m["*"]||200:m);function S(_,O){var C=O.failures,O=O.numFailures;I+=_-O;for(var F=0,R=h(C);F<R.length;F++){var z=R[F];p.push(C[z])}}var p=[],I=0,y=[],w=e===Ei;return r.clone().primaryKeys().then(function(_){function x(O){var F=Math.min(g,_.length-O),R=_.slice(O,O+F);return(w?Promise.resolve([]):l.getMany({trans:i,keys:R,cache:"immutable"})).then(function(z){var J=[],q=[],G=d?[]:null,Q=w?R:[];if(!w)for(var Y=0;Y<F;++Y){var ie=z[Y],be={value:_e(ie),primKey:_[O+Y]};o.call(be,be.value,be)!==!1&&(be.value==null?Q.push(_[O+Y]):d||Pe(v(ie),v(be.value))===0?(q.push(be.value),d&&G.push(_[O+Y])):(Q.push(_[O+Y]),J.push(be.value)))}return Promise.resolve(0<J.length&&l.mutate({trans:i,type:"add",values:J}).then(function(we){for(var xe in we.failures)Q.splice(parseInt(xe),1);S(J.length,we)})).then(function(){return(0<q.length||C&&typeof e=="object")&&l.mutate({trans:i,type:"put",keys:G,values:q,criteria:C,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<O}).then(function(we){return S(q.length,we)})}).then(function(){return(0<Q.length||C&&w)&&l.mutate({trans:i,type:"delete",keys:Q,criteria:C,isAdditionalChunk:0<O}).then(function(we){return Qr(n.table,Q,we)}).then(function(we){return S(Q.length,we)})}).then(function(){return _.length>O+F&&x(O+g)})})}var C=gr(n)&&n.limit===1/0&&(typeof e!="function"||w)&&{index:n.index,range:n.range};return x(0).then(function(){if(0<p.length)throw new Xe("Error modifying one or more objects",p,I,y);return _.length})})})},Te.prototype.delete=function(){var e=this._ctx,r=e.range;return!gr(e)||e.table.schema.yProps||!e.isPrimKey&&r.type!==3?this.modify(Ei):this._write(function(n){var i=e.table.core.schema.primaryKey,o=r;return e.table.core.count({trans:n,query:{index:i,range:o}}).then(function(l){return e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(function(g){var v=g.failures,g=g.numFailures;if(g)throw new Xe("Could not delete some values",Object.keys(v).map(function(m){return v[m]}),l-g);return l-g})})})},Te);function Te(){}var Ei=function(e,r){return r.value=null};function Ba(e,r){return e<r?-1:e===r?0:1}function za(e,r){return r<e?-1:e===r?0:1}function Ot(e,r,n){return e=e instanceof Ti?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(r),e}function mr(e){return new e.Collection(e,function(){return Fi("")}).limit(0)}function Zr(e,r,n,i){var o,l,d,v,g,m,S,p=n.length;if(!n.every(function(w){return typeof w=="string"}))return Ot(e,wi);function I(w){o=w==="next"?function(x){return x.toUpperCase()}:function(x){return x.toLowerCase()},l=w==="next"?function(x){return x.toLowerCase()}:function(x){return x.toUpperCase()},d=w==="next"?Ba:za;var _=n.map(function(x){return{lower:l(x),upper:o(x)}}).sort(function(x,C){return d(x.lower,C.lower)});v=_.map(function(x){return x.upper}),g=_.map(function(x){return x.lower}),S=(m=w)==="next"?"":i}I("next"),e=new e.Collection(e,function(){return Xt(v[0],g[p-1]+i)}),e._ondirectionchange=function(w){I(w)};var y=0;return e._addAlgorithm(function(w,_,x){var C=w.key;if(typeof C!="string")return!1;var O=l(C);if(r(O,g,y))return!0;for(var F=null,R=y;R<p;++R){var z=(function(J,q,G,Q,Y,ie){for(var be=Math.min(J.length,Q.length),we=-1,xe=0;xe<be;++xe){var Et=q[xe];if(Et!==Q[xe])return Y(J[xe],G[xe])<0?J.substr(0,xe)+G[xe]+G.substr(xe+1):Y(J[xe],Q[xe])<0?J.substr(0,xe)+Q[xe]+G.substr(xe+1):0<=we?J.substr(0,we)+q[we]+G.substr(we+1):null;Y(J[xe],Et)<0&&(we=xe)}return be<Q.length&&ie==="next"?J+G.substr(J.length):be<J.length&&ie==="prev"?J.substr(0,G.length):we<0?null:J.substr(0,we)+Q[we]+G.substr(we+1)})(C,O,v[R],g[R],d,m);z===null&&F===null?y=R+1:(F===null||0<d(F,z))&&(F=z)}return _(F!==null?function(){w.continue(F+S)}:x),!1}),e}function Xt(e,r,n,i){return{type:2,lower:e,upper:r,lowerOpen:n,upperOpen:i}}function Fi(e){return{type:1,lower:e,upper:e}}var Ti=(Object.defineProperty(vt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),vt.prototype.between=function(e,r,n,i){n=n!==!1,i=i===!0;try{return 0<this._cmp(e,r)||this._cmp(e,r)===0&&(n||i)&&(!n||!i)?mr(this):new this.Collection(this,function(){return Xt(e,r,!n,!i)})}catch{return Ot(this,Ut)}},vt.prototype.equals=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return Fi(e)})},vt.prototype.above=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return Xt(e,void 0,!0)})},vt.prototype.aboveOrEqual=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return Xt(e,void 0,!1)})},vt.prototype.below=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return Xt(void 0,e,!1,!0)})},vt.prototype.belowOrEqual=function(e){return e==null?Ot(this,Ut):new this.Collection(this,function(){return Xt(void 0,e)})},vt.prototype.startsWith=function(e){return typeof e!="string"?Ot(this,wi):this.between(e,e+ar,!0,!0)},vt.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Zr(this,function(r,n){return r.indexOf(n[0])===0},[e],ar)},vt.prototype.equalsIgnoreCase=function(e){return Zr(this,function(r,n){return r===n[0]},[e],"")},vt.prototype.anyOfIgnoreCase=function(){var e=Ee.apply(ge,arguments);return e.length===0?mr(this):Zr(this,function(r,n){return n.indexOf(r)!==-1},e,"")},vt.prototype.startsWithAnyOfIgnoreCase=function(){var e=Ee.apply(ge,arguments);return e.length===0?mr(this):Zr(this,function(r,n){return n.some(function(i){return r.indexOf(i)===0})},e,ar)},vt.prototype.anyOf=function(){var e=this,r=Ee.apply(ge,arguments),n=this._cmp;try{r.sort(n)}catch{return Ot(this,Ut)}if(r.length===0)return mr(this);var i=new this.Collection(this,function(){return Xt(r[0],r[r.length-1])});i._ondirectionchange=function(l){n=l==="next"?e._ascending:e._descending,r.sort(n)};var o=0;return i._addAlgorithm(function(l,d,v){for(var g=l.key;0<n(g,r[o]);)if(++o===r.length)return d(v),!1;return n(g,r[o])===0||(d(function(){l.continue(r[o])}),!1)}),i},vt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},vt.prototype.noneOf=function(){var e=Ee.apply(ge,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ot(this,Ut)}var r=e.reduce(function(n,i){return n?n.concat([[n[n.length-1][1],i]]):[[-1/0,i]]},null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})},vt.prototype.inAnyRange=function(C,r){var n=this,i=this._cmp,o=this._ascending,l=this._descending,d=this._min,v=this._max;if(C.length===0)return mr(this);if(!C.every(function(O){return O[0]!==void 0&&O[1]!==void 0&&o(O[0],O[1])<=0}))return Ot(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",re.InvalidArgument);var g=!r||r.includeLowers!==!1,m=r&&r.includeUppers===!0,S,p=o;function I(O,F){return p(O[0],F[0])}try{(S=C.reduce(function(O,F){for(var R=0,z=O.length;R<z;++R){var J=O[R];if(i(F[0],J[1])<0&&0<i(F[1],J[0])){J[0]=d(J[0],F[0]),J[1]=v(J[1],F[1]);break}}return R===z&&O.push(F),O},[])).sort(I)}catch{return Ot(this,Ut)}var y=0,w=m?function(O){return 0<o(O,S[y][1])}:function(O){return 0<=o(O,S[y][1])},_=g?function(O){return 0<l(O,S[y][0])}:function(O){return 0<=l(O,S[y][0])},x=w,C=new this.Collection(this,function(){return Xt(S[0][0],S[S.length-1][1],!g,!m)});return C._ondirectionchange=function(O){p=O==="next"?(x=w,o):(x=_,l),S.sort(I)},C._addAlgorithm(function(O,F,R){for(var z,J=O.key;x(J);)if(++y===S.length)return F(R),!1;return!w(z=J)&&!_(z)||(n._cmp(J,S[y][1])===0||n._cmp(J,S[y][0])===0||F(function(){p===o?O.continue(S[y][0]):O.continue(S[y][1])}),!1)}),C},vt.prototype.startsWithAnyOf=function(){var e=Ee.apply(ge,arguments);return e.every(function(r){return typeof r=="string"})?e.length===0?mr(this):this.inAnyRange(e.map(function(r){return[r,r+ar]})):Ot(this,"startsWithAnyOf() only works with strings")},vt);function vt(){}function Ht(e){return Ge(function(r){return Pr(r),e(r.target.error),!1})}function Pr(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Or="storagemutated",Ln="x-storagemutated-1",$t=Cr(null,Or),Ua=(Kt.prototype._lock=function(){return U(!se.global),++this._reculock,this._reculock!==1||se.global||(se.lockOwnerFor=this),this},Kt.prototype._unlock=function(){if(U(!se.global),--this._reculock==0)for(se.global||(se.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ir(e[1],e[0])}catch{}}return this},Kt.prototype._locked=function(){return this._reculock&&se.lockOwnerFor!==this},Kt.prototype.create=function(e){var r=this;if(!this.mode)return this;var n=this.db.idbdb,i=this.db._state.dbOpenError;if(U(!this.idbtrans),!e&&!n)switch(i&&i.name){case"DatabaseClosedError":throw new re.DatabaseClosed(i);case"MissingAPIError":throw new re.MissingAPI(i.message,i);default:throw new re.OpenFailed(i)}if(!this.active)throw new re.TransactionInactive;return U(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ge(function(o){Pr(o),r._reject(e.error)}),e.onabort=Ge(function(o){Pr(o),r.active&&r._reject(new re.Abort(e.error)),r.active=!1,r.on("abort").fire(o)}),e.oncomplete=Ge(function(){r.active=!1,r._resolve(),"mutatedParts"in e&&$t.storagemutated.fire(e.mutatedParts)}),this},Kt.prototype._promise=function(e,r,n){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return nt(new re.ReadOnly("Transaction is readonly"));if(!this.active)return nt(new re.TransactionInactive);if(this._locked())return new $(function(l,d){i._blockedFuncs.push([function(){i._promise(e,r,n).then(l,d)},se])});if(n)return Yt(function(){var l=new $(function(d,v){i._lock();var g=r(d,v,i);g&&g.then&&g.then(d,v)});return l.finally(function(){return i._unlock()}),l._lib=!0,l});var o=new $(function(l,d){var v=r(l,d,i);v&&v.then&&v.then(l,d)});return o._lib=!0,o},Kt.prototype._root=function(){return this.parent?this.parent._root():this},Kt.prototype.waitFor=function(e){var r,n=this._root(),i=$.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return i}):(n._waitingFor=i,n._waitingQueue=[],r=n.idbtrans.objectStore(n.storeNames[0]),(function l(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(r.get(-1/0).onsuccess=l)})());var o=n._waitingFor;return new $(function(l,d){i.then(function(v){return n._waitingQueue.push(Ge(l.bind(null,v)))},function(v){return n._waitingQueue.push(Ge(d.bind(null,v)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},Kt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new re.Abort))},Kt.prototype.table=function(e){var r=this._memoizedTables||(this._memoizedTables={});if(V(r,e))return r[e];var n=this.schema[e];if(!n)throw new re.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),r[e]=n},Kt);function Kt(){}function Rn(e,r,n,i,o,l,d,v){return{name:e,keyPath:r,unique:n,multi:i,auto:o,compound:l,src:(n&&!d?"&":"")+(i?"*":"")+(o?"++":"")+Di(r),type:v}}function Di(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Mn(e,r,n){return{name:e,primKey:r,indexes:n,mappedClass:null,idxByName:(i=function(o){return[o.name,o]},n.reduce(function(o,l,d){return d=i(l,d),d&&(o[d[0]]=d[1]),o},{}))};var i}var Er=function(e){try{return e.only([[]]),Er=function(){return[[]]},[[]]}catch{return Er=function(){return ar},ar}};function jn(e){return e==null?function(){}:typeof e=="string"?(r=e).split(".").length===1?function(n){return n[r]}:function(n){return te(n,r)}:function(n){return te(n,e)};var r}function Ni(e){return[].slice.call(e)}var Ga=0;function Fr(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Wa(e,r,g){function i(x){if(x.type===3)return null;if(x.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var y=x.lower,w=x.upper,_=x.lowerOpen,x=x.upperOpen;return y===void 0?w===void 0?null:r.upperBound(w,!!x):w===void 0?r.lowerBound(y,!!_):r.bound(y,w,!!_,!!x)}function o(I){var y,w=I.name;return{name:w,schema:I,mutate:function(_){var x=_.trans,C=_.type,O=_.keys,F=_.values,R=_.range;return new Promise(function(z,J){z=Ge(z);var q=x.objectStore(w),G=q.keyPath==null,Q=C==="put"||C==="add";if(!Q&&C!=="delete"&&C!=="deleteRange")throw new Error("Invalid operation type: "+C);var Y,ie=(O||F||{length:1}).length;if(O&&F&&O.length!==F.length)throw new Error("Given keys array must have same length as given values array.");if(ie===0)return z({numFailures:0,failures:{},results:[],lastResult:void 0});function be(St){++Et,Pr(St)}var we=[],xe=[],Et=0;if(C==="deleteRange"){if(R.type===4)return z({numFailures:Et,failures:xe,results:[],lastResult:void 0});R.type===3?we.push(Y=q.clear()):we.push(Y=q.delete(i(R)))}else{var G=Q?G?[F,O]:[F,null]:[O,null],me=G[0],yt=G[1];if(Q)for(var bt=0;bt<ie;++bt)we.push(Y=yt&&yt[bt]!==void 0?q[C](me[bt],yt[bt]):q[C](me[bt])),Y.onerror=be;else for(bt=0;bt<ie;++bt)we.push(Y=q[C](me[bt])),Y.onerror=be}function fn(St){St=St.target.result,we.forEach(function(cr,ni){return cr.error!=null&&(xe[ni]=cr.error)}),z({numFailures:Et,failures:xe,results:C==="delete"?O:we.map(function(cr){return cr.result}),lastResult:St})}Y.onerror=function(St){be(St),fn(St)},Y.onsuccess=fn})},getMany:function(_){var x=_.trans,C=_.keys;return new Promise(function(O,F){O=Ge(O);for(var R,z=x.objectStore(w),J=C.length,q=new Array(J),G=0,Q=0,Y=function(we){we=we.target,q[we._pos]=we.result,++Q===G&&O(q)},ie=Ht(F),be=0;be<J;++be)C[be]!=null&&((R=z.get(C[be]))._pos=be,R.onsuccess=Y,R.onerror=ie,++G);G===0&&O(q)})},get:function(_){var x=_.trans,C=_.key;return new Promise(function(O,F){O=Ge(O);var R=x.objectStore(w).get(C);R.onsuccess=function(z){return O(z.target.result)},R.onerror=Ht(F)})},query:(y=m,function(_){return new Promise(function(x,C){x=Ge(x);var O,F,R,G=_.trans,z=_.values,J=_.limit,Y=_.query,q=J===1/0?void 0:J,Q=Y.index,Y=Y.range,G=G.objectStore(w),Q=Q.isPrimaryKey?G:G.index(Q.name),Y=i(Y);if(J===0)return x({result:[]});y?((q=z?Q.getAll(Y,q):Q.getAllKeys(Y,q)).onsuccess=function(ie){return x({result:ie.target.result})},q.onerror=Ht(C)):(O=0,F=!z&&"openKeyCursor"in Q?Q.openKeyCursor(Y):Q.openCursor(Y),R=[],F.onsuccess=function(ie){var be=F.result;return be?(R.push(z?be.value:be.primaryKey),++O===J?x({result:R}):void be.continue()):x({result:R})},F.onerror=Ht(C))})}),openCursor:function(_){var x=_.trans,C=_.values,O=_.query,F=_.reverse,R=_.unique;return new Promise(function(z,J){z=Ge(z);var Q=O.index,q=O.range,G=x.objectStore(w),G=Q.isPrimaryKey?G:G.index(Q.name),Q=F?R?"prevunique":"prev":R?"nextunique":"next",Y=!C&&"openKeyCursor"in G?G.openKeyCursor(i(q),Q):G.openCursor(i(q),Q);Y.onerror=Ht(J),Y.onsuccess=Ge(function(ie){var be,we,xe,Et,me=Y.result;me?(me.___id=++Ga,me.done=!1,be=me.continue.bind(me),we=(we=me.continuePrimaryKey)&&we.bind(me),xe=me.advance.bind(me),Et=function(){throw new Error("Cursor not stopped")},me.trans=x,me.stop=me.continue=me.continuePrimaryKey=me.advance=function(){throw new Error("Cursor not started")},me.fail=Ge(J),me.next=function(){var yt=this,bt=1;return this.start(function(){return bt--?yt.continue():yt.stop()}).then(function(){return yt})},me.start=function(yt){function bt(){if(Y.result)try{yt()}catch(St){me.fail(St)}else me.done=!0,me.start=function(){throw new Error("Cursor behind last entry")},me.stop()}var fn=new Promise(function(St,cr){St=Ge(St),Y.onerror=Ht(cr),me.fail=cr,me.stop=function(ni){me.stop=me.continue=me.continuePrimaryKey=me.advance=Et,St(ni)}});return Y.onsuccess=Ge(function(St){Y.onsuccess=bt,bt()}),me.continue=be,me.continuePrimaryKey=we,me.advance=xe,bt(),fn},z(me)):z(null)},J)})},count:function(_){var x=_.query,C=_.trans,O=x.index,F=x.range;return new Promise(function(R,z){var J=C.objectStore(w),q=O.isPrimaryKey?J:J.index(O.name),J=i(F),q=J?q.count(J):q.count();q.onsuccess=Ge(function(G){return R(G.target.result)}),q.onerror=Ht(z)})}}}var l,d,v,S=(d=g,v=Ni((l=e).objectStoreNames),{schema:{name:l.name,tables:v.map(function(I){return d.objectStore(I)}).map(function(I){var y=I.keyPath,x=I.autoIncrement,w=b(y),_={},x={name:I.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y==null,compound:w,keyPath:y,autoIncrement:x,unique:!0,extractKey:jn(y)},indexes:Ni(I.indexNames).map(function(C){return I.index(C)}).map(function(R){var O=R.name,F=R.unique,z=R.multiEntry,R=R.keyPath,z={name:O,compound:b(R),keyPath:R,unique:F,multiEntry:z,extractKey:jn(R)};return _[Fr(R)]=z}),getIndexByKeyPath:function(C){return _[Fr(C)]}};return _[":id"]=x.primaryKey,y!=null&&(_[Fr(y)]=x.primaryKey),x})},hasGetAll:0<v.length&&"getAll"in d.objectStore(v[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),g=S.schema,m=S.hasGetAll,S=g.tables.map(o),p={};return S.forEach(function(I){return p[I.name]=I}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(I){if(!p[I])throw new Error("Table '".concat(I,"' not found"));return p[I]},MIN_KEY:-1/0,MAX_KEY:Er(r),schema:g}}function Ya(e,r,n,i){var o=n.IDBKeyRange;return n.indexedDB,{dbcore:(i=Wa(r,o,i),e.dbcore.reduce(function(l,d){return d=d.create,s(s({},l),d(l))},i))}}function en(e,i){var n=i.db,i=Ya(e._middlewares,n,e._deps,i);e.core=i.dbcore,e.tables.forEach(function(o){var l=o.name;e.core.schema.tables.some(function(d){return d.name===l})&&(o.core=e.core.table(l),e[l]instanceof e.Table&&(e[l].core=o.core))})}function tn(e,r,n,i){n.forEach(function(o){var l=i[o];r.forEach(function(d){var v=(function g(m,S){return K(m,S)||(m=A(m))&&g(m,S)})(d,o);(!v||"value"in v&&v.value===void 0)&&(d===e.Transaction.prototype||d instanceof e.Transaction?M(d,o,{get:function(){return this.table(o)},set:function(g){W(this,o,{value:g,writable:!0,configurable:!0,enumerable:!0})}}):d[o]=new e.Table(o,l))})})}function Hn(e,r){r.forEach(function(n){for(var i in n)n[i]instanceof e.Table&&delete n[i]})}function Ja(e,r){return e._cfg.version-r._cfg.version}function Qa(e,r,n,i){var o=e._dbSchema;n.objectStoreNames.contains("$meta")&&!o.$meta&&(o.$meta=Mn("$meta",Li("")[0],[]),e._storeNames.push("$meta"));var l=e._createTransaction("readwrite",e._storeNames,o);l.create(n),l._completion.catch(i);var d=l._reject.bind(l),v=se.transless||se;Yt(function(){return se.trans=l,se.transless=v,r!==0?(en(e,n),m=r,((g=l).storeNames.includes("$meta")?g.table("$meta").get("version").then(function(S){return S??m}):$.resolve(m)).then(function(S){return I=S,y=l,w=n,_=[],S=(p=e)._versions,x=p._dbSchema=nn(0,p.idbdb,w),(S=S.filter(function(C){return C._cfg.version>=I})).length!==0?(S.forEach(function(C){_.push(function(){var O=x,F=C._cfg.dbschema;an(p,O,w),an(p,F,w),x=p._dbSchema=F;var R=Kn(O,F);R.add.forEach(function(Q){qn(w,Q[0],Q[1].primKey,Q[1].indexes)}),R.change.forEach(function(Q){if(Q.recreate)throw new re.Upgrade("Not yet support for changing primary key");var Y=w.objectStore(Q.name);Q.add.forEach(function(ie){return rn(Y,ie)}),Q.change.forEach(function(ie){Y.deleteIndex(ie.name),rn(Y,ie)}),Q.del.forEach(function(ie){return Y.deleteIndex(ie)})});var z=C._cfg.contentUpgrade;if(z&&C._cfg.version>I){en(p,w),y._memoizedTables={};var J=he(F);R.del.forEach(function(Q){J[Q]=O[Q]}),Hn(p,[p.Transaction.prototype]),tn(p,[p.Transaction.prototype],h(J),J),y.schema=J;var q,G=at(z);return G&&vr(),R=$.follow(function(){var Q;(q=z(y))&&G&&(Q=Jt.bind(null,null),q.then(Q,Q))}),q&&typeof q.then=="function"?$.resolve(q):R.then(function(){return q})}}),_.push(function(O){var F,R,z=C._cfg.dbschema;F=z,R=O,[].slice.call(R.db.objectStoreNames).forEach(function(J){return F[J]==null&&R.db.deleteObjectStore(J)}),Hn(p,[p.Transaction.prototype]),tn(p,[p.Transaction.prototype],p._storeNames,p._dbSchema),y.schema=p._dbSchema}),_.push(function(O){p.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(p.idbdb.version/10)===C._cfg.version?(p.idbdb.deleteObjectStore("$meta"),delete p._dbSchema.$meta,p._storeNames=p._storeNames.filter(function(F){return F!=="$meta"})):O.objectStore("$meta").put(C._cfg.version,"version"))})}),(function C(){return _.length?$.resolve(_.shift()(y.idbtrans)).then(C):$.resolve()})().then(function(){Vi(x,w)})):$.resolve();var p,I,y,w,_,x}).catch(d)):(h(o).forEach(function(S){qn(n,S,o[S].primKey,o[S].indexes)}),en(e,n),void $.follow(function(){return e.on.populate.fire(l)}).catch(d));var g,m})}function Xa(e,r){Vi(e._dbSchema,r),r.db.version%10!=0||r.objectStoreNames.contains("$meta")||r.db.createObjectStore("$meta").add(Math.ceil(r.db.version/10-1),"version");var n=nn(0,e.idbdb,r);an(e,e._dbSchema,r);for(var i=0,o=Kn(n,e._dbSchema).change;i<o.length;i++){var l=(function(d){if(d.change.length||d.recreate)return console.warn("Unable to patch indexes of table ".concat(d.name," because it has changes on the type of index or primary key.")),{value:void 0};var v=r.objectStore(d.name);d.add.forEach(function(g){Ue&&console.debug("Dexie upgrade patch: Creating missing index ".concat(d.name,".").concat(g.src)),rn(v,g)})})(o[i]);if(typeof l=="object")return l.value}}function Kn(e,r){var n,i={del:[],add:[],change:[]};for(n in e)r[n]||i.del.push(n);for(n in r){var o=e[n],l=r[n];if(o){var d={name:n,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||o.primKey.auto!==l.primKey.auto)d.recreate=!0,i.change.push(d);else{var v=o.idxByName,g=l.idxByName,m=void 0;for(m in v)g[m]||d.del.push(m);for(m in g){var S=v[m],p=g[m];S?S.src!==p.src&&d.change.push(p):d.add.push(p)}(0<d.del.length||0<d.add.length||0<d.change.length)&&i.change.push(d)}}else i.add.push([n,l])}return i}function qn(e,r,n,i){var o=e.db.createObjectStore(r,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return i.forEach(function(l){return rn(o,l)}),o}function Vi(e,r){h(e).forEach(function(n){r.db.objectStoreNames.contains(n)||(Ue&&console.debug("Dexie: Creating missing table",n),qn(r,n,e[n].primKey,e[n].indexes))})}function rn(e,r){e.createIndex(r.name,r.keyPath,{unique:r.unique,multiEntry:r.multi})}function nn(e,r,n){var i={};return H(r.objectStoreNames,0).forEach(function(o){for(var l=n.objectStore(o),d=Rn(Di(m=l.keyPath),m||"",!0,!1,!!l.autoIncrement,m&&typeof m!="string",!0),v=[],g=0;g<l.indexNames.length;++g){var S=l.index(l.indexNames[g]),m=S.keyPath,S=Rn(S.name,m,!!S.unique,!!S.multiEntry,!1,m&&typeof m!="string",!1);v.push(S)}i[o]=Mn(o,d,v)}),i}function an(e,r,n){for(var i=n.db.objectStoreNames,o=0;o<i.length;++o){var l=i[o],d=n.objectStore(l);e._hasGetAll="getAll"in d;for(var v=0;v<d.indexNames.length;++v){var g=d.indexNames[v],m=d.index(g).keyPath,S=typeof m=="string"?m:"["+H(m).join("+")+"]";!r[l]||(m=r[l].idxByName[S])&&(m.name=g,delete r[l].idxByName[S],r[l].idxByName[g]=m)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&f.WorkerGlobalScope&&f instanceof f.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Li(e){return e.split(",").map(function(r,n){var l=r.split(":"),i=(o=l[1])===null||o===void 0?void 0:o.trim(),o=(r=l[0].trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return Rn(o,l||null,/\&/.test(r),/\*/.test(r),/\+\+/.test(r),b(l),n===0,i)})}var $a=(yr.prototype._createTableSchema=Mn,yr.prototype._parseIndexSyntax=Li,yr.prototype._parseStoresSpec=function(e,r){var n=this;h(e).forEach(function(i){if(e[i]!==null){var o=n._parseIndexSyntax(e[i]),l=o.shift();if(!l)throw new re.Schema("Invalid schema for table "+i+": "+e[i]);if(l.unique=!0,l.multi)throw new re.Schema("Primary key cannot be multiEntry*");o.forEach(function(d){if(d.auto)throw new re.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new re.Schema("Index must have a name and cannot be an empty string")}),o=n._createTableSchema(i,l,o),r[i]=o}})},yr.prototype.stores=function(n){var r=this.db;this._cfg.storesSource=this._cfg.storesSource?P(this._cfg.storesSource,n):n;var n=r._versions,i={},o={};return n.forEach(function(l){P(i,l._cfg.storesSource),o=l._cfg.dbschema={},l._parseStoresSpec(i,o)}),r._dbSchema=o,Hn(r,[r._allTables,r,r.Transaction.prototype]),tn(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],h(o),o),r._storeNames=h(o),this},yr.prototype.upgrade=function(e){return this._cfg.contentUpgrade=lt(this._cfg.contentUpgrade||pe,e),this},yr);function yr(){}function Bn(e,r){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Gt(Yr,{addons:[],indexedDB:e,IDBKeyRange:r})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function zn(e){return e&&typeof e.databases=="function"}function Un(e){return Yt(function(){return se.letThrough=!0,e()})}function Gn(e){return!("from"in e)}var mt=function(e,r){if(!this){var n=new mt;return e&&"d"in e&&P(n,e),n}P(this,arguments.length?{d:1,from:e,to:1<arguments.length?r:e}:{d:0})};function Tr(e,r,n){var i=Pe(r,n);if(!isNaN(i)){if(0<i)throw RangeError();if(Gn(e))return P(e,{from:r,to:n,d:1});var o=e.l,i=e.r;if(Pe(n,e.from)<0)return o?Tr(o,r,n):e.l={from:r,to:n,d:1,l:null,r:null},Mi(e);if(0<Pe(r,e.to))return i?Tr(i,r,n):e.r={from:r,to:n,d:1,l:null,r:null},Mi(e);Pe(r,e.from)<0&&(e.from=r,e.l=null,e.d=i?i.d+1:1),0<Pe(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,o&&!e.l&&Dr(e,o),i&&n&&Dr(e,i)}}function Dr(e,r){Gn(r)||(function n(i,g){var l=g.from,d=g.to,v=g.l,g=g.r;Tr(i,l,d),v&&n(i,v),g&&n(i,g)})(e,r)}function Ri(e,r){var n=on(r),i=n.next();if(i.done)return!1;for(var o=i.value,l=on(e),d=l.next(o.from),v=d.value;!i.done&&!d.done;){if(Pe(v.from,o.to)<=0&&0<=Pe(v.to,o.from))return!0;Pe(o.from,v.from)<0?o=(i=n.next(v.from)).value:v=(d=l.next(o.from)).value}return!1}function on(e){var r=Gn(e)?null:{s:0,n:e};return{next:function(n){for(var i=0<arguments.length;r;)switch(r.s){case 0:if(r.s=1,i)for(;r.n.l&&Pe(n,r.n.from)<0;)r={up:r,n:r.n.l,s:1};else for(;r.n.l;)r={up:r,n:r.n.l,s:1};case 1:if(r.s=2,!i||Pe(n,r.n.to)<=0)return{value:r.n,done:!1};case 2:if(r.n.r){r.s=3,r={up:r,n:r.n.r,s:0};continue}case 3:r=r.up}return{done:!0}}}}function Mi(e){var r,n,i=(((r=e.r)===null||r===void 0?void 0:r.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),o=1<i?"r":i<-1?"l":"";o&&(r=o=="r"?"l":"r",n=s({},e),i=e[o],e.from=i.from,e.to=i.to,e[o]=i[o],n[o]=i[r],(e[r]=n).d=ji(n)),e.d=ji(e)}function ji(n){var r=n.r,n=n.l;return(r?n?Math.max(r.d,n.d):r.d:n?n.d:0)+1}function sn(e,r){return h(r).forEach(function(n){e[n]?Dr(e[n],r[n]):e[n]=(function i(o){var l,d,v={};for(l in o)V(o,l)&&(d=o[l],v[l]=!d||typeof d!="object"||ye.has(d.constructor)?d:i(d));return v})(r[n])}),e}function Wn(e,r){return e.all||r.all||Object.keys(e).some(function(n){return r[n]&&Ri(r[n],e[n])})}D(mt.prototype,((Dt={add:function(e){return Dr(this,e),this},addKey:function(e){return Tr(this,e,e),this},addKeys:function(e){var r=this;return e.forEach(function(n){return Tr(r,n,n)}),this},hasKey:function(e){var r=on(this).next(e).value;return r&&Pe(r.from,e)<=0&&0<=Pe(r.to,e)}})[Qe]=function(){return on(this)},Dt));var sr={},Yn={},Jn=!1;function ln(e){sn(Yn,e),Jn||(Jn=!0,setTimeout(function(){Jn=!1,Qn(Yn,!(Yn={}))},0))}function Qn(e,r){r===void 0&&(r=!1);var n=new Set;if(e.all)for(var i=0,o=Object.values(sr);i<o.length;i++)Hi(d=o[i],e,n,r);else for(var l in e){var d,v=/^idb\:\/\/(.*)\/(.*)\//.exec(l);v&&(l=v[1],v=v[2],(d=sr["idb://".concat(l,"/").concat(v)])&&Hi(d,e,n,r))}n.forEach(function(g){return g()})}function Hi(e,r,n,i){for(var o=[],l=0,d=Object.entries(e.queries.query);l<d.length;l++){for(var v=d[l],g=v[0],m=[],S=0,p=v[1];S<p.length;S++){var I=p[S];Wn(r,I.obsSet)?I.subscribers.forEach(function(x){return n.add(x)}):i&&m.push(I)}i&&o.push([g,m])}if(i)for(var y=0,w=o;y<w.length;y++){var _=w[y],g=_[0],m=_[1];e.queries.query[g]=m}}function Za(e){var r=e._state,n=e._deps.indexedDB;if(r.isBeingOpened||e.idbdb)return r.dbReadyPromise.then(function(){return r.dbOpenError?nt(r.dbOpenError):e});r.isBeingOpened=!0,r.dbOpenError=null,r.openComplete=!1;var i=r.openCanceller,o=Math.round(10*e.verno),l=!1;function d(){if(r.openCanceller!==i)throw new re.DatabaseClosed("db.open() was cancelled")}function v(){return new $(function(I,y){if(d(),!n)throw new re.MissingAPI;var w=e.name,_=r.autoSchema||!o?n.open(w):n.open(w,o);if(!_)throw new re.MissingAPI;_.onerror=Ht(y),_.onblocked=Ge(e._fireOnBlocked),_.onupgradeneeded=Ge(function(x){var C;S=_.transaction,r.autoSchema&&!e._options.allowEmptyDB?(_.onerror=Pr,S.abort(),_.result.close(),(C=n.deleteDatabase(w)).onsuccess=C.onerror=Ge(function(){y(new re.NoSuchDatabase("Database ".concat(w," doesnt exist")))})):(S.onerror=Ht(y),x=x.oldVersion>Math.pow(2,62)?0:x.oldVersion,p=x<1,e.idbdb=_.result,l&&Xa(e,S),Qa(e,x/10,S,y))},y),_.onsuccess=Ge(function(){S=null;var x,C,O,F,R,z=e.idbdb=_.result,J=H(z.objectStoreNames);if(0<J.length)try{var q=z.transaction((F=J).length===1?F[0]:F,"readonly");if(r.autoSchema)C=z,O=q,(x=e).verno=C.version/10,O=x._dbSchema=nn(0,C,O),x._storeNames=H(C.objectStoreNames,0),tn(x,[x._allTables],h(O),O);else if(an(e,e._dbSchema,q),((R=Kn(nn(0,(R=e).idbdb,q),R._dbSchema)).add.length||R.change.some(function(G){return G.add.length||G.change.length}))&&!l)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),z.close(),o=z.version+1,l=!0,I(v());en(e,q)}catch{}pr.push(e),z.onversionchange=Ge(function(G){r.vcFired=!0,e.on("versionchange").fire(G)}),z.onclose=Ge(function(){e.close({disableAutoOpen:!1})}),p&&(R=e._deps,q=w,z=R.indexedDB,R=R.IDBKeyRange,zn(z)||q===Yr||Bn(z,R).put({name:q}).catch(pe)),I()},y)}).catch(function(I){switch(I?.name){case"UnknownError":if(0<r.PR1398_maxLoop)return r.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),v();break;case"VersionError":if(0<o)return o=0,v()}return $.reject(I)})}var g,m=r.dbReadyResolve,S=null,p=!1;return $.race([i,(typeof navigator>"u"?$.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(I){function y(){return indexedDB.databases().finally(I)}g=setInterval(y,100),y()}).finally(function(){return clearInterval(g)}):Promise.resolve()).then(v)]).then(function(){return d(),r.onReadyBeingFired=[],$.resolve(Un(function(){return e.on.ready.fire(e.vip)})).then(function I(){if(0<r.onReadyBeingFired.length){var y=r.onReadyBeingFired.reduce(lt,pe);return r.onReadyBeingFired=[],$.resolve(Un(function(){return y(e.vip)})).then(I)}})}).finally(function(){r.openCanceller===i&&(r.onReadyBeingFired=null,r.isBeingOpened=!1)}).catch(function(I){r.dbOpenError=I;try{S&&S.abort()}catch{}return i===r.openCanceller&&e._close(),nt(I)}).finally(function(){r.openComplete=!0,m()}).then(function(){var I;return p&&(I={},e.tables.forEach(function(y){y.schema.indexes.forEach(function(w){w.name&&(I["idb://".concat(e.name,"/").concat(y.name,"/").concat(w.name)]=new mt(-1/0,[[[]]]))}),I["idb://".concat(e.name,"/").concat(y.name,"/")]=I["idb://".concat(e.name,"/").concat(y.name,"/:dels")]=new mt(-1/0,[[[]]])}),$t(Or).fire(I),Qn(I,!0)),e})}function Xn(e){function r(l){return e.next(l)}var n=o(r),i=o(function(l){return e.throw(l)});function o(l){return function(g){var v=l(g),g=v.value;return v.done?g:g&&typeof g.then=="function"?g.then(n,i):b(g)?Promise.all(g).then(n,i):n(g)}}return o(r)()}function cn(e,r,n){for(var i=b(e)?e.slice():[e],o=0;o<n;++o)i.push(r);return i}var eo={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return s(s({},e),{table:function(r){var n=e.table(r),i=n.schema,o={},l=[];function d(p,I,y){var w=Fr(p),_=o[w]=o[w]||[],x=p==null?0:typeof p=="string"?1:p.length,C=0<I,C=s(s({},y),{name:C?"".concat(w,"(virtual-from:").concat(y.name,")"):y.name,lowLevelIndex:y,isVirtual:C,keyTail:I,keyLength:x,extractKey:jn(p),unique:!C&&y.unique});return _.push(C),C.isPrimaryKey||l.push(C),1<x&&d(x===2?p[0]:p.slice(0,x-1),I+1,y),_.sort(function(O,F){return O.keyTail-F.keyTail}),C}r=d(i.primaryKey.keyPath,0,i.primaryKey),o[":id"]=[r];for(var v=0,g=i.indexes;v<g.length;v++){var m=g[v];d(m.keyPath,0,m)}function S(p){var I,y=p.query.index;return y.isVirtual?s(s({},p),{query:{index:y.lowLevelIndex,range:(I=p.query.range,y=y.keyTail,{type:I.type===1?2:I.type,lower:cn(I.lower,I.lowerOpen?e.MAX_KEY:e.MIN_KEY,y),lowerOpen:!0,upper:cn(I.upper,I.upperOpen?e.MIN_KEY:e.MAX_KEY,y),upperOpen:!0})}}):p}return s(s({},n),{schema:s(s({},i),{primaryKey:r,indexes:l,getIndexByKeyPath:function(p){return(p=o[Fr(p)])&&p[0]}}),count:function(p){return n.count(S(p))},query:function(p){return n.query(S(p))},openCursor:function(p){var I=p.query.index,y=I.keyTail,w=I.isVirtual,_=I.keyLength;return w?n.openCursor(S(p)).then(function(C){return C&&x(C)}):n.openCursor(p);function x(C){return Object.create(C,{continue:{value:function(O){O!=null?C.continue(cn(O,p.reverse?e.MAX_KEY:e.MIN_KEY,y)):p.unique?C.continue(C.key.slice(0,_).concat(p.reverse?e.MIN_KEY:e.MAX_KEY,y)):C.continue()}},continuePrimaryKey:{value:function(O,F){C.continuePrimaryKey(cn(O,e.MAX_KEY,y),F)}},primaryKey:{get:function(){return C.primaryKey}},key:{get:function(){var O=C.key;return _===1?O[0]:O.slice(0,_)}},value:{get:function(){return C.value}}})}}})}})}};function $n(e,r,n,i){return n=n||{},i=i||"",h(e).forEach(function(o){var l,d,v;V(r,o)?(l=e[o],d=r[o],typeof l=="object"&&typeof d=="object"&&l&&d?(v=Be(l))!==Be(d)?n[i+o]=r[o]:v==="Object"?$n(l,d,n,i+o+"."):l!==d&&(n[i+o]=r[o]):l!==d&&(n[i+o]=r[o])):n[i+o]=void 0}),h(r).forEach(function(o){V(e,o)||(n[i+o]=r[o])}),n}function Zn(e,r){return r.type==="delete"?r.keys:r.keys||r.values.map(e.extractKey)}var to={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return s(s({},e),{table:function(r){var n=e.table(r),i=n.schema.primaryKey;return s(s({},n),{mutate:function(o){var l=se.trans,d=l.table(r).hook,v=d.deleting,g=d.creating,m=d.updating;switch(o.type){case"add":if(g.fire===pe)break;return l._promise("readwrite",function(){return S(o)},!0);case"put":if(g.fire===pe&&m.fire===pe)break;return l._promise("readwrite",function(){return S(o)},!0);case"delete":if(v.fire===pe)break;return l._promise("readwrite",function(){return S(o)},!0);case"deleteRange":if(v.fire===pe)break;return l._promise("readwrite",function(){return(function p(I,y,w){return n.query({trans:I,values:!1,query:{index:i,range:y},limit:w}).then(function(_){var x=_.result;return S({type:"delete",keys:x,trans:I}).then(function(C){return 0<C.numFailures?Promise.reject(C.failures[0]):x.length<w?{failures:[],numFailures:0,lastResult:void 0}:p(I,s(s({},y),{lower:x[x.length-1],lowerOpen:!0}),w)})})})(o.trans,o.range,1e4)},!0)}return n.mutate(o);function S(p){var I,y,w,_=se.trans,x=p.keys||Zn(i,p);if(!x)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?s(s({},p),{keys:x}):s({},p)).type!=="delete"&&(p.values=u([],p.values)),p.keys&&(p.keys=u([],p.keys)),I=n,w=x,((y=p).type==="add"?Promise.resolve([]):I.getMany({trans:y.trans,keys:w,cache:"immutable"})).then(function(C){var O=x.map(function(F,R){var z,J,q,G=C[R],Q={onerror:null,onsuccess:null};return p.type==="delete"?v.fire.call(Q,F,G,_):p.type==="add"||G===void 0?(z=g.fire.call(Q,F,p.values[R],_),F==null&&z!=null&&(p.keys[R]=F=z,i.outbound||oe(p.values[R],i.keyPath,F))):(z=$n(G,p.values[R]),(J=m.fire.call(Q,z,F,G,_))&&(q=p.values[R],Object.keys(J).forEach(function(Y){V(q,Y)?q[Y]=J[Y]:oe(q,Y,J[Y])}))),Q});return n.mutate(p).then(function(F){for(var R=F.failures,z=F.results,J=F.numFailures,F=F.lastResult,q=0;q<x.length;++q){var G=(z||x)[q],Q=O[q];G==null?Q.onerror&&Q.onerror(R[q]):Q.onsuccess&&Q.onsuccess(p.type==="put"&&C[q]?p.values[q]:G)}return{failures:R,results:z,numFailures:J,lastResult:F}}).catch(function(F){return O.forEach(function(R){return R.onerror&&R.onerror(F)}),Promise.reject(F)})})}}})}})}};function Ki(e,r,n){try{if(!r||r.keys.length<e.length)return null;for(var i=[],o=0,l=0;o<r.keys.length&&l<e.length;++o)Pe(r.keys[o],e[l])===0&&(i.push(n?_e(r.values[o]):r.values[o]),++l);return i.length===e.length?i:null}catch{return null}}var ro={stack:"dbcore",level:-1,create:function(e){return{table:function(r){var n=e.table(r);return s(s({},n),{getMany:function(i){if(!i.cache)return n.getMany(i);var o=Ki(i.keys,i.trans._cache,i.cache==="clone");return o?$.resolve(o):n.getMany(i).then(function(l){return i.trans._cache={keys:i.keys,values:i.cache==="clone"?_e(l):l},l})},mutate:function(i){return i.type!=="add"&&(i.trans._cache=null),n.mutate(i)}})}}}};function qi(e,r){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!r.schema.primaryKey.outbound}function Bi(e,r){switch(e){case"query":return r.values&&!r.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var no={stack:"dbcore",level:0,name:"Observability",create:function(e){var r=e.schema.name,n=new mt(e.MIN_KEY,e.MAX_KEY);return s(s({},e),{transaction:function(i,o,l){if(se.subscr&&o!=="readonly")throw new re.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(se.querier));return e.transaction(i,o,l)},table:function(i){var o=e.table(i),l=o.schema,d=l.primaryKey,p=l.indexes,v=d.extractKey,g=d.outbound,m=d.autoIncrement&&p.filter(function(y){return y.compound&&y.keyPath.includes(d.keyPath)}),S=s(s({},o),{mutate:function(y){function w(Y){return Y="idb://".concat(r,"/").concat(i,"/").concat(Y),F[Y]||(F[Y]=new mt)}var _,x,C,O=y.trans,F=y.mutatedParts||(y.mutatedParts={}),R=w(""),z=w(":dels"),J=y.type,Q=y.type==="deleteRange"?[y.range]:y.type==="delete"?[y.keys]:y.values.length<50?[Zn(d,y).filter(function(Y){return Y}),y.values]:[],q=Q[0],G=Q[1],Q=y.trans._cache;return b(q)?(R.addKeys(q),(Q=J==="delete"||q.length===G.length?Ki(q,Q):null)||z.addKeys(q),(Q||G)&&(_=w,x=Q,C=G,l.indexes.forEach(function(Y){var ie=_(Y.name||"");function be(xe){return xe!=null?Y.extractKey(xe):null}function we(xe){return Y.multiEntry&&b(xe)?xe.forEach(function(Et){return ie.addKey(Et)}):ie.addKey(xe)}(x||C).forEach(function(xe,yt){var me=x&&be(x[yt]),yt=C&&be(C[yt]);Pe(me,yt)!==0&&(me!=null&&we(me),yt!=null&&we(yt))})}))):q?(G={from:(G=q.lower)!==null&&G!==void 0?G:e.MIN_KEY,to:(G=q.upper)!==null&&G!==void 0?G:e.MAX_KEY},z.add(G),R.add(G)):(R.add(n),z.add(n),l.indexes.forEach(function(Y){return w(Y.name).add(n)})),o.mutate(y).then(function(Y){return!q||y.type!=="add"&&y.type!=="put"||(R.addKeys(Y.results),m&&m.forEach(function(ie){for(var be=y.values.map(function(me){return ie.extractKey(me)}),we=ie.keyPath.findIndex(function(me){return me===d.keyPath}),xe=0,Et=Y.results.length;xe<Et;++xe)be[xe][we]=Y.results[xe];w(ie.name).addKeys(be)})),O.mutatedParts=sn(O.mutatedParts||{},F),Y})}}),p=function(w){var _=w.query,w=_.index,_=_.range;return[w,new mt((w=_.lower)!==null&&w!==void 0?w:e.MIN_KEY,(_=_.upper)!==null&&_!==void 0?_:e.MAX_KEY)]},I={get:function(y){return[d,new mt(y.key)]},getMany:function(y){return[d,new mt().addKeys(y.keys)]},count:p,query:p,openCursor:p};return h(I).forEach(function(y){S[y]=function(w){var _=se.subscr,x=!!_,C=qi(se,o)&&Bi(y,w)?w.obsSet={}:_;if(x){var O=function(G){return G="idb://".concat(r,"/").concat(i,"/").concat(G),C[G]||(C[G]=new mt)},F=O(""),R=O(":dels"),_=I[y](w),x=_[0],_=_[1];if((y==="query"&&x.isPrimaryKey&&!w.values?R:O(x.name||"")).add(_),!x.isPrimaryKey){if(y!=="count"){var z=y==="query"&&g&&w.values&&o.query(s(s({},w),{values:!1}));return o[y].apply(this,arguments).then(function(G){if(y==="query"){if(g&&w.values)return z.then(function(be){return be=be.result,F.addKeys(be),G});var Q=w.values?G.result.map(v):G.result;(w.values?F:R).addKeys(Q)}else if(y==="openCursor"){var Y=G,ie=w.values;return Y&&Object.create(Y,{key:{get:function(){return R.addKey(Y.primaryKey),Y.key}},primaryKey:{get:function(){var be=Y.primaryKey;return R.addKey(be),be}},value:{get:function(){return ie&&F.addKey(Y.primaryKey),Y.value}}})}return G})}R.add(n)}}return o[y].apply(this,arguments)}}),S}})}};function zi(e,r,n){if(n.numFailures===0)return r;if(r.type==="deleteRange")return null;var i=r.keys?r.keys.length:"values"in r&&r.values?r.values.length:1;return n.numFailures===i?null:(r=s({},r),b(r.keys)&&(r.keys=r.keys.filter(function(o,l){return!(l in n.failures)})),"values"in r&&b(r.values)&&(r.values=r.values.filter(function(o,l){return!(l in n.failures)})),r)}function ei(e,r){return n=e,((i=r).lower===void 0||(i.lowerOpen?0<Pe(n,i.lower):0<=Pe(n,i.lower)))&&(e=e,(r=r).upper===void 0||(r.upperOpen?Pe(e,r.upper)<0:Pe(e,r.upper)<=0));var n,i}function Ui(e,r,I,i,o,l){if(!I||I.length===0)return e;var d=r.query.index,v=d.multiEntry,g=r.query.range,m=i.schema.primaryKey.extractKey,S=d.extractKey,p=(d.lowLevelIndex||d).extractKey,I=I.reduce(function(y,w){var _=y,x=[];if(w.type==="add"||w.type==="put")for(var C=new mt,O=w.values.length-1;0<=O;--O){var F,R=w.values[O],z=m(R);C.hasKey(z)||(F=S(R),(v&&b(F)?F.some(function(Y){return ei(Y,g)}):ei(F,g))&&(C.addKey(z),x.push(R)))}switch(w.type){case"add":var J=new mt().addKeys(r.values?y.map(function(ie){return m(ie)}):y),_=y.concat(r.values?x.filter(function(ie){return ie=m(ie),!J.hasKey(ie)&&(J.addKey(ie),!0)}):x.map(function(ie){return m(ie)}).filter(function(ie){return!J.hasKey(ie)&&(J.addKey(ie),!0)}));break;case"put":var q=new mt().addKeys(w.values.map(function(ie){return m(ie)}));_=y.filter(function(ie){return!q.hasKey(r.values?m(ie):ie)}).concat(r.values?x:x.map(function(ie){return m(ie)}));break;case"delete":var G=new mt().addKeys(w.keys);_=y.filter(function(ie){return!G.hasKey(r.values?m(ie):ie)});break;case"deleteRange":var Q=w.range;_=y.filter(function(ie){return!ei(m(ie),Q)})}return _},e);return I===e?e:(I.sort(function(y,w){return Pe(p(y),p(w))||Pe(m(y),m(w))}),r.limit&&r.limit<1/0&&(I.length>r.limit?I.length=r.limit:e.length===r.limit&&I.length<r.limit&&(o.dirty=!0)),l?Object.freeze(I):I)}function Gi(e,r){return Pe(e.lower,r.lower)===0&&Pe(e.upper,r.upper)===0&&!!e.lowerOpen==!!r.lowerOpen&&!!e.upperOpen==!!r.upperOpen}function io(e,r){return(function(n,i,o,l){if(n===void 0)return i!==void 0?-1:0;if(i===void 0)return 1;if((i=Pe(n,i))===0){if(o&&l)return 0;if(o)return 1;if(l)return-1}return i})(e.lower,r.lower,e.lowerOpen,r.lowerOpen)<=0&&0<=(function(n,i,o,l){if(n===void 0)return i!==void 0?1:0;if(i===void 0)return-1;if((i=Pe(n,i))===0){if(o&&l)return 0;if(o)return-1;if(l)return 1}return i})(e.upper,r.upper,e.upperOpen,r.upperOpen)}function ao(e,r,n,i){e.subscribers.add(n),i.addEventListener("abort",function(){var o,l;e.subscribers.delete(n),e.subscribers.size===0&&(o=e,l=r,setTimeout(function(){o.subscribers.size===0&&Le(l,o)},3e3))})}var oo={stack:"dbcore",level:0,name:"Cache",create:function(e){var r=e.schema.name;return s(s({},e),{transaction:function(n,i,o){var l,d,v=e.transaction(n,i,o);return i==="readwrite"&&(d=(l=new AbortController).signal,o=function(g){return function(){if(l.abort(),i==="readwrite"){for(var m=new Set,S=0,p=n;S<p.length;S++){var I=p[S],y=sr["idb://".concat(r,"/").concat(I)];if(y){var w=e.table(I),_=y.optimisticOps.filter(function(ie){return ie.trans===v});if(v._explicit&&g&&v.mutatedParts)for(var x=0,C=Object.values(y.queries.query);x<C.length;x++)for(var O=0,F=(J=C[x]).slice();O<F.length;O++)Wn((q=F[O]).obsSet,v.mutatedParts)&&(Le(J,q),q.subscribers.forEach(function(ie){return m.add(ie)}));else if(0<_.length){y.optimisticOps=y.optimisticOps.filter(function(ie){return ie.trans!==v});for(var R=0,z=Object.values(y.queries.query);R<z.length;R++)for(var J,q,G,Q=0,Y=(J=z[R]).slice();Q<Y.length;Q++)(q=Y[Q]).res!=null&&v.mutatedParts&&(g&&!q.dirty?(G=Object.isFrozen(q.res),G=Ui(q.res,q.req,_,w,q,G),q.dirty?(Le(J,q),q.subscribers.forEach(function(ie){return m.add(ie)})):G!==q.res&&(q.res=G,q.promise=$.resolve({result:G}))):(q.dirty&&Le(J,q),q.subscribers.forEach(function(ie){return m.add(ie)})))}}}m.forEach(function(ie){return ie()})}}},v.addEventListener("abort",o(!1),{signal:d}),v.addEventListener("error",o(!1),{signal:d}),v.addEventListener("complete",o(!0),{signal:d})),v},table:function(n){var i=e.table(n),o=i.schema.primaryKey;return s(s({},i),{mutate:function(l){var d=se.trans;if(o.outbound||d.db._options.cache==="disabled"||d.explicit||d.idbtrans.mode!=="readwrite")return i.mutate(l);var v=sr["idb://".concat(r,"/").concat(n)];return v?(d=i.mutate(l),l.type!=="add"&&l.type!=="put"||!(50<=l.values.length||Zn(o,l).some(function(g){return g==null}))?(v.optimisticOps.push(l),l.mutatedParts&&ln(l.mutatedParts),d.then(function(g){0<g.numFailures&&(Le(v.optimisticOps,l),(g=zi(0,l,g))&&v.optimisticOps.push(g),l.mutatedParts&&ln(l.mutatedParts))}),d.catch(function(){Le(v.optimisticOps,l),l.mutatedParts&&ln(l.mutatedParts)})):d.then(function(g){var m=zi(0,s(s({},l),{values:l.values.map(function(S,p){var I;return g.failures[p]?S:(S=(I=o.keyPath)!==null&&I!==void 0&&I.includes(".")?_e(S):s({},S),oe(S,o.keyPath,g.results[p]),S)})}),g);v.optimisticOps.push(m),queueMicrotask(function(){return l.mutatedParts&&ln(l.mutatedParts)})}),d):i.mutate(l)},query:function(l){if(!qi(se,i)||!Bi("query",l))return i.query(l);var d=((m=se.trans)===null||m===void 0?void 0:m.db._options.cache)==="immutable",p=se,v=p.requery,g=p.signal,m=(function(w,_,x,C){var O=sr["idb://".concat(w,"/").concat(_)];if(!O)return[];if(!(_=O.queries[x]))return[null,!1,O,null];var F=_[(C.query?C.query.index.name:null)||""];if(!F)return[null,!1,O,null];switch(x){case"query":var R=F.find(function(z){return z.req.limit===C.limit&&z.req.values===C.values&&Gi(z.req.query.range,C.query.range)});return R?[R,!0,O,F]:[F.find(function(z){return("limit"in z.req?z.req.limit:1/0)>=C.limit&&(!C.values||z.req.values)&&io(z.req.query.range,C.query.range)}),!1,O,F];case"count":return R=F.find(function(z){return Gi(z.req.query.range,C.query.range)}),[R,!!R,O,F]}})(r,n,"query",l),S=m[0],p=m[1],I=m[2],y=m[3];return S&&p?S.obsSet=l.obsSet:(p=i.query(l).then(function(w){var _=w.result;if(S&&(S.res=_),d){for(var x=0,C=_.length;x<C;++x)Object.freeze(_[x]);Object.freeze(_)}else w.result=_e(_);return w}).catch(function(w){return y&&S&&Le(y,S),Promise.reject(w)}),S={obsSet:l.obsSet,promise:p,subscribers:new Set,type:"query",req:l,dirty:!1},y?y.push(S):(y=[S],(I=I||(sr["idb://".concat(r,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[l.query.index.name||""]=y)),ao(S,y,v,g),S.promise.then(function(w){return{result:Ui(w.result,l,I?.optimisticOps,i,S,d)}})}})}})}};function un(e,r){return new Proxy(e,{get:function(n,i,o){return i==="db"?r:Reflect.get(n,i,o)}})}var Gt=(it.prototype.version=function(e){if(isNaN(e)||e<.1)throw new re.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new re.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var r=this._versions,n=r.filter(function(i){return i._cfg.version===e})[0];return n||(n=new this.Version(e),r.push(n),r.sort(Ja),n.stores({}),this._state.autoSchema=!1,n)},it.prototype._whenReady=function(e){var r=this;return this.idbdb&&(this._state.openComplete||se.letThrough||this._vip)?e():new $(function(n,i){if(r._state.openComplete)return i(new re.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._state.autoOpen)return void i(new re.DatabaseClosed);r.open().catch(pe)}r._state.dbReadyPromise.then(n,i)}).then(e)},it.prototype.use=function(e){var r=e.stack,n=e.create,i=e.level,o=e.name;return o&&this.unuse({stack:r,name:o}),e=this._middlewares[r]||(this._middlewares[r]=[]),e.push({stack:r,create:n,level:i??10,name:o}),e.sort(function(l,d){return l.level-d.level}),this},it.prototype.unuse=function(e){var r=e.stack,n=e.name,i=e.create;return r&&this._middlewares[r]&&(this._middlewares[r]=this._middlewares[r].filter(function(o){return i?o.create!==i:!!n&&o.name!==n})),this},it.prototype.open=function(){var e=this;return ir(Pt,function(){return Za(e)})},it.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,r=pr.indexOf(this);if(0<=r&&pr.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new $(function(n){e.dbReadyResolve=n}),e.openCanceller=new $(function(n,i){e.cancelOpen=i}))},it.prototype.close=function(n){var r=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;r?(n.isBeingOpened&&n.cancelOpen(new re.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new re.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},it.prototype.delete=function(e){var r=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",i=this._state;return new $(function(o,l){function d(){r.close(e);var v=r._deps.indexedDB.deleteDatabase(r.name);v.onsuccess=Ge(function(){var g,m,S;g=r._deps,m=r.name,S=g.indexedDB,g=g.IDBKeyRange,zn(S)||m===Yr||Bn(S,g).delete(m).catch(pe),o()}),v.onerror=Ht(l),v.onblocked=r._fireOnBlocked}if(n)throw new re.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(d):d()})},it.prototype.backendDB=function(){return this.idbdb},it.prototype.isOpen=function(){return this.idbdb!==null},it.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},it.prototype.hasFailed=function(){return this._state.dbOpenError!==null},it.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(it.prototype,"tables",{get:function(){var e=this;return h(this._allTables).map(function(r){return e._allTables[r]})},enumerable:!1,configurable:!0}),it.prototype.transaction=function(){var e=(function(r,n,i){var o=arguments.length;if(o<2)throw new re.InvalidArgument("Too few arguments");for(var l=new Array(o-1);--o;)l[o-1]=arguments[o];return i=l.pop(),[r,ce(l),i]}).apply(this,arguments);return this._transaction.apply(this,e)},it.prototype._transaction=function(e,r,n){var i=this,o=se.trans;o&&o.db===this&&e.indexOf("!")===-1||(o=null);var l,d,v=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(d=r.map(function(m){if(m=m instanceof i.Table?m.name:m,typeof m!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return m}),e=="r"||e===Tn)l=Tn;else{if(e!="rw"&&e!=Dn)throw new re.InvalidArgument("Invalid transaction mode: "+e);l=Dn}if(o){if(o.mode===Tn&&l===Dn){if(!v)throw new re.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&d.forEach(function(m){if(o&&o.storeNames.indexOf(m)===-1){if(!v)throw new re.SubTransaction("Table "+m+" not included in parent transaction.");o=null}}),v&&o&&!o.active&&(o=null)}}catch(m){return o?o._promise(null,function(S,p){p(m)}):nt(m)}var g=(function m(S,p,I,y,w){return $.resolve().then(function(){var _=se.transless||se,x=S._createTransaction(p,I,S._dbSchema,y);if(x.explicit=!0,_={trans:x,transless:_},y)x.idbtrans=y.idbtrans;else try{x.create(),x.idbtrans._explicit=!0,S._state.PR1398_maxLoop=3}catch(F){return F.name===et.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return m(S,p,I,null,w)})):nt(F)}var C,O=at(w);return O&&vr(),_=$.follow(function(){var F;(C=w.call(x,x))&&(O?(F=Jt.bind(null,null),C.then(F,F)):typeof C.next=="function"&&typeof C.throw=="function"&&(C=Xn(C)))},_),(C&&typeof C.then=="function"?$.resolve(C).then(function(F){return x.active?F:nt(new re.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):_.then(function(){return C})).then(function(F){return y&&x._resolve(),x._completion.then(function(){return F})}).catch(function(F){return x._reject(F),nt(F)})})}).bind(null,this,l,d,o,n);return o?o._promise(l,g,"lock"):se.trans?ir(se.transless,function(){return i._whenReady(g)}):this._whenReady(g)},it.prototype.table=function(e){if(!V(this._allTables,e))throw new re.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},it);function it(e,r){var n=this;this._middlewares={},this.verno=0;var i=it.dependencies;this._options=r=s({addons:it.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange},i=r.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o,l,d,v,g,m={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:pe,dbReadyPromise:null,cancelOpen:pe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:r.autoOpen};m.dbReadyPromise=new $(function(p){m.dbReadyResolve=p}),m.openCanceller=new $(function(p,I){m.cancelOpen=I}),this._state=m,this.name=e,this.on=Cr(this,"populate","blocked","versionchange","close",{ready:[lt,pe]}),this.once=function(p,I){var y=function(){for(var w=[],_=0;_<arguments.length;_++)w[_]=arguments[_];n.on(p).unsubscribe(y),I.apply(n,w)};return n.on(p,y)},this.on.ready.subscribe=j(this.on.ready.subscribe,function(p){return function(I,y){it.vip(function(){var w,_=n._state;_.openComplete?(_.dbOpenError||$.resolve().then(I),y&&p(I)):_.onReadyBeingFired?(_.onReadyBeingFired.push(I),y&&p(I)):(p(I),w=n,y||p(function x(){w.on.ready.unsubscribe(I),w.on.ready.unsubscribe(x)}))})}}),this.Collection=(o=this,Ar(qa.prototype,function(C,x){this.db=o;var y=_i,w=null;if(x)try{y=x()}catch(O){w=O}var _=C._ctx,x=_.table,C=x.hook.reading.fire;this._ctx={table:x,index:_.index,isPrimKey:!_.index||x.schema.primKey.keyPath&&_.index===x.schema.primKey.name,range:y,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:w,or:_.or,valueMapper:C!==qe?C:null}})),this.Table=(l=this,Ar(Ai.prototype,function(p,I,y){this.db=l,this._tx=y,this.name=p,this.schema=I,this.hook=l._allTables[p]?l._allTables[p].hook:Cr(null,{creating:[ut,pe],reading:[gt,qe],updating:[rt,pe],deleting:[pt,pe]})})),this.Transaction=(d=this,Ar(Ua.prototype,function(p,I,y,w,_){var x=this;p!=="readonly"&&I.forEach(function(C){C=(C=y[C])===null||C===void 0?void 0:C.yProps,C&&(I=I.concat(C.map(function(O){return O.updatesTable})))}),this.db=d,this.mode=p,this.storeNames=I,this.schema=y,this.chromeTransactionDurability=w,this.idbtrans=null,this.on=Cr(this,"complete","error","abort"),this.parent=_||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $(function(C,O){x._resolve=C,x._reject=O}),this._completion.then(function(){x.active=!1,x.on.complete.fire()},function(C){var O=x.active;return x.active=!1,x.on.error.fire(C),x.parent?x.parent._reject(C):O&&x.idbtrans&&x.idbtrans.abort(),nt(C)})})),this.Version=(v=this,Ar($a.prototype,function(p){this.db=v,this._cfg={version:p,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(g=this,Ar(Ti.prototype,function(p,I,y){if(this.db=g,this._ctx={table:p,index:I===":id"?null:I,or:y},this._cmp=this._ascending=Pe,this._descending=function(w,_){return Pe(_,w)},this._max=function(w,_){return 0<Pe(w,_)?w:_},this._min=function(w,_){return Pe(w,_)<0?w:_},this._IDBKeyRange=g._deps.IDBKeyRange,!this._IDBKeyRange)throw new re.MissingAPI})),this.on("versionchange",function(p){0<p.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(p){!p.newVersion||p.newVersion<p.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(p.oldVersion/10))}),this._maxKey=Er(r.IDBKeyRange),this._createTransaction=function(p,I,y,w){return new n.Transaction(p,I,y,n._options.chromeTransactionDurability,w)},this._fireOnBlocked=function(p){n.on("blocked").fire(p),pr.filter(function(I){return I.name===n.name&&I!==n&&!I._state.vcFired}).map(function(I){return I.on("versionchange").fire(p)})},this.use(ro),this.use(oo),this.use(no),this.use(eo),this.use(to);var S=new Proxy(this,{get:function(p,I,y){if(I==="_vip")return!0;if(I==="table")return function(_){return un(n.table(_),S)};var w=Reflect.get(p,I,y);return w instanceof Ai?un(w,S):I==="tables"?w.map(function(_){return un(_,S)}):I==="_createTransaction"?function(){return un(w.apply(this,arguments),S)}:w}});this.vip=S,i.forEach(function(p){return p(n)})}var dn,Dt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",so=(ti.prototype.subscribe=function(e,r,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:r,complete:n})},ti.prototype[Dt]=function(){return this},ti);function ti(e){this._subscribe=e}try{dn={indexedDB:f.indexedDB||f.mozIndexedDB||f.webkitIndexedDB||f.msIndexedDB,IDBKeyRange:f.IDBKeyRange||f.webkitIDBKeyRange}}catch{dn={indexedDB:null,IDBKeyRange:null}}function Wi(e){var r,n=!1,i=new so(function(o){var l=at(e),d,v=!1,g={},m={},S={get closed(){return v},unsubscribe:function(){v||(v=!0,d&&d.abort(),p&&$t.storagemutated.unsubscribe(y))}};o.start&&o.start(S);var p=!1,I=function(){return Fn(w)},y=function(_){sn(g,_),Wn(m,g)&&I()},w=function(){var _,x,C;!v&&dn.indexedDB&&(g={},_={},d&&d.abort(),d=new AbortController,C=(function(O){var F=fr();try{l&&vr();var R=Yt(e,O);return R=l?R.finally(Jt):R}finally{F&&hr()}})(x={subscr:_,signal:d.signal,requery:I,querier:e,trans:null}),Promise.resolve(C).then(function(O){n=!0,r=O,v||x.signal.aborted||(g={},(function(F){for(var R in F)if(V(F,R))return;return 1})(m=_)||p||($t(Or,y),p=!0),Fn(function(){return!v&&o.next&&o.next(O)}))},function(O){n=!1,["DatabaseClosedError","AbortError"].includes(O?.name)||v||Fn(function(){v||o.error&&o.error(O)})}))};return setTimeout(I,0),S});return i.hasValue=function(){return n},i.getValue=function(){return r},i}var lr=Gt;function ri(e){var r=Zt;try{Zt=!0,$t.storagemutated.fire(e),Qn(e,!0)}finally{Zt=r}}D(lr,s(s({},tt),{delete:function(e){return new lr(e,{addons:[]}).delete()},exists:function(e){return new lr(e,{addons:[]}).open().then(function(r){return r.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return r=lr.dependencies,n=r.indexedDB,r=r.IDBKeyRange,(zn(n)?Promise.resolve(n.databases()).then(function(i){return i.map(function(o){return o.name}).filter(function(o){return o!==Yr})}):Bn(n,r).toCollection().primaryKeys()).then(e)}catch{return nt(new re.MissingAPI)}var r,n},defineClass:function(){return function(e){P(this,e)}},ignoreTransaction:function(e){return se.trans?ir(se.transless,e):e()},vip:Un,async:function(e){return function(){try{var r=Xn(e.apply(this,arguments));return r&&typeof r.then=="function"?r:$.resolve(r)}catch(n){return nt(n)}}},spawn:function(e,r,n){try{var i=Xn(e.apply(n,r||[]));return i&&typeof i.then=="function"?i:$.resolve(i)}catch(o){return nt(o)}},currentTransaction:{get:function(){return se.trans||null}},waitFor:function(e,r){return r=$.resolve(typeof e=="function"?lr.ignoreTransaction(e):e).timeout(r||6e4),se.trans?se.trans.waitFor(r):r},Promise:$,debug:{get:function(){return Ue},set:function(e){It(e)}},derive:L,extend:P,props:D,override:j,Events:Cr,on:$t,liveQuery:Wi,extendObservabilitySet:sn,getByKeyPath:te,setByKeyPath:oe,delByKeyPath:function(e,r){typeof r=="string"?oe(e,r,void 0):"length"in r&&[].map.call(r,function(n){oe(e,n,void 0)})},shallowClone:he,deepClone:_e,getObjectDiff:$n,cmp:Pe,asap:le,minKey:-1/0,addons:[],connections:pr,errnames:et,dependencies:dn,cache:sr,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,r,n){return e+r/Math.pow(10,2*n)})})),lr.maxKey=Er(lr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&($t(Or,function(e){Zt||(e=new CustomEvent(Ln,{detail:e}),Zt=!0,dispatchEvent(e),Zt=!1)}),addEventListener(Ln,function(e){e=e.detail,Zt||ri(e)}));var br,Zt=!1,Yi=function(){};return typeof BroadcastChannel<"u"&&((Yi=function(){(br=new BroadcastChannel(Ln)).onmessage=function(e){return e.data&&ri(e.data)}})(),typeof br.unref=="function"&&br.unref(),$t(Or,function(e){Zt||br.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Gt.disableBfCache&&e.persisted){Ue&&console.debug("Dexie: handling persisted pagehide"),br?.close();for(var r=0,n=pr;r<n.length;r++)n[r].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Gt.disableBfCache&&e.persisted&&(Ue&&console.debug("Dexie: handling persisted pageshow"),Yi(),ri({all:new mt(-1/0,[[]])}))})),$.rejectionMapper=function(e,r){return!e||e instanceof fe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!xt[e.name]?e:(r=new xt[e.name](r||e.message,e),"stack"in e&&M(r,"stack",{get:function(){return this.inner.stack}}),r)},It(Ue),s(Gt,Object.freeze({__proto__:null,Dexie:Gt,liveQuery:Wi,Entity:Si,cmp:Pe,PropModification:kr,replacePrefix:function(e,r){return new kr({replacePrefix:[e,r]})},add:function(e){return new kr({add:e})},remove:function(e){return new kr({remove:e})},default:Gt,RangeSet:mt,mergeRanges:Dr,rangesOverlap:Ri}),{default:Gt}),Gt})})(bn)),bn.exports}var el=Zs();const si=$o(el),ha=Symbol.for("Dexie"),_n=globalThis[ha]||(globalThis[ha]=si);if(si.semVer!==_n.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${si.semVer} and ${_n.semVer}`);const{liveQuery:Qu,mergeRanges:Xu,rangesOverlap:$u,RangeSet:Zu,cmp:ed,Entity:td,PropModification:rd,replacePrefix:nd,add:id,remove:ad,DexieYProvider:od}=_n,Hr="current";class tl extends _n{uprnSelections;areaSelections;dataSelections;userDownloads;constructor(){super("app-db2"),this.version(2).stores({uprnSelections:"&id",areaSelections:"++id, layerId, *areaIds",dataSelections:"++id, layerId, *fields",userDownloads:"++id, &localId, createdAt"}),this.on("populate",async t=>{if(console.log("[db] Populating database with initial data"),await t.table("uprnSelections").get(Hr)){console.log("[db] Initial UPRN selection already exists");return}await t.table("uprnSelections").add({id:"current",areas:null,data:[]}),console.log("[db] Initial UPRN selection created")})}}const rr=new tl,Pa=async()=>await rr.uprnSelections.get(Hr),Nr=async k=>{let t=await Pa();t||(t={id:Hr,areas:null,data:[]},await rr.uprnSelections.add(t)),console.log("[db] Updating UPRN selection with patch:",k,"current:",t),await rr.uprnSelections.update(Hr,k)},rl=async()=>{await rr.uprnSelections.put({id:Hr,areas:null,data:[]})},nl=async(k,t,a)=>await rr.userDownloads.add({localId:k,areaSelection:t,dataSelections:a,status:er.Pending,createdAt:Date.now()}),il=async(k,t,a,s)=>{const u={};t!==void 0&&(u.externalId=t),a!==void 0&&(u.areaSelection=a),s!==void 0&&(u.dataSelections=s),Object.keys(u).length!==0&&await rr.userDownloads.where("localId").equals(k).modify(u)},al=async()=>await rr.userDownloads.orderBy("createdAt").reverse().toArray(),ol=async k=>await rr.userDownloads.where("localId").equals(k).delete();class sl{#e=ne(Re(new wt));constructor(){this.#t()}addDownload(t){console.log("[downloads-store] Adding download:",t),c(this.#e).set(t.localId,t),nl(t.localId,t.areaSelection,t.dataSelections)}updateDownloadStatus(t){console.log("[downloads-store] Updating download status:",t),c(this.#e).set(t.localId,{...t}),il(t.localId,t.externalId,t.areaSelection,t.dataSelections)}removeDownload(t){c(this.#e).delete(t),ol(t)}getDownloads(){return Array.from(c(this.#e).values())}async#t(){const t=await al();!t||t.length===0||(console.log("Loaded downloads from DB:",t),t.forEach(a=>{c(this.#e).set(a.localId,{localId:a.localId,status:er.Pending,areaSelection:a.areaSelection,dataSelections:a.dataSelections})}))}}const Lr=new sl;function ll(k,t){const a=_a(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]];Ia(k,Rt({name:"download"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=de(),b=Z(h);ka(b,t,"default",{}),T(u,h)},$$slots:{default:!0}}))}var cl=ae('<div class="data-item svelte-v4uih6"><span class="data-name svelte-v4uih6"> </span> <div class="data-actions svelte-v4uih6"><!></div></div>');function li(k,t){const a=Ve(t,"title",3,"");In(k,{class:"data-item-card",children:(s,u)=>{var f=cl(),h=ee(f),b=ee(h,!0);X(h);var P=ue(h,2),A=ee(P);Ze(A,()=>t.children??Ke),X(P),X(f),ct(()=>{hi(h,"title",a()),Ct(b,a())}),T(s,f)},$$slots:{default:!0}})}var ul=ae("<!> <!> <!> <!>",1),dl=ae('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),fl=ae('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),hl=ae('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function vl(k,t){De(t,!0);let a=ne(Re(new Set));const s=Ce(()=>Lr.getDownloads()),u={completed:{color:"#059669",text:"Completed",icon:Co},"in-progress":{color:"#2563eb",text:"In Progress",icon:ko},failed:{color:"#dc2626",text:"Failed",icon:Qo},pending:{color:"#6b7280",text:"Pending",icon:Jo}};Rr(()=>{const K=setInterval(()=>{f()},5e3);return()=>{clearInterval(K)}}),je(()=>{if(!c(s)||c(s).length<=0||!t.uprnDownloadService)return;(async()=>{for(const N of c(s)){if(N.externalId||N.status!==er.Pending)continue;const H={exports:{areaSelectionLayer:{remoteId:N.areaSelection.layerId,areas:N.areaSelection.areaFieldInfos.map(U=>U.code)},dataSelectionLayers:N.dataSelections.map(U=>({remoteId:U.layerId,fields:U.fields.filter(le=>!t.fieldsToHide||!t.fieldsToHide.has(le))}))}};console.log("[downloads-menu] Submitting download request:",H);const j=await t.uprnDownloadService.requestJob(H);if(!j||j.type===Xs.Error){console.error("[downloads-menu] Failed to submit download request.",j);continue}N.externalId=j.guid,N.status=er.InProgress,Lr.updateDownloadStatus(N)}})()});async function f(){if(c(s).length<=0||!t.uprnDownloadService)return;const K={jobs:c(s).filter(H=>H.externalId).map(H=>H.externalId)},N=await t.uprnDownloadService.requestJobStatuses(K);if(!N){console.error("[downloads-menu] Failed to get job statuses.",N);return}for(const H of N.jobs){const j=c(s).find(U=>U.externalId===H.guid);if(!j){console.warn("[downloads-menu] Received job status for unknown download:",H.guid);continue}switch(H.status.type){case mn.Submitted:case mn.Processing:j.status=er.InProgress;break;case mn.Completed:j.status=er.Completed;break;case mn.Error:j.status=er.Failed;break;default:console.warn("[downloads-menu] Unknown job status type:",H.status.type);break}Lr.updateDownloadStatus(j)}}function h(K){Lr.removeDownload(K)}async function b(K){try{await navigator.clipboard.writeText(K),B(a,new Set(c(a)).add(K),!0),Mr.success("URL copied to clipboard"),setTimeout(()=>{const N=new Set(c(a));N.delete(K),B(a,N,!0)},2e3)}catch(N){console.error("Failed to copy URL:",N),Mr.error("Failed to copy URL to clipboard")}}function P(K){return u[K]?.color??u.pending.color}function A(K){return u[K]?.text??u.pending.text}function E(K){return u[K]?.icon??u.pending.icon}function V(K){return t.uprnDownloadService.getDownloadUrl(K)}var D=hl(),W=ue(ee(D),2);{var M=K=>{var N=dl(),H=Z(N);qt(H,21,()=>c(s),_r,(le,te)=>{{let oe=Ce(()=>c(te).externalId?c(te).externalId:"Pending...");li(le,{get title(){return c(oe)},children:(he,Ie)=>{var ce=ul(),ye=Z(ce);{let ke=Ce(()=>P(c(te).status)),Le=Ce(()=>A(c(te).status));Nt(ye,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${c(ke)??""}`},get title(){return c(Le)},disabled:!0,children:(ge,Ee)=>{const at=Ce(()=>E(c(te).status));var ot=de(),fe=Z(ot);{let Me=Ce(()=>c(te).status==="in-progress"?"spinning":"");Oe(fe,()=>c(at),(Xe,Ae)=>{Ae(Xe,{size:14,get class(){return c(Me)}})})}T(ge,ot)},$$slots:{default:!0}})}var Se=ue(ye,2);{var _e=ke=>{Nt(ke,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>b(V(c(te).externalId)),title:"Copy URL to clipboard",children:(Le,ge)=>{var Ee=de(),at=Z(Ee);{var ot=Me=>{xo(Me,{size:14})},fe=Me=>{Io(Me,{size:14})};ve(at,Me=>{c(a).has(V(c(te).externalId))?Me(ot):Me(fe,!1)})}T(Le,Ee)},$$slots:{default:!0}})};ve(Se,ke=>{c(te).externalId&&ke(_e)})}var Fe=ue(Se,2);{var Be=ke=>{Nt(ke,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(V(c(te).externalId),"_blank"),title:"Open download",children:(Le,ge)=>{ll(Le,{})},$$slots:{default:!0}})};ve(Fe,ke=>{c(te).externalId&&c(te).status==="completed"&&ke(Be)})}var Qe=ue(Fe,2);Nt(Qe,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>h(c(te).localId),title:"Remove from queue",children:(ke,Le)=>{ur();var ge=wr("Ã");T(ke,ge)},$$slots:{default:!0}}),T(he,ce)},$$slots:{default:!0}})}}),X(H);var j=ue(H,2),U=ee(j);X(j),ct(()=>Ct(U,`${c(s).length??""} download(s) in queue`)),T(K,N)},L=K=>{var N=fl();T(K,N)};ve(W,K=>{c(s).length>0?K(M):K(L,!1)})}X(D),T(k,D),Ne()}function pl(k,t){const a=_a(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];Ia(k,Rt({name:"trash"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=de(),b=Z(h);ka(b,t,"default",{}),T(u,h)},$$slots:{default:!0}}))}function gl(k,t){De(t,!0);{let a=Ce(()=>Kr("size-7 border-1 border-destructive",t.class));Nt(k,{onclick:()=>t.clear(),variant:"ghost",get class(){return c(a)},title:"Clear all selections",children:(s,u)=>{pl(s,{class:"text-destructive"})},$$slots:{default:!0}})}Ne()}class ml{#e=ne(Re(new wt));get dataSelections(){return c(this.#e)}set dataSelections(t){B(this.#e,t,!0)}addSelection(t){this.dataSelections.set(t.layerId,t)}updateSelection(t,a){const s=this.dataSelections.get(t);if(!s){console.warn(`[data-selection-store] no existing selection for layerId ${t}`);return}s.selectedFieldIds=new Ft(a),this.dataSelections.set(t,{...s})}addOrUpdateSelection(t,a){const s=this.dataSelections.get(t);if(s)s.selectedFieldIds=new Ft(a),this.dataSelections.set(t,{...s});else{const u={layerId:t,selectedFieldIds:new Ft(a)};this.dataSelections.set(t,u)}}removeSelection(t){this.dataSelections.delete(t)}getSelection(t){return this.dataSelections.get(t)}getAllSelections(){return Array.from(this.dataSelections.values())}clearSelections(){this.dataSelections.clear(),console.log("[data-selection-store] selections cleared.")}cleanup(){this.dataSelections.clear()}}var yl=ae('<div class="export-footer svelte-10dgoyk"><div class="export-footer__left svelte-10dgoyk"><p class="text-sm text-muted-foreground svelte-10dgoyk">Click "Export" to begin the download.</p></div> <div class="export-footer__right svelte-10dgoyk"><!> <!></div></div>');function bl(k,t){De(t,!0);function a(){if(t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size<=0){Mr.error("Please select at least one area to export.");return}if(t.dataSelectionStore.getAllSelections().length<=0){Mr.error("Please select at least one data layer to export.");return}console.log("Starting export..."),(async()=>{const P=await t.areaSelectionInteractionStore.getAreaCodesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),A=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().map(([W,M],L)=>({id:W,code:P[L]})).toArray(),E={layerId:t.areaSelectionInteractionStore.selectionViewState.layerView?.layer.id||"",areaFieldInfos:A},V=t.dataSelectionStore.getAllSelections().map(W=>({layerId:W.layerId,fields:Array.from(W.selectedFieldIds)})),D=crypto.randomUUID();Lr.addDownload({localId:D,status:er.Pending,areaSelection:E,dataSelections:V}),t.onExportSuccess?.()})()}var s=yl(),u=ue(ee(s),2),f=ee(u);gl(f,{class:"mr-4",get clear(){return t.clearSelections}});var h=ue(f,2);Nt(h,{onclick:a,title:"Export",children:(b,P)=>{ur();var A=wr("Export");T(b,A)},$$slots:{default:!0}}),X(u),X(s),T(k,s),Ne()}class wl{#e=ne(null);get ActiveLayer(){return c(this.#e)}set ActiveLayer(t){B(this.#e,t,!0)}}class _l{#e=ne(!1);get isLoaded(){return c(this.#e)}set isLoaded(t){B(this.#e,t,!0)}#t=ne(null);get data(){return c(this.#t)}set data(t){B(this.#t,t,!0)}#r=Ce(()=>{const t=new wt;function a(s){t.set(s.id,s),s.type==="group"&&s.layers.forEach(f=>{a(f)})}return this.data&&this.data.layers.forEach(s=>{a(s)}),t});get dataLookup(){return c(this.#r)}set dataLookup(t){B(this.#r,t)}#n=ne(!1);get loading(){return c(this.#n)}set loading(t){B(this.#n,t,!0)}#i=ne(null);get error(){return c(this.#i)}set error(t){B(this.#i,t,!0)}async initializeAsync(t){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:a,itemId:s,proxy:u}=t;await this.configurePortalAsync(a,u),await this.loadwebmapAsync(s)}catch(a){console.error("Error initializing webmap:",a),this.error=a.message}finally{this.loading=!1}}}async configurePortalAsync(t,a){if(!t||(Zi.portalUrl=t,console.log(Zi),!a))return;const{addProxyRule:s}=os;console.log("Adding proxy rule for portal traffic"),s({urlPrefix:a?.urlPrefix,proxyUrl:a?.proxyUrl})}async loadwebmapAsync(t){if(this.data)return;const a=new as({id:t}),s=new is({portalItem:a});this.data=s,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}function Sl(k,t){k.stopPropagation(),t.onFilterClicked?.(t.layerId)}var xl=ae('<button title="Filter"><!></button>');function Il(k,t){De(t,!0);let a=ne(Re(t.hasFiltersApplied?.(t.layerId)??!1));je(()=>{B(a,t.hasFiltersApplied?.(t.layerId)??!1,!0)});const s=Ce(()=>c(a)?Ao:Po);var u=xl();let f;u.__click=[Sl,t];var h=ee(u);jr(h,()=>c(s)),X(u),ct(b=>{f=vi(u,1,"filter-btn svelte-k95pvd",null,f,b),hi(u,"aria-pressed",c(a))},[()=>({active:c(a)})]),T(k,u),Ne()}Cn(["click"]);var kl=ae('<ul class="selected-list"></ul> <p class="count svelte-81yb5c"> </p>',1),Cl=ae('<p class="no-selection svelte-81yb5c">No areas selected</p>'),Al=ae("<!> <!>",1),Pl=ae('<ul></ul> <p class="count svelte-81yb5c"> </p>',1),Ol=ae('<p class="no-selection svelte-81yb5c">No data selected</p>'),El=ae('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function Fl(k,t){De(t,!0);const a=Ve(t,"fieldFilterMenuStore",7);let s=ne(Re([]));je(()=>{if(!t.areaSelectionInteractionStore){B(s,[],!0);return}if(!t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size){B(s,[],!0);return}(async()=>{const U=await t.areaSelectionInteractionStore.getAreaNamesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),le=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().toArray().map(([oe,he])=>({id:oe,handle:he})),te=[];for(let oe=0;oe<U.length;oe++)te.push({name:U[oe]||"Unknown Area",HighlightAreaInfo:le[oe]});B(s,te,!0)})()});function u(j){const U=c(s).findIndex(le=>le.name===j);U!==-1&&t.areaSelectionInteractionStore.removeSelectedArea(c(s)[U]?.HighlightAreaInfo.id)}function f(j){console.log("[export-menu] Removing data selection for layerId:",j),t.dataSelectionStore.removeSelection(j),console.log("[export-menu] Current SelectedData:",ai(t.dataSelectionStore.getAllSelections()))}function h(j){if(a().ActiveLayer?.id===j){a().ActiveLayer=null;return}const U=t.webMapStore.dataLookup.get(j);if(!U){console.warn(`[export-menu] Layer with ID ${j} not found in web map store.`);return}a().ActiveLayer=U}function b(j){const U=t.dataSelectionStore.getSelection(j);return!(!U||!U.selectedFieldIds||U.selectedFieldIds.size===0||U.selectedFieldIds.size===t.webMapStore.dataLookup.get(j)?.fields?.length)}var P=El(),A=ue(Z(P),2),E=ee(A),V=ee(E,!0);X(E);var D=ue(E,4);{var W=j=>{var U=kl(),le=Z(U);qt(le,21,()=>c(s),_r,(he,Ie)=>{li(he,{get title(){return c(Ie).name},children:(ce,ye)=>{Nt(ce,{variant:"ghost",size:"sm",class:"area-remove-btn",title:"Remove area",onclick:()=>u(c(Ie).name),children:(Se,_e)=>{ur();var Fe=wr("Ã");T(Se,Fe)},$$slots:{default:!0}})},$$slots:{default:!0}})}),X(le);var te=ue(le,2),oe=ee(te);X(te),ct(()=>Ct(oe,`${c(s).length??""} area(s) selected`)),T(j,U)},M=j=>{var U=Cl();T(j,U)};ve(D,j=>{c(s).length>0?j(W):j(M,!1)})}X(A);var L=ue(A,2),K=ue(ee(L),2);{var N=j=>{var U=Pl(),le=Z(U);qt(le,21,()=>t.dataSelectionStore.getAllSelections(),_r,(he,Ie)=>{{let ce=Ce(()=>t.webMapStore.dataLookup.get(c(Ie).layerId)?.title??"");li(he,{get title(){return c(ce)},children:(ye,Se)=>{var _e=Al(),Fe=Z(_e);{var Be=ke=>{Il(ke,{get layerId(){return c(Ie).layerId},onFilterClicked:h,hasFiltersApplied:b})};ve(Fe,ke=>{t.dataSelectionTreeviewConfig?.getItemConfig(c(Ie).layerId)?.showFields&&ke(Be)})}var Qe=ue(Fe,2);Nt(Qe,{variant:"ghost",size:"sm",class:"data-remove-btn",title:"Remove data selection",onclick:()=>f(c(Ie).layerId),children:(ke,Le)=>{ur();var ge=wr("Ã");T(ke,ge)},$$slots:{default:!0}}),T(ye,_e)},$$slots:{default:!0}})}}),X(le);var te=ue(le,2),oe=ee(te);X(te),ct(he=>Ct(oe,`${he??""} data layer(s) selected`),[()=>t.dataSelectionStore.getAllSelections().length]),T(j,U)},H=j=>{var U=Ol();T(j,U)};ve(K,j=>{t.dataSelectionStore.getAllSelections().length>0?j(N):j(H,!1)})}X(L),ct(()=>Ct(V,t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer?t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer.title:"No Area Layer Selected")),T(k,P),Ne()}function Tl(k,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];xr(k,Rt({name:"arrow-down-to-line"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=de(),b=Z(h);Ze(b,()=>t.children??Ke),T(u,h)},$$slots:{default:!0}})),Ne()}function Dl(k,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"m18 15-6-6-6 6"}]];xr(k,Rt({name:"chevron-up"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=de(),b=Z(h);Ze(b,()=>t.children??Ke),T(u,h)},$$slots:{default:!0}})),Ne()}function Nl(k,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]];xr(k,Rt({name:"maximize"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=de(),b=Z(h);Ze(b,()=>t.children??Ke),T(u,h)},$$slots:{default:!0}})),Ne()}function Vl(k,t){De(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Tt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]];xr(k,Rt({name:"minimize"},()=>a,{get iconNode(){return s},children:(u,f)=>{var h=de(),b=Z(h);Ze(b,()=>t.children??Ke),T(u,h)},$$slots:{default:!0}})),Ne()}function Ll(k,t){k.target===k.currentTarget&&t()}var Rl=(k,t)=>k.key==="Escape"&&t(),Ml=(k,t,a)=>t(c(a).name),jl=ae('<div class="info-icon-container svelte-fp5rsc"><!></div>'),Hl=ae('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),Kl=ae('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),ql=ae("<!> <!>",1),Bl=ae("<!> <!>",1),zl=ae('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),Ul=ae('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Gl(k,t){De(t,!0);const a=Ve(t,"fieldFilterMenuStore",7);let s=ne(null),u=ne(Re(new Ft)),f=Ce(()=>{if(!c(s)||!c(s).fields)return{checked:!1,indeterminate:!1};const M=c(s).fields.length,L=c(u)?.size||0;return L===0?{checked:!1,indeterminate:!1}:L===M?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});je(()=>{const M=a().ActiveLayer;if(!M){B(s,null),B(u,new Ft,!0);return}B(s,M,!0);const L=t.dataSelectionStore.getSelection(M.id);L?.selectedFieldIds?B(u,new Ft([...L.selectedFieldIds]),!0):B(u,new Ft,!0)});function h(){b(),a().ActiveLayer=null}function b(){if(!c(s))return;let M=t.dataSelectionStore.getSelection(c(s).id);if(M){if((M.selectedFieldIds===void 0||M.selectedFieldIds===null)&&(M.selectedFieldIds=new Ft),c(u).size===0){t.dataSelectionStore.removeSelection(c(s).id);return}M.selectedFieldIds.clear(),c(u).forEach(L=>{M.selectedFieldIds?.add(L)})}}function P(M){c(s)&&(c(u).has(M)?c(u).delete(M):c(u).add(M))}function A(){if(!c(s)?.fields)return;(c(u)?.size||0)===0?c(s).fields.forEach(L=>{c(u).add(L.name)}):c(u).clear()}function E(){if(!c(s)?.fields)return[];const M=c(s).fields.filter(L=>!t.fieldsToHide.has(L.name.toLowerCase()));return console.log("Filtered fields to show:",M,t.fieldsToHide,c(s).fields),M}var V=de(),D=Z(V);{var W=M=>{var L=Ul();L.__click=[Ll,h],L.__keydown=[Rl,h];var K=ee(L);Oe(K,()=>In,(N,H)=>{H(N,{class:"command-card",children:(j,U)=>{var le=zl(),te=Z(le);te.__click=h;var oe=ee(te);ss(oe,{size:20}),X(te);var he=ue(te,2);Oe(he,()=>kn,(Ie,ce)=>{ce(Ie,{class:"card-content",children:(ye,Se)=>{var _e=de(),Fe=Z(_e);Oe(Fe,()=>es,(Be,Qe)=>{Qe(Be,{children:(ke,Le)=>{var ge=Bl(),Ee=Z(ge);Oe(Ee,()=>ls,(ot,fe)=>{fe(ot,{placeholder:"Search for fields..."})});var at=ue(Ee,2);Oe(at,()=>ts,(ot,fe)=>{fe(ot,{children:(Me,Xe)=>{var Ae=ql(),et=Z(Ae);Oe(et,()=>rs,(re,xt)=>{xt(re,{children:(tt,pe)=>{ur();var qe=wr("No results found.");T(tt,qe)},$$slots:{default:!0}})});var At=ue(et,2);Oe(At,()=>cs,(re,xt)=>{xt(re,{heading:"Fields",children:(tt,pe)=>{var qe=Kl(),gt=Z(qe),ze=ee(gt);Ji(ze,{get checked(){return c(f).checked},get indeterminate(){return c(f).indeterminate},onCheckedChange:A}),ur(2),X(gt);var ut=ue(gt,2);Oe(ut,()=>Oo,(rt,st)=>{st(rt,{})});var pt=ue(ut,2);qt(pt,17,E,_r,(rt,st)=>{var lt=de(),Ue=Z(lt);Oe(Ue,()=>ns,(It,Vt)=>{Vt(It,{class:"field-item",onselect:()=>P(c(st).name),children:(kt,Mt)=>{var Ye=Hl(),dt=ee(Ye);{let zt=Ce(()=>c(u)?.has(c(st).name)??!1);Ji(dt,{class:"field-checkbox",get checked(){return c(zt)},onCheckedChange:()=>P(c(st).name)})}var _t=ue(dt,2);_t.__click=[Ml,P,st];var $e=ee(_t),ft=ee($e),jt=ee(ft,!0);X(ft);var Bt=ue(ft,2);{var dr=zt=>{var Pt=jl(),se=ee(Pt);jr(se,()=>Eo),X(Pt),ct(()=>hi(Pt,"title",c(st).description)),T(zt,Pt)};ve(Bt,zt=>{c(st).description&&zt(dr)})}X($e),X(_t),X(Ye),ct(()=>Ct(jt,c(st).alias||c(st).name)),T(kt,Ye)},$$slots:{default:!0}})}),T(rt,lt)}),T(tt,qe)},$$slots:{default:!0}})}),T(Me,Ae)},$$slots:{default:!0}})}),T(ke,ge)},$$slots:{default:!0}})}),T(ye,_e)},$$slots:{default:!0}})}),T(j,le)},$$slots:{default:!0}})}),X(L),T(M,L)};ve(D,M=>{c(s)&&M(W)})}T(k,V),Ne()}Cn(["click","keydown"]);class Oa{id;name;children;parent;constructor(t,a,s=[],u=null){this.id=t,this.name=a,this.children=s,this.parent=u}}class Je extends Oa{layer;constructor(t,a,s,u=[],f=null){super(t,a,u,f),this.layer=s}}class Sr extends Je{featureLayer;field;constructor(t,a,s,u,f=[],h=null){super(t,a,s,f,h),this.field=u,this.featureLayer=s}}var We=(k=>(k.Inactive="inactive",k.Indeterminate="indeterminate",k.Active="active",k))(We||{}),tr=(k=>(k.Hidden="hidden",k.Suspended="suspended",k.Visible="visible",k))(tr||{});class Ea{#e=ne(!1);get initialized(){return c(this.#e)}set initialized(t){B(this.#e,t,!0)}#t=null;#r=null;#n=ne(Re([]));#i=Ce(()=>{const t=new wt;return this.#S(c(this.#n),t),t});#a=ne(Re(new wt));#s=ne(Re(new wt));#l=ne(Re(new wt));#c=ne(Re(new wt));#f=ne(Re(new wt));#h=null;initialize(t,a,s,u,f){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!a)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=a,u)for(const h of u)c(this.#f).set(h.id,h);if(f&&(this.#h=f),!t)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#r=s,this.#m(t),B(this.#n,this.#y(t),!0)}getNodeById(t){return this.#u(),c(this.#i).get(t)}getNodes(){return this.#u(),c(this.#n)}getVisibleNodes(){this.#u();const t=[];for(const[a,s]of c(this.#a)){if(!s)continue;const u=c(this.#i).get(a);u&&t.push(u)}return t}getNonHiddenNodes(){return this.#u(),this.#o(c(this.#n))}clearSelections(){this.#u();for(const t of c(this.#a).keys()){c(this.#a).set(t,!1);const a=c(this.#i).get(t);a&&a instanceof Je&&(a.layer.visible=!1)}c(this.#c).clear()}#o(t){this.#u();const a=[];for(const s of t){const u=this.#v(s.id);if(!(u&&u.isHidden)&&(a.push(s),s.children?.length)){const f=this.#o(s.children);a.push(...f)}}return a}getVisibilityState(t){return this.#u(),c(this.#a).get(t)??!1}setVisibilityState(t,a){this.#u();const s=c(this.#i).get(t);if(!s)throw new Error(`Tree node not found for ID: ${t}`);if(!(s instanceof Je))throw new Error(`Tree node is not a layer node: ${t}`);const u=this.#v(t);if(u?.disableVisibilityToggle||(c(this.#a).set(t,a),s.layer.visible=a,this.updateDrawState(s,a),s instanceof Sr&&(s.featureLayer.displayField=a?s.field.name:"",a&&this.#h&&(console.log("[TreeviewStore] Applying custom renderer for field:",s.field.name),this.#h.applyCustomRenderer(s.featureLayer,s.field.name))),this.#d(s,a),!u||u.isHidden)||(u.visibilityDependencyIds?.length&&this.#p(s,a),!u.visibilityGroupId))return;const f=u.visibilityGroupId;let h=c(this.#c).get(f);h||(h=[],c(this.#c).set(f,h));const b=this.#g(f);if(!b)throw new Error(`Visibility group config not found for group ID: ${f}`);if(!a){const A=h.indexOf(t);h.splice(A,1);return}const P=A=>{c(this.#a).set(A,!1);const E=c(this.#i).get(A);if(E&&E instanceof Je){E.layer.visible=!1,this.updateDrawState(E,!1),this.#d(E,!1);const D=this.#v(A);D&&D.visibilityDependencyIds?.length&&this.#p(E,!1)}const V=h.indexOf(A);V>=0&&h.splice(V,1)};for(;h.length>=b.maxVisibleLayers;){const A=h[0];P(A)}h.push(t),this.#d(s,a),u.visibilityDependencyIds?.length&&this.#p(s,a)}async updateDrawState(t,a){if(!this.#r)return;if(!a){c(this.#s).delete(t.id),c(this.#l).get(t.id)?.remove(),c(this.#l).delete(t.id);return}if(!(t instanceof Je)||!(t.layer instanceof ea))return;const s=await this.#r.getLayerView(t.layer);if(!s)return;this.setInitialDrawState(t,s);const u=fs(()=>s.suspended,(f,h)=>{h&&!f?c(this.#s).set(t.id,tr.Visible):!h&&f&&c(this.#s).set(t.id,tr.Suspended)});c(this.#l).set(t.id,u)}getNodeDrawState(t){return this.#u(),c(this.#s).get(t)??tr.Hidden}setInitialDrawState(t,a){!(t instanceof Je)||!(t.layer instanceof ea)||a&&(a.suspended?c(this.#s).set(t.id,tr.Suspended):c(this.#s).set(t.id,tr.Visible))}clearDrawStateHandles(){for(const t of c(this.#l).values())t.remove();c(this.#l).clear()}cleanup(){this.initialized=!1,c(this.#a).clear(),c(this.#c).clear(),c(this.#f).clear(),B(this.#n,[],!0),c(this.#i).clear(),c(this.#s).clear(),this.clearDrawStateHandles()}#d(t,a){const s=t.parent;if(s){if(!(s instanceof Je)){this.#d(s,a);return}c(this.#a).set(s.id,a),s.layer.visible=a,this.#d(s,a)}}#p(t,a){const s=this.#v(t.id);if(s&&s.visibilityDependencyIds?.length)for(const u of s.visibilityDependencyIds){const f=c(this.#i).get(u);f&&f instanceof Je&&(c(this.#a).set(u,a),f.layer.visible=a,this.#d(f,a))}}#g(t){if(t&&this.#t)return this.#t.getVisibilityGroupConfig(t)}#m(t){this.#t&&this.#t.resolveInheritance(t)}#y(t){const a=t.map(s=>this.#w(s,void 0));return this.#b([...a])}#v(t){if(t&&this.#t)return this.#t.getItemConfig(t)}#b(t){t.reverse();for(const a of t)a.children?.length&&this.#b(a.children);return t}#w(t,a){const s=this.#v(t.id);if(s&&s.customConverterId){if(!c(this.#f).has(s.customConverterId))throw new Error(`Custom converter not found: ${s.customConverterId}`);const f=c(this.#f).get(s.customConverterId);if(!f)throw new Error(`Custom converter not found: ${s.customConverterId}`);return f.layerToNode(t,a??null)}const u=new Je(t.id,t.title,t,[],a);if(t.visible=s?.disableVisibilityToggle?t.visible:s?.isHidden?!1:s?.isVisibleOnInit??!1,c(this.#a).set(t.id,t.visible),this.updateDrawState(u,t.visible),this.#A(t)&&s?.showFields){const f=t;f.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const h of f.fields??[]){const b=this.#x(h,u);u.children.push(b)}}if(this.#C(t)){const f=t;return u.children=f.layers.toArray().map(h=>this.#w(h,u)),u}if(this.#I(t)){const f=t;if(f.sublayers&&f.sublayers.length>0){const h=f.sublayers;u.children=h.toArray().map(this.#_)}}return u}#x(t,a){const s=this.#k(a.id,t.name),u=new Sr(s,t.alias||t.name,a.layer,t,[],a),f=this.#v(s);return c(this.#a).set(s,f?.isVisibleOnInit??!1),u}#I(t){return t.type==="map-image"||t.type==="wms"}#_(t){const a=new Je(t.uid,t.title,t);return t.sublayers?.length&&(a.children=t.sublayers.toArray().map(this.#_)),a}#S(t,a){for(const s of t)a.set(s.id,s),s.children?.length&&this.#S(s.children,a)}#k(t,a){return`${t}-${a}`}#C(t){return t.type==="group"}#A(t){return t.type==="feature"}#u(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}const Wl='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Yl='<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Jl='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',Fa=(k,t,a,s)=>t?Ql(k,a):a?s?Wl:Yl:Jl,Ql=(k,t)=>{switch(k.type){case"group":return Qi;case"feature":return Xi;case"tile":return Fo;default:return t?Qi:Xi}};function Xl(k){const t=k-1;return t*t*t+1}var $l=ae('<div class="relative ml-4 w-full"><div class="tree-guide-line svelte-1y72o5r"></div> <div class="tree-children svelte-1y72o5r"></div></div>'),Zl=ae('<div class="w-full"><!> <!></div>');function Ta(k,t){const a=Ve(t,"isOpen",3,!1),s=Ve(t,"childNodes",3,null),u=Ve(t,"duration",3,300);var f=Zl(),h=ee(f);Ze(h,()=>t.content??Ke);var b=ue(h,2);{var P=A=>{var E=$l(),V=ue(ee(E),2);qt(V,21,()=>s()??[],D=>D.id,(D,W)=>{var M=de(),L=Z(M);Ze(L,()=>t.childNode??Ke,()=>c(W)),T(D,M)}),X(V),X(E),wn(1,V,()=>ua,()=>({duration:u(),easing:Xl})),wn(2,V,()=>ua,()=>({duration:u()})),T(A,E)};ve(b,A=>{a()&&s()&&A(P)})}X(f),T(k,f)}const ci="mb-1 cursor-pointer rounded-md border border-border p-2 text-left",ui="transition-all duration-150 hover:border-border/50 hover:bg-gray-100 hover:shadow-sm",ec="transition-colors hover:bg-blue-500",di="text-sm font-normal",fi="bg-card",Da="bg-accent text-accent-foreground",tc="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";function rc(k={}){const{enhancedHover:t=!1,includeFont:a=!1,pressed:s=!1}=k;let u=ci;return t?u+=" "+ui:u+=" "+ec,a&&(u+=" "+di),s?u+=" "+Da:u+=" "+fi,u}var nc=ae('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),ic=ae('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function va(k,t){const a=`calc(100% - ${t.depth*1}rem)`,s=`${ci} ${ui} ${tc} ${fi} ${di}`,u=`${ci} ${ui} ${di}`;var f=de(),h=Z(f);{var b=A=>{To(A,{get pressed(){return t.pressed},get class(){return s},variant:"outline",get style(){return`width: ${a};`},get onPressedChange(){return t.onclick},children:(E,V)=>{var D=nc(),W=ee(D),M=ee(W),L=ee(M);jr(L,()=>t.icon),X(M);var K=ue(M,2),N=ee(K,!0);X(K),X(W);var H=ue(W,2);Ze(H,()=>t.children??Ke),X(D),ct(()=>Ct(N,t.name)),T(E,D)},$$slots:{default:!0}})},P=A=>{var E=ic();E.__click=function(...j){t.onclick?.apply(this,j)};var V=ee(E),D=ee(V),W=ee(D);Sa(W,{get isOpen(){return t.isOpen}});var M=ue(W,2),L=ee(M);jr(L,()=>t.icon),X(M);var K=ue(M,2),N=ee(K,!0);X(K),X(D);var H=ue(D,2);Ze(H,()=>t.children??Ke),X(V),X(E),ct(()=>{vi(E,1,`${u} ${t.pressed?Da:fi}`),xn(E,`width: ${a};`),Ct(N,t.name)}),T(A,E)};ve(h,A=>{t.isTogglable?A(b):A(P,!1)})}T(k,f)}Cn(["click"]);function Na(k,t){De(t,!0);const a=L=>{var K=de(),N=Z(K);{var H=j=>{var U=de(),le=Z(U);{var te=he=>{va(he,{isTogglable:!1,get pressed(){return c(A)},get icon(){return c(E)},get name(){return t.node.name},get depth(){return u()},onclick:M,get isOpen(){return c(P)}})},oe=he=>{va(he,{isTogglable:!0,get pressed(){return c(A)},get icon(){return c(E)},get name(){return t.node.name},get depth(){return u()},onclick:W,get isOpen(){return c(P)}})};ve(le,he=>{h?he(te):he(oe,!1)})}T(j,U)};ve(N,j=>{t.treeviewConfigStore.getItemConfig(t.node.id)?.isHidden||j(H)})}T(L,K)},s=(L,K=Ke)=>{var N=de(),H=Z(N);{var j=U=>{{let le=Ce(()=>u()+1);Na(U,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return K()},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get getNodeVisibility(){return t.getNodeVisibility},get depth(){return c(le)},get useLayerTypeIcon(){return f()}})}};ve(H,U=>{h&&c(P)&&!t.treeviewConfigStore.getItemConfig(K().id)?.isHidden&&U(j)})}T(L,N)},u=Ve(t,"depth",3,0),f=Ve(t,"useLayerTypeIcon",3,!1),h=!!(t.node.children&&t.node.children.length),b=!h;let P=ne(!1),A=ne(!1),E=ne("");function V(){return!t.node.children||!t.getNodeVisibility?!1:t.node.children.some(L=>{const K=t.getNodeVisibility(L.id);return K!==void 0?K:L instanceof Je?L.layer.visible:!1})}je(()=>{if(!(!t.node||!(t.node instanceof Je))){if(h)B(A,V(),!0);else{const L=t.getNodeVisibility?t.getNodeVisibility(t.node.id):void 0;B(A,L!==void 0?L:t.node.layer.visible,!0)}B(E,Fa(t.node.layer,f(),h,c(P)),!0)}});function D(){!b||!t.onNodeVisibilityChange||h||(B(A,!c(A)),t.onNodeVisibilityChange(t.node,c(A)))}function W(){h||D(),t.onNodeClick?.(t.node)}function M(){B(P,!c(P)),t.onNodeClick?.(t.node)}{let L=Ce(()=>h?t.node.children:null);Ta(k,{get isOpen(){return c(P)},get content(){return a},get childNodes(){return c(L)},get childNode(){return s}})}Ne()}function ac(k,t){De(t,!0);const a=new Ea;function s(){a.clearSelections()}je(()=>{!t.webMap||a.initialized||a.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,null)}),je(()=>{a.initialized&&!a.getVisibleNodes().length&&t.areaSelectionStore.layerId&&a.setVisibilityState(t.areaSelectionStore.layerId,!0)}),je(()=>{if(!a.initialized||!a.getVisibleNodes().length)return;const P=a.getVisibleNodes().find(A=>A instanceof Je&&A.layer instanceof ta);if(!P||!(P instanceof Je)){console.warn("Visible node is not a FeatureLayer");return}if(!P.layer||!(P.layer instanceof ta)){console.warn("Visible node layer is not a FeatureLayer",P.layer.type);return}t.areaSelectionStore.setLayerId(P.id)});var u={clearSelections:s},f=de(),h=Z(f);{var b=P=>{var A=de(),E=Z(A);Oe(E,()=>xa,(V,D)=>{D(V,{children:(W,M)=>{var L=de(),K=Z(L);qt(K,17,()=>a.getNodes(),N=>N.id,(N,H)=>{Na(N,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return c(H)},onNodeClick:()=>{},onNodeVisibilityChange:(j,U)=>a.setVisibilityState(j.id,U),getNodeVisibility:j=>a.getVisibilityState(j),depth:0,useLayerTypeIcon:!0})}),T(W,L)},$$slots:{default:!0}})}),T(P,A)};ve(h,P=>{a.initialized&&P(b)})}return T(k,f),Ne(u)}class oc{configStore;constructor(t){this.configStore=t}}class sc extends oc{id="aliasPath";layerToNode(t,a){const s=new Je(t.id,t.title,t,[],a),u=this.configStore.getItemConfig(t.id);if(this.#r(t)&&u?.showFields){const f=t;f.loaded||console.warn(`Layer not loaded: ${t.id}`);const h=new Map;for(const b of f.fields??[]){const P=this.configStore.getItemConfig(this.#t(t.id,b.name));!P||P.isHidden||this.#e(b,s,h)}s.children.sort((b,P)=>b.children.length>0&&P.children.length===0?1:b.children.length===0&&P.children.length>0?-1:0)}return s}#e(t,a,s=new Map){const u=this.#t(a.id,t.name),h=hs(t.alias||"")?.split("|").map(D=>D.trim()).filter(Boolean)??[];if(h.length===0){const D=new Sr(u,t.alias||t.name,a.layer,t,[],a);return a.children.push(D),D}const b=h.slice(0,-1),P=h[h.length-1];let A=a;const E=(D,W)=>{D.children??=[],D.children.includes(W)||D.children.push(W)};for(let D=0;D<b.length;D++){const W=b[D],M=h.slice(0,D+1).join("::"),L=`${a.id}::${M}`;let K=s.get(L);K||(K=new Oa(L,W,[],A),s.set(L,K),E(A,K)),A=K}const V=new Sr(u,P||t.name,a.layer,t,[],A);return E(A,V),V}#t(t,a){return`${t}-${a}`}#r(t){return t.type==="feature"}}class pa{#e=[];#t=new Map;#r=[];#n=new Map;#i=[];#a=new Map;#s=new Set;constructor(t){if(!t)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=t.items??[],this.#t=new Map(this.#e.map(a=>[a.id,a])),this.#r=t.visibilityGroups??[],this.#n=new Map(this.#r.map(a=>[a.id,a])),this.#i=t.inheritanceGroups??[],this.#a=new Map(this.#i.map(a=>[a.id,a])),t.fieldsToHide&&(this.#s=new Set(t.fieldsToHide.map(a=>a.trim().toLowerCase())))}getItemConfig(t){return this.#t.get(t)}getVisibilityGroupConfig(t){return this.#n.get(t)}getInheritanceGroupConfig(t){return this.#a.get(t)}resolveInheritance(t){if(!(t.length===0||!this.#e||this.#e.length===0))for(const a of t){const s=this.getItemConfig(a.id);this.#l(a,s)}}#l(t,a){const s=this.#c(t,a);if(this.#y(t)&&s.showFields){const u=t;u.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const f of u.fields??[])this.#f(this.#g(t.id,f.name),f.alias||f.name,s)}if(this.#m(t)){const u=t;for(const f of u.layers.toArray())this.#l(f,s)}}#c(t,a){const s=this.#h(t.id,a);return s.type===hn.None&&(s.type=Do(t)),s}#f(t,a,s){const u=this.#h(t,s);return u.type===hn.None&&(u.type=hn.Field),this.#s.has(a.trim().toLowerCase())&&(u.isHidden=!0),u}#h(t,a){let s=this.getItemConfig(t);const u=s?.inheritanceGroupId?this.getInheritanceGroupConfig(s.inheritanceGroupId):this.getInheritanceGroupConfig(a?.inheritanceGroupId??"");return s={id:t,type:hn.None,isDownloadable:this.#o(u,"isDownloadable",s,a,!0),isVisibleOnInit:this.#o(u,"isVisibleOnInit",s,a,!1),isHidden:this.#o(u,"isHidden",s,a,!1),disableVisibilityToggle:this.#o(u,"disableVisibilityToggle",s,a,!1),isOpenOnInit:this.#o(u,"isOpenOnInit",s,a,!1),showFields:this.#o(u,"showFields",s,a,!1),visibilityDependencyIds:this.#o(u,"visibilityDependencyIds",s,a,[]),visibilityGroupId:this.#o(u,"visibilityGroupId",s,a,void 0),customConverterId:this.#o(u,"customConverterId",s,a,void 0),inheritanceGroupId:this.#o(u,"inheritanceGroupId",s,a,void 0)},this.#p(s),this.#d(s),s}#o(t,a,s,u,f){const h=s?.[a];return h!==void 0?h:t?.inheritedProperties.includes(a)&&u?u[a]??f:f}#d(t){if(this.#t.has(t.id))throw new Error(`Item with id ${t.id} already exists.`);this.#e.push(t),this.#t.set(t.id,t)}#p(t){this.#t.has(t.id)&&(this.#e=this.#e.filter(a=>a.id!==t.id),this.#t.delete(t.id))}#g(t,a){return`${t}-${a}`}#m(t){return t.type==="group"}#y(t){return t.type==="feature"}}var lc=ae('<div data-slot="checkbox-indicator" class="text-current transition-none"><!></div>');function cc(k,t){De(t,!0);let a=Ve(t,"ref",15,null),s=Ve(t,"checked",11,!1),u=Ve(t,"indeterminate",11,!1),f=Tt(t,["$$slots","$$events","$$legacy","ref","checked","indeterminate","class"]),h=ne(Re(s())),b=ne(Re(u()));je(()=>{B(h,s())}),je(()=>{B(b,u())});var P=de(),A=Z(P);{const E=(D,W)=>{let M=()=>W?.().checked,L=()=>W?.().indeterminate;var K=lc(),N=ee(K);{var H=U=>{Tl(U,{class:"size-3.5"})},j=U=>{var le=de(),te=Z(le);{var oe=he=>{Vo(he,{class:"size-3.5"})};ve(te,he=>{L()&&he(oe)},!0)}T(U,le)};ve(N,U=>{M()?U(H):U(j,!1)})}X(K),T(D,K)};let V=Ce(()=>vs("peer flex size-4 shrink-0 items-center justify-center rounded-[4px] border border-input shadow-xs transition-shadow outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 data-[state=checked]:border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:bg-input/30 dark:aria-invalid:ring-destructive/40 dark:data-[state=checked]:bg-primary",t.class));Oe(A,()=>No,(D,W)=>{W(D,Rt({"data-slot":"checkbox",get class(){return c(V)}},()=>f,{get ref(){return a()},set ref(M){a(M)},get checked(){return c(h)},set checked(M){B(h,M,!0)},get indeterminate(){return c(b)},set indeterminate(M){B(b,M,!0)},children:E,$$slots:{default:!0}}))})}T(k,P),Ne()}var uc=ae("<div><!></div>");function ga(k,t){De(t,!0);let a=Ce(()=>t.getDownloadState?.(t.node)??We.Inactive),s=Ce(()=>c(a)===We.Active),u=Ce(()=>c(a)===We.Indeterminate);function f(P){P.stopPropagation();const A=c(a)===We.Active?We.Inactive:We.Active;t.onDownloadStateChanged?.(t.node,A)}var h=uc(),b=ee(h);cc(b,{get checked(){return c(s)},get indeterminate(){return c(u)},onclick:f,title:"Download"}),X(h),T(k,h),Ne()}var dc=ae('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ma(k,t){De(t,!0);const a=Ve(t,"isFolder",3,!1),s=Ve(t,"isOpen",3,!1),u=`calc(100% - ${t.depth*1}rem)`;var f=dc();f.__click=function(...L){t.onclick?.apply(this,L)};var h=ee(f),b=ee(h),P=ee(b);{var A=L=>{Sa(L,{get isOpen(){return s()}})};ve(P,L=>{a()&&L(A)})}var E=ue(P,2),V=ee(E);jr(V,()=>t.icon),X(E);var D=ue(E,2),W=ee(D,!0);X(D),X(b);var M=ue(b,2);Ze(M,()=>t.children??Ke),X(h),X(f),ct(L=>{vi(f,1,L),xn(f,`width: ${u};`),Ct(W,t.name)},[()=>So(rc({enhancedHover:!0,includeFont:!0}))]),T(k,f),Ne()}Cn(["click"]);var fc=ae('<div class="flex items-center gap-2"><!> <!></div>'),hc=ae('<div class="flex items-center gap-2"><!> <!></div>');function Va(k,t){De(t,!0);const a=H=>{var j=de(),U=Z(j);{var le=te=>{var oe=de(),he=Z(oe);{var Ie=ye=>{ma(ye,{get icon(){return c(D)},get name(){return t.node.name},get depth(){return f()},onclick:N,get isFolder(){return b},get isOpen(){return c(E)},children:_e=>{var Fe=fc(),Be=ee(Fe);{var Qe=ge=>{ga(ge,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};ve(Be,ge=>{t.isDownloadable&&ge(Qe)})}var ke=ue(Be,2);{var Le=ge=>{{let Ee=Ce(()=>t.getNodeDrawState?.(t.node.id)===tr.Suspended);$i(ge,{get checked(){return c(V)},get indeterminate(){return c(Ee)},onCheckedChange:L})}};ve(ke,ge=>{P&&ge(Le)})}X(Fe),T(_e,Fe)},$$slots:{default:!0}})},ce=ye=>{ma(ye,{get icon(){return c(D)},get name(){return t.node.name},get depth(){return f()},onclick:K,get isFolder(){return b},children:_e=>{var Fe=hc(),Be=ee(Fe);{var Qe=ge=>{ga(ge,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};ve(Be,ge=>{t.isDownloadable&&ge(Qe)})}var ke=ue(Be,2);{var Le=ge=>{{let Ee=Ce(()=>t.getNodeDrawState?.(t.node.id)===tr.Suspended);$i(ge,{get checked(){return c(V)},get indeterminate(){return c(Ee)},onCheckedChange:L})}};ve(ke,ge=>{P&&ge(Le)})}X(Fe),T(_e,Fe)},$$slots:{default:!0}})};ve(he,ye=>{b?ye(Ie):ye(ce,!1)})}T(te,oe)};ve(U,te=>{u()?.getItemConfig(t.node.id)?.isHidden||te(le)})}T(H,j)},s=(H,j=Ke)=>{var U=de(),le=Z(U);{var te=oe=>{{let he=Ce(()=>u()?.getItemConfig(j().id)?.isDownloadable??!0),Ie=Ce(()=>f()+1);Va(oe,{get treeviewConfigStore(){return u()},get node(){return j()},get isDownloadable(){return c(he)},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState},get onFilterClicked(){return t.onFilterClicked},get hasFiltersApplied(){return t.hasFiltersApplied},get getNodeVisibility(){return t.getNodeVisibility},get getNodeDrawState(){return t.getNodeDrawState},get depth(){return c(Ie)},get useLayerTypeIcon(){return h()}})}};ve(le,oe=>{b&&c(E)&&!u()?.getItemConfig(j().id)?.isHidden&&oe(te)})}T(H,U)},u=Ve(t,"treeviewConfigStore",3,null),f=Ve(t,"depth",3,0),h=Ve(t,"useLayerTypeIcon",3,!1),b=!!(t.node.children&&t.node.children.length),P=!b;let A=!1,E=ne(!1),V=ne(!1),D=ne(""),W=ne(!1),M=ne(!1);je(()=>{A||(B(E,u()?.getItemConfig(t.node.id)?.isOpenOnInit??!1,!0),A=!0)}),je(()=>{if(!t.node)return;const H=t.getNodeVisibility?t.getNodeVisibility(t.node.id):!1;B(V,H??!1,!0),t.node instanceof Je&&B(D,Fa(t.node.layer,h(),b,c(E)),!0)}),je(()=>{if(!(t.node instanceof Je))return;const H=(t.getDownloadState?.(t.node)===We.Active&&t.node.layer.type==="feature")??!1;H&&!c(W)?(B(W,!0),B(M,!1)):!H&&c(W)&&(B(M,!0),setTimeout(()=>{B(W,!1),B(M,!1)},180))});function L(){!P||!t.onNodeVisibilityChange||(B(V,!c(V)),t.onNodeVisibilityChange(t.node,c(V)))}function K(){t.onNodeClick?.(t.node)}function N(){B(E,!c(E)),t.onNodeClick?.(t.node)}{let H=Ce(()=>b?t.node.children:null);Ta(k,{get isOpen(){return c(E)},get content(){return a},get childNodes(){return c(H)},get childNode(){return s}})}Ne()}class vc{#e;#t;constructor(t,a){this.#e=t,this.#t=a}updateSelection(t,a){if(!this.#t.getItemConfig(t.id)?.isHidden){if(!(t instanceof Je)){this.updateChildrenSelection(t,a);return}if(t instanceof Sr){this.updateFieldSelection(t,a);return}this.updateLayerSelection(t,a)}}getSelectionState(t){if(!(t instanceof Je))return this.determineSelectionStateFromChildren(t);if(this.isGroupLayer(t))return this.determineSelectionStateFromChildren(t);let a;return t instanceof Sr?(a=this.#e.getSelection(t.featureLayer.id),a&&a.selectedFieldIds.has(t.field.name)?We.Active:We.Inactive):(a=this.#e.getSelection(t.id),a?this.isFeatureLayer(t)&&t.children&&t.children.length>0?this.determineSelectionStateFromChildren(t):We.Active:We.Inactive)}updateLayerSelection(t,a){let s=this.#e.getSelection(t.id);switch(a){case We.Active:!s&&!this.isGroupLayer(t)&&(s=this.createAndAddDataSelection(t.id));for(const u of t.children||[])this.updateSelection(u,a);break;case We.Inactive:s&&!this.isGroupLayer(t)&&this.#e.removeSelection(t.id),this.updateChildrenSelection(t,a);break}}updateFieldSelection(t,a){let s=this.#e.getSelection(t.featureLayer.id);switch(a){case We.Active:s||(s=this.createAndAddDataSelection(t.featureLayer.id)),this.#e.addOrUpdateSelection(t.featureLayer.id,[...s.selectedFieldIds,t.field.name]);break;case We.Inactive:{if(!s)break;const u=new Ft(s.selectedFieldIds);u.delete(t.field.name),this.#e.addOrUpdateSelection(t.featureLayer.id,[...u]),u.size===0&&this.#e.removeSelection(s.layerId);break}}}updateChildrenSelection(t,a){for(const s of t.children||[])this.updateSelection(s,a)}determineSelectionStateFromChildren(t){let a=0,s=0;for(const u of t.children||[]){if(this.#t.getItemConfig(u.id)?.isHidden)continue;s++;const h=this.getSelectionState(u);if(h===We.Active||this.isFeatureLayer(u)&&h!==We.Inactive)a++;else if(h===We.Indeterminate)return We.Indeterminate}return a===0?We.Inactive:a===s?We.Active:We.Indeterminate}createAndAddDataSelection(t){const a={layerId:t,selectedFieldIds:new Ft};return this.#e.addSelection(a),a}isGroupLayer(t){return t instanceof Je&&t.layer.type==="group"}isFeatureLayer(t){return t instanceof Je&&t.layer.type==="feature"}}function pc(k,t){De(t,!0);const a=Ve(t,"fieldFilterMenuStore",7);function s(){u.clearSelections()}const u=new Ea,f=new vc(t.dataSelectionStore,t.treeviewConfigStore);je(()=>{if(!t.webMap||u.initialized)return;(async()=>{await t.webMap.when(),await h(t.webMap.layers.toArray());const H=new sc(t.treeviewConfigStore);u.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,t.layerViewProvider,[H],t.customRendererService)})()});async function h(N){for(const H of N)H.type==="feature"&&!H.loaded&&await H.load(),H.type==="group"&&await h(H.layers.toArray())}function b(N,H){console.log(`[tree-view] onNodeVisibilityChange: Setting visibility of node ${N.id} to ${H}`),u.setVisibilityState(N.id,H)}function P(N){return u.getNodeDrawState(N)}function A(N,H){f.updateSelection(N,H)}function E(N){return f.getSelectionState(N)}function V(N){if(a().ActiveLayer?.uid===N){a().ActiveLayer=null;return}const j=u.getNodeById(N);!j||!(j instanceof Je)||(a().ActiveLayer=j.layer)}function D(N){const H=t.dataSelectionStore.getSelection(N);if(!H?.selectedFieldIds)return!1;const j=u.getNodeById(N);if(!j||!(j instanceof Je))return!1;const U=j.layer.fields?.length||0,le=H?.selectedFieldIds.size||0;return le>0&&le!==U}var W={clearSelections:s},M=de(),L=Z(M);{var K=N=>{var H=de(),j=Z(H);Oe(j,()=>xa,(U,le)=>{le(U,{children:(te,oe)=>{var he=de(),Ie=Z(he);qt(Ie,17,()=>u.getNodes(),ce=>ce.id,(ce,ye)=>{{let Se=Ce(()=>t.treeviewConfigStore.getItemConfig(c(ye).id)?.isDownloadable??!0);Va(ce,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return c(ye)},get isDownloadable(){return c(Se)},onNodeClick:()=>{},onNodeVisibilityChange:b,getNodeVisibility:_e=>u.getVisibilityState(_e),onDownloadStateChanged:A,getDownloadState:E,onFilterClicked:V,hasFiltersApplied:D,getNodeDrawState:P,depth:0,useLayerTypeIcon:!0})}}),T(te,he)},$$slots:{default:!0}})}),T(N,H)};ve(L,N=>{u.initialized&&N(K)})}return T(k,M),Ne(W)}class La{#e;constructor(t){this.#e=t}async getLayerView(t){return this.#e.whenLayerView(t)}async getLayerViewById(t){const a=this.#e.map?.findLayerById(t);if(a)return this.getLayerView(a)}}class gc{mapView;areaSelectionInteractionStore;interactableLayers;pointerMoveHandle=null;clickHandle=null;leaveHandle=null;enterHandle=null;#e=ne(!0);get pointerInsideMap(){return c(this.#e)}set pointerInsideMap(t){B(this.#e,t,!0)}constructor(t,a,s){console.log("[map-interaction-store] Initializing with MapView"),this.mapView=t,this.areaSelectionInteractionStore=a,this.interactableLayers=s,this.setupHighlights(t),this.setupPointerMoveHandler(t),this.setupClickHandler(t),this.setupLeaveHandler(t),this.setupEnterHandler(t),console.log("[map-interaction-store] Initialized with MapView")}setupHighlights(t){const a={name:"hover",color:"lightgreen",haloOpacity:1,fillOpacity:.2},s={name:"selected",color:"green",haloOpacity:1,fillOpacity:.3};t.highlights.push(a),t.highlights.push(s)}setupPointerMoveHandler(t){this.pointerMoveHandle=t.on("pointer-move",async a=>{if(!this.pointerInsideMap)return;const{results:s}=await t.hitTest(a),u=s[0];if(!u){this.clearHoverHighlight();return}const f=u.graphic,h=f.layer;if(!f||!h||!this.isLayerInteractable(h.title)||f.attributes?.[h.objectIdField]===void 0){this.clearHoverHighlight();return}const b=f.attributes?.[h.objectIdField];if(!(this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.currentHoveredArea.id===b))try{const P=await t.whenLayerView(h);this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P),this.clearHoverHighlight();const A=P;if(!A){console.warn("LayerView is not a FeatureLayerView");return}if(!this.pointerInsideMap)return;const E=A.highlight(f,{name:"hover"});this.areaSelectionInteractionStore.setHoveredArea(b,E)}catch(P){console.error("Error in pointer-move handler:",P),this.clearHoverHighlight()}})}setupClickHandler(t){this.clickHandle=t.on("click",async a=>{const{results:s}=await t.hitTest(a),u=s[0];if(!u)return;const f=u.graphic,h=f.layer;if(!f||!h||!this.isLayerInteractable(h.title)||f.attributes?.[h.objectIdField]===void 0)return;const b=f.attributes?.[h.objectIdField];try{const P=await t.whenLayerView(h),A=P;if(!A){console.warn("Layer is not a FeatureLayerView");return}if(this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P),this.areaSelectionInteractionStore.selectionViewState.areaHandles.get(b))this.areaSelectionInteractionStore.removeSelectedArea(b);else{const V=A.highlight(f,{name:"selected"});this.areaSelectionInteractionStore.addSelectedArea(b,V)}}catch(P){console.error("Error in click handler:",P)}})}setupLeaveHandler(t){this.leaveHandle=t.on("pointer-leave",()=>{this.pointerInsideMap=!1,this.clearHoverHighlight()})}setupEnterHandler(t){this.enterHandle=t.on("pointer-enter",()=>{this.pointerInsideMap=!0})}isLayerInteractable(t){return this.interactableLayers.has(t)}clearHoverHighlight(){this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.clearHoveredArea()}cleanup(){this.pointerMoveHandle&&(this.pointerMoveHandle.remove(),this.pointerMoveHandle=null),this.clickHandle&&(this.clickHandle.remove(),this.clickHandle=null),this.leaveHandle&&(this.leaveHandle.remove(),this.leaveHandle=null),this.enterHandle&&(this.enterHandle.remove(),this.enterHandle=null),this.clearHoverHighlight(),this.pointerInsideMap=!0,this.interactableLayers=new Ft,console.log("[map-interaction-store] cleaned up")}get currentMapView(){return this.mapView}}var mc=ae('<div class="map-view svelte-14z0ybm"></div>');function yc(k,t){De(t,!0);const a=Ve(t,"mapView",7);let s=ne(null),u=null;const f="streets-vector";let h,b;function P(){if(!a())throw new Error("MapView is not initialized");return new La(a())}Rr(async()=>{await A(),await D()});async function A(){if(!b){const[{default:N},{default:H},{default:j},{default:U}]=await Promise.all([Vr(()=>import("../chunks/tWIlYmLc.js").then(le=>le.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url),Vr(()=>import("../chunks/DBuKqDYo.js").then(le=>le.a2),__vite__mapDeps([40,1,2,3,5,41,42,26,43,23,6,7,44,33,34,45,21,22,46,8,9,10,11,24,47,48,18,49,50,51,52,25,53,54,55,56,57,12,16,58,59,60,61,62,63,35,64,65,66,27,67,68,69,70,71,14,15,72,0,4,13,17,19,20,28,29,30,31,32,36,37,38,39,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99]),import.meta.url),Vr(()=>import("../chunks/CVaFVXl_.js").then(le=>le.W),__vite__mapDeps([100,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,41,42,43,44,45,46,101,102,103,74,104,105,83,84,78,50,51,52,53,54,55,56,57,58,59,60,61,62,63,106,107,108,77,109,47,48,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,76,127,73,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,68,181,182,183,184,185,186]),import.meta.url),Vr(()=>import("../chunks/kwrskX6P.js"),__vite__mapDeps([106,5,1,2,3,51,26,8,9,10,11,7,6,52,25,21,22,23,53,101,107,108,77,78,50,44,33,34,45,54,55,56,57,12,16,58,59,60,61,62,63,109,15,47,48,18,110,111,35,112,113,114,115,116,117,118,37,38,119,120,121,27,122,123,124,125,126,76,127,73,128,129,130,74,131,14,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,102,152,153,154,155,156,157,158,159,46,160,161,162,163,164,165,166,167,168,169,29,170,171,172,17,173,174,175,103,176,177,178,179,180,68,181,182,183]),import.meta.url)]);h=N,b=H}}async function E(){return new h({basemap:f})}async function V(){if(t.webMap)try{if(await A(),await D(),!a()){console.error("MapView is not initialized");return}a().container=u,a().popupEnabled=!1,a().map=t.webMap,console.log("[uprn-map-view] MapView updated with new webMap"),await t.areaSelectionInteractionStore.refreshLayerView(),await t.areaSelectionInteractionStore.refreshAreas()}catch(N){console.error("Error updating MapView with new webMap:",N)}}async function D(){if(!u){console.error("Map container element was not found");return}try{a().container=u,a().popupEnabled=!1,a().map=t.webMap??void 0,a().ui.move("zoom","top-right"),await a().when(),console.log("[uprn-map-view] Map loaded successfully")}catch(N){console.error("Error loading map:",N),await W()}}async function W(){try{const N=await E();a().container=u,a().popupEnabled=!1,a().map=N,await a().when(),console.log("[uprn-map-view] Fallback map loaded")}catch(N){console.error("Error loading fallback map:",N)}}je(()=>{t.webMap&&V()}),je(()=>{!a()||c(s)||B(s,new gc(a(),t.areaSelectionInteractionStore,t.interactableLayers),!0)});function M(){a()&&a().destroy()}ya(()=>{M()});var L={getLayerViewProvider:P},K=mc();return Lt(K,N=>u=N,()=>u),T(k,K),Ne(L)}var bc=ae('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),wc=ae('<div class="flex min-h-0 flex-1 flex-col"><!></div>');function yn(k,t){var a=wc(),s=ee(a);Oe(s,()=>kn,(u,f)=>{f(u,{class:"card-content flex min-h-0 flex-1 flex-col overflow-hidden p-0",children:(h,b)=>{var P=bc(),A=ee(P);Ze(A,()=>t.children??Ke),X(P),T(h,P)},$$slots:{default:!0}})}),X(a),T(k,a)}var _c=ae("<!> <!>",1),Sc=ae('<div class="tab-list-wrapper flex-shrink-0 svelte-rohqkk"><!></div> <!>',1);function xc(k,t){De(t,!0);const a=Ve(t,"triggers",19,()=>[]);var s=de(),u=Z(s);Oe(u,()=>Lo,(f,h)=>{h(f,{get value(){return t.value},get onValueChange(){return t.onValueChange},class:"flex h-full w-full flex-col",children:(b,P)=>{var A=Sc(),E=Z(A),V=ee(E);Oe(V,()=>Ro,(W,M)=>{M(W,{class:"tab-list",children:(L,K)=>{var N=de(),H=Z(N);qt(H,17,a,_r,(j,U,le,te)=>{let oe=()=>c(U).value,he=()=>c(U).label;var Ie=_c(),ce=Z(Ie);Oe(ce,()=>Mo,(_e,Fe)=>{Fe(_e,{get value(){return oe()},class:"tab-trigger",children:(Be,Qe)=>{ur();var ke=wr();ct(()=>Ct(ke,he())),T(Be,ke)},$$slots:{default:!0}})});var ye=ue(ce,2);{var Se=_e=>{us(_e,{class:"separator"})};ve(ye,_e=>{oe()!==a()[a().length-1]?.value&&_e(Se)})}T(j,Ie)}),T(L,N)},$$slots:{default:!0}})}),X(E);var D=ue(E,2);Ze(D,()=>t.children??Ke),T(b,A)},$$slots:{default:!0}})}),T(k,s),Ne()}var Ic=ae('<div class="w-full flex-shrink-0"><!></div>');function kc(k,t){var a=Ic(),s=ee(a);{var u=f=>{var h=de(),b=Z(h);Ze(b,()=>t.children),T(f,h)};ve(s,f=>{t.children&&f(u)})}X(a),T(k,a)}var Cc=ae('<div class="w-full flex-shrink-0"><!></div>');function Ac(k,t){var a=Cc(),s=ee(a);{var u=f=>{var h=de(),b=Z(h);Ze(b,()=>t.children),T(f,h)};ve(s,f=>{t.children&&f(u)})}X(a),T(k,a)}class Pc{#e=ne(null);get layerId(){return c(this.#e)}set layerId(t){B(this.#e,t,!0)}#t=ne(Re(new Ft));get selectedAreaIds(){return c(this.#t)}set selectedAreaIds(t){B(this.#t,t,!0)}setLayerId(t){this.layerId!==t&&(this.layerId=t,this.selectedAreaIds.clear())}addSelectedArea(t){this.selectedAreaIds.add(t)}addSelectedAreas(t){t.forEach(a=>this.selectedAreaIds.add(a))}removeSelectedArea(t){this.selectedAreaIds.delete(t)}clearSelectedAreas(){this.selectedAreaIds.clear()}exportSnapshot(){return{layerId:this.layerId,selectedAreaIds:new Ft(this.selectedAreaIds)}}}class Oc{areaSelectionStore;layerViewProvider;#e=ne(Re({layerView:null,areaHandles:new wt}));get selectionViewState(){return c(this.#e)}set selectionViewState(t){B(this.#e,t,!0)}#t=ne(null);get lastAddedArea(){return c(this.#t)}set lastAddedArea(t){B(this.#t,t,!0)}#r=ne(null);get lastRemovedArea(){return c(this.#r)}set lastRemovedArea(t){B(this.#r,t,!0)}#n=ne(null);get currentHoveredArea(){return c(this.#n)}set currentHoveredArea(t){B(this.#n,t,!0)}fieldInfos=[];cachedNames=new wt;constructor(t,a){this.areaSelectionStore=t,this.layerViewProvider=a,wa(()=>{je(()=>{this.refreshLayerView()}),je(()=>{this.refreshAreas()})})}async refreshLayerView(){if(!this.areaSelectionStore.layerId&&this.selectionViewState.layerView!==null){this.resetSelectedLayerView();return}if(this.selectionViewState.layerView?.layer?.id===this.areaSelectionStore.layerId||!this.areaSelectionStore.layerId)return;const t=await this.layerViewProvider.getLayerViewById(this.areaSelectionStore.layerId);t&&this.setSelectedLayerView(t)}async refreshAreas(){const t=this.selectionViewState.layerView;if(!t){this.resetSelectedAreas();return}const a=this.areaSelectionStore.selectedAreaIds,s=this.selectionViewState.areaHandles;for(const u of s.keys())a.has(u)||this.removeSelectedArea(u);for(const u of a){if(s.has(u))continue;const f=t.highlight(u,{name:"selected"});f&&this.addSelectedArea(u,f)}}setFieldInfos(t){this.fieldInfos=t}setSelectedLayerView(t){this.selectionViewState?.layerView!==t&&(this.selectionViewState={layerView:t,areaHandles:new wt},this.resetSelectedAreas())}clearSelectedLayerView(){this.selectionViewState.layerView!==null&&(this.resetSelectedAreas(),this.selectionViewState.layerView=null)}resetSelectedLayerView(){this.selectionViewState={layerView:null,areaHandles:new wt},this.resetSelectedAreas()}resetSelectedAreas(){!this.selectionViewState.layerView&&this.selectionViewState.areaHandles.size===0||(this.selectionViewState.areaHandles.values().forEach(t=>{t.remove()}),this.selectionViewState.areaHandles.clear(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null)}addSelectedArea(t,a){if(!this.selectionViewState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const s={id:t,handle:a};this.lastAddedArea=s,this.selectionViewState.areaHandles.set(t,a),this.areaSelectionStore.addSelectedArea(t)}removeSelectedArea(t){if(!this.selectionViewState){console.warn("[area-selection-interaction-store] no feature layer view is set.");return}const a=this.selectionViewState.areaHandles.get(t);if(!a){console.warn(`[area-selection-interaction-store] no handle found for area ID ${t}.`);return}this.lastRemovedArea={id:t,handle:a},a.remove(),this.selectionViewState.areaHandles.delete(t),this.areaSelectionStore.removeSelectedArea(t)}async getAreaNamesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getNameFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer;let u=this.cachedNames.get(s.uid);u||(u=new wt,this.cachedNames.set(s.uid,u));const f=new Array(t.length),h=new wt,b=[];if(t.forEach((E,V)=>{h.set(E,V);const D=u.get(E);D!==void 0?f[V]=D:b.push(E)}),b.length===0)return f.map(E=>E??"");const P=s.objectIdField,A=await s.queryFeatures({objectIds:b,outFields:[a,P],returnGeometry:!1});for(const E of A.features){const V=E.attributes[P],D=E.attributes[a],W=h.get(V);W!==void 0&&(f[W]=D??"",u.set(V,D??""))}return f.map(E=>E??"")}async getAreaCodesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getCodeFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer,u=s.objectIdField,f=await s.queryFeatures({objectIds:t,outFields:[a,u],returnGeometry:!1}),h=new Array(t.length);for(const b of f.features){const P=b.attributes[u],A=b.attributes[a],E=t.indexOf(P);E!==-1&&(h[E]=A??"")}return h.map(b=>b??"")}setHoveredArea(t,a){t!==this.currentHoveredArea?.id&&(this.currentHoveredArea&&this.clearHoveredArea(),this.currentHoveredArea={id:t,handle:a})}clearHoveredArea(){this.currentHoveredArea&&(this.currentHoveredArea?.handle.remove(),this.currentHoveredArea=null)}getNameFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.nameField;return t||(console.warn(`[area-selection-interaction-store] no name field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}getCodeFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.codeField;return t||(console.warn(`[area-selection-interaction-store] no code field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}clearSelections(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,console.log("[area-selection-interaction-store] selections cleared.")}cleanup(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,this.cachedNames.clear(),this.fieldInfos=[],console.log("[area-selection-interaction-store] cleaned up.")}}const Ec=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];class Fc{#e;constructor(t){if(!t)throw new Error("UprnDownloadService endpoints configuration is required");if(!t.baseUrl||!t.healthRoute||!t.requestJobRoute||!t.requestJobStatusesRoute||!t.getAreaSelectionLimitsRoute||!t.fetchDownloadRoute)throw new Error("UprnDownloadService endpoints configuration is incomplete");this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async requestJob(t){try{console.log("[uprn-download-service] requesting job with request:",t);const a=`${this.#e.baseUrl}${this.#e.requestJobRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to request job:",s.statusText,"request:",JSON.stringify(t));return}return await s.json()}catch(a){console.error("Error requesting job:",a);return}}async requestJobStatuses(t){try{const a=`${this.#e.baseUrl}${this.#e.requestJobStatusesRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to get job statuses:",s.statusText);return}return await s.json()}catch(a){console.error("Error getting job statuses:",a);return}}async getSelectionAreaLimits(){try{const t=`${this.#e.baseUrl}${this.#e.getAreaSelectionLimitsRoute}`,a=await fetch(t);if(!a.ok){console.error("Failed to get area selection limits:",a.statusText);return}return await a.json()}catch(t){console.error("Error getting selection area limits:",t);return}}getDownloadUrl(t){const a=this.#e.baseUrl.replace(/\/+$/,""),s=this.#e.fetchDownloadRoute.replace(/\/+$/,"");return`${a}${s}/${encodeURIComponent(t)}`}}class Tc{#e;constructor(t){this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async chat(t){try{const a=`${this.#e.baseUrl}${this.#e.chatRoute}`,u=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!u.ok){console.error("Failed to send chat query:",u.statusText);return}return await u.json()}catch(a){console.error("Error sending chat query:",a);return}}async chatStream(t,a){try{const s=`${this.#e.baseUrl}${this.#e.chatStreamRoute}`,f=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!f.ok)return console.error("Failed to start chat stream:",f.statusText),!1;const h=f.body?.getReader();if(!h)return console.error("No response body reader available"),!1;const b=new TextDecoder;let P=!1;for(;!P;){const{value:A,done:E}=await h.read();if(P=E,A){const V=b.decode(A,{stream:!P});a(V)}}return!0}catch(s){return console.error("Error during chat stream:",s),!1}}}const Dc=Object.freeze({lod00World:{lod:0,scale:591657527591555e-6},lod01World:{lod:1,scale:295828763795777e-6},lod02World:{lod:2,scale:147914381897889e-6},lod03Continent:{lod:3,scale:73957190948944e-6},lod04Continent:{lod:4,scale:36978595474472e-6},lod05Countries:{lod:5,scale:18489297737236e-6},lod06Country:{lod:6,scale:9244648868618e-6},lod07StatesProvinces:{lod:7,scale:4622324434309e-6},lod08Counties:{lod:8,scale:2311162217155e-6},lod09Counties:{lod:9,scale:1155581108577e-6},lod10Country:{lod:10,scale:577790.554289},lod11MetropolitanArea:{lod:11,scale:288895.277144},lod12Cities:{lod:12,scale:144447.638572},lod13City:{lod:13,scale:72223.819286},lod14Town:{lod:14,scale:36111.909643},lod15Neighborhood:{lod:15,scale:18055.954822},lod16Streets:{lod:16,scale:9027.977411},lod17CityBlock:{lod:17,scale:4513.988705},lod18Buildings:{lod:18,scale:2256.994353},lod19Building:{lod:19,scale:1128.497176},lod20Houses:{lod:20,scale:564.248588},lod21Houses:{lod:21,scale:282.124294},lod22Houses:{lod:22,scale:141.062147},lod23HouseProperty:{lod:23,scale:70.5310735}});class Nc{#e=null;#t=!1;async init(t){this.#t||(await this.#r(t),this.#t=!0)}async#r(t){const s=await(await fetch(t)).json();this.#e=s}doesFieldHaveCustomRenderer(t,a){this.#c();const s=this.#e.FeatureLayers.find(h=>h.Name===t.title);if(!s)return!1;const u=this.#e.Fields.find(h=>h.FeatureLayerId===s.Id&&h.Name===a);return u?!!this.#e.CustomRenderers_Fields.find(h=>h.FieldId===u.Id):!1}getAllFieldsWithCustomRenderers(t){this.#c();const a=this.#e.FeatureLayers.find(f=>f.Name===t.title);if(!a)return[];const s=this.#e.Fields.filter(f=>f.FeatureLayerId===a.Id),u=[];for(const f of s)this.#e.CustomRenderers_Fields.some(b=>b.FieldId===f.Id)&&u.push(f.Name);return u}async applyCustomRenderer(t,a){this.#c();const s=this.#e.FeatureLayers.find(E=>E.Name===t.title);if(!s)return;const u=this.#e.Fields.find(E=>E.FeatureLayerId===s.Id&&E.Name===a);if(!u){console.warn(`[custom-renderer-service] could not find the field ${a} for feature layer id ${s.Id}`);return}const f=this.#e.CustomRenderers_Fields.find(E=>E.FieldId===u.Id);if(!f){console.warn(`[custom-renderer-service] could not find a custom renderer field for field ${a} in feature layer id ${s.Id}`);return}const h=this.#e.CustomRenderers.find(E=>E.Id===f.CustomRendererId);if(!h)throw new Error(`Could not find a custom renderer with the id ${f.CustomRendererId}`);const b=await this.getRendererClassBreaks(h.ClassBreaksGroupId.toString()),P=await this.getRendererSymbols(h.SymbolsId.toString()),A=this.#i(h.CustomRendererType,P,b,[],a);t.renderer=A,this.setCustomOutlines(t,h.LodsGroupId)}async setCustomOutlines(t,a){const s=this.#e.CustomRenderers_Lods.filter(h=>h.GroupId===a).sort((h,b)=>h.Lod-b.Lod);if(s.length===0){console.warn(`No LODs found for LODs group id ${a}`);return}const u=[],f=Object.values(Dc);s.forEach(h=>{const b=h.OutlineWidth,P=h.Lod,A=this.#n(f,P)-1;u.push({size:b,value:f[A].scale})}),(t.renderer instanceof na||t.renderer instanceof ia)&&this.#l(t.renderer,u)}async getRendererClassBreaks(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_ClassBreaks.filter(u=>u.GroupId===a).sort((u,f)=>u.Order-f.Order);if(s.length===0)throw new Error(`Could not find a group with the id ${t}`);return s}async getRendererSymbols(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_Symbols.find(h=>h.Id===a);if(!s)throw new Error(`Could not find a symbol with the id ${t}`);const u=this.#e.CustomRenderers_Symbols_Appearances.filter(h=>h.SymbolsId===a).sort((h,b)=>h.Order-b.Order);return{...s,Appearances:u}}#n(t,a){const s=t.findIndex(u=>u.lod===a);return s===-1?0:s<23?s+1:s}#i(t,a,s,u,f){switch(t){case 1:return this.#s(a,u);case 2:return this.#a(f,a,s,u);default:throw new Error(`Unknown renderer type: ${t}`)}}#a(t,a,s,u){const f="ClassMinValue",h="ClassMaxValue",b="SymbolColor",P="OutlineColor",A="OutlineWidth",E=a.Appearances.length,V=new na({field:t});for(let D=0;D<E;D++){const W=s[D][f],M=s[D][h],L=a.Appearances[D][b],K=a.Appearances[D][P],N=a.Appearances[D][A];V.addClassBreakInfo({minValue:W,maxValue:M,symbol:new aa({color:pn.fromHex(L),outline:new oa({color:pn.fromHex(K),width:N})})})}return this.#l(V,u),V}#s(t,a){const s="SymbolColor",u="OutlineColor",f="OutlineWidth",h=t.Appearances[0][s],b=t.Appearances[0][u],P=t.Appearances[0][f],A=new ia({symbol:new aa({color:pn.fromHex(h),outline:new oa({color:pn.fromHex(b),width:P})})});return this.#l(A,a),A}#l(t,a){t.visualVariables=[{type:"size",target:"outline",valueExpression:"$view.scale",stops:a}]}#c(){if(!this.#t)throw new Error("CustomRendererService is not initialized");if(!this.#e)throw new Error("Data is not loaded")}}var Vc=ae('<div class="flex w-full items-center justify-between"><div class="font-medium">Chat</div> <div class="flex gap-1"><!> <!></div></div>'),Lc=ae("<!> <!>",1),Rc=ae("<div><!></div>");function Mc(k,t){De(t,!0);const a=Ve(t,"isOpenedOnInit",3,!1);let s=ne(!1),u=ne(Re(a())),f=ne(!1),h=ne(void 0),b="300px",P="45px";je(()=>{c(s)||!c(h)||(c(u)&&(c(h).style.height=b),B(s,!0))});function A(){c(h)&&(B(u,!c(u)),B(f,!1),c(u)?(P=c(h).style.height,c(h).style.height=b):c(h).style.height=P)}function E(){c(h)&&(B(f,!c(f)),c(f)?(b=c(h).style.height,c(h).style.height="100%"):c(h).style.height=b)}var V=Rc(),D=ee(V);Oe(D,()=>In,(W,M)=>{M(W,{class:"h-full w-full gap-0 rounded-none py-0 pt-0 pb-0",children:(L,K)=>{var N=Lc(),H=Z(N);Oe(H,()=>ms,(le,te)=>{te(le,{class:"pt-2",children:(oe,he)=>{var Ie=Vc(),ce=ue(ee(Ie),2),ye=ee(ce);{var Se=Fe=>{Nt(Fe,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:E,children:(Be,Qe)=>{var ke=de(),Le=Z(ke);{var ge=at=>{Vl(at,{class:"text-primary"})},Ee=at=>{Nl(at,{class:"text-primary"})};ve(Le,at=>{c(f)?at(ge):at(Ee,!1)})}T(Be,ke)},$$slots:{default:!0}})};ve(ye,Fe=>{c(u)&&Fe(Se)})}var _e=ue(ye,2);Nt(_e,{class:"size-6 border-1 bg-background hover:bg-accent focus-visible:border-ring",onclick:A,children:(Fe,Be)=>{var Qe=de(),ke=Z(Qe);{var Le=Ee=>{Dl(Ee,{class:"text-primary"})},ge=Ee=>{ys(Ee,{class:"text-primary"})};ve(ke,Ee=>{c(u)?Ee(ge,!1):Ee(Le)})}T(Fe,Qe)},$$slots:{default:!0}}),X(ce),X(Ie),T(oe,Ie)},$$slots:{default:!0}})});var j=ue(H,2);{var U=le=>{var te=de(),oe=Z(te);Oe(oe,()=>kn,(he,Ie)=>{Ie(he,{class:"h-full min-h-[10px] w-full p-0",children:(ce,ye)=>{var Se=de(),_e=Z(Se);Ze(_e,()=>t.children??Ke),T(ce,Se)},$$slots:{default:!0}})}),T(le,te)};ve(j,le=>{c(u)&&le(U)})}T(L,N)},$$slots:{default:!0}})}),X(V),Lt(V,W=>B(h,W),()=>c(h)),T(k,V),Ne()}class jc{#e;#t;#r=ne(!1);#n=Ce(()=>this.#e.exportSnapshot());#i=Ce(()=>{const t=new wt;for(const[a,s]of this.#t.dataSelections)t.set(a,{layerId:s.layerId,selectedFieldIds:s.selectedFieldIds});return t});constructor(t,a){this.#e=t,this.#t=a,wa(()=>{je(()=>{console.log("[selection-tracking-store] Detected area selection change"),(async()=>{if(!c(this.#r)){console.log("[selection-tracking-store] Initial load not complete, skipping area selection effect");return}if(c(this.#n)){if(!c(this.#n).layerId){await Nr({areas:null});return}if(!c(this.#n).selectedAreaIds.size){await Nr({areas:null});return}await Nr({areas:c(this.#n)}),console.log("[selection-tracking-store] Area selection updated:",ai(c(this.#n)))}})()}),je(()=>{console.log("[selection-tracking-store] Detected data selection change"),(async()=>{if(!c(this.#r)){console.log("[selection-tracking-store] Initial load not complete, skipping data selection effect");return}if(!c(this.#i)||c(this.#i).size===0){console.log("[selection-tracking-store] No data selections, clearing in database"),await Nr({data:[]});return}await Nr({data:c(this.#i).values().toArray()}),console.log("[selection-tracking-store] Data selection updated:",ai(c(this.#i)))})()})})}async loadSelections(){const t=await Pa();if(!t){console.log("[selection-tracking-store] No existing selection found in database"),B(this.#r,!0);return}console.log("[selection-tracking-store] Loaded selection from database:",t),t.areas&&(this.#e.setLayerId(t.areas.layerId),console.log("[selection-tracking-store] (loadSelections) Restoring selected area IDs:",Array.from(t.areas.selectedAreaIds),"layer ID:",this.#e.layerId),this.#e.addSelectedAreas(Array.from(t.areas.selectedAreaIds))),t.data.forEach(a=>{this.#t.addSelection(a)}),B(this.#r,!0)}}var Hc=ae("<!> <!>",1),Kc=ae('<p class="p-4 text-center text-sm text-gray-500">Download service is not available.</p>'),qc=ae("<div><!></div> <div><!></div> <div><!></div> <div><!></div>",1),Bc=ae("<div><!></div>"),zc=ae('<p class="p-4 text-center text-sm text-gray-500">AI UPRN Chatbot service is not available.</p>'),Uc=ae('<div class="relative flex h-full w-full min-w-0 flex-col overflow-visible"><!> <!> <!> <!></div>'),Gc=ae("<!> <!> <!> <!>",1);function sd(k,t){De(t,!0);let a,s,u;const f=Re(new _l),h=Re(new wl);let b=ne("define-areas"),P=Re(new ml),A=Re(new Pc),E=ne(null),V=Re(new jc(A,P)),D=ne(null),W=ne(void 0),M=ne(void 0),L=ne(void 0),K=ne(void 0),N=ne(void 0),H=ne(!1),j=ne(!1),U=ne(Re(new Set)),le=ne(Re(new Set)),te=ne(!0),oe=Re(ra.LEFT);Re(ra.BOTTOM);let he=ne(Re([])),Ie=ne(Re(typeof window<"u"?window.innerWidth:1280)),ce=Ce(()=>Se(c(he),fe=>fe.originalSize)),ye=Ce(()=>Se(c(he),fe=>fe.minSize));function Se(fe,Me){if(!fe||fe.length===0)return;const Ae=[...fe].sort((et,At)=>At.breakpoint-et.breakpoint).find(et=>c(Ie)>=et.breakpoint);return Ae?Me(Ae):"0"}function _e(){B(te,!c(te))}function Fe(fe){B(b,fe,!0)}function Be(){B(b,"downloads")}function Qe(){A.clearSelectedAreas(),P.clearSelections(),a?.clearSelections(),s?.clearSelections(),rl()}Rr(async()=>{B(L,new Nc,!0),await c(L).init(`${Zo}/custom-renderers.json`),console.log("[uprn-2/page] CustomRendererService initialized");const fe=await ds();await V.loadSelections();const[{default:Me}]=await Promise.all([Vr(()=>import("../chunks/DBuKqDYo.js").then(Ae=>Ae.a2),__vite__mapDeps([40,1,2,3,5,41,42,26,43,23,6,7,44,33,34,45,21,22,46,8,9,10,11,24,47,48,18,49,50,51,52,25,53,54,55,56,57,12,16,58,59,60,61,62,63,35,64,65,66,27,67,68,69,70,71,14,15,72,0,4,13,17,19,20,28,29,30,31,32,36,37,38,39,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99]),import.meta.url)]);B(D,new Me,!0),B(E,new Oc(A,new La(c(D))),!0),B(le,new Set((fe.serviceUprn2Config.selectionLayersNameFields||[]).map(Ae=>Ae.layerName)),!0),c(E).setFieldInfos(fe.serviceUprn2Config.selectionLayersNameFields||[]),B(he,fe.serviceUprn2Config.mainSidebarSizes||[],!0),B(W,new pa(fe.serviceUprn2Config.dataSelectionTreeviewConfig),!0),B(M,new pa(fe.serviceUprn2Config.areaSelectionTreeviewConfig),!0),(async()=>{const Ae=fe.serviceUprn2Config.uprnDownloadServiceEndpoints,et=fe.serviceUprn2Config.aiUprnChatbotServiceEndpoints;B(K,new Fc(Ae),!0),B(N,new Tc(et),!0),B(H,await c(K).getHealth(),!0),c(H)?console.log("[uprn-2/page] UPRN Download Service is available"):console.warn("[uprn-2/page] UPRN Download Service is NOT available"),B(j,await c(N).getHealth(),!0),c(j)?console.log("[uprn-2/page] AI UPRN Chatbot Service is available"):console.warn("[uprn-2/page] AI UPRN Chatbot Service is NOT available")})(),B(U,new Set(fe.serviceUprn2Config.dataSelectionTreeviewConfig?.fieldsToHide||[]),!0),await f.initializeAsync({portalUrl:fe.serviceUprn2Config.portalUrl,itemId:fe.serviceUprn2Config.portalItemId||"",proxy:fe.serviceUprn2Config.proxy})}),Rr(()=>{const fe=()=>{B(Ie,window.innerWidth,!0)};return window.addEventListener("resize",fe),()=>{window.removeEventListener("resize",fe)}}),ya(()=>{P.cleanup()});var ke=Gc(),Le=Z(ke);jo(Le,{});var ge=ue(Le,2);Gl(ge,{get dataSelectionStore(){return P},get fieldFilterMenuStore(){return h},get fieldsToHide(){return c(U)}});var Ee=ue(ge,2);{var at=fe=>{var Me=Hc(),Xe=Z(Me);Os(Xe,{get areaSelectionInteractionStore(){return c(E)}});var Ae=ue(Xe,2);Es(Ae,{get areaSelectionInteractionStore(){return c(E)}}),T(fe,Me)};ve(Ee,fe=>{c(E)&&fe(at)})}var ot=ue(Ee,2);{const fe=Xe=>{var Ae=Uc(),et=ee(Ae);Oe(et,()=>kc,(tt,pe)=>{pe(tt,{children:(qe,gt)=>{xc(qe,{get value(){return c(b)},get triggers(){return Ec},onValueChange:Fe})},$$slots:{default:!0}})});var At=ue(et,2);Oe(At,()=>gs,(tt,pe)=>{pe(tt,{children:(qe,gt)=>{var ze=qc(),ut=Z(ze),pt=ee(ut);yn(pt,{children:(kt,Mt)=>{var Ye=de(),dt=Z(Ye);{var _t=$e=>{Lt(ac($e,{get webMap(){return f.data},get treeviewConfigStore(){return c(M)},get areaSelectionStore(){return A}}),ft=>a=ft,()=>a)};ve(dt,$e=>{f.isLoaded&&$e(_t)})}T(kt,Ye)}}),X(ut);var rt=ue(ut,2),st=ee(rt);yn(st,{children:(kt,Mt)=>{var Ye=de(),dt=Z(Ye);{var _t=$e=>{{let ft=Ce(()=>u?.getLayerViewProvider());Lt(pc($e,{get webMap(){return f.data},get dataSelectionStore(){return P},get layerViewProvider(){return c(ft)},get treeviewConfigStore(){return c(W)},get customRendererService(){return c(L)},get fieldFilterMenuStore(){return h}}),jt=>s=jt,()=>s)}};ve(dt,$e=>{f.isLoaded&&$e(_t)})}T(kt,Ye)}}),X(rt);var lt=ue(rt,2),Ue=ee(lt);yn(Ue,{children:(kt,Mt)=>{var Ye=de(),dt=Z(Ye);{var _t=$e=>{Fl($e,{get webMapStore(){return f},get areaSelectionInteractionStore(){return c(E)},get dataSelectionStore(){return P},get dataSelectionTreeviewConfig(){return c(W)},get fieldFilterMenuStore(){return h}})};ve(dt,$e=>{c(E)&&f.isLoaded&&$e(_t)})}T(kt,Ye)}}),X(lt);var It=ue(lt,2),Vt=ee(It);yn(Vt,{children:(kt,Mt)=>{var Ye=de(),dt=Z(Ye);{var _t=ft=>{var jt=Kc();T(ft,jt)},$e=ft=>{vl(ft,{get webMapStore(){return f},get uprnDownloadService(){return c(K)},get fieldsToHide(){return c(U)}})};ve(dt,ft=>{!c(K)||!c(H)?ft(_t):ft($e,!1)})}T(kt,Ye)}}),X(It),ct(()=>{ut.hidden=c(b)!=="define-areas",rt.hidden=c(b)!=="select-data",lt.hidden=c(b)!=="export",It.hidden=c(b)!=="downloads"}),T(qe,ze)},$$slots:{default:!0}})});var re=ue(At,2);Oe(re,()=>Ac,(tt,pe)=>{pe(tt,{children:(qe,gt)=>{var ze=Bc(),ut=ee(ze);{var pt=rt=>{bl(rt,{onExportSuccess:Be,clearSelections:Qe,get areaSelectionInteractionStore(){return c(E)},get dataSelectionStore(){return P}})};ve(ut,rt=>{c(E)&&rt(pt)})}X(ze),ct(()=>ze.hidden=c(b)!=="export"),T(qe,ze)},$$slots:{default:!0}})});var xt=ue(re,2);Mc(xt,{isOpenedOnInit:!0,children:(tt,pe)=>{var qe=de(),gt=Z(qe);{var ze=pt=>{var rt=zc();T(pt,rt)},ut=pt=>{Qs(pt,{get aiUprnChatbotService(){return c(N)}})};ve(gt,pt=>{!c(N)||!c(j)?pt(ze):pt(ut,!1)})}T(tt,qe)},$$slots:{default:!0}}),X(Ae),T(Xe,Ae)},Me=Xe=>{var Ae=de(),et=Z(Ae);{var At=re=>{Lt(yc(re,{get webMap(){return f.data},get mapView(){return c(D)},get areaSelectionInteractionStore(){return c(E)},get interactableLayers(){return c(le)}}),xt=>u=xt,()=>u)};ve(et,re=>{c(E)&&re(At)})}T(Xe,Ae)};Oe(ot,()=>ps,(Xe,Ae)=>{Ae(Xe,{get isOpen(){return c(te)},onToggle:_e,get position(){return oe},get originalSize(){return c(ce)},get minSize(){return c(ye)},sidebarContent:fe,mainContent:Me,$$slots:{sidebarContent:!0,mainContent:!0}})})}T(k,ke),Ne()}export{sd as component};
