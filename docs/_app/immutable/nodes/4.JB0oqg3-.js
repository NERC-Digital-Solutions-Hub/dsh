const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/Bl8rnuVl.js","../chunks/2T-d3wGY.js","../chunks/waHvktcX.js","../chunks/hffy0Rzx.js","../chunks/DyvG63AN.js","../chunks/PPVm8Dsz.js","../chunks/Fcs8KMhh.js","../chunks/PYsgr6Cv.js","../chunks/DbYAGCI-.js","../chunks/DFCWshoE.js","../chunks/RBEyXMDZ.js","../chunks/BIYKSsNl.js","../chunks/Oc_h9hZE.js","../chunks/DkF1Z4lU.js","../chunks/cpoDGpsL.js","../chunks/DU-ErqGv.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/DwdCPDfx.js","../chunks/CTZ1UNPx.js","../chunks/D-Qsslyb.js","../chunks/Cl5lrJ4c.js","../chunks/BJabhzrH.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/DjDSr30s.js","../chunks/Dc_rZGh8.js","../chunks/CK9ZvJtL.js","../chunks/CzHqZRs8.js","../chunks/Djp3mnm5.js","../chunks/BH1_ZIbp.js","../chunks/DQOJ18NT.js","../chunks/BXBxa8EP.js","../chunks/CWUDmh1h.js","../chunks/DNJNSHpN.js","../chunks/T_8yv_P1.js","../chunks/CmwEHcJe.js","../chunks/EzLf78vY.js","../chunks/CG1mDIzK.js","../chunks/D8Go_BIs.js","../chunks/DmgVh9QE.js","../chunks/BJC45UBM.js","../chunks/CuPzseSK.js","../chunks/8qIKADj6.js","../chunks/DZd6gJy7.js","../chunks/CiT-R6ww.js","../chunks/C8BmVxiO.js","../chunks/D9jlpAj6.js","../chunks/DQQCEUfw.js","../chunks/D0tfzO6c.js","../chunks/B0w6K3zv.js","../chunks/BEPojsUC.js","../chunks/DXyksEFc.js","../chunks/9YvG7tFv.js","../chunks/D4TYDP9K.js","../chunks/CKydPM8c.js","../chunks/aQeO9QTD.js","../chunks/DQ-sanwE.js","../chunks/T5g79lU5.js","../chunks/C8wMb1DV.js","../chunks/CwrE9JFv.js","../chunks/ChCwKcfk.js","../chunks/CFs3KF66.js","../chunks/D4jqWVTk.js","../chunks/CyRl_skC.js","../chunks/DPHDVB8x.js","../chunks/DQ_UPYdZ.js","../chunks/Chk7YAAL.js","../chunks/C4eyRFHZ.js","../chunks/Cgb6qxNH.js","../chunks/BO4Cg-lx.js","../chunks/Cpoa0Pl0.js","../chunks/QQC62dOK.js","../chunks/Y37Gx8CG.js","../chunks/BR6VNKmy.js","../chunks/DfXKxpo0.js","../chunks/D7sVKQhb.js","../chunks/DKpmsPfl.js","../chunks/CaVKkSa6.js","../chunks/DaweAjzo.js","../chunks/D3ErzTHD.js","../chunks/B1N-tmtC.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/DMiS-OTm.js","../chunks/pDuGEAnG.js","../chunks/DnunvuTf.js","../chunks/BrScpkSj.js","../chunks/rxpTDz6e.js","../chunks/DxJ7et7C.js","../chunks/Bqq7jIxf.js","../chunks/pqN3HtPu.js","../chunks/CL2NbQte.js","../chunks/DVWPfsZK.js","../chunks/BtB-7_Ra.js","../chunks/D6sTuSoT.js","../chunks/v5Iz_pFo.js","../chunks/C5CzMsLd.js","../chunks/BIvHWkqC.js","../chunks/nhEmNADY.js","../chunks/Cc0p8em1.js","../chunks/DSaI__Pw.js","../chunks/DsREOs0s.js","../chunks/D4rJvusO.js","../chunks/CwPiu7wo.js","../chunks/Uwrw2lBQ.js","../chunks/CXVmwICL.js","../chunks/C2paPApr.js","../chunks/Iy1qtFao.js","../chunks/Bu3GRQKh.js","../chunks/DqqeMptq.js","../chunks/GKolV7NZ.js","../chunks/BnS5KZpo.js","../chunks/Bu2Vuyh7.js","../chunks/CxFgDrY1.js","../chunks/C8SLqDDX.js","../chunks/C5XDBfwc.js","../chunks/14dRiZGb.js","../chunks/70zqiACQ.js","../chunks/CicDE2DG.js","../chunks/feAiXLJ9.js","../chunks/VMSlSy0z.js","../chunks/sikOcDFm.js","../chunks/dQP78oRE.js","../chunks/CLoWYiSW.js","../chunks/ba8reXJ7.js","../chunks/CmNZTnwm.js","../chunks/BbYbnrBF.js","../chunks/CeKmAjli.js","../chunks/DIc5uS0o.js","../chunks/BbHMUnVw.js","../chunks/Bcy5nBB0.js","../chunks/_upfdDnp.js","../chunks/0JkNXFyN.js","../chunks/DNiBhQnn.js","../chunks/IjJXopbw.js","../chunks/C-0n-tNx.js","../chunks/BkMXvjc7.js","../chunks/CMQ-kwA8.js","../chunks/DpcKjTTC.js","../chunks/O-Ul8anM.js","../chunks/kqn4-MNs.js","../chunks/CHlqISZ8.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/Cprvvwdg.js","../chunks/CDxTP2PP.js","../chunks/uh8SQfng.js","../chunks/CrshGUXU.js","../chunks/BKYeoYVj.js","../chunks/eOHKmrdd.js","../chunks/BgtvC5K-.js","../chunks/BqMYqny5.js","../chunks/DCdj6Lab.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/Cnnowq-y.js","../chunks/DX4HWjmP.js","../chunks/DuHHctiS.js","../chunks/D5n7rtX9.js","../chunks/CvnzVtPR.js","../chunks/DPvV7qlo.js","../chunks/CGRxGRTZ.js","../chunks/D_mOb0HF.js","../chunks/D4EqH00e.js","../chunks/Bq-tu-3I.js","../chunks/ot6vm_vH.js","../chunks/DfXR1YJ2.js","../chunks/lyTvC7qH.js","../chunks/D8qMpkmW.js","../chunks/jBHuIm6j.js","../chunks/DRJ43qiD.js","../chunks/DsHDw-MJ.js"])))=>i.map(i=>d[i]);
import{_ as Kr}from"../chunks/PPVm8Dsz.js";import{p as ao,c as ae,a as F,f as oe,t as xr}from"../chunks/coOZIrlZ.js";import{o as Ir,a as ba}from"../chunks/Uko5hq0z.js";import{C as oo,E as so,b8 as lo,b9 as uo,L as co,q as fo,ba as ho,bb as vo,bc as po,Z as wa,am as go,N as mo,n as Je,ay as he,w as u,ab as K,p as Re,f as $,a as Le,c as X,r as Y,aw as ne,ag as $e,u as Xe,B as dt,a4 as fe,A as dr,b7 as yo}from"../chunks/Cv6wsIHX.js";import{p as Me,i as ve,r as Mt,s as kt,l as Or}from"../chunks/BZm1dqWt.js";import{c as Te}from"../chunks/DBL0tk4i.js";import{b as Vt}from"../chunks/BlRPFoB8.js";import{b as bo,s as Tt}from"../chunks/CFXUdVfa.js";import{a as An,e as Cr,s as mi,d as rr,b as wo}from"../chunks/CNhtnZDT.js";import{d as On,c as Pn,S as _a,I as Pr,n as Tr,s as _o,X as So,e as xo,f as Io,g as Co,h as ko,i as Ao,j as Oo,C as Po,k as To}from"../chunks/D6gc7AzJ.js";import{t as fr,k as Eo,l as Fo,m as Do,n as No,L as Mo,o as Ro,h as Lo,i as Vo,S as $t,C as Xi,j as jo,I as Ho,G as Zi,F as ea,b as zo,O as Sa,a as Ko,d as xa,c as yn,p as Bo,r as qo,M as Uo,V as ta,f as $o,e as Go,g as Wo,s as Yo,q as Jo}from"../chunks/oRbFfgUb.js";import{s as Qe,a as zt,i as kr,I as Er}from"../chunks/C5P9LRAx.js";import{g as Qo,d as Tn}from"../chunks/CSZY7Yc5.js";import{c as Ur,B as Pt}from"../chunks/BUTx9XfN.js";import{C as Xo,D as Zo,l as es,o as ts,z as rs,b as bn,B as ns,$ as is,a0 as as,p as It,c as os}from"../chunks/B4Kluiv1.js";import{I as ss,C as ls}from"../chunks/CZQybngF.js";import"../chunks/DRxlFlLC.js";import{b as us}from"../chunks/8O5D-Wnf.js";import"../chunks/IkZAx_0-.js";import ui from"../chunks/v5Iz_pFo.js";import{j as cs}from"../chunks/DxJ7et7C.js";import ds from"../chunks/DkF1Z4lU.js";import{s as ra}from"../chunks/waHvktcX.js";import{O as fs}from"../chunks/PYsgr6Cv.js";import{h as qr}from"../chunks/DWa_dZkv.js";import{h as na}from"../chunks/CWUDmh1h.js";import"../chunks/DA7BPN_p.js";import{l as hs}from"../chunks/DbYAGCI-.js";import"../chunks/2T-d3wGY.js";import"../chunks/hffy0Rzx.js";import"../chunks/D6KPPgz5.js";import"../chunks/C-0n-tNx.js";import"../chunks/BkMXvjc7.js";import"../chunks/DsREOs0s.js";import"../chunks/DXyksEFc.js";import"../chunks/CyRl_skC.js";import"../chunks/CwPiu7wo.js";import{j as ia}from"../chunks/CHlqISZ8.js";import{m as aa}from"../chunks/D4rJvusO.js";import{a as oa,m as sa}from"../chunks/CKydPM8c.js";import{l as wn}from"../chunks/DU-ErqGv.js";import{C as vs}from"../chunks/CSprvsUh.js";const ps=()=>performance.now(),Gt={tick:x=>requestAnimationFrame(x),now:()=>ps(),tasks:new Set};function Ia(){const x=Gt.now();Gt.tasks.forEach(t=>{t.c(x)||(Gt.tasks.delete(t),t.f())}),Gt.tasks.size!==0&&Gt.tick(Ia)}function gs(x){let t;return Gt.tasks.size===0&&Gt.tick(Ia),{promise:new Promise(a=>{Gt.tasks.add(t={c:x,f:a})}),abort(){Gt.tasks.delete(t)}}}function _n(x,t){wa(()=>{x.dispatchEvent(new CustomEvent(t))})}function ms(x){if(x==="float")return"cssFloat";if(x==="offset")return"cssOffset";if(x.startsWith("--"))return x;const t=x.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function la(x){const t={},a=x.split(";");for(const s of a){const[c,h]=s.split(":");if(!c||h===void 0)break;const f=ms(c.trim());t[f]=h.trim()}return t}const ys=x=>x;function Cn(x,t,a,s){var c=(x&vo)!==0,h=(x&po)!==0,f=c&&h,g=(x&ho)!==0,P=f?"both":c?"in":"out",w,A=t.inert,N=t.style.overflow,E,q;function L(){return wa(()=>w??=a()(t,s?.()??{},{direction:P}))}var M={is_global:g,in(){if(t.inert=A,!c){q?.abort(),q?.reset?.();return}h||E?.abort(),_n(t,"introstart"),E=ci(t,L(),q,1,()=>{_n(t,"introend"),E?.abort(),E=w=void 0,t.style.overflow=N})},out(j){if(!h){j?.(),w=void 0;return}t.inert=!0,_n(t,"outrostart"),q=ci(t,L(),E,0,()=>{_n(t,"outroend"),j?.()})},stop:()=>{E?.abort(),q?.abort()}},H=oo;if((H.transitions??=[]).push(M),c&&bo){var R=g;if(!R){for(var z=H.parent;z&&(z.f&so)!==0;)for(;(z=z.parent)&&(z.f&lo)===0;);R=!z||(z.f&uo)!==0}R&&co(()=>{fo(()=>M.in())})}}function ci(x,t,a,s,c){var h=s===1;if(go(t)){var f,g=!1;return mo(()=>{if(!g){var H=t({direction:h?"in":"out"});f=ci(x,H,a,s,c)}}),{abort:()=>{g=!0,f?.abort()},deactivate:()=>f.deactivate(),reset:()=>f.reset(),t:()=>f.t()}}if(a?.deactivate(),!t?.duration)return c(),{abort:Je,deactivate:Je,reset:Je,t:()=>s};const{delay:P=0,css:w,tick:A,easing:N=ys}=t;var E=[];if(h&&a===void 0&&(A&&A(0,1),w)){var q=la(w(0,1));E.push(q,q)}var L=()=>1-s,M=x.animate(E,{duration:P,fill:"forwards"});return M.onfinish=()=>{M.cancel();var H=a?.t()??1-s;a?.abort();var R=s-H,z=t.duration*Math.abs(R),j=[];if(z>0){var G=!1;if(w)for(var le=Math.ceil(z/16.666666666666668),re=0;re<=le;re+=1){var se=H+R*N(re/le),ge=la(w(se,1-se));j.push(ge),G||=ge.overflow==="hidden"}G&&(x.style.overflow="hidden"),L=()=>{var Oe=M.currentTime;return H+R*N(Oe/z)},A&&gs(()=>{if(M.playState!=="running")return!1;var Oe=L();return A(Oe,1-Oe),!0})}M=x.animate(j,{duration:z,fill:"forwards"}),M.onfinish=()=>{L=()=>s,A?.(s,1-s),c()}},{abort:()=>{M&&(M.cancel(),M.effect=null,M.onfinish=Je)},deactivate:()=>{c=Je},reset:()=>{s===0&&A?.(1,0)},t:()=>L()}}const bs=ts({component:"avatar",parts:["root","image","fallback"]}),ws=new Xo("Avatar.Root");class yi{static create(t){return ws.set(new yi(t))}opts;domContext;attachment;constructor(t){this.opts=t,this.domContext=new Zo(this.opts.ref),this.loadImage=this.loadImage.bind(this),this.attachment=es(this.opts.ref)}loadImage(t,a,s){if(this.opts.loadingStatus.current==="loaded")return;let c;const h=new Image;return h.src=t,a!==void 0&&(h.crossOrigin=a),s&&(h.referrerPolicy=s),this.opts.loadingStatus.current="loading",h.onload=()=>{c=this.domContext.setTimeout(()=>{this.opts.loadingStatus.current="loaded"},this.opts.delayMs.current)},h.onerror=()=>{this.opts.loadingStatus.current="error"},()=>{c&&this.domContext.clearTimeout(c)}}#e=he(()=>({id:this.opts.id.current,[bs.root]:"","data-status":this.opts.loadingStatus.current,...this.attachment}));get props(){return u(this.#e)}set props(t){K(this.#e,t)}}var _s=oe("<div><!></div>");function Ss(x,t){const a=ao();Re(t,!0);let s=Me(t,"delayMs",3,0),c=Me(t,"loadingStatus",15,"loading"),h=Me(t,"id",19,()=>rs(a)),f=Me(t,"ref",15,null),g=Mt(t,["$$slots","$$events","$$legacy","delayMs","loadingStatus","onLoadingStatusChange","child","children","id","ref"]);const P=yi.create({delayMs:bn(()=>s()),loadingStatus:bn(()=>c(),L=>{c()!==L&&(c(L),t.onLoadingStatusChange?.(L))}),id:bn(()=>h()),ref:bn(()=>f(),L=>f(L))}),w=he(()=>ns(g,P.props));var A=ae(),N=$(A);{var E=L=>{var M=ae(),H=$(M);Qe(H,()=>t.child,()=>({props:u(w)})),F(L,M)},q=L=>{var M=_s();An(M,()=>({...u(w)}));var H=X(M);Qe(H,()=>t.children??Je),Y(M),F(L,M)};ve(N,L=>{t.child?L(E):L(q,!1)})}F(x,A),Le()}var xs=oe('<p class="text-sm font-medium"> </p>'),Is=oe('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function Cs(x,t){Re(t,!0);let a=ne(null),s=ne($e({x:0,y:0})),c=0;const h=w=>{K(s,{x:w.clientX,y:w.clientY},!0)};Xe(()=>(document.addEventListener("mousemove",h),()=>{document.removeEventListener("mousemove",h)})),Xe(()=>{const w=t.areaSelectionInteractionStore.currentHoveredArea?.id,A=++c;if(!w){K(a,null);return}(async()=>{const N=await t.areaSelectionInteractionStore.getAreaNamesById([w]);A===c&&t.areaSelectionInteractionStore.currentHoveredArea?.id===w&&K(a,N[0]??null,!0)})()});var f=ae(),g=$(f);{var P=w=>{var A=Is(),N=X(A);Te(N,()=>Pn,(E,q)=>{q(E,{class:"max-w-xs border !py-2 shadow-lg",children:(L,M)=>{var H=ae(),R=$(H);Te(R,()=>On,(z,j)=>{j(z,{class:"!px-3 !py-0",children:(G,le)=>{var re=xs(),se=X(re,!0);Y(re),dt(()=>Tt(se,u(a))),F(G,re)},$$slots:{default:!0}})}),F(L,H)},$$slots:{default:!0}})}),Y(A),dt(()=>Cr(A,`left: ${u(s).x+10}px; top: ${u(s).y-10}px;`)),F(w,A)};ve(g,w=>{u(a)&&w(P)})}F(x,f),Le()}function ks(x,t){Re(t,!0);async function a(s,c){const h=await t.areaSelectionInteractionStore.getAreaNamesById([s]);if(!h||h.length===0||!h[0])return;const f=`Area ${c}: ${h[0]}`;fr.success(f)}Xe(()=>{t.areaSelectionInteractionStore.lastAddedArea&&a(t.areaSelectionInteractionStore.lastAddedArea.id,"added")}),Xe(()=>{t.areaSelectionInteractionStore.lastRemovedArea&&a(t.areaSelectionInteractionStore.lastRemovedArea.id,"removed")}),Le()}var As=oe("<div><!></div>");function ua(x,t){Re(t,!0);let a=Me(t,"ref",15,null),s=Mt(t,["$$slots","$$events","$$legacy","ref","variant","children"]);var c=As();An(c,()=>({...s,class:"group/chat-bubble flex max-w-[80%] flex-row place-items-end gap-2 data-[variant='sent']:place-self-end","data-variant":t.variant}));var h=X(c);Qe(h,()=>t.children??Je),Y(c),Vt(c,f=>a(f),()=>a()),F(x,c),Le()}var Os=oe('<span class="inline-block size-(--loading-dots-size) rounded-full bg-primary svelte-k2x6sv"></span>'),Ps=oe('<div class="inline-flex items-center gap-1 svelte-k2x6sv"></div>');function Ts(x,t){let a=Me(t,"size",3,4);var s=Ps();let c;zt(s,20,()=>({length:3}),kr,(h,f)=>{var g=Os();F(h,g)}),Y(s),dt(h=>c=Cr(s,"",c,h),[()=>({"--loading-dots-size":`${a()??""}px`})]),F(x,s)}var Es=oe('<div class="flex size-full place-items-center justify-center"><!></div>'),Fs=oe("<div><!></div>");function li(x,t){Re(t,!0);let a=Me(t,"ref",15,null),s=Me(t,"typing",3,!1),c=Mt(t,["$$slots","$$events","$$legacy","ref","typing","class","children"]);var h=Fs();An(h,w=>({...c,class:w}),[()=>Ur("order-2 rounded-lg bg-secondary p-4 text-sm group-data-[variant='received']/chat-bubble:rounded-bl-none group-data-[variant='sent']/chat-bubble:order-1 group-data-[variant='sent']/chat-bubble:rounded-br-none group-data-[variant='sent']/chat-bubble:bg-primary group-data-[variant='sent']/chat-bubble:text-primary-foreground",t.class)]);var f=X(h);{var g=w=>{var A=Es(),N=X(A);Ts(N,{}),Y(A),F(w,A)},P=w=>{var A=ae(),N=$(A);Qe(N,()=>t.children??Je),F(w,A)};ve(f,w=>{s()?w(g):w(P,!1)})}Y(h),Vt(h,w=>a(w),()=>a()),F(x,h),Le()}function Ds(x,t){Re(t,!0);let a=Me(t,"ref",15,null),s=Mt(t,["$$slots","$$events","$$legacy","ref","class"]);var c=ae(),h=$(c);{let f=he(()=>Ur("relative flex size-8 shrink-0 overflow-hidden rounded-full",t.class));Te(h,()=>Ss,(g,P)=>{P(g,kt({"data-slot":"avatar",get class(){return u(f)}},()=>s,{get ref(){return a()},set ref(w){a(w)}}))})}F(x,c),Le()}function ca(x,t){Re(t,!0);let a=Me(t,"ref",15,null),s=Mt(t,["$$slots","$$events","$$legacy","ref","class"]);{let c=he(()=>Ur("order-1 group-data-[variant='sent']/chat-bubble:order-2",t.class));Ds(x,kt({get class(){return u(c)}},()=>s,{get ref(){return a()},set ref(h){a(h)}}))}Le()}function Ns(x,t){Re(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];Er(x,kt({name:"arrow-down"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Qe(g,()=>t.children??Je),F(c,f)},$$slots:{default:!0}})),Le()}function Ca(x){const t=x-1;return t*t*t+1}function da(x,{delay:t=0,duration:a=400,easing:s=Ca,axis:c="y"}={}){const h=getComputedStyle(x),f=+h.opacity,g=c==="y"?"height":"width",P=parseFloat(h[g]),w=c==="y"?["top","bottom"]:["left","right"],A=w.map(R=>`${R[0].toUpperCase()}${R.slice(1)}`),N=parseFloat(h[`padding${A[0]}`]),E=parseFloat(h[`padding${A[1]}`]),q=parseFloat(h[`margin${A[0]}`]),L=parseFloat(h[`margin${A[1]}`]),M=parseFloat(h[`border${A[0]}Width`]),H=parseFloat(h[`border${A[1]}Width`]);return{delay:t,duration:a,easing:s,css:R=>`overflow: hidden;opacity: ${Math.min(R*20,1)*f};${g}: ${R*P}px;padding-${w[0]}: ${R*N}px;padding-${w[1]}: ${R*E}px;margin-${w[0]}: ${R*q}px;margin-${w[1]}: ${R*L}px;border-${w[0]}-width: ${R*M}px;border-${w[1]}-width: ${R*H}px;min-${g}: 0`}}function fa(x,{delay:t=0,duration:a=400,easing:s=Ca,start:c=0,opacity:h=0}={}){const f=getComputedStyle(x),g=+f.opacity,P=f.transform==="none"?"":f.transform,w=1-c,A=g*(1-h);return{delay:t,duration:a,easing:s,css:(N,E)=>`
			transform: ${P} scale(${1-w*E});
			opacity: ${g-A*E}
		`}}class Ms{#e=ne();#t=ne(0);#r=ne(!1);lastScrollHeight=0;set ref(t){if(K(this.#e,t,!0),!u(this.#e))return;this.lastScrollHeight=u(this.#e).scrollHeight,u(this.#e).scrollTo(0,u(this.#t)?u(this.#t):u(this.#e).scrollHeight),u(this.#e).addEventListener("scroll",()=>{u(this.#e)&&(K(this.#t,u(this.#e).scrollTop,!0),this.disableAutoScroll())}),window.addEventListener("resize",()=>{this.scrollToBottom(!0)}),new MutationObserver(()=>{u(this.#e)&&(u(this.#e).scrollHeight!==this.lastScrollHeight&&this.scrollToBottom(!0),this.lastScrollHeight=u(this.#e).scrollHeight)}).observe(u(this.#e),{childList:!0,subtree:!0})}get ref(){return u(this.#e)}get scrollY(){return u(this.#t)}get isAtBottom(){return u(this.#e)?u(this.#t)+u(this.#e).offsetHeight>=u(this.#e).scrollHeight:!0}disableAutoScroll(){this.isAtBottom?K(this.#r,!1):K(this.#r,!0)}scrollToBottom(t=!1){u(this.#e)&&(t&&u(this.#r)||u(this.#e).scrollTo(0,u(this.#e).scrollHeight))}}var Rs=oe("<div><!></div>"),Ls=oe('<div class="relative"><div><!></div> <!></div>');function Vs(x,t){Re(t,!0);let a=Me(t,"ref",15,null),s=Mt(t,["$$slots","$$events","$$legacy","ref","children","class"]),c=ne(!1);const h=new Ms;Ir(()=>{K(c,!0)});var f=Ls(),g=X(f);An(g,N=>({...s,class:N}),[()=>Ur("no-scrollbar flex h-full w-full flex-col gap-4 overflow-y-auto p-4",t.class,{"scroll-smooth":u(c)})]);var P=X(g);Qe(P,()=>t.children??Je),Y(g),Vt(g,N=>a(N),()=>a()),Vt(g,N=>h.ref=N,()=>h?.ref);var w=fe(g,2);{var A=N=>{var E=Rs(),q=X(E);Pt(q,{onclick:()=>h.scrollToBottom(),variant:"outline",size:"icon",class:"absolute bottom-2 left-1/2 inline-flex -translate-x-1/2 transform rounded-full shadow-md",children:(L,M)=>{Ns(L,{})},$$slots:{default:!0}}),Y(E),Cn(1,E,()=>fa,()=>({start:.85,duration:100,delay:250})),Cn(2,E,()=>fa,()=>({start:.85,duration:100})),F(N,E)};ve(w,N=>{h.isAtBottom||N(A)})}Y(f),F(x,f),Le()}function js(x,t){Re(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];Er(x,kt({name:"send"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Qe(g,()=>t.children??Je),F(c,f)},$$slots:{default:!0}})),Le()}var Hs=oe(`<p class="break-words whitespace-pre-wrap"> </p> <div class="w-full text-xs group-data-[variant='sent']/chat-bubble:text-end"> </div>`,1),zs=oe("<!> <!>",1),Ks=oe('<p class="break-words whitespace-pre-wrap"> </p>'),Bs=oe("<!> <!>",1),qs=oe("<!> <!>",1),Us=oe('<div class="chat-container h-full w-full border border-border svelte-1osgd7m"><div class="message-wrapper svelte-1osgd7m"><!></div> <div class="input-wrapper svelte-1osgd7m"><form class="flex shrink-0 items-center gap-2 border-t border-border bg-background p-2"><!> <!></form></div></div>');function $s(x,t){Re(t,!0);const a=1,s=2,c="Sorry, I encountered an error processing your request.",h="How can I help?";let f=ne(""),g=ne(!1),P=ne(""),w=ne(null),A=ne(null),N=ne(null);const E=$e([{senderId:a,message:h,sentAt:q(new Date)}]);Xe(()=>{if(u(A)&&u(N)){const ue=u(A),be=u(N),Ce=()=>{const Ee=ue.offsetHeight;be.style.paddingBottom=`${Ee}px`};Ce();const we=new ResizeObserver(Ce);return we.observe(ue),()=>{we.disconnect()}}}),Xe(()=>{E.length,u(P),u(w)&&setTimeout(()=>{const ue=u(w)?.querySelector('[data-slot="scroll-area-viewport"]');ue&&(ue.scrollTop=ue.scrollHeight)},0)});function q(ue){const be=ue.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Ce=ue.getHours()>=12?"PM":"AM";return`${be} ${Ce}`}function L(ue,be){return{message:ue,senderId:be,sentAt:q(new Date)}}function M(ue,be){E.push(L(ue,be))}function H(){K(g,!1),K(P,"")}function R(ue){K(P,u(P)+ue)}async function z(ue){if(ue.preventDefault(),!u(f).trim()||u(g))return;const be=u(f).trim();K(f,""),M(be,s),K(g,!0),K(P,"");try{await t.aiUprnChatbotService.chatStream(be,R)&&u(P)?M(u(P),a):M(c,a)}catch(Ce){console.error("Chat error:",Ce),M(c,a)}finally{H()}}var j=Us(),G=X(j),le=X(G);_a(le,{class:"h-full w-full",get ref(){return u(w)},set ref(ue){K(w,ue,!0)},children:(ue,be)=>{var Ce=ae(),we=$(Ce);Te(we,()=>Vs,(Ee,Ke)=>{Ke(Ee,{children:(We,Ie)=>{var Ve=qs(),me=$(Ve);zt(me,16,()=>E,Ue=>Ue,(Ue,Ne)=>{var ke=ae(),de=$(ke);{let _e=he(()=>Ne.senderId===s?"sent":"received");Te(de,()=>ua,(je,ft)=>{ft(je,{get variant(){return u(_e)},children:(Z,at)=>{var Ge=zs(),ye=$(Ge);Te(ye,()=>ca,(lt,He)=>{He(lt,{})});var Be=fe(ye,2);Te(Be,()=>li,(lt,He)=>{He(lt,{class:"flex flex-col gap-1",children:(Ze,At)=>{var ht=Hs(),et=$(ht),ot=X(et,!0);Y(et);var tt=fe(et,2),pt=X(tt,!0);Y(tt),dt(()=>{Tt(ot,Ne.message),Tt(pt,Ne.sentAt)}),F(Ze,ht)},$$slots:{default:!0}})}),F(Z,Ge)},$$slots:{default:!0}})})}F(Ue,ke)});var Fe=fe(me,2);{var pe=Ue=>{var Ne=ae(),ke=$(Ne);Te(ke,()=>ua,(de,_e)=>{_e(de,{variant:"received",children:(je,ft)=>{var Z=Bs(),at=$(Z);Te(at,()=>ca,(ye,Be)=>{Be(ye,{})});var Ge=fe(at,2);Te(Ge,()=>li,(ye,Be)=>{Be(ye,{class:"flex flex-col gap-1",children:(lt,He)=>{var Ze=ae(),At=$(Ze);{var ht=ot=>{var tt=Ks(),pt=X(tt,!0);Y(tt),dt(()=>Tt(pt,u(P))),F(ot,tt)},et=ot=>{var tt=ae(),pt=$(tt);Te(pt,()=>li,(Et,gt)=>{gt(Et,{typing:!0})}),F(ot,tt)};ve(At,ot=>{u(P)?ot(ht):ot(et,!1)})}F(lt,Ze)},$$slots:{default:!0}})}),F(je,Z)},$$slots:{default:!0}})}),F(Ue,Ne)};ve(Fe,Ue=>{u(g)&&Ue(pe)})}F(We,Ve)},$$slots:{default:!0}})}),F(ue,Ce)},$$slots:{default:!0}}),Y(G),Vt(G,ue=>K(N,ue),()=>u(N));var re=fe(G,2),se=X(re),ge=X(se);ss(ge,{class:"rounded-full",placeholder:"Type a message...",get disabled(){return u(g)},get value(){return u(f)},set value(ue){K(f,ue,!0)}});var Oe=fe(ge,2);{let ue=he(()=>u(f).trim()===""||u(g));Pt(Oe,{type:"submit",variant:"default",size:"icon",class:"shrink-0 rounded-full",get disabled(){return u(ue)},children:(be,Ce)=>{js(be,{})},$$slots:{default:!0}})}Y(se),Vt(se,ue=>K(A,ue),()=>u(A)),Y(re),Y(j),Qo("submit",se,z),F(x,j),Le()}const er=Object.freeze({Pending:"pending",InProgress:"in-progress",Completed:"completed",Failed:"failed"}),Sn=Object.freeze({Submitted:"SUBMITTED",Queued:"QUEUED",Processing:"IN_PROGRESS",Completed:"COMPLETED",Error:"ERROR"}),Gs=Object.freeze({Success:"success",Error:"error"});var In={exports:{}},Ws=In.exports,ha;function Ys(){return ha||(ha=1,(function(x,t){(function(a,s){x.exports=s()})(Ws,function(){var a=function(e,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(e,r)},s=function(){return(s=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)};function c(e,r,n){for(var i,o=0,l=r.length;o<l;o++)!i&&o in r||((i=i||Array.prototype.slice.call(r,0,o))[o]=r[o]);return e.concat(i||Array.prototype.slice.call(r))}var h=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:is,f=Object.keys,g=Array.isArray;function P(e,r){return typeof r!="object"||f(r).forEach(function(n){e[n]=r[n]}),e}typeof Promise>"u"||h.Promise||(h.Promise=Promise);var w=Object.getPrototypeOf,A={}.hasOwnProperty;function N(e,r){return A.call(e,r)}function E(e,r){typeof r=="function"&&(r=r(w(e))),(typeof Reflect>"u"?f:Reflect.ownKeys)(r).forEach(function(n){L(e,n,r[n])})}var q=Object.defineProperty;function L(e,r,n,i){q(e,r,P(n&&N(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},i))}function M(e){return{from:function(r){return e.prototype=Object.create(r.prototype),L(e.prototype,"constructor",e),{extend:E.bind(null,e.prototype)}}}}var H=Object.getOwnPropertyDescriptor,R=[].slice;function z(e,r,n){return R.call(e,r,n)}function j(e,r){return r(e)}function G(e){if(!e)throw new Error("Assertion Failed")}function le(e){h.setImmediate?setImmediate(e):setTimeout(e,0)}function re(e,r){if(typeof r=="string"&&N(e,r))return e[r];if(!r)return e;if(typeof r!="string"){for(var n=[],i=0,o=r.length;i<o;++i){var l=re(e,r[i]);n.push(l)}return n}var d=r.indexOf(".");if(d!==-1){var v=e[r.substr(0,d)];return v==null?void 0:re(v,r.substr(d+1))}}function se(e,r,n){if(e&&r!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof r!="string"&&"length"in r){G(typeof n!="string"&&"length"in n);for(var i=0,o=r.length;i<o;++i)se(e,r[i],n[i])}else{var l,d,v=r.indexOf(".");v!==-1?(l=r.substr(0,v),(d=r.substr(v+1))===""?n===void 0?g(e)&&!isNaN(parseInt(l))?e.splice(l,1):delete e[l]:e[l]=n:se(v=!(v=e[l])||!N(e,l)?e[l]={}:v,d,n)):n===void 0?g(e)&&!isNaN(parseInt(r))?e.splice(r,1):delete e[r]:e[r]=n}}function ge(e){var r,n={};for(r in e)N(e,r)&&(n[r]=e[r]);return n}var Oe=[].concat;function ue(e){return Oe.apply([],e)}var vt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ue([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(r){return r+e+"Array"})}))).filter(function(e){return h[e]}),be=new Set(vt.map(function(e){return h[e]})),Ce=null;function we(e){return Ce=new WeakMap,e=(function r(n){if(!n||typeof n!="object")return n;var i=Ce.get(n);if(i)return i;if(g(n)){i=[],Ce.set(n,i);for(var o=0,l=n.length;o<l;++o)i.push(r(n[o]))}else if(be.has(n.constructor))i=n;else{var d,v=w(n);for(d in i=v===Object.prototype?{}:Object.create(v),Ce.set(n,i),n)N(n,d)&&(i[d]=r(n[d]))}return i})(e),Ce=null,e}var Ee={}.toString;function Ke(e){return Ee.call(e).slice(8,-1)}var We=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Ie=typeof We=="symbol"?function(e){var r;return e!=null&&(r=e[We])&&r.apply(e)}:function(){return null};function Ve(e,r){return r=e.indexOf(r),0<=r&&e.splice(r,1),0<=r}var me={};function Fe(e){var r,n,i,o;if(arguments.length===1){if(g(e))return e.slice();if(this===me&&typeof e=="string")return[e];if(o=Ie(e)){for(n=[];!(i=o.next()).done;)n.push(i.value);return n}if(e==null)return[e];if(typeof(r=e.length)!="number")return[e];for(n=new Array(r);r--;)n[r]=e[r];return n}for(r=arguments.length,n=new Array(r);r--;)n[r]=arguments[r];return n}var pe=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Ot=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Lt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Ot),Ue={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ne(e,r){this.name=e,this.message=r}function ke(e,r){return e+". Errors: "+Object.keys(r).map(function(n){return r[n].toString()}).filter(function(n,i,o){return o.indexOf(n)===i}).join(`
`)}function de(e,r,n,i){this.failures=r,this.failedKeys=i,this.successCount=n,this.message=ke(e,r)}function _e(e,r){this.name="BulkError",this.failures=Object.keys(r).map(function(n){return r[n]}),this.failuresByPos=r,this.message=ke(e,this.failures)}M(Ne).from(Error).extend({toString:function(){return this.name+": "+this.message}}),M(de).from(Ne),M(_e).from(Ne);var je=Lt.reduce(function(e,r){return e[r]=r+"Error",e},{}),ft=Ne,Z=Lt.reduce(function(e,r){var n=r+"Error";function i(o,l){this.name=n,o?typeof o=="string"?(this.message="".concat(o).concat(l?`
 `+l:""),this.inner=l||null):typeof o=="object"&&(this.message="".concat(o.name," ").concat(o.message),this.inner=o):(this.message=Ue[r]||n,this.inner=null)}return M(i).from(ft),e[r]=i,e},{});Z.Syntax=SyntaxError,Z.Type=TypeError,Z.Range=RangeError;var at=Ot.reduce(function(e,r){return e[r+"Error"]=Z[r],e},{}),Ge=Lt.reduce(function(e,r){return["Syntax","Type","Range"].indexOf(r)===-1&&(e[r+"Error"]=Z[r]),e},{});function ye(){}function Be(e){return e}function lt(e,r){return e==null||e===Be?r:function(n){return r(e(n))}}function He(e,r){return function(){e.apply(this,arguments),r.apply(this,arguments)}}function Ze(e,r){return e===ye?r:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var l=r.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?He(i,this.onsuccess):i),o&&(this.onerror=this.onerror?He(o,this.onerror):o),l!==void 0?l:n}}function At(e,r){return e===ye?r:function(){e.apply(this,arguments);var n=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,r.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?He(n,this.onsuccess):n),i&&(this.onerror=this.onerror?He(i,this.onerror):i)}}function ht(e,r){return e===ye?r:function(n){var i=e.apply(this,arguments);P(n,i);var o=this.onsuccess,l=this.onerror;return this.onsuccess=null,this.onerror=null,n=r.apply(this,arguments),o&&(this.onsuccess=this.onsuccess?He(o,this.onsuccess):o),l&&(this.onerror=this.onerror?He(l,this.onerror):l),i===void 0?n===void 0?void 0:n:P(i,n)}}function et(e,r){return e===ye?r:function(){return r.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function ot(e,r){return e===ye?r:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var i=this,o=arguments.length,l=new Array(o);o--;)l[o]=arguments[o];return n.then(function(){return r.apply(i,l)})}return r.apply(this,arguments)}}Ge.ModifyError=de,Ge.DexieError=Ne,Ge.BulkError=_e;var tt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function pt(e){tt=e}var Et={},gt=100,vt=typeof Promise>"u"?[]:(function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,w(e),e];var r=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[r,w(r),e]})(),Ot=vt[0],Lt=vt[1],vt=vt[2],Lt=Lt&&Lt.then,rt=Ot&&Ot.constructor,mt=!!vt,Rt=function(e,r){Fr.push([e,r]),hr&&(queueMicrotask(Ma),hr=!1)},nr=!0,hr=!0,Kt=[],vr=[],Bt=Be,Ft={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ye,pgp:!1,env:{},finalize:ye},ce=Ft,Fr=[],ir=0,Gr=[];function te(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var r=this._PSD=ce;if(typeof e!="function"){if(e!==Et)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Fn(this,this._value))}this._state=null,this._value=null,++r.ref,(function n(i,o){try{o(function(l){if(i._state===null){if(l===i)throw new TypeError("A promise cannot be resolved with itself.");var d=i._lib&&pr();l&&typeof l.then=="function"?n(i,function(v,m){l instanceof te?l._then(v,m):l.then(v,m)}):(i._state=!0,i._value=l,wi(i)),d&&gr()}},Fn.bind(null,i))}catch(l){Fn(i,l)}})(this,e)}var En={get:function(){var e=ce,r=Qr;function n(i,o){var l=this,d=!e.global&&(e!==ce||r!==Qr),v=d&&!Yt(),m=new te(function(y,I){Dn(l,new bi(Si(i,e,d,v),Si(o,e,d,v),y,I,e))});return this._consoleTask&&(m._consoleTask=this._consoleTask),m}return n.prototype=Et,n},set:function(e){L(this,"then",e&&e.prototype===Et?En:{get:function(){return e},set:En.set})}};function bi(e,r,n,i,o){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof r=="function"?r:null,this.resolve=n,this.reject=i,this.psd=o}function Fn(e,r){var n,i;vr.push(r),e._state===null&&(n=e._lib&&pr(),r=Bt(r),e._state=!1,e._value=r,i=e,Kt.some(function(o){return o._value===i._value})||Kt.push(i),wi(e),n&&gr())}function wi(e){var r=e._listeners;e._listeners=[];for(var n=0,i=r.length;n<i;++n)Dn(e,r[n]);var o=e._PSD;--o.ref||o.finalize(),ir===0&&(++ir,Rt(function(){--ir==0&&Nn()},[]))}function Dn(e,r){if(e._state!==null){var n=e._state?r.onFulfilled:r.onRejected;if(n===null)return(e._state?r.resolve:r.reject)(e._value);++r.psd.ref,++ir,Rt(Na,[n,e,r])}else e._listeners.push(r)}function Na(e,r,n){try{var i,o=r._value;!r._state&&vr.length&&(vr=[]),i=tt&&r._consoleTask?r._consoleTask.run(function(){return e(o)}):e(o),r._state||vr.indexOf(o)!==-1||(function(l){for(var d=Kt.length;d;)if(Kt[--d]._value===l._value)return Kt.splice(d,1)})(r),n.resolve(i)}catch(l){n.reject(l)}finally{--ir==0&&Nn(),--n.psd.ref||n.psd.finalize()}}function Ma(){ar(Ft,function(){pr()&&gr()})}function pr(){var e=nr;return hr=nr=!1,e}function gr(){var e,r,n;do for(;0<Fr.length;)for(e=Fr,Fr=[],n=e.length,r=0;r<n;++r){var i=e[r];i[0].apply(null,i[1])}while(0<Fr.length);hr=nr=!0}function Nn(){var e=Kt;Kt=[],e.forEach(function(i){i._PSD.onunhandled.call(null,i._value,i)});for(var r=Gr.slice(0),n=r.length;n;)r[--n]()}function Wr(e){return new te(Et,!1,e)}function nt(e,r){var n=ce;return function(){var i=pr(),o=ce;try{return Jt(n,!0),e.apply(this,arguments)}catch(l){r&&r(l)}finally{Jt(o,!1),i&&gr()}}}E(te.prototype,{then:En,_then:function(e,r){Dn(this,new bi(null,null,e,r,ce))},catch:function(e){if(arguments.length===1)return this.then(null,e);var r=e,n=arguments[1];return typeof r=="function"?this.then(null,function(i){return(i instanceof r?n:Wr)(i)}):this.then(null,function(i){return(i&&i.name===r?n:Wr)(i)})},finally:function(e){return this.then(function(r){return te.resolve(e()).then(function(){return r})},function(r){return te.resolve(e()).then(function(){return Wr(r)})})},timeout:function(e,r){var n=this;return e<1/0?new te(function(i,o){var l=setTimeout(function(){return o(new Z.Timeout(r))},e);n.then(i,o).finally(clearTimeout.bind(null,l))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&L(te.prototype,Symbol.toStringTag,"Dexie.Promise"),Ft.env=_i(),E(te,{all:function(){var e=Fe.apply(null,arguments).map(Xr);return new te(function(r,n){e.length===0&&r([]);var i=e.length;e.forEach(function(o,l){return te.resolve(o).then(function(d){e[l]=d,--i||r(e)},n)})})},resolve:function(e){return e instanceof te?e:e&&typeof e.then=="function"?new te(function(r,n){e.then(r,n)}):new te(Et,!0,e)},reject:Wr,race:function(){var e=Fe.apply(null,arguments).map(Xr);return new te(function(r,n){e.map(function(i){return te.resolve(i).then(r,n)})})},PSD:{get:function(){return ce},set:function(e){return ce=e}},totalEchoes:{get:function(){return Qr}},newPSD:Wt,usePSD:ar,scheduler:{get:function(){return Rt},set:function(e){Rt=e}},rejectionMapper:{get:function(){return Bt},set:function(e){Bt=e}},follow:function(e,r){return new te(function(n,i){return Wt(function(o,l){var d=ce;d.unhandleds=[],d.onunhandled=l,d.finalize=He(function(){var v,m=this;v=function(){m.unhandleds.length===0?o():l(m.unhandleds[0])},Gr.push(function y(){v(),Gr.splice(Gr.indexOf(y),1)}),++ir,Rt(function(){--ir==0&&Nn()},[])},d.finalize),e()},r,n,i)})}}),rt&&(rt.allSettled&&L(te,"allSettled",function(){var e=Fe.apply(null,arguments).map(Xr);return new te(function(r){e.length===0&&r([]);var n=e.length,i=new Array(n);e.forEach(function(o,l){return te.resolve(o).then(function(d){return i[l]={status:"fulfilled",value:d}},function(d){return i[l]={status:"rejected",reason:d}}).then(function(){return--n||r(i)})})})}),rt.any&&typeof AggregateError<"u"&&L(te,"any",function(){var e=Fe.apply(null,arguments).map(Xr);return new te(function(r,n){e.length===0&&n(new AggregateError([]));var i=e.length,o=new Array(i);e.forEach(function(l,d){return te.resolve(l).then(function(v){return r(v)},function(v){o[d]=v,--i||n(new AggregateError(o))})})})}),rt.withResolvers&&(te.withResolvers=rt.withResolvers));var yt={awaits:0,echoes:0,id:0},Ra=0,Yr=[],Jr=0,Qr=0,La=0;function Wt(e,r,n,i){var o=ce,l=Object.create(o);return l.parent=o,l.ref=0,l.global=!1,l.id=++La,Ft.env,l.env=mt?{Promise:te,PromiseProp:{value:te,configurable:!0,writable:!0},all:te.all,race:te.race,allSettled:te.allSettled,any:te.any,resolve:te.resolve,reject:te.reject}:{},r&&P(l,r),++o.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()},i=ar(l,e,n,i),l.ref===0&&l.finalize(),i}function mr(){return yt.id||(yt.id=++Ra),++yt.awaits,yt.echoes+=gt,yt.id}function Yt(){return!!yt.awaits&&(--yt.awaits==0&&(yt.id=0),yt.echoes=yt.awaits*gt,!0)}function Xr(e){return yt.echoes&&e&&e.constructor===rt?(mr(),e.then(function(r){return Yt(),r},function(r){return Yt(),ut(r)})):e}function Va(){var e=Yr[Yr.length-1];Yr.pop(),Jt(e,!1)}function Jt(e,r){var n,i=ce;(r?!yt.echoes||Jr++&&e===ce:!Jr||--Jr&&e===ce)||queueMicrotask(r?(function(o){++Qr,yt.echoes&&--yt.echoes!=0||(yt.echoes=yt.awaits=yt.id=0),Yr.push(ce),Jt(o,!0)}).bind(null,e):Va),e!==ce&&(ce=e,i===Ft&&(Ft.env=_i()),mt&&(n=Ft.env.Promise,r=e.env,(i.global||e.global)&&(Object.defineProperty(h,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any&&(n.any=r.any))))}function _i(){var e=h.Promise;return mt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(h,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ar(e,r,n,i,o){var l=ce;try{return Jt(e,!0),r(n,i,o)}finally{Jt(l,!1)}}function Si(e,r,n,i){return typeof e!="function"?e:function(){var o=ce;n&&mr(),Jt(r,!0);try{return e.apply(this,arguments)}finally{Jt(o,!1),i&&queueMicrotask(Yt)}}}function Mn(e){Promise===rt&&yt.echoes===0?Jr===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Lt).indexOf("[native code]")===-1&&(mr=Yt=ye);var ut=te.reject,or="ï¿¿",qt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",xi="String expected.",yr=[],Zr="__dbnames",Rn="readonly",Ln="readwrite";function sr(e,r){return e?r?function(){return e.apply(this,arguments)&&r.apply(this,arguments)}:e:r}var Ii={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function en(e){return typeof e!="string"||/\./.test(e)?function(r){return r}:function(r){return r[e]===void 0&&e in r&&delete(r=we(r))[e],r}}function Ci(){throw Z.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function De(e,r){try{var n=ki(e),i=ki(r);if(n!==i)return n==="Array"?1:i==="Array"?-1:n==="binary"?1:i==="binary"?-1:n==="string"?1:i==="string"?-1:n==="Date"?1:i!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return r<e?1:e<r?-1:0;case"binary":return(function(o,l){for(var d=o.length,v=l.length,m=d<v?d:v,y=0;y<m;++y)if(o[y]!==l[y])return o[y]<l[y]?-1:1;return d===v?0:d<v?-1:1})(Ai(e),Ai(r));case"Array":return(function(o,l){for(var d=o.length,v=l.length,m=d<v?d:v,y=0;y<m;++y){var I=De(o[y],l[y]);if(I!==0)return I}return d===v?0:d<v?-1:1})(e,r)}}catch{}return NaN}function ki(e){var r=typeof e;return r!="object"?r:ArrayBuffer.isView(e)?"binary":(e=Ke(e),e==="ArrayBuffer"?"binary":e)}function Ai(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function tn(e,r,n){var i=e.schema.yProps;return i?(r&&0<n.numFailures&&(r=r.filter(function(o,l){return!n.failures[l]})),Promise.all(i.map(function(o){return o=o.updatesTable,r?e.db.table(o).where("k").anyOf(r).delete():e.db.table(o).clear()})).then(function(){return n})):n}var Dr=(Oi.prototype.execute=function(e){var r=this["@@propmod"];if(r.add!==void 0){var n=r.add;if(g(n))return c(c([],g(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(r.remove!==void 0){var i=r.remove;if(g(i))return g(e)?e.filter(function(o){return!i.includes(o)}).sort():[];if(typeof i=="number")return Number(e)-i;if(typeof i=="bigint")try{return BigInt(e)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}return n=(n=r.replacePrefix)===null||n===void 0?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?r.replacePrefix[1]+e.substring(n.length):e},Oi);function Oi(e){this["@@propmod"]=e}function Pi(e,r){for(var n=f(r),i=n.length,o=!1,l=0;l<i;++l){var d=n[l],v=r[d],m=re(e,d);v instanceof Dr?(se(e,d,v.execute(m)),o=!0):m!==v&&(se(e,d,v),o=!0)}return o}var Ti=(Ye.prototype._trans=function(e,r,n){var i=this._tx||ce.trans,o=this.name,l=tt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function d(y,I,p){if(!p.schema[o])throw new Z.NotFound("Table "+o+" not part of transaction");return r(p.idbtrans,p)}var v=pr();try{var m=i&&i.db._novip===this.db._novip?i===ce.trans?i._promise(e,d,n):Wt(function(){return i._promise(e,d,n)},{trans:i,transless:ce.transless||ce}):(function y(I,p,k,b){if(I.idbdb&&(I._state.openComplete||ce.letThrough||I._vip)){var _=I._createTransaction(p,k,I._dbSchema);try{_.create(),I._state.PR1398_maxLoop=3}catch(S){return S.name===je.InvalidState&&I.isOpen()&&0<--I._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),I.close({disableAutoOpen:!1}),I.open().then(function(){return y(I,p,k,b)})):ut(S)}return _._promise(p,function(S,C){return Wt(function(){return ce.trans=_,b(S,C,_)})}).then(function(S){if(p==="readwrite")try{_.idbtrans.commit()}catch{}return p==="readonly"?S:_._completion.then(function(){return S})})}if(I._state.openComplete)return ut(new Z.DatabaseClosed(I._state.dbOpenError));if(!I._state.isBeingOpened){if(!I._state.autoOpen)return ut(new Z.DatabaseClosed);I.open().catch(ye)}return I._state.dbReadyPromise.then(function(){return y(I,p,k,b)})})(this.db,e,[this.name],d);return l&&(m._consoleTask=l,m=m.catch(function(y){return console.trace(y),ut(y)})),m}finally{v&&gr()}},Ye.prototype.get=function(e,r){var n=this;return e&&e.constructor===Object?this.where(e).first(r):e==null?ut(new Z.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return n.core.get({trans:i,key:e}).then(function(o){return n.hook.reading.fire(o)})}).then(r)},Ye.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(g(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var r=f(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(v){if(v.compound&&r.every(function(y){return 0<=v.keyPath.indexOf(y)})){for(var m=0;m<r.length;++m)if(r.indexOf(v.keyPath[m])===-1)return!1;return!0}return!1}).sort(function(v,m){return v.keyPath.length-m.keyPath.length})[0];if(n&&this.db._maxKey!==or){var l=n.keyPath.slice(0,r.length);return this.where(l).equals(l.map(function(m){return e[m]}))}!n&&tt&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(r.join("+"),"]"));var i=this.schema.idxByName;function o(v,m){return De(v,m)===0}var d=r.reduce(function(p,m){var y=p[0],I=p[1],p=i[m],k=e[m];return[y||p,y||!p?sr(I,p&&p.multi?function(b){return b=re(b,m),g(b)&&b.some(function(_){return o(k,_)})}:function(b){return o(k,re(b,m))}):I]},[null,null]),l=d[0],d=d[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(d):n?this.filter(d):this.where(r).equals("")},Ye.prototype.filter=function(e){return this.toCollection().and(e)},Ye.prototype.count=function(e){return this.toCollection().count(e)},Ye.prototype.offset=function(e){return this.toCollection().offset(e)},Ye.prototype.limit=function(e){return this.toCollection().limit(e)},Ye.prototype.each=function(e){return this.toCollection().each(e)},Ye.prototype.toArray=function(e){return this.toCollection().toArray(e)},Ye.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Ye.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,g(e)?"[".concat(e.join("+"),"]"):e))},Ye.prototype.reverse=function(){return this.toCollection().reverse()},Ye.prototype.mapToClass=function(e){var r,n=this.db,i=this.name;function o(){return r!==null&&r.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Ci&&((function(m,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function I(){this.constructor=m}a(m,y),m.prototype=y===null?Object.create(y):(I.prototype=y.prototype,new I)})(o,r=e),Object.defineProperty(o.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),o.prototype.table=function(){return i},e=o);for(var l=new Set,d=e.prototype;d;d=w(d))Object.getOwnPropertyNames(d).forEach(function(m){return l.add(m)});function v(m){if(!m)return m;var y,I=Object.create(e.prototype);for(y in m)if(!l.has(y))try{I[y]=m[y]}catch{}return I}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),e},Ye.prototype.defineClass=function(){return this.mapToClass(function(e){P(this,e)})},Ye.prototype.add=function(e,r){var n=this,i=this.schema.primKey,o=i.auto,l=i.keyPath,d=e;return l&&o&&(d=en(l)(e)),this._trans("readwrite",function(v){return n.core.mutate({trans:v,type:"add",keys:r!=null?[r]:null,values:[d]})}).then(function(v){return v.numFailures?te.reject(v.failures[0]):v.lastResult}).then(function(v){if(l)try{se(e,l,v)}catch{}return v})},Ye.prototype.upsert=function(e,r){var n=this,i=this.schema.primKey.keyPath;return this._trans("readwrite",function(o){return n.core.get({trans:o,key:e}).then(function(l){var d=l??{};return Pi(d,r),i&&se(d,i,e),n.core.mutate({trans:o,type:"put",values:[d],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[r]}}).then(function(v){return v.numFailures?te.reject(v.failures[0]):!!l})})})},Ye.prototype.update=function(e,r){return typeof e!="object"||g(e)?this.where(":id").equals(e).modify(r):(e=re(e,this.schema.primKey.keyPath),e===void 0?ut(new Z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(r))},Ye.prototype.put=function(e,r){var n=this,i=this.schema.primKey,o=i.auto,l=i.keyPath,d=e;return l&&o&&(d=en(l)(e)),this._trans("readwrite",function(v){return n.core.mutate({trans:v,type:"put",values:[d],keys:r!=null?[r]:null})}).then(function(v){return v.numFailures?te.reject(v.failures[0]):v.lastResult}).then(function(v){if(l)try{se(e,l,v)}catch{}return v})},Ye.prototype.delete=function(e){var r=this;return this._trans("readwrite",function(n){return r.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(i){return tn(r,[e],i)}).then(function(i){return i.numFailures?te.reject(i.failures[0]):void 0})})},Ye.prototype.clear=function(){var e=this;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"deleteRange",range:Ii}).then(function(n){return tn(e,null,n)})}).then(function(r){return r.numFailures?te.reject(r.failures[0]):void 0})},Ye.prototype.bulkGet=function(e){var r=this;return this._trans("readonly",function(n){return r.core.getMany({keys:e,trans:n}).then(function(i){return i.map(function(o){return r.hook.reading.fire(o)})})})},Ye.prototype.bulkAdd=function(e,r,n){var i=this,o=Array.isArray(r)?r:void 0,l=(n=n||(o?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",function(d){var y=i.schema.primKey,v=y.auto,y=y.keyPath;if(y&&o)throw new Z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var m=e.length,y=y&&v?e.map(en(y)):e;return i.core.mutate({trans:d,type:"add",keys:o,values:y,wantResults:l}).then(function(_){var p=_.numFailures,k=_.results,b=_.lastResult,_=_.failures;if(p===0)return l?k:b;throw new _e("".concat(i.name,".bulkAdd(): ").concat(p," of ").concat(m," operations failed"),_)})})},Ye.prototype.bulkPut=function(e,r,n){var i=this,o=Array.isArray(r)?r:void 0,l=(n=n||(o?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",function(d){var y=i.schema.primKey,v=y.auto,y=y.keyPath;if(y&&o)throw new Z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var m=e.length,y=y&&v?e.map(en(y)):e;return i.core.mutate({trans:d,type:"put",keys:o,values:y,wantResults:l}).then(function(_){var p=_.numFailures,k=_.results,b=_.lastResult,_=_.failures;if(p===0)return l?k:b;throw new _e("".concat(i.name,".bulkPut(): ").concat(p," of ").concat(m," operations failed"),_)})})},Ye.prototype.bulkUpdate=function(e){var r=this,n=this.core,i=e.map(function(d){return d.key}),o=e.map(function(d){return d.changes}),l=[];return this._trans("readwrite",function(d){return n.getMany({trans:d,keys:i,cache:"clone"}).then(function(v){var m=[],y=[];e.forEach(function(p,k){var b=p.key,_=p.changes,S=v[k];if(S){for(var C=0,O=Object.keys(_);C<O.length;C++){var T=O[C],D=_[T];if(T===r.schema.primKey.keyPath){if(De(D,b)!==0)throw new Z.Constraint("Cannot update primary key in bulkUpdate()")}else se(S,T,D)}l.push(k),m.push(b),y.push(S)}});var I=m.length;return n.mutate({trans:d,type:"put",keys:m,values:y,updates:{keys:i,changeSpecs:o}}).then(function(p){var k=p.numFailures,b=p.failures;if(k===0)return I;for(var _=0,S=Object.keys(b);_<S.length;_++){var C,O=S[_],T=l[Number(O)];T!=null&&(C=b[O],delete b[O],b[T]=C)}throw new _e("".concat(r.name,".bulkUpdate(): ").concat(k," of ").concat(I," operations failed"),b)})})})},Ye.prototype.bulkDelete=function(e){var r=this,n=e.length;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"delete",keys:e}).then(function(o){return tn(r,e,o)})}).then(function(d){var o=d.numFailures,l=d.lastResult,d=d.failures;if(o===0)return l;throw new _e("".concat(r.name,".bulkDelete(): ").concat(o," of ").concat(n," operations failed"),d)})},Ye);function Ye(){}function Nr(e){function r(d,v){if(v){for(var m=arguments.length,y=new Array(m-1);--m;)y[m-1]=arguments[m];return n[d].subscribe.apply(null,y),e}if(typeof d=="string")return n[d]}var n={};r.addEventType=l;for(var i=1,o=arguments.length;i<o;++i)l(arguments[i]);return r;function l(d,v,m){if(typeof d!="object"){var y;v=v||et;var I={subscribers:[],fire:m=m||ye,subscribe:function(p){I.subscribers.indexOf(p)===-1&&(I.subscribers.push(p),I.fire=v(I.fire,p))},unsubscribe:function(p){I.subscribers=I.subscribers.filter(function(k){return k!==p}),I.fire=I.subscribers.reduce(v,m)}};return n[d]=r[d]=I}f(y=d).forEach(function(p){var k=y[p];if(g(k))l(p,y[p][0],y[p][1]);else{if(k!=="asap")throw new Z.InvalidArgument("Invalid event config");var b=l(p,Be,function(){for(var _=arguments.length,S=new Array(_);_--;)S[_]=arguments[_];b.subscribers.forEach(function(C){le(function(){C.apply(null,S)})})})}})}}function Mr(e,r){return M(r).from({prototype:e}),r}function br(e,r){return!(e.filter||e.algorithm||e.or)&&(r?e.justLimit:!e.replayFilter)}function Vn(e,r){e.filter=sr(e.filter,r)}function jn(e,r,n){var i=e.replayFilter;e.replayFilter=i?function(){return sr(i(),r())}:r,e.justLimit=n&&!i}function rn(e,r){if(e.isPrimKey)return r.primaryKey;var n=r.getIndexByKeyPath(e.index);if(!n)throw new Z.Schema("KeyPath "+e.index+" on object store "+r.name+" is not indexed");return n}function Ei(e,r,n){var i=rn(e,r.schema);return r.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:i,range:e.range}})}function nn(e,r,n,i){var o=e.replayFilter?sr(e.filter,e.replayFilter()):e.filter;if(e.or){var l={},d=function(v,m,y){var I,p;o&&!o(m,y,function(k){return m.stop(k)},function(k){return m.fail(k)})||((p=""+(I=m.primaryKey))=="[object ArrayBuffer]"&&(p=""+new Uint8Array(I)),N(l,p)||(l[p]=!0,r(v,m,y)))};return Promise.all([e.or._iterate(d,n),Fi(Ei(e,i,n),e.algorithm,d,!e.keysOnly&&e.valueMapper)])}return Fi(Ei(e,i,n),sr(e.algorithm,o),r,!e.keysOnly&&e.valueMapper)}function Fi(e,r,n,i){var o=nt(i?function(l,d,v){return n(i(l),d,v)}:n);return e.then(function(l){if(l)return l.start(function(){var d=function(){return l.continue()};r&&!r(l,function(v){return d=v},function(v){l.stop(v),d=ye},function(v){l.fail(v),d=ye})||o(l.value,l,function(v){return d=v}),d()})})}var ja=(ze.prototype._read=function(e,r){var n=this._ctx;return n.error?n.table._trans(null,ut.bind(null,n.error)):n.table._trans("readonly",e).then(r)},ze.prototype._write=function(e){var r=this._ctx;return r.error?r.table._trans(null,ut.bind(null,r.error)):r.table._trans("readwrite",e,"locked")},ze.prototype._addAlgorithm=function(e){var r=this._ctx;r.algorithm=sr(r.algorithm,e)},ze.prototype._iterate=function(e,r){return nn(this._ctx,e,r,this._ctx.table.core)},ze.prototype.clone=function(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&P(n,e),r._ctx=n,r},ze.prototype.raw=function(){return this._ctx.valueMapper=null,this},ze.prototype.each=function(e){var r=this._ctx;return this._read(function(n){return nn(r,e,n,r.table.core)})},ze.prototype.count=function(e){var r=this;return this._read(function(n){var i=r._ctx,o=i.table.core;if(br(i,!0))return o.count({trans:n,query:{index:rn(i,o.schema),range:i.range}}).then(function(d){return Math.min(d,i.limit)});var l=0;return nn(i,function(){return++l,!1},n,o).then(function(){return l})}).then(e)},ze.prototype.sortBy=function(e,r){var n=e.split(".").reverse(),i=n[0],o=n.length-1;function l(m,y){return y?l(m[n[y]],y-1):m[i]}var d=this._ctx.dir==="next"?1:-1;function v(m,y){return De(l(m,o),l(y,o))*d}return this.toArray(function(m){return m.sort(v)}).then(r)},ze.prototype.toArray=function(e){var r=this;return this._read(function(n){var i=r._ctx;if(i.dir==="next"&&br(i,!0)&&0<i.limit){var o=i.valueMapper,l=rn(i,i.table.core.schema);return i.table.core.query({trans:n,limit:i.limit,values:!0,query:{index:l,range:i.range}}).then(function(v){return v=v.result,o?v.map(o):v})}var d=[];return nn(i,function(v){return d.push(v)},n,i.table.core).then(function(){return d})},e)},ze.prototype.offset=function(e){var r=this._ctx;return e<=0||(r.offset+=e,br(r)?jn(r,function(){var n=e;return function(i,o){return n===0||(n===1?--n:o(function(){i.advance(n),n=0}),!1)}}):jn(r,function(){var n=e;return function(){return--n<0}})),this},ze.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),jn(this._ctx,function(){var r=e;return function(n,i,o){return--r<=0&&i(o),0<=r}},!0),this},ze.prototype.until=function(e,r){return Vn(this._ctx,function(n,i,o){return!e(n.value)||(i(o),r)}),this},ze.prototype.first=function(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)},ze.prototype.last=function(e){return this.reverse().first(e)},ze.prototype.filter=function(e){var r;return Vn(this._ctx,function(n){return e(n.value)}),(r=this._ctx).isMatch=sr(r.isMatch,e),this},ze.prototype.and=function(e){return this.filter(e)},ze.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},ze.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ze.prototype.desc=function(){return this.reverse()},ze.prototype.eachKey=function(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.key,i)})},ze.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},ze.prototype.eachPrimaryKey=function(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.primaryKey,i)})},ze.prototype.keys=function(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.key)}).then(function(){return n}).then(e)},ze.prototype.primaryKeys=function(e){var r=this._ctx;if(r.dir==="next"&&br(r,!0)&&0<r.limit)return this._read(function(i){var o=rn(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:o,range:r.range}})}).then(function(i){return i.result}).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)},ze.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},ze.prototype.firstKey=function(e){return this.limit(1).keys(function(r){return r[0]}).then(e)},ze.prototype.lastKey=function(e){return this.reverse().firstKey(e)},ze.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var r={};return Vn(this._ctx,function(o){var i=o.primaryKey.toString(),o=N(r,i);return r[i]=!0,!o}),this},ze.prototype.modify=function(e){var r=this,n=this._ctx;return this._write(function(i){var o=typeof e=="function"?e:function(S){return Pi(S,e)},l=n.table.core,y=l.schema.primaryKey,d=y.outbound,v=y.extractKey,m=200,y=r.db._options.modifyChunkSize;y&&(m=typeof y=="object"?y[l.name]||y["*"]||200:y);function I(S,T){var O=T.failures,T=T.numFailures;k+=S-T;for(var D=0,V=f(O);D<V.length;D++){var U=V[D];p.push(O[U])}}var p=[],k=0,b=[],_=e===Di;return r.clone().primaryKeys().then(function(S){function C(T){var D=Math.min(m,S.length-T),V=S.slice(T,T+D);return(_?Promise.resolve([]):l.getMany({trans:i,keys:V,cache:"immutable"})).then(function(U){var Q=[],B=[],W=d?[]:null,ee=_?V:[];if(!_)for(var J=0;J<D;++J){var ie=U[J],xe={value:we(ie),primKey:S[T+J]};o.call(xe,xe.value,xe)!==!1&&(xe.value==null?ee.push(S[T+J]):d||De(v(ie),v(xe.value))===0?(B.push(xe.value),d&&W.push(S[T+J])):(ee.push(S[T+J]),Q.push(xe.value)))}return Promise.resolve(0<Q.length&&l.mutate({trans:i,type:"add",values:Q}).then(function(Ae){for(var Pe in Ae.failures)ee.splice(parseInt(Pe),1);I(Q.length,Ae)})).then(function(){return(0<B.length||O&&typeof e=="object")&&l.mutate({trans:i,type:"put",keys:W,values:B,criteria:O,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<T}).then(function(Ae){return I(B.length,Ae)})}).then(function(){return(0<ee.length||O&&_)&&l.mutate({trans:i,type:"delete",keys:ee,criteria:O,isAdditionalChunk:0<T}).then(function(Ae){return tn(n.table,ee,Ae)}).then(function(Ae){return I(ee.length,Ae)})}).then(function(){return S.length>T+D&&C(T+m)})})}var O=br(n)&&n.limit===1/0&&(typeof e!="function"||_)&&{index:n.index,range:n.range};return C(0).then(function(){if(0<p.length)throw new de("Error modifying one or more objects",p,k,b);return S.length})})})},ze.prototype.delete=function(){var e=this._ctx,r=e.range;return!br(e)||e.table.schema.yProps||!e.isPrimKey&&r.type!==3?this.modify(Di):this._write(function(n){var i=e.table.core.schema.primaryKey,o=r;return e.table.core.count({trans:n,query:{index:i,range:o}}).then(function(l){return e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(function(m){var v=m.failures,m=m.numFailures;if(m)throw new de("Could not delete some values",Object.keys(v).map(function(y){return v[y]}),l-m);return l-m})})})},ze);function ze(){}var Di=function(e,r){return r.value=null};function Ha(e,r){return e<r?-1:e===r?0:1}function za(e,r){return r<e?-1:e===r?0:1}function Dt(e,r,n){return e=e instanceof Mi?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(r),e}function wr(e){return new e.Collection(e,function(){return Ni("")}).limit(0)}function an(e,r,n,i){var o,l,d,v,m,y,I,p=n.length;if(!n.every(function(_){return typeof _=="string"}))return Dt(e,xi);function k(_){o=_==="next"?function(C){return C.toUpperCase()}:function(C){return C.toLowerCase()},l=_==="next"?function(C){return C.toLowerCase()}:function(C){return C.toUpperCase()},d=_==="next"?Ha:za;var S=n.map(function(C){return{lower:l(C),upper:o(C)}}).sort(function(C,O){return d(C.lower,O.lower)});v=S.map(function(C){return C.upper}),m=S.map(function(C){return C.lower}),I=(y=_)==="next"?"":i}k("next"),e=new e.Collection(e,function(){return Qt(v[0],m[p-1]+i)}),e._ondirectionchange=function(_){k(_)};var b=0;return e._addAlgorithm(function(_,S,C){var O=_.key;if(typeof O!="string")return!1;var T=l(O);if(r(T,m,b))return!0;for(var D=null,V=b;V<p;++V){var U=(function(Q,B,W,ee,J,ie){for(var xe=Math.min(Q.length,ee.length),Ae=-1,Pe=0;Pe<xe;++Pe){var Nt=B[Pe];if(Nt!==ee[Pe])return J(Q[Pe],W[Pe])<0?Q.substr(0,Pe)+W[Pe]+W.substr(Pe+1):J(Q[Pe],ee[Pe])<0?Q.substr(0,Pe)+ee[Pe]+W.substr(Pe+1):0<=Ae?Q.substr(0,Ae)+B[Ae]+W.substr(Ae+1):null;J(Q[Pe],Nt)<0&&(Ae=Pe)}return xe<ee.length&&ie==="next"?Q+W.substr(Q.length):xe<Q.length&&ie==="prev"?Q.substr(0,W.length):Ae<0?null:Q.substr(0,Ae)+ee[Ae]+W.substr(Ae+1)})(O,T,v[V],m[V],d,y);U===null&&D===null?b=V+1:(D===null||0<d(D,U))&&(D=U)}return S(D!==null?function(){_.continue(D+I)}:C),!1}),e}function Qt(e,r,n,i){return{type:2,lower:e,upper:r,lowerOpen:n,upperOpen:i}}function Ni(e){return{type:1,lower:e,upper:e}}var Mi=(Object.defineProperty(bt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),bt.prototype.between=function(e,r,n,i){n=n!==!1,i=i===!0;try{return 0<this._cmp(e,r)||this._cmp(e,r)===0&&(n||i)&&(!n||!i)?wr(this):new this.Collection(this,function(){return Qt(e,r,!n,!i)})}catch{return Dt(this,qt)}},bt.prototype.equals=function(e){return e==null?Dt(this,qt):new this.Collection(this,function(){return Ni(e)})},bt.prototype.above=function(e){return e==null?Dt(this,qt):new this.Collection(this,function(){return Qt(e,void 0,!0)})},bt.prototype.aboveOrEqual=function(e){return e==null?Dt(this,qt):new this.Collection(this,function(){return Qt(e,void 0,!1)})},bt.prototype.below=function(e){return e==null?Dt(this,qt):new this.Collection(this,function(){return Qt(void 0,e,!1,!0)})},bt.prototype.belowOrEqual=function(e){return e==null?Dt(this,qt):new this.Collection(this,function(){return Qt(void 0,e)})},bt.prototype.startsWith=function(e){return typeof e!="string"?Dt(this,xi):this.between(e,e+or,!0,!0)},bt.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):an(this,function(r,n){return r.indexOf(n[0])===0},[e],or)},bt.prototype.equalsIgnoreCase=function(e){return an(this,function(r,n){return r===n[0]},[e],"")},bt.prototype.anyOfIgnoreCase=function(){var e=Fe.apply(me,arguments);return e.length===0?wr(this):an(this,function(r,n){return n.indexOf(r)!==-1},e,"")},bt.prototype.startsWithAnyOfIgnoreCase=function(){var e=Fe.apply(me,arguments);return e.length===0?wr(this):an(this,function(r,n){return n.some(function(i){return r.indexOf(i)===0})},e,or)},bt.prototype.anyOf=function(){var e=this,r=Fe.apply(me,arguments),n=this._cmp;try{r.sort(n)}catch{return Dt(this,qt)}if(r.length===0)return wr(this);var i=new this.Collection(this,function(){return Qt(r[0],r[r.length-1])});i._ondirectionchange=function(l){n=l==="next"?e._ascending:e._descending,r.sort(n)};var o=0;return i._addAlgorithm(function(l,d,v){for(var m=l.key;0<n(m,r[o]);)if(++o===r.length)return d(v),!1;return n(m,r[o])===0||(d(function(){l.continue(r[o])}),!1)}),i},bt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},bt.prototype.noneOf=function(){var e=Fe.apply(me,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Dt(this,qt)}var r=e.reduce(function(n,i){return n?n.concat([[n[n.length-1][1],i]]):[[-1/0,i]]},null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})},bt.prototype.inAnyRange=function(O,r){var n=this,i=this._cmp,o=this._ascending,l=this._descending,d=this._min,v=this._max;if(O.length===0)return wr(this);if(!O.every(function(T){return T[0]!==void 0&&T[1]!==void 0&&o(T[0],T[1])<=0}))return Dt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Z.InvalidArgument);var m=!r||r.includeLowers!==!1,y=r&&r.includeUppers===!0,I,p=o;function k(T,D){return p(T[0],D[0])}try{(I=O.reduce(function(T,D){for(var V=0,U=T.length;V<U;++V){var Q=T[V];if(i(D[0],Q[1])<0&&0<i(D[1],Q[0])){Q[0]=d(Q[0],D[0]),Q[1]=v(Q[1],D[1]);break}}return V===U&&T.push(D),T},[])).sort(k)}catch{return Dt(this,qt)}var b=0,_=y?function(T){return 0<o(T,I[b][1])}:function(T){return 0<=o(T,I[b][1])},S=m?function(T){return 0<l(T,I[b][0])}:function(T){return 0<=l(T,I[b][0])},C=_,O=new this.Collection(this,function(){return Qt(I[0][0],I[I.length-1][1],!m,!y)});return O._ondirectionchange=function(T){p=T==="next"?(C=_,o):(C=S,l),I.sort(k)},O._addAlgorithm(function(T,D,V){for(var U,Q=T.key;C(Q);)if(++b===I.length)return D(V),!1;return!_(U=Q)&&!S(U)||(n._cmp(Q,I[b][1])===0||n._cmp(Q,I[b][0])===0||D(function(){p===o?T.continue(I[b][0]):T.continue(I[b][1])}),!1)}),O},bt.prototype.startsWithAnyOf=function(){var e=Fe.apply(me,arguments);return e.every(function(r){return typeof r=="string"})?e.length===0?wr(this):this.inAnyRange(e.map(function(r){return[r,r+or]})):Dt(this,"startsWithAnyOf() only works with strings")},bt);function bt(){}function jt(e){return nt(function(r){return Rr(r),e(r.target.error),!1})}function Rr(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Lr="storagemutated",Hn="x-storagemutated-1",Xt=Nr(null,Lr),Ka=(Ht.prototype._lock=function(){return G(!ce.global),++this._reculock,this._reculock!==1||ce.global||(ce.lockOwnerFor=this),this},Ht.prototype._unlock=function(){if(G(!ce.global),--this._reculock==0)for(ce.global||(ce.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ar(e[1],e[0])}catch{}}return this},Ht.prototype._locked=function(){return this._reculock&&ce.lockOwnerFor!==this},Ht.prototype.create=function(e){var r=this;if(!this.mode)return this;var n=this.db.idbdb,i=this.db._state.dbOpenError;if(G(!this.idbtrans),!e&&!n)switch(i&&i.name){case"DatabaseClosedError":throw new Z.DatabaseClosed(i);case"MissingAPIError":throw new Z.MissingAPI(i.message,i);default:throw new Z.OpenFailed(i)}if(!this.active)throw new Z.TransactionInactive;return G(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=nt(function(o){Rr(o),r._reject(e.error)}),e.onabort=nt(function(o){Rr(o),r.active&&r._reject(new Z.Abort(e.error)),r.active=!1,r.on("abort").fire(o)}),e.oncomplete=nt(function(){r.active=!1,r._resolve(),"mutatedParts"in e&&Xt.storagemutated.fire(e.mutatedParts)}),this},Ht.prototype._promise=function(e,r,n){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return ut(new Z.ReadOnly("Transaction is readonly"));if(!this.active)return ut(new Z.TransactionInactive);if(this._locked())return new te(function(l,d){i._blockedFuncs.push([function(){i._promise(e,r,n).then(l,d)},ce])});if(n)return Wt(function(){var l=new te(function(d,v){i._lock();var m=r(d,v,i);m&&m.then&&m.then(d,v)});return l.finally(function(){return i._unlock()}),l._lib=!0,l});var o=new te(function(l,d){var v=r(l,d,i);v&&v.then&&v.then(l,d)});return o._lib=!0,o},Ht.prototype._root=function(){return this.parent?this.parent._root():this},Ht.prototype.waitFor=function(e){var r,n=this._root(),i=te.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return i}):(n._waitingFor=i,n._waitingQueue=[],r=n.idbtrans.objectStore(n.storeNames[0]),(function l(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(r.get(-1/0).onsuccess=l)})());var o=n._waitingFor;return new te(function(l,d){i.then(function(v){return n._waitingQueue.push(nt(l.bind(null,v)))},function(v){return n._waitingQueue.push(nt(d.bind(null,v)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},Ht.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Z.Abort))},Ht.prototype.table=function(e){var r=this._memoizedTables||(this._memoizedTables={});if(N(r,e))return r[e];var n=this.schema[e];if(!n)throw new Z.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),r[e]=n},Ht);function Ht(){}function zn(e,r,n,i,o,l,d,v){return{name:e,keyPath:r,unique:n,multi:i,auto:o,compound:l,src:(n&&!d?"&":"")+(i?"*":"")+(o?"++":"")+Ri(r),type:v}}function Ri(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Kn(e,r,n){return{name:e,primKey:r,indexes:n,mappedClass:null,idxByName:(i=function(o){return[o.name,o]},n.reduce(function(o,l,d){return d=i(l,d),d&&(o[d[0]]=d[1]),o},{}))};var i}var Vr=function(e){try{return e.only([[]]),Vr=function(){return[[]]},[[]]}catch{return Vr=function(){return or},or}};function Bn(e){return e==null?function(){}:typeof e=="string"?(r=e).split(".").length===1?function(n){return n[r]}:function(n){return re(n,r)}:function(n){return re(n,e)};var r}function Li(e){return[].slice.call(e)}var Ba=0;function jr(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function qa(e,r,m){function i(C){if(C.type===3)return null;if(C.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var b=C.lower,_=C.upper,S=C.lowerOpen,C=C.upperOpen;return b===void 0?_===void 0?null:r.upperBound(_,!!C):_===void 0?r.lowerBound(b,!!S):r.bound(b,_,!!S,!!C)}function o(k){var b,_=k.name;return{name:_,schema:k,mutate:function(S){var C=S.trans,O=S.type,T=S.keys,D=S.values,V=S.range;return new Promise(function(U,Q){U=nt(U);var B=C.objectStore(_),W=B.keyPath==null,ee=O==="put"||O==="add";if(!ee&&O!=="delete"&&O!=="deleteRange")throw new Error("Invalid operation type: "+O);var J,ie=(T||D||{length:1}).length;if(T&&D&&T.length!==D.length)throw new Error("Given keys array must have same length as given values array.");if(ie===0)return U({numFailures:0,failures:{},results:[],lastResult:void 0});function xe(xt){++Nt,Rr(xt)}var Ae=[],Pe=[],Nt=0;if(O==="deleteRange"){if(V.type===4)return U({numFailures:Nt,failures:Pe,results:[],lastResult:void 0});V.type===3?Ae.push(J=B.clear()):Ae.push(J=B.delete(i(V)))}else{var W=ee?W?[D,T]:[D,null]:[T,null],Se=W[0],_t=W[1];if(ee)for(var St=0;St<ie;++St)Ae.push(J=_t&&_t[St]!==void 0?B[O](Se[St],_t[St]):B[O](Se[St])),J.onerror=xe;else for(St=0;St<ie;++St)Ae.push(J=B[O](Se[St])),J.onerror=xe}function mn(xt){xt=xt.target.result,Ae.forEach(function(cr,si){return cr.error!=null&&(Pe[si]=cr.error)}),U({numFailures:Nt,failures:Pe,results:O==="delete"?T:Ae.map(function(cr){return cr.result}),lastResult:xt})}J.onerror=function(xt){xe(xt),mn(xt)},J.onsuccess=mn})},getMany:function(S){var C=S.trans,O=S.keys;return new Promise(function(T,D){T=nt(T);for(var V,U=C.objectStore(_),Q=O.length,B=new Array(Q),W=0,ee=0,J=function(Ae){Ae=Ae.target,B[Ae._pos]=Ae.result,++ee===W&&T(B)},ie=jt(D),xe=0;xe<Q;++xe)O[xe]!=null&&((V=U.get(O[xe]))._pos=xe,V.onsuccess=J,V.onerror=ie,++W);W===0&&T(B)})},get:function(S){var C=S.trans,O=S.key;return new Promise(function(T,D){T=nt(T);var V=C.objectStore(_).get(O);V.onsuccess=function(U){return T(U.target.result)},V.onerror=jt(D)})},query:(b=y,function(S){return new Promise(function(C,O){C=nt(C);var T,D,V,W=S.trans,U=S.values,Q=S.limit,J=S.query,B=Q===1/0?void 0:Q,ee=J.index,J=J.range,W=W.objectStore(_),ee=ee.isPrimaryKey?W:W.index(ee.name),J=i(J);if(Q===0)return C({result:[]});b?((B=U?ee.getAll(J,B):ee.getAllKeys(J,B)).onsuccess=function(ie){return C({result:ie.target.result})},B.onerror=jt(O)):(T=0,D=!U&&"openKeyCursor"in ee?ee.openKeyCursor(J):ee.openCursor(J),V=[],D.onsuccess=function(ie){var xe=D.result;return xe?(V.push(U?xe.value:xe.primaryKey),++T===Q?C({result:V}):void xe.continue()):C({result:V})},D.onerror=jt(O))})}),openCursor:function(S){var C=S.trans,O=S.values,T=S.query,D=S.reverse,V=S.unique;return new Promise(function(U,Q){U=nt(U);var ee=T.index,B=T.range,W=C.objectStore(_),W=ee.isPrimaryKey?W:W.index(ee.name),ee=D?V?"prevunique":"prev":V?"nextunique":"next",J=!O&&"openKeyCursor"in W?W.openKeyCursor(i(B),ee):W.openCursor(i(B),ee);J.onerror=jt(Q),J.onsuccess=nt(function(ie){var xe,Ae,Pe,Nt,Se=J.result;Se?(Se.___id=++Ba,Se.done=!1,xe=Se.continue.bind(Se),Ae=(Ae=Se.continuePrimaryKey)&&Ae.bind(Se),Pe=Se.advance.bind(Se),Nt=function(){throw new Error("Cursor not stopped")},Se.trans=C,Se.stop=Se.continue=Se.continuePrimaryKey=Se.advance=function(){throw new Error("Cursor not started")},Se.fail=nt(Q),Se.next=function(){var _t=this,St=1;return this.start(function(){return St--?_t.continue():_t.stop()}).then(function(){return _t})},Se.start=function(_t){function St(){if(J.result)try{_t()}catch(xt){Se.fail(xt)}else Se.done=!0,Se.start=function(){throw new Error("Cursor behind last entry")},Se.stop()}var mn=new Promise(function(xt,cr){xt=nt(xt),J.onerror=jt(cr),Se.fail=cr,Se.stop=function(si){Se.stop=Se.continue=Se.continuePrimaryKey=Se.advance=Nt,xt(si)}});return J.onsuccess=nt(function(xt){J.onsuccess=St,St()}),Se.continue=xe,Se.continuePrimaryKey=Ae,Se.advance=Pe,St(),mn},U(Se)):U(null)},Q)})},count:function(S){var C=S.query,O=S.trans,T=C.index,D=C.range;return new Promise(function(V,U){var Q=O.objectStore(_),B=T.isPrimaryKey?Q:Q.index(T.name),Q=i(D),B=Q?B.count(Q):B.count();B.onsuccess=nt(function(W){return V(W.target.result)}),B.onerror=jt(U)})}}}var l,d,v,I=(d=m,v=Li((l=e).objectStoreNames),{schema:{name:l.name,tables:v.map(function(k){return d.objectStore(k)}).map(function(k){var b=k.keyPath,C=k.autoIncrement,_=g(b),S={},C={name:k.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:b==null,compound:_,keyPath:b,autoIncrement:C,unique:!0,extractKey:Bn(b)},indexes:Li(k.indexNames).map(function(O){return k.index(O)}).map(function(V){var T=V.name,D=V.unique,U=V.multiEntry,V=V.keyPath,U={name:T,compound:g(V),keyPath:V,unique:D,multiEntry:U,extractKey:Bn(V)};return S[jr(V)]=U}),getIndexByKeyPath:function(O){return S[jr(O)]}};return S[":id"]=C.primaryKey,b!=null&&(S[jr(b)]=C.primaryKey),C})},hasGetAll:0<v.length&&"getAll"in d.objectStore(v[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),m=I.schema,y=I.hasGetAll,I=m.tables.map(o),p={};return I.forEach(function(k){return p[k.name]=k}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(k){if(!p[k])throw new Error("Table '".concat(k,"' not found"));return p[k]},MIN_KEY:-1/0,MAX_KEY:Vr(r),schema:m}}function Ua(e,r,n,i){var o=n.IDBKeyRange;return n.indexedDB,{dbcore:(i=qa(r,o,i),e.dbcore.reduce(function(l,d){return d=d.create,s(s({},l),d(l))},i))}}function on(e,i){var n=i.db,i=Ua(e._middlewares,n,e._deps,i);e.core=i.dbcore,e.tables.forEach(function(o){var l=o.name;e.core.schema.tables.some(function(d){return d.name===l})&&(o.core=e.core.table(l),e[l]instanceof e.Table&&(e[l].core=o.core))})}function sn(e,r,n,i){n.forEach(function(o){var l=i[o];r.forEach(function(d){var v=(function m(y,I){return H(y,I)||(y=w(y))&&m(y,I)})(d,o);(!v||"value"in v&&v.value===void 0)&&(d===e.Transaction.prototype||d instanceof e.Transaction?L(d,o,{get:function(){return this.table(o)},set:function(m){q(this,o,{value:m,writable:!0,configurable:!0,enumerable:!0})}}):d[o]=new e.Table(o,l))})})}function qn(e,r){r.forEach(function(n){for(var i in n)n[i]instanceof e.Table&&delete n[i]})}function $a(e,r){return e._cfg.version-r._cfg.version}function Ga(e,r,n,i){var o=e._dbSchema;n.objectStoreNames.contains("$meta")&&!o.$meta&&(o.$meta=Kn("$meta",ji("")[0],[]),e._storeNames.push("$meta"));var l=e._createTransaction("readwrite",e._storeNames,o);l.create(n),l._completion.catch(i);var d=l._reject.bind(l),v=ce.transless||ce;Wt(function(){return ce.trans=l,ce.transless=v,r!==0?(on(e,n),y=r,((m=l).storeNames.includes("$meta")?m.table("$meta").get("version").then(function(I){return I??y}):te.resolve(y)).then(function(I){return k=I,b=l,_=n,S=[],I=(p=e)._versions,C=p._dbSchema=un(0,p.idbdb,_),(I=I.filter(function(O){return O._cfg.version>=k})).length!==0?(I.forEach(function(O){S.push(function(){var T=C,D=O._cfg.dbschema;cn(p,T,_),cn(p,D,_),C=p._dbSchema=D;var V=Un(T,D);V.add.forEach(function(ee){$n(_,ee[0],ee[1].primKey,ee[1].indexes)}),V.change.forEach(function(ee){if(ee.recreate)throw new Z.Upgrade("Not yet support for changing primary key");var J=_.objectStore(ee.name);ee.add.forEach(function(ie){return ln(J,ie)}),ee.change.forEach(function(ie){J.deleteIndex(ie.name),ln(J,ie)}),ee.del.forEach(function(ie){return J.deleteIndex(ie)})});var U=O._cfg.contentUpgrade;if(U&&O._cfg.version>k){on(p,_),b._memoizedTables={};var Q=ge(D);V.del.forEach(function(ee){Q[ee]=T[ee]}),qn(p,[p.Transaction.prototype]),sn(p,[p.Transaction.prototype],f(Q),Q),b.schema=Q;var B,W=pe(U);return W&&mr(),V=te.follow(function(){var ee;(B=U(b))&&W&&(ee=Yt.bind(null,null),B.then(ee,ee))}),B&&typeof B.then=="function"?te.resolve(B):V.then(function(){return B})}}),S.push(function(T){var D,V,U=O._cfg.dbschema;D=U,V=T,[].slice.call(V.db.objectStoreNames).forEach(function(Q){return D[Q]==null&&V.db.deleteObjectStore(Q)}),qn(p,[p.Transaction.prototype]),sn(p,[p.Transaction.prototype],p._storeNames,p._dbSchema),b.schema=p._dbSchema}),S.push(function(T){p.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(p.idbdb.version/10)===O._cfg.version?(p.idbdb.deleteObjectStore("$meta"),delete p._dbSchema.$meta,p._storeNames=p._storeNames.filter(function(D){return D!=="$meta"})):T.objectStore("$meta").put(O._cfg.version,"version"))})}),(function O(){return S.length?te.resolve(S.shift()(b.idbtrans)).then(O):te.resolve()})().then(function(){Vi(C,_)})):te.resolve();var p,k,b,_,S,C}).catch(d)):(f(o).forEach(function(I){$n(n,I,o[I].primKey,o[I].indexes)}),on(e,n),void te.follow(function(){return e.on.populate.fire(l)}).catch(d));var m,y})}function Wa(e,r){Vi(e._dbSchema,r),r.db.version%10!=0||r.objectStoreNames.contains("$meta")||r.db.createObjectStore("$meta").add(Math.ceil(r.db.version/10-1),"version");var n=un(0,e.idbdb,r);cn(e,e._dbSchema,r);for(var i=0,o=Un(n,e._dbSchema).change;i<o.length;i++){var l=(function(d){if(d.change.length||d.recreate)return console.warn("Unable to patch indexes of table ".concat(d.name," because it has changes on the type of index or primary key.")),{value:void 0};var v=r.objectStore(d.name);d.add.forEach(function(m){tt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(d.name,".").concat(m.src)),ln(v,m)})})(o[i]);if(typeof l=="object")return l.value}}function Un(e,r){var n,i={del:[],add:[],change:[]};for(n in e)r[n]||i.del.push(n);for(n in r){var o=e[n],l=r[n];if(o){var d={name:n,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||o.primKey.auto!==l.primKey.auto)d.recreate=!0,i.change.push(d);else{var v=o.idxByName,m=l.idxByName,y=void 0;for(y in v)m[y]||d.del.push(y);for(y in m){var I=v[y],p=m[y];I?I.src!==p.src&&d.change.push(p):d.add.push(p)}(0<d.del.length||0<d.add.length||0<d.change.length)&&i.change.push(d)}}else i.add.push([n,l])}return i}function $n(e,r,n,i){var o=e.db.createObjectStore(r,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return i.forEach(function(l){return ln(o,l)}),o}function Vi(e,r){f(e).forEach(function(n){r.db.objectStoreNames.contains(n)||(tt&&console.debug("Dexie: Creating missing table",n),$n(r,n,e[n].primKey,e[n].indexes))})}function ln(e,r){e.createIndex(r.name,r.keyPath,{unique:r.unique,multiEntry:r.multi})}function un(e,r,n){var i={};return z(r.objectStoreNames,0).forEach(function(o){for(var l=n.objectStore(o),d=zn(Ri(y=l.keyPath),y||"",!0,!1,!!l.autoIncrement,y&&typeof y!="string",!0),v=[],m=0;m<l.indexNames.length;++m){var I=l.index(l.indexNames[m]),y=I.keyPath,I=zn(I.name,y,!!I.unique,!!I.multiEntry,!1,y&&typeof y!="string",!1);v.push(I)}i[o]=Kn(o,d,v)}),i}function cn(e,r,n){for(var i=n.db.objectStoreNames,o=0;o<i.length;++o){var l=i[o],d=n.objectStore(l);e._hasGetAll="getAll"in d;for(var v=0;v<d.indexNames.length;++v){var m=d.indexNames[v],y=d.index(m).keyPath,I=typeof y=="string"?y:"["+z(y).join("+")+"]";!r[l]||(y=r[l].idxByName[I])&&(y.name=m,delete r[l].idxByName[I],r[l].idxByName[m]=y)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&h.WorkerGlobalScope&&h instanceof h.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function ji(e){return e.split(",").map(function(r,n){var l=r.split(":"),i=(o=l[1])===null||o===void 0?void 0:o.trim(),o=(r=l[0].trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return zn(o,l||null,/\&/.test(r),/\*/.test(r),/\+\+/.test(r),g(l),n===0,i)})}var Ya=(_r.prototype._createTableSchema=Kn,_r.prototype._parseIndexSyntax=ji,_r.prototype._parseStoresSpec=function(e,r){var n=this;f(e).forEach(function(i){if(e[i]!==null){var o=n._parseIndexSyntax(e[i]),l=o.shift();if(!l)throw new Z.Schema("Invalid schema for table "+i+": "+e[i]);if(l.unique=!0,l.multi)throw new Z.Schema("Primary key cannot be multiEntry*");o.forEach(function(d){if(d.auto)throw new Z.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new Z.Schema("Index must have a name and cannot be an empty string")}),o=n._createTableSchema(i,l,o),r[i]=o}})},_r.prototype.stores=function(n){var r=this.db;this._cfg.storesSource=this._cfg.storesSource?P(this._cfg.storesSource,n):n;var n=r._versions,i={},o={};return n.forEach(function(l){P(i,l._cfg.storesSource),o=l._cfg.dbschema={},l._parseStoresSpec(i,o)}),r._dbSchema=o,qn(r,[r._allTables,r,r.Transaction.prototype]),sn(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],f(o),o),r._storeNames=f(o),this},_r.prototype.upgrade=function(e){return this._cfg.contentUpgrade=ot(this._cfg.contentUpgrade||ye,e),this},_r);function _r(){}function Gn(e,r){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Ut(Zr,{addons:[],indexedDB:e,IDBKeyRange:r})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Wn(e){return e&&typeof e.databases=="function"}function Yn(e){return Wt(function(){return ce.letThrough=!0,e()})}function Jn(e){return!("from"in e)}var wt=function(e,r){if(!this){var n=new wt;return e&&"d"in e&&P(n,e),n}P(this,arguments.length?{d:1,from:e,to:1<arguments.length?r:e}:{d:0})};function Hr(e,r,n){var i=De(r,n);if(!isNaN(i)){if(0<i)throw RangeError();if(Jn(e))return P(e,{from:r,to:n,d:1});var o=e.l,i=e.r;if(De(n,e.from)<0)return o?Hr(o,r,n):e.l={from:r,to:n,d:1,l:null,r:null},zi(e);if(0<De(r,e.to))return i?Hr(i,r,n):e.r={from:r,to:n,d:1,l:null,r:null},zi(e);De(r,e.from)<0&&(e.from=r,e.l=null,e.d=i?i.d+1:1),0<De(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,o&&!e.l&&zr(e,o),i&&n&&zr(e,i)}}function zr(e,r){Jn(r)||(function n(i,m){var l=m.from,d=m.to,v=m.l,m=m.r;Hr(i,l,d),v&&n(i,v),m&&n(i,m)})(e,r)}function Hi(e,r){var n=dn(r),i=n.next();if(i.done)return!1;for(var o=i.value,l=dn(e),d=l.next(o.from),v=d.value;!i.done&&!d.done;){if(De(v.from,o.to)<=0&&0<=De(v.to,o.from))return!0;De(o.from,v.from)<0?o=(i=n.next(v.from)).value:v=(d=l.next(o.from)).value}return!1}function dn(e){var r=Jn(e)?null:{s:0,n:e};return{next:function(n){for(var i=0<arguments.length;r;)switch(r.s){case 0:if(r.s=1,i)for(;r.n.l&&De(n,r.n.from)<0;)r={up:r,n:r.n.l,s:1};else for(;r.n.l;)r={up:r,n:r.n.l,s:1};case 1:if(r.s=2,!i||De(n,r.n.to)<=0)return{value:r.n,done:!1};case 2:if(r.n.r){r.s=3,r={up:r,n:r.n.r,s:0};continue}case 3:r=r.up}return{done:!0}}}}function zi(e){var r,n,i=(((r=e.r)===null||r===void 0?void 0:r.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),o=1<i?"r":i<-1?"l":"";o&&(r=o=="r"?"l":"r",n=s({},e),i=e[o],e.from=i.from,e.to=i.to,e[o]=i[o],n[o]=i[r],(e[r]=n).d=Ki(n)),e.d=Ki(e)}function Ki(n){var r=n.r,n=n.l;return(r?n?Math.max(r.d,n.d):r.d:n?n.d:0)+1}function fn(e,r){return f(r).forEach(function(n){e[n]?zr(e[n],r[n]):e[n]=(function i(o){var l,d,v={};for(l in o)N(o,l)&&(d=o[l],v[l]=!d||typeof d!="object"||be.has(d.constructor)?d:i(d));return v})(r[n])}),e}function Qn(e,r){return e.all||r.all||Object.keys(e).some(function(n){return r[n]&&Hi(r[n],e[n])})}E(wt.prototype,((Lt={add:function(e){return zr(this,e),this},addKey:function(e){return Hr(this,e,e),this},addKeys:function(e){var r=this;return e.forEach(function(n){return Hr(r,n,n)}),this},hasKey:function(e){var r=dn(this).next(e).value;return r&&De(r.from,e)<=0&&0<=De(r.to,e)}})[We]=function(){return dn(this)},Lt));var lr={},Xn={},Zn=!1;function hn(e){fn(Xn,e),Zn||(Zn=!0,setTimeout(function(){Zn=!1,ei(Xn,!(Xn={}))},0))}function ei(e,r){r===void 0&&(r=!1);var n=new Set;if(e.all)for(var i=0,o=Object.values(lr);i<o.length;i++)Bi(d=o[i],e,n,r);else for(var l in e){var d,v=/^idb\:\/\/(.*)\/(.*)\//.exec(l);v&&(l=v[1],v=v[2],(d=lr["idb://".concat(l,"/").concat(v)])&&Bi(d,e,n,r))}n.forEach(function(m){return m()})}function Bi(e,r,n,i){for(var o=[],l=0,d=Object.entries(e.queries.query);l<d.length;l++){for(var v=d[l],m=v[0],y=[],I=0,p=v[1];I<p.length;I++){var k=p[I];Qn(r,k.obsSet)?k.subscribers.forEach(function(C){return n.add(C)}):i&&y.push(k)}i&&o.push([m,y])}if(i)for(var b=0,_=o;b<_.length;b++){var S=_[b],m=S[0],y=S[1];e.queries.query[m]=y}}function Ja(e){var r=e._state,n=e._deps.indexedDB;if(r.isBeingOpened||e.idbdb)return r.dbReadyPromise.then(function(){return r.dbOpenError?ut(r.dbOpenError):e});r.isBeingOpened=!0,r.dbOpenError=null,r.openComplete=!1;var i=r.openCanceller,o=Math.round(10*e.verno),l=!1;function d(){if(r.openCanceller!==i)throw new Z.DatabaseClosed("db.open() was cancelled")}function v(){return new te(function(k,b){if(d(),!n)throw new Z.MissingAPI;var _=e.name,S=r.autoSchema||!o?n.open(_):n.open(_,o);if(!S)throw new Z.MissingAPI;S.onerror=jt(b),S.onblocked=nt(e._fireOnBlocked),S.onupgradeneeded=nt(function(C){var O;I=S.transaction,r.autoSchema&&!e._options.allowEmptyDB?(S.onerror=Rr,I.abort(),S.result.close(),(O=n.deleteDatabase(_)).onsuccess=O.onerror=nt(function(){b(new Z.NoSuchDatabase("Database ".concat(_," doesnt exist")))})):(I.onerror=jt(b),C=C.oldVersion>Math.pow(2,62)?0:C.oldVersion,p=C<1,e.idbdb=S.result,l&&Wa(e,I),Ga(e,C/10,I,b))},b),S.onsuccess=nt(function(){I=null;var C,O,T,D,V,U=e.idbdb=S.result,Q=z(U.objectStoreNames);if(0<Q.length)try{var B=U.transaction((D=Q).length===1?D[0]:D,"readonly");if(r.autoSchema)O=U,T=B,(C=e).verno=O.version/10,T=C._dbSchema=un(0,O,T),C._storeNames=z(O.objectStoreNames,0),sn(C,[C._allTables],f(T),T);else if(cn(e,e._dbSchema,B),((V=Un(un(0,(V=e).idbdb,B),V._dbSchema)).add.length||V.change.some(function(W){return W.add.length||W.change.length}))&&!l)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),U.close(),o=U.version+1,l=!0,k(v());on(e,B)}catch{}yr.push(e),U.onversionchange=nt(function(W){r.vcFired=!0,e.on("versionchange").fire(W)}),U.onclose=nt(function(){e.close({disableAutoOpen:!1})}),p&&(V=e._deps,B=_,U=V.indexedDB,V=V.IDBKeyRange,Wn(U)||B===Zr||Gn(U,V).put({name:B}).catch(ye)),k()},b)}).catch(function(k){switch(k?.name){case"UnknownError":if(0<r.PR1398_maxLoop)return r.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),v();break;case"VersionError":if(0<o)return o=0,v()}return te.reject(k)})}var m,y=r.dbReadyResolve,I=null,p=!1;return te.race([i,(typeof navigator>"u"?te.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(k){function b(){return indexedDB.databases().finally(k)}m=setInterval(b,100),b()}).finally(function(){return clearInterval(m)}):Promise.resolve()).then(v)]).then(function(){return d(),r.onReadyBeingFired=[],te.resolve(Yn(function(){return e.on.ready.fire(e.vip)})).then(function k(){if(0<r.onReadyBeingFired.length){var b=r.onReadyBeingFired.reduce(ot,ye);return r.onReadyBeingFired=[],te.resolve(Yn(function(){return b(e.vip)})).then(k)}})}).finally(function(){r.openCanceller===i&&(r.onReadyBeingFired=null,r.isBeingOpened=!1)}).catch(function(k){r.dbOpenError=k;try{I&&I.abort()}catch{}return i===r.openCanceller&&e._close(),ut(k)}).finally(function(){r.openComplete=!0,y()}).then(function(){var k;return p&&(k={},e.tables.forEach(function(b){b.schema.indexes.forEach(function(_){_.name&&(k["idb://".concat(e.name,"/").concat(b.name,"/").concat(_.name)]=new wt(-1/0,[[[]]]))}),k["idb://".concat(e.name,"/").concat(b.name,"/")]=k["idb://".concat(e.name,"/").concat(b.name,"/:dels")]=new wt(-1/0,[[[]]])}),Xt(Lr).fire(k),ei(k,!0)),e})}function ti(e){function r(l){return e.next(l)}var n=o(r),i=o(function(l){return e.throw(l)});function o(l){return function(m){var v=l(m),m=v.value;return v.done?m:m&&typeof m.then=="function"?m.then(n,i):g(m)?Promise.all(m).then(n,i):n(m)}}return o(r)()}function vn(e,r,n){for(var i=g(e)?e.slice():[e],o=0;o<n;++o)i.push(r);return i}var Qa={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return s(s({},e),{table:function(r){var n=e.table(r),i=n.schema,o={},l=[];function d(p,k,b){var _=jr(p),S=o[_]=o[_]||[],C=p==null?0:typeof p=="string"?1:p.length,O=0<k,O=s(s({},b),{name:O?"".concat(_,"(virtual-from:").concat(b.name,")"):b.name,lowLevelIndex:b,isVirtual:O,keyTail:k,keyLength:C,extractKey:Bn(p),unique:!O&&b.unique});return S.push(O),O.isPrimaryKey||l.push(O),1<C&&d(C===2?p[0]:p.slice(0,C-1),k+1,b),S.sort(function(T,D){return T.keyTail-D.keyTail}),O}r=d(i.primaryKey.keyPath,0,i.primaryKey),o[":id"]=[r];for(var v=0,m=i.indexes;v<m.length;v++){var y=m[v];d(y.keyPath,0,y)}function I(p){var k,b=p.query.index;return b.isVirtual?s(s({},p),{query:{index:b.lowLevelIndex,range:(k=p.query.range,b=b.keyTail,{type:k.type===1?2:k.type,lower:vn(k.lower,k.lowerOpen?e.MAX_KEY:e.MIN_KEY,b),lowerOpen:!0,upper:vn(k.upper,k.upperOpen?e.MIN_KEY:e.MAX_KEY,b),upperOpen:!0})}}):p}return s(s({},n),{schema:s(s({},i),{primaryKey:r,indexes:l,getIndexByKeyPath:function(p){return(p=o[jr(p)])&&p[0]}}),count:function(p){return n.count(I(p))},query:function(p){return n.query(I(p))},openCursor:function(p){var k=p.query.index,b=k.keyTail,_=k.isVirtual,S=k.keyLength;return _?n.openCursor(I(p)).then(function(O){return O&&C(O)}):n.openCursor(p);function C(O){return Object.create(O,{continue:{value:function(T){T!=null?O.continue(vn(T,p.reverse?e.MAX_KEY:e.MIN_KEY,b)):p.unique?O.continue(O.key.slice(0,S).concat(p.reverse?e.MIN_KEY:e.MAX_KEY,b)):O.continue()}},continuePrimaryKey:{value:function(T,D){O.continuePrimaryKey(vn(T,e.MAX_KEY,b),D)}},primaryKey:{get:function(){return O.primaryKey}},key:{get:function(){var T=O.key;return S===1?T[0]:T.slice(0,S)}},value:{get:function(){return O.value}}})}}})}})}};function ri(e,r,n,i){return n=n||{},i=i||"",f(e).forEach(function(o){var l,d,v;N(r,o)?(l=e[o],d=r[o],typeof l=="object"&&typeof d=="object"&&l&&d?(v=Ke(l))!==Ke(d)?n[i+o]=r[o]:v==="Object"?ri(l,d,n,i+o+"."):l!==d&&(n[i+o]=r[o]):l!==d&&(n[i+o]=r[o])):n[i+o]=void 0}),f(r).forEach(function(o){N(e,o)||(n[i+o]=r[o])}),n}function ni(e,r){return r.type==="delete"?r.keys:r.keys||r.values.map(e.extractKey)}var Xa={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return s(s({},e),{table:function(r){var n=e.table(r),i=n.schema.primaryKey;return s(s({},n),{mutate:function(o){var l=ce.trans,d=l.table(r).hook,v=d.deleting,m=d.creating,y=d.updating;switch(o.type){case"add":if(m.fire===ye)break;return l._promise("readwrite",function(){return I(o)},!0);case"put":if(m.fire===ye&&y.fire===ye)break;return l._promise("readwrite",function(){return I(o)},!0);case"delete":if(v.fire===ye)break;return l._promise("readwrite",function(){return I(o)},!0);case"deleteRange":if(v.fire===ye)break;return l._promise("readwrite",function(){return(function p(k,b,_){return n.query({trans:k,values:!1,query:{index:i,range:b},limit:_}).then(function(S){var C=S.result;return I({type:"delete",keys:C,trans:k}).then(function(O){return 0<O.numFailures?Promise.reject(O.failures[0]):C.length<_?{failures:[],numFailures:0,lastResult:void 0}:p(k,s(s({},b),{lower:C[C.length-1],lowerOpen:!0}),_)})})})(o.trans,o.range,1e4)},!0)}return n.mutate(o);function I(p){var k,b,_,S=ce.trans,C=p.keys||ni(i,p);if(!C)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?s(s({},p),{keys:C}):s({},p)).type!=="delete"&&(p.values=c([],p.values)),p.keys&&(p.keys=c([],p.keys)),k=n,_=C,((b=p).type==="add"?Promise.resolve([]):k.getMany({trans:b.trans,keys:_,cache:"immutable"})).then(function(O){var T=C.map(function(D,V){var U,Q,B,W=O[V],ee={onerror:null,onsuccess:null};return p.type==="delete"?v.fire.call(ee,D,W,S):p.type==="add"||W===void 0?(U=m.fire.call(ee,D,p.values[V],S),D==null&&U!=null&&(p.keys[V]=D=U,i.outbound||se(p.values[V],i.keyPath,D))):(U=ri(W,p.values[V]),(Q=y.fire.call(ee,U,D,W,S))&&(B=p.values[V],Object.keys(Q).forEach(function(J){N(B,J)?B[J]=Q[J]:se(B,J,Q[J])}))),ee});return n.mutate(p).then(function(D){for(var V=D.failures,U=D.results,Q=D.numFailures,D=D.lastResult,B=0;B<C.length;++B){var W=(U||C)[B],ee=T[B];W==null?ee.onerror&&ee.onerror(V[B]):ee.onsuccess&&ee.onsuccess(p.type==="put"&&O[B]?p.values[B]:W)}return{failures:V,results:U,numFailures:Q,lastResult:D}}).catch(function(D){return T.forEach(function(V){return V.onerror&&V.onerror(D)}),Promise.reject(D)})})}}})}})}};function qi(e,r,n){try{if(!r||r.keys.length<e.length)return null;for(var i=[],o=0,l=0;o<r.keys.length&&l<e.length;++o)De(r.keys[o],e[l])===0&&(i.push(n?we(r.values[o]):r.values[o]),++l);return i.length===e.length?i:null}catch{return null}}var Za={stack:"dbcore",level:-1,create:function(e){return{table:function(r){var n=e.table(r);return s(s({},n),{getMany:function(i){if(!i.cache)return n.getMany(i);var o=qi(i.keys,i.trans._cache,i.cache==="clone");return o?te.resolve(o):n.getMany(i).then(function(l){return i.trans._cache={keys:i.keys,values:i.cache==="clone"?we(l):l},l})},mutate:function(i){return i.type!=="add"&&(i.trans._cache=null),n.mutate(i)}})}}}};function Ui(e,r){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!r.schema.primaryKey.outbound}function $i(e,r){switch(e){case"query":return r.values&&!r.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var eo={stack:"dbcore",level:0,name:"Observability",create:function(e){var r=e.schema.name,n=new wt(e.MIN_KEY,e.MAX_KEY);return s(s({},e),{transaction:function(i,o,l){if(ce.subscr&&o!=="readonly")throw new Z.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ce.querier));return e.transaction(i,o,l)},table:function(i){var o=e.table(i),l=o.schema,d=l.primaryKey,p=l.indexes,v=d.extractKey,m=d.outbound,y=d.autoIncrement&&p.filter(function(b){return b.compound&&b.keyPath.includes(d.keyPath)}),I=s(s({},o),{mutate:function(b){function _(J){return J="idb://".concat(r,"/").concat(i,"/").concat(J),D[J]||(D[J]=new wt)}var S,C,O,T=b.trans,D=b.mutatedParts||(b.mutatedParts={}),V=_(""),U=_(":dels"),Q=b.type,ee=b.type==="deleteRange"?[b.range]:b.type==="delete"?[b.keys]:b.values.length<50?[ni(d,b).filter(function(J){return J}),b.values]:[],B=ee[0],W=ee[1],ee=b.trans._cache;return g(B)?(V.addKeys(B),(ee=Q==="delete"||B.length===W.length?qi(B,ee):null)||U.addKeys(B),(ee||W)&&(S=_,C=ee,O=W,l.indexes.forEach(function(J){var ie=S(J.name||"");function xe(Pe){return Pe!=null?J.extractKey(Pe):null}function Ae(Pe){return J.multiEntry&&g(Pe)?Pe.forEach(function(Nt){return ie.addKey(Nt)}):ie.addKey(Pe)}(C||O).forEach(function(Pe,_t){var Se=C&&xe(C[_t]),_t=O&&xe(O[_t]);De(Se,_t)!==0&&(Se!=null&&Ae(Se),_t!=null&&Ae(_t))})}))):B?(W={from:(W=B.lower)!==null&&W!==void 0?W:e.MIN_KEY,to:(W=B.upper)!==null&&W!==void 0?W:e.MAX_KEY},U.add(W),V.add(W)):(V.add(n),U.add(n),l.indexes.forEach(function(J){return _(J.name).add(n)})),o.mutate(b).then(function(J){return!B||b.type!=="add"&&b.type!=="put"||(V.addKeys(J.results),y&&y.forEach(function(ie){for(var xe=b.values.map(function(Se){return ie.extractKey(Se)}),Ae=ie.keyPath.findIndex(function(Se){return Se===d.keyPath}),Pe=0,Nt=J.results.length;Pe<Nt;++Pe)xe[Pe][Ae]=J.results[Pe];_(ie.name).addKeys(xe)})),T.mutatedParts=fn(T.mutatedParts||{},D),J})}}),p=function(_){var S=_.query,_=S.index,S=S.range;return[_,new wt((_=S.lower)!==null&&_!==void 0?_:e.MIN_KEY,(S=S.upper)!==null&&S!==void 0?S:e.MAX_KEY)]},k={get:function(b){return[d,new wt(b.key)]},getMany:function(b){return[d,new wt().addKeys(b.keys)]},count:p,query:p,openCursor:p};return f(k).forEach(function(b){I[b]=function(_){var S=ce.subscr,C=!!S,O=Ui(ce,o)&&$i(b,_)?_.obsSet={}:S;if(C){var T=function(W){return W="idb://".concat(r,"/").concat(i,"/").concat(W),O[W]||(O[W]=new wt)},D=T(""),V=T(":dels"),S=k[b](_),C=S[0],S=S[1];if((b==="query"&&C.isPrimaryKey&&!_.values?V:T(C.name||"")).add(S),!C.isPrimaryKey){if(b!=="count"){var U=b==="query"&&m&&_.values&&o.query(s(s({},_),{values:!1}));return o[b].apply(this,arguments).then(function(W){if(b==="query"){if(m&&_.values)return U.then(function(xe){return xe=xe.result,D.addKeys(xe),W});var ee=_.values?W.result.map(v):W.result;(_.values?D:V).addKeys(ee)}else if(b==="openCursor"){var J=W,ie=_.values;return J&&Object.create(J,{key:{get:function(){return V.addKey(J.primaryKey),J.key}},primaryKey:{get:function(){var xe=J.primaryKey;return V.addKey(xe),xe}},value:{get:function(){return ie&&D.addKey(J.primaryKey),J.value}}})}return W})}V.add(n)}}return o[b].apply(this,arguments)}}),I}})}};function Gi(e,r,n){if(n.numFailures===0)return r;if(r.type==="deleteRange")return null;var i=r.keys?r.keys.length:"values"in r&&r.values?r.values.length:1;return n.numFailures===i?null:(r=s({},r),g(r.keys)&&(r.keys=r.keys.filter(function(o,l){return!(l in n.failures)})),"values"in r&&g(r.values)&&(r.values=r.values.filter(function(o,l){return!(l in n.failures)})),r)}function ii(e,r){return n=e,((i=r).lower===void 0||(i.lowerOpen?0<De(n,i.lower):0<=De(n,i.lower)))&&(e=e,(r=r).upper===void 0||(r.upperOpen?De(e,r.upper)<0:De(e,r.upper)<=0));var n,i}function Wi(e,r,k,i,o,l){if(!k||k.length===0)return e;var d=r.query.index,v=d.multiEntry,m=r.query.range,y=i.schema.primaryKey.extractKey,I=d.extractKey,p=(d.lowLevelIndex||d).extractKey,k=k.reduce(function(b,_){var S=b,C=[];if(_.type==="add"||_.type==="put")for(var O=new wt,T=_.values.length-1;0<=T;--T){var D,V=_.values[T],U=y(V);O.hasKey(U)||(D=I(V),(v&&g(D)?D.some(function(J){return ii(J,m)}):ii(D,m))&&(O.addKey(U),C.push(V)))}switch(_.type){case"add":var Q=new wt().addKeys(r.values?b.map(function(ie){return y(ie)}):b),S=b.concat(r.values?C.filter(function(ie){return ie=y(ie),!Q.hasKey(ie)&&(Q.addKey(ie),!0)}):C.map(function(ie){return y(ie)}).filter(function(ie){return!Q.hasKey(ie)&&(Q.addKey(ie),!0)}));break;case"put":var B=new wt().addKeys(_.values.map(function(ie){return y(ie)}));S=b.filter(function(ie){return!B.hasKey(r.values?y(ie):ie)}).concat(r.values?C:C.map(function(ie){return y(ie)}));break;case"delete":var W=new wt().addKeys(_.keys);S=b.filter(function(ie){return!W.hasKey(r.values?y(ie):ie)});break;case"deleteRange":var ee=_.range;S=b.filter(function(ie){return!ii(y(ie),ee)})}return S},e);return k===e?e:(k.sort(function(b,_){return De(p(b),p(_))||De(y(b),y(_))}),r.limit&&r.limit<1/0&&(k.length>r.limit?k.length=r.limit:e.length===r.limit&&k.length<r.limit&&(o.dirty=!0)),l?Object.freeze(k):k)}function Yi(e,r){return De(e.lower,r.lower)===0&&De(e.upper,r.upper)===0&&!!e.lowerOpen==!!r.lowerOpen&&!!e.upperOpen==!!r.upperOpen}function to(e,r){return(function(n,i,o,l){if(n===void 0)return i!==void 0?-1:0;if(i===void 0)return 1;if((i=De(n,i))===0){if(o&&l)return 0;if(o)return 1;if(l)return-1}return i})(e.lower,r.lower,e.lowerOpen,r.lowerOpen)<=0&&0<=(function(n,i,o,l){if(n===void 0)return i!==void 0?1:0;if(i===void 0)return-1;if((i=De(n,i))===0){if(o&&l)return 0;if(o)return-1;if(l)return 1}return i})(e.upper,r.upper,e.upperOpen,r.upperOpen)}function ro(e,r,n,i){e.subscribers.add(n),i.addEventListener("abort",function(){var o,l;e.subscribers.delete(n),e.subscribers.size===0&&(o=e,l=r,setTimeout(function(){o.subscribers.size===0&&Ve(l,o)},3e3))})}var no={stack:"dbcore",level:0,name:"Cache",create:function(e){var r=e.schema.name;return s(s({},e),{transaction:function(n,i,o){var l,d,v=e.transaction(n,i,o);return i==="readwrite"&&(d=(l=new AbortController).signal,o=function(m){return function(){if(l.abort(),i==="readwrite"){for(var y=new Set,I=0,p=n;I<p.length;I++){var k=p[I],b=lr["idb://".concat(r,"/").concat(k)];if(b){var _=e.table(k),S=b.optimisticOps.filter(function(ie){return ie.trans===v});if(v._explicit&&m&&v.mutatedParts)for(var C=0,O=Object.values(b.queries.query);C<O.length;C++)for(var T=0,D=(Q=O[C]).slice();T<D.length;T++)Qn((B=D[T]).obsSet,v.mutatedParts)&&(Ve(Q,B),B.subscribers.forEach(function(ie){return y.add(ie)}));else if(0<S.length){b.optimisticOps=b.optimisticOps.filter(function(ie){return ie.trans!==v});for(var V=0,U=Object.values(b.queries.query);V<U.length;V++)for(var Q,B,W,ee=0,J=(Q=U[V]).slice();ee<J.length;ee++)(B=J[ee]).res!=null&&v.mutatedParts&&(m&&!B.dirty?(W=Object.isFrozen(B.res),W=Wi(B.res,B.req,S,_,B,W),B.dirty?(Ve(Q,B),B.subscribers.forEach(function(ie){return y.add(ie)})):W!==B.res&&(B.res=W,B.promise=te.resolve({result:W}))):(B.dirty&&Ve(Q,B),B.subscribers.forEach(function(ie){return y.add(ie)})))}}}y.forEach(function(ie){return ie()})}}},v.addEventListener("abort",o(!1),{signal:d}),v.addEventListener("error",o(!1),{signal:d}),v.addEventListener("complete",o(!0),{signal:d})),v},table:function(n){var i=e.table(n),o=i.schema.primaryKey;return s(s({},i),{mutate:function(l){var d=ce.trans;if(o.outbound||d.db._options.cache==="disabled"||d.explicit||d.idbtrans.mode!=="readwrite")return i.mutate(l);var v=lr["idb://".concat(r,"/").concat(n)];return v?(d=i.mutate(l),l.type!=="add"&&l.type!=="put"||!(50<=l.values.length||ni(o,l).some(function(m){return m==null}))?(v.optimisticOps.push(l),l.mutatedParts&&hn(l.mutatedParts),d.then(function(m){0<m.numFailures&&(Ve(v.optimisticOps,l),(m=Gi(0,l,m))&&v.optimisticOps.push(m),l.mutatedParts&&hn(l.mutatedParts))}),d.catch(function(){Ve(v.optimisticOps,l),l.mutatedParts&&hn(l.mutatedParts)})):d.then(function(m){var y=Gi(0,s(s({},l),{values:l.values.map(function(I,p){var k;return m.failures[p]?I:(I=(k=o.keyPath)!==null&&k!==void 0&&k.includes(".")?we(I):s({},I),se(I,o.keyPath,m.results[p]),I)})}),m);v.optimisticOps.push(y),queueMicrotask(function(){return l.mutatedParts&&hn(l.mutatedParts)})}),d):i.mutate(l)},query:function(l){if(!Ui(ce,i)||!$i("query",l))return i.query(l);var d=((y=ce.trans)===null||y===void 0?void 0:y.db._options.cache)==="immutable",p=ce,v=p.requery,m=p.signal,y=(function(_,S,C,O){var T=lr["idb://".concat(_,"/").concat(S)];if(!T)return[];if(!(S=T.queries[C]))return[null,!1,T,null];var D=S[(O.query?O.query.index.name:null)||""];if(!D)return[null,!1,T,null];switch(C){case"query":var V=D.find(function(U){return U.req.limit===O.limit&&U.req.values===O.values&&Yi(U.req.query.range,O.query.range)});return V?[V,!0,T,D]:[D.find(function(U){return("limit"in U.req?U.req.limit:1/0)>=O.limit&&(!O.values||U.req.values)&&to(U.req.query.range,O.query.range)}),!1,T,D];case"count":return V=D.find(function(U){return Yi(U.req.query.range,O.query.range)}),[V,!!V,T,D]}})(r,n,"query",l),I=y[0],p=y[1],k=y[2],b=y[3];return I&&p?I.obsSet=l.obsSet:(p=i.query(l).then(function(_){var S=_.result;if(I&&(I.res=S),d){for(var C=0,O=S.length;C<O;++C)Object.freeze(S[C]);Object.freeze(S)}else _.result=we(S);return _}).catch(function(_){return b&&I&&Ve(b,I),Promise.reject(_)}),I={obsSet:l.obsSet,promise:p,subscribers:new Set,type:"query",req:l,dirty:!1},b?b.push(I):(b=[I],(k=k||(lr["idb://".concat(r,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[l.query.index.name||""]=b)),ro(I,b,v,m),I.promise.then(function(_){return{result:Wi(_.result,l,k?.optimisticOps,i,I,d)}})}})}})}};function pn(e,r){return new Proxy(e,{get:function(n,i,o){return i==="db"?r:Reflect.get(n,i,o)}})}var Ut=(ct.prototype.version=function(e){if(isNaN(e)||e<.1)throw new Z.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var r=this._versions,n=r.filter(function(i){return i._cfg.version===e})[0];return n||(n=new this.Version(e),r.push(n),r.sort($a),n.stores({}),this._state.autoSchema=!1,n)},ct.prototype._whenReady=function(e){var r=this;return this.idbdb&&(this._state.openComplete||ce.letThrough||this._vip)?e():new te(function(n,i){if(r._state.openComplete)return i(new Z.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._state.autoOpen)return void i(new Z.DatabaseClosed);r.open().catch(ye)}r._state.dbReadyPromise.then(n,i)}).then(e)},ct.prototype.use=function(e){var r=e.stack,n=e.create,i=e.level,o=e.name;return o&&this.unuse({stack:r,name:o}),e=this._middlewares[r]||(this._middlewares[r]=[]),e.push({stack:r,create:n,level:i??10,name:o}),e.sort(function(l,d){return l.level-d.level}),this},ct.prototype.unuse=function(e){var r=e.stack,n=e.name,i=e.create;return r&&this._middlewares[r]&&(this._middlewares[r]=this._middlewares[r].filter(function(o){return i?o.create!==i:!!n&&o.name!==n})),this},ct.prototype.open=function(){var e=this;return ar(Ft,function(){return Ja(e)})},ct.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,r=yr.indexOf(this);if(0<=r&&yr.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new te(function(n){e.dbReadyResolve=n}),e.openCanceller=new te(function(n,i){e.cancelOpen=i}))},ct.prototype.close=function(n){var r=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;r?(n.isBeingOpened&&n.cancelOpen(new Z.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new Z.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},ct.prototype.delete=function(e){var r=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",i=this._state;return new te(function(o,l){function d(){r.close(e);var v=r._deps.indexedDB.deleteDatabase(r.name);v.onsuccess=nt(function(){var m,y,I;m=r._deps,y=r.name,I=m.indexedDB,m=m.IDBKeyRange,Wn(I)||y===Zr||Gn(I,m).delete(y).catch(ye),o()}),v.onerror=jt(l),v.onblocked=r._fireOnBlocked}if(n)throw new Z.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(d):d()})},ct.prototype.backendDB=function(){return this.idbdb},ct.prototype.isOpen=function(){return this.idbdb!==null},ct.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},ct.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ct.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ct.prototype,"tables",{get:function(){var e=this;return f(this._allTables).map(function(r){return e._allTables[r]})},enumerable:!1,configurable:!0}),ct.prototype.transaction=function(){var e=(function(r,n,i){var o=arguments.length;if(o<2)throw new Z.InvalidArgument("Too few arguments");for(var l=new Array(o-1);--o;)l[o-1]=arguments[o];return i=l.pop(),[r,ue(l),i]}).apply(this,arguments);return this._transaction.apply(this,e)},ct.prototype._transaction=function(e,r,n){var i=this,o=ce.trans;o&&o.db===this&&e.indexOf("!")===-1||(o=null);var l,d,v=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(d=r.map(function(y){if(y=y instanceof i.Table?y.name:y,typeof y!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return y}),e=="r"||e===Rn)l=Rn;else{if(e!="rw"&&e!=Ln)throw new Z.InvalidArgument("Invalid transaction mode: "+e);l=Ln}if(o){if(o.mode===Rn&&l===Ln){if(!v)throw new Z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&d.forEach(function(y){if(o&&o.storeNames.indexOf(y)===-1){if(!v)throw new Z.SubTransaction("Table "+y+" not included in parent transaction.");o=null}}),v&&o&&!o.active&&(o=null)}}catch(y){return o?o._promise(null,function(I,p){p(y)}):ut(y)}var m=(function y(I,p,k,b,_){return te.resolve().then(function(){var S=ce.transless||ce,C=I._createTransaction(p,k,I._dbSchema,b);if(C.explicit=!0,S={trans:C,transless:S},b)C.idbtrans=b.idbtrans;else try{C.create(),C.idbtrans._explicit=!0,I._state.PR1398_maxLoop=3}catch(D){return D.name===je.InvalidState&&I.isOpen()&&0<--I._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),I.close({disableAutoOpen:!1}),I.open().then(function(){return y(I,p,k,null,_)})):ut(D)}var O,T=pe(_);return T&&mr(),S=te.follow(function(){var D;(O=_.call(C,C))&&(T?(D=Yt.bind(null,null),O.then(D,D)):typeof O.next=="function"&&typeof O.throw=="function"&&(O=ti(O)))},S),(O&&typeof O.then=="function"?te.resolve(O).then(function(D){return C.active?D:ut(new Z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):S.then(function(){return O})).then(function(D){return b&&C._resolve(),C._completion.then(function(){return D})}).catch(function(D){return C._reject(D),ut(D)})})}).bind(null,this,l,d,o,n);return o?o._promise(l,m,"lock"):ce.trans?ar(ce.transless,function(){return i._whenReady(m)}):this._whenReady(m)},ct.prototype.table=function(e){if(!N(this._allTables,e))throw new Z.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},ct);function ct(e,r){var n=this;this._middlewares={},this.verno=0;var i=ct.dependencies;this._options=r=s({addons:ct.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange},i=r.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o,l,d,v,m,y={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ye,dbReadyPromise:null,cancelOpen:ye,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:r.autoOpen};y.dbReadyPromise=new te(function(p){y.dbReadyResolve=p}),y.openCanceller=new te(function(p,k){y.cancelOpen=k}),this._state=y,this.name=e,this.on=Nr(this,"populate","blocked","versionchange","close",{ready:[ot,ye]}),this.once=function(p,k){var b=function(){for(var _=[],S=0;S<arguments.length;S++)_[S]=arguments[S];n.on(p).unsubscribe(b),k.apply(n,_)};return n.on(p,b)},this.on.ready.subscribe=j(this.on.ready.subscribe,function(p){return function(k,b){ct.vip(function(){var _,S=n._state;S.openComplete?(S.dbOpenError||te.resolve().then(k),b&&p(k)):S.onReadyBeingFired?(S.onReadyBeingFired.push(k),b&&p(k)):(p(k),_=n,b||p(function C(){_.on.ready.unsubscribe(k),_.on.ready.unsubscribe(C)}))})}}),this.Collection=(o=this,Mr(ja.prototype,function(O,C){this.db=o;var b=Ii,_=null;if(C)try{b=C()}catch(T){_=T}var S=O._ctx,C=S.table,O=C.hook.reading.fire;this._ctx={table:C,index:S.index,isPrimKey:!S.index||C.schema.primKey.keyPath&&S.index===C.schema.primKey.name,range:b,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:_,or:S.or,valueMapper:O!==Be?O:null}})),this.Table=(l=this,Mr(Ti.prototype,function(p,k,b){this.db=l,this._tx=b,this.name=p,this.schema=k,this.hook=l._allTables[p]?l._allTables[p].hook:Nr(null,{creating:[Ze,ye],reading:[lt,Be],updating:[ht,ye],deleting:[At,ye]})})),this.Transaction=(d=this,Mr(Ka.prototype,function(p,k,b,_,S){var C=this;p!=="readonly"&&k.forEach(function(O){O=(O=b[O])===null||O===void 0?void 0:O.yProps,O&&(k=k.concat(O.map(function(T){return T.updatesTable})))}),this.db=d,this.mode=p,this.storeNames=k,this.schema=b,this.chromeTransactionDurability=_,this.idbtrans=null,this.on=Nr(this,"complete","error","abort"),this.parent=S||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new te(function(O,T){C._resolve=O,C._reject=T}),this._completion.then(function(){C.active=!1,C.on.complete.fire()},function(O){var T=C.active;return C.active=!1,C.on.error.fire(O),C.parent?C.parent._reject(O):T&&C.idbtrans&&C.idbtrans.abort(),ut(O)})})),this.Version=(v=this,Mr(Ya.prototype,function(p){this.db=v,this._cfg={version:p,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(m=this,Mr(Mi.prototype,function(p,k,b){if(this.db=m,this._ctx={table:p,index:k===":id"?null:k,or:b},this._cmp=this._ascending=De,this._descending=function(_,S){return De(S,_)},this._max=function(_,S){return 0<De(_,S)?_:S},this._min=function(_,S){return De(_,S)<0?_:S},this._IDBKeyRange=m._deps.IDBKeyRange,!this._IDBKeyRange)throw new Z.MissingAPI})),this.on("versionchange",function(p){0<p.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(p){!p.newVersion||p.newVersion<p.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(p.oldVersion/10))}),this._maxKey=Vr(r.IDBKeyRange),this._createTransaction=function(p,k,b,_){return new n.Transaction(p,k,b,n._options.chromeTransactionDurability,_)},this._fireOnBlocked=function(p){n.on("blocked").fire(p),yr.filter(function(k){return k.name===n.name&&k!==n&&!k._state.vcFired}).map(function(k){return k.on("versionchange").fire(p)})},this.use(Za),this.use(no),this.use(eo),this.use(Qa),this.use(Xa);var I=new Proxy(this,{get:function(p,k,b){if(k==="_vip")return!0;if(k==="table")return function(S){return pn(n.table(S),I)};var _=Reflect.get(p,k,b);return _ instanceof Ti?pn(_,I):k==="tables"?_.map(function(S){return pn(S,I)}):k==="_createTransaction"?function(){return pn(_.apply(this,arguments),I)}:_}});this.vip=I,i.forEach(function(p){return p(n)})}var gn,Lt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",io=(ai.prototype.subscribe=function(e,r,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:r,complete:n})},ai.prototype[Lt]=function(){return this},ai);function ai(e){this._subscribe=e}try{gn={indexedDB:h.indexedDB||h.mozIndexedDB||h.webkitIndexedDB||h.msIndexedDB,IDBKeyRange:h.IDBKeyRange||h.webkitIDBKeyRange}}catch{gn={indexedDB:null,IDBKeyRange:null}}function Ji(e){var r,n=!1,i=new io(function(o){var l=pe(e),d,v=!1,m={},y={},I={get closed(){return v},unsubscribe:function(){v||(v=!0,d&&d.abort(),p&&Xt.storagemutated.unsubscribe(b))}};o.start&&o.start(I);var p=!1,k=function(){return Mn(_)},b=function(S){fn(m,S),Qn(y,m)&&k()},_=function(){var S,C,O;!v&&gn.indexedDB&&(m={},S={},d&&d.abort(),d=new AbortController,O=(function(T){var D=pr();try{l&&mr();var V=Wt(e,T);return V=l?V.finally(Yt):V}finally{D&&gr()}})(C={subscr:S,signal:d.signal,requery:k,querier:e,trans:null}),Promise.resolve(O).then(function(T){n=!0,r=T,v||C.signal.aborted||(m={},(function(D){for(var V in D)if(N(D,V))return;return 1})(y=S)||p||(Xt(Lr,b),p=!0),Mn(function(){return!v&&o.next&&o.next(T)}))},function(T){n=!1,["DatabaseClosedError","AbortError"].includes(T?.name)||v||Mn(function(){v||o.error&&o.error(T)})}))};return setTimeout(k,0),I});return i.hasValue=function(){return n},i.getValue=function(){return r},i}var ur=Ut;function oi(e){var r=Zt;try{Zt=!0,Xt.storagemutated.fire(e),ei(e,!0)}finally{Zt=r}}E(ur,s(s({},Ge),{delete:function(e){return new ur(e,{addons:[]}).delete()},exists:function(e){return new ur(e,{addons:[]}).open().then(function(r){return r.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return r=ur.dependencies,n=r.indexedDB,r=r.IDBKeyRange,(Wn(n)?Promise.resolve(n.databases()).then(function(i){return i.map(function(o){return o.name}).filter(function(o){return o!==Zr})}):Gn(n,r).toCollection().primaryKeys()).then(e)}catch{return ut(new Z.MissingAPI)}var r,n},defineClass:function(){return function(e){P(this,e)}},ignoreTransaction:function(e){return ce.trans?ar(ce.transless,e):e()},vip:Yn,async:function(e){return function(){try{var r=ti(e.apply(this,arguments));return r&&typeof r.then=="function"?r:te.resolve(r)}catch(n){return ut(n)}}},spawn:function(e,r,n){try{var i=ti(e.apply(n,r||[]));return i&&typeof i.then=="function"?i:te.resolve(i)}catch(o){return ut(o)}},currentTransaction:{get:function(){return ce.trans||null}},waitFor:function(e,r){return r=te.resolve(typeof e=="function"?ur.ignoreTransaction(e):e).timeout(r||6e4),ce.trans?ce.trans.waitFor(r):r},Promise:te,debug:{get:function(){return tt},set:function(e){pt(e)}},derive:M,extend:P,props:E,override:j,Events:Nr,on:Xt,liveQuery:Ji,extendObservabilitySet:fn,getByKeyPath:re,setByKeyPath:se,delByKeyPath:function(e,r){typeof r=="string"?se(e,r,void 0):"length"in r&&[].map.call(r,function(n){se(e,n,void 0)})},shallowClone:ge,deepClone:we,getObjectDiff:ri,cmp:De,asap:le,minKey:-1/0,addons:[],connections:yr,errnames:je,dependencies:gn,cache:lr,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,r,n){return e+r/Math.pow(10,2*n)})})),ur.maxKey=Vr(ur.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Xt(Lr,function(e){Zt||(e=new CustomEvent(Hn,{detail:e}),Zt=!0,dispatchEvent(e),Zt=!1)}),addEventListener(Hn,function(e){e=e.detail,Zt||oi(e)}));var Sr,Zt=!1,Qi=function(){};return typeof BroadcastChannel<"u"&&((Qi=function(){(Sr=new BroadcastChannel(Hn)).onmessage=function(e){return e.data&&oi(e.data)}})(),typeof Sr.unref=="function"&&Sr.unref(),Xt(Lr,function(e){Zt||Sr.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Ut.disableBfCache&&e.persisted){tt&&console.debug("Dexie: handling persisted pagehide"),Sr?.close();for(var r=0,n=yr;r<n.length;r++)n[r].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Ut.disableBfCache&&e.persisted&&(tt&&console.debug("Dexie: handling persisted pageshow"),Qi(),oi({all:new wt(-1/0,[[]])}))})),te.rejectionMapper=function(e,r){return!e||e instanceof Ne||e instanceof TypeError||e instanceof SyntaxError||!e.name||!at[e.name]?e:(r=new at[e.name](r||e.message,e),"stack"in e&&L(r,"stack",{get:function(){return this.inner.stack}}),r)},pt(tt),s(Ut,Object.freeze({__proto__:null,Dexie:Ut,liveQuery:Ji,Entity:Ci,cmp:De,PropModification:Dr,replacePrefix:function(e,r){return new Dr({replacePrefix:[e,r]})},add:function(e){return new Dr({add:e})},remove:function(e){return new Dr({remove:e})},default:Ut,RangeSet:wt,mergeRanges:zr,rangesOverlap:Hi}),{default:Ut}),Ut})})(In)),In.exports}var Js=Ys();const di=as(Js),va=Symbol.for("Dexie"),kn=globalThis[va]||(globalThis[va]=di);if(di.semVer!==kn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${di.semVer} and ${kn.semVer}`);const{liveQuery:Kc,mergeRanges:Bc,rangesOverlap:qc,RangeSet:Uc,cmp:$c,Entity:Gc,PropModification:Wc,replacePrefix:Yc,add:Jc,remove:Qc,DexieYProvider:Xc}=kn;class Qs extends kn{uprnSelections;areaSelections;dataSelections;userDownloads;constructor(){super("app-db"),this.version(1).stores({uprnSelections:"++id, createdAt",areaSelections:"++id, layerId, *areaIds",dataSelections:"++id, layerId, *fields",userDownloads:"++id, &localId, createdAt"})}}const $r=new Qs,Xs=async()=>await $r.uprnSelections.clear(),Zs=async(x,t,a)=>await $r.userDownloads.add({localId:x,areaSelection:t,dataSelections:a,status:er.Pending,createdAt:Date.now()}),el=async(x,t,a,s)=>{const c={};t!==void 0&&(c.externalId=t),a!==void 0&&(c.areaSelection=a),s!==void 0&&(c.dataSelections=s),Object.keys(c).length!==0&&await $r.userDownloads.where("localId").equals(x).modify(c)},tl=async()=>await $r.userDownloads.orderBy("createdAt").reverse().toArray(),rl=async x=>await $r.userDownloads.where("localId").equals(x).delete();class nl{#e=ne($e(new It));constructor(){this.#t()}addDownload(t){console.log("[downloads-store] Adding download:",t),u(this.#e).set(t.localId,t),Zs(t.localId,t.areaSelection,t.dataSelections)}updateDownloadStatus(t){console.log("[downloads-store] Updating download status:",t),u(this.#e).set(t.localId,{...t}),el(t.localId,t.externalId,t.areaSelection,t.dataSelections)}removeDownload(t){u(this.#e).delete(t),rl(t)}getDownloads(){return Array.from(u(this.#e).values())}async#t(){const t=await tl();!t||t.length===0||(console.log("Loaded downloads from DB:",t),t.forEach(a=>{u(this.#e).set(a.localId,{localId:a.localId,status:er.Pending,areaSelection:a.areaSelection,dataSelections:a.dataSelections})}))}}const Br=new nl;function il(x,t){const a=Or(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]];Pr(x,kt({name:"download"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Tr(g,t,"default",{}),F(c,f)},$$slots:{default:!0}}))}var al=oe('<div class="data-item svelte-v4uih6"><span class="data-name svelte-v4uih6"> </span> <div class="data-actions svelte-v4uih6"><!></div></div>');function fi(x,t){const a=Me(t,"title",3,"");Pn(x,{class:"data-item-card",children:(s,c)=>{var h=al(),f=X(h),g=X(f,!0);Y(f);var P=fe(f,2),w=X(P);Qe(w,()=>t.children??Je),Y(P),Y(h),dt(()=>{mi(f,"title",a()),Tt(g,a())}),F(s,h)},$$slots:{default:!0}})}var ol=oe("<!> <!> <!> <!>",1),sl=oe('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),ll=oe('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),ul=oe('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function cl(x,t){Re(t,!0);let a=ne($e(new Set));const s=he(()=>Br.getDownloads()),c={completed:{color:"#059669",text:"Completed",icon:Ro},"in-progress":{color:"#2563eb",text:"In Progress",icon:Mo},failed:{color:"#dc2626",text:"Failed",icon:No},pending:{color:"#6b7280",text:"Pending",icon:Do}};Ir(()=>{const H=setInterval(()=>{h()},5e3);return()=>{clearInterval(H)}}),Xe(()=>{if(!u(s)||u(s).length<=0||!t.uprnDownloadService)return;(async()=>{for(const R of u(s)){if(R.externalId||R.status!==er.Pending)continue;const z={exports:{areaSelectionLayer:{remoteId:R.areaSelection.layerId,areas:R.areaSelection.areaFieldInfos.map(G=>G.code)},dataSelectionLayers:R.dataSelections.map(G=>({remoteId:G.layerId,fields:G.fields.filter(le=>!t.fieldsToHide||!t.fieldsToHide.has(le))}))}};console.log("[downloads-menu] Submitting download request:",z);const j=await t.uprnDownloadService.requestJob(z);if(!j||j.type===Gs.Error){console.error("[downloads-menu] Failed to submit download request.",j);continue}R.externalId=j.guid,R.status=er.InProgress,Br.updateDownloadStatus(R)}})()});async function h(){if(u(s).length<=0||!t.uprnDownloadService)return;const H={jobs:u(s).filter(z=>z.externalId).map(z=>z.externalId)},R=await t.uprnDownloadService.requestJobStatuses(H);if(!R){console.error("[downloads-menu] Failed to get job statuses.",R);return}for(const z of R.jobs){const j=u(s).find(G=>G.externalId===z.guid);if(!j){console.warn("[downloads-menu] Received job status for unknown download:",z.guid);continue}switch(z.status.type){case Sn.Submitted:case Sn.Processing:j.status=er.InProgress;break;case Sn.Completed:j.status=er.Completed;break;case Sn.Error:j.status=er.Failed;break;default:console.warn("[downloads-menu] Unknown job status type:",z.status.type);break}Br.updateDownloadStatus(j)}}function f(H){Br.removeDownload(H)}async function g(H){try{await navigator.clipboard.writeText(H),K(a,new Set(u(a)).add(H),!0),fr.success("URL copied to clipboard"),setTimeout(()=>{const R=new Set(u(a));R.delete(H),K(a,R,!0)},2e3)}catch(R){console.error("Failed to copy URL:",R),fr.error("Failed to copy URL to clipboard")}}function P(H){return c[H]?.color??c.pending.color}function w(H){return c[H]?.text??c.pending.text}function A(H){return c[H]?.icon??c.pending.icon}function N(H){return t.uprnDownloadService.getDownloadUrl(H)}var E=ul(),q=fe(X(E),2);{var L=H=>{var R=sl(),z=$(R);zt(z,21,()=>u(s),kr,(le,re)=>{{let se=he(()=>u(re).externalId?u(re).externalId:"Pending...");fi(le,{get title(){return u(se)},children:(ge,Oe)=>{var ue=ol(),be=$(ue);{let Ie=he(()=>P(u(re).status)),Ve=he(()=>w(u(re).status));Pt(be,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${u(Ie)??""}`},get title(){return u(Ve)},disabled:!0,children:(me,Fe)=>{const pe=he(()=>A(u(re).status));var Ue=ae(),Ne=$(Ue);{let ke=he(()=>u(re).status==="in-progress"?"spinning":"");Te(Ne,()=>u(pe),(de,_e)=>{_e(de,{size:14,get class(){return u(ke)}})})}F(me,Ue)},$$slots:{default:!0}})}var Ce=fe(be,2);{var we=Ie=>{Pt(Ie,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>g(N(u(re).externalId)),title:"Copy URL to clipboard",children:(Ve,me)=>{var Fe=ae(),pe=$(Fe);{var Ue=ke=>{Eo(ke,{size:14})},Ne=ke=>{Fo(ke,{size:14})};ve(pe,ke=>{u(a).has(N(u(re).externalId))?ke(Ue):ke(Ne,!1)})}F(Ve,Fe)},$$slots:{default:!0}})};ve(Ce,Ie=>{u(re).externalId&&Ie(we)})}var Ee=fe(Ce,2);{var Ke=Ie=>{Pt(Ie,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(N(u(re).externalId),"_blank"),title:"Open download",children:(Ve,me)=>{il(Ve,{})},$$slots:{default:!0}})};ve(Ee,Ie=>{u(re).externalId&&u(re).status==="completed"&&Ie(Ke)})}var We=fe(Ee,2);Pt(We,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>f(u(re).localId),title:"Remove from queue",children:(Ie,Ve)=>{dr();var me=xr("Ã");F(Ie,me)},$$slots:{default:!0}}),F(ge,ue)},$$slots:{default:!0}})}}),Y(z);var j=fe(z,2),G=X(j);Y(j),dt(()=>Tt(G,`${u(s).length??""} download(s) in queue`)),F(H,R)},M=H=>{var R=ll();F(H,R)};ve(q,H=>{u(s).length>0?H(L):H(M,!1)})}Y(E),F(x,E),Le()}class dl{#e=ne($e(new It));addSelection(t){u(this.#e).set(t.layerId,t),fr.success(`'${t.layer.title}' Added`)}removeSelection(t){const a=u(this.#e).get(t);u(this.#e).delete(t),fr.success(`'${a?.layer.title}' Removed`)}getSelection(t){return u(this.#e).get(t)}getAllSelections(){return Array.from(u(this.#e).values())}clearSelections(){u(this.#e).clear(),console.log("[data-selection-store] selections cleared.")}cleanup(){u(this.#e).clear()}}const Ct=new dl;function fl(x,t){const a=Or(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"m6 9 6 6 6-6"}]];Pr(x,kt({name:"chevron-down"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Tr(g,t,"default",{}),F(c,f)},$$slots:{default:!0}}))}function hl(x,t){const a=Or(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"m15 18-6-6 6-6"}]];Pr(x,kt({name:"chevron-left"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Tr(g,t,"default",{}),F(c,f)},$$slots:{default:!0}}))}function vl(x,t){const a=Or(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"m18 15-6-6-6 6"}]];Pr(x,kt({name:"chevron-up"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Tr(g,t,"default",{}),F(c,f)},$$slots:{default:!0}}))}function pl(x,t){const a=Or(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];Pr(x,kt({name:"menu"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Tr(g,t,"default",{}),F(c,f)},$$slots:{default:!0}}))}function gl(x,t){const a=Or(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];Pr(x,kt({name:"trash"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Tr(g,t,"default",{}),F(c,f)},$$slots:{default:!0}}))}function ml(x,t){Re(t,!0);{let a=he(()=>Ur("size-7",t.class));Pt(x,{onclick:()=>t.clear(),variant:"destructive",get class(){return u(a)},title:"Clear all selections",children:(s,c)=>{gl(s,{})},$$slots:{default:!0}})}Le()}var yl=oe('<div class="export-footer svelte-10dgoyk"><div class="export-footer__left svelte-10dgoyk"><p class="text-sm text-muted-foreground svelte-10dgoyk">Click "Export" to begin the download.</p></div> <div class="export-footer__right svelte-10dgoyk"><!> <!></div></div>');function bl(x,t){Re(t,!0);function a(){if(t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size<=0){fr.error("Please select at least one area to export.");return}if(Ct.getAllSelections().length<=0){fr.error("Please select at least one data layer to export.");return}console.log("Starting export..."),(async()=>{const P=await t.areaSelectionInteractionStore.getAreaCodesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),w=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().map(([q,L],M)=>({id:q,code:P[M]})).toArray(),A={layerId:t.areaSelectionInteractionStore.selectionViewState.layerView?.layer.id||"",layerIndex:t.areaSelectionInteractionStore.selectionViewState.layerView?.layer.layerId||0,areaFieldInfos:w},N=Ct.getAllSelections().map(q=>({layerId:q.layerId,layerIndex:q.layer instanceof ui?q.layer.layerId:-1,fields:Array.from(q.fields)})),E=crypto.randomUUID();Br.addDownload({localId:E,status:er.Pending,areaSelection:A,dataSelections:N}),t.onExportSuccess?.()})()}var s=yl(),c=fe(X(s),2),h=X(c);ml(h,{class:"mr-4",get clear(){return t.clearSelections}});var f=fe(h,2);Pt(f,{onclick:a,title:"Export",children:(g,P)=>{dr();var w=xr("Export");F(g,w)},$$slots:{default:!0}}),Y(c),Y(s),F(x,s),Le()}class wl{#e=ne(null);get ActiveLayer(){return u(this.#e)}set ActiveLayer(t){K(this.#e,t,!0)}}class _l{#e=ne(!1);get isLoaded(){return u(this.#e)}set isLoaded(t){K(this.#e,t,!0)}#t=ne(null);get data(){return u(this.#t)}set data(t){K(this.#t,t,!0)}#r=he(()=>{const t=new It;function a(s){t.set(s.id,s),s.type==="group"&&s.layers.forEach(h=>{a(h)})}return this.data&&this.data.layers.forEach(s=>{a(s)}),t});get dataLookup(){return u(this.#r)}set dataLookup(t){K(this.#r,t)}#n=ne(!1);get loading(){return u(this.#n)}set loading(t){K(this.#n,t,!0)}#a=ne(null);get error(){return u(this.#a)}set error(t){K(this.#a,t,!0)}async initializeAsync(t){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:a,itemId:s,proxy:c}=t;await this.configurePortalAsync(a,c),await this.loadwebmapAsync(s)}catch(a){console.error("Error initializing webmap:",a),this.error=a.message}finally{this.loading=!1}}}async configurePortalAsync(t,a){if(!t||(ra.portalUrl=t,console.log(ra),!a))return;const{addProxyRule:s}=fs;console.log("Adding proxy rule for portal traffic"),s({urlPrefix:a?.urlPrefix,proxyUrl:a?.proxyUrl})}async loadwebmapAsync(t){if(this.data)return;const a=new ds({id:t}),s=new cs({portalItem:a});this.data=s,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}function Sl(x,t){x.stopPropagation(),t.onFilterClicked?.(t.layerId)}var xl=oe('<button title="Filter"><!></button>');function Il(x,t){Re(t,!0);let a=ne($e(t.hasFiltersApplied?.(t.layerId)??!1));Xe(()=>{K(a,t.hasFiltersApplied?.(t.layerId)??!1,!0)});const s=he(()=>u(a)?Lo:Vo);var c=xl();let h;c.__click=[Sl,t];var f=X(c);qr(f,()=>u(s)),Y(c),dt(g=>{h=rr(c,1,"filter-btn svelte-k95pvd",null,h,g),mi(c,"aria-pressed",u(a))},[()=>({active:u(a)})]),F(x,c),Le()}Tn(["click"]);var Cl=oe('<ul class="selected-list"></ul> <p class="count svelte-81yb5c"> </p>',1),kl=oe('<p class="no-selection svelte-81yb5c">No areas selected</p>'),Al=oe("<!> <!>",1),Ol=oe('<ul></ul> <p class="count svelte-81yb5c"> </p>',1),Pl=oe('<p class="no-selection svelte-81yb5c">No data selected</p>'),Tl=oe('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function El(x,t){Re(t,!0);const a=Me(t,"fieldFilterMenuStore",7);let s=ne($e([]));Xe(()=>{if(!t.areaSelectionInteractionStore){K(s,[],!0);return}if(!t.areaSelectionInteractionStore.selectionViewState?.areaHandles.size){K(s,[],!0);return}(async()=>{const G=await t.areaSelectionInteractionStore.getAreaNamesById(t.areaSelectionInteractionStore.selectionViewState.areaHandles.keys().toArray()),le=t.areaSelectionInteractionStore.selectionViewState.areaHandles.entries().toArray().map(([se,ge])=>({id:se,handle:ge})),re=[];for(let se=0;se<G.length;se++)re.push({name:G[se]||"Unknown Area",HighlightAreaInfo:le[se]});K(s,re,!0)})()});function c(j){const G=u(s).findIndex(le=>le.name===j);G!==-1&&t.areaSelectionInteractionStore.removeSelectedArea(u(s)[G]?.HighlightAreaInfo.id)}function h(j){console.log("[export-menu] Removing data selection for layerId:",j),Ct.removeSelection(j),console.log("[export-menu] Current SelectedData:",_o(Ct.getAllSelections()))}function f(j){if(a().ActiveLayer?.id===j){a().ActiveLayer=null;return}const G=t.webMapStore.dataLookup.get(j);if(!G){console.warn(`[export-menu] Layer with ID ${j} not found in web map store.`);return}a().ActiveLayer=G}function g(j){const G=Ct.getSelection(j);return!(!G||!G.fields||G.fields.size===0||G.fields.size===t.webMapStore.dataLookup.get(j)?.fields?.length)}var P=Tl(),w=fe($(P),2),A=X(w),N=X(A,!0);Y(A);var E=fe(A,4);{var q=j=>{var G=Cl(),le=$(G);zt(le,21,()=>u(s),kr,(ge,Oe)=>{fi(ge,{get title(){return u(Oe).name},children:(ue,be)=>{Pt(ue,{variant:"ghost",size:"sm",class:"area-remove-btn",title:"Remove area",onclick:()=>c(u(Oe).name),children:(Ce,we)=>{dr();var Ee=xr("Ã");F(Ce,Ee)},$$slots:{default:!0}})},$$slots:{default:!0}})}),Y(le);var re=fe(le,2),se=X(re);Y(re),dt(()=>Tt(se,`${u(s).length??""} area(s) selected`)),F(j,G)},L=j=>{var G=kl();F(j,G)};ve(E,j=>{u(s).length>0?j(q):j(L,!1)})}Y(w);var M=fe(w,2),H=fe(X(M),2);{var R=j=>{var G=Ol(),le=$(G);zt(le,21,()=>Ct.getAllSelections(),kr,(ge,Oe)=>{{let ue=he(()=>u(Oe).layer.title??"");fi(ge,{get title(){return u(ue)},children:(be,Ce)=>{var we=Al(),Ee=$(we);{var Ke=Ie=>{Il(Ie,{get layerId(){return u(Oe).layerId},onFilterClicked:f,hasFiltersApplied:g})};ve(Ee,Ie=>{t.dataSelectionTreeviewConfig?.getItemConfig(u(Oe).layerId)?.showFields&&Ie(Ke)})}var We=fe(Ee,2);Pt(We,{variant:"ghost",size:"sm",class:"data-remove-btn",title:"Remove data selection",onclick:()=>h(u(Oe).layerId),children:(Ie,Ve)=>{dr();var me=xr("Ã");F(Ie,me)},$$slots:{default:!0}}),F(be,we)},$$slots:{default:!0}})}}),Y(le);var re=fe(le,2),se=X(re);Y(re),dt(ge=>Tt(se,`${ge??""} data layer(s) selected`),[()=>Ct.getAllSelections().length]),F(j,G)},z=j=>{var G=Pl();F(j,G)};ve(H,j=>{Ct.getAllSelections().length>0?j(R):j(z,!1)})}Y(M),dt(()=>Tt(N,t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer?t.areaSelectionInteractionStore.selectionViewState?.layerView?.layer.title:"No Area Layer Selected")),F(x,P),Le()}function Fl(x,t){Re(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];Er(x,kt({name:"arrow-down-to-line"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Qe(g,()=>t.children??Je),F(c,f)},$$slots:{default:!0}})),Le()}function Dl(x,t){Re(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"m18 15-6-6-6 6"}]];Er(x,kt({name:"chevron-up"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Qe(g,()=>t.children??Je),F(c,f)},$$slots:{default:!0}})),Le()}function Nl(x,t){Re(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]];Er(x,kt({name:"maximize"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Qe(g,()=>t.children??Je),F(c,f)},$$slots:{default:!0}})),Le()}function Ml(x,t){Re(t,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let a=Mt(t,["$$slots","$$events","$$legacy"]);const s=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]];Er(x,kt({name:"minimize"},()=>a,{get iconNode(){return s},children:(c,h)=>{var f=ae(),g=$(f);Qe(g,()=>t.children??Je),F(c,f)},$$slots:{default:!0}})),Le()}function Rl(x,t){x.target===x.currentTarget&&t()}var Ll=(x,t)=>x.key==="Escape"&&t(),Vl=(x,t,a)=>t(u(a).name),jl=oe('<div class="info-icon-container svelte-fp5rsc"><!></div>'),Hl=oe('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),zl=oe('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),Kl=oe("<!> <!>",1),Bl=oe("<!> <!>",1),ql=oe('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),Ul=oe('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function $l(x,t){Re(t,!0);const a=Me(t,"fieldFilterMenuStore",7);let s=ne(null),c=ne($e(new $t)),h=he(()=>{if(!u(s)||!u(s).fields)return{checked:!1,indeterminate:!1};const L=u(s).fields.length,M=u(c)?.size||0;return M===0?{checked:!1,indeterminate:!1}:M===L?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});Xe(()=>{const L=a().ActiveLayer;if(!L){K(s,null),K(c,new $t,!0);return}K(s,L,!0);const M=Ct.getSelection(L.id);M?.fields?K(c,new $t([...M.fields]),!0):K(c,new $t,!0)});function f(){g(),a().ActiveLayer=null}function g(){if(!u(s))return;let L=Ct.getSelection(u(s).id);if(L){if((L.fields===void 0||L.fields===null)&&(L.fields=new $t),u(c).size===0){Ct.removeSelection(u(s).id);return}L.fields.clear(),u(c).forEach(M=>{L.fields?.add(M)})}}function P(L){u(s)&&(u(c).has(L)?u(c).delete(L):u(c).add(L))}function w(){if(!u(s)?.fields)return;(u(c)?.size||0)===0?u(s).fields.forEach(M=>{u(c).add(M.name)}):u(c).clear()}function A(){if(!u(s)?.fields)return[];const L=u(s).fields.filter(M=>!t.fieldsToHide.has(M.name.toLowerCase()));return console.log("Filtered fields to show:",L,t.fieldsToHide,u(s).fields),L}var N=ae(),E=$(N);{var q=L=>{var M=Ul();M.__click=[Rl,f],M.__keydown=[Ll,f];var H=X(M);Te(H,()=>Pn,(R,z)=>{z(R,{class:"command-card",children:(j,G)=>{var le=ql(),re=$(le);re.__click=f;var se=X(re);So(se,{size:20}),Y(re);var ge=fe(re,2);Te(ge,()=>On,(Oe,ue)=>{ue(Oe,{class:"card-content",children:(be,Ce)=>{var we=ae(),Ee=$(we);Te(Ee,()=>xo,(Ke,We)=>{We(Ke,{children:(Ie,Ve)=>{var me=Bl(),Fe=$(me);Te(Fe,()=>Io,(Ue,Ne)=>{Ne(Ue,{placeholder:"Search for fields..."})});var pe=fe(Fe,2);Te(pe,()=>Co,(Ue,Ne)=>{Ne(Ue,{children:(ke,de)=>{var _e=Kl(),je=$(_e);Te(je,()=>ko,(Z,at)=>{at(Z,{children:(Ge,ye)=>{dr();var Be=xr("No results found.");F(Ge,Be)},$$slots:{default:!0}})});var ft=fe(je,2);Te(ft,()=>Ao,(Z,at)=>{at(Z,{heading:"Fields",children:(Ge,ye)=>{var Be=zl(),lt=$(Be),He=X(lt);Xi(He,{get checked(){return u(h).checked},get indeterminate(){return u(h).indeterminate},onCheckedChange:w}),dr(2),Y(lt);var Ze=fe(lt,2);Te(Ze,()=>jo,(ht,et)=>{et(ht,{})});var At=fe(Ze,2);zt(At,17,A,kr,(ht,et)=>{var ot=ae(),tt=$(ot);Te(tt,()=>Oo,(pt,Et)=>{Et(pt,{class:"field-item",onselect:()=>P(u(et).name),children:(gt,Ot)=>{var vt=Hl(),rt=X(vt);{let Bt=he(()=>u(c)?.has(u(et).name)??!1);Xi(rt,{class:"field-checkbox",get checked(){return u(Bt)},onCheckedChange:()=>P(u(et).name)})}var mt=fe(rt,2);mt.__click=[Vl,P,et];var Rt=X(mt),nr=X(Rt),hr=X(nr,!0);Y(nr);var Kt=fe(nr,2);{var vr=Bt=>{var Ft=jl(),ce=X(Ft);qr(ce,()=>Ho),Y(Ft),dt(()=>mi(Ft,"title",u(et).description)),F(Bt,Ft)};ve(Kt,Bt=>{u(et).description&&Bt(vr)})}Y(Rt),Y(mt),Y(vt),dt(()=>Tt(hr,u(et).alias||u(et).name)),F(gt,vt)},$$slots:{default:!0}})}),F(ht,ot)}),F(Ge,Be)},$$slots:{default:!0}})}),F(ke,_e)},$$slots:{default:!0}})}),F(Ie,me)},$$slots:{default:!0}})}),F(be,we)},$$slots:{default:!0}})}),F(j,le)},$$slots:{default:!0}})}),Y(M),F(L,M)};ve(E,L=>{u(s)&&L(q)})}F(x,N),Le()}Tn(["click","keydown"]);class ka{id;name;children;parent;constructor(t,a,s=[],c=null){this.id=t,this.name=a,this.children=s,this.parent=c}}class st extends ka{layer;constructor(t,a,s,c=[],h=null){super(t,a,c,h),this.layer=s}}class Ar extends st{featureLayer;field;constructor(t,a,s,c,h=[],f=null){super(t,a,s,h,f),this.field=c,this.featureLayer=s}}var it=(x=>(x.Inactive="inactive",x.Indeterminate="indeterminate",x.Active="active",x))(it||{}),tr=(x=>(x.Hidden="hidden",x.Suspended="suspended",x.Visible="visible",x))(tr||{});class Aa{#e=ne(!1);get initialized(){return u(this.#e)}set initialized(t){K(this.#e,t,!0)}#t=null;#r=null;#n=ne($e([]));#a=he(()=>{const t=new It;return this.#S(u(this.#n),t),t});#i=ne($e(new It));#s=ne($e(new It));#l=ne($e(new It));#u=ne($e(new It));#f=ne($e(new It));#h=null;initialize(t,a,s,c,h){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!a)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=a,c)for(const f of c)u(this.#f).set(f.id,f);if(h&&(this.#h=h),!t)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#r=s,this.#m(t),K(this.#n,this.#y(t),!0)}getNodeById(t){return this.#c(),u(this.#a).get(t)}getNodes(){return this.#c(),u(this.#n)}getVisibleNodes(){this.#c();const t=[];for(const[a,s]of u(this.#i)){if(!s)continue;const c=u(this.#a).get(a);c&&t.push(c)}return t}getNonHiddenNodes(){return this.#c(),this.#o(u(this.#n))}clearSelections(){this.#c();for(const t of u(this.#i).keys()){u(this.#i).set(t,!1);const a=u(this.#a).get(t);a&&a instanceof st&&(a.layer.visible=!1)}u(this.#u).clear()}#o(t){this.#c();const a=[];for(const s of t){const c=this.#v(s.id);if(!(c&&c.isHidden)&&(a.push(s),s.children?.length)){const h=this.#o(s.children);a.push(...h)}}return a}getVisibilityState(t){return this.#c(),u(this.#i).get(t)??!1}setVisibilityState(t,a){this.#c();const s=u(this.#a).get(t);if(!s)throw new Error(`Tree node not found for ID: ${t}`);if(!(s instanceof st))throw new Error(`Tree node is not a layer node: ${t}`);const c=this.#v(t);if(c?.disableVisibilityToggle||(u(this.#i).set(t,a),s.layer.visible=a,this.updateDrawState(s,a),s instanceof Ar&&(s.featureLayer.displayField=a?s.field.name:"",a&&this.#h&&(console.log("[TreeviewStore] Applying custom renderer for field:",s.field.name),this.#h.applyCustomRenderer(s.featureLayer,s.field.name))),this.#d(s,a),!c||c.isHidden)||(c.visibilityDependencyIds?.length&&this.#p(s,a),!c.visibilityGroupId))return;const h=c.visibilityGroupId;let f=u(this.#u).get(h);f||(f=[],u(this.#u).set(h,f));const g=this.#g(h);if(!g)throw new Error(`Visibility group config not found for group ID: ${h}`);if(!a){const w=f.indexOf(t);f.splice(w,1);return}const P=w=>{u(this.#i).set(w,!1);const A=u(this.#a).get(w);if(A&&A instanceof st){A.layer.visible=!1,this.updateDrawState(A,!1),this.#d(A,!1);const E=this.#v(w);E&&E.visibilityDependencyIds?.length&&this.#p(A,!1)}const N=f.indexOf(w);N>=0&&f.splice(N,1)};for(;f.length>=g.maxVisibleLayers;){const w=f[0];P(w)}f.push(t),this.#d(s,a),c.visibilityDependencyIds?.length&&this.#p(s,a)}async updateDrawState(t,a){if(!this.#r)return;if(!a){u(this.#s).delete(t.id),u(this.#l).get(t.id)?.remove(),u(this.#l).delete(t.id);return}if(!(t instanceof st)||!(t.layer instanceof na))return;const s=await this.#r.getLayerView(t.layer);if(!s)return;this.setInitialDrawState(t,s);const c=hs(()=>s.suspended,(h,f)=>{f&&!h?u(this.#s).set(t.id,tr.Visible):!f&&h&&u(this.#s).set(t.id,tr.Suspended)});u(this.#l).set(t.id,c)}getNodeDrawState(t){return this.#c(),u(this.#s).get(t)??tr.Hidden}setInitialDrawState(t,a){!(t instanceof st)||!(t.layer instanceof na)||a&&(a.suspended?u(this.#s).set(t.id,tr.Suspended):u(this.#s).set(t.id,tr.Visible))}clearDrawStateHandles(){for(const t of u(this.#l).values())t.remove();u(this.#l).clear()}cleanup(){this.initialized=!1,u(this.#i).clear(),u(this.#u).clear(),u(this.#f).clear(),K(this.#n,[],!0),u(this.#a).clear(),u(this.#s).clear(),this.clearDrawStateHandles()}#d(t,a){const s=t.parent;if(s){if(!(s instanceof st)){this.#d(s,a);return}u(this.#i).set(s.id,a),s.layer.visible=a,this.#d(s,a)}}#p(t,a){const s=this.#v(t.id);if(s&&s.visibilityDependencyIds?.length)for(const c of s.visibilityDependencyIds){const h=u(this.#a).get(c);h&&h instanceof st&&(u(this.#i).set(c,a),h.layer.visible=a,this.#d(h,a))}}#g(t){if(t&&this.#t)return this.#t.getVisibilityGroupConfig(t)}#m(t){this.#t&&this.#t.resolveInheritance(t)}#y(t){const a=t.map(s=>this.#w(s,void 0));return this.#b([...a])}#v(t){if(t&&this.#t)return this.#t.getItemConfig(t)}#b(t){t.reverse();for(const a of t)a.children?.length&&this.#b(a.children);return t}#w(t,a){const s=this.#v(t.id);if(s&&s.customConverterId){if(!u(this.#f).has(s.customConverterId))throw new Error(`Custom converter not found: ${s.customConverterId}`);const h=u(this.#f).get(s.customConverterId);if(!h)throw new Error(`Custom converter not found: ${s.customConverterId}`);return h.layerToNode(t,a??null)}const c=new st(t.id,t.title,t,[],a);if(t.visible=s?.disableVisibilityToggle?t.visible:s?.isHidden?!1:s?.isVisibleOnInit??!1,u(this.#i).set(t.id,t.visible),this.updateDrawState(c,t.visible),this.#A(t)&&s?.showFields){const h=t;h.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const f of h.fields??[]){const g=this.#x(f,c);c.children.push(g)}}if(this.#k(t)){const h=t;return c.children=h.layers.toArray().map(f=>this.#w(f,c)),c}if(this.#I(t)){const h=t;if(h.sublayers&&h.sublayers.length>0){const f=h.sublayers;c.children=f.toArray().map(this.#_)}}return c}#x(t,a){const s=this.#C(a.id,t.name),c=new Ar(s,t.alias||t.name,a.layer,t,[],a),h=this.#v(s);return u(this.#i).set(s,h?.isVisibleOnInit??!1),c}#I(t){return t.type==="map-image"||t.type==="wms"}#_(t){const a=new st(t.uid,t.title,t);return t.sublayers?.length&&(a.children=t.sublayers.toArray().map(this.#_)),a}#S(t,a){for(const s of t)a.set(s.id,s),s.children?.length&&this.#S(s.children,a)}#C(t,a){return`${t}-${a}`}#k(t){return t.type==="group"}#A(t){return t.type==="feature"}#c(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}const Gl='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Wl='<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Yl='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',Oa=(x,t,a,s)=>t?Jl(x,a):a?s?Gl:Wl:Yl,Jl=(x,t)=>{switch(x.type){case"group":return Zi;case"feature":return ea;case"tile":return zo;default:return t?Zi:ea}};function Ql(x){const t=x-1;return t*t*t+1}var Xl=oe('<div class="relative ml-4 w-full"><div class="tree-guide-line svelte-1y72o5r"></div> <div class="tree-children svelte-1y72o5r"></div></div>'),Zl=oe('<div class="w-full"><!> <!></div>');function Pa(x,t){const a=Me(t,"isOpen",3,!1),s=Me(t,"childNodes",3,null),c=Me(t,"duration",3,300);var h=Zl(),f=X(h);Qe(f,()=>t.content??Je);var g=fe(f,2);{var P=w=>{var A=Xl(),N=fe(X(A),2);zt(N,21,()=>s()??[],E=>E.id,(E,q)=>{var L=ae(),M=$(L);Qe(M,()=>t.childNode??Je,()=>u(q)),F(E,L)}),Y(N),Y(A),Cn(1,N,()=>da,()=>({duration:c(),easing:Ql})),Cn(2,N,()=>da,()=>({duration:c()})),F(w,A)};ve(g,w=>{a()&&s()&&w(P)})}Y(h),F(x,h)}const hi="mb-1 cursor-pointer rounded-md border border-border p-2 text-left",vi="transform-gpu transition-all duration-150 ease-out hover:border-border/50 hover:bg-gray-100 hover:shadow-sm",eu="transition-colors hover:bg-blue-500",pi="text-sm font-normal",gi="bg-card",Ta="bg-accent text-accent-foreground",tu="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";function ru(x={}){const{enhancedHover:t=!1,includeFont:a=!1,pressed:s=!1}=x;let c=hi;return t?c+=" "+vi:c+=" "+eu,a&&(c+=" "+pi),s?c+=" "+Ta:c+=" "+gi,c}var nu=oe('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),iu=oe('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function pa(x,t){const a=`calc(100% - ${t.depth*1}rem)`,s=`${hi} ${vi} ${tu} ${gi} ${pi}`,c=`${hi} ${vi} ${pi}`;var h=ae(),f=$(h);{var g=w=>{Ko(w,{get pressed(){return t.pressed},get class(){return s},variant:"outline",get style(){return`width: ${a};`},get onPressedChange(){return t.onclick},children:(A,N)=>{var E=nu(),q=X(E),L=X(q),M=X(L);qr(M,()=>t.icon),Y(L);var H=fe(L,2),R=X(H,!0);Y(H),Y(q);var z=fe(q,2);Qe(z,()=>t.children??Je),Y(E),dt(()=>Tt(R,t.name)),F(A,E)},$$slots:{default:!0}})},P=w=>{var A=iu();A.__click=function(...j){t.onclick?.apply(this,j)};var N=X(A),E=X(N),q=X(E);Sa(q,{get isOpen(){return t.isOpen}});var L=fe(q,2),M=X(L);qr(M,()=>t.icon),Y(L);var H=fe(L,2),R=X(H,!0);Y(H),Y(E);var z=fe(E,2);Qe(z,()=>t.children??Je),Y(N),Y(A),dt(()=>{rr(A,1,`${c} ${t.pressed?Ta:gi}`),Cr(A,`width: ${a};`),Tt(R,t.name)}),F(w,A)};ve(f,w=>{t.isTogglable?w(g):w(P,!1)})}F(x,h)}Tn(["click"]);function Ea(x,t){Re(t,!0);const a=M=>{var H=ae(),R=$(H);{var z=j=>{var G=ae(),le=$(G);{var re=ge=>{pa(ge,{isTogglable:!1,get pressed(){return u(w)},get icon(){return u(A)},get name(){return t.node.name},get depth(){return c()},onclick:L,get isOpen(){return u(P)}})},se=ge=>{pa(ge,{isTogglable:!0,get pressed(){return u(w)},get icon(){return u(A)},get name(){return t.node.name},get depth(){return c()},onclick:q,get isOpen(){return u(P)}})};ve(le,ge=>{f?ge(re):ge(se,!1)})}F(j,G)};ve(R,j=>{t.treeviewConfigStore.getItemConfig(t.node.id)?.isHidden||j(z)})}F(M,H)},s=(M,H=Je)=>{var R=ae(),z=$(R);{var j=G=>{{let le=he(()=>c()+1);Ea(G,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return H()},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get getNodeVisibility(){return t.getNodeVisibility},get depth(){return u(le)},get useLayerTypeIcon(){return h()}})}};ve(z,G=>{f&&u(P)&&!t.treeviewConfigStore.getItemConfig(H().id)?.isHidden&&G(j)})}F(M,R)},c=Me(t,"depth",3,0),h=Me(t,"useLayerTypeIcon",3,!1),f=!!(t.node.children&&t.node.children.length),g=!f;let P=ne(!1),w=ne(!1),A=ne("");function N(){return!t.node.children||!t.getNodeVisibility?!1:t.node.children.some(M=>{const H=t.getNodeVisibility(M.id);return H!==void 0?H:M instanceof st?M.layer.visible:!1})}Xe(()=>{if(!(!t.node||!(t.node instanceof st))){if(f)K(w,N(),!0);else{const M=t.getNodeVisibility?t.getNodeVisibility(t.node.id):void 0;K(w,M!==void 0?M:t.node.layer.visible,!0)}K(A,Oa(t.node.layer,h(),f,u(P)),!0)}});function E(){!g||!t.onNodeVisibilityChange||f||(K(w,!u(w)),t.onNodeVisibilityChange(t.node,u(w)))}function q(){f||E(),t.onNodeClick?.(t.node)}function L(){K(P,!u(P)),t.onNodeClick?.(t.node)}{let M=he(()=>f?t.node.children:null);Pa(x,{get isOpen(){return u(P)},get content(){return a},get childNodes(){return u(M)},get childNode(){return s}})}Le()}function au(x,t){Re(t,!0);const a=new Aa;function s(){a.clearSelections()}Xe(()=>{!t.webMap||a.initialized||a.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,null)}),Xe(()=>{if(!a.initialized)return;if(!a.getVisibleNodes().length){t.areaSelectionStore.setLayerId(null);return}const P=a.getVisibleNodes().find(w=>w instanceof st&&w.layer instanceof ui);if(!P||!(P instanceof st)){console.warn("Visible node is not a FeatureLayer");return}if(!P.layer||!(P.layer instanceof ui)){console.warn("Visible node layer is not a FeatureLayer",P.layer.type);return}t.areaSelectionStore.setLayerId(P.id)});var c={clearSelections:s},h=ae(),f=$(h);{var g=P=>{var w=ae(),A=$(w);Te(A,()=>xa,(N,E)=>{E(N,{children:(q,L)=>{var M=ae(),H=$(M);zt(H,17,()=>a.getNodes(),R=>R.id,(R,z)=>{Ea(R,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return u(z)},onNodeClick:()=>{},onNodeVisibilityChange:(j,G)=>a.setVisibilityState(j.id,G),getNodeVisibility:j=>a.getVisibilityState(j),depth:0,useLayerTypeIcon:!0})}),F(q,M)},$$slots:{default:!0}})}),F(P,w)};ve(f,P=>{a.initialized&&P(g)})}return F(x,h),Le(c)}class ou{configStore;constructor(t){this.configStore=t}}function su(x){return x.replace(/&deg;/gi,"Â°").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}class lu extends ou{id="aliasPath";layerToNode(t,a){const s=new st(t.id,t.title,t,[],a),c=this.configStore.getItemConfig(t.id);if(this.#r(t)&&c?.showFields){const h=t;h.loaded||console.warn(`Layer not loaded: ${t.id}`);const f=new Map;for(const g of h.fields??[]){const P=this.configStore.getItemConfig(this.#t(t.id,g.name));!P||P.isHidden||this.#e(g,s,f)}s.children.sort((g,P)=>g.children.length>0&&P.children.length===0?1:g.children.length===0&&P.children.length>0?-1:0)}return s}#e(t,a,s=new Map){const c=this.#t(a.id,t.name),f=su(t.alias||"")?.split("|").map(E=>E.trim()).filter(Boolean)??[];if(f.length===0){const E=new Ar(c,t.alias||t.name,a.layer,t,[],a);return a.children.push(E),E}const g=f.slice(0,-1),P=f[f.length-1];let w=a;const A=(E,q)=>{E.children??=[],E.children.includes(q)||E.children.push(q)};for(let E=0;E<g.length;E++){const q=g[E],L=f.slice(0,E+1).join("::"),M=`${a.id}::${L}`;let H=s.get(M);H||(H=new ka(M,q,[],w),s.set(M,H),A(w,H)),w=H}const N=new Ar(c,P||t.name,a.layer,t,[],w);return A(w,N),N}#t(t,a){return`${t}-${a}`}#r(t){return t.type==="feature"}}class ga{#e=[];#t=new Map;#r=[];#n=new Map;#a=[];#i=new Map;#s=new Set;constructor(t){if(!t)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=t.items??[],this.#t=new Map(this.#e.map(a=>[a.id,a])),this.#r=t.visibilityGroups??[],this.#n=new Map(this.#r.map(a=>[a.id,a])),this.#a=t.inheritanceGroups??[],this.#i=new Map(this.#a.map(a=>[a.id,a])),t.fieldsToHide&&(this.#s=new Set(t.fieldsToHide.map(a=>a.trim().toLowerCase())))}getItemConfig(t){return this.#t.get(t)}getVisibilityGroupConfig(t){return this.#n.get(t)}getInheritanceGroupConfig(t){return this.#i.get(t)}resolveInheritance(t){if(!(t.length===0||!this.#e||this.#e.length===0))for(const a of t){const s=this.getItemConfig(a.id);this.#l(a,s)}}#l(t,a){const s=this.#u(t,a);if(this.#y(t)&&s.showFields){const c=t;c.loaded||console.warn(`Layer not loaded: ${t.id}`);for(const h of c.fields??[])this.#f(this.#g(t.id,h.name),h.alias||h.name,s)}if(this.#m(t)){const c=t;for(const h of c.layers.toArray())this.#l(h,s)}}#u(t,a){const s=this.#h(t.id,a);return s.type===yn.None&&(s.type=Bo(t)),s}#f(t,a,s){const c=this.#h(t,s);return c.type===yn.None&&(c.type=yn.Field),this.#s.has(a.trim().toLowerCase())&&(c.isHidden=!0),c}#h(t,a){let s=this.getItemConfig(t);const c=s?.inheritanceGroupId?this.getInheritanceGroupConfig(s.inheritanceGroupId):this.getInheritanceGroupConfig(a?.inheritanceGroupId??"");return s={id:t,type:yn.None,isDownloadable:this.#o(c,"isDownloadable",s,a,!0),isVisibleOnInit:this.#o(c,"isVisibleOnInit",s,a,!1),isHidden:this.#o(c,"isHidden",s,a,!1),disableVisibilityToggle:this.#o(c,"disableVisibilityToggle",s,a,!1),isOpenOnInit:this.#o(c,"isOpenOnInit",s,a,!1),showFields:this.#o(c,"showFields",s,a,!1),visibilityDependencyIds:this.#o(c,"visibilityDependencyIds",s,a,[]),visibilityGroupId:this.#o(c,"visibilityGroupId",s,a,void 0),customConverterId:this.#o(c,"customConverterId",s,a,void 0),inheritanceGroupId:this.#o(c,"inheritanceGroupId",s,a,void 0)},this.#p(s),this.#d(s),s}#o(t,a,s,c,h){const f=s?.[a];return f!==void 0?f:t?.inheritedProperties.includes(a)&&c?c[a]??h:h}#d(t){if(this.#t.has(t.id))throw new Error(`Item with id ${t.id} already exists.`);this.#e.push(t),this.#t.set(t.id,t)}#p(t){this.#t.has(t.id)&&(this.#e=this.#e.filter(a=>a.id!==t.id),this.#t.delete(t.id))}#g(t,a){return`${t}-${a}`}#m(t){return t.type==="group"}#y(t){return t.type==="feature"}}var uu=oe('<div data-slot="checkbox-indicator" class="text-current transition-none"><!></div>');function cu(x,t){Re(t,!0);let a=Me(t,"ref",15,null),s=Me(t,"checked",11,!1),c=Me(t,"indeterminate",11,!1),h=Mt(t,["$$slots","$$events","$$legacy","ref","checked","indeterminate","class"]),f=ne($e(s())),g=ne($e(c()));Xe(()=>{K(f,s())}),Xe(()=>{K(g,c())});var P=ae(),w=$(P);{const A=(E,q)=>{let L=()=>q?.().checked,M=()=>q?.().indeterminate;var H=uu(),R=X(H);{var z=G=>{Fl(G,{class:"size-3.5"})},j=G=>{var le=ae(),re=$(le);{var se=ge=>{Uo(ge,{class:"size-3.5"})};ve(re,ge=>{M()&&ge(se)},!0)}F(G,le)};ve(R,G=>{L()?G(z):G(j,!1)})}Y(H),F(E,H)};let N=he(()=>os("peer flex size-4 shrink-0 items-center justify-center rounded-[4px] border border-input shadow-xs transition-shadow outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 data-[state=checked]:border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:bg-input/30 dark:aria-invalid:ring-destructive/40 dark:data-[state=checked]:bg-primary",t.class));Te(w,()=>qo,(E,q)=>{q(E,kt({"data-slot":"checkbox",get class(){return u(N)}},()=>h,{get ref(){return a()},set ref(L){a(L)},get checked(){return u(f)},set checked(L){K(f,L,!0)},get indeterminate(){return u(g)},set indeterminate(L){K(g,L,!0)},children:A,$$slots:{default:!0}}))})}F(x,P),Le()}var du=oe("<div><!></div>");function ma(x,t){Re(t,!0);let a=he(()=>t.getDownloadState?.(t.node)??it.Inactive),s=he(()=>u(a)===it.Active),c=he(()=>u(a)===it.Indeterminate);function h(P){P.stopPropagation();const w=u(a)===it.Active?it.Inactive:it.Active;t.onDownloadStateChanged?.(t.node,w)}var f=du(),g=X(f);cu(g,{get checked(){return u(s)},get indeterminate(){return u(c)},onclick:h,title:"Download"}),Y(f),F(x,f),Le()}var fu=oe('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ya(x,t){Re(t,!0);const a=Me(t,"isFolder",3,!1),s=Me(t,"isOpen",3,!1),c=`calc(100% - ${t.depth*1}rem)`;var h=fu();h.__click=function(...M){t.onclick?.apply(this,M)};var f=X(h),g=X(f),P=X(g);{var w=M=>{Sa(M,{get isOpen(){return s()}})};ve(P,M=>{a()&&M(w)})}var A=fe(P,2),N=X(A);qr(N,()=>t.icon),Y(A);var E=fe(A,2),q=X(E,!0);Y(E),Y(g);var L=fe(g,2);Qe(L,()=>t.children??Je),Y(f),Y(h),dt(M=>{rr(h,1,M),Cr(h,`width: ${c};`),Tt(q,t.name)},[()=>wo(ru({enhancedHover:!0,includeFont:!0}))]),F(x,h),Le()}Tn(["click"]);var hu=oe('<div class="flex items-center gap-2"><!> <!></div>'),vu=oe('<div class="flex items-center gap-2"><!> <!></div>');function Fa(x,t){Re(t,!0);const a=z=>{var j=ae(),G=$(j);{var le=re=>{var se=ae(),ge=$(se);{var Oe=be=>{ya(be,{get icon(){return u(E)},get name(){return t.node.name},get depth(){return h()},onclick:R,get isFolder(){return g},get isOpen(){return u(A)},children:we=>{var Ee=hu(),Ke=X(Ee);{var We=me=>{ma(me,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};ve(Ke,me=>{t.isDownloadable&&me(We)})}var Ie=fe(Ke,2);{var Ve=me=>{{let Fe=he(()=>t.getNodeDrawState?.(t.node.id)===tr.Suspended);ta(me,{get checked(){return u(N)},get indeterminate(){return u(Fe)},onCheckedChange:M})}};ve(Ie,me=>{P&&me(Ve)})}Y(Ee),F(we,Ee)},$$slots:{default:!0}})},ue=be=>{ya(be,{get icon(){return u(E)},get name(){return t.node.name},get depth(){return h()},onclick:H,get isFolder(){return g},children:we=>{var Ee=vu(),Ke=X(Ee);{var We=me=>{ma(me,{get node(){return t.node},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState}})};ve(Ke,me=>{t.isDownloadable&&me(We)})}var Ie=fe(Ke,2);{var Ve=me=>{{let Fe=he(()=>t.getNodeDrawState?.(t.node.id)===tr.Suspended);ta(me,{get checked(){return u(N)},get indeterminate(){return u(Fe)},onCheckedChange:M})}};ve(Ie,me=>{P&&me(Ve)})}Y(Ee),F(we,Ee)},$$slots:{default:!0}})};ve(ge,be=>{g?be(Oe):be(ue,!1)})}F(re,se)};ve(G,re=>{c()?.getItemConfig(t.node.id)?.isHidden||re(le)})}F(z,j)},s=(z,j=Je)=>{var G=ae(),le=$(G);{var re=se=>{{let ge=he(()=>c()?.getItemConfig(j().id)?.isDownloadable??!0),Oe=he(()=>h()+1);Fa(se,{get treeviewConfigStore(){return c()},get node(){return j()},get isDownloadable(){return u(ge)},get onNodeClick(){return t.onNodeClick},get onNodeVisibilityChange(){return t.onNodeVisibilityChange},get onDownloadStateChanged(){return t.onDownloadStateChanged},get getDownloadState(){return t.getDownloadState},get onFilterClicked(){return t.onFilterClicked},get hasFiltersApplied(){return t.hasFiltersApplied},get getNodeVisibility(){return t.getNodeVisibility},get getNodeDrawState(){return t.getNodeDrawState},get depth(){return u(Oe)},get useLayerTypeIcon(){return f()}})}};ve(le,se=>{g&&u(A)&&!c()?.getItemConfig(j().id)?.isHidden&&se(re)})}F(z,G)},c=Me(t,"treeviewConfigStore",3,null),h=Me(t,"depth",3,0),f=Me(t,"useLayerTypeIcon",3,!1),g=!!(t.node.children&&t.node.children.length),P=!g;let w=!1,A=ne(!1),N=ne(!1),E=ne(""),q=ne(!1),L=ne(!1);Xe(()=>{w||(K(A,c()?.getItemConfig(t.node.id)?.isOpenOnInit??!1,!0),w=!0)}),Xe(()=>{if(!t.node)return;const z=t.getNodeVisibility?t.getNodeVisibility(t.node.id):!1;K(N,z??!1,!0),t.node instanceof st&&K(E,Oa(t.node.layer,f(),g,u(A)),!0)}),Xe(()=>{if(!(t.node instanceof st))return;const z=(t.getDownloadState?.(t.node)===it.Active&&t.node.layer.type==="feature")??!1;z&&!u(q)?(K(q,!0),K(L,!1)):!z&&u(q)&&(K(L,!0),setTimeout(()=>{K(q,!1),K(L,!1)},180))});function M(){!P||!t.onNodeVisibilityChange||(K(N,!u(N)),t.onNodeVisibilityChange(t.node,u(N)))}function H(){t.onNodeClick?.(t.node)}function R(){K(A,!u(A)),t.onNodeClick?.(t.node)}{let z=he(()=>g?t.node.children:null);Pa(x,{get isOpen(){return u(A)},get content(){return a},get childNodes(){return u(z)},get childNode(){return s}})}Le()}class pu{#e;#t;constructor(t,a){this.#e=t,this.#t=a}updateSelection(t,a){if(!this.#t.getItemConfig(t.id)?.isHidden){if(!(t instanceof st)){this.updateChildrenSelection(t,a);return}if(t instanceof Ar){this.updateFieldSelection(t,a);return}this.updateLayerSelection(t,a)}}getSelectionState(t){if(!(t instanceof st))return this.determineSelectionStateFromChildren(t);if(this.isGroupLayer(t))return this.determineSelectionStateFromChildren(t);let a;return t instanceof Ar?(a=this.#e.getSelection(t.featureLayer.id),a&&a.fields.has(t.field.name)?it.Active:it.Inactive):(a=this.#e.getSelection(t.id),a?this.isFeatureLayer(t)&&t.children&&t.children.length>0?this.determineSelectionStateFromChildren(t):it.Active:it.Inactive)}updateLayerSelection(t,a){let s=this.#e.getSelection(t.id);switch(a){case it.Active:!s&&!this.isGroupLayer(t)&&(s=this.createAndAddDataSelection(t.id,t.layer));for(const c of t.children||[])this.updateSelection(c,a);break;case it.Inactive:s&&!this.isGroupLayer(t)&&this.#e.removeSelection(t.id),this.updateChildrenSelection(t,a);break}}updateFieldSelection(t,a){let s=this.#e.getSelection(t.featureLayer.id);switch(a){case it.Active:s||(s=this.createAndAddDataSelection(t.featureLayer.id,t.featureLayer)),s.fields.add(t.field.name);break;case it.Inactive:if(!s)break;s.fields.delete(t.field.name),s.fields.size===0&&this.#e.removeSelection(s.layerId);break}}updateChildrenSelection(t,a){for(const s of t.children||[])this.updateSelection(s,a)}determineSelectionStateFromChildren(t){let a=0,s=0;for(const c of t.children||[]){if(this.#t.getItemConfig(c.id)?.isHidden)continue;s++;const f=this.getSelectionState(c);if(f===it.Active||this.isFeatureLayer(c)&&f!==it.Inactive)a++;else if(f===it.Indeterminate)return it.Indeterminate}return a===0?it.Inactive:a===s?it.Active:it.Indeterminate}createAndAddDataSelection(t,a){const s={layerId:t,layer:a,fields:new $t};return this.#e.addSelection(s),s}isGroupLayer(t){return t instanceof st&&t.layer.type==="group"}isFeatureLayer(t){return t instanceof st&&t.layer.type==="feature"}}function gu(x,t){Re(t,!0);const a=Me(t,"fieldFilterMenuStore",7);function s(){c.clearSelections()}const c=new Aa,h=new pu(Ct,t.treeviewConfigStore);Xe(()=>{if(!t.webMap||c.initialized)return;(async()=>{await t.webMap.when(),await f(t.webMap.layers.toArray());const z=new lu(t.treeviewConfigStore);c.initialize(t.webMap.layers.toArray(),t.treeviewConfigStore,t.layerViewProvider,[z],t.customRendererService)})()});async function f(R){for(const z of R)z.type==="feature"&&!z.loaded&&await z.load(),z.type==="group"&&await f(z.layers.toArray())}function g(R,z){console.log(`[tree-view] onNodeVisibilityChange: Setting visibility of node ${R.id} to ${z}`),c.setVisibilityState(R.id,z)}function P(R){return c.getNodeDrawState(R)}function w(R,z){h.updateSelection(R,z)}function A(R){return h.getSelectionState(R)}function N(R){if(a().ActiveLayer?.uid===R){a().ActiveLayer=null;return}const j=c.getNodeById(R);!j||!(j instanceof st)||(a().ActiveLayer=j.layer)}function E(R){const z=Ct.getSelection(R);if(!z?.fields)return!1;const j=c.getNodeById(R);if(!j||!(j instanceof st))return!1;const G=j.layer.fields?.length||0,le=z.fields.size;return le>0&&le!==G}var q={clearSelections:s},L=ae(),M=$(L);{var H=R=>{var z=ae(),j=$(z);Te(j,()=>xa,(G,le)=>{le(G,{children:(re,se)=>{var ge=ae(),Oe=$(ge);zt(Oe,17,()=>c.getNodes(),ue=>ue.id,(ue,be)=>{{let Ce=he(()=>t.treeviewConfigStore.getItemConfig(u(be).id)?.isDownloadable??!0);Fa(ue,{get treeviewConfigStore(){return t.treeviewConfigStore},get node(){return u(be)},get isDownloadable(){return u(Ce)},onNodeClick:()=>{},onNodeVisibilityChange:g,getNodeVisibility:we=>c.getVisibilityState(we),onDownloadStateChanged:w,getDownloadState:A,onFilterClicked:N,hasFiltersApplied:E,getNodeDrawState:P,depth:0,useLayerTypeIcon:!0})}}),F(re,ge)},$$slots:{default:!0}})}),F(R,z)};ve(M,R=>{c.initialized&&R(H)})}return F(x,L),Le(q)}class Da{#e;constructor(t){this.#e=t}async getLayerView(t){return this.#e.whenLayerView(t)}async getLayerViewById(t){const a=this.#e.map?.findLayerById(t);if(a)return this.getLayerView(a)}}class mu{mapView;areaSelectionInteractionStore;interactableLayers;pointerMoveHandle=null;clickHandle=null;leaveHandle=null;enterHandle=null;#e=ne(!0);get pointerInsideMap(){return u(this.#e)}set pointerInsideMap(t){K(this.#e,t,!0)}constructor(t,a,s){console.log("[map-interaction-store] Initializing with MapView"),this.mapView=t,this.areaSelectionInteractionStore=a,this.interactableLayers=s,this.setupHighlights(t),this.setupPointerMoveHandler(t),this.setupClickHandler(t),this.setupLeaveHandler(t),this.setupEnterHandler(t),console.log("[map-interaction-store] Initialized with MapView")}setupHighlights(t){const a={name:"hover",color:"lightgreen",haloOpacity:1,fillOpacity:.2},s={name:"selected",color:"green",haloOpacity:1,fillOpacity:.3};t.highlights.push(a),t.highlights.push(s)}setupPointerMoveHandler(t){this.pointerMoveHandle=t.on("pointer-move",async a=>{if(!this.pointerInsideMap)return;const{results:s}=await t.hitTest(a),c=s[0];if(!c){this.clearHoverHighlight();return}const h=c.graphic,f=h.layer;if(!h||!f||!this.isLayerInteractable(f.title)||h.attributes?.[f.objectIdField]===void 0){this.clearHoverHighlight();return}const g=h.attributes?.[f.objectIdField];if(!(this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.currentHoveredArea.id===g))try{const P=await t.whenLayerView(f);this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P),this.clearHoverHighlight();const w=P;if(!w){console.warn("LayerView is not a FeatureLayerView");return}if(!this.pointerInsideMap)return;const A=w.highlight(h,{name:"hover"});this.areaSelectionInteractionStore.setHoveredArea(g,A)}catch(P){console.error("Error in pointer-move handler:",P),this.clearHoverHighlight()}})}setupClickHandler(t){this.clickHandle=t.on("click",async a=>{const{results:s}=await t.hitTest(a),c=s[0];if(!c)return;const h=c.graphic,f=h.layer;if(!h||!f||!this.isLayerInteractable(f.title)||h.attributes?.[f.objectIdField]===void 0)return;const g=h.attributes?.[f.objectIdField];try{const P=await t.whenLayerView(f),w=P;if(!w){console.warn("Layer is not a FeatureLayerView");return}this.areaSelectionInteractionStore.selectionViewState.layerView!==P&&this.areaSelectionInteractionStore.setSelectedLayerView(P);const A=this.areaSelectionInteractionStore.selectionViewState.areaHandles.get(g);if(console.log("[map-interaction-store] Clicked area ID:",g,"Existing handle:",A),A)this.areaSelectionInteractionStore.removeSelectedArea(g),console.log("[map-interaction-store] Area deselected:",g);else{const N=w.highlight(h,{name:"selected"});this.areaSelectionInteractionStore.addSelectedArea(g,N),console.log("[map-interaction-store] Area selected:",g)}}catch(P){console.error("Error in click handler:",P)}})}setupLeaveHandler(t){this.leaveHandle=t.on("pointer-leave",()=>{this.pointerInsideMap=!1,this.clearHoverHighlight()})}setupEnterHandler(t){this.enterHandle=t.on("pointer-enter",()=>{this.pointerInsideMap=!0})}isLayerInteractable(t){return this.interactableLayers.has(t)}clearHoverHighlight(){this.areaSelectionInteractionStore.currentHoveredArea&&this.areaSelectionInteractionStore.clearHoveredArea()}cleanup(){this.pointerMoveHandle&&(this.pointerMoveHandle.remove(),this.pointerMoveHandle=null),this.clickHandle&&(this.clickHandle.remove(),this.clickHandle=null),this.leaveHandle&&(this.leaveHandle.remove(),this.leaveHandle=null),this.enterHandle&&(this.enterHandle.remove(),this.enterHandle=null),this.clearHoverHighlight(),this.pointerInsideMap=!0,this.interactableLayers=new $t,console.log("[map-interaction-store] cleaned up")}get currentMapView(){return this.mapView}}var yu=oe('<div class="map-view svelte-14z0ybm"></div>');function bu(x,t){Re(t,!0);const a=Me(t,"mapView",7);let s=ne(null),c=null;const h="streets-vector";let f,g;function P(){if(!a())throw new Error("MapView is not initialized");return new Da(a())}Ir(async()=>{await w(),await E()});async function w(){if(!g){const[{default:R},{default:z},{default:j},{default:G}]=await Promise.all([Kr(()=>import("../chunks/Bl8rnuVl.js").then(le=>le.M),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]),import.meta.url),Kr(()=>import("../chunks/T_8yv_P1.js").then(le=>le.a3),__vite__mapDeps([35,1,2,3,5,36,19,37,17,6,7,38,27,39,15,16,40,8,9,20,41,42,12,28,43,44,45,21,46,47,48,0,4,10,11,13,14,18,22,23,24,25,26,29,30,31,32,33,34,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88]),import.meta.url),Kr(()=>import("../chunks/DxJ7et7C.js").then(le=>le.W),__vite__mapDeps([89,1,2,3,5,6,7,0,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,36,37,38,39,40,90,91,92,93,62,94,95,75,76,66,50,51,52,53,54,55,56,57,58,59,60,96,97,98,65,61,99,100,101,102,64,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,41,42,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173]),import.meta.url),Kr(()=>import("../chunks/v5Iz_pFo.js"),__vite__mapDeps([96,5,1,2,3,51,19,8,7,9,6,52,18,15,16,17,34,90,97,98,65,66,61,99,100,101,33,62,102,12,21,64,38,27,39,103,104,105,106,56,107,50,53,54,55,10,57,58,59,60,108,109,110,111,112,113,114,115,116,117,118,119,120,121,91,28,41,42,122,123,124,125,126,127,128,129,29,30,31,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,40,146,147,148,149,150,151,152,153,154,155,156,23,157,158,159,13,160,161,162,93,163,164,165,166,167,168,169,170,92]),import.meta.url)]);f=R,g=z}}async function A(){return new f({basemap:h})}async function N(){if(t.webMap)try{if(await w(),await E(),!a()){console.error("MapView is not initialized");return}a().container=c,a().popupEnabled=!1,a().map=t.webMap,console.log("[uprn-map-view] MapView updated with new webMap")}catch(R){console.error("Error updating MapView with new webMap:",R)}}async function E(){if(!c){console.error("Map container element was not found");return}try{a().container=c,a().popupEnabled=!1,a().map=t.webMap??void 0,await a().when(),console.log("[uprn-map-view] Map loaded successfully")}catch(R){console.error("Error loading map:",R),await q()}}async function q(){try{const R=await A();a().container=c,a().popupEnabled=!1,a().map=R,await a().when(),console.log("[uprn-map-view] Fallback map loaded")}catch(R){console.error("Error loading fallback map:",R)}}Xe(()=>{t.webMap&&N()}),Xe(()=>{!a()||u(s)||K(s,new mu(a(),t.areaSelectionInteractionStore,t.interactableLayers),!0)});function L(){a()&&a().destroy()}ba(()=>{L()});var M={getLayerViewProvider:P},H=yu();return Vt(H,R=>c=R,()=>c),F(x,H),Le(M)}var wu=oe('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),_u=oe('<div class="flex min-h-0 flex-1 flex-col"><!></div>');function xn(x,t){var a=_u(),s=X(a);Te(s,()=>On,(c,h)=>{h(c,{class:"card-content flex min-h-0 flex-1 flex-col overflow-hidden p-0",children:(f,g)=>{var P=wu(),w=X(P);Qe(w,()=>t.children??Je),Y(P),F(f,P)},$$slots:{default:!0}})}),Y(a),F(x,a)}var Su=oe("<!> <!>",1),xu=oe('<div class="tab-list-wrapper flex-shrink-0 svelte-rohqkk"><!></div> <!>',1);function Iu(x,t){Re(t,!0);const a=Me(t,"triggers",19,()=>[]);var s=ae(),c=$(s);Te(c,()=>$o,(h,f)=>{f(h,{get value(){return t.value},get onValueChange(){return t.onValueChange},class:"flex h-full w-full flex-col",children:(g,P)=>{var w=xu(),A=$(w),N=X(A);Te(N,()=>Go,(q,L)=>{L(q,{class:"tab-list",children:(M,H)=>{var R=ae(),z=$(R);zt(z,17,a,kr,(j,G,le,re)=>{let se=()=>u(G).value,ge=()=>u(G).label;var Oe=Su(),ue=$(Oe);Te(ue,()=>Wo,(we,Ee)=>{Ee(we,{get value(){return se()},class:"tab-trigger",children:(Ke,We)=>{dr();var Ie=xr();dt(()=>Tt(Ie,ge())),F(Ke,Ie)},$$slots:{default:!0}})});var be=fe(ue,2);{var Ce=we=>{Po(we,{class:"separator"})};ve(be,we=>{se()!==a()[a().length-1]?.value&&we(Ce)})}F(j,Oe)}),F(M,R)},$$slots:{default:!0}})}),Y(A);var E=fe(A,2);Qe(E,()=>t.children??Je),F(g,w)},$$slots:{default:!0}})}),F(x,s),Le()}const qe=Object.freeze({LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"});var Cu=oe("<!> <div><aside><div><div><!></div></div></aside></div> <!>",1);function ku(x,t){Re(t,!0);const a=Me(t,"position",19,()=>qe.LEFT),s=Me(t,"openIcon",3,pl),c=8,h="500px",f="var(--header-height, 64px)";let g,P=ne(0),w=ne($e(t.originalSize??h)),A=ne(!1),N=ne(!1);const E=he(()=>a()===qe.LEFT||a()===qe.RIGHT),q=he(()=>a()===qe.LEFT||a()===qe.TOP),L=he(()=>u(E)?"500px":"100px"),M=he(()=>t.minSize??u(L)),H=he(()=>parseFloat(u(M))),R=he(()=>u(E)?"width":"height"),z=he(()=>u(E)?"ew-resize":"ns-resize");Xe(()=>{u(N)||(K(w,t.originalSize??u(M),!0),console.log("Sidebar size updated due to minSize/originalSize change:",u(w),t.originalSize))}),Ir(()=>{if(!g)return;const de=new ResizeObserver(_e=>{for(const je of _e)K(P,u(E)?je.contentRect.width:je.contentRect.height,!0)});return de.observe(g),()=>de.disconnect()});function j(de){if(!t.isOpen)return;K(A,!0),de.preventDefault();const _e=u(E)?de.clientX:de.clientY,je=parseFloat(u(w));function ft(at){const Ge=u(E)?at.clientX:at.clientY,ye=u(q)?Ge-_e:_e-Ge,Be=Math.max(u(H),je+ye);K(w,`${Be}px`),K(N,!0)}function Z(){K(A,!1),document.removeEventListener("mousemove",ft),document.removeEventListener("mouseup",Z),document.body.style.cursor="",document.body.style.userSelect=""}document.addEventListener("mousemove",ft),document.addEventListener("mouseup",Z),document.body.style.cursor=u(z),document.body.style.userSelect="none"}const G=he(()=>()=>{const de=t.isOpen?u(w):"0px";return{[qe.LEFT]:{top:f,left:de},[qe.RIGHT]:{top:f,right:de},[qe.TOP]:{top:de},[qe.BOTTOM]:{bottom:de}}[a()]}),le=he(()=>()=>({[qe.LEFT]:hl,[qe.RIGHT]:Yo,[qe.TOP]:vl,[qe.BOTTOM]:fl})[a()]),re=he(()=>()=>{if(!t.isOpen)return{};const de=`${c}px`,_e=t.isOpen?`calc(${u(w)} + ${-c/2}px)`:"0px";return{[qe.LEFT]:{left:_e,top:"0",width:de,height:"100%"},[qe.RIGHT]:{right:_e,top:"0",width:de,height:"100%"},[qe.TOP]:{top:_e,left:"0",height:de,width:"100%"},[qe.BOTTOM]:{bottom:_e,left:"0",height:de,width:"100%"}}[a()]});function se(de){return Object.entries(de).map(([_e,je])=>`${_e}: ${je}`).join("; ")}const ge=he(()=>u(q)?0:1),Oe=he(()=>()=>t.isOpen?"translate(0, 0)":{[qe.LEFT]:`translate(-${u(w)}, 0)`,[qe.RIGHT]:`translate(${u(w)}, 0)`,[qe.TOP]:`translate(0, -${u(w)})`,[qe.BOTTOM]:`translate(0, ${u(w)})`}[a()]),ue=he(()=>()=>{const de=t.isOpen?u(w):"0px";return{[u(R)]:de,order:`${u(ge)}`}});var be=Cu(),Ce=$(be);{let de=he(()=>u(A)?"":"transition-all duration-300"),_e=he(()=>se(u(G)())),je=he(()=>u(A)?"transition: none !important;":""),ft=he(()=>t.isOpen?"Close sidebar":"Open sidebar");Pt(Ce,{get onclick(){return t.onToggle},variant:"default",size:"icon",get class(){return`fixed z-2 -ml-1 inline-flex size-7 
	shrink-0 items-center justify-center gap-2 overflow-hidden rounded-md bg-background text-sm
	font-medium whitespace-nowrap shadow-none outline-hidden transition-all select-none hover:bg-accent focus-visible:border-ring 
	focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:pointer-events-none disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 ${u(de)??""}`},get style(){return`${u(_e)??""}; pointer-events: auto; ${u(je)??""}`},get"aria-label"(){return u(ft)},get"aria-expanded"(){return t.isOpen},children:(Z,at)=>{var Ge=ae(),ye=$(Ge);{var Be=He=>{const Ze=he(()=>u(le)());var At=ae(),ht=$(At);Te(ht,()=>u(Ze),(et,ot)=>{ot(et,{class:"h-6 w-6 text-primary"})}),F(He,At)},lt=He=>{const Ze=he(s);var At=ae(),ht=$(At);Te(ht,()=>u(Ze),(et,ot)=>{ot(et,{class:"h-6 w-6 text-primary"})}),F(He,At)};ve(ye,He=>{t.isOpen?He(Be):He(lt,!1)})}F(Z,Ge)},$$slots:{default:!0}})}var we=fe(Ce,2);let Ee;var Ke=X(we);let We;var Ie=X(Ke);let Ve;var me=X(Ie);let Fe;var pe=X(me);{var Ue=de=>{var _e=ae(),je=$(_e);Qe(je,()=>t.children),F(de,_e)};ve(pe,de=>{t.children&&de(Ue)})}Y(me),Y(Ie),Y(Ke),Vt(Ke,de=>g=de,()=>g),Y(we);var Ne=fe(we,2);{var ke=de=>{{let _e=he(()=>u(E)?"cursor-ew-resize":"cursor-ns-resize"),je=he(()=>u(A)?"":"transition-all duration-300"),ft=he(()=>se(u(re)()));Pt(de,{get class(){return`fixed z-40 border-0 bg-transparent p-0 ring-0 transition-colors outline-none hover:!bg-primary/50 focus-visible:ring-0 ${u(_e)??""} ${u(je)??""}`},onmousedown:j,"aria-label":"Resize sidebar by dragging",get style(){return`${u(ft)??""}; outline: none !important; box-shadow: none !important; border: none !important;`}})}};ve(Ne,de=>{t.isOpen&&de(ke)})}dt((de,_e,je,ft,Z,at)=>{Ee=rr(we,1,"relative z-3 h-full w-full overflow-hidden transition-all duration-300",null,Ee,de),Cr(we,_e),We=rr(Ke,1,"border-r-bg-sidebar-border relative flex border-r-1 bg-sidebar text-sidebar-foreground shadow-lg",null,We,je),Cr(Ke,`${u(R)??""}: ${u(w)??""}; transform: ${ft??""};`),Ve=rr(Ie,1,"flex overflow-hidden",null,Ve,Z),Fe=rr(me,1,"flex overflow-hidden",null,Fe,at)},[()=>({"h-full":u(E),"w-full":!u(E),"transition-all":!u(A),"duration-300":!u(A)}),()=>se(u(ue)()),()=>({"flex-col":u(E),"flex-row":!u(E),"h-full":u(E),"w-full":!u(E),"border-r":a()===qe.LEFT,"border-l":a()===qe.RIGHT,"border-b":a()===qe.TOP,"border-t":a()===qe.BOTTOM,"border-sidebar-border":!0,"transition-transform":!u(A),"duration-300":!u(A)}),()=>u(Oe)(),()=>({"flex-col":u(E),"flex-row":!u(E),"h-full":u(E),"w-full":!u(E)}),()=>({"flex-col":u(E),"flex-row":!u(E),"h-full":u(E),"w-full":!u(E)})]),F(x,be),Le()}var Au=oe('<div><!> <div class="main-content svelte-f4u9lw"><!></div></div>');function Ou(x,t){Re(t,!0);const a=Me(t,"position",19,()=>qe.LEFT),s=he(()=>a()===qe.TOP||a()===qe.BOTTOM);var c=Au();let h;var f=X(c);ku(f,{get isOpen(){return t.isOpen},get onToggle(){return t.onToggle},get position(){return a()},get originalSize(){return t.originalSize},get minSize(){return t.minSize},get openIcon(){return t.openIcon},children:(A,N)=>{var E=ae(),q=$(E);{var L=M=>{var H=ae(),R=$(H);Qe(R,()=>t.sidebarContent),F(M,H)};ve(q,M=>{t.sidebarContent&&M(L)})}F(A,E)},$$slots:{default:!0}});var g=fe(f,2),P=X(g);{var w=A=>{var N=ae(),E=$(N);Qe(E,()=>t.mainContent),F(A,N)};ve(P,A=>{t.mainContent&&A(w)})}Y(g),Y(c),dt(A=>h=rr(c,1,"sidebar-layout svelte-f4u9lw",null,h,A),[()=>({vertical:u(s)})]),F(x,c),Le()}var Pu=oe('<div class="min-w-0 space-y-2 overflow-hidden"><!></div>'),Tu=oe('<div class="w-full flex-1 overflow-hidden pr-1.5 pl-1.5"><!></div>');function Eu(x,t){var a=Tu(),s=X(a);_a(s,{class:"h-full w-full",children:(c,h)=>{var f=Pu(),g=X(f);{var P=w=>{var A=ae(),N=$(A);Qe(N,()=>t.children),F(w,A)};ve(g,w=>{t.children&&w(P)})}Y(f),F(c,f)},$$slots:{default:!0}}),Y(a),F(x,a)}var Fu=oe('<div class="w-full flex-shrink-0"><!></div>');function Du(x,t){var a=Fu(),s=X(a);{var c=h=>{var f=ae(),g=$(f);Qe(g,()=>t.children),F(h,f)};ve(s,h=>{t.children&&h(c)})}Y(a),F(x,a)}var Nu=oe('<div class="w-full flex-shrink-0"><!></div>');function Mu(x,t){var a=Nu(),s=X(a);{var c=h=>{var f=ae(),g=$(f);Qe(g,()=>t.children),F(h,f)};ve(s,h=>{t.children&&h(c)})}Y(a),F(x,a)}class Ru{#e=ne(null);get layerId(){return u(this.#e)}set layerId(t){K(this.#e,t,!0)}#t=ne($e(new $t));get selectedAreaIds(){return u(this.#t)}set selectedAreaIds(t){K(this.#t,t,!0)}setLayerId(t){this.layerId!==t&&(this.layerId=t,this.selectedAreaIds.clear())}addSelectedArea(t){this.selectedAreaIds.add(t)}addSelectedAreas(t){t.forEach(a=>this.selectedAreaIds.add(a))}removeSelectedArea(t){this.selectedAreaIds.delete(t)}clearSelectedAreas(){this.selectedAreaIds.clear()}exportSnapshot(){return{layerId:this.layerId,selectedAreaIds:Array.from(this.selectedAreaIds)}}}class Lu{areaSelectionStore;layerViewProvider;#e=ne($e({layerView:null,areaHandles:new It}));get selectionViewState(){return u(this.#e)}set selectionViewState(t){K(this.#e,t,!0)}#t=ne(null);get lastAddedArea(){return u(this.#t)}set lastAddedArea(t){K(this.#t,t,!0)}#r=ne(null);get lastRemovedArea(){return u(this.#r)}set lastRemovedArea(t){K(this.#r,t,!0)}#n=ne(null);get currentHoveredArea(){return u(this.#n)}set currentHoveredArea(t){K(this.#n,t,!0)}fieldInfos=[];cachedNames=new It;constructor(t,a){this.areaSelectionStore=t,this.layerViewProvider=a,yo(()=>{Xe(()=>{if(!this.areaSelectionStore.layerId){this.resetSelectedLayerView();return}if(this.selectionViewState.layerView?.layer?.id===this.areaSelectionStore.layerId)return;const s=this.layerViewProvider.getLayerViewById(this.areaSelectionStore.layerId);s&&this.setSelectedLayerView(s)}),Xe(()=>{if(this.areaSelectionStore.selectedAreaIds.forEach(c=>{if(this.selectionViewState.areaHandles.has(c))return;const h=this.selectionViewState.layerView?.highlight(c);h&&this.addSelectedArea(c,h)}),this.selectionViewState.areaHandles.size===this.areaSelectionStore.selectedAreaIds.size)return;const s=new $t(this.selectionViewState.areaHandles.keys());this.areaSelectionStore.selectedAreaIds.forEach(c=>{s.has(c)||this.removeSelectedArea(c)})})})}setFieldInfos(t){console.log("[area-selection-interaction-store] setting field infos:",t),this.fieldInfos=t}setSelectedLayerView(t){this.selectionViewState?.layerView!==t&&(this.selectionViewState={layerView:t,areaHandles:new It},this.resetSelectedAreas())}clearSelectedLayerView(){this.selectionViewState.layerView!==null&&(this.resetSelectedAreas(),this.selectionViewState.layerView=null)}resetSelectedLayerView(){this.selectionViewState={layerView:null,areaHandles:new It},this.resetSelectedAreas()}resetSelectedAreas(){!this.selectionViewState.layerView&&this.selectionViewState.areaHandles.size===0||(this.selectionViewState.areaHandles.values().forEach(t=>{t.remove()}),this.selectionViewState.areaHandles.clear(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null)}addSelectedArea(t,a){if(!this.selectionViewState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const s={id:t,handle:a};this.lastAddedArea=s,this.selectionViewState.areaHandles.set(t,a),console.log(`[area-selection-interaction-store] added selected area: ${t}`,this.selectionViewState.areaHandles)}removeSelectedArea(t){if(!this.selectionViewState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const a=this.selectionViewState.areaHandles.get(t);if(!a){console.warn(`SelectedAreasStore: No handle found for area ID ${t}.`);return}this.lastRemovedArea={id:t,handle:a},a.remove(),this.selectionViewState.areaHandles.delete(t),console.log(`[area-selection-interaction-store] removed selected area: ${t}`)}async getAreaNamesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getNameFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer;let c=this.cachedNames.get(s.uid);c||(c=new It,this.cachedNames.set(s.uid,c));const h=new Array(t.length),f=new It,g=[];if(t.forEach((A,N)=>{f.set(A,N);const E=c.get(A);E!==void 0?h[N]=E:g.push(A)}),g.length===0)return h.map(A=>A??"");const P=s.objectIdField,w=await s.queryFeatures({objectIds:g,outFields:[a,P],returnGeometry:!1});for(const A of w.features){const N=A.attributes[P],E=A.attributes[a],q=f.get(N);q!==void 0&&(h[q]=E??"",c.set(N,E??""))}return h.map(A=>A??"")}async getAreaCodesById(t){if(!this.selectionViewState?.layerView)return[];const a=this.getCodeFieldForCurrentLayer();if(!a)return[];const s=this.selectionViewState.layerView.layer,c=s.objectIdField,h=await s.queryFeatures({objectIds:t,outFields:[a,c],returnGeometry:!1}),f=new Array(t.length);for(const g of h.features){const P=g.attributes[c],w=g.attributes[a],A=t.indexOf(P);A!==-1&&(f[A]=w??"")}return f.map(g=>g??"")}setHoveredArea(t,a){t!==this.currentHoveredArea?.id&&(this.currentHoveredArea&&this.clearHoveredArea(),console.log("[area-selection-interaction-store] setting hovered area:",t),this.currentHoveredArea={id:t,handle:a})}clearHoveredArea(){this.currentHoveredArea&&(console.log("[area-selection-interaction-store] clearing hovered area:",this.currentHoveredArea.id),this.currentHoveredArea?.handle.remove(),this.currentHoveredArea=null)}getNameFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.nameField;return t||(console.warn(`SelectedAreasStore: No name field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}getCodeFieldForCurrentLayer(){if(!this.selectionViewState||!this.selectionViewState.layerView||!this.selectionViewState.layerView.layer)return null;const t=this.fieldInfos.find(a=>a.layerName===this.selectionViewState?.layerView?.layer?.title)?.codeField;return t||(console.warn(`SelectedAreasStore: No code field configured for layer ${this.selectionViewState.layerView.layer.title}`,this.fieldInfos),null)}clearSelections(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,console.log("[area-selection-store] selections cleared.")}cleanup(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,this.cachedNames.clear(),this.fieldInfos=[],console.log("[area-selection-store] cleaned up.")}}const Vu=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];class ju{#e;constructor(t){if(!t)throw new Error("UprnDownloadService endpoints configuration is required");if(!t.baseUrl||!t.healthRoute||!t.requestJobRoute||!t.requestJobStatusesRoute||!t.getAreaSelectionLimitsRoute||!t.fetchDownloadRoute)throw new Error("UprnDownloadService endpoints configuration is incomplete");this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async requestJob(t){try{console.log("[uprn-download-service] requesting job with request:",t);const a=`${this.#e.baseUrl}${this.#e.requestJobRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to request job:",s.statusText,"request:",JSON.stringify(t));return}return await s.json()}catch(a){console.error("Error requesting job:",a);return}}async requestJobStatuses(t){try{const a=`${this.#e.baseUrl}${this.#e.requestJobStatusesRoute}`,s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){console.error("Failed to get job statuses:",s.statusText);return}return await s.json()}catch(a){console.error("Error getting job statuses:",a);return}}async getSelectionAreaLimits(){try{const t=`${this.#e.baseUrl}${this.#e.getAreaSelectionLimitsRoute}`,a=await fetch(t);if(!a.ok){console.error("Failed to get area selection limits:",a.statusText);return}return await a.json()}catch(t){console.error("Error getting selection area limits:",t);return}}getDownloadUrl(t){const a=this.#e.baseUrl.replace(/\/+$/,""),s=this.#e.fetchDownloadRoute.replace(/\/+$/,"");return`${a}${s}/${encodeURIComponent(t)}`}}class Hu{#e;constructor(t){this.#e=t}async getHealth(){try{const t=`${this.#e.baseUrl}${this.#e.healthRoute}`,a=await fetch(t);return a.ok?(await a.json()).status==="ok":!1}catch(t){return console.error("Health check failed:",t),!1}}async chat(t){try{const a=`${this.#e.baseUrl}${this.#e.chatRoute}`,c=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!c.ok){console.error("Failed to send chat query:",c.statusText);return}return await c.json()}catch(a){console.error("Error sending chat query:",a);return}}async chatStream(t,a){try{const s=`${this.#e.baseUrl}${this.#e.chatStreamRoute}`,h=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!h.ok)return console.error("Failed to start chat stream:",h.statusText),!1;const f=h.body?.getReader();if(!f)return console.error("No response body reader available"),!1;const g=new TextDecoder;let P=!1;for(;!P;){const{value:w,done:A}=await f.read();if(P=A,w){const N=g.decode(w,{stream:!P});a(N)}}return!0}catch(s){return console.error("Error during chat stream:",s),!1}}}const zu=Object.freeze({lod00World:{lod:0,scale:591657527591555e-6},lod01World:{lod:1,scale:295828763795777e-6},lod02World:{lod:2,scale:147914381897889e-6},lod03Continent:{lod:3,scale:73957190948944e-6},lod04Continent:{lod:4,scale:36978595474472e-6},lod05Countries:{lod:5,scale:18489297737236e-6},lod06Country:{lod:6,scale:9244648868618e-6},lod07StatesProvinces:{lod:7,scale:4622324434309e-6},lod08Counties:{lod:8,scale:2311162217155e-6},lod09Counties:{lod:9,scale:1155581108577e-6},lod10Country:{lod:10,scale:577790.554289},lod11MetropolitanArea:{lod:11,scale:288895.277144},lod12Cities:{lod:12,scale:144447.638572},lod13City:{lod:13,scale:72223.819286},lod14Town:{lod:14,scale:36111.909643},lod15Neighborhood:{lod:15,scale:18055.954822},lod16Streets:{lod:16,scale:9027.977411},lod17CityBlock:{lod:17,scale:4513.988705},lod18Buildings:{lod:18,scale:2256.994353},lod19Building:{lod:19,scale:1128.497176},lod20Houses:{lod:20,scale:564.248588},lod21Houses:{lod:21,scale:282.124294},lod22Houses:{lod:22,scale:141.062147},lod23HouseProperty:{lod:23,scale:70.5310735}});class Ku{#e=null;#t=!1;async init(t){this.#t||(await this.#r(t),this.#t=!0)}async#r(t){const s=await(await fetch(t)).json();this.#e=s}doesFieldHaveCustomRenderer(t,a){this.#u();const s=this.#e.FeatureLayers.find(f=>f.Name===t.title);if(!s)return!1;const c=this.#e.Fields.find(f=>f.FeatureLayerId===s.Id&&f.Name===a);return c?!!this.#e.CustomRenderers_Fields.find(f=>f.FieldId===c.Id):!1}getAllFieldsWithCustomRenderers(t){this.#u();const a=this.#e.FeatureLayers.find(h=>h.Name===t.title);if(!a)return[];const s=this.#e.Fields.filter(h=>h.FeatureLayerId===a.Id),c=[];for(const h of s)this.#e.CustomRenderers_Fields.some(g=>g.FieldId===h.Id)&&c.push(h.Name);return c}async applyCustomRenderer(t,a){this.#u();const s=this.#e.FeatureLayers.find(A=>A.Name===t.title);if(!s)return;const c=this.#e.Fields.find(A=>A.FeatureLayerId===s.Id&&A.Name===a);if(!c){console.warn(`[custom-renderer-service] could not find the field ${a} for feature layer id ${s.Id}`);return}const h=this.#e.CustomRenderers_Fields.find(A=>A.FieldId===c.Id);if(!h){console.warn(`[custom-renderer-service] could not find a custom renderer field for field ${a} in feature layer id ${s.Id}`);return}const f=this.#e.CustomRenderers.find(A=>A.Id===h.CustomRendererId);if(!f)throw new Error(`Could not find a custom renderer with the id ${h.CustomRendererId}`);const g=await this.getRendererClassBreaks(f.ClassBreaksGroupId.toString()),P=await this.getRendererSymbols(f.SymbolsId.toString()),w=this.#a(f.CustomRendererType,P,g,[],a);t.renderer=w,this.setCustomOutlines(t,f.LodsGroupId)}async setCustomOutlines(t,a){const s=this.#e.CustomRenderers_Lods.filter(f=>f.GroupId===a).sort((f,g)=>f.Lod-g.Lod);if(s.length===0){console.warn(`No LODs found for LODs group id ${a}`);return}const c=[],h=Object.values(zu);s.forEach(f=>{const g=f.OutlineWidth,P=f.Lod,w=this.#n(h,P)-1;c.push({size:g,value:h[w].scale})}),(t.renderer instanceof ia||t.renderer instanceof aa)&&this.#l(t.renderer,c)}async getRendererClassBreaks(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_ClassBreaks.filter(c=>c.GroupId===a).sort((c,h)=>c.Order-h.Order);if(s.length===0)throw new Error(`Could not find a group with the id ${t}`);return s}async getRendererSymbols(t){const a=parseInt(t,10),s=this.#e.CustomRenderers_Symbols.find(f=>f.Id===a);if(!s)throw new Error(`Could not find a symbol with the id ${t}`);const c=this.#e.CustomRenderers_Symbols_Appearances.filter(f=>f.SymbolsId===a).sort((f,g)=>f.Order-g.Order);return{...s,Appearances:c}}#n(t,a){const s=t.findIndex(c=>c.lod===a);return s===-1?0:s<23?s+1:s}#a(t,a,s,c,h){switch(t){case 1:return this.#s(a,c);case 2:return this.#i(h,a,s,c);default:throw new Error(`Unknown renderer type: ${t}`)}}#i(t,a,s,c){const h="ClassMinValue",f="ClassMaxValue",g="SymbolColor",P="OutlineColor",w="OutlineWidth",A=a.Appearances.length,N=new ia({field:t});for(let E=0;E<A;E++){const q=s[E][h],L=s[E][f],M=a.Appearances[E][g],H=a.Appearances[E][P],R=a.Appearances[E][w];N.addClassBreakInfo({minValue:q,maxValue:L,symbol:new oa({color:wn.fromHex(M),outline:new sa({color:wn.fromHex(H),width:R})})})}return this.#l(N,c),N}#s(t,a){const s="SymbolColor",c="OutlineColor",h="OutlineWidth",f=t.Appearances[0][s],g=t.Appearances[0][c],P=t.Appearances[0][h],w=new aa({symbol:new oa({color:wn.fromHex(f),outline:new sa({color:wn.fromHex(g),width:P})})});return this.#l(w,a),w}#l(t,a){t.visualVariables=[{type:"size",target:"outline",valueExpression:"$view.scale",stops:a}]}#u(){if(!this.#t)throw new Error("CustomRendererService is not initialized");if(!this.#e)throw new Error("Data is not loaded")}}var Bu=oe('<div class="flex w-full items-center justify-between"><div class="font-medium">Chat</div> <div class="flex gap-1"><!> <!></div></div>'),qu=oe("<!> <!>",1),Uu=oe("<div><!></div>");function $u(x,t){Re(t,!0);const a=Me(t,"isOpenedOnInit",3,!1);let s=ne(!1),c=ne($e(a())),h=ne(!1),f=ne(void 0),g="300px",P="45px";Xe(()=>{u(s)||!u(f)||(u(c)&&(u(f).style.height=g),K(s,!0))});function w(){u(f)&&(K(c,!u(c)),K(h,!1),u(c)?(P=u(f).style.height,u(f).style.height=g):u(f).style.height=P)}function A(){u(f)&&(K(h,!u(h)),u(h)?(g=u(f).style.height,u(f).style.height="100%"):u(f).style.height=g)}var N=Uu(),E=X(N);Te(E,()=>Pn,(q,L)=>{L(q,{class:"h-full w-full gap-0 rounded-none py-0 pt-0 pb-0",children:(M,H)=>{var R=qu(),z=$(R);Te(z,()=>ls,(le,re)=>{re(le,{class:"pt-2",children:(se,ge)=>{var Oe=Bu(),ue=fe(X(Oe),2),be=X(ue);{var Ce=Ee=>{Pt(Ee,{class:"size-7",onclick:A,children:(Ke,We)=>{var Ie=ae(),Ve=$(Ie);{var me=pe=>{Ml(pe,{})},Fe=pe=>{Nl(pe,{})};ve(Ve,pe=>{u(h)?pe(me):pe(Fe,!1)})}F(Ke,Ie)},$$slots:{default:!0}})};ve(be,Ee=>{u(c)&&Ee(Ce)})}var we=fe(be,2);Pt(we,{class:"size-7",onclick:w,children:(Ee,Ke)=>{var We=ae(),Ie=$(We);{var Ve=Fe=>{Dl(Fe,{})},me=Fe=>{vs(Fe,{})};ve(Ie,Fe=>{u(c)?Fe(me,!1):Fe(Ve)})}F(Ee,We)},$$slots:{default:!0}}),Y(ue),Y(Oe),F(se,Oe)},$$slots:{default:!0}})});var j=fe(z,2);{var G=le=>{var re=ae(),se=$(re);Te(se,()=>On,(ge,Oe)=>{Oe(ge,{class:"h-full min-h-[10px] w-full p-0",children:(ue,be)=>{var Ce=ae(),we=$(Ce);Qe(we,()=>t.children??Je),F(ue,Ce)},$$slots:{default:!0}})}),F(le,re)};ve(j,le=>{u(c)&&le(G)})}F(M,R)},$$slots:{default:!0}})}),Y(N),Vt(N,q=>K(f,q),()=>u(f)),F(x,N),Le()}var Gu=oe("<!> <!>",1),Wu=oe('<p class="p-4 text-center text-sm text-gray-500">Download service is not available.</p>'),Yu=oe("<div><!></div> <div><!></div> <div><!></div> <div><!></div>",1),Ju=oe("<div><!></div>"),Qu=oe('<p class="p-4 text-center text-sm text-gray-500">AI UPRN Chatbot service is not available.</p>'),Xu=oe('<div class="relative flex h-full w-full min-w-0 flex-col overflow-visible"><!> <!> <!> <!></div>'),Zu=oe("<!> <!> <!> <!>",1);function Zc(x,t){Re(t,!0);let a,s,c;const h=$e(new _l),f=$e(new wl);let g=ne("define-areas"),P=$e(new Ru),w=ne(null),A=ne(null),N=ne(void 0),E=ne(void 0),q=ne(void 0),L=ne(void 0),M=ne(void 0),H=ne(!1),R=ne(!1),z=ne($e(new Set)),j=ne($e(new Set)),G=ne(!0),le=$e(qe.LEFT);$e(qe.BOTTOM);let re=ne($e([])),se=ne($e(typeof window<"u"?window.innerWidth:1280)),ge=he(()=>ue(u(re),pe=>pe.originalSize)),Oe=he(()=>ue(u(re),pe=>pe.minSize));function ue(pe,Ue){if(!pe||pe.length===0)return;const ke=[...pe].sort((de,_e)=>_e.breakpoint-de.breakpoint).find(de=>u(se)>=de.breakpoint);return ke?Ue(ke):"0"}function be(){K(G,!u(G))}function Ce(pe){K(g,pe,!0)}function we(){K(g,"downloads")}function Ee(){P.clearSelectedAreas(),Ct.clearSelections(),a?.clearSelections(),s?.clearSelections(),Xs()}Ir(async()=>{K(q,new Ku,!0),await u(q).init(`${us}/custom-renderers.json`),console.log("[uprn-2/page] CustomRendererService initialized");const pe=await To(),[{default:Ue}]=await Promise.all([Kr(()=>import("../chunks/T_8yv_P1.js").then(ke=>ke.a3),__vite__mapDeps([35,1,2,3,5,36,19,37,17,6,7,38,27,39,15,16,40,8,9,20,41,42,12,28,43,44,45,21,46,47,48,0,4,10,11,13,14,18,22,23,24,25,26,29,30,31,32,33,34,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88]),import.meta.url)]);K(A,new Ue,!0),K(w,new Lu(P,new Da(u(A))),!0),K(j,new Set((pe.serviceUprn2Config.selectionLayersNameFields||[]).map(ke=>ke.layerName)),!0),u(w).setFieldInfos(pe.serviceUprn2Config.selectionLayersNameFields||[]),K(re,pe.serviceUprn2Config.mainSidebarSizes||[],!0),K(N,new ga(pe.serviceUprn2Config.dataSelectionTreeviewConfig),!0),K(E,new ga(pe.serviceUprn2Config.areaSelectionTreeviewConfig),!0),(async()=>{const ke=pe.serviceUprn2Config.uprnDownloadServiceEndpoints,de=pe.serviceUprn2Config.aiUprnChatbotServiceEndpoints;K(L,new ju(ke),!0),K(M,new Hu(de),!0),K(H,await u(L).getHealth(),!0),u(H)?console.log("[uprn-2/page] UPRN Download Service is available"):console.warn("[uprn-2/page] UPRN Download Service is NOT available"),K(R,await u(M).getHealth(),!0),u(R)?console.log("[uprn-2/page] AI UPRN Chatbot Service is available"):console.warn("[uprn-2/page] AI UPRN Chatbot Service is NOT available")})(),K(z,new Set(pe.serviceUprn2Config.dataSelectionTreeviewConfig?.fieldsToHide||[]),!0),await h.initializeAsync({portalUrl:pe.serviceUprn2Config.portalUrl,itemId:pe.serviceUprn2Config.portalItemId||"",proxy:pe.serviceUprn2Config.proxy})}),Ir(()=>{const pe=()=>{K(se,window.innerWidth,!0)};return window.addEventListener("resize",pe),()=>{window.removeEventListener("resize",pe)}}),ba(()=>{Ct.cleanup()});var Ke=Zu(),We=$(Ke);Jo(We,{});var Ie=fe(We,2);$l(Ie,{get fieldFilterMenuStore(){return f},get fieldsToHide(){return u(z)}});var Ve=fe(Ie,2);{var me=pe=>{var Ue=Gu(),Ne=$(Ue);Cs(Ne,{get areaSelectionInteractionStore(){return u(w)}});var ke=fe(Ne,2);ks(ke,{get areaSelectionInteractionStore(){return u(w)}}),F(pe,Ue)};ve(Ve,pe=>{u(w)&&pe(me)})}var Fe=fe(Ve,2);{const pe=Ne=>{var ke=Xu(),de=X(ke);Te(de,()=>Du,(Z,at)=>{at(Z,{children:(Ge,ye)=>{Iu(Ge,{get value(){return u(g)},get triggers(){return Vu},onValueChange:Ce})},$$slots:{default:!0}})});var _e=fe(de,2);Te(_e,()=>Eu,(Z,at)=>{at(Z,{children:(Ge,ye)=>{var Be=Yu(),lt=$(Be),He=X(lt);xn(He,{children:(pt,Et)=>{var gt=ae(),Ot=$(gt);{var vt=rt=>{Vt(au(rt,{get webMap(){return h.data},get treeviewConfigStore(){return u(E)},get areaSelectionStore(){return P}}),mt=>a=mt,()=>a)};ve(Ot,rt=>{h.isLoaded&&rt(vt)})}F(pt,gt)}}),Y(lt);var Ze=fe(lt,2),At=X(Ze);xn(At,{children:(pt,Et)=>{var gt=ae(),Ot=$(gt);{var vt=rt=>{{let mt=he(()=>c?.getLayerViewProvider());Vt(gu(rt,{get webMap(){return h.data},get layerViewProvider(){return u(mt)},get treeviewConfigStore(){return u(N)},get customRendererService(){return u(q)},get fieldFilterMenuStore(){return f}}),Rt=>s=Rt,()=>s)}};ve(Ot,rt=>{h.isLoaded&&rt(vt)})}F(pt,gt)}}),Y(Ze);var ht=fe(Ze,2),et=X(ht);xn(et,{children:(pt,Et)=>{var gt=ae(),Ot=$(gt);{var vt=rt=>{El(rt,{get webMapStore(){return h},get areaSelectionInteractionStore(){return u(w)},get dataSelectionTreeviewConfig(){return u(N)},get fieldFilterMenuStore(){return f}})};ve(Ot,rt=>{u(w)&&rt(vt)})}F(pt,gt)}}),Y(ht);var ot=fe(ht,2),tt=X(ot);xn(tt,{children:(pt,Et)=>{var gt=ae(),Ot=$(gt);{var vt=mt=>{var Rt=Wu();F(mt,Rt)},rt=mt=>{cl(mt,{get webMapStore(){return h},get uprnDownloadService(){return u(L)},get fieldsToHide(){return u(z)}})};ve(Ot,mt=>{!u(L)||!u(H)?mt(vt):mt(rt,!1)})}F(pt,gt)}}),Y(ot),dt(()=>{lt.hidden=u(g)!=="define-areas",Ze.hidden=u(g)!=="select-data",ht.hidden=u(g)!=="export",ot.hidden=u(g)!=="downloads"}),F(Ge,Be)},$$slots:{default:!0}})});var je=fe(_e,2);Te(je,()=>Mu,(Z,at)=>{at(Z,{children:(Ge,ye)=>{var Be=Ju(),lt=X(Be);{var He=Ze=>{bl(Ze,{onExportSuccess:we,clearSelections:Ee,get areaSelectionInteractionStore(){return u(w)}})};ve(lt,Ze=>{u(w)&&Ze(He)})}Y(Be),dt(()=>Be.hidden=u(g)!=="export"),F(Ge,Be)},$$slots:{default:!0}})});var ft=fe(je,2);$u(ft,{isOpenedOnInit:!0,children:(Z,at)=>{var Ge=ae(),ye=$(Ge);{var Be=He=>{var Ze=Qu();F(He,Ze)},lt=He=>{$s(He,{get aiUprnChatbotService(){return u(M)}})};ve(ye,He=>{!u(M)||!u(R)?He(Be):He(lt,!1)})}F(Z,Ge)},$$slots:{default:!0}}),Y(ke),F(Ne,ke)},Ue=Ne=>{var ke=ae(),de=$(ke);{var _e=je=>{Vt(bu(je,{get webMap(){return h.data},get mapView(){return u(A)},get areaSelectionInteractionStore(){return u(w)},get interactableLayers(){return u(j)}}),ft=>c=ft,()=>c)};ve(de,je=>{u(w)&&je(_e)})}F(Ne,ke)};Te(Fe,()=>Ou,(Ne,ke)=>{ke(Ne,{get isOpen(){return u(G)},onToggle:be,get position(){return le},get originalSize(){return u(ge)},get minSize(){return u(Oe)},sidebarContent:pe,mainContent:Ue,$$slots:{sidebarContent:!0,mainContent:!0}})})}F(x,Ke),Le()}export{Zc as component};
