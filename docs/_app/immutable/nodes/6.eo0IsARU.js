const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/huXfT4GN.js","../chunks/DtUpcSZL.js","../chunks/DHq0rblm.js","../chunks/BfhsIlKo.js","../chunks/D9Z9MdNV.js","../chunks/Bwh84WyQ.js","../chunks/BgvLO-3W.js","../chunks/Bo-Ws7j2.js","../chunks/qs4PuqLF.js","../chunks/BPWMfk3L.js","../chunks/B5FfC49X.js","../chunks/Cw1pwOU3.js","../chunks/Ab6_LQF8.js","../chunks/BzdAE8IO.js","../chunks/C1i-M2aP.js","../chunks/DpT7IovD.js","../chunks/DwaPv9Xz.js","../chunks/DxjcXvGa.js","../chunks/CU7c9CMG.js","../chunks/129gMYlb.js","../chunks/v8BQWUBe.js","../chunks/b9L_h0zx.js","../chunks/D6wORzA5.js","../chunks/D6KPPgz5.js","../chunks/BsbEhHPI.js","../chunks/1paoQEYR.js","../chunks/CbQpSWi7.js","../chunks/Cl5lrJ4c.js","../chunks/DS3I1QGm.js","../chunks/MtSiOt06.js","../chunks/C0wm8_Yw.js","../chunks/C4HJhmWz.js","../chunks/BL_xGwnO.js","../chunks/CJDxRR2q.js","../chunks/Djp3mnm5.js","../chunks/5FB5fp0p.js","../chunks/DQOJ18NT.js","../chunks/BXRubaki.js","../chunks/CO7wCLMN.js","../chunks/BcYzNU04.js","../chunks/EzLf78vY.js","../chunks/DJcANb4D.js","../chunks/CYIjw6v6.js","../chunks/BHJeQD3W.js","../chunks/CFcsbxo9.js","../chunks/9YvG7tFv.js","../chunks/0RWeYtrz.js","../chunks/D63lrzPI.js","../chunks/aQeO9QTD.js","../chunks/thXDNXE5.js","../chunks/C8mSainR.js","../chunks/BMX0GFJS.js","../chunks/DoXK2rGs.js","../chunks/Ctm-fIfE.js","../chunks/CL2NbQte.js","../chunks/CpiZ4wIO.js","../chunks/D2J_WLS8.js","../chunks/BASHandG.js","../chunks/8QcYoK8I.js","../chunks/Bm1xQlw6.js","../chunks/XNewhKeX.js","../chunks/B7w94aGg.js","../chunks/NPoLgU3x.js","../chunks/C5CzMsLd.js","../chunks/deFn64y_.js","../chunks/C1lBXX5P.js","../chunks/BAf2E7HJ.js","../chunks/Y387DGzA.js","../chunks/CFIXdoHM.js","../chunks/JBhdCoOi.js","../chunks/CQ7_HgKN.js","../chunks/CHZSYXvn.js","../chunks/BML_M8sQ.js","../chunks/Dnb1jllm.js","../chunks/DfNP466Y.js","../chunks/eWXUghTg.js","../chunks/BE7embxS.js","../chunks/B2pz97Mw.js","../chunks/iS9MPUWn.js","../chunks/GKolV7NZ.js","../chunks/B7so6aiN.js","../chunks/D_jxB2M9.js","../chunks/C70Wcz7U.js","../chunks/Cp7iBt0A.js","../chunks/f7qLKxBD.js","../chunks/4c7MyKAz.js","../chunks/DbuHlGOH.js","../chunks/5Hu3Tj1O.js","../chunks/BDRwM1Gy.js","../chunks/VMSlSy0z.js","../chunks/DzdGX2zJ.js","../chunks/BBxgwA0n.js","../chunks/lYnSLSOW.js","../chunks/C9yb1cMp.js","../chunks/BlVJDMPv.js","../chunks/DKdVR8l2.js","../chunks/DZ6eIUka.js","../chunks/n8j1sCwN.js","../chunks/L_yqRdqL.js","../chunks/BPsRHx0w.js","../chunks/CJzbRXVH.js","../chunks/DVkWVZrr.js","../chunks/Cbt3oAQ3.js","../chunks/C6-4EbnJ.js","../chunks/DdaJqb9x.js","../chunks/BQ9eRUBJ.js","../chunks/yMNjucUt.js","../chunks/DYWnz87V.js","../chunks/dDFQnWwh.js","../chunks/TngxyDh1.js","../chunks/6Dn7lewd.js","../chunks/DfJNYC5A.js","../chunks/zTkdiH1w.js","../chunks/KcazVFlU.js","../chunks/CYsUaMUi.js","../chunks/Bu2dLfoR.js","../chunks/uNqxL_S-.js","../chunks/BVskHUjz.js","../chunks/iUYx5jDy.js","../chunks/B5kADfHL.js","../chunks/CfrNlpsM.js","../chunks/DdSLmJ2d.js","../chunks/BS3H3l-F.js","../chunks/DCdj6Lab.js","../chunks/BXfupK_G.js","../chunks/BkQcsSCB.js","../chunks/DPb6J-GU.js","../chunks/Di4P92Bn.js","../chunks/ChlOomCl.js","../chunks/B8TggrAl.js","../chunks/BH-QLa3i.js","../chunks/Bt_bao6a.js","../chunks/CpOLeWL8.js","../chunks/Cy_9-Fvw.js","../chunks/CEiIohNf.js","../chunks/CNvMJFKk.js","../chunks/DqlQ8lc_.js","../chunks/CZQNMlVz.js","../chunks/uuiBM66S.js","../chunks/VStmm7cP.js","../chunks/BqnxlNxI.js","../chunks/BXAqi3_T.js","../chunks/D8UNv0pX.js","../chunks/DsHDw-MJ.js","../chunks/CISklr1W.js","../chunks/CWhDOlk9.js","../chunks/DZd6gJy7.js","../chunks/DxShpBdY.js","../chunks/C8BmVxiO.js","../chunks/NT2Bw9Xs.js","../chunks/NdScq7k1.js","../chunks/BNxyGXCQ.js","../chunks/DQ8jsygj.js","../chunks/Chk7YAAL.js","../chunks/D0t3l1UW.js","../chunks/Cgb6qxNH.js","../chunks/CQSPGXrE.js","../chunks/BHlmUX6D.js","../chunks/QQC62dOK.js","../chunks/DJa1hCZQ.js","../chunks/BM6Wwexr.js","../chunks/DKpmsPfl.js","../chunks/Sc2kLiW3.js","../chunks/B55yQsaB.js","../chunks/B1N-tmtC.js","../chunks/CASyCajO.js","../chunks/BiphejqT.js","../chunks/CWKudsnk.js","../chunks/pDuGEAnG.js","../chunks/CmGkajPk.js","../chunks/BrScpkSj.js","../chunks/rxpTDz6e.js"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{o as Cn,a as Sr}from"../chunks/CxiazAcr.js";import{R as Qa,E as Xa,be as Za,bf as Ja,$ as eo,B as to,bg as no,bh as ro,bi as io,a4 as fa,as as ao,a1 as oo,b as tt,aH as he,M as u,ah as $,b5 as so,p as Re,e as pe,g as ee,a as D,d as je,f as le,c as W,r as V,aG as se,am as Ue,u as at,Q as nt,a9 as ce,J as lo,n as rn,aI as vn}from"../chunks/CWzSNr3h.js";import{p as De,i as me,r as Kt,l as Bn,s as Et,a as uo,b as co}from"../chunks/BOba6W4Q.js";import{c as Ne}from"../chunks/BycNIBmV.js";import{e as fo,s as $e,a as gt}from"../chunks/Dho9EcyP.js";import{a as xr,e as tn,s as wr,d as Jt,b as ho}from"../chunks/CQdF8eTz.js";import{I as Vn,l as qn,d as vi,c as ha,s as vo,X as po,e as go,f as mo,g as yo,h as bo,i as wo,j as _o,C as So,S as xo,k as ko}from"../chunks/ZWUE82vq.js";import{C as Co,D as Io,l as Ao,o as Oo,z as Po,b as pr,B as To,p as Ht,X as Eo,Y as Mo,c as Do}from"../chunks/B5Fheo1z.js";import{t as nn,k as Lo,l as Fo,m as No,n as Ho,L as zo,o as Ko,p as Ro,S as zn,h as jo,i as Bo,C as Qi,j as Vo,I as qo,G as Xi,F as Zi,b as Uo,O as va,a as Go,d as pa,s as Wo,M as $o,V as Ji,f as Yo,e as Qo,g as Xo,u as Zo,c as gr,q as Jo,r as es}from"../chunks/DCuI7SLQ.js";import{I as pi,a as zt,i as In}from"../chunks/D6GcqUU2.js";import{g as ea,d as kr}from"../chunks/YplIrDIO.js";import{b as Tt}from"../chunks/emMFXzXa.js";import{c as Cr,B as Pt}from"../chunks/Cj4LVy1K.js";import{I as ts}from"../chunks/CHaftLxS.js";import{h as jn}from"../chunks/BPsepCCp.js";import{_ as en}from"../chunks/D9Z9MdNV.js";import"../chunks/5TQB5ubf.js";const ns=()=>performance.now(),qt={tick:k=>requestAnimationFrame(k),now:()=>ns(),tasks:new Set};function ga(){const k=qt.now();qt.tasks.forEach(n=>{n.c(k)||(qt.tasks.delete(n),n.f())}),qt.tasks.size!==0&&qt.tick(ga)}function rs(k){let n;return qt.tasks.size===0&&qt.tick(ga),{promise:new Promise(s=>{qt.tasks.add(n={c:k,f:s})}),abort(){qt.tasks.delete(n)}}}function mr(k,n){fa(()=>{k.dispatchEvent(new CustomEvent(n))})}function is(k){if(k==="float")return"cssFloat";if(k==="offset")return"cssOffset";if(k.startsWith("--"))return k;const n=k.split("-");return n.length===1?n[0]:n[0]+n.slice(1).map(s=>s[0].toUpperCase()+s.slice(1)).join("")}function ta(k){const n={},s=k.split(";");for(const l of s){const[d,h]=l.split(":");if(!d||h===void 0)break;const p=is(d.trim());n[p]=h.trim()}return n}const as=k=>k;function na(k,n,s,l){var d=(k&ro)!==0,h=(k&io)!==0,p=d&&h,I=(k&no)!==0,M=p?"both":d?"in":"out",O,P=n.inert,F=n.style.overflow,z,N;function T(){return fa(()=>O??=s()(n,l?.()??{},{direction:M}))}var L={is_global:I,in(){if(n.inert=P,!d){N?.abort(),N?.reset?.();return}h||z?.abort(),mr(n,"introstart"),z=li(n,T(),N,1,()=>{mr(n,"introend"),z?.abort(),z=O=void 0,n.style.overflow=F})},out(Z){if(!h){Z?.(),O=void 0;return}n.inert=!0,mr(n,"outrostart"),N=li(n,T(),z,0,()=>{mr(n,"outroend"),Z?.()})},stop:()=>{z?.abort(),N?.abort()}},J=Qa;if((J.transitions??=[]).push(L),d&&fo){var U=I;if(!U){for(var ne=J.parent;ne&&(ne.f&Xa)!==0;)for(;(ne=ne.parent)&&(ne.f&Za)===0;);U=!ne||(ne.f&Ja)!==0}U&&eo(()=>{to(()=>L.in())})}}function li(k,n,s,l,d){var h=l===1;if(ao(n)){var p,I=!1;return oo(()=>{if(!I){var J=n({direction:h?"in":"out"});p=li(k,J,s,l,d)}}),{abort:()=>{I=!0,p?.abort()},deactivate:()=>p.deactivate(),reset:()=>p.reset(),t:()=>p.t()}}if(s?.deactivate(),!n?.duration)return d(),{abort:tt,deactivate:tt,reset:tt,t:()=>l};const{delay:M=0,css:O,tick:P,easing:F=as}=n;var z=[];if(h&&s===void 0&&(P&&P(0,1),O)){var N=ta(O(0,1));z.push(N,N)}var T=()=>1-l,L=k.animate(z,{duration:M,fill:"forwards"});return L.onfinish=()=>{L.cancel();var J=s?.t()??1-l;s?.abort();var U=l-J,ne=n.duration*Math.abs(U),Z=[];if(ne>0){var R=!1;if(O)for(var de=Math.ceil(ne/16.666666666666668),te=0;te<=de;te+=1){var oe=J+U*F(te/de),ye=ta(O(oe,1-oe));Z.push(ye),R||=ye.overflow==="hidden"}R&&(k.style.overflow="hidden"),T=()=>{var Ie=L.currentTime;return J+U*F(Ie/ne)},P&&rs(()=>{if(L.playState!=="running")return!1;var Ie=T();return P(Ie,1-Ie),!0})}L=k.animate(Z,{duration:ne,fill:"forwards"}),L.onfinish=()=>{T=()=>l,P?.(l,1-l),d()}},{abort:()=>{L&&(L.cancel(),L.effect=null,L.onfinish=tt)},deactivate:()=>{d=tt},reset:()=>{l===0&&P?.(1,0)},t:()=>T()}}const os=Oo({component:"avatar",parts:["root","image","fallback"]}),ss=new Co("Avatar.Root");class gi{static create(n){return ss.set(new gi(n))}opts;domContext;attachment;constructor(n){this.opts=n,this.domContext=new Io(this.opts.ref),this.loadImage=this.loadImage.bind(this),this.attachment=Ao(this.opts.ref)}loadImage(n,s,l){if(this.opts.loadingStatus.current==="loaded")return;let d;const h=new Image;return h.src=n,s!==void 0&&(h.crossOrigin=s),l&&(h.referrerPolicy=l),this.opts.loadingStatus.current="loading",h.onload=()=>{d=this.domContext.setTimeout(()=>{this.opts.loadingStatus.current="loaded"},this.opts.delayMs.current)},h.onerror=()=>{this.opts.loadingStatus.current="error"},()=>{d&&this.domContext.clearTimeout(d)}}#e=he(()=>({id:this.opts.id.current,[os.root]:"","data-status":this.opts.loadingStatus.current,...this.attachment}));get props(){return u(this.#e)}set props(n){$(this.#e,n)}}var ls=le("<div><!></div>");function us(k,n){const s=so();Re(n,!0);let l=De(n,"delayMs",3,0),d=De(n,"loadingStatus",15,"loading"),h=De(n,"id",19,()=>Po(s)),p=De(n,"ref",15,null),I=Kt(n,["$$slots","$$events","$$legacy","delayMs","loadingStatus","onLoadingStatusChange","child","children","id","ref"]);const M=gi.create({delayMs:pr(()=>l()),loadingStatus:pr(()=>d(),T=>{d()!==T&&(d(T),n.onLoadingStatusChange?.(T))}),id:pr(()=>h()),ref:pr(()=>p(),T=>p(T))}),O=he(()=>To(I,M.props));var P=pe(),F=ee(P);{var z=T=>{var L=pe(),J=ee(L);$e(J,()=>n.child,()=>({props:u(O)})),D(T,L)},N=T=>{var L=ls();xr(L,()=>({...u(O)}));var J=W(L);$e(J,()=>n.children??tt),V(L),D(T,L)};me(F,T=>{n.child?T(z):T(N,!1)})}D(k,P),je()}function cs(k,n){const s=Bn(n,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const l=[["path",{d:"M12 8V4H8"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2"}],["path",{d:"M2 14h2"}],["path",{d:"M20 14h2"}],["path",{d:"M15 13v2"}],["path",{d:"M9 13v2"}]];Vn(k,Et({name:"bot"},()=>s,{get iconNode(){return l},children:(d,h)=>{var p=pe(),I=ee(p);qn(I,n,"default",{}),D(d,p)},$$slots:{default:!0}}))}function ds(k,n){const s=Bn(n,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const l=[["path",{d:"m6 9 6 6 6-6"}]];Vn(k,Et({name:"chevron-down"},()=>s,{get iconNode(){return l},children:(d,h)=>{var p=pe(),I=ee(p);qn(I,n,"default",{}),D(d,p)},$$slots:{default:!0}}))}function fs(k,n){const s=Bn(n,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const l=[["path",{d:"m15 18-6-6 6-6"}]];Vn(k,Et({name:"chevron-left"},()=>s,{get iconNode(){return l},children:(d,h)=>{var p=pe(),I=ee(p);qn(I,n,"default",{}),D(d,p)},$$slots:{default:!0}}))}function hs(k,n){const s=Bn(n,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const l=[["path",{d:"m18 15-6-6-6 6"}]];Vn(k,Et({name:"chevron-up"},()=>s,{get iconNode(){return l},children:(d,h)=>{var p=pe(),I=ee(p);qn(I,n,"default",{}),D(d,p)},$$slots:{default:!0}}))}function vs(k,n){const s=Bn(n,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const l=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];Vn(k,Et({name:"menu"},()=>s,{get iconNode(){return l},children:(d,h)=>{var p=pe(),I=ee(p);qn(I,n,"default",{}),D(d,p)},$$slots:{default:!0}}))}function ps(k,n){Re(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let s=Kt(n,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];pi(k,Et({name:"arrow-down-to-line"},()=>s,{get iconNode(){return l},children:(d,h)=>{var p=pe(),I=ee(p);$e(I,()=>n.children??tt),D(d,p)},$$slots:{default:!0}})),je()}function gs(k,n){Re(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let s=Kt(n,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];pi(k,Et({name:"arrow-down"},()=>s,{get iconNode(){return l},children:(d,h)=>{var p=pe(),I=ee(p);$e(I,()=>n.children??tt),D(d,p)},$$slots:{default:!0}})),je()}function ms(k,n){Re(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let s=Kt(n,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];pi(k,Et({name:"send"},()=>s,{get iconNode(){return l},children:(d,h)=>{var p=pe(),I=ee(p);$e(I,()=>n.children??tt),D(d,p)},$$slots:{default:!0}})),je()}class ys{#e=se(Ue({featureLayerView:null,areaInfos:[]}));get layerHighlightState(){return u(this.#e)}set layerHighlightState(n){$(this.#e,n,!0)}#t=se(null);get lastAddedArea(){return u(this.#t)}set lastAddedArea(n){$(this.#t,n,!0)}#n=se(null);get lastRemovedArea(){return u(this.#n)}set lastRemovedArea(n){$(this.#n,n,!0)}#i=se(null);get currentHoveredArea(){return u(this.#i)}set currentHoveredArea(n){$(this.#i,n,!0)}#r=[];#a=new Ht;setNameFields(n){console.log("Setting name fields:",n),this.#r=n}setSelectedLayerView(n){this.layerHighlightState?.featureLayerView!==n&&(this.layerHighlightState&&this.layerHighlightState.areaInfos.forEach(s=>{s.handle.remove()}),this.layerHighlightState={featureLayerView:n,areaInfos:[]})}clearSelectedLayerView(){this.layerHighlightState.featureLayerView!==null&&(this.resetSelectedAreas(),this.layerHighlightState.featureLayerView=null)}resetSelectedAreas(){!this.layerHighlightState.featureLayerView&&this.layerHighlightState.areaInfos.length===0||(this.layerHighlightState&&this.layerHighlightState.areaInfos.forEach(n=>{n.handle.remove()}),this.layerHighlightState={featureLayerView:null,areaInfos:[]})}addSelectedArea(n,s){if(!this.layerHighlightState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const l={id:n,handle:s};this.layerHighlightState.areaInfos.push(l),this.lastAddedArea=l}removeSelectedArea(n){if(!this.layerHighlightState){console.warn("SelectedAreasStore: No feature layer view is set.");return}const s=this.layerHighlightState.areaInfos.findIndex(l=>l.id===n);s!==-1&&(this.lastRemovedArea={id:n,handle:this.layerHighlightState.areaInfos[s].handle},this.layerHighlightState.areaInfos[s].handle.remove(),this.layerHighlightState.areaInfos.splice(s,1))}async getAreaNamesById(n){if(!this.layerHighlightState?.featureLayerView)return[];const s=this.getNameFieldForCurrentLayer();if(!s)return[];const l=this.layerHighlightState.featureLayerView.layer;let d=this.#a.get(l.uid);d||(d=new Ht,this.#a.set(l.uid,d));const h=new Array(n.length),p=new Ht,I=[];if(n.forEach((P,F)=>{p.set(P,F);const z=d.get(P);z!==void 0?h[F]=z:I.push(P)}),I.length===0)return h.map(P=>P??"");const M=l.objectIdField,O=await l.queryFeatures({objectIds:I,outFields:[s,M],returnGeometry:!1});for(const P of O.features){const F=P.attributes[M],z=P.attributes[s],N=p.get(F);N!==void 0&&(h[N]=z??"",d.set(F,z??""))}return h.map(P=>P??"")}setHoveredArea(n,s){this.currentHoveredArea&&this.clearHoveredArea(),this.currentHoveredArea={id:n,handle:s}}clearHoveredArea(){this.currentHoveredArea&&(this.currentHoveredArea?.handle.remove(),this.currentHoveredArea=null)}getNameFieldForCurrentLayer(){if(!this.layerHighlightState||!this.layerHighlightState.featureLayerView||!this.layerHighlightState.featureLayerView.layer)return null;const n=this.#r.find(s=>s.layerName===this.layerHighlightState?.featureLayerView?.layer?.title)?.field;return n||(console.warn(`SelectedAreasStore: No name field configured for layer ${this.layerHighlightState.featureLayerView.layer.title}`,this.#r),null)}cleanup(){this.resetSelectedAreas(),this.clearHoveredArea(),this.lastAddedArea=null,this.lastRemovedArea=null,this.currentHoveredArea=null,this.#a.clear(),this.#r=[]}}const Ke=new ys;var bs=le('<p class="text-sm font-medium"> </p>'),ws=le('<div class="pointer-events-none fixed z-50 transition-opacity duration-200"><!></div>');function _s(k,n){Re(n,!0);let s=se(null),l=se(Ue({x:0,y:0})),d=0;const h=O=>{$(l,{x:O.clientX,y:O.clientY},!0)};at(()=>(document.addEventListener("mousemove",h),()=>{document.removeEventListener("mousemove",h)})),at(()=>{const O=Ke.currentHoveredArea?.id,P=++d;if(!O){$(s,null);return}(async()=>{const F=await Ke.getAreaNamesById([O]);P===d&&Ke.currentHoveredArea?.id===O&&$(s,F[0]??null,!0)})()});var p=pe(),I=ee(p);{var M=O=>{var P=ws(),F=W(P);Ne(F,()=>ha,(z,N)=>{N(z,{class:"max-w-xs border !py-2 shadow-lg",children:(T,L)=>{var J=pe(),U=ee(J);Ne(U,()=>vi,(ne,Z)=>{Z(ne,{class:"!px-3 !py-0",children:(R,de)=>{var te=bs(),oe=W(te,!0);V(te),nt(()=>gt(oe,u(s))),D(R,te)},$$slots:{default:!0}})}),D(T,J)},$$slots:{default:!0}})}),V(P),nt(()=>tn(P,`left: ${u(l).x+10}px; top: ${u(l).y-10}px;`)),D(O,P)};me(I,O=>{u(s)&&O(M)})}D(k,p),je()}function Ss(k,n){Re(n,!0);async function s(l,d){const h=await Ke.getAreaNamesById([l]);if(!h||h.length===0||!h[0])return;const p=`Area ${d}: ${h[0]}`;nn.success(p)}at(()=>{Ke.lastAddedArea&&s(Ke.lastAddedArea.id,"added")}),at(()=>{Ke.lastRemovedArea&&s(Ke.lastRemovedArea.id,"removed")}),je()}var xs=le("<div><!></div>");function ra(k,n){Re(n,!0);let s=De(n,"ref",15,null),l=Kt(n,["$$slots","$$events","$$legacy","ref","variant","children"]);var d=xs();xr(d,()=>({...l,class:"group/chat-bubble flex max-w-[80%] flex-row place-items-end gap-2 data-[variant='sent']:place-self-end","data-variant":n.variant}));var h=W(d);$e(h,()=>n.children??tt),V(d),Tt(d,p=>s(p),()=>s()),D(k,d),je()}var ks=le('<span class="inline-block size-(--loading-dots-size) rounded-full bg-primary svelte-k2x6sv"></span>'),Cs=le('<div class="inline-flex items-center gap-1 svelte-k2x6sv"></div>');function Is(k,n){let s=De(n,"size",3,4);var l=Cs();let d;zt(l,20,()=>({length:3}),In,(h,p)=>{var I=ks();D(h,I)}),V(l),nt(h=>d=tn(l,"",d,h),[()=>({"--loading-dots-size":`${s()??""}px`})]),D(k,l)}var As=le('<div class="flex size-full place-items-center justify-center"><!></div>'),Os=le("<div><!></div>");function ia(k,n){Re(n,!0);let s=De(n,"ref",15,null),l=De(n,"typing",3,!1),d=Kt(n,["$$slots","$$events","$$legacy","ref","typing","class","children"]);var h=Os();xr(h,O=>({...d,class:O}),[()=>Cr("order-2 rounded-lg bg-secondary p-4 text-sm group-data-[variant='received']/chat-bubble:rounded-bl-none group-data-[variant='sent']/chat-bubble:order-1 group-data-[variant='sent']/chat-bubble:rounded-br-none group-data-[variant='sent']/chat-bubble:bg-primary group-data-[variant='sent']/chat-bubble:text-primary-foreground",n.class)]);var p=W(h);{var I=O=>{var P=As(),F=W(P);Is(F,{}),V(P),D(O,P)},M=O=>{var P=pe(),F=ee(P);$e(F,()=>n.children??tt),D(O,P)};me(p,O=>{l()?O(I):O(M,!1)})}V(h),Tt(h,O=>s(O),()=>s()),D(k,h),je()}function Ps(k,n){Re(n,!0);let s=De(n,"ref",15,null),l=Kt(n,["$$slots","$$events","$$legacy","ref","class"]);var d=pe(),h=ee(d);{let p=he(()=>Cr("relative flex size-8 shrink-0 overflow-hidden rounded-full",n.class));Ne(h,()=>us,(I,M)=>{M(I,Et({"data-slot":"avatar",get class(){return u(p)}},()=>l,{get ref(){return s()},set ref(O){s(O)}}))})}D(k,d),je()}function Ts(k,n){Re(n,!0);let s=De(n,"ref",15,null),l=Kt(n,["$$slots","$$events","$$legacy","ref","class"]);{let d=he(()=>Cr("order-1 group-data-[variant='sent']/chat-bubble:order-2",n.class));Ps(k,Et({get class(){return u(d)}},()=>l,{get ref(){return s()},set ref(h){s(h)}}))}je()}function Es(k){const n=k-1;return n*n*n+1}function aa(k,{delay:n=0,duration:s=400,easing:l=Es,start:d=0,opacity:h=0}={}){const p=getComputedStyle(k),I=+p.opacity,M=p.transform==="none"?"":p.transform,O=1-d,P=I*(1-h);return{delay:n,duration:s,easing:l,css:(F,z)=>`
			transform: ${M} scale(${1-O*z});
			opacity: ${I-P*z}
		`}}class Ms{#e=se();#t=se(0);#n=se(!1);lastScrollHeight=0;set ref(n){if($(this.#e,n,!0),!u(this.#e))return;this.lastScrollHeight=u(this.#e).scrollHeight,u(this.#e).scrollTo(0,u(this.#t)?u(this.#t):u(this.#e).scrollHeight),u(this.#e).addEventListener("scroll",()=>{u(this.#e)&&($(this.#t,u(this.#e).scrollTop,!0),this.disableAutoScroll())}),window.addEventListener("resize",()=>{this.scrollToBottom(!0)}),new MutationObserver(()=>{u(this.#e)&&(u(this.#e).scrollHeight!==this.lastScrollHeight&&this.scrollToBottom(!0),this.lastScrollHeight=u(this.#e).scrollHeight)}).observe(u(this.#e),{childList:!0,subtree:!0})}get ref(){return u(this.#e)}get scrollY(){return u(this.#t)}get isAtBottom(){return u(this.#e)?u(this.#t)+u(this.#e).offsetHeight>=u(this.#e).scrollHeight:!0}disableAutoScroll(){this.isAtBottom?$(this.#n,!1):$(this.#n,!0)}scrollToBottom(n=!1){u(this.#e)&&(n&&u(this.#n)||u(this.#e).scrollTo(0,u(this.#e).scrollHeight))}}var Ds=le("<div><!></div>"),Ls=le('<div class="relative"><div><!></div> <!></div>');function Fs(k,n){Re(n,!0);let s=De(n,"ref",15,null),l=Kt(n,["$$slots","$$events","$$legacy","ref","children","class"]),d=se(!1);const h=new Ms;Cn(()=>{$(d,!0)});var p=Ls(),I=W(p);xr(I,F=>({...l,class:F}),[()=>Cr("no-scrollbar flex h-full w-full flex-col gap-4 overflow-y-auto p-4",n.class,{"scroll-smooth":u(d)})]);var M=W(I);$e(M,()=>n.children??tt),V(I),Tt(I,F=>s(F),()=>s()),Tt(I,F=>h.ref=F,()=>h?.ref);var O=ce(I,2);{var P=F=>{var z=Ds(),N=W(z);Pt(N,{onclick:()=>h.scrollToBottom(),variant:"outline",size:"icon",class:"absolute bottom-2 left-1/2 inline-flex -translate-x-1/2 transform rounded-full shadow-md",children:(T,L)=>{gs(T,{})},$$slots:{default:!0}}),V(z),na(1,z,()=>aa,()=>({start:.85,duration:100,delay:250})),na(2,z,()=>aa,()=>({start:.85,duration:100})),D(F,z)};me(O,F=>{h.isAtBottom||F(P)})}V(p),D(k,p),je()}var Ns=le(`<p> </p> <div class="w-full text-xs group-data-[variant='sent']/chat-bubble:text-end"> </div>`,1),Hs=le("<!> <!>",1),zs=le("<!> <!>",1),Ks=le('<div class="flex h-full w-full flex-col border border-border"><div class="flex-1 overflow-auto [scroll-behavior:smooth]"><div class="flex min-h-full flex-col justify-end gap-2 p-2"><!></div></div> <form class="flex shrink-0 items-center gap-2 border-t border-border bg-background p-2"><!> <!></form></div>');function Rs(k,n){Re(n,!0);let s=se(""),l=se(void 0),d=se(void 0),h=se(void 0),p=se(!0);const I=8,M=Ue([{senderId:2,message:"How do I use the treeview?",sentAt:"10:00 AM"},{senderId:1,message:"The UPRN treeview enables you to select and download data...",sentAt:"10:01 AM"},{senderId:2,message:"Can you show me how?",sentAt:"10:02 AM"}]);function O(R){return`${R.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} ${R.getHours()>=12?"PM":"AM"}`}function P(){return u(d)?u(d).scrollHeight-u(d).scrollTop-u(d).clientHeight<=I:!0}async function F(R="smooth"){await lo(),u(d)&&u(d).scrollTo({top:u(d).scrollHeight,behavior:R})}function z(){$(p,P(),!0)}at(()=>{M.length,u(p)&&F("smooth")}),Cn(()=>{F("auto");const R=new ResizeObserver(()=>{u(d)&&u(p)&&F("smooth")});u(l)&&R.observe(u(l));let de=0;const te=new ResizeObserver(()=>{if(!u(d))return;const oe=u(h)?.scrollHeight||0;if(u(p))F("smooth");else{const ye=oe-de;ye!==0&&(u(d).scrollTop+=ye)}de=oe});return u(h)&&(de=u(h).scrollHeight,te.observe(u(h))),()=>{R.disconnect(),te.disconnect()}});var N=Ks(),T=W(N),L=W(T),J=W(L);Ne(J,()=>Fs,(R,de)=>{de(R,{children:(te,oe)=>{var ye=zs(),Ie=ee(ye);zt(Ie,16,()=>M,ve=>ve,(ve,re)=>{var ie=pe(),Se=ee(ie);{let Pe=he(()=>re.senderId===2?"sent":"received");Ne(Se,()=>ra,(be,Te)=>{Te(be,{get variant(){return u(Pe)},children:(xe,Ae)=>{var Me=Hs(),Be=ee(Me);Ne(Be,()=>Ts,(Fe,Ye)=>{Ye(Fe,{})});var rt=ce(Be,2);Ne(rt,()=>ia,(Fe,Ye)=>{Ye(Fe,{class:"flex flex-col gap-1",children:(Qe,Ze)=>{var ht=Ns(),kt=ee(ht),K=W(kt,!0);V(kt);var ke=ce(kt,2),He=W(ke,!0);V(ke),nt(()=>{gt(K,re.message),gt(He,re.sentAt)}),D(Qe,ht)},$$slots:{default:!0}})}),D(xe,Me)},$$slots:{default:!0}})})}D(ve,ie)});var Ee=ce(Ie,2);Ne(Ee,()=>ra,(ve,re)=>{re(ve,{variant:"received",children:(ie,Se)=>{var Pe=pe(),be=ee(Pe);Ne(be,()=>ia,(Te,xe)=>{xe(Te,{typing:!0})}),D(ie,Pe)},$$slots:{default:!0}})}),D(te,ye)},$$slots:{default:!0}})}),V(L),Tt(L,R=>$(h,R),()=>u(h)),V(T),Tt(T,R=>$(d,R),()=>u(d));var U=ce(T,2),ne=W(U);ts(ne,{class:"rounded-full",placeholder:"Type a message...",get value(){return u(s)},set value(R){$(s,R,!0)}});var Z=ce(ne,2);{let R=he(()=>u(s)==="");Pt(Z,{type:"submit",variant:"default",size:"icon",class:"shrink-0 rounded-full",get disabled(){return u(R)},children:(de,te)=>{ms(de,{})},$$slots:{default:!0}})}V(U),V(N),Tt(N,R=>$(l,R),()=>u(l)),ea("scroll",T,z),ea("submit",U,R=>{R.preventDefault(),u(s)&&(M.push({message:u(s),senderId:2,sentAt:O(new Date)}),$(s,""),$(p,!0),F("smooth"))}),D(k,N),je()}var br={exports:{}},js=br.exports,oa;function Bs(){return oa||(oa=1,(function(k,n){(function(s,l){k.exports=l()})(js,function(){var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=i[a])})(e,t)},l=function(){return(l=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function d(e,t,r){for(var i,a=0,o=t.length;a<o;a++)!i&&a in t||((i=i||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(i||Array.prototype.slice.call(t))}var h=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Eo,p=Object.keys,I=Array.isArray;function M(e,t){return typeof t!="object"||p(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||h.Promise||(h.Promise=Promise);var O=Object.getPrototypeOf,P={}.hasOwnProperty;function F(e,t){return P.call(e,t)}function z(e,t){typeof t=="function"&&(t=t(O(e))),(typeof Reflect>"u"?p:Reflect.ownKeys)(t).forEach(function(r){T(e,r,t[r])})}var N=Object.defineProperty;function T(e,t,r,i){N(e,t,M(r&&F(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},i))}function L(e){return{from:function(t){return e.prototype=Object.create(t.prototype),T(e.prototype,"constructor",e),{extend:z.bind(null,e.prototype)}}}}var J=Object.getOwnPropertyDescriptor,U=[].slice;function ne(e,t,r){return U.call(e,t,r)}function Z(e,t){return t(e)}function R(e){if(!e)throw new Error("Assertion Failed")}function de(e){h.setImmediate?setImmediate(e):setTimeout(e,0)}function te(e,t){if(typeof t=="string"&&F(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],i=0,a=t.length;i<a;++i){var o=te(e,t[i]);r.push(o)}return r}var c=t.indexOf(".");if(c!==-1){var f=e[t.substr(0,c)];return f==null?void 0:te(f,t.substr(c+1))}}function oe(e,t,r){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){R(typeof r!="string"&&"length"in r);for(var i=0,a=t.length;i<a;++i)oe(e,t[i],r[i])}else{var o,c,f=t.indexOf(".");f!==-1?(o=t.substr(0,f),(c=t.substr(f+1))===""?r===void 0?I(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=r:oe(f=!(f=e[o])||!F(e,o)?e[o]={}:f,c,r)):r===void 0?I(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function ye(e){var t,r={};for(t in e)F(e,t)&&(r[t]=e[t]);return r}var Ie=[].concat;function Ee(e){return Ie.apply([],e)}var vt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ee([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return h[e]}),ve=new Set(vt.map(function(e){return h[e]})),re=null;function ie(e){return re=new WeakMap,e=(function t(r){if(!r||typeof r!="object")return r;var i=re.get(r);if(i)return i;if(I(r)){i=[],re.set(r,i);for(var a=0,o=r.length;a<o;++a)i.push(t(r[a]))}else if(ve.has(r.constructor))i=r;else{var c,f=O(r);for(c in i=f===Object.prototype?{}:Object.create(f),re.set(r,i),r)F(r,c)&&(i[c]=t(r[c]))}return i})(e),re=null,e}var Se={}.toString;function Pe(e){return Se.call(e).slice(8,-1)}var be=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Te=typeof be=="symbol"?function(e){var t;return e!=null&&(t=e[be])&&t.apply(e)}:function(){return null};function xe(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var Ae={};function Me(e){var t,r,i,a;if(arguments.length===1){if(I(e))return e.slice();if(this===Ae&&typeof e=="string")return[e];if(a=Te(e)){for(r=[];!(i=a.next()).done;)r.push(i.value);return r}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(r=new Array(t);t--;)r[t]=e[t];return r}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var Be=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Lt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],It=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Lt),rt={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Fe(e,t){this.name=e,this.message=t}function Ye(e,t){return e+". Errors: "+Object.keys(t).map(function(r){return t[r].toString()}).filter(function(r,i,a){return a.indexOf(r)===i}).join(`
`)}function Qe(e,t,r,i){this.failures=t,this.failedKeys=i,this.successCount=r,this.message=Ye(e,t)}function Ze(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(r){return t[r]}),this.failuresByPos=t,this.message=Ye(e,this.failures)}L(Fe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),L(Qe).from(Fe),L(Ze).from(Fe);var ht=It.reduce(function(e,t){return e[t]=t+"Error",e},{}),kt=Fe,K=It.reduce(function(e,t){var r=t+"Error";function i(a,o){this.name=r,a?typeof a=="string"?(this.message="".concat(a).concat(o?`
 `+o:""),this.inner=o||null):typeof a=="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a):(this.message=rt[t]||r,this.inner=null)}return L(i).from(kt),e[t]=i,e},{});K.Syntax=SyntaxError,K.Type=TypeError,K.Range=RangeError;var ke=Lt.reduce(function(e,t){return e[t+"Error"]=K[t],e},{}),He=It.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=K[t]),e},{});function fe(){}function Ve(e){return e}function lt(e,t){return e==null||e===Ve?t:function(r){return t(e(r))}}function Xe(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Ct(e,t){return e===fe?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Xe(i,this.onsuccess):i),a&&(this.onerror=this.onerror?Xe(a,this.onerror):a),o!==void 0?o:r}}function Mt(e,t){return e===fe?t:function(){e.apply(this,arguments);var r=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Xe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Xe(i,this.onerror):i)}}function ut(e,t){return e===fe?t:function(r){var i=e.apply(this,arguments);M(r,i);var a=this.onsuccess,o=this.onerror;return this.onsuccess=null,this.onerror=null,r=t.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?Xe(a,this.onsuccess):a),o&&(this.onerror=this.onerror?Xe(o,this.onerror):o),i===void 0?r===void 0?void 0:r:M(i,r)}}function mt(e,t){return e===fe?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Ut(e,t){return e===fe?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var i=this,a=arguments.length,o=new Array(a);a--;)o[a]=arguments[a];return r.then(function(){return t.apply(i,o)})}return t.apply(this,arguments)}}He.ModifyError=Qe,He.DexieError=Fe,He.BulkError=Ze;var yt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function At(e){yt=e}var Ot={},Dt=100,vt=typeof Promise>"u"?[]:(function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,O(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,O(t),e]})(),Lt=vt[0],It=vt[1],vt=vt[2],It=It&&It.then,bt=Lt&&Lt.constructor,an=!!vt,Gt=function(e,t){On.push([e,t]),pn&&(queueMicrotask(Ia),pn=!1)},on=!0,pn=!0,Rt=[],gn=[],jt=Ve,_t={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:fe,pgp:!1,env:{},finalize:fe},ue=_t,On=[],sn=0,Un=[];function X(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=ue;if(typeof e!="function"){if(e!==Ot)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Or(this,this._value))}this._state=null,this._value=null,++t.ref,(function r(i,a){try{a(function(o){if(i._state===null){if(o===i)throw new TypeError("A promise cannot be resolved with itself.");var c=i._lib&&mn();o&&typeof o.then=="function"?r(i,function(f,g){o instanceof X?o._then(f,g):o.then(f,g)}):(i._state=!0,i._value=o,yi(i)),c&&yn()}},Or.bind(null,i))}catch(o){Or(i,o)}})(this,e)}var Ar={get:function(){var e=ue,t=Yn;function r(i,a){var o=this,c=!e.global&&(e!==ue||t!==Yn),f=c&&!$t(),g=new X(function(m,_){Pr(o,new mi(wi(i,e,c,f),wi(a,e,c,f),m,_,e))});return this._consoleTask&&(g._consoleTask=this._consoleTask),g}return r.prototype=Ot,r},set:function(e){T(this,"then",e&&e.prototype===Ot?Ar:{get:function(){return e},set:Ar.set})}};function mi(e,t,r,i,a){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=i,this.psd=a}function Or(e,t){var r,i;gn.push(t),e._state===null&&(r=e._lib&&mn(),t=jt(t),e._state=!1,e._value=t,i=e,Rt.some(function(a){return a._value===i._value})||Rt.push(i),yi(e),r&&yn())}function yi(e){var t=e._listeners;e._listeners=[];for(var r=0,i=t.length;r<i;++r)Pr(e,t[r]);var a=e._PSD;--a.ref||a.finalize(),sn===0&&(++sn,Gt(function(){--sn==0&&Tr()},[]))}function Pr(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++sn,Gt(Ca,[r,e,t])}else e._listeners.push(t)}function Ca(e,t,r){try{var i,a=t._value;!t._state&&gn.length&&(gn=[]),i=yt&&t._consoleTask?t._consoleTask.run(function(){return e(a)}):e(a),t._state||gn.indexOf(a)!==-1||(function(o){for(var c=Rt.length;c;)if(Rt[--c]._value===o._value)return Rt.splice(c,1)})(t),r.resolve(i)}catch(o){r.reject(o)}finally{--sn==0&&Tr(),--r.psd.ref||r.psd.finalize()}}function Ia(){ln(_t,function(){mn()&&yn()})}function mn(){var e=on;return pn=on=!1,e}function yn(){var e,t,r;do for(;0<On.length;)for(e=On,On=[],r=e.length,t=0;t<r;++t){var i=e[t];i[0].apply(null,i[1])}while(0<On.length);pn=on=!0}function Tr(){var e=Rt;Rt=[],e.forEach(function(i){i._PSD.onunhandled.call(null,i._value,i)});for(var t=Un.slice(0),r=t.length;r;)t[--r]()}function Gn(e){return new X(Ot,!1,e)}function Ge(e,t){var r=ue;return function(){var i=mn(),a=ue;try{return Yt(r,!0),e.apply(this,arguments)}catch(o){t&&t(o)}finally{Yt(a,!1),i&&yn()}}}z(X.prototype,{then:Ar,_then:function(e,t){Pr(this,new mi(null,null,e,t,ue))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,r=arguments[1];return typeof t=="function"?this.then(null,function(i){return(i instanceof t?r:Gn)(i)}):this.then(null,function(i){return(i&&i.name===t?r:Gn)(i)})},finally:function(e){return this.then(function(t){return X.resolve(e()).then(function(){return t})},function(t){return X.resolve(e()).then(function(){return Gn(t)})})},timeout:function(e,t){var r=this;return e<1/0?new X(function(i,a){var o=setTimeout(function(){return a(new K.Timeout(t))},e);r.then(i,a).finally(clearTimeout.bind(null,o))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&T(X.prototype,Symbol.toStringTag,"Dexie.Promise"),_t.env=bi(),z(X,{all:function(){var e=Me.apply(null,arguments).map(Qn);return new X(function(t,r){e.length===0&&t([]);var i=e.length;e.forEach(function(a,o){return X.resolve(a).then(function(c){e[o]=c,--i||t(e)},r)})})},resolve:function(e){return e instanceof X?e:e&&typeof e.then=="function"?new X(function(t,r){e.then(t,r)}):new X(Ot,!0,e)},reject:Gn,race:function(){var e=Me.apply(null,arguments).map(Qn);return new X(function(t,r){e.map(function(i){return X.resolve(i).then(t,r)})})},PSD:{get:function(){return ue},set:function(e){return ue=e}},totalEchoes:{get:function(){return Yn}},newPSD:Wt,usePSD:ln,scheduler:{get:function(){return Gt},set:function(e){Gt=e}},rejectionMapper:{get:function(){return jt},set:function(e){jt=e}},follow:function(e,t){return new X(function(r,i){return Wt(function(a,o){var c=ue;c.unhandleds=[],c.onunhandled=o,c.finalize=Xe(function(){var f,g=this;f=function(){g.unhandleds.length===0?a():o(g.unhandleds[0])},Un.push(function m(){f(),Un.splice(Un.indexOf(m),1)}),++sn,Gt(function(){--sn==0&&Tr()},[])},c.finalize),e()},t,r,i)})}}),bt&&(bt.allSettled&&T(X,"allSettled",function(){var e=Me.apply(null,arguments).map(Qn);return new X(function(t){e.length===0&&t([]);var r=e.length,i=new Array(r);e.forEach(function(a,o){return X.resolve(a).then(function(c){return i[o]={status:"fulfilled",value:c}},function(c){return i[o]={status:"rejected",reason:c}}).then(function(){return--r||t(i)})})})}),bt.any&&typeof AggregateError<"u"&&T(X,"any",function(){var e=Me.apply(null,arguments).map(Qn);return new X(function(t,r){e.length===0&&r(new AggregateError([]));var i=e.length,a=new Array(i);e.forEach(function(o,c){return X.resolve(o).then(function(f){return t(f)},function(f){a[c]=f,--i||r(new AggregateError(a))})})})}),bt.withResolvers&&(X.withResolvers=bt.withResolvers));var ot={awaits:0,echoes:0,id:0},Aa=0,Wn=[],$n=0,Yn=0,Oa=0;function Wt(e,t,r,i){var a=ue,o=Object.create(a);return o.parent=a,o.ref=0,o.global=!1,o.id=++Oa,_t.env,o.env=an?{Promise:X,PromiseProp:{value:X,configurable:!0,writable:!0},all:X.all,race:X.race,allSettled:X.allSettled,any:X.any,resolve:X.resolve,reject:X.reject}:{},t&&M(o,t),++a.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()},i=ln(o,e,r,i),o.ref===0&&o.finalize(),i}function bn(){return ot.id||(ot.id=++Aa),++ot.awaits,ot.echoes+=Dt,ot.id}function $t(){return!!ot.awaits&&(--ot.awaits==0&&(ot.id=0),ot.echoes=ot.awaits*Dt,!0)}function Qn(e){return ot.echoes&&e&&e.constructor===bt?(bn(),e.then(function(t){return $t(),t},function(t){return $t(),Je(t)})):e}function Pa(){var e=Wn[Wn.length-1];Wn.pop(),Yt(e,!1)}function Yt(e,t){var r,i=ue;(t?!ot.echoes||$n++&&e===ue:!$n||--$n&&e===ue)||queueMicrotask(t?(function(a){++Yn,ot.echoes&&--ot.echoes!=0||(ot.echoes=ot.awaits=ot.id=0),Wn.push(ue),Yt(a,!0)}).bind(null,e):Pa),e!==ue&&(ue=e,i===_t&&(_t.env=bi()),an&&(r=_t.env.Promise,t=e.env,(i.global||e.global)&&(Object.defineProperty(h,"Promise",t.PromiseProp),r.all=t.all,r.race=t.race,r.resolve=t.resolve,r.reject=t.reject,t.allSettled&&(r.allSettled=t.allSettled),t.any&&(r.any=t.any))))}function bi(){var e=h.Promise;return an?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(h,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ln(e,t,r,i,a){var o=ue;try{return Yt(e,!0),t(r,i,a)}finally{Yt(o,!1)}}function wi(e,t,r,i){return typeof e!="function"?e:function(){var a=ue;r&&bn(),Yt(t,!0);try{return e.apply(this,arguments)}finally{Yt(a,!1),i&&queueMicrotask($t)}}}function Er(e){Promise===bt&&ot.echoes===0?$n===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+It).indexOf("[native code]")===-1&&(bn=$t=fe);var Je=X.reject,un="￿",Bt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",_i="String expected.",wn=[],Xn="__dbnames",Mr="readonly",Dr="readwrite";function cn(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Si={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Zn(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=ie(t))[e],t}}function xi(){throw K.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Le(e,t){try{var r=ki(e),i=ki(t);if(r!==i)return r==="Array"?1:i==="Array"?-1:r==="binary"?1:i==="binary"?-1:r==="string"?1:i==="string"?-1:r==="Date"?1:i!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return(function(a,o){for(var c=a.length,f=o.length,g=c<f?c:f,m=0;m<g;++m)if(a[m]!==o[m])return a[m]<o[m]?-1:1;return c===f?0:c<f?-1:1})(Ci(e),Ci(t));case"Array":return(function(a,o){for(var c=a.length,f=o.length,g=c<f?c:f,m=0;m<g;++m){var _=Le(a[m],o[m]);if(_!==0)return _}return c===f?0:c<f?-1:1})(e,t)}}catch{}return NaN}function ki(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=Pe(e),e==="ArrayBuffer"?"binary":e)}function Ci(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Jn(e,t,r){var i=e.schema.yProps;return i?(t&&0<r.numFailures&&(t=t.filter(function(a,o){return!r.failures[o]})),Promise.all(i.map(function(a){return a=a.updatesTable,t?e.db.table(a).where("k").anyOf(t).delete():e.db.table(a).clear()})).then(function(){return r})):r}var Pn=(Ii.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var r=t.add;if(I(r))return d(d([],I(e)?e:[],!0),r).sort();if(typeof r=="number")return(Number(e)||0)+r;if(typeof r=="bigint")try{return BigInt(e)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(t.remove!==void 0){var i=t.remove;if(I(i))return I(e)?e.filter(function(a){return!i.includes(a)}).sort():[];if(typeof i=="number")return Number(e)-i;if(typeof i=="bigint")try{return BigInt(e)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}return r=(r=t.replacePrefix)===null||r===void 0?void 0:r[0],r&&typeof e=="string"&&e.startsWith(r)?t.replacePrefix[1]+e.substring(r.length):e},Ii);function Ii(e){this["@@propmod"]=e}function Ai(e,t){for(var r=p(t),i=r.length,a=!1,o=0;o<i;++o){var c=r[o],f=t[c],g=te(e,c);f instanceof Pn?(oe(e,c,f.execute(g)),a=!0):g!==f&&(oe(e,c,f),a=!0)}return a}var Oi=(qe.prototype._trans=function(e,t,r){var i=this._tx||ue.trans,a=this.name,o=yt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function c(m,_,v){if(!v.schema[a])throw new K.NotFound("Table "+a+" not part of transaction");return t(v.idbtrans,v)}var f=mn();try{var g=i&&i.db._novip===this.db._novip?i===ue.trans?i._promise(e,c,r):Wt(function(){return i._promise(e,c,r)},{trans:i,transless:ue.transless||ue}):(function m(_,v,x,y){if(_.idbdb&&(_._state.openComplete||ue.letThrough||_._vip)){var b=_._createTransaction(v,x,_._dbSchema);try{b.create(),_._state.PR1398_maxLoop=3}catch(w){return w.name===ht.InvalidState&&_.isOpen()&&0<--_._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),_.close({disableAutoOpen:!1}),_.open().then(function(){return m(_,v,x,y)})):Je(w)}return b._promise(v,function(w,S){return Wt(function(){return ue.trans=b,y(w,S,b)})}).then(function(w){if(v==="readwrite")try{b.idbtrans.commit()}catch{}return v==="readonly"?w:b._completion.then(function(){return w})})}if(_._state.openComplete)return Je(new K.DatabaseClosed(_._state.dbOpenError));if(!_._state.isBeingOpened){if(!_._state.autoOpen)return Je(new K.DatabaseClosed);_.open().catch(fe)}return _._state.dbReadyPromise.then(function(){return m(_,v,x,y)})})(this.db,e,[this.name],c);return o&&(g._consoleTask=o,g=g.catch(function(m){return console.trace(m),Je(m)})),g}finally{f&&yn()}},qe.prototype.get=function(e,t){var r=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?Je(new K.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(a){return r.hook.reading.fire(a)})}).then(t)},qe.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(I(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=p(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(f){if(f.compound&&t.every(function(m){return 0<=f.keyPath.indexOf(m)})){for(var g=0;g<t.length;++g)if(t.indexOf(f.keyPath[g])===-1)return!1;return!0}return!1}).sort(function(f,g){return f.keyPath.length-g.keyPath.length})[0];if(r&&this.db._maxKey!==un){var o=r.keyPath.slice(0,t.length);return this.where(o).equals(o.map(function(g){return e[g]}))}!r&&yt&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var i=this.schema.idxByName;function a(f,g){return Le(f,g)===0}var c=t.reduce(function(v,g){var m=v[0],_=v[1],v=i[g],x=e[g];return[m||v,m||!v?cn(_,v&&v.multi?function(y){return y=te(y,g),I(y)&&y.some(function(b){return a(x,b)})}:function(y){return a(x,te(y,g))}):_]},[null,null]),o=c[0],c=c[1];return o?this.where(o.name).equals(e[o.keyPath]).filter(c):r?this.filter(c):this.where(t).equals("")},qe.prototype.filter=function(e){return this.toCollection().and(e)},qe.prototype.count=function(e){return this.toCollection().count(e)},qe.prototype.offset=function(e){return this.toCollection().offset(e)},qe.prototype.limit=function(e){return this.toCollection().limit(e)},qe.prototype.each=function(e){return this.toCollection().each(e)},qe.prototype.toArray=function(e){return this.toCollection().toArray(e)},qe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},qe.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,I(e)?"[".concat(e.join("+"),"]"):e))},qe.prototype.reverse=function(){return this.toCollection().reverse()},qe.prototype.mapToClass=function(e){var t,r=this.db,i=this.name;function a(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof xi&&((function(g,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function _(){this.constructor=g}s(g,m),g.prototype=m===null?Object.create(m):(_.prototype=m.prototype,new _)})(a,t=e),Object.defineProperty(a.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),a.prototype.table=function(){return i},e=a);for(var o=new Set,c=e.prototype;c;c=O(c))Object.getOwnPropertyNames(c).forEach(function(g){return o.add(g)});function f(g){if(!g)return g;var m,_=Object.create(e.prototype);for(m in g)if(!o.has(m))try{_[m]=g[m]}catch{}return _}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=f,this.hook("reading",f),e},qe.prototype.defineClass=function(){return this.mapToClass(function(e){M(this,e)})},qe.prototype.add=function(e,t){var r=this,i=this.schema.primKey,a=i.auto,o=i.keyPath,c=e;return o&&a&&(c=Zn(o)(e)),this._trans("readwrite",function(f){return r.core.mutate({trans:f,type:"add",keys:t!=null?[t]:null,values:[c]})}).then(function(f){return f.numFailures?X.reject(f.failures[0]):f.lastResult}).then(function(f){if(o)try{oe(e,o,f)}catch{}return f})},qe.prototype.upsert=function(e,t){var r=this,i=this.schema.primKey.keyPath;return this._trans("readwrite",function(a){return r.core.get({trans:a,key:e}).then(function(o){var c=o??{};return Ai(c,t),i&&oe(c,i,e),r.core.mutate({trans:a,type:"put",values:[c],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(f){return f.numFailures?X.reject(f.failures[0]):!!o})})})},qe.prototype.update=function(e,t){return typeof e!="object"||I(e)?this.where(":id").equals(e).modify(t):(e=te(e,this.schema.primKey.keyPath),e===void 0?Je(new K.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},qe.prototype.put=function(e,t){var r=this,i=this.schema.primKey,a=i.auto,o=i.keyPath,c=e;return o&&a&&(c=Zn(o)(e)),this._trans("readwrite",function(f){return r.core.mutate({trans:f,type:"put",values:[c],keys:t!=null?[t]:null})}).then(function(f){return f.numFailures?X.reject(f.failures[0]):f.lastResult}).then(function(f){if(o)try{oe(e,o,f)}catch{}return f})},qe.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:[e]}).then(function(i){return Jn(t,[e],i)}).then(function(i){return i.numFailures?X.reject(i.failures[0]):void 0})})},qe.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Si}).then(function(r){return Jn(e,null,r)})}).then(function(t){return t.numFailures?X.reject(t.failures[0]):void 0})},qe.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(r){return t.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(a){return t.hook.reading.fire(a)})})})},qe.prototype.bulkAdd=function(e,t,r){var i=this,a=Array.isArray(t)?t:void 0,o=(r=r||(a?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(c){var m=i.schema.primKey,f=m.auto,m=m.keyPath;if(m&&a)throw new K.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,m=m&&f?e.map(Zn(m)):e;return i.core.mutate({trans:c,type:"add",keys:a,values:m,wantResults:o}).then(function(b){var v=b.numFailures,x=b.results,y=b.lastResult,b=b.failures;if(v===0)return o?x:y;throw new Ze("".concat(i.name,".bulkAdd(): ").concat(v," of ").concat(g," operations failed"),b)})})},qe.prototype.bulkPut=function(e,t,r){var i=this,a=Array.isArray(t)?t:void 0,o=(r=r||(a?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(c){var m=i.schema.primKey,f=m.auto,m=m.keyPath;if(m&&a)throw new K.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,m=m&&f?e.map(Zn(m)):e;return i.core.mutate({trans:c,type:"put",keys:a,values:m,wantResults:o}).then(function(b){var v=b.numFailures,x=b.results,y=b.lastResult,b=b.failures;if(v===0)return o?x:y;throw new Ze("".concat(i.name,".bulkPut(): ").concat(v," of ").concat(g," operations failed"),b)})})},qe.prototype.bulkUpdate=function(e){var t=this,r=this.core,i=e.map(function(c){return c.key}),a=e.map(function(c){return c.changes}),o=[];return this._trans("readwrite",function(c){return r.getMany({trans:c,keys:i,cache:"clone"}).then(function(f){var g=[],m=[];e.forEach(function(v,x){var y=v.key,b=v.changes,w=f[x];if(w){for(var S=0,C=Object.keys(b);S<C.length;S++){var A=C[S],E=b[A];if(A===t.schema.primKey.keyPath){if(Le(E,y)!==0)throw new K.Constraint("Cannot update primary key in bulkUpdate()")}else oe(w,A,E)}o.push(x),g.push(y),m.push(w)}});var _=g.length;return r.mutate({trans:c,type:"put",keys:g,values:m,updates:{keys:i,changeSpecs:a}}).then(function(v){var x=v.numFailures,y=v.failures;if(x===0)return _;for(var b=0,w=Object.keys(y);b<w.length;b++){var S,C=w[b],A=o[Number(C)];A!=null&&(S=y[C],delete y[C],y[A]=S)}throw new Ze("".concat(t.name,".bulkUpdate(): ").concat(x," of ").concat(_," operations failed"),y)})})})},qe.prototype.bulkDelete=function(e){var t=this,r=e.length;return this._trans("readwrite",function(i){return t.core.mutate({trans:i,type:"delete",keys:e}).then(function(a){return Jn(t,e,a)})}).then(function(c){var a=c.numFailures,o=c.lastResult,c=c.failures;if(a===0)return o;throw new Ze("".concat(t.name,".bulkDelete(): ").concat(a," of ").concat(r," operations failed"),c)})},qe);function qe(){}function Tn(e){function t(c,f){if(f){for(var g=arguments.length,m=new Array(g-1);--g;)m[g-1]=arguments[g];return r[c].subscribe.apply(null,m),e}if(typeof c=="string")return r[c]}var r={};t.addEventType=o;for(var i=1,a=arguments.length;i<a;++i)o(arguments[i]);return t;function o(c,f,g){if(typeof c!="object"){var m;f=f||mt;var _={subscribers:[],fire:g=g||fe,subscribe:function(v){_.subscribers.indexOf(v)===-1&&(_.subscribers.push(v),_.fire=f(_.fire,v))},unsubscribe:function(v){_.subscribers=_.subscribers.filter(function(x){return x!==v}),_.fire=_.subscribers.reduce(f,g)}};return r[c]=t[c]=_}p(m=c).forEach(function(v){var x=m[v];if(I(x))o(v,m[v][0],m[v][1]);else{if(x!=="asap")throw new K.InvalidArgument("Invalid event config");var y=o(v,Ve,function(){for(var b=arguments.length,w=new Array(b);b--;)w[b]=arguments[b];y.subscribers.forEach(function(S){de(function(){S.apply(null,w)})})})}})}}function En(e,t){return L(t).from({prototype:e}),t}function _n(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Lr(e,t){e.filter=cn(e.filter,t)}function Fr(e,t,r){var i=e.replayFilter;e.replayFilter=i?function(){return cn(i(),t())}:t,e.justLimit=r&&!i}function er(e,t){if(e.isPrimKey)return t.primaryKey;var r=t.getIndexByKeyPath(e.index);if(!r)throw new K.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Pi(e,t,r){var i=er(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:i,range:e.range}})}function tr(e,t,r,i){var a=e.replayFilter?cn(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},c=function(f,g,m){var _,v;a&&!a(g,m,function(x){return g.stop(x)},function(x){return g.fail(x)})||((v=""+(_=g.primaryKey))=="[object ArrayBuffer]"&&(v=""+new Uint8Array(_)),F(o,v)||(o[v]=!0,t(f,g,m)))};return Promise.all([e.or._iterate(c,r),Ti(Pi(e,i,r),e.algorithm,c,!e.keysOnly&&e.valueMapper)])}return Ti(Pi(e,i,r),cn(e.algorithm,a),t,!e.keysOnly&&e.valueMapper)}function Ti(e,t,r,i){var a=Ge(i?function(o,c,f){return r(i(o),c,f)}:r);return e.then(function(o){if(o)return o.start(function(){var c=function(){return o.continue()};t&&!t(o,function(f){return c=f},function(f){o.stop(f),c=fe},function(f){o.fail(f),c=fe})||a(o.value,o,function(f){return c=f}),c()})})}var Ta=(ze.prototype._read=function(e,t){var r=this._ctx;return r.error?r.table._trans(null,Je.bind(null,r.error)):r.table._trans("readonly",e).then(t)},ze.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,Je.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},ze.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=cn(t.algorithm,e)},ze.prototype._iterate=function(e,t){return tr(this._ctx,e,t,this._ctx.table.core)},ze.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&M(r,e),t._ctx=r,t},ze.prototype.raw=function(){return this._ctx.valueMapper=null,this},ze.prototype.each=function(e){var t=this._ctx;return this._read(function(r){return tr(t,e,r,t.table.core)})},ze.prototype.count=function(e){var t=this;return this._read(function(r){var i=t._ctx,a=i.table.core;if(_n(i,!0))return a.count({trans:r,query:{index:er(i,a.schema),range:i.range}}).then(function(c){return Math.min(c,i.limit)});var o=0;return tr(i,function(){return++o,!1},r,a).then(function(){return o})}).then(e)},ze.prototype.sortBy=function(e,t){var r=e.split(".").reverse(),i=r[0],a=r.length-1;function o(g,m){return m?o(g[r[m]],m-1):g[i]}var c=this._ctx.dir==="next"?1:-1;function f(g,m){return Le(o(g,a),o(m,a))*c}return this.toArray(function(g){return g.sort(f)}).then(t)},ze.prototype.toArray=function(e){var t=this;return this._read(function(r){var i=t._ctx;if(i.dir==="next"&&_n(i,!0)&&0<i.limit){var a=i.valueMapper,o=er(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:o,range:i.range}}).then(function(f){return f=f.result,a?f.map(a):f})}var c=[];return tr(i,function(f){return c.push(f)},r,i.table.core).then(function(){return c})},e)},ze.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,_n(t)?Fr(t,function(){var r=e;return function(i,a){return r===0||(r===1?--r:a(function(){i.advance(r),r=0}),!1)}}):Fr(t,function(){var r=e;return function(){return--r<0}})),this},ze.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Fr(this._ctx,function(){var t=e;return function(r,i,a){return--t<=0&&i(a),0<=t}},!0),this},ze.prototype.until=function(e,t){return Lr(this._ctx,function(r,i,a){return!e(r.value)||(i(a),t)}),this},ze.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},ze.prototype.last=function(e){return this.reverse().first(e)},ze.prototype.filter=function(e){var t;return Lr(this._ctx,function(r){return e(r.value)}),(t=this._ctx).isMatch=cn(t.isMatch,e),this},ze.prototype.and=function(e){return this.filter(e)},ze.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},ze.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ze.prototype.desc=function(){return this.reverse()},ze.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.key,i)})},ze.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},ze.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},ze.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(e)},ze.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&_n(t,!0)&&0<t.limit)return this._read(function(i){var a=er(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:a,range:t.range}})}).then(function(i){return i.result}).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(e)},ze.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},ze.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},ze.prototype.lastKey=function(e){return this.reverse().firstKey(e)},ze.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return Lr(this._ctx,function(a){var i=a.primaryKey.toString(),a=F(t,i);return t[i]=!0,!a}),this},ze.prototype.modify=function(e){var t=this,r=this._ctx;return this._write(function(i){var a=typeof e=="function"?e:function(w){return Ai(w,e)},o=r.table.core,m=o.schema.primaryKey,c=m.outbound,f=m.extractKey,g=200,m=t.db._options.modifyChunkSize;m&&(g=typeof m=="object"?m[o.name]||m["*"]||200:m);function _(w,A){var C=A.failures,A=A.numFailures;x+=w-A;for(var E=0,H=p(C);E<H.length;E++){var B=H[E];v.push(C[B])}}var v=[],x=0,y=[],b=e===Ei;return t.clone().primaryKeys().then(function(w){function S(A){var E=Math.min(g,w.length-A),H=w.slice(A,A+E);return(b?Promise.resolve([]):o.getMany({trans:i,keys:H,cache:"immutable"})).then(function(B){var Y=[],j=[],q=c?[]:null,Q=b?H:[];if(!b)for(var G=0;G<E;++G){var ae=B[G],_e={value:ie(ae),primKey:w[A+G]};a.call(_e,_e.value,_e)!==!1&&(_e.value==null?Q.push(w[A+G]):c||Le(f(ae),f(_e.value))===0?(j.push(_e.value),c&&q.push(w[A+G])):(Q.push(w[A+G]),Y.push(_e.value)))}return Promise.resolve(0<Y.length&&o.mutate({trans:i,type:"add",values:Y}).then(function(Ce){for(var Oe in Ce.failures)Q.splice(parseInt(Oe),1);_(Y.length,Ce)})).then(function(){return(0<j.length||C&&typeof e=="object")&&o.mutate({trans:i,type:"put",keys:q,values:j,criteria:C,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<A}).then(function(Ce){return _(j.length,Ce)})}).then(function(){return(0<Q.length||C&&b)&&o.mutate({trans:i,type:"delete",keys:Q,criteria:C,isAdditionalChunk:0<A}).then(function(Ce){return Jn(r.table,Q,Ce)}).then(function(Ce){return _(Q.length,Ce)})}).then(function(){return w.length>A+E&&S(A+g)})})}var C=_n(r)&&r.limit===1/0&&(typeof e!="function"||b)&&{index:r.index,range:r.range};return S(0).then(function(){if(0<v.length)throw new Qe("Error modifying one or more objects",v,x,y);return w.length})})})},ze.prototype.delete=function(){var e=this._ctx,t=e.range;return!_n(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(Ei):this._write(function(r){var i=e.table.core.schema.primaryKey,a=t;return e.table.core.count({trans:r,query:{index:i,range:a}}).then(function(o){return e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(g){var f=g.failures,g=g.numFailures;if(g)throw new Qe("Could not delete some values",Object.keys(f).map(function(m){return f[m]}),o-g);return o-g})})})},ze);function ze(){}var Ei=function(e,t){return t.value=null};function Ea(e,t){return e<t?-1:e===t?0:1}function Ma(e,t){return t<e?-1:e===t?0:1}function St(e,t,r){return e=e instanceof Di?new e.Collection(e):e,e._ctx.error=new(r||TypeError)(t),e}function Sn(e){return new e.Collection(e,function(){return Mi("")}).limit(0)}function nr(e,t,r,i){var a,o,c,f,g,m,_,v=r.length;if(!r.every(function(b){return typeof b=="string"}))return St(e,_i);function x(b){a=b==="next"?function(S){return S.toUpperCase()}:function(S){return S.toLowerCase()},o=b==="next"?function(S){return S.toLowerCase()}:function(S){return S.toUpperCase()},c=b==="next"?Ea:Ma;var w=r.map(function(S){return{lower:o(S),upper:a(S)}}).sort(function(S,C){return c(S.lower,C.lower)});f=w.map(function(S){return S.upper}),g=w.map(function(S){return S.lower}),_=(m=b)==="next"?"":i}x("next"),e=new e.Collection(e,function(){return Qt(f[0],g[v-1]+i)}),e._ondirectionchange=function(b){x(b)};var y=0;return e._addAlgorithm(function(b,w,S){var C=b.key;if(typeof C!="string")return!1;var A=o(C);if(t(A,g,y))return!0;for(var E=null,H=y;H<v;++H){var B=(function(Y,j,q,Q,G,ae){for(var _e=Math.min(Y.length,Q.length),Ce=-1,Oe=0;Oe<_e;++Oe){var xt=j[Oe];if(xt!==Q[Oe])return G(Y[Oe],q[Oe])<0?Y.substr(0,Oe)+q[Oe]+q.substr(Oe+1):G(Y[Oe],Q[Oe])<0?Y.substr(0,Oe)+Q[Oe]+q.substr(Oe+1):0<=Ce?Y.substr(0,Ce)+j[Ce]+q.substr(Ce+1):null;G(Y[Oe],xt)<0&&(Ce=Oe)}return _e<Q.length&&ae==="next"?Y+q.substr(Y.length):_e<Y.length&&ae==="prev"?Y.substr(0,q.length):Ce<0?null:Y.substr(0,Ce)+Q[Ce]+q.substr(Ce+1)})(C,A,f[H],g[H],c,m);B===null&&E===null?y=H+1:(E===null||0<c(E,B))&&(E=B)}return w(E!==null?function(){b.continue(E+_)}:S),!1}),e}function Qt(e,t,r,i){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:i}}function Mi(e){return{type:1,lower:e,upper:e}}var Di=(Object.defineProperty(st.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),st.prototype.between=function(e,t,r,i){r=r!==!1,i=i===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(r||i)&&(!r||!i)?Sn(this):new this.Collection(this,function(){return Qt(e,t,!r,!i)})}catch{return St(this,Bt)}},st.prototype.equals=function(e){return e==null?St(this,Bt):new this.Collection(this,function(){return Mi(e)})},st.prototype.above=function(e){return e==null?St(this,Bt):new this.Collection(this,function(){return Qt(e,void 0,!0)})},st.prototype.aboveOrEqual=function(e){return e==null?St(this,Bt):new this.Collection(this,function(){return Qt(e,void 0,!1)})},st.prototype.below=function(e){return e==null?St(this,Bt):new this.Collection(this,function(){return Qt(void 0,e,!1,!0)})},st.prototype.belowOrEqual=function(e){return e==null?St(this,Bt):new this.Collection(this,function(){return Qt(void 0,e)})},st.prototype.startsWith=function(e){return typeof e!="string"?St(this,_i):this.between(e,e+un,!0,!0)},st.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):nr(this,function(t,r){return t.indexOf(r[0])===0},[e],un)},st.prototype.equalsIgnoreCase=function(e){return nr(this,function(t,r){return t===r[0]},[e],"")},st.prototype.anyOfIgnoreCase=function(){var e=Me.apply(Ae,arguments);return e.length===0?Sn(this):nr(this,function(t,r){return r.indexOf(t)!==-1},e,"")},st.prototype.startsWithAnyOfIgnoreCase=function(){var e=Me.apply(Ae,arguments);return e.length===0?Sn(this):nr(this,function(t,r){return r.some(function(i){return t.indexOf(i)===0})},e,un)},st.prototype.anyOf=function(){var e=this,t=Me.apply(Ae,arguments),r=this._cmp;try{t.sort(r)}catch{return St(this,Bt)}if(t.length===0)return Sn(this);var i=new this.Collection(this,function(){return Qt(t[0],t[t.length-1])});i._ondirectionchange=function(o){r=o==="next"?e._ascending:e._descending,t.sort(r)};var a=0;return i._addAlgorithm(function(o,c,f){for(var g=o.key;0<r(g,t[a]);)if(++a===t.length)return c(f),!1;return r(g,t[a])===0||(c(function(){o.continue(t[a])}),!1)}),i},st.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},st.prototype.noneOf=function(){var e=Me.apply(Ae,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return St(this,Bt)}var t=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[-1/0,i]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},st.prototype.inAnyRange=function(C,t){var r=this,i=this._cmp,a=this._ascending,o=this._descending,c=this._min,f=this._max;if(C.length===0)return Sn(this);if(!C.every(function(A){return A[0]!==void 0&&A[1]!==void 0&&a(A[0],A[1])<=0}))return St(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",K.InvalidArgument);var g=!t||t.includeLowers!==!1,m=t&&t.includeUppers===!0,_,v=a;function x(A,E){return v(A[0],E[0])}try{(_=C.reduce(function(A,E){for(var H=0,B=A.length;H<B;++H){var Y=A[H];if(i(E[0],Y[1])<0&&0<i(E[1],Y[0])){Y[0]=c(Y[0],E[0]),Y[1]=f(Y[1],E[1]);break}}return H===B&&A.push(E),A},[])).sort(x)}catch{return St(this,Bt)}var y=0,b=m?function(A){return 0<a(A,_[y][1])}:function(A){return 0<=a(A,_[y][1])},w=g?function(A){return 0<o(A,_[y][0])}:function(A){return 0<=o(A,_[y][0])},S=b,C=new this.Collection(this,function(){return Qt(_[0][0],_[_.length-1][1],!g,!m)});return C._ondirectionchange=function(A){v=A==="next"?(S=b,a):(S=w,o),_.sort(x)},C._addAlgorithm(function(A,E,H){for(var B,Y=A.key;S(Y);)if(++y===_.length)return E(H),!1;return!b(B=Y)&&!w(B)||(r._cmp(Y,_[y][1])===0||r._cmp(Y,_[y][0])===0||E(function(){v===a?A.continue(_[y][0]):A.continue(_[y][1])}),!1)}),C},st.prototype.startsWithAnyOf=function(){var e=Me.apply(Ae,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?Sn(this):this.inAnyRange(e.map(function(t){return[t,t+un]})):St(this,"startsWithAnyOf() only works with strings")},st);function st(){}function Ft(e){return Ge(function(t){return Mn(t),e(t.target.error),!1})}function Mn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Dn="storagemutated",Nr="x-storagemutated-1",Xt=Tn(null,Dn),Da=(Nt.prototype._lock=function(){return R(!ue.global),++this._reculock,this._reculock!==1||ue.global||(ue.lockOwnerFor=this),this},Nt.prototype._unlock=function(){if(R(!ue.global),--this._reculock==0)for(ue.global||(ue.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ln(e[1],e[0])}catch{}}return this},Nt.prototype._locked=function(){return this._reculock&&ue.lockOwnerFor!==this},Nt.prototype.create=function(e){var t=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(R(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new K.DatabaseClosed(i);case"MissingAPIError":throw new K.MissingAPI(i.message,i);default:throw new K.OpenFailed(i)}if(!this.active)throw new K.TransactionInactive;return R(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ge(function(a){Mn(a),t._reject(e.error)}),e.onabort=Ge(function(a){Mn(a),t.active&&t._reject(new K.Abort(e.error)),t.active=!1,t.on("abort").fire(a)}),e.oncomplete=Ge(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Xt.storagemutated.fire(e.mutatedParts)}),this},Nt.prototype._promise=function(e,t,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return Je(new K.ReadOnly("Transaction is readonly"));if(!this.active)return Je(new K.TransactionInactive);if(this._locked())return new X(function(o,c){i._blockedFuncs.push([function(){i._promise(e,t,r).then(o,c)},ue])});if(r)return Wt(function(){var o=new X(function(c,f){i._lock();var g=t(c,f,i);g&&g.then&&g.then(c,f)});return o.finally(function(){return i._unlock()}),o._lib=!0,o});var a=new X(function(o,c){var f=t(o,c,i);f&&f.then&&f.then(o,c)});return a._lib=!0,a},Nt.prototype._root=function(){return this.parent?this.parent._root():this},Nt.prototype.waitFor=function(e){var t,r=this._root(),i=X.resolve(e);r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return i}):(r._waitingFor=i,r._waitingQueue=[],t=r.idbtrans.objectStore(r.storeNames[0]),(function o(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(t.get(-1/0).onsuccess=o)})());var a=r._waitingFor;return new X(function(o,c){i.then(function(f){return r._waitingQueue.push(Ge(o.bind(null,f)))},function(f){return r._waitingQueue.push(Ge(c.bind(null,f)))}).finally(function(){r._waitingFor===a&&(r._waitingFor=null)})})},Nt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new K.Abort))},Nt.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(F(t,e))return t[e];var r=this.schema[e];if(!r)throw new K.NotFound("Table "+e+" not part of transaction");return r=new this.db.Table(e,r,this),r.core=this.db.core.table(e),t[e]=r},Nt);function Nt(){}function Hr(e,t,r,i,a,o,c,f){return{name:e,keyPath:t,unique:r,multi:i,auto:a,compound:o,src:(r&&!c?"&":"")+(i?"*":"")+(a?"++":"")+Li(t),type:f}}function Li(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function zr(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:(i=function(a){return[a.name,a]},r.reduce(function(a,o,c){return c=i(o,c),c&&(a[c[0]]=c[1]),a},{}))};var i}var Ln=function(e){try{return e.only([[]]),Ln=function(){return[[]]},[[]]}catch{return Ln=function(){return un},un}};function Kr(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(r){return r[t]}:function(r){return te(r,t)}:function(r){return te(r,e)};var t}function Fi(e){return[].slice.call(e)}var La=0;function Fn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Fa(e,t,g){function i(S){if(S.type===3)return null;if(S.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var y=S.lower,b=S.upper,w=S.lowerOpen,S=S.upperOpen;return y===void 0?b===void 0?null:t.upperBound(b,!!S):b===void 0?t.lowerBound(y,!!w):t.bound(y,b,!!w,!!S)}function a(x){var y,b=x.name;return{name:b,schema:x,mutate:function(w){var S=w.trans,C=w.type,A=w.keys,E=w.values,H=w.range;return new Promise(function(B,Y){B=Ge(B);var j=S.objectStore(b),q=j.keyPath==null,Q=C==="put"||C==="add";if(!Q&&C!=="delete"&&C!=="deleteRange")throw new Error("Invalid operation type: "+C);var G,ae=(A||E||{length:1}).length;if(A&&E&&A.length!==E.length)throw new Error("Given keys array must have same length as given values array.");if(ae===0)return B({numFailures:0,failures:{},results:[],lastResult:void 0});function _e(pt){++xt,Mn(pt)}var Ce=[],Oe=[],xt=0;if(C==="deleteRange"){if(H.type===4)return B({numFailures:xt,failures:Oe,results:[],lastResult:void 0});H.type===3?Ce.push(G=j.clear()):Ce.push(G=j.delete(i(H)))}else{var q=Q?q?[E,A]:[E,null]:[A,null],we=q[0],dt=q[1];if(Q)for(var ft=0;ft<ae;++ft)Ce.push(G=dt&&dt[ft]!==void 0?j[C](we[ft],dt[ft]):j[C](we[ft])),G.onerror=_e;else for(ft=0;ft<ae;++ft)Ce.push(G=j[C](we[ft])),G.onerror=_e}function vr(pt){pt=pt.target.result,Ce.forEach(function(hn,ri){return hn.error!=null&&(Oe[ri]=hn.error)}),B({numFailures:xt,failures:Oe,results:C==="delete"?A:Ce.map(function(hn){return hn.result}),lastResult:pt})}G.onerror=function(pt){_e(pt),vr(pt)},G.onsuccess=vr})},getMany:function(w){var S=w.trans,C=w.keys;return new Promise(function(A,E){A=Ge(A);for(var H,B=S.objectStore(b),Y=C.length,j=new Array(Y),q=0,Q=0,G=function(Ce){Ce=Ce.target,j[Ce._pos]=Ce.result,++Q===q&&A(j)},ae=Ft(E),_e=0;_e<Y;++_e)C[_e]!=null&&((H=B.get(C[_e]))._pos=_e,H.onsuccess=G,H.onerror=ae,++q);q===0&&A(j)})},get:function(w){var S=w.trans,C=w.key;return new Promise(function(A,E){A=Ge(A);var H=S.objectStore(b).get(C);H.onsuccess=function(B){return A(B.target.result)},H.onerror=Ft(E)})},query:(y=m,function(w){return new Promise(function(S,C){S=Ge(S);var A,E,H,q=w.trans,B=w.values,Y=w.limit,G=w.query,j=Y===1/0?void 0:Y,Q=G.index,G=G.range,q=q.objectStore(b),Q=Q.isPrimaryKey?q:q.index(Q.name),G=i(G);if(Y===0)return S({result:[]});y?((j=B?Q.getAll(G,j):Q.getAllKeys(G,j)).onsuccess=function(ae){return S({result:ae.target.result})},j.onerror=Ft(C)):(A=0,E=!B&&"openKeyCursor"in Q?Q.openKeyCursor(G):Q.openCursor(G),H=[],E.onsuccess=function(ae){var _e=E.result;return _e?(H.push(B?_e.value:_e.primaryKey),++A===Y?S({result:H}):void _e.continue()):S({result:H})},E.onerror=Ft(C))})}),openCursor:function(w){var S=w.trans,C=w.values,A=w.query,E=w.reverse,H=w.unique;return new Promise(function(B,Y){B=Ge(B);var Q=A.index,j=A.range,q=S.objectStore(b),q=Q.isPrimaryKey?q:q.index(Q.name),Q=E?H?"prevunique":"prev":H?"nextunique":"next",G=!C&&"openKeyCursor"in q?q.openKeyCursor(i(j),Q):q.openCursor(i(j),Q);G.onerror=Ft(Y),G.onsuccess=Ge(function(ae){var _e,Ce,Oe,xt,we=G.result;we?(we.___id=++La,we.done=!1,_e=we.continue.bind(we),Ce=(Ce=we.continuePrimaryKey)&&Ce.bind(we),Oe=we.advance.bind(we),xt=function(){throw new Error("Cursor not stopped")},we.trans=S,we.stop=we.continue=we.continuePrimaryKey=we.advance=function(){throw new Error("Cursor not started")},we.fail=Ge(Y),we.next=function(){var dt=this,ft=1;return this.start(function(){return ft--?dt.continue():dt.stop()}).then(function(){return dt})},we.start=function(dt){function ft(){if(G.result)try{dt()}catch(pt){we.fail(pt)}else we.done=!0,we.start=function(){throw new Error("Cursor behind last entry")},we.stop()}var vr=new Promise(function(pt,hn){pt=Ge(pt),G.onerror=Ft(hn),we.fail=hn,we.stop=function(ri){we.stop=we.continue=we.continuePrimaryKey=we.advance=xt,pt(ri)}});return G.onsuccess=Ge(function(pt){G.onsuccess=ft,ft()}),we.continue=_e,we.continuePrimaryKey=Ce,we.advance=Oe,ft(),vr},B(we)):B(null)},Y)})},count:function(w){var S=w.query,C=w.trans,A=S.index,E=S.range;return new Promise(function(H,B){var Y=C.objectStore(b),j=A.isPrimaryKey?Y:Y.index(A.name),Y=i(E),j=Y?j.count(Y):j.count();j.onsuccess=Ge(function(q){return H(q.target.result)}),j.onerror=Ft(B)})}}}var o,c,f,_=(c=g,f=Fi((o=e).objectStoreNames),{schema:{name:o.name,tables:f.map(function(x){return c.objectStore(x)}).map(function(x){var y=x.keyPath,S=x.autoIncrement,b=I(y),w={},S={name:x.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y==null,compound:b,keyPath:y,autoIncrement:S,unique:!0,extractKey:Kr(y)},indexes:Fi(x.indexNames).map(function(C){return x.index(C)}).map(function(H){var A=H.name,E=H.unique,B=H.multiEntry,H=H.keyPath,B={name:A,compound:I(H),keyPath:H,unique:E,multiEntry:B,extractKey:Kr(H)};return w[Fn(H)]=B}),getIndexByKeyPath:function(C){return w[Fn(C)]}};return w[":id"]=S.primaryKey,y!=null&&(w[Fn(y)]=S.primaryKey),S})},hasGetAll:0<f.length&&"getAll"in c.objectStore(f[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),g=_.schema,m=_.hasGetAll,_=g.tables.map(a),v={};return _.forEach(function(x){return v[x.name]=x}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(x){if(!v[x])throw new Error("Table '".concat(x,"' not found"));return v[x]},MIN_KEY:-1/0,MAX_KEY:Ln(t),schema:g}}function Na(e,t,r,i){var a=r.IDBKeyRange;return r.indexedDB,{dbcore:(i=Fa(t,a,i),e.dbcore.reduce(function(o,c){return c=c.create,l(l({},o),c(o))},i))}}function rr(e,i){var r=i.db,i=Na(e._middlewares,r,e._deps,i);e.core=i.dbcore,e.tables.forEach(function(a){var o=a.name;e.core.schema.tables.some(function(c){return c.name===o})&&(a.core=e.core.table(o),e[o]instanceof e.Table&&(e[o].core=a.core))})}function ir(e,t,r,i){r.forEach(function(a){var o=i[a];t.forEach(function(c){var f=(function g(m,_){return J(m,_)||(m=O(m))&&g(m,_)})(c,a);(!f||"value"in f&&f.value===void 0)&&(c===e.Transaction.prototype||c instanceof e.Transaction?T(c,a,{get:function(){return this.table(a)},set:function(g){N(this,a,{value:g,writable:!0,configurable:!0,enumerable:!0})}}):c[a]=new e.Table(a,o))})})}function Rr(e,t){t.forEach(function(r){for(var i in r)r[i]instanceof e.Table&&delete r[i]})}function Ha(e,t){return e._cfg.version-t._cfg.version}function za(e,t,r,i){var a=e._dbSchema;r.objectStoreNames.contains("$meta")&&!a.$meta&&(a.$meta=zr("$meta",Hi("")[0],[]),e._storeNames.push("$meta"));var o=e._createTransaction("readwrite",e._storeNames,a);o.create(r),o._completion.catch(i);var c=o._reject.bind(o),f=ue.transless||ue;Wt(function(){return ue.trans=o,ue.transless=f,t!==0?(rr(e,r),m=t,((g=o).storeNames.includes("$meta")?g.table("$meta").get("version").then(function(_){return _??m}):X.resolve(m)).then(function(_){return x=_,y=o,b=r,w=[],_=(v=e)._versions,S=v._dbSchema=or(0,v.idbdb,b),(_=_.filter(function(C){return C._cfg.version>=x})).length!==0?(_.forEach(function(C){w.push(function(){var A=S,E=C._cfg.dbschema;sr(v,A,b),sr(v,E,b),S=v._dbSchema=E;var H=jr(A,E);H.add.forEach(function(Q){Br(b,Q[0],Q[1].primKey,Q[1].indexes)}),H.change.forEach(function(Q){if(Q.recreate)throw new K.Upgrade("Not yet support for changing primary key");var G=b.objectStore(Q.name);Q.add.forEach(function(ae){return ar(G,ae)}),Q.change.forEach(function(ae){G.deleteIndex(ae.name),ar(G,ae)}),Q.del.forEach(function(ae){return G.deleteIndex(ae)})});var B=C._cfg.contentUpgrade;if(B&&C._cfg.version>x){rr(v,b),y._memoizedTables={};var Y=ye(E);H.del.forEach(function(Q){Y[Q]=A[Q]}),Rr(v,[v.Transaction.prototype]),ir(v,[v.Transaction.prototype],p(Y),Y),y.schema=Y;var j,q=Be(B);return q&&bn(),H=X.follow(function(){var Q;(j=B(y))&&q&&(Q=$t.bind(null,null),j.then(Q,Q))}),j&&typeof j.then=="function"?X.resolve(j):H.then(function(){return j})}}),w.push(function(A){var E,H,B=C._cfg.dbschema;E=B,H=A,[].slice.call(H.db.objectStoreNames).forEach(function(Y){return E[Y]==null&&H.db.deleteObjectStore(Y)}),Rr(v,[v.Transaction.prototype]),ir(v,[v.Transaction.prototype],v._storeNames,v._dbSchema),y.schema=v._dbSchema}),w.push(function(A){v.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(v.idbdb.version/10)===C._cfg.version?(v.idbdb.deleteObjectStore("$meta"),delete v._dbSchema.$meta,v._storeNames=v._storeNames.filter(function(E){return E!=="$meta"})):A.objectStore("$meta").put(C._cfg.version,"version"))})}),(function C(){return w.length?X.resolve(w.shift()(y.idbtrans)).then(C):X.resolve()})().then(function(){Ni(S,b)})):X.resolve();var v,x,y,b,w,S}).catch(c)):(p(a).forEach(function(_){Br(r,_,a[_].primKey,a[_].indexes)}),rr(e,r),void X.follow(function(){return e.on.populate.fire(o)}).catch(c));var g,m})}function Ka(e,t){Ni(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var r=or(0,e.idbdb,t);sr(e,e._dbSchema,t);for(var i=0,a=jr(r,e._dbSchema).change;i<a.length;i++){var o=(function(c){if(c.change.length||c.recreate)return console.warn("Unable to patch indexes of table ".concat(c.name," because it has changes on the type of index or primary key.")),{value:void 0};var f=t.objectStore(c.name);c.add.forEach(function(g){yt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(c.name,".").concat(g.src)),ar(f,g)})})(a[i]);if(typeof o=="object")return o.value}}function jr(e,t){var r,i={del:[],add:[],change:[]};for(r in e)t[r]||i.del.push(r);for(r in t){var a=e[r],o=t[r];if(a){var c={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||a.primKey.auto!==o.primKey.auto)c.recreate=!0,i.change.push(c);else{var f=a.idxByName,g=o.idxByName,m=void 0;for(m in f)g[m]||c.del.push(m);for(m in g){var _=f[m],v=g[m];_?_.src!==v.src&&c.change.push(v):c.add.push(v)}(0<c.del.length||0<c.add.length||0<c.change.length)&&i.change.push(c)}}else i.add.push([r,o])}return i}function Br(e,t,r,i){var a=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return i.forEach(function(o){return ar(a,o)}),a}function Ni(e,t){p(e).forEach(function(r){t.db.objectStoreNames.contains(r)||(yt&&console.debug("Dexie: Creating missing table",r),Br(t,r,e[r].primKey,e[r].indexes))})}function ar(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function or(e,t,r){var i={};return ne(t.objectStoreNames,0).forEach(function(a){for(var o=r.objectStore(a),c=Hr(Li(m=o.keyPath),m||"",!0,!1,!!o.autoIncrement,m&&typeof m!="string",!0),f=[],g=0;g<o.indexNames.length;++g){var _=o.index(o.indexNames[g]),m=_.keyPath,_=Hr(_.name,m,!!_.unique,!!_.multiEntry,!1,m&&typeof m!="string",!1);f.push(_)}i[a]=zr(a,c,f)}),i}function sr(e,t,r){for(var i=r.db.objectStoreNames,a=0;a<i.length;++a){var o=i[a],c=r.objectStore(o);e._hasGetAll="getAll"in c;for(var f=0;f<c.indexNames.length;++f){var g=c.indexNames[f],m=c.index(g).keyPath,_=typeof m=="string"?m:"["+ne(m).join("+")+"]";!t[o]||(m=t[o].idxByName[_])&&(m.name=g,delete t[o].idxByName[_],t[o].idxByName[g]=m)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&h.WorkerGlobalScope&&h instanceof h.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Hi(e){return e.split(",").map(function(t,r){var o=t.split(":"),i=(a=o[1])===null||a===void 0?void 0:a.trim(),a=(t=o[0].trim()).replace(/([&*]|\+\+)/g,""),o=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return Hr(a,o||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),I(o),r===0,i)})}var Ra=(xn.prototype._createTableSchema=zr,xn.prototype._parseIndexSyntax=Hi,xn.prototype._parseStoresSpec=function(e,t){var r=this;p(e).forEach(function(i){if(e[i]!==null){var a=r._parseIndexSyntax(e[i]),o=a.shift();if(!o)throw new K.Schema("Invalid schema for table "+i+": "+e[i]);if(o.unique=!0,o.multi)throw new K.Schema("Primary key cannot be multiEntry*");a.forEach(function(c){if(c.auto)throw new K.Schema("Only primary key can be marked as autoIncrement (++)");if(!c.keyPath)throw new K.Schema("Index must have a name and cannot be an empty string")}),a=r._createTableSchema(i,o,a),t[i]=a}})},xn.prototype.stores=function(r){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?M(this._cfg.storesSource,r):r;var r=t._versions,i={},a={};return r.forEach(function(o){M(i,o._cfg.storesSource),a=o._cfg.dbschema={},o._parseStoresSpec(i,a)}),t._dbSchema=a,Rr(t,[t._allTables,t,t.Transaction.prototype]),ir(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],p(a),a),t._storeNames=p(a),this},xn.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Ut(this._cfg.contentUpgrade||fe,e),this},xn);function xn(){}function Vr(e,t){var r=e._dbNamesDB;return r||(r=e._dbNamesDB=new Vt(Xn,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function qr(e){return e&&typeof e.databases=="function"}function Ur(e){return Wt(function(){return ue.letThrough=!0,e()})}function Gr(e){return!("from"in e)}var ct=function(e,t){if(!this){var r=new ct;return e&&"d"in e&&M(r,e),r}M(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Nn(e,t,r){var i=Le(t,r);if(!isNaN(i)){if(0<i)throw RangeError();if(Gr(e))return M(e,{from:t,to:r,d:1});var a=e.l,i=e.r;if(Le(r,e.from)<0)return a?Nn(a,t,r):e.l={from:t,to:r,d:1,l:null,r:null},Ki(e);if(0<Le(t,e.to))return i?Nn(i,t,r):e.r={from:t,to:r,d:1,l:null,r:null},Ki(e);Le(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),0<Le(r,e.to)&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1),r=!e.r,a&&!e.l&&Hn(e,a),i&&r&&Hn(e,i)}}function Hn(e,t){Gr(t)||(function r(i,g){var o=g.from,c=g.to,f=g.l,g=g.r;Nn(i,o,c),f&&r(i,f),g&&r(i,g)})(e,t)}function zi(e,t){var r=lr(t),i=r.next();if(i.done)return!1;for(var a=i.value,o=lr(e),c=o.next(a.from),f=c.value;!i.done&&!c.done;){if(Le(f.from,a.to)<=0&&0<=Le(f.to,a.from))return!0;Le(a.from,f.from)<0?a=(i=r.next(f.from)).value:f=(c=o.next(a.from)).value}return!1}function lr(e){var t=Gr(e)?null:{s:0,n:e};return{next:function(r){for(var i=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,i)for(;t.n.l&&Le(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!i||Le(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Ki(e){var t,r,i=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),a=1<i?"r":i<-1?"l":"";a&&(t=a=="r"?"l":"r",r=l({},e),i=e[a],e.from=i.from,e.to=i.to,e[a]=i[a],r[a]=i[t],(e[t]=r).d=Ri(r)),e.d=Ri(e)}function Ri(r){var t=r.r,r=r.l;return(t?r?Math.max(t.d,r.d):t.d:r?r.d:0)+1}function ur(e,t){return p(t).forEach(function(r){e[r]?Hn(e[r],t[r]):e[r]=(function i(a){var o,c,f={};for(o in a)F(a,o)&&(c=a[o],f[o]=!c||typeof c!="object"||ve.has(c.constructor)?c:i(c));return f})(t[r])}),e}function Wr(e,t){return e.all||t.all||Object.keys(e).some(function(r){return t[r]&&zi(t[r],e[r])})}z(ct.prototype,((It={add:function(e){return Hn(this,e),this},addKey:function(e){return Nn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(r){return Nn(t,r,r)}),this},hasKey:function(e){var t=lr(this).next(e).value;return t&&Le(t.from,e)<=0&&0<=Le(t.to,e)}})[be]=function(){return lr(this)},It));var dn={},$r={},Yr=!1;function cr(e){ur($r,e),Yr||(Yr=!0,setTimeout(function(){Yr=!1,Qr($r,!($r={}))},0))}function Qr(e,t){t===void 0&&(t=!1);var r=new Set;if(e.all)for(var i=0,a=Object.values(dn);i<a.length;i++)ji(c=a[i],e,r,t);else for(var o in e){var c,f=/^idb\:\/\/(.*)\/(.*)\//.exec(o);f&&(o=f[1],f=f[2],(c=dn["idb://".concat(o,"/").concat(f)])&&ji(c,e,r,t))}r.forEach(function(g){return g()})}function ji(e,t,r,i){for(var a=[],o=0,c=Object.entries(e.queries.query);o<c.length;o++){for(var f=c[o],g=f[0],m=[],_=0,v=f[1];_<v.length;_++){var x=v[_];Wr(t,x.obsSet)?x.subscribers.forEach(function(S){return r.add(S)}):i&&m.push(x)}i&&a.push([g,m])}if(i)for(var y=0,b=a;y<b.length;y++){var w=b[y],g=w[0],m=w[1];e.queries.query[g]=m}}function ja(e){var t=e._state,r=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?Je(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var i=t.openCanceller,a=Math.round(10*e.verno),o=!1;function c(){if(t.openCanceller!==i)throw new K.DatabaseClosed("db.open() was cancelled")}function f(){return new X(function(x,y){if(c(),!r)throw new K.MissingAPI;var b=e.name,w=t.autoSchema||!a?r.open(b):r.open(b,a);if(!w)throw new K.MissingAPI;w.onerror=Ft(y),w.onblocked=Ge(e._fireOnBlocked),w.onupgradeneeded=Ge(function(S){var C;_=w.transaction,t.autoSchema&&!e._options.allowEmptyDB?(w.onerror=Mn,_.abort(),w.result.close(),(C=r.deleteDatabase(b)).onsuccess=C.onerror=Ge(function(){y(new K.NoSuchDatabase("Database ".concat(b," doesnt exist")))})):(_.onerror=Ft(y),S=S.oldVersion>Math.pow(2,62)?0:S.oldVersion,v=S<1,e.idbdb=w.result,o&&Ka(e,_),za(e,S/10,_,y))},y),w.onsuccess=Ge(function(){_=null;var S,C,A,E,H,B=e.idbdb=w.result,Y=ne(B.objectStoreNames);if(0<Y.length)try{var j=B.transaction((E=Y).length===1?E[0]:E,"readonly");if(t.autoSchema)C=B,A=j,(S=e).verno=C.version/10,A=S._dbSchema=or(0,C,A),S._storeNames=ne(C.objectStoreNames,0),ir(S,[S._allTables],p(A),A);else if(sr(e,e._dbSchema,j),((H=jr(or(0,(H=e).idbdb,j),H._dbSchema)).add.length||H.change.some(function(q){return q.add.length||q.change.length}))&&!o)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),B.close(),a=B.version+1,o=!0,x(f());rr(e,j)}catch{}wn.push(e),B.onversionchange=Ge(function(q){t.vcFired=!0,e.on("versionchange").fire(q)}),B.onclose=Ge(function(){e.close({disableAutoOpen:!1})}),v&&(H=e._deps,j=b,B=H.indexedDB,H=H.IDBKeyRange,qr(B)||j===Xn||Vr(B,H).put({name:j}).catch(fe)),x()},y)}).catch(function(x){switch(x?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),f();break;case"VersionError":if(0<a)return a=0,f()}return X.reject(x)})}var g,m=t.dbReadyResolve,_=null,v=!1;return X.race([i,(typeof navigator>"u"?X.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(x){function y(){return indexedDB.databases().finally(x)}g=setInterval(y,100),y()}).finally(function(){return clearInterval(g)}):Promise.resolve()).then(f)]).then(function(){return c(),t.onReadyBeingFired=[],X.resolve(Ur(function(){return e.on.ready.fire(e.vip)})).then(function x(){if(0<t.onReadyBeingFired.length){var y=t.onReadyBeingFired.reduce(Ut,fe);return t.onReadyBeingFired=[],X.resolve(Ur(function(){return y(e.vip)})).then(x)}})}).finally(function(){t.openCanceller===i&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(x){t.dbOpenError=x;try{_&&_.abort()}catch{}return i===t.openCanceller&&e._close(),Je(x)}).finally(function(){t.openComplete=!0,m()}).then(function(){var x;return v&&(x={},e.tables.forEach(function(y){y.schema.indexes.forEach(function(b){b.name&&(x["idb://".concat(e.name,"/").concat(y.name,"/").concat(b.name)]=new ct(-1/0,[[[]]]))}),x["idb://".concat(e.name,"/").concat(y.name,"/")]=x["idb://".concat(e.name,"/").concat(y.name,"/:dels")]=new ct(-1/0,[[[]]])}),Xt(Dn).fire(x),Qr(x,!0)),e})}function Xr(e){function t(o){return e.next(o)}var r=a(t),i=a(function(o){return e.throw(o)});function a(o){return function(g){var f=o(g),g=f.value;return f.done?g:g&&typeof g.then=="function"?g.then(r,i):I(g)?Promise.all(g).then(r,i):r(g)}}return a(t)()}function dr(e,t,r){for(var i=I(e)?e.slice():[e],a=0;a<r;++a)i.push(t);return i}var Ba={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return l(l({},e),{table:function(t){var r=e.table(t),i=r.schema,a={},o=[];function c(v,x,y){var b=Fn(v),w=a[b]=a[b]||[],S=v==null?0:typeof v=="string"?1:v.length,C=0<x,C=l(l({},y),{name:C?"".concat(b,"(virtual-from:").concat(y.name,")"):y.name,lowLevelIndex:y,isVirtual:C,keyTail:x,keyLength:S,extractKey:Kr(v),unique:!C&&y.unique});return w.push(C),C.isPrimaryKey||o.push(C),1<S&&c(S===2?v[0]:v.slice(0,S-1),x+1,y),w.sort(function(A,E){return A.keyTail-E.keyTail}),C}t=c(i.primaryKey.keyPath,0,i.primaryKey),a[":id"]=[t];for(var f=0,g=i.indexes;f<g.length;f++){var m=g[f];c(m.keyPath,0,m)}function _(v){var x,y=v.query.index;return y.isVirtual?l(l({},v),{query:{index:y.lowLevelIndex,range:(x=v.query.range,y=y.keyTail,{type:x.type===1?2:x.type,lower:dr(x.lower,x.lowerOpen?e.MAX_KEY:e.MIN_KEY,y),lowerOpen:!0,upper:dr(x.upper,x.upperOpen?e.MIN_KEY:e.MAX_KEY,y),upperOpen:!0})}}):v}return l(l({},r),{schema:l(l({},i),{primaryKey:t,indexes:o,getIndexByKeyPath:function(v){return(v=a[Fn(v)])&&v[0]}}),count:function(v){return r.count(_(v))},query:function(v){return r.query(_(v))},openCursor:function(v){var x=v.query.index,y=x.keyTail,b=x.isVirtual,w=x.keyLength;return b?r.openCursor(_(v)).then(function(C){return C&&S(C)}):r.openCursor(v);function S(C){return Object.create(C,{continue:{value:function(A){A!=null?C.continue(dr(A,v.reverse?e.MAX_KEY:e.MIN_KEY,y)):v.unique?C.continue(C.key.slice(0,w).concat(v.reverse?e.MIN_KEY:e.MAX_KEY,y)):C.continue()}},continuePrimaryKey:{value:function(A,E){C.continuePrimaryKey(dr(A,e.MAX_KEY,y),E)}},primaryKey:{get:function(){return C.primaryKey}},key:{get:function(){var A=C.key;return w===1?A[0]:A.slice(0,w)}},value:{get:function(){return C.value}}})}}})}})}};function Zr(e,t,r,i){return r=r||{},i=i||"",p(e).forEach(function(a){var o,c,f;F(t,a)?(o=e[a],c=t[a],typeof o=="object"&&typeof c=="object"&&o&&c?(f=Pe(o))!==Pe(c)?r[i+a]=t[a]:f==="Object"?Zr(o,c,r,i+a+"."):o!==c&&(r[i+a]=t[a]):o!==c&&(r[i+a]=t[a])):r[i+a]=void 0}),p(t).forEach(function(a){F(e,a)||(r[i+a]=t[a])}),r}function Jr(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Va={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return l(l({},e),{table:function(t){var r=e.table(t),i=r.schema.primaryKey;return l(l({},r),{mutate:function(a){var o=ue.trans,c=o.table(t).hook,f=c.deleting,g=c.creating,m=c.updating;switch(a.type){case"add":if(g.fire===fe)break;return o._promise("readwrite",function(){return _(a)},!0);case"put":if(g.fire===fe&&m.fire===fe)break;return o._promise("readwrite",function(){return _(a)},!0);case"delete":if(f.fire===fe)break;return o._promise("readwrite",function(){return _(a)},!0);case"deleteRange":if(f.fire===fe)break;return o._promise("readwrite",function(){return(function v(x,y,b){return r.query({trans:x,values:!1,query:{index:i,range:y},limit:b}).then(function(w){var S=w.result;return _({type:"delete",keys:S,trans:x}).then(function(C){return 0<C.numFailures?Promise.reject(C.failures[0]):S.length<b?{failures:[],numFailures:0,lastResult:void 0}:v(x,l(l({},y),{lower:S[S.length-1],lowerOpen:!0}),b)})})})(a.trans,a.range,1e4)},!0)}return r.mutate(a);function _(v){var x,y,b,w=ue.trans,S=v.keys||Jr(i,v);if(!S)throw new Error("Keys missing");return(v=v.type==="add"||v.type==="put"?l(l({},v),{keys:S}):l({},v)).type!=="delete"&&(v.values=d([],v.values)),v.keys&&(v.keys=d([],v.keys)),x=r,b=S,((y=v).type==="add"?Promise.resolve([]):x.getMany({trans:y.trans,keys:b,cache:"immutable"})).then(function(C){var A=S.map(function(E,H){var B,Y,j,q=C[H],Q={onerror:null,onsuccess:null};return v.type==="delete"?f.fire.call(Q,E,q,w):v.type==="add"||q===void 0?(B=g.fire.call(Q,E,v.values[H],w),E==null&&B!=null&&(v.keys[H]=E=B,i.outbound||oe(v.values[H],i.keyPath,E))):(B=Zr(q,v.values[H]),(Y=m.fire.call(Q,B,E,q,w))&&(j=v.values[H],Object.keys(Y).forEach(function(G){F(j,G)?j[G]=Y[G]:oe(j,G,Y[G])}))),Q});return r.mutate(v).then(function(E){for(var H=E.failures,B=E.results,Y=E.numFailures,E=E.lastResult,j=0;j<S.length;++j){var q=(B||S)[j],Q=A[j];q==null?Q.onerror&&Q.onerror(H[j]):Q.onsuccess&&Q.onsuccess(v.type==="put"&&C[j]?v.values[j]:q)}return{failures:H,results:B,numFailures:Y,lastResult:E}}).catch(function(E){return A.forEach(function(H){return H.onerror&&H.onerror(E)}),Promise.reject(E)})})}}})}})}};function Bi(e,t,r){try{if(!t||t.keys.length<e.length)return null;for(var i=[],a=0,o=0;a<t.keys.length&&o<e.length;++a)Le(t.keys[a],e[o])===0&&(i.push(r?ie(t.values[a]):t.values[a]),++o);return i.length===e.length?i:null}catch{return null}}var qa={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var r=e.table(t);return l(l({},r),{getMany:function(i){if(!i.cache)return r.getMany(i);var a=Bi(i.keys,i.trans._cache,i.cache==="clone");return a?X.resolve(a):r.getMany(i).then(function(o){return i.trans._cache={keys:i.keys,values:i.cache==="clone"?ie(o):o},o})},mutate:function(i){return i.type!=="add"&&(i.trans._cache=null),r.mutate(i)}})}}}};function Vi(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function qi(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ua={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,r=new ct(e.MIN_KEY,e.MAX_KEY);return l(l({},e),{transaction:function(i,a,o){if(ue.subscr&&a!=="readonly")throw new K.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ue.querier));return e.transaction(i,a,o)},table:function(i){var a=e.table(i),o=a.schema,c=o.primaryKey,v=o.indexes,f=c.extractKey,g=c.outbound,m=c.autoIncrement&&v.filter(function(y){return y.compound&&y.keyPath.includes(c.keyPath)}),_=l(l({},a),{mutate:function(y){function b(G){return G="idb://".concat(t,"/").concat(i,"/").concat(G),E[G]||(E[G]=new ct)}var w,S,C,A=y.trans,E=y.mutatedParts||(y.mutatedParts={}),H=b(""),B=b(":dels"),Y=y.type,Q=y.type==="deleteRange"?[y.range]:y.type==="delete"?[y.keys]:y.values.length<50?[Jr(c,y).filter(function(G){return G}),y.values]:[],j=Q[0],q=Q[1],Q=y.trans._cache;return I(j)?(H.addKeys(j),(Q=Y==="delete"||j.length===q.length?Bi(j,Q):null)||B.addKeys(j),(Q||q)&&(w=b,S=Q,C=q,o.indexes.forEach(function(G){var ae=w(G.name||"");function _e(Oe){return Oe!=null?G.extractKey(Oe):null}function Ce(Oe){return G.multiEntry&&I(Oe)?Oe.forEach(function(xt){return ae.addKey(xt)}):ae.addKey(Oe)}(S||C).forEach(function(Oe,dt){var we=S&&_e(S[dt]),dt=C&&_e(C[dt]);Le(we,dt)!==0&&(we!=null&&Ce(we),dt!=null&&Ce(dt))})}))):j?(q={from:(q=j.lower)!==null&&q!==void 0?q:e.MIN_KEY,to:(q=j.upper)!==null&&q!==void 0?q:e.MAX_KEY},B.add(q),H.add(q)):(H.add(r),B.add(r),o.indexes.forEach(function(G){return b(G.name).add(r)})),a.mutate(y).then(function(G){return!j||y.type!=="add"&&y.type!=="put"||(H.addKeys(G.results),m&&m.forEach(function(ae){for(var _e=y.values.map(function(we){return ae.extractKey(we)}),Ce=ae.keyPath.findIndex(function(we){return we===c.keyPath}),Oe=0,xt=G.results.length;Oe<xt;++Oe)_e[Oe][Ce]=G.results[Oe];b(ae.name).addKeys(_e)})),A.mutatedParts=ur(A.mutatedParts||{},E),G})}}),v=function(b){var w=b.query,b=w.index,w=w.range;return[b,new ct((b=w.lower)!==null&&b!==void 0?b:e.MIN_KEY,(w=w.upper)!==null&&w!==void 0?w:e.MAX_KEY)]},x={get:function(y){return[c,new ct(y.key)]},getMany:function(y){return[c,new ct().addKeys(y.keys)]},count:v,query:v,openCursor:v};return p(x).forEach(function(y){_[y]=function(b){var w=ue.subscr,S=!!w,C=Vi(ue,a)&&qi(y,b)?b.obsSet={}:w;if(S){var A=function(q){return q="idb://".concat(t,"/").concat(i,"/").concat(q),C[q]||(C[q]=new ct)},E=A(""),H=A(":dels"),w=x[y](b),S=w[0],w=w[1];if((y==="query"&&S.isPrimaryKey&&!b.values?H:A(S.name||"")).add(w),!S.isPrimaryKey){if(y!=="count"){var B=y==="query"&&g&&b.values&&a.query(l(l({},b),{values:!1}));return a[y].apply(this,arguments).then(function(q){if(y==="query"){if(g&&b.values)return B.then(function(_e){return _e=_e.result,E.addKeys(_e),q});var Q=b.values?q.result.map(f):q.result;(b.values?E:H).addKeys(Q)}else if(y==="openCursor"){var G=q,ae=b.values;return G&&Object.create(G,{key:{get:function(){return H.addKey(G.primaryKey),G.key}},primaryKey:{get:function(){var _e=G.primaryKey;return H.addKey(_e),_e}},value:{get:function(){return ae&&E.addKey(G.primaryKey),G.value}}})}return q})}H.add(r)}}return a[y].apply(this,arguments)}}),_}})}};function Ui(e,t,r){if(r.numFailures===0)return t;if(t.type==="deleteRange")return null;var i=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return r.numFailures===i?null:(t=l({},t),I(t.keys)&&(t.keys=t.keys.filter(function(a,o){return!(o in r.failures)})),"values"in t&&I(t.values)&&(t.values=t.values.filter(function(a,o){return!(o in r.failures)})),t)}function ei(e,t){return r=e,((i=t).lower===void 0||(i.lowerOpen?0<Le(r,i.lower):0<=Le(r,i.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?Le(e,t.upper)<0:Le(e,t.upper)<=0));var r,i}function Gi(e,t,x,i,a,o){if(!x||x.length===0)return e;var c=t.query.index,f=c.multiEntry,g=t.query.range,m=i.schema.primaryKey.extractKey,_=c.extractKey,v=(c.lowLevelIndex||c).extractKey,x=x.reduce(function(y,b){var w=y,S=[];if(b.type==="add"||b.type==="put")for(var C=new ct,A=b.values.length-1;0<=A;--A){var E,H=b.values[A],B=m(H);C.hasKey(B)||(E=_(H),(f&&I(E)?E.some(function(G){return ei(G,g)}):ei(E,g))&&(C.addKey(B),S.push(H)))}switch(b.type){case"add":var Y=new ct().addKeys(t.values?y.map(function(ae){return m(ae)}):y),w=y.concat(t.values?S.filter(function(ae){return ae=m(ae),!Y.hasKey(ae)&&(Y.addKey(ae),!0)}):S.map(function(ae){return m(ae)}).filter(function(ae){return!Y.hasKey(ae)&&(Y.addKey(ae),!0)}));break;case"put":var j=new ct().addKeys(b.values.map(function(ae){return m(ae)}));w=y.filter(function(ae){return!j.hasKey(t.values?m(ae):ae)}).concat(t.values?S:S.map(function(ae){return m(ae)}));break;case"delete":var q=new ct().addKeys(b.keys);w=y.filter(function(ae){return!q.hasKey(t.values?m(ae):ae)});break;case"deleteRange":var Q=b.range;w=y.filter(function(ae){return!ei(m(ae),Q)})}return w},e);return x===e?e:(x.sort(function(y,b){return Le(v(y),v(b))||Le(m(y),m(b))}),t.limit&&t.limit<1/0&&(x.length>t.limit?x.length=t.limit:e.length===t.limit&&x.length<t.limit&&(a.dirty=!0)),o?Object.freeze(x):x)}function Wi(e,t){return Le(e.lower,t.lower)===0&&Le(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Ga(e,t){return(function(r,i,a,o){if(r===void 0)return i!==void 0?-1:0;if(i===void 0)return 1;if((i=Le(r,i))===0){if(a&&o)return 0;if(a)return 1;if(o)return-1}return i})(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=(function(r,i,a,o){if(r===void 0)return i!==void 0?1:0;if(i===void 0)return-1;if((i=Le(r,i))===0){if(a&&o)return 0;if(a)return-1;if(o)return 1}return i})(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Wa(e,t,r,i){e.subscribers.add(r),i.addEventListener("abort",function(){var a,o;e.subscribers.delete(r),e.subscribers.size===0&&(a=e,o=t,setTimeout(function(){a.subscribers.size===0&&xe(o,a)},3e3))})}var $a={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return l(l({},e),{transaction:function(r,i,a){var o,c,f=e.transaction(r,i,a);return i==="readwrite"&&(c=(o=new AbortController).signal,a=function(g){return function(){if(o.abort(),i==="readwrite"){for(var m=new Set,_=0,v=r;_<v.length;_++){var x=v[_],y=dn["idb://".concat(t,"/").concat(x)];if(y){var b=e.table(x),w=y.optimisticOps.filter(function(ae){return ae.trans===f});if(f._explicit&&g&&f.mutatedParts)for(var S=0,C=Object.values(y.queries.query);S<C.length;S++)for(var A=0,E=(Y=C[S]).slice();A<E.length;A++)Wr((j=E[A]).obsSet,f.mutatedParts)&&(xe(Y,j),j.subscribers.forEach(function(ae){return m.add(ae)}));else if(0<w.length){y.optimisticOps=y.optimisticOps.filter(function(ae){return ae.trans!==f});for(var H=0,B=Object.values(y.queries.query);H<B.length;H++)for(var Y,j,q,Q=0,G=(Y=B[H]).slice();Q<G.length;Q++)(j=G[Q]).res!=null&&f.mutatedParts&&(g&&!j.dirty?(q=Object.isFrozen(j.res),q=Gi(j.res,j.req,w,b,j,q),j.dirty?(xe(Y,j),j.subscribers.forEach(function(ae){return m.add(ae)})):q!==j.res&&(j.res=q,j.promise=X.resolve({result:q}))):(j.dirty&&xe(Y,j),j.subscribers.forEach(function(ae){return m.add(ae)})))}}}m.forEach(function(ae){return ae()})}}},f.addEventListener("abort",a(!1),{signal:c}),f.addEventListener("error",a(!1),{signal:c}),f.addEventListener("complete",a(!0),{signal:c})),f},table:function(r){var i=e.table(r),a=i.schema.primaryKey;return l(l({},i),{mutate:function(o){var c=ue.trans;if(a.outbound||c.db._options.cache==="disabled"||c.explicit||c.idbtrans.mode!=="readwrite")return i.mutate(o);var f=dn["idb://".concat(t,"/").concat(r)];return f?(c=i.mutate(o),o.type!=="add"&&o.type!=="put"||!(50<=o.values.length||Jr(a,o).some(function(g){return g==null}))?(f.optimisticOps.push(o),o.mutatedParts&&cr(o.mutatedParts),c.then(function(g){0<g.numFailures&&(xe(f.optimisticOps,o),(g=Ui(0,o,g))&&f.optimisticOps.push(g),o.mutatedParts&&cr(o.mutatedParts))}),c.catch(function(){xe(f.optimisticOps,o),o.mutatedParts&&cr(o.mutatedParts)})):c.then(function(g){var m=Ui(0,l(l({},o),{values:o.values.map(function(_,v){var x;return g.failures[v]?_:(_=(x=a.keyPath)!==null&&x!==void 0&&x.includes(".")?ie(_):l({},_),oe(_,a.keyPath,g.results[v]),_)})}),g);f.optimisticOps.push(m),queueMicrotask(function(){return o.mutatedParts&&cr(o.mutatedParts)})}),c):i.mutate(o)},query:function(o){if(!Vi(ue,i)||!qi("query",o))return i.query(o);var c=((m=ue.trans)===null||m===void 0?void 0:m.db._options.cache)==="immutable",v=ue,f=v.requery,g=v.signal,m=(function(b,w,S,C){var A=dn["idb://".concat(b,"/").concat(w)];if(!A)return[];if(!(w=A.queries[S]))return[null,!1,A,null];var E=w[(C.query?C.query.index.name:null)||""];if(!E)return[null,!1,A,null];switch(S){case"query":var H=E.find(function(B){return B.req.limit===C.limit&&B.req.values===C.values&&Wi(B.req.query.range,C.query.range)});return H?[H,!0,A,E]:[E.find(function(B){return("limit"in B.req?B.req.limit:1/0)>=C.limit&&(!C.values||B.req.values)&&Ga(B.req.query.range,C.query.range)}),!1,A,E];case"count":return H=E.find(function(B){return Wi(B.req.query.range,C.query.range)}),[H,!!H,A,E]}})(t,r,"query",o),_=m[0],v=m[1],x=m[2],y=m[3];return _&&v?_.obsSet=o.obsSet:(v=i.query(o).then(function(b){var w=b.result;if(_&&(_.res=w),c){for(var S=0,C=w.length;S<C;++S)Object.freeze(w[S]);Object.freeze(w)}else b.result=ie(w);return b}).catch(function(b){return y&&_&&xe(y,_),Promise.reject(b)}),_={obsSet:o.obsSet,promise:v,subscribers:new Set,type:"query",req:o,dirty:!1},y?y.push(_):(y=[_],(x=x||(dn["idb://".concat(t,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[o.query.index.name||""]=y)),Wa(_,y,f,g),_.promise.then(function(b){return{result:Gi(b.result,o,x?.optimisticOps,i,_,c)}})}})}})}};function fr(e,t){return new Proxy(e,{get:function(r,i,a){return i==="db"?t:Reflect.get(r,i,a)}})}var Vt=(et.prototype.version=function(e){if(isNaN(e)||e<.1)throw new K.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new K.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,r=t.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),t.push(r),t.sort(Ha),r.stores({}),this._state.autoSchema=!1,r)},et.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||ue.letThrough||this._vip)?e():new X(function(r,i){if(t._state.openComplete)return i(new K.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void i(new K.DatabaseClosed);t.open().catch(fe)}t._state.dbReadyPromise.then(r,i)}).then(e)},et.prototype.use=function(e){var t=e.stack,r=e.create,i=e.level,a=e.name;return a&&this.unuse({stack:t,name:a}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:r,level:i??10,name:a}),e.sort(function(o,c){return o.level-c.level}),this},et.prototype.unuse=function(e){var t=e.stack,r=e.name,i=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(a){return i?a.create!==i:!!r&&a.name!==r})),this},et.prototype.open=function(){var e=this;return ln(_t,function(){return ja(e)})},et.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=wn.indexOf(this);if(0<=t&&wn.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new X(function(r){e.dbReadyResolve=r}),e.openCanceller=new X(function(r,i){e.cancelOpen=i}))},et.prototype.close=function(r){var t=(r===void 0?{disableAutoOpen:!0}:r).disableAutoOpen,r=this._state;t?(r.isBeingOpened&&r.cancelOpen(new K.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new K.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},et.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var r=0<arguments.length&&typeof arguments[0]!="object",i=this._state;return new X(function(a,o){function c(){t.close(e);var f=t._deps.indexedDB.deleteDatabase(t.name);f.onsuccess=Ge(function(){var g,m,_;g=t._deps,m=t.name,_=g.indexedDB,g=g.IDBKeyRange,qr(_)||m===Xn||Vr(_,g).delete(m).catch(fe),a()}),f.onerror=Ft(o),f.onblocked=t._fireOnBlocked}if(r)throw new K.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(c):c()})},et.prototype.backendDB=function(){return this.idbdb},et.prototype.isOpen=function(){return this.idbdb!==null},et.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},et.prototype.hasFailed=function(){return this._state.dbOpenError!==null},et.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(et.prototype,"tables",{get:function(){var e=this;return p(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),et.prototype.transaction=function(){var e=(function(t,r,i){var a=arguments.length;if(a<2)throw new K.InvalidArgument("Too few arguments");for(var o=new Array(a-1);--a;)o[a-1]=arguments[a];return i=o.pop(),[t,Ee(o),i]}).apply(this,arguments);return this._transaction.apply(this,e)},et.prototype._transaction=function(e,t,r){var i=this,a=ue.trans;a&&a.db===this&&e.indexOf("!")===-1||(a=null);var o,c,f=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(c=t.map(function(m){if(m=m instanceof i.Table?m.name:m,typeof m!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return m}),e=="r"||e===Mr)o=Mr;else{if(e!="rw"&&e!=Dr)throw new K.InvalidArgument("Invalid transaction mode: "+e);o=Dr}if(a){if(a.mode===Mr&&o===Dr){if(!f)throw new K.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&c.forEach(function(m){if(a&&a.storeNames.indexOf(m)===-1){if(!f)throw new K.SubTransaction("Table "+m+" not included in parent transaction.");a=null}}),f&&a&&!a.active&&(a=null)}}catch(m){return a?a._promise(null,function(_,v){v(m)}):Je(m)}var g=(function m(_,v,x,y,b){return X.resolve().then(function(){var w=ue.transless||ue,S=_._createTransaction(v,x,_._dbSchema,y);if(S.explicit=!0,w={trans:S,transless:w},y)S.idbtrans=y.idbtrans;else try{S.create(),S.idbtrans._explicit=!0,_._state.PR1398_maxLoop=3}catch(E){return E.name===ht.InvalidState&&_.isOpen()&&0<--_._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),_.close({disableAutoOpen:!1}),_.open().then(function(){return m(_,v,x,null,b)})):Je(E)}var C,A=Be(b);return A&&bn(),w=X.follow(function(){var E;(C=b.call(S,S))&&(A?(E=$t.bind(null,null),C.then(E,E)):typeof C.next=="function"&&typeof C.throw=="function"&&(C=Xr(C)))},w),(C&&typeof C.then=="function"?X.resolve(C).then(function(E){return S.active?E:Je(new K.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):w.then(function(){return C})).then(function(E){return y&&S._resolve(),S._completion.then(function(){return E})}).catch(function(E){return S._reject(E),Je(E)})})}).bind(null,this,o,c,a,r);return a?a._promise(o,g,"lock"):ue.trans?ln(ue.transless,function(){return i._whenReady(g)}):this._whenReady(g)},et.prototype.table=function(e){if(!F(this._allTables,e))throw new K.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},et);function et(e,t){var r=this;this._middlewares={},this.verno=0;var i=et.dependencies;this._options=t=l({addons:et.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},i=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a,o,c,f,g,m={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:fe,dbReadyPromise:null,cancelOpen:fe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};m.dbReadyPromise=new X(function(v){m.dbReadyResolve=v}),m.openCanceller=new X(function(v,x){m.cancelOpen=x}),this._state=m,this.name=e,this.on=Tn(this,"populate","blocked","versionchange","close",{ready:[Ut,fe]}),this.once=function(v,x){var y=function(){for(var b=[],w=0;w<arguments.length;w++)b[w]=arguments[w];r.on(v).unsubscribe(y),x.apply(r,b)};return r.on(v,y)},this.on.ready.subscribe=Z(this.on.ready.subscribe,function(v){return function(x,y){et.vip(function(){var b,w=r._state;w.openComplete?(w.dbOpenError||X.resolve().then(x),y&&v(x)):w.onReadyBeingFired?(w.onReadyBeingFired.push(x),y&&v(x)):(v(x),b=r,y||v(function S(){b.on.ready.unsubscribe(x),b.on.ready.unsubscribe(S)}))})}}),this.Collection=(a=this,En(Ta.prototype,function(C,S){this.db=a;var y=Si,b=null;if(S)try{y=S()}catch(A){b=A}var w=C._ctx,S=w.table,C=S.hook.reading.fire;this._ctx={table:S,index:w.index,isPrimKey:!w.index||S.schema.primKey.keyPath&&w.index===S.schema.primKey.name,range:y,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:b,or:w.or,valueMapper:C!==Ve?C:null}})),this.Table=(o=this,En(Oi.prototype,function(v,x,y){this.db=o,this._tx=y,this.name=v,this.schema=x,this.hook=o._allTables[v]?o._allTables[v].hook:Tn(null,{creating:[Ct,fe],reading:[lt,Ve],updating:[ut,fe],deleting:[Mt,fe]})})),this.Transaction=(c=this,En(Da.prototype,function(v,x,y,b,w){var S=this;v!=="readonly"&&x.forEach(function(C){C=(C=y[C])===null||C===void 0?void 0:C.yProps,C&&(x=x.concat(C.map(function(A){return A.updatesTable})))}),this.db=c,this.mode=v,this.storeNames=x,this.schema=y,this.chromeTransactionDurability=b,this.idbtrans=null,this.on=Tn(this,"complete","error","abort"),this.parent=w||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new X(function(C,A){S._resolve=C,S._reject=A}),this._completion.then(function(){S.active=!1,S.on.complete.fire()},function(C){var A=S.active;return S.active=!1,S.on.error.fire(C),S.parent?S.parent._reject(C):A&&S.idbtrans&&S.idbtrans.abort(),Je(C)})})),this.Version=(f=this,En(Ra.prototype,function(v){this.db=f,this._cfg={version:v,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(g=this,En(Di.prototype,function(v,x,y){if(this.db=g,this._ctx={table:v,index:x===":id"?null:x,or:y},this._cmp=this._ascending=Le,this._descending=function(b,w){return Le(w,b)},this._max=function(b,w){return 0<Le(b,w)?b:w},this._min=function(b,w){return Le(b,w)<0?b:w},this._IDBKeyRange=g._deps.IDBKeyRange,!this._IDBKeyRange)throw new K.MissingAPI})),this.on("versionchange",function(v){0<v.newVersion?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(v){!v.newVersion||v.newVersion<v.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(v.oldVersion/10))}),this._maxKey=Ln(t.IDBKeyRange),this._createTransaction=function(v,x,y,b){return new r.Transaction(v,x,y,r._options.chromeTransactionDurability,b)},this._fireOnBlocked=function(v){r.on("blocked").fire(v),wn.filter(function(x){return x.name===r.name&&x!==r&&!x._state.vcFired}).map(function(x){return x.on("versionchange").fire(v)})},this.use(qa),this.use($a),this.use(Ua),this.use(Ba),this.use(Va);var _=new Proxy(this,{get:function(v,x,y){if(x==="_vip")return!0;if(x==="table")return function(w){return fr(r.table(w),_)};var b=Reflect.get(v,x,y);return b instanceof Oi?fr(b,_):x==="tables"?b.map(function(w){return fr(w,_)}):x==="_createTransaction"?function(){return fr(b.apply(this,arguments),_)}:b}});this.vip=_,i.forEach(function(v){return v(r)})}var hr,It=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ya=(ti.prototype.subscribe=function(e,t,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:r})},ti.prototype[It]=function(){return this},ti);function ti(e){this._subscribe=e}try{hr={indexedDB:h.indexedDB||h.mozIndexedDB||h.webkitIndexedDB||h.msIndexedDB,IDBKeyRange:h.IDBKeyRange||h.webkitIDBKeyRange}}catch{hr={indexedDB:null,IDBKeyRange:null}}function $i(e){var t,r=!1,i=new Ya(function(a){var o=Be(e),c,f=!1,g={},m={},_={get closed(){return f},unsubscribe:function(){f||(f=!0,c&&c.abort(),v&&Xt.storagemutated.unsubscribe(y))}};a.start&&a.start(_);var v=!1,x=function(){return Er(b)},y=function(w){ur(g,w),Wr(m,g)&&x()},b=function(){var w,S,C;!f&&hr.indexedDB&&(g={},w={},c&&c.abort(),c=new AbortController,C=(function(A){var E=mn();try{o&&bn();var H=Wt(e,A);return H=o?H.finally($t):H}finally{E&&yn()}})(S={subscr:w,signal:c.signal,requery:x,querier:e,trans:null}),Promise.resolve(C).then(function(A){r=!0,t=A,f||S.signal.aborted||(g={},(function(E){for(var H in E)if(F(E,H))return;return 1})(m=w)||v||(Xt(Dn,y),v=!0),Er(function(){return!f&&a.next&&a.next(A)}))},function(A){r=!1,["DatabaseClosedError","AbortError"].includes(A?.name)||f||Er(function(){f||a.error&&a.error(A)})}))};return setTimeout(x,0),_});return i.hasValue=function(){return r},i.getValue=function(){return t},i}var fn=Vt;function ni(e){var t=Zt;try{Zt=!0,Xt.storagemutated.fire(e),Qr(e,!0)}finally{Zt=t}}z(fn,l(l({},He),{delete:function(e){return new fn(e,{addons:[]}).delete()},exists:function(e){return new fn(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=fn.dependencies,r=t.indexedDB,t=t.IDBKeyRange,(qr(r)?Promise.resolve(r.databases()).then(function(i){return i.map(function(a){return a.name}).filter(function(a){return a!==Xn})}):Vr(r,t).toCollection().primaryKeys()).then(e)}catch{return Je(new K.MissingAPI)}var t,r},defineClass:function(){return function(e){M(this,e)}},ignoreTransaction:function(e){return ue.trans?ln(ue.transless,e):e()},vip:Ur,async:function(e){return function(){try{var t=Xr(e.apply(this,arguments));return t&&typeof t.then=="function"?t:X.resolve(t)}catch(r){return Je(r)}}},spawn:function(e,t,r){try{var i=Xr(e.apply(r,t||[]));return i&&typeof i.then=="function"?i:X.resolve(i)}catch(a){return Je(a)}},currentTransaction:{get:function(){return ue.trans||null}},waitFor:function(e,t){return t=X.resolve(typeof e=="function"?fn.ignoreTransaction(e):e).timeout(t||6e4),ue.trans?ue.trans.waitFor(t):t},Promise:X,debug:{get:function(){return yt},set:function(e){At(e)}},derive:L,extend:M,props:z,override:Z,Events:Tn,on:Xt,liveQuery:$i,extendObservabilitySet:ur,getByKeyPath:te,setByKeyPath:oe,delByKeyPath:function(e,t){typeof t=="string"?oe(e,t,void 0):"length"in t&&[].map.call(t,function(r){oe(e,r,void 0)})},shallowClone:ye,deepClone:ie,getObjectDiff:Zr,cmp:Le,asap:de,minKey:-1/0,addons:[],connections:wn,errnames:ht,dependencies:hr,cache:dn,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,r){return e+t/Math.pow(10,2*r)})})),fn.maxKey=Ln(fn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Xt(Dn,function(e){Zt||(e=new CustomEvent(Nr,{detail:e}),Zt=!0,dispatchEvent(e),Zt=!1)}),addEventListener(Nr,function(e){e=e.detail,Zt||ni(e)}));var kn,Zt=!1,Yi=function(){};return typeof BroadcastChannel<"u"&&((Yi=function(){(kn=new BroadcastChannel(Nr)).onmessage=function(e){return e.data&&ni(e.data)}})(),typeof kn.unref=="function"&&kn.unref(),Xt(Dn,function(e){Zt||kn.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Vt.disableBfCache&&e.persisted){yt&&console.debug("Dexie: handling persisted pagehide"),kn?.close();for(var t=0,r=wn;t<r.length;t++)r[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Vt.disableBfCache&&e.persisted&&(yt&&console.debug("Dexie: handling persisted pageshow"),Yi(),ni({all:new ct(-1/0,[[]])}))})),X.rejectionMapper=function(e,t){return!e||e instanceof Fe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ke[e.name]?e:(t=new ke[e.name](t||e.message,e),"stack"in e&&T(t,"stack",{get:function(){return this.inner.stack}}),t)},At(yt),l(Vt,Object.freeze({__proto__:null,Dexie:Vt,liveQuery:$i,Entity:xi,cmp:Le,PropModification:Pn,replacePrefix:function(e,t){return new Pn({replacePrefix:[e,t]})},add:function(e){return new Pn({add:e})},remove:function(e){return new Pn({remove:e})},default:Vt,RangeSet:ct,mergeRanges:Hn,rangesOverlap:zi}),{default:Vt}),Vt})})(br)),br.exports}var Vs=Bs();const ui=Mo(Vs),sa=Symbol.for("Dexie"),_r=globalThis[sa]||(globalThis[sa]=ui);if(ui.semVer!==_r.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${ui.semVer} and ${_r.semVer}`);const{liveQuery:Vu,mergeRanges:qu,rangesOverlap:Uu,RangeSet:Gu,cmp:Wu,Entity:$u,PropModification:Yu,replacePrefix:Qu,add:Xu,remove:Zu,DexieYProvider:Ju}=_r;class qs extends _r{uprnSelections;areaSelections;dataSelections;userDownloads;constructor(){super("app-db"),this.version(1).stores({uprnSelections:"++id, createdAt",areaSelections:"++id, layerId, *areaIds",dataSelections:"++id, layerId, *fields",userDownloads:"++id, &downloadId, createdAt"})}}const Ir=new qs,Us=async k=>await Ir.userDownloads.add({downloadId:k,createdAt:Date.now()}),Gs=async()=>await Ir.userDownloads.orderBy("createdAt").reverse().toArray(),Ws=async k=>await Ir.userDownloads.where("downloadId").equals(k).delete();class $s{#e=se(Ue([]));get downloads(){return u(this.#e)}set downloads(n){$(this.#e,n,!0)}#t=se(Ue(new Ht));constructor(){this.#n()}addDownload(n){console.log("Adding download:",n),u(this.#t).set(n.id,n),Us(n.id),console.log("tables:",Ir.tables.map(s=>s.name))}removeDownload(n){u(this.#t).delete(n),Ws(n)}getDownloads(){return Array.from(u(this.#t).values())}async#n(){const n=await Gs();!n||n.length===0||(console.log("Loaded downloads from DB:",n),n.forEach(s=>{u(this.#t).set(s.downloadId,{id:s.downloadId,status:"pending"})}))}}const Kn=new $s;var Ys=le('<li class="download-item svelte-vgw5fc"><div class="download-info svelte-vgw5fc"><span class="download-url svelte-vgw5fc"> </span></div> <div class="download-actions svelte-vgw5fc"><div><!></div> <!> <!> <!></div></li>'),Qs=le('<ul class="selected-list svelte-vgw5fc"></ul> <p class="count svelte-vgw5fc"> </p>',1),Xs=le('<p class="no-selection svelte-vgw5fc">No downloads in queue</p>'),Zs=le('<div class="section svelte-vgw5fc"><h4 class="svelte-vgw5fc">Download Queue</h4> <!></div>');function Js(k,n){Re(n,!0);const s=()=>co(Ro,"$page",l),[l,d]=uo();let h=se(Ue(new Set));const p={completed:{color:"#059669",text:"Completed",icon:Ko},"in-progress":{color:"#2563eb",text:"In Progress",icon:zo},failed:{color:"#dc2626",text:"Failed",icon:Ho},pending:{color:"#6b7280",text:"Pending",icon:No}};function I(U){Kn.removeDownload(U)}async function M(U){try{await navigator.clipboard.writeText(U),$(h,new Set(u(h)).add(U),!0),nn.success("URL copied to clipboard"),setTimeout(()=>{const ne=new Set(u(h));ne.delete(U),$(h,ne,!0)},2e3)}catch(ne){console.error("Failed to copy URL:",ne),nn.error("Failed to copy URL to clipboard")}}function O(U){return p[U]?.color??p.pending.color}function P(U){return p[U]?.text??p.pending.text}function F(U){return p[U]?.icon??p.pending.icon}function z(U){return`${s().url}/${U}`}var N=Zs(),T=ce(W(N),2);{var L=U=>{var ne=Qs(),Z=ee(ne);zt(Z,21,()=>Kn.getDownloads(),In,(te,oe)=>{var ye=Ys(),Ie=W(ye),Ee=W(Ie),ve=W(Ee,!0);V(Ee),V(Ie);var re=ce(Ie,2),ie=W(re),Se=W(ie);{let Ae=he(()=>O(u(oe).status));Pt(Se,{variant:"ghost",size:"sm",class:"download-status-btn",get style(){return`color: ${u(Ae)??""}`},disabled:!0,children:(Me,Be)=>{const rt=he(()=>F(u(oe).status));var Fe=pe(),Ye=ee(Fe);{let Qe=he(()=>u(oe).status==="in-progress"?"spinning":"");Ne(Ye,()=>u(rt),(Ze,ht)=>{ht(Ze,{size:14,get class(){return u(Qe)}})})}D(Me,Fe)},$$slots:{default:!0}})}V(ie);var Pe=ce(ie,2);Pt(Pe,{variant:"ghost",size:"sm",class:"download-clipboard-btn",onclick:()=>M(z(u(oe).id)),title:"Copy URL to clipboard",children:(Ae,Me)=>{var Be=pe(),rt=ee(Be);{var Fe=Qe=>{Lo(Qe,{size:14})},Ye=Qe=>{Fo(Qe,{size:14})};me(rt,Qe=>{u(h).has(z(u(oe).id))?Qe(Fe):Qe(Ye,!1)})}D(Ae,Be)},$$slots:{default:!0}});var be=ce(Pe,2);{var Te=Ae=>{Pt(Ae,{variant:"ghost",size:"sm",class:"download-action-btn",onclick:()=>window.open(z(u(oe).id),"_blank"),title:"Open download",children:(Me,Be)=>{rn();var rt=vn("📥");D(Me,rt)},$$slots:{default:!0}})};me(be,Ae=>{u(oe).status==="completed"&&Ae(Te)})}var xe=ce(be,2);Pt(xe,{variant:"ghost",size:"sm",class:"download-remove-btn",onclick:()=>I(u(oe).id),title:"Remove from queue",children:(Ae,Me)=>{rn();var Be=vn("×");D(Ae,Be)},$$slots:{default:!0}}),V(re),V(ye),nt((Ae,Me)=>{wr(Ee,"title",Ae),gt(ve,u(oe).id),wr(ie,"title",Me)},[()=>z(u(oe).id),()=>P(u(oe).status)]),D(te,ye)}),V(Z);var R=ce(Z,2),de=W(R);V(R),nt(te=>gt(de,`${te??""} download(s) in queue`),[()=>Kn.getDownloads().length]),D(U,ne)},J=U=>{var ne=Xs();D(U,ne)};me(T,U=>{Kn.getDownloads().length>0?U(L):U(J,!1)})}V(N),D(k,N),je(),d()}class ma{id;name;children;parent;constructor(n,s,l=[],d=null){this.id=n,this.name=s,this.children=l,this.parent=d}}class it extends ma{layer;constructor(n,s,l,d=[],h=null){super(n,s,d,h),this.layer=l}}class An extends it{featureLayer;field;constructor(n,s,l,d,h=[],p=null){super(n,s,l,h,p),this.field=d,this.featureLayer=l}}var We=(k=>(k.Inactive="inactive",k.Indeterminate="indeterminate",k.Active="active",k))(We||{});class el{#e=se(Ue(new Ht));get DataSelections(){return u(this.#e)}set DataSelections(n){$(this.#e,n,!0)}addSelection(n){this.DataSelections.set(n.layerId,n),nn.success(`'${n.name}' Added`)}removeSelection(n){const s=this.DataSelections.get(n);this.DataSelections.delete(n),nn.success(`'${s?.name}' Removed`)}updateSelection(n,s){if(!(n instanceof it)){this.updateChildrenSelection(n,s);return}if(n instanceof An){this.updateFieldSelection(n,s);return}this.updateLayerSelection(n,s)}cleanup(){this.DataSelections.clear()}getSelectionState(n){if(!(n instanceof it))return this.determineSelectionStateFromChildren(n);if(this.isGroupLayer(n))return this.determineSelectionStateFromChildren(n);let s;return n instanceof An?(s=this.DataSelections.get(n.featureLayer.id),s&&s.fields.has(n.field.name)?We.Active:We.Inactive):(s=this.DataSelections.get(n.id),s?this.isFeatureLayer(n)&&n.children&&n.children.length>0?this.determineSelectionStateFromChildren(n):We.Active:We.Inactive)}updateLayerSelection(n,s){let l=this.DataSelections.get(n.id);switch(s){case We.Active:!l&&!this.isGroupLayer(n)&&(l=this.createAndAddDataSelection(n.id,n.layer.title||""));for(const d of n.children||[])this.updateSelection(d,s);break;case We.Inactive:l&&!this.isGroupLayer(n)&&this.removeSelection(n.id),this.updateChildrenSelection(n,s);break}}updateFieldSelection(n,s){let l=this.DataSelections.get(n.featureLayer.id);switch(s){case We.Active:l||(l=this.createAndAddDataSelection(n.featureLayer.id,n.featureLayer.title||"")),l.fields.add(n.field.name);break;case We.Inactive:if(!l)break;l.fields.delete(n.field.name),l.fields.size===0&&this.removeSelection(l.layerId);break}}updateChildrenSelection(n,s){for(const l of n.children||[])this.updateSelection(l,s)}determineSelectionStateFromChildren(n){let s=0,l=0;for(const d of n.children||[]){l++;const h=this.getSelectionState(d);if(h===We.Active||this.isFeatureLayer(d)&&h!==We.Inactive)s++;else if(h===We.Indeterminate)return We.Indeterminate}return s===0?We.Inactive:s===l?We.Active:We.Indeterminate}createAndAddDataSelection(n,s){const l={layerId:n,name:s,fields:new zn};return this.addSelection(l),l}isGroupLayer(n){return n instanceof it&&n.layer.type==="group"}isFeatureLayer(n){return n instanceof it&&n.layer.type==="feature"}}const wt=new el;var tl=le('<div class="export-footer svelte-10dgoyk"><div class="export-footer__left svelte-10dgoyk"><p class="text-sm text-muted-foreground svelte-10dgoyk">Click "Export" to begin the download.</p></div> <div class="export-footer__right svelte-10dgoyk"><!></div></div>');function nl(k,n){Re(n,!0);function s(){if(Ke.layerHighlightState.areaInfos.length<=0){nn.error("Please select at least one area to export.");return}if(wt.DataSelections.size<=0){nn.error("Please select at least one data layer to export.");return}console.log("Starting export..."),nn.info("Export started successfully.",{duration:4e3});const p=crypto.randomUUID();Kn.addDownload({id:p,status:"pending"}),n.onExportSuccess?.()}var l=tl(),d=ce(W(l),2),h=W(d);Pt(h,{onclick:s,children:(p,I)=>{rn();var M=vn("Export");D(p,M)},$$slots:{default:!0}}),V(d),V(l),D(k,l),je()}class rl{#e=se(null);get ActiveLayer(){return u(this.#e)}set ActiveLayer(n){$(this.#e,n,!0)}}class il{#e=se(!1);get isLoaded(){return u(this.#e)}set isLoaded(n){$(this.#e,n,!0)}#t=se(null);get data(){return u(this.#t)}set data(n){$(this.#t,n,!0)}#n=he(()=>{const n=new Ht;function s(l){n.set(l.id,l),l.type==="group"&&l.layers.forEach(h=>{s(h)})}return this.data&&this.data.layers.forEach(l=>{s(l)}),n});get dataLookup(){return u(this.#n)}set dataLookup(n){$(this.#n,n)}#i=se(!1);get loading(){return u(this.#i)}set loading(n){$(this.#i,n,!0)}#r=se(null);get error(){return u(this.#r)}set error(n){$(this.#r,n,!0)}async initializeAsync(n){if(!this.data){this.loading=!0,this.error=null;try{const{portalUrl:s,itemId:l,proxy:d}=n;await this.configurePortalAsync(s,d),await this.loadwebmapAsync(l)}catch(s){console.error("Error initializing webmap:",s),this.error=s.message}finally{this.loading=!1}}}async configurePortalAsync(n,s){if(!n)return;const l=await sl();if(l.portalUrl=n,console.log(l),!s)return;const{addProxyRule:d}=await ll();console.log("Adding proxy rule for portal traffic"),d({urlPrefix:s?.urlPrefix,proxyUrl:s?.proxyUrl})}async loadwebmapAsync(n){if(this.data)return;const[s,l]=await Promise.all([al(),ol()]),d=new l({id:n}),h=new s({portalItem:d});this.data=h,await this.data.when(),this.data.loaded&&(this.isLoaded=!0)}clear(){this.data=null,this.loading=!1,this.error=null}clearError(){this.error=null}getWebmap(){return this.data}}let ii=null,ai=null,oi=null,si=null;async function al(){return ii||(ii=en(()=>import("../chunks/huXfT4GN.js").then(k=>k.W),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143]),import.meta.url).then(k=>k.default)),ii}async function ol(){return ai||(ai=en(()=>import("../chunks/DxjcXvGa.js"),__vite__mapDeps([17,4,1,2,3,5,6,14,11]),import.meta.url).then(k=>k.default)),ai}async function sl(){return oi||(oi=en(()=>import("../chunks/DHq0rblm.js").then(k=>k.Z),[],import.meta.url).then(k=>k.default)),oi}async function ll(){return si||(si=en(()=>import("../chunks/BgvLO-3W.js").then(k=>k.O),__vite__mapDeps([6,2,3]),import.meta.url)),si}function ul(k,n){k.stopPropagation(),n.onFilterClicked?.(n.layerId)}var cl=le("<button><!></button>");function dl(k,n){Re(n,!0);let s=se(Ue(n.hasFiltersApplied?.(n.layerId)??!1));at(()=>{$(s,n.hasFiltersApplied?.(n.layerId)??!1,!0)});const l=he(()=>u(s)?jo:Bo);var d=cl();let h;d.__click=[ul,n];var p=W(d);jn(p,()=>u(l)),V(d),nt(I=>{h=Jt(d,1,"filter-btn svelte-k95pvd",null,h,I),wr(d,"aria-pressed",u(s))},[()=>({active:u(s)})]),D(k,d),je()}kr(["click"]);var fl=le('<li class="area-item svelte-81yb5c"><span class="area-name svelte-81yb5c"> </span> <!></li>'),hl=le('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),vl=le('<p class="no-selection svelte-81yb5c">No areas selected</p>'),pl=le('<li class="data-item svelte-81yb5c"><span class="data-name svelte-81yb5c"> </span> <div class="data-actions svelte-81yb5c"><!> <!></div></li>'),gl=le('<ul class="selected-list svelte-81yb5c"></ul> <p class="count svelte-81yb5c"> </p>',1),ml=le('<p class="no-selection svelte-81yb5c">No data selected</p>'),yl=le('<h2 class="svelte-81yb5c">Export Options</h2> <div class="section svelte-81yb5c"><h3 class="svelte-81yb5c"> </h3> <h4 class="svelte-81yb5c">Selected Areas</h4> <!></div> <div class="section svelte-81yb5c"><h4 class="svelte-81yb5c">Selected Data</h4> <!></div>',1);function bl(k,n){Re(n,!0);const s=De(n,"fieldFilterMenuStore",7);let l=se(Ue([]));at(()=>{if(!Ke.layerHighlightState.areaInfos.length){$(l,[],!0);return}(async()=>{const R=await Ke.getAreaNamesById(Ke.layerHighlightState.areaInfos.map(te=>te.id)),de=[];for(let te=0;te<R.length;te++)de.push({name:R[te]||"Unknown Area",HighlightAreaInfo:Ke.layerHighlightState.areaInfos[te]});$(l,de,!0)})()});function d(Z){const R=u(l).findIndex(de=>de.name===Z);R!==-1&&Ke.removeSelectedArea(u(l)[R]?.HighlightAreaInfo.id)}function h(Z){console.log("[export-menu] Removing data selection for layerId:",Z),wt.DataSelections.delete(Z),console.log("[export-menu] Current SelectedData:",vo(wt.DataSelections))}function p(Z){if(s().ActiveLayer?.id===Z){s().ActiveLayer=null;return}const R=n.webMapStore.dataLookup.get(Z);if(!R){console.warn(`[export-menu] Layer with ID ${Z} not found in web map store.`);return}s().ActiveLayer=R}function I(Z){const R=wt.DataSelections.get(Z);return!(!R||!R.fields||R.fields.size===0||R.fields.size===n.webMapStore.dataLookup.get(Z)?.fields?.length)}var M=yl(),O=ce(ee(M),2),P=W(O),F=W(P,!0);V(P);var z=ce(P,4);{var N=Z=>{var R=hl(),de=ee(R);zt(de,21,()=>u(l),In,(ye,Ie)=>{var Ee=fl(),ve=W(Ee),re=W(ve,!0);V(ve);var ie=ce(ve,2);Pt(ie,{variant:"ghost",size:"sm",class:"area-remove-btn",onclick:()=>d(u(Ie).name),children:(Se,Pe)=>{rn();var be=vn("×");D(Se,be)},$$slots:{default:!0}}),V(Ee),nt(()=>gt(re,u(Ie).name)),D(ye,Ee)}),V(de);var te=ce(de,2),oe=W(te);V(te),nt(()=>gt(oe,`${u(l).length??""} area(s) selected`)),D(Z,R)},T=Z=>{var R=vl();D(Z,R)};me(z,Z=>{u(l).length>0?Z(N):Z(T,!1)})}V(O);var L=ce(O,2),J=ce(W(L),2);{var U=Z=>{var R=gl(),de=ee(R);zt(de,21,()=>[...wt.DataSelections.values()],In,(ye,Ie)=>{var Ee=pl(),ve=W(Ee),re=W(ve,!0);V(ve);var ie=ce(ve,2),Se=W(ie);{var Pe=Te=>{dl(Te,{get layerId(){return u(Ie).layerId},onFilterClicked:p,hasFiltersApplied:I})};me(Se,Te=>{u(Ie).fields&&Te(Pe)})}var be=ce(Se,2);Pt(be,{variant:"ghost",size:"sm",class:"data-remove-btn",onclick:()=>h(u(Ie).layerId),children:(Te,xe)=>{rn();var Ae=vn("×");D(Te,Ae)},$$slots:{default:!0}}),V(ie),V(Ee),nt(()=>gt(re,u(Ie).name)),D(ye,Ee)}),V(de);var te=ce(de,2),oe=W(te);V(te),nt(()=>gt(oe,`${wt.DataSelections.size??""} data layer(s) selected`)),D(Z,R)},ne=Z=>{var R=ml();D(Z,R)};me(J,Z=>{wt.DataSelections.size>0?Z(U):Z(ne,!1)})}V(L),nt(Z=>gt(F,Z),[()=>n.areaSelectionTreeviewStore.initialized?n.areaSelectionTreeviewStore.getVisibleNodes()[0]?.name:"Loading..."]),D(k,M),je()}function wl(k,n){k.target===k.currentTarget&&n()}var _l=(k,n)=>k.key==="Escape"&&n(),Sl=(k,n,s)=>n(u(s).name),xl=le('<div class="info-icon-container svelte-fp5rsc"><!></div>'),kl=le('<div class="field-content-wrapper svelte-fp5rsc"><!> <button class="field-content svelte-fp5rsc" tabindex="0"><div class="field-name-container svelte-fp5rsc"><span class="field-name svelte-fp5rsc"> </span> <!></div></button></div>'),Cl=le('<div class="master-checkbox-container svelte-fp5rsc"><!> <span class="master-checkbox-label svelte-fp5rsc">Select All Fields</span></div> <!> <!>',1),Il=le("<!> <!>",1),Al=le("<!> <!>",1),Ol=le('<button class="close-button svelte-fp5rsc" aria-label="Close"><!></button> <!>',1),Pl=le('<div class="card-container svelte-fp5rsc" role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Tl(k,n){Re(n,!0);const s=De(n,"fieldFilterMenuStore",7);let l=se(null),d=se(Ue(new zn)),h=he(()=>{if(!u(l)||!u(l).fields)return{checked:!1,indeterminate:!1};const T=u(l).fields.length,L=u(d)?.size||0;return L===0?{checked:!1,indeterminate:!1}:L===T?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}});at(()=>{console.log("Active Layer to Filter:",s().ActiveLayer);const T=s().ActiveLayer;if($(l,T,!0),T){const L=wt.DataSelections.get(T.id);L?.fields?$(d,new zn([...L.fields]),!0):$(d,new zn,!0)}});function p(){I(),s().ActiveLayer=null}function I(){if(!u(l))return;let T=wt.DataSelections.get(u(l).id);if(T){if((T.fields===void 0||T.fields===null)&&(T.fields=new zn),u(d).size===0){wt.removeSelection(u(l).id);return}T.fields.clear(),u(d).forEach(L=>{T.fields?.add(L)})}}function M(T){u(l)&&(u(d).has(T)?u(d).delete(T):u(d).add(T))}function O(){if(!u(l)?.fields)return;(u(d)?.size||0)===0?u(l).fields.forEach(L=>{u(d).add(L.name)}):u(d).clear()}function P(){return u(l)?.fields?u(l).fields:[]}var F=pe(),z=ee(F);{var N=T=>{var L=Pl();L.__click=[wl,p],L.__keydown=[_l,p];var J=W(L);Ne(J,()=>ha,(U,ne)=>{ne(U,{class:"command-card",children:(Z,R)=>{var de=Ol(),te=ee(de);te.__click=p;var oe=W(te);po(oe,{size:20}),V(te);var ye=ce(te,2);Ne(ye,()=>vi,(Ie,Ee)=>{Ee(Ie,{class:"card-content",children:(ve,re)=>{var ie=pe(),Se=ee(ie);Ne(Se,()=>go,(Pe,be)=>{be(Pe,{children:(Te,xe)=>{var Ae=Al(),Me=ee(Ae);Ne(Me,()=>mo,(rt,Fe)=>{Fe(rt,{placeholder:"Search for fields..."})});var Be=ce(Me,2);Ne(Be,()=>yo,(rt,Fe)=>{Fe(rt,{children:(Ye,Qe)=>{var Ze=Il(),ht=ee(Ze);Ne(ht,()=>bo,(K,ke)=>{ke(K,{children:(He,fe)=>{rn();var Ve=vn("No results found.");D(He,Ve)},$$slots:{default:!0}})});var kt=ce(ht,2);Ne(kt,()=>wo,(K,ke)=>{ke(K,{heading:"Fields",children:(He,fe)=>{var Ve=Cl(),lt=ee(Ve),Xe=W(lt);Qi(Xe,{get checked(){return u(h).checked},get indeterminate(){return u(h).indeterminate},onCheckedChange:O}),rn(2),V(lt);var Ct=ce(lt,2);Ne(Ct,()=>Vo,(ut,mt)=>{mt(ut,{})});var Mt=ce(Ct,2);zt(Mt,17,P,In,(ut,mt)=>{var Ut=pe(),yt=ee(Ut);Ne(yt,()=>_o,(At,Ot)=>{Ot(At,{class:"field-item",onselect:()=>M(u(mt).name),children:(Dt,Lt)=>{var vt=kl(),bt=W(vt);{let jt=he(()=>u(d)?.has(u(mt).name)??!1);Qi(bt,{class:"field-checkbox",get checked(){return u(jt)},onCheckedChange:()=>M(u(mt).name)})}var an=ce(bt,2);an.__click=[Sl,M,mt];var Gt=W(an),on=W(Gt),pn=W(on,!0);V(on);var Rt=ce(on,2);{var gn=jt=>{var _t=xl(),ue=W(_t);jn(ue,()=>qo),V(_t),nt(()=>wr(_t,"title",u(mt).description)),D(jt,_t)};me(Rt,jt=>{u(mt).description&&jt(gn)})}V(Gt),V(an),V(vt),nt(()=>gt(pn,u(mt).alias||u(mt).name)),D(Dt,vt)},$$slots:{default:!0}})}),D(ut,Ut)}),D(He,Ve)},$$slots:{default:!0}})}),D(Ye,Ze)},$$slots:{default:!0}})}),D(Te,Ae)},$$slots:{default:!0}})}),D(ve,ie)},$$slots:{default:!0}})}),D(Z,de)},$$slots:{default:!0}})}),V(L),D(T,L)};me(z,T=>{u(l)&&T(N)})}D(k,F),je()}kr(["click","keydown"]);class ya{#e=se(!1);get initialized(){return u(this.#e)}set initialized(n){$(this.#e,n,!0)}#t=null;#n=se(Ue([]));#i=he(()=>{const n=new Ht;return this.#b(u(this.#n),n),n});#r=se(Ue(new Ht));#a=se(Ue(new Ht));#u=se(Ue(new Ht));initialize(n,s,l){if(this.initialized)throw new Error("TreeviewStore is already initialized.");if(this.initialized=!0,!s)throw new Error("TreeviewStore requires a valid TreeviewConfigStore to initialize.");if(this.#t=s,l)for(const d of l)u(this.#u).set(d.id,d);if(!n)throw new Error("TreeviewStore requires a valid array of layers to initialize.");this.#o(n),$(this.#n,this.#g(n),!0)}getNodeById(n){return this.#c(),u(this.#i).get(n)}getNodes(){return this.#c(),u(this.#n)}getVisibleNodes(){this.#c();const n=[];for(const[s,l]of u(this.#r)){if(!l)continue;const d=u(this.#i).get(s);d&&n.push(d)}return n}getNonHiddenNodes(){return this.#c(),this.#d(u(this.#n))}#d(n){this.#c();const s=[];for(const l of n){const d=this.#l(l.id);if(!(d&&d.isHidden)&&(s.push(l),l.children?.length)){const h=this.#d(l.children);s.push(...h)}}return s}getVisibilityState(n){return this.#c(),u(this.#r).get(n)??!1}setVisibilityState(n,s){this.#c();const l=u(this.#i).get(n);if(!l)throw new Error(`Tree node not found for ID: ${n}`);if(!(l instanceof it))throw new Error(`Tree node is not a layer node: ${n}`);u(this.#r).set(n,s),l.layer.visible=s,l instanceof An&&(l.featureLayer.displayField=s?l.field.name:""),this.#s(l,s);const d=this.#l(n);if(!d||d.isHidden||(console.log(`Setting visibility of node ${n} to ${s}`,d,l),d.visibilityDependencyIds?.length&&this.#f(l,s),!d.visibilityGroupId))return;const h=d.visibilityGroupId;console.log(`Node ${n} is part of visibility group ${h}`);let p=u(this.#a).get(h);p||(p=[],u(this.#a).set(h,p));const I=this.#h(h);if(!I)throw new Error(`Visibility group config not found for group ID: ${h}`);if(!s){const O=p.indexOf(n);p.splice(O,1);return}const M=O=>{u(this.#r).set(O,!1);const P=u(this.#i).get(O);if(P&&P instanceof it){P.layer.visible=!1,this.#s(P,!1);const z=this.#l(O);z&&z.visibilityDependencyIds?.length&&this.#f(P,!1)}const F=p.indexOf(O);F>=0&&p.splice(F,1)};for(;p.length>=I.maxVisibleLayers;){const O=p[0];M(O)}p.push(n),this.#s(l,s),d.visibilityDependencyIds?.length&&this.#f(l,s)}cleanup(){this.initialized=!1,u(this.#r).clear(),u(this.#a).clear(),u(this.#u).clear(),$(this.#n,[],!0),u(this.#i).clear()}#s(n,s){const l=n.parent;if(l){if(!(l instanceof it)){this.#s(l,s);return}u(this.#r).set(l.id,s),l.layer.visible=s,this.#s(l,s)}}#f(n,s){const l=this.#l(n.id);if(l&&l.visibilityDependencyIds?.length)for(const d of l.visibilityDependencyIds){const h=u(this.#i).get(d);h&&h instanceof it&&(u(this.#r).set(d,s),h.layer.visible=s,this.#s(h,s))}}#h(n){if(n&&this.#t)return this.#t.getVisibilityGroupConfig(n)}#o(n){this.#t&&this.#t.resolveInheritance(n)}#g(n){const s=n.map(l=>this.#p(l,void 0));return this.#v([...s])}#l(n){if(n&&this.#t)return this.#t.getItemConfig(n)}#v(n){n.reverse();for(const s of n)s.children?.length&&this.#v(s.children);return n}#p(n,s){const l=this.#l(n.id);if(l&&l.customConverterId){if(!u(this.#u).has(l.customConverterId))throw new Error(`Custom converter not found: ${l.customConverterId}`);const h=u(this.#u).get(l.customConverterId);if(!h)throw new Error(`Custom converter not found: ${l.customConverterId}`);return h.layerToNode(n,s??null)}const d=new it(n.id,n.title,n,[],s);if(n.visible=l?.isVisibleOnInit??!1,u(this.#r).set(n.id,n.visible),this.#x(n)&&l?.showFields){const h=n;h.loaded||console.warn(`Layer not loaded: ${n.id}`);for(const p of h.fields??[]){const I=this.#m(p,d);d.children.push(I)}}if(this.#S(n)){const h=n;return d.children=h.layers.toArray().map(p=>this.#p(p,d)),d}if(this.#w(n)){const h=n;if(h.sublayers&&h.sublayers.length>0){const p=h.sublayers;d.children=p.toArray().map(this.#y)}}return d}#m(n,s){const l=this.#_(s.id,n.name),d=new An(l,n.alias||n.name,s.layer,n,[],s),h=this.#l(l);return u(this.#r).set(l,h?.isVisibleOnInit??!1),d}#w(n){return n.type==="map-image"||n.type==="wms"}#y(n){const s=new it(n.uid,n.title,n);return n.sublayers?.length&&(s.children=n.sublayers.toArray().map(this.#y)),s}#b(n,s){for(const l of n)s.set(l.id,l),l.children?.length&&this.#b(l.children,s)}#_(n,s){return`${n}-${s}`}#S(n){return n.type==="group"}#x(n){return n.type==="feature"}#c(){if(!this.initialized)throw new Error("TreeviewStore is not initialized. Call initialize() first.")}}const El='<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Ml='<path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>',Dl='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/>',ba=(k,n,s,l)=>n?Ll(k,s):s?l?El:Ml:Dl,Ll=(k,n)=>{switch(k.type){case"group":return Xi;case"feature":return Zi;case"tile":return Uo;default:return n?Xi:Zi}};var Fl=le('<div class="tree-node-item svelte-1y72o5r"><!></div>'),Nl=le('<div class="tree-children relative ml-4 w-full svelte-1y72o5r"><div class="tree-guide-line tree-guide-line-animate svelte-1y72o5r"></div> <!></div>'),Hl=le('<div class="w-full"><!>  <!></div>');function wa(k,n){const s=De(n,"isOpen",3,!1),l=De(n,"childNodes",3,null);var d=Hl(),h=W(d);$e(h,()=>n.content??tt);var p=ce(h,2);{var I=M=>{var O=Nl(),P=ce(W(O),2);zt(P,19,()=>l()??[],F=>F.id,(F,z,N)=>{var T=Fl(),L=W(T);$e(L,()=>n.childNode??tt,()=>u(z)),V(T),nt(()=>tn(T,`animation-delay: ${100+u(N)*50}ms;`)),D(F,T)}),V(O),D(M,O)};me(p,M=>{s()&&l()&&M(I)})}V(d),D(k,d)}const ci="mb-1 cursor-pointer rounded-md border border-border/30 p-2 text-left",di="transform-gpu transition-all duration-150 ease-out hover:border-border/50 hover:bg-card/70 hover:shadow-sm",zl="transition-colors hover:bg-card/70",fi="text-sm font-normal",hi="bg-card/50",_a="bg-accent text-accent-foreground",Kl="!h-auto !min-h-9 !whitespace-normal data-[state=on]:!bg-accent data-[state=on]:!text-accent-foreground data-[state=on]:hover:!bg-accent data-[state=on]:hover:!text-accent-foreground";function Rl(k={}){const{enhancedHover:n=!1,includeFont:s=!1,pressed:l=!1}=k;let d=ci;return n?d+=" "+di:d+=" "+zl,s&&(d+=" "+fi),l?d+=" "+_a:d+=" "+hi,d}var jl=le('<div class="flex w-full !items-center !justify-between gap-2"><div class="pointer-events-none !flex min-w-0 flex-1 !items-center gap-1"><span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div>'),Bl=le('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function la(k,n){const s=`calc(100% - ${n.depth*1}rem)`,l=`${ci} ${di} ${Kl} ${hi} ${fi}`,d=`${ci} ${di} ${fi}`;var h=pe(),p=ee(h);{var I=O=>{Go(O,{get pressed(){return n.pressed},get class(){return l},variant:"outline",get style(){return`width: ${s};`},get onPressedChange(){return n.onclick},children:(P,F)=>{var z=jl(),N=W(z),T=W(N),L=W(T);jn(L,()=>n.icon),V(T);var J=ce(T,2),U=W(J,!0);V(J),V(N);var ne=ce(N,2);$e(ne,()=>n.children??tt),V(z),nt(()=>gt(U,n.name)),D(P,z)},$$slots:{default:!0}})},M=O=>{var P=Bl();P.__click=function(...Z){n.onclick?.apply(this,Z)};var F=W(P),z=W(F),N=W(z);va(N,{get isOpen(){return n.isOpen}});var T=ce(N,2),L=W(T);jn(L,()=>n.icon),V(T);var J=ce(T,2),U=W(J,!0);V(J),V(z);var ne=ce(z,2);$e(ne,()=>n.children??tt),V(F),V(P),nt(()=>{Jt(P,1,`${d} ${n.pressed?_a:hi}`),tn(P,`width: ${s};`),gt(U,n.name)}),D(O,P)};me(p,O=>{n.isTogglable?O(I):O(M,!1)})}D(k,h)}kr(["click"]);function Sa(k,n){Re(n,!0);const s=L=>{var J=pe(),U=ee(J);{var ne=Z=>{var R=pe(),de=ee(R);{var te=ye=>{la(ye,{isTogglable:!1,get pressed(){return u(O)},get icon(){return u(P)},get name(){return n.node.name},get depth(){return d()},onclick:T,get isOpen(){return u(M)}})},oe=ye=>{la(ye,{isTogglable:!0,get pressed(){return u(O)},get icon(){return u(P)},get name(){return n.node.name},get depth(){return d()},onclick:N,get isOpen(){return u(M)}})};me(de,ye=>{p?ye(te):ye(oe,!1)})}D(Z,R)};me(U,Z=>{n.treeviewConfigStore.getItemConfig(n.node.id)?.isHidden||Z(ne)})}D(L,J)},l=(L,J=tt)=>{var U=pe(),ne=ee(U);{var Z=R=>{{let de=he(()=>d()+1);Sa(R,{get treeviewConfigStore(){return n.treeviewConfigStore},get node(){return J()},get onNodeClick(){return n.onNodeClick},get onNodeVisibilityChange(){return n.onNodeVisibilityChange},get getNodeVisibility(){return n.getNodeVisibility},get depth(){return u(de)},get useLayerTypeIcon(){return h()}})}};me(ne,R=>{p&&u(M)&&!n.treeviewConfigStore.getItemConfig(J().id)?.isHidden&&R(Z)})}D(L,U)},d=De(n,"depth",3,0),h=De(n,"useLayerTypeIcon",3,!1),p=!!(n.node.children&&n.node.children.length),I=!p;let M=se(!1),O=se(!1),P=se("");function F(){return!n.node.children||!n.getNodeVisibility?!1:n.node.children.some(L=>{const J=n.getNodeVisibility(L.id);return J!==void 0?J:L instanceof it?L.layer.visible:!1})}at(()=>{if(!(!n.node||!(n.node instanceof it))){if(p)$(O,F(),!0);else{const L=n.getNodeVisibility?n.getNodeVisibility(n.node.id):void 0;$(O,L!==void 0?L:n.node.layer.visible,!0)}$(P,ba(n.node.layer,h(),p,u(M)),!0)}});function z(){!I||!n.onNodeVisibilityChange||p||($(O,!u(O)),n.onNodeVisibilityChange(n.node,u(O)))}function N(){p||z(),n.onNodeClick?.(n.node)}function T(){$(M,!u(M)),n.onNodeClick?.(n.node)}{let L=he(()=>p?n.node.children:null);wa(k,{get isOpen(){return u(M)},get content(){return s},get childNodes(){return u(L)},get childNode(){return l}})}je()}function Vl(k,n){Re(n,!0);const s=De(n,"webMap",3,null);at(()=>{!s()||n.treeviewStore.initialized||n.treeviewStore.initialize(s().layers.toArray(),n.treeviewConfigStore)}),Sr(()=>{n.treeviewStore.cleanup()});var l=pe(),d=ee(l);{var h=p=>{var I=pe(),M=ee(I);Ne(M,()=>pa,(O,P)=>{P(O,{children:(F,z)=>{var N=pe(),T=ee(N);zt(T,17,()=>n.treeviewStore.getNodes(),L=>L.id,(L,J)=>{Sa(L,{get treeviewConfigStore(){return n.treeviewConfigStore},get node(){return u(J)},onNodeClick:()=>{},onNodeVisibilityChange:(U,ne)=>n.treeviewStore.setVisibilityState(U.id,ne),getNodeVisibility:U=>n.treeviewStore.getVisibilityState(U),depth:0,useLayerTypeIcon:!0})}),D(F,N)},$$slots:{default:!0}})}),D(p,I)};me(d,p=>{n.treeviewStore.initialized&&p(h)})}D(k,l),je()}class ql{configStore;constructor(n){this.configStore=n}}function Ul(k){return k.replace(/&deg;/gi,"°").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}class Gl extends ql{id="aliasPath";layerToNode(n,s){const l=new it(n.id,n.title,n,[],s),d=this.configStore.getItemConfig(n.id);if(this.#n(n)&&d?.showFields){const h=n;h.loaded||console.warn(`Layer not loaded: ${n.id}`);const p=new Map;for(const I of h.fields??[]){const M=this.configStore.getItemConfig(this.#t(n.id,I.name));!M||M.isHidden||this.#e(I,l,p)}l.children.sort((I,M)=>I.children.length>0&&M.children.length===0?1:I.children.length===0&&M.children.length>0?-1:0)}return l}#e(n,s,l=new Map){const d=this.#t(s.id,n.name),p=Ul(n.alias||"")?.split("|").map(z=>z.trim()).filter(Boolean)??[];if(p.length===0){const z=new An(d,n.alias||n.name,s.layer,n,[],s);return s.children.push(z),z}const I=p.slice(0,-1),M=p[p.length-1];let O=s;const P=(z,N)=>{z.children??=[],z.children.includes(N)||z.children.push(N)};for(let z=0;z<I.length;z++){const N=I[z],T=p.slice(0,z+1).join("::"),L=`${s.id}::${T}`;let J=l.get(L);J||(J=new ma(L,N,[],O),l.set(L,J),P(O,J)),O=J}const F=new An(d,M||n.name,s.layer,n,[],O);return P(O,F),F}#t(n,s){return`${n}-${s}`}#n(n){return n.type==="feature"}}var Wl=le('<div data-slot="checkbox-indicator" class="text-current transition-none"><!></div>');function $l(k,n){Re(n,!0);let s=De(n,"ref",15,null),l=De(n,"checked",11,!1),d=De(n,"indeterminate",11,!1),h=Kt(n,["$$slots","$$events","$$legacy","ref","checked","indeterminate","class"]),p=se(Ue(l())),I=se(Ue(d()));at(()=>{$(p,l())}),at(()=>{$(I,d())});var M=pe(),O=ee(M);{const P=(z,N)=>{let T=()=>N?.().checked,L=()=>N?.().indeterminate;var J=Wl(),U=W(J);{var ne=R=>{ps(R,{class:"size-3.5"})},Z=R=>{var de=pe(),te=ee(de);{var oe=ye=>{$o(ye,{class:"size-3.5"})};me(te,ye=>{L()&&ye(oe)},!0)}D(R,de)};me(U,R=>{T()?R(ne):R(Z,!1)})}V(J),D(z,J)};let F=he(()=>Do("peer flex size-4 shrink-0 items-center justify-center rounded-[4px] border border-input shadow-xs transition-shadow outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 data-[state=checked]:border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:bg-input/30 dark:aria-invalid:ring-destructive/40 dark:data-[state=checked]:bg-primary",n.class));Ne(O,()=>Wo,(z,N)=>{N(z,Et({"data-slot":"checkbox",get class(){return u(F)}},()=>h,{get ref(){return s()},set ref(T){s(T)},get checked(){return u(p)},set checked(T){$(p,T,!0)},get indeterminate(){return u(I)},set indeterminate(T){$(I,T,!0)},children:P,$$slots:{default:!0}}))})}D(k,M),je()}var Yl=le("<div><!></div>");function ua(k,n){Re(n,!0);let s=he(()=>n.getDownloadState?.(n.node)??We.Inactive),l=he(()=>u(s)===We.Active),d=he(()=>u(s)===We.Indeterminate);function h(M){M.stopPropagation();const O=u(s)===We.Active?We.Inactive:We.Active;n.onDownloadStateChanged?.(n.node,O)}var p=Yl(),I=W(p);$l(I,{get checked(){return u(l)},get indeterminate(){return u(d)},onclick:h}),V(p),D(k,p),je()}var Ql=le('<button><div class="flex w-full items-center justify-between gap-2"><div class="pointer-events-none flex min-w-0 flex-1 items-center gap-1"><!> <span class="inline-block size-4" aria-hidden="true"><!></span> <span class="block w-full text-left break-words"> </span></div> <!></div></button>');function ca(k,n){Re(n,!0);const s=De(n,"isFolder",3,!1),l=De(n,"isOpen",3,!1),d=`calc(100% - ${n.depth*1}rem)`;var h=Ql();h.__click=function(...L){n.onclick?.apply(this,L)};var p=W(h),I=W(p),M=W(I);{var O=L=>{va(L,{get isOpen(){return l()}})};me(M,L=>{s()&&L(O)})}var P=ce(M,2),F=W(P);jn(F,()=>n.icon),V(P);var z=ce(P,2),N=W(z,!0);V(z),V(I);var T=ce(I,2);$e(T,()=>n.children??tt),V(p),V(h),nt(L=>{Jt(h,1,L),tn(h,`width: ${d};`),gt(N,n.name)},[()=>ho(Rl({enhancedHover:!0,includeFont:!0}))]),D(k,h),je()}kr(["click"]);var Xl=le('<div class="flex items-center gap-2"><!> <!></div>'),Zl=le('<div class="flex items-center gap-2"><!> <!></div>');function xa(k,n){Re(n,!0);const s=U=>{var ne=pe(),Z=ee(ne);{var R=de=>{var te=pe(),oe=ee(te);{var ye=Ee=>{ca(Ee,{get icon(){return u(F)},get name(){return n.node.name},get depth(){return h()},onclick:J,get isFolder(){return I},get isOpen(){return u(O)},children:re=>{var ie=Xl(),Se=W(ie);{var Pe=xe=>{ua(xe,{get node(){return n.node},get onDownloadStateChanged(){return n.onDownloadStateChanged},get getDownloadState(){return n.getDownloadState}})};me(Se,xe=>{n.isDownloadable&&xe(Pe)})}var be=ce(Se,2);{var Te=xe=>{Ji(xe,{get checked(){return u(P)},onCheckedChange:T})};me(be,xe=>{M&&xe(Te)})}V(ie),D(re,ie)},$$slots:{default:!0}})},Ie=Ee=>{ca(Ee,{get icon(){return u(F)},get name(){return n.node.name},get depth(){return h()},onclick:L,get isFolder(){return I},children:re=>{var ie=Zl(),Se=W(ie);{var Pe=xe=>{ua(xe,{get node(){return n.node},get onDownloadStateChanged(){return n.onDownloadStateChanged},get getDownloadState(){return n.getDownloadState}})};me(Se,xe=>{n.isDownloadable&&xe(Pe)})}var be=ce(Se,2);{var Te=xe=>{Ji(xe,{get checked(){return u(P)},onCheckedChange:T})};me(be,xe=>{M&&xe(Te)})}V(ie),D(re,ie)},$$slots:{default:!0}})};me(oe,Ee=>{I?Ee(ye):Ee(Ie,!1)})}D(de,te)};me(Z,de=>{d()?.getItemConfig(n.node.id)?.isHidden||de(R)})}D(U,ne)},l=(U,ne=tt)=>{var Z=pe(),R=ee(Z);{var de=te=>{{let oe=he(()=>d()?.getItemConfig(ne().id)?.isDownloadable??!0),ye=he(()=>h()+1);xa(te,{get treeviewConfigStore(){return d()},get node(){return ne()},get isDownloadable(){return u(oe)},get onNodeClick(){return n.onNodeClick},get onNodeVisibilityChange(){return n.onNodeVisibilityChange},get onDownloadStateChanged(){return n.onDownloadStateChanged},get getDownloadState(){return n.getDownloadState},get onFilterClicked(){return n.onFilterClicked},get hasFiltersApplied(){return n.hasFiltersApplied},get getNodeVisibility(){return n.getNodeVisibility},get depth(){return u(ye)},get useLayerTypeIcon(){return p()}})}};me(R,te=>{I&&u(O)&&!d()?.getItemConfig(ne().id)?.isHidden&&te(de)})}D(U,Z)},d=De(n,"treeviewConfigStore",3,null),h=De(n,"depth",3,0),p=De(n,"useLayerTypeIcon",3,!1),I=!!(n.node.children&&n.node.children.length),M=!I;let O=se(!1),P=se(!1),F=se(""),z=se(!1),N=se(!1);at(()=>{if(!n.node)return;const U=n.getNodeVisibility?n.getNodeVisibility(n.node.id):!1;$(P,U??!1,!0),n.node instanceof it&&$(F,ba(n.node.layer,p(),I,u(O)),!0)}),at(()=>{if(!(n.node instanceof it))return;const U=(n.getDownloadState?.(n.node)===We.Active&&n.node.layer.type==="feature")??!1;U&&!u(z)?($(z,!0),$(N,!1)):!U&&u(z)&&($(N,!0),setTimeout(()=>{$(z,!1),$(N,!1)},180))});function T(){!M||!n.onNodeVisibilityChange||($(P,!u(P)),n.onNodeVisibilityChange(n.node,u(P)))}function L(){n.onNodeClick?.(n.node)}function J(){$(O,!u(O)),n.onNodeClick?.(n.node)}{let U=he(()=>I?n.node.children:null);wa(k,{get isOpen(){return u(O)},get content(){return s},get childNodes(){return u(U)},get childNode(){return l}})}je()}function Jl(k,n){Re(n,!0);const s=De(n,"webMap",3,null),l=De(n,"fieldFilterMenuStore",7),d=new ya;at(()=>{if(!s()||d.initialized)return;(async()=>{await s().when(),await h(s().layers.toArray());const T=new Gl(n.treeviewConfigStore);d.initialize(s().layers.toArray(),n.treeviewConfigStore,[T])})()}),Sr(()=>{console.log("Cleaning up treeviewStore..."),d.cleanup()});async function h(N){for(const T of N)T.type==="feature"&&!T.loaded&&(await T.load(),console.log("Loaded feature layer:",T.title)),T.type==="group"&&await h(T.layers.toArray())}function p(N,T){wt.updateSelection(N,T)}function I(N){return wt.getSelectionState(N)}function M(N){if(l().ActiveLayer?.uid===N){l().ActiveLayer=null;return}const L=d.getNodeById(N);!L||!(L instanceof it)||(l().ActiveLayer=L.layer)}function O(N){const T=wt.DataSelections.get(N);if(!T?.fields)return!1;const L=d.getNodeById(N);if(!L||!(L instanceof it))return!1;const J=L.layer.fields?.length||0,U=T.fields.size;return U>0&&U!==J}var P=pe(),F=ee(P);{var z=N=>{var T=pe(),L=ee(T);Ne(L,()=>pa,(J,U)=>{U(J,{children:(ne,Z)=>{var R=pe(),de=ee(R);zt(de,17,()=>d.getNodes(),te=>te.id,(te,oe)=>{{let ye=he(()=>n.treeviewConfigStore.getItemConfig(u(oe).id)?.isDownloadable??!0);xa(te,{get treeviewConfigStore(){return n.treeviewConfigStore},get node(){return u(oe)},get isDownloadable(){return u(ye)},onNodeClick:()=>{},onNodeVisibilityChange:(Ie,Ee)=>d.setVisibilityState(Ie.id,Ee),getNodeVisibility:Ie=>d.getVisibilityState(Ie),onDownloadStateChanged:p,getDownloadState:I,onFilterClicked:M,hasFiltersApplied:O,depth:0,useLayerTypeIcon:!0})}}),D(ne,R)},$$slots:{default:!0}})}),D(N,T)};me(F,N=>{d.initialized&&N(z)})}D(k,P),je()}class eu{#e=se(null);get mapView(){return u(this.#e)}set mapView(n){$(this.#e,n,!0)}#t=se(Ue(new Set));get interactableLayers(){return u(this.#t)}set interactableLayers(n){$(this.#t,n,!0)}pointerMoveHandle=null;clickHandle=null;leaveHandle=null;enterHandle=null;#n=se(!1);get isInitialized(){return u(this.#n)}set isInitialized(n){$(this.#n,n,!0)}#i=se(!0);get pointerInsideMap(){return u(this.#i)}set pointerInsideMap(n){$(this.#i,n,!0)}initializationInProgress=!1;async initializeAsync(n,s){if(console.log("[map-interaction-store] Initializing with MapView"),this.mapView===n&&this.isInitialized){console.log("[map-interaction-store] MapView is already initialized"),this.interactableLayers=s;return}if(this.initializationInProgress){console.log("[map-interaction-store] Initialization already in progress");return}this.initializationInProgress=!0,console.log("[map-interaction-store] Cleaning up previous MapView if any"),this.cleanup(),this.mapView=n,this.interactableLayers=s,await n.when(),this.setupHighlights(n),this.setupPointerMoveHandler(n),this.setupClickHandler(n),this.setupLeaveHandler(n),this.setupEnterHandler(n),this.isInitialized=!0,console.log("[map-interaction-store] Initialized with MapView"),this.initializationInProgress=!1}updateInteractableLayers(n){this.interactableLayers=n}setupHighlights(n){const s={name:"hover",color:"lightgreen",haloOpacity:1,fillOpacity:.2},l={name:"selected",color:"green",haloOpacity:1,fillOpacity:.3};n.highlights.push(s),n.highlights.push(l)}setupPointerMoveHandler(n){this.pointerMoveHandle=n.on("pointer-move",async s=>{if(!this.pointerInsideMap)return;const{results:l}=await n.hitTest(s),d=l[0];if(!d){this.clearHoverHighlight();return}const h=d.graphic,p=h.layer;if(!h||!p||!this.isLayerInteractable(p.id)||h.attributes?.[p.objectIdField]===void 0){this.clearHoverHighlight();return}const I=h.attributes?.[p.objectIdField];if(!(Ke.currentHoveredArea&&Ke.currentHoveredArea.id===I))try{const M=await n.whenLayerView(p);Ke.layerHighlightState.featureLayerView!==M&&Ke.setSelectedLayerView(M),this.clearHoverHighlight();const O=M;if(!O){console.warn("LayerView is not a FeatureLayerView");return}if(!this.pointerInsideMap)return;const P=O.highlight(h,{name:"hover"});Ke.setHoveredArea(I,P)}catch(M){console.error("Error in pointer-move handler:",M),this.clearHoverHighlight()}})}setupClickHandler(n){this.clickHandle=n.on("click",async s=>{const{results:l}=await n.hitTest(s),d=l[0];if(!d)return;const h=d.graphic,p=h.layer;if(!h||!p||!this.isLayerInteractable(p.id)||h.attributes?.[p.objectIdField]===void 0)return;const I=h.attributes?.[p.objectIdField];try{const M=await n.whenLayerView(p),O=M;if(!O){console.warn("Layer is not a FeatureLayerView");return}Ke.layerHighlightState.featureLayerView!==M&&Ke.setSelectedLayerView(M);const F=(Ke.layerHighlightState.areaInfos||[]).find(z=>z.id===I);if(F)Ke.removeSelectedArea(F.id);else{const z=O.highlight(h,{name:"selected"});Ke.addSelectedArea(I,z)}}catch(M){console.error("Error in click handler:",M)}})}setupLeaveHandler(n){this.leaveHandle=n.on("pointer-leave",()=>{this.pointerInsideMap=!1,this.clearHoverHighlight()})}setupEnterHandler(n){this.enterHandle=n.on("pointer-enter",()=>{this.pointerInsideMap=!0})}isLayerInteractable(n){return this.interactableLayers.has(n)}clearHoverHighlight(){Ke.currentHoveredArea&&Ke.clearHoveredArea()}cleanup(){this.pointerMoveHandle&&(this.pointerMoveHandle.remove(),this.pointerMoveHandle=null),this.clickHandle&&(this.clickHandle.remove(),this.clickHandle=null),this.leaveHandle&&(this.leaveHandle.remove(),this.leaveHandle=null),this.enterHandle&&(this.enterHandle.remove(),this.enterHandle=null),this.clearHoverHighlight(),this.isInitialized=!1,this.mapView=null,this.pointerInsideMap=!0,this.interactableLayers=new Set,console.log("[map-interaction-store] Cleaned up")}get currentMapView(){return this.mapView}get initialized(){return this.isInitialized}}const Rn=new eu;var tu=le('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),nu=le('<div class="esri-ui-element svelte-i0p9uk"><!></div>'),ru=le('<div class="map-view svelte-i0p9uk"></div> <!> <!>',1);function iu(k,n){Re(n,!0);const s=De(n,"webMap",3,null),l=De(n,"panelPosition",3,"top-left"),d=De(n,"menuPosition",3,"top-right");let h=null,p=se(null),I=se(null),M=se(null),O=se(!1);const P="streets-vector";let F,z;Cn(async()=>{await N(),await ne()});async function N(){if(!z){const[{default:re},{default:ie},{default:Se},{default:Pe}]=await Promise.all([en(()=>import("../chunks/Bo-Ws7j2.js").then(be=>be.M),__vite__mapDeps([7,1,2,3,8,4,5,6,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url),en(()=>import("../chunks/CISklr1W.js").then(be=>be.a3),__vite__mapDeps([144,1,2,3,4,39,25,5,6,23,40,41,42,43,9,10,11,12,44,24,21,22,45,46,47,48,13,14,49,50,51,26,90,91,18,33,145,146,147,27,148,149,16,150,7,8,15,17,19,20,28,29,30,31,32,34,35,36,37,38,151,65,56,152,70,61,153,154,155,156,157,158,159,160,59,60,161,162,163,164,165,166,167,168,169,170,171]),import.meta.url),en(()=>import("../chunks/huXfT4GN.js").then(be=>be.W),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143]),import.meta.url),en(()=>import("../chunks/NPoLgU3x.js"),__vite__mapDeps([62,4,1,2,3,43,25,5,6,23,9,10,11,12,44,24,21,22,52,63,64,61,65,66,67,68,38,14,56,69,16,27,70,41,42,45,46,47,48,13,49,50,20,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,53,33,90,91,18,92,93,94,95,96,97,98,99,34,35,36,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,51,116,117,118,119,120,121,122,123,124,125,126,29,127,128,129,17,130,131,132,55,133,134,135,136,137,138,139,140,54]),import.meta.url)]);F=re,z=ie}}async function T(re,ie){const Se=new z({container:ie,popupEnabled:!1,map:re});return await Se.when(),Se}function L(re){re.ui.move("zoom","top-right"),u(I)&&l()&&re.ui.add(u(I),l()),u(M)&&d()&&re.ui.add(u(M),d()),$(O,!0)}async function J(){return new F({basemap:P})}async function U(){if(s())try{if(await N(),await ne(),!u(p)){console.error("MapView is not initialized");return}u(p).map=s(),console.log("[uprn-map-view] MapView updated with new webMap")}catch(re){console.error("Error updating MapView with new webMap:",re)}}async function ne(){if(!h){console.error("Map container element was not found");return}try{$(p,await T(s()??void 0,h),!0),L(u(p)),console.log("[uprn-map-view] Map loaded successfully")}catch(re){console.error("Error loading map:",re),await Z()}}async function Z(){try{const re=await J();$(p,await T(re,h),!0),L(u(p)),console.log("[uprn-map-view] Fallback map loaded")}catch(re){console.error("Error loading fallback map:",re)}}at(()=>{s()&&U()}),at(()=>{if(!u(p)||!n.areaSelectionTreeviewStore.initialized)return;const re=n.areaSelectionTreeviewStore.getNonHiddenNodes().map(ie=>ie.id);Rn.initialized?Rn.updateInteractableLayers(new Set(re)):Rn.initializeAsync(u(p),new Set(re))}),at(()=>{if(!n.areaSelectionTreeviewStore.initialized)return;if(!n.areaSelectionTreeviewStore.getVisibleNodes().length){Ke.resetSelectedAreas();return}const re=n.areaSelectionTreeviewStore.getVisibleNodes()[0];if(!re||!(re instanceof it)){console.warn("Visible node is not a FeatureLayer");return}if(!re.layer){console.warn("Visible node layer is not a FeatureLayer");return}R(re.layer)});async function R(re){if(!u(p))return;const ie=await u(p).whenLayerView(re);if(!ie){console.warn("Could not get LayerView for the visible node layer");return}Ke.setSelectedLayerView(ie)}function de(){Rn.cleanup(),u(p)&&u(p).destroy()}Sr(()=>{de()});var te=ru(),oe=ee(te);Tt(oe,re=>h=re,()=>h);var ye=ce(oe,2);{var Ie=re=>{var ie=tu(),Se=W(ie);{var Pe=be=>{var Te=pe(),xe=ee(Te);$e(xe,()=>n.panel),D(be,Te)};me(Se,be=>{u(O)&&be(Pe)})}V(ie),Tt(ie,be=>$(I,be),()=>u(I)),D(re,ie)};me(ye,re=>{n.panel&&re(Ie)})}var Ee=ce(ye,2);{var ve=re=>{var ie=nu(),Se=W(ie);{var Pe=be=>{var Te=pe(),xe=ee(Te);$e(xe,()=>n.menu),D(be,Te)};me(Se,be=>{u(O)&&be(Pe)})}V(ie),Tt(ie,be=>$(M,be),()=>u(M)),D(re,ie)};me(Ee,re=>{n.menu&&re(ve)})}D(k,te),je()}var au=le('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),ou=le('<div class="flex min-h-0 flex-1 flex-col"><!></div>');function yr(k,n){var s=ou(),l=W(s);Ne(l,()=>vi,(d,h)=>{h(d,{class:"card-content flex min-h-0 flex-1 flex-col overflow-hidden p-0",children:(p,I)=>{var M=au(),O=W(M);$e(O,()=>n.children??tt),V(M),D(p,M)},$$slots:{default:!0}})}),V(s),D(k,s)}var su=le("<!> <!>",1),lu=le('<div class="tab-list-wrapper flex-shrink-0 svelte-rohqkk"><!></div> <!>',1);function uu(k,n){Re(n,!0);const s=De(n,"triggers",19,()=>[]);var l=pe(),d=ee(l);Ne(d,()=>Yo,(h,p)=>{p(h,{get value(){return n.value},get onValueChange(){return n.onValueChange},class:"flex h-full w-full flex-col",children:(I,M)=>{var O=lu(),P=ee(O),F=W(P);Ne(F,()=>Qo,(N,T)=>{T(N,{class:"tab-list",children:(L,J)=>{var U=pe(),ne=ee(U);zt(ne,17,s,In,(Z,R,de,te)=>{let oe=()=>u(R).value,ye=()=>u(R).label;var Ie=su(),Ee=ee(Ie);Ne(Ee,()=>Xo,(ie,Se)=>{Se(ie,{get value(){return oe()},class:"tab-trigger",children:(Pe,be)=>{rn();var Te=vn();nt(()=>gt(Te,ye())),D(Pe,Te)},$$slots:{default:!0}})});var ve=ce(Ee,2);{var re=ie=>{So(ie,{class:"separator"})};me(ve,ie=>{oe()!==s()[s().length-1]?.value&&ie(re)})}D(Z,Ie)}),D(L,U)},$$slots:{default:!0}})}),V(P);var z=ce(P,2);$e(z,()=>n.children??tt),D(I,O)},$$slots:{default:!0}})}),D(k,l),je()}const ge=Object.freeze({LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"});var cu=le("<!> <div><aside><div><div><!></div></div></aside></div> <!>",1);function ka(k,n){Re(n,!0);const s=De(n,"position",19,()=>ge.LEFT),l=De(n,"openIcon",3,vs),d=De(n,"overlay",3,!1),h=8,p="500px",I="calc(var(--header-height, 64px) + 1rem)";let M,O=se(0),P=se(Ue(n.originalSize??p)),F=se(!1),z=se(!1);const N=he(()=>s()===ge.LEFT||s()===ge.RIGHT),T=he(()=>s()===ge.LEFT||s()===ge.TOP),L=he(()=>u(N)?"500px":"100px"),J=he(()=>n.minSize??u(L)),U=he(()=>parseFloat(u(J))),ne=he(()=>u(N)?"width":"height"),Z=he(()=>u(N)?"ew-resize":"ns-resize");at(()=>{u(z)||($(P,n.originalSize??u(J),!0),console.log("Sidebar size updated due to minSize/originalSize change:",u(P),n.originalSize))}),Cn(()=>{if(!M)return;const K=new ResizeObserver(ke=>{for(const He of ke)$(O,u(N)?He.contentRect.width:He.contentRect.height,!0)});return K.observe(M),()=>K.disconnect()});function R(K){if(!n.isOpen)return;$(F,!0),K.preventDefault();const ke=u(N)?K.clientX:K.clientY,He=parseFloat(u(P));function fe(lt){const Xe=u(N)?lt.clientX:lt.clientY,Ct=u(T)?Xe-ke:ke-Xe,Mt=Math.max(u(U),He+Ct);$(P,`${Mt}px`),$(z,!0)}function Ve(){$(F,!1),document.removeEventListener("mousemove",fe),document.removeEventListener("mouseup",Ve),document.body.style.cursor="",document.body.style.userSelect=""}document.addEventListener("mousemove",fe),document.addEventListener("mouseup",Ve),document.body.style.cursor=u(Z),document.body.style.userSelect="none"}const de=he(()=>()=>{const K=n.isOpen?u(P):"0px";return d()?{[ge.LEFT]:{top:"1rem",left:K},[ge.RIGHT]:{top:"1rem",right:K},[ge.TOP]:{top:K,left:"1rem"},[ge.BOTTOM]:{bottom:K,left:"1rem"}}[s()]:{[ge.LEFT]:{top:I,left:K},[ge.RIGHT]:{top:I,right:K},[ge.TOP]:{top:K,left:"1rem"},[ge.BOTTOM]:{bottom:K,left:"1rem"}}[s()]}),te=he(()=>()=>({[ge.LEFT]:"rounded-l-none rounded-r-md",[ge.RIGHT]:"rounded-r-none rounded-l-md",[ge.TOP]:"rounded-t-none rounded-b-md",[ge.BOTTOM]:"rounded-b-none rounded-t-md"})[s()]),oe=he(()=>()=>!d()&&n.isOpen?"":{[ge.LEFT]:"box-shadow: 4px 0 8px -2px rgb(0 0 0 / 0.1), 2px 0 4px -2px rgb(0 0 0 / 0.1);",[ge.RIGHT]:"box-shadow: -4px 0 8px -2px rgb(0 0 0 / 0.1), -2px 0 4px -2px rgb(0 0 0 / 0.1);",[ge.TOP]:"box-shadow: 0 4px 8px -2px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);",[ge.BOTTOM]:"box-shadow: 0 -4px 8px -2px rgb(0 0 0 / 0.1), 0 -2px 4px -2px rgb(0 0 0 / 0.1);"}[s()]),ye=he(()=>()=>({[ge.LEFT]:fs,[ge.RIGHT]:Zo,[ge.TOP]:hs,[ge.BOTTOM]:ds})[s()]),Ie=he(()=>()=>({[ge.LEFT]:`padding-right: ${h}px`,[ge.RIGHT]:`padding-left: ${h}px`,[ge.TOP]:`padding-bottom: ${h}px`,[ge.BOTTOM]:`padding-top: ${h}px`})[s()]),Ee=he(()=>()=>{if(!n.isOpen)return{};const K=`${h}px`,ke=n.isOpen?`calc(${u(P)} + ${-h/2}px)`:"0px";return d()?{[ge.LEFT]:{left:ke,top:"0",width:K,height:"100%"},[ge.RIGHT]:{right:ke,top:"0",width:K,height:"100%"},[ge.TOP]:{top:ke,left:"0",height:K,width:"100%"},[ge.BOTTOM]:{bottom:ke,left:"0",height:K,width:"100%"}}[s()]:{[ge.LEFT]:{left:ke,top:"0",width:K,height:"100%"},[ge.RIGHT]:{right:ke,top:"0",width:K,height:"100%"},[ge.TOP]:{top:ke,left:"0",height:K,width:"100%"},[ge.BOTTOM]:{bottom:ke,left:"0",height:K,width:"100%"}}[s()]});function ve(K){return Object.entries(K).map(([ke,He])=>`${ke}: ${He}`).join("; ")}const re=he(()=>u(T)?0:1),ie=he(()=>()=>n.isOpen?"translate(0, 0)":{[ge.LEFT]:`translate(-${u(P)}, 0)`,[ge.RIGHT]:`translate(${u(P)}, 0)`,[ge.TOP]:`translate(0, -${u(P)})`,[ge.BOTTOM]:`translate(0, ${u(P)})`}[s()]),Se=he(()=>()=>{const K=n.isOpen?u(P):"0px";if(d()){if(u(N)){const He={position:"absolute",top:"0",bottom:"0",width:K,height:"100%","z-index":"30"};return He[s()===ge.LEFT?"left":"right"]="0",He}const ke={position:"absolute",left:"0",right:"0",height:K,width:"100%","z-index":"30"};return ke[s()===ge.TOP?"top":"bottom"]="0",ke}return{[u(ne)]:K,order:`${u(re)}`}});var Pe=cu(),be=ee(Pe);{let K=he(()=>d()?"absolute":"fixed"),ke=he(()=>u(te)()),He=he(()=>u(F)?"":"transition-all duration-300"),fe=he(()=>ve(u(de)())),Ve=he(()=>u(oe)()),lt=he(()=>u(F)?"transition: none !important;":""),Xe=he(()=>n.isOpen?"Close sidebar":"Open sidebar");Pt(be,{get onclick(){return n.onToggle},variant:"default",size:"icon",get class(){return`size-7 ${u(K)??""} z-[10] !bg-background hover:scale-105 hover:!bg-background/90 ${u(ke)??""} ${u(He)??""}`},get style(){return`${u(fe)??""}; pointer-events: auto; ${u(Ve)??""} ${u(lt)??""}`},get"aria-label"(){return u(Xe)},get"aria-expanded"(){return n.isOpen},children:(Ct,Mt)=>{var ut=pe(),mt=ee(ut);{var Ut=At=>{const Ot=he(()=>u(ye)());var Dt=pe(),Lt=ee(Dt);Ne(Lt,()=>u(Ot),(vt,bt)=>{bt(vt,{class:"h-6 w-6 text-primary"})}),D(At,Dt)},yt=At=>{const Ot=he(l);var Dt=pe(),Lt=ee(Dt);Ne(Lt,()=>u(Ot),(vt,bt)=>{bt(vt,{class:"h-6 w-6 text-primary"})}),D(At,Dt)};me(mt,At=>{n.isOpen?At(Ut):At(yt,!1)})}D(Ct,ut)},$$slots:{default:!0}})}var Te=ce(be,2);let xe;var Ae=W(Te);let Me;var Be=W(Ae);let rt;var Fe=W(Be);let Ye;var Qe=W(Fe);{var Ze=K=>{var ke=pe(),He=ee(ke);$e(He,()=>n.children),D(K,ke)};me(Qe,K=>{n.children&&K(Ze)})}V(Fe),V(Be),V(Ae),Tt(Ae,K=>M=K,()=>M),V(Te);var ht=ce(Te,2);{var kt=K=>{{let ke=he(()=>d()?"absolute":"fixed"),He=he(()=>u(N)?"cursor-ew-resize":"cursor-ns-resize"),fe=he(()=>u(F)?"":"transition-all duration-300"),Ve=he(()=>ve(u(Ee)()));Pt(K,{get class(){return`${u(ke)??""} z-40 border-0 bg-transparent p-0 ring-0 transition-colors outline-none hover:!bg-primary/50 focus-visible:ring-0 ${u(He)??""} ${u(fe)??""}`},onmousedown:R,"aria-label":"Resize sidebar by dragging",get style(){return`${u(Ve)??""}; outline: none !important; box-shadow: none !important; border: none !important;`}})}};me(ht,K=>{n.isOpen&&K(kt)})}nt((K,ke,He,fe,Ve,lt,Xe)=>{xe=Jt(Te,1,"relative",null,xe,K),tn(Te,ke),Me=Jt(Ae,1,`relative flex bg-card text-card-foreground ${d()?"shadow-2xl":"shadow-lg"}`,null,Me,He),tn(Ae,`${u(ne)??""}: ${u(P)??""}; transform: ${fe??""};`),rt=Jt(Be,1,"flex overflow-hidden",null,rt,Ve),tn(Be,lt),Ye=Jt(Fe,1,"flex overflow-hidden",null,Ye,Xe)},[()=>({"overflow-hidden":!d(),"overflow-visible":d(),"h-full":u(N),"w-full":!u(N),"transition-all":!u(F),"duration-300":!u(F),"z-30":d()}),()=>ve(u(Se)()),()=>({"flex-col":u(N),"flex-row":!u(N),"h-full":u(N),"w-full":!u(N),"border-r":s()===ge.LEFT,"border-l":s()===ge.RIGHT,"border-b":s()===ge.TOP,"border-t":s()===ge.BOTTOM,"border-sidebar-border":!0,"transition-transform":!u(F),"duration-300":!u(F),"pointer-events-auto":d(),"z-30":d()}),()=>u(ie)(),()=>({"flex-col":u(N),"flex-row":!u(N),"h-full":u(N),"w-full":!u(N)}),()=>u(Ie)(),()=>({"flex-col":u(N),"flex-row":!u(N),"h-full":u(N),"w-full":!u(N)})]),D(k,Pe),je()}var du=le('<div><!> <div class="main-content svelte-f4u9lw"><!></div></div>');function fu(k,n){Re(n,!0);const s=De(n,"position",19,()=>ge.LEFT),l=he(()=>s()===ge.TOP||s()===ge.BOTTOM);var d=du();let h;var p=W(d);ka(p,{get isOpen(){return n.isOpen},get onToggle(){return n.onToggle},get position(){return s()},get originalSize(){return n.originalSize},get minSize(){return n.minSize},get openIcon(){return n.openIcon},children:(P,F)=>{var z=pe(),N=ee(z);{var T=L=>{var J=pe(),U=ee(J);$e(U,()=>n.sidebarContent),D(L,J)};me(N,L=>{n.sidebarContent&&L(T)})}D(P,z)},$$slots:{default:!0}});var I=ce(p,2),M=W(I);{var O=P=>{var F=pe(),z=ee(F);$e(z,()=>n.mainContent),D(P,F)};me(M,P=>{n.mainContent&&P(O)})}V(I),V(d),nt(P=>h=Jt(d,1,"sidebar-layout svelte-f4u9lw",null,h,P),[()=>({vertical:u(l)})]),D(k,d),je()}var hu=le('<div class="min-w-0 space-y-2 overflow-hidden p-4"><!></div>'),vu=le('<div class="w-full flex-1 overflow-hidden"><!></div>');function pu(k,n){var s=vu(),l=W(s);xo(l,{class:"h-full w-full",children:(d,h)=>{var p=hu(),I=W(p);{var M=O=>{var P=pe(),F=ee(P);$e(F,()=>n.children),D(O,P)};me(I,O=>{n.children&&O(M)})}V(p),D(d,p)},$$slots:{default:!0}}),V(s),D(k,s)}var gu=le('<div class="w-full flex-shrink-0"><!></div>');function mu(k,n){var s=gu(),l=W(s);{var d=h=>{var p=pe(),I=ee(p);$e(I,()=>n.children),D(h,p)};me(l,h=>{n.children&&h(d)})}V(s),D(k,s)}var yu=le('<div class="w-full flex-shrink-0"><!></div>');function bu(k,n){var s=yu(),l=W(s);{var d=h=>{var p=pe(),I=ee(p);$e(I,()=>n.children),D(h,p)};me(l,h=>{n.children&&h(d)})}V(s),D(k,s)}class da{#e=[];#t=new Map;#n=[];#i=new Map;#r=[];#a=new Map;#u=new Set;constructor(n){if(!n)throw new Error("TreeviewConfigStore requires a valid configuration object.");this.#e=n.items??[],this.#t=new Map(this.#e.map(s=>[s.id,s])),this.#n=n.visibilityGroups??[],this.#i=new Map(this.#n.map(s=>[s.id,s])),this.#r=n.inheritanceGroups??[],this.#a=new Map(this.#r.map(s=>[s.id,s])),n.fieldsToHide&&(this.#u=new Set(n.fieldsToHide.map(s=>s.trim().toLowerCase())))}getItemConfig(n){return this.#t.get(n)}getVisibilityGroupConfig(n){return this.#i.get(n)}getInheritanceGroupConfig(n){return this.#a.get(n)}resolveInheritance(n){if(!(n.length===0||!this.#e||this.#e.length===0))for(const s of n){const l=this.getItemConfig(s.id);this.#d(s,l)}}#d(n,s){const l=this.#s(n,s);if(this.#m(n)&&l.showFields){const d=n;d.loaded||console.warn(`Layer not loaded: ${n.id}`);for(const h of d.fields??[])this.#f(this.#v(n.id,h.name),h.alias||h.name,l)}if(this.#p(n)){const d=n;for(const h of d.layers.toArray())this.#d(h,l)}}#s(n,s){const l=this.#h(n.id,s);return l.type===gr.None&&(l.type=Jo(n)),l}#f(n,s,l){const d=this.#h(n,l);return d.type===gr.None&&(d.type=gr.Field),this.#u.has(s.trim().toLowerCase())&&(d.isHidden=!0),d}#h(n,s){let l=this.getItemConfig(n);const d=l?.inheritanceGroupId?this.getInheritanceGroupConfig(l.inheritanceGroupId):this.getInheritanceGroupConfig(s?.inheritanceGroupId??"");return l={id:n,type:gr.None,isDownloadable:this.#o(d,"isDownloadable",l,s,!0),isVisibleOnInit:this.#o(d,"isVisibleOnInit",l,s,!1),isHidden:this.#o(d,"isHidden",l,s,!1),showFields:this.#o(d,"showFields",l,s,!1),visibilityDependencyIds:this.#o(d,"visibilityDependencyIds",l,s,[]),visibilityGroupId:this.#o(d,"visibilityGroupId",l,s,void 0),customConverterId:this.#o(d,"customConverterId",l,s,void 0),inheritanceGroupId:this.#o(d,"inheritanceGroupId",l,s,void 0)},this.#l(l),this.#g(l),l}#o(n,s,l,d,h){const p=l?.[s];return p!==void 0?p:n?.inheritedProperties.includes(s)&&d?d[s]??h:h}#g(n){if(this.#t.has(n.id))throw new Error(`Item with id ${n.id} already exists.`);this.#e.push(n),this.#t.set(n.id,n)}#l(n){this.#t.has(n.id)&&(this.#e=this.#e.filter(s=>s.id!==n.id),this.#t.delete(n.id))}#v(n,s){return`${n}-${s}`}#p(n){return n.type==="group"}#m(n){return n.type==="feature"}}const wu=[{value:"define-areas",label:"Define Areas"},{value:"select-data",label:"Select Data"},{value:"export",label:"Export"},{value:"downloads",label:"Download"}];var _u=le('<div class="flex h-full w-full min-w-0 flex-col overflow-hidden"><!></div>'),Su=le("<!> <!> <!> <!>",1),xu=le('<div class="relative flex h-full w-full min-w-0 flex-col overflow-visible"><!> <!> <!> <!></div>'),ku=le("<!> <!> <!> <!> <!>",1);function ec(k,n){Re(n,!0);const s=Ue(new il),l=Ue(new rl),d=Ue(new ya);let h=se("define-areas"),p=se(void 0),I=se(void 0),M=se(!0),O=Ue(ge.LEFT),P=se(!0),F=Ue(ge.BOTTOM),z=se(Ue([])),N=se(Ue(typeof window<"u"?window.innerWidth:1280)),T=he(()=>J(u(z),ve=>ve.originalSize)),L=he(()=>J(u(z),ve=>ve.minSize));function J(ve,re){if(!ve||ve.length===0)return;const Se=[...ve].sort((Pe,be)=>be.breakpoint-Pe.breakpoint).find(Pe=>u(N)>=Pe.breakpoint);return Se?re(Se):"0"}function U(){$(M,!u(M))}function ne(){$(P,!u(P))}function Z(ve){$(h,ve,!0)}function R(){$(h,"downloads")}Cn(async()=>{const ve=await ko();Ke.setNameFields(ve.serviceUprn2Config.selectionLayersNameFields||[]),$(z,ve.serviceUprn2Config.mainSidebarSizes||[],!0),$(p,new da(ve.serviceUprn2Config.dataSelectionTreeviewConfig),!0),$(I,new da(ve.serviceUprn2Config.areaSelectionTreeviewConfig),!0),await s.initializeAsync({portalUrl:ve.serviceUprn2Config.portalUrl,itemId:ve.serviceUprn2Config.portalItemId||"",proxy:ve.serviceUprn2Config.proxy}),console.log("[page] WebMap loaded")}),Cn(()=>{const ve=()=>{$(N,window.innerWidth,!0)};return window.addEventListener("resize",ve),()=>{window.removeEventListener("resize",ve)}}),Sr(()=>{Ke.cleanup(),wt.cleanup(),Rn.cleanup()});var de=ku(),te=ee(de);es(te,{});var oe=ce(te,2);_s(oe,{});var ye=ce(oe,2);Tl(ye,{get fieldFilterMenuStore(){return l}});var Ie=ce(ye,2);Ss(Ie,{});var Ee=ce(Ie,2);{const ve=ie=>{var Se=xu(),Pe=W(Se);Ne(Pe,()=>mu,(Ae,Me)=>{Me(Ae,{children:(Be,rt)=>{var Fe=_u(),Ye=W(Fe);uu(Ye,{get value(){return u(h)},get triggers(){return wu},onValueChange:Z}),V(Fe),D(Be,Fe)},$$slots:{default:!0}})});var be=ce(Pe,2);Ne(be,()=>pu,(Ae,Me)=>{Me(Ae,{children:(Be,rt)=>{var Fe=Su(),Ye=ee(Fe);{var Qe=fe=>{yr(fe,{children:(Ve,lt)=>{var Xe=pe(),Ct=ee(Xe);{var Mt=ut=>{Vl(ut,{get webMap(){return s.data},get treeviewStore(){return d},get treeviewConfigStore(){return u(I)}})};me(Ct,ut=>{u(h)==="define-areas"&&s.isLoaded&&ut(Mt)})}D(Ve,Xe)}})};me(Ye,fe=>{u(h)==="define-areas"&&fe(Qe)})}var Ze=ce(Ye,2);{var ht=fe=>{yr(fe,{children:(Ve,lt)=>{var Xe=pe(),Ct=ee(Xe);{var Mt=ut=>{Jl(ut,{get webMap(){return s.data},get treeviewConfigStore(){return u(p)},get fieldFilterMenuStore(){return l}})};me(Ct,ut=>{s.isLoaded&&ut(Mt)})}D(Ve,Xe)}})};me(Ze,fe=>{u(h)==="select-data"&&fe(ht)})}var kt=ce(Ze,2);{var K=fe=>{yr(fe,{children:(Ve,lt)=>{bl(Ve,{get webMapStore(){return s},get areaSelectionTreeviewStore(){return d},get fieldFilterMenuStore(){return l}})}})};me(kt,fe=>{u(h)==="export"&&fe(K)})}var ke=ce(kt,2);{var He=fe=>{yr(fe,{children:(Ve,lt)=>{Js(Ve,{})}})};me(ke,fe=>{u(h)==="downloads"&&fe(He)})}D(Be,Fe)},$$slots:{default:!0}})});var Te=ce(be,2);Ne(Te,()=>bu,(Ae,Me)=>{Me(Ae,{children:(Be,rt)=>{var Fe=pe(),Ye=ee(Fe);{var Qe=Ze=>{nl(Ze,{onExportSuccess:R})};me(Ye,Ze=>{u(h)==="export"&&Ze(Qe)})}D(Be,Fe)},$$slots:{default:!0}})});var xe=ce(Te,2);{const Ae=Me=>{Rs(Me,{})};Ne(xe,()=>ka,(Me,Be)=>{Be(Me,{get isOpen(){return u(P)},onToggle:ne,get position(){return F},originalSize:"300px",overlay:!0,get openIcon(){return cs},children:Ae,$$slots:{default:!0}})})}V(Se),D(ie,Se)},re=ie=>{iu(ie,{get webMap(){return s.data},get areaSelectionTreeviewStore(){return d},panelPosition:"top-left",menuPosition:"top-right"})};Ne(Ee,()=>fu,(ie,Se)=>{Se(ie,{get isOpen(){return u(M)},onToggle:U,get position(){return O},get originalSize(){return u(T)},get minSize(){return u(L)},sidebarContent:ve,mainContent:re,$$slots:{sidebarContent:!0,mainContent:!0}})})}D(k,de),je()}export{ec as component};
