import{_ as f,a as w}from"./Aa_nm3Tf.js";import{_ as m}from"./CT-_SrKz.js";import{N as y}from"./BFGjv385.js";import{O as _}from"./BAwhstd8.js";import{a as c}from"./BHwe4xe6.js";import{watch as o,initial as h,on as V}from"./D5lfJVJF.js";import"./DSdBzmdi.js";import{b as v}from"./DXFGJKYs.js";import{i as g}from"./Bm08ESa6.js";import{O as d}from"./OTy9O-X0.js";import{d as C}from"./hJHxVoOx.js";import{r as b}from"./4gOGmhHq.js";const u="sublayers",l="layerView";let p=class extends v(C){*graphicsViews(){this._graphicsViewsFeatureCollectionMap==null?this._graphicsViews==null?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(i,r){return Array.from(this.graphicsViews(),s=>{const t=s.hitTest(i);if(this._graphicsViewsFeatureCollectionMap!=null){const a=this._graphicsViewsFeatureCollectionMap.get(s);for(const e of t)!e.popupTemplate&&a.popupTemplate&&(e.popupTemplate=a.popupTemplate),e.sourceLayer=e.layer=this.layer}return t}).flat().map(s=>({type:"graphic",graphic:s,layer:this.layer,mapPoint:i}))}highlight(i,r){let s;typeof i=="number"?s=[i]:i instanceof m?s=[i.uid]:Array.isArray(i)&&i.length>0?s=typeof i[0]=="number"?i:i.map(e=>e&&e.uid):_.isCollection(i)&&(s=i.map(e=>e&&e.uid).toArray());const t=s?.filter(y);if(!t?.length)return c();const a=b(r);return this._addHighlights(t,a),c(()=>this._removeHighlights(t,a))}update(i){for(const r of this.graphicsViews())r.processUpdate(i)}attach(){const i=this.view,r=()=>this.requestUpdate(),s=this.layer.featureCollections;if(s!=null&&s.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const t of s){const a=new g(this.view.featuresTilingScheme),e=new d({view:i,graphics:t.source,renderer:t.renderer,requestUpdateCallback:r,container:a});this._graphicsViewsFeatureCollectionMap.set(e,t),this.container.addChild(e.container),this.addHandles([o(()=>t.visible,n=>e.container.visible=n,h),o(()=>e.updating,()=>this.notifyChange("updating"),h)],l)}this._processHighlight()}else this.layer.sublayers!=null&&this.addHandles(V(()=>this.layer.sublayers,"change",()=>this._createGraphicsViews(),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),u)}detach(){this._destroyGraphicsViews(),this.removeHandles(u)}moveEnd(){}viewChange(){for(const i of this.graphicsViews())i.viewChange()}isUpdating(){for(const i of this.graphicsViews())if(i.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(l);for(const i of this.graphicsViews())i.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),this.layer.sublayers==null)return;const i=[],r=this.view,s=()=>this.requestUpdate();for(const t of this.layer.sublayers){const a=new g(this.view.featuresTilingScheme);a.fadeTransitionEnabled=!0;const e=new d({view:r,graphics:t.graphics,requestUpdateCallback:s,container:a});this.addHandles([t.on("graphic-update",e.graphicUpdateHandler),o(()=>t.visible,n=>e.container.visible=n,h),o(()=>e.updating,()=>this.notifyChange("updating"),h)],l),this.container.addChild(e.container),i.push(e)}this._graphicsViews=i,this._processHighlight()}_processHighlight(){const i=this._getHighlights();for(const r of this._graphicsViews||[])r.setHighlight(i);this._graphicsViewsFeatureCollectionMap?.forEach((r,s)=>{s.setHighlight(i)})}};p=f([w("esri.views.2d.layers.MapNotesLayerView2D")],p);const O=p;export{O as default};
