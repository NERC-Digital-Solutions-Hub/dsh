import{u as E}from"./BEA_VxVb.js";import{_ as U}from"./AqFDIo71.js";import{u as q}from"./BFGjv385.js";import{i as O}from"./DSdBzmdi.js";import{m as _}from"./hRXT0cbk.js";function I(a){return a&&a.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function x(a){return a!=null&&!isNaN(a)&&isFinite(a)}function Z(a){return a.valueExpression?"expression":a.field&&typeof a.field=="string"?"field":"unknown"}function re(a,r){const n=r||Z(a),e=a.valueUnit||"unknown";return n==="unknown"?"constant":a.stops?"stops":a.minSize!=null&&a.maxSize!=null&&a.minDataValue!=null&&a.maxDataValue!=null?"clamped-linear":e==="unknown"?a.minSize!=null&&a.minDataValue!=null?a.minSize&&a.minDataValue?"proportional":"additive":"identity":"real-world-size"}const D=()=>O.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),y=a=>D().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${a}`),z=()=>D().error("Use of arcade expressions requires an arcade context"),k=new U,g=Math.PI,A=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function M(a,r,n){const e="visualVariables"in a?a.visualVariables?.find(u=>u.type==="color"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void y("ColorVariable");const t=typeof r=="number",l=t?null:r,s=l?.attributes;let o=t?r:null;const i=e.field,{ipData:c,hasExpression:v}=e.cache;let f=e.cache.compiledFunc;if(!i&&!v){const u=e.stops;return u&&u[0]&&u[0].color}if(typeof o!="number")if(v){if(n?.arcade==null)return void z();const u={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},d=n.arcade.arcadeUtils,h=d.getViewInfo(u),V=d.createExecContext(l,h,n.timeZone);if(!f){const w=d.createSyntaxTree(e.valueExpression);f=d.createFunction(w),e.cache.compiledFunc=f}o=d.executeFunction(f,V)}else s&&(o=s[i]);const p=e.normalizationField,m=s!=null&&p!=null?parseFloat(s[p]):void 0;if(o!=null&&(!p||t||!isNaN(m)&&m!==0)){x(m)&&!t&&(o/=m);const u=F(o,c);if(u){const d=u[0],h=u[1],V=d===h?e.stops[d].color:E.blendColors(e.stops[d].color,e.stops[h].color,u[2],n?.color);return new E(V)}}}function R(a,r,n){const e="visualVariables"in a?a.visualVariables?.find(u=>u.type==="opacity"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void y("OpacityVariable");const t=typeof r=="number",l=t?null:r,s=l?.attributes;let o=t?r:null;const i=e.field,{ipData:c,hasExpression:v}=e.cache;let f=e.cache.compiledFunc;if(!i&&!v){const u=e.stops;return u&&u[0]&&u[0].opacity}if(typeof o!="number")if(v){if(n?.arcade==null)return void z();const u={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},d=n.arcade.arcadeUtils,h=d.getViewInfo(u),V=d.createExecContext(l,h,n.timeZone);if(!f){const w=d.createSyntaxTree(e.valueExpression);f=d.createFunction(w),e.cache.compiledFunc=f}o=d.executeFunction(f,V)}else s&&(o=s[i]);const p=e.normalizationField,m=s!=null&&p!=null?parseFloat(s[p]):void 0;if(o!=null&&(!p||t||!isNaN(m)&&m!==0)){x(m)&&!t&&(o/=m);const u=F(o,c);if(u){const d=u[0],h=u[1];if(d===h)return e.stops[d].opacity;{const V=e.stops[d].opacity;return V+(e.stops[h].opacity-V)*u[2]}}}}function C(a,r,n){const e="visualVariables"in a?a.visualVariables?.find(m=>m.type==="rotation"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void y("RotationVariable");const t=e.axis||"heading",l=t==="heading"&&e.rotationType==="arithmetic"?90:0,s=t==="heading"&&e.rotationType==="arithmetic"?-1:1,o=typeof r=="number"?null:r,i=o?.attributes,c=e.field,{hasExpression:v}=e.cache;let f=e.cache.compiledFunc,p=null;if(!c&&!v)return p;if(v){if(n?.arcade==null)return void z();const m={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},u=n.arcade.arcadeUtils,d=u.getViewInfo(m),h=u.createExecContext(o,d,n.timeZone);if(!f){const V=u.createSyntaxTree(e.valueExpression);f=u.createFunction(V),e.cache.compiledFunc=f}p=u.executeFunction(f,h)}else i&&(p=i[c]);return p=typeof p!="number"||isNaN(p)?null:l+s*p,p}function j(a,r,n){const e=typeof r=="number",t=e?null:r,l=t?.attributes;let s=e?r:null;const{isScaleDriven:o}=a.cache;let i=a.cache.compiledFunc;if(o){const v=n?.scale,f=n?.view;s=v==null||f==="3d"?P(a):v}else if(!e)switch(a.inputValueType){case"expression":{if(n?.arcade==null)return void z();const v={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},f=n.arcade.arcadeUtils,p=f.getViewInfo(v),m=f.createExecContext(t,p,n.timeZone);if(!i){const u=f.createSyntaxTree(a.valueExpression);i=f.createFunction(u),a.cache.compiledFunc=i}s=f.executeFunction(i,m);break}case"field":l&&(s=l[a.field]);break;case"unknown":s=null}if(!x(s))return null;if(e||!a.normalizationField)return s;const c=l?parseFloat(l[a.normalizationField]):null;return x(c)&&c!==0?s/c:null}function P(a){let r=null,n=null;const e=a.stops;return e?(r=e[0].value,n=e[e.length-1].value):(r=a.minDataValue||0,n=a.maxDataValue||0),(r+n)/2}function S(a,r,n){const e="visualVariables"in a?a.visualVariables?.find(l=>l.type==="size"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void y("SizeVariable");const t=T(j(e,r,n),e,r,n,e.cache.ipData);return t==null||isNaN(t)?void 0:t}function b(a,r,n){return a==null?null:I(a)?S(a,r,n):x(a)?a:null}function N(a,r,n){return x(n)&&a>n?n:x(r)&&a<r?r:a}function B(a,r,n,e){const t=b(r.minSize,n,e)||r.minDataValue;return a==null&&t==null?null:(a??0)+(t??0)}function L(a,r,n){const e=a.stops;let t=e?.length&&e[0].size;return t==null&&(t=a.minSize),b(t,r,n)}function G(a,r,n,e){const t=b(r.minSize,n,e);if(a==null)return t;const{minDataValue:l,maxDataValue:s}=r;if(l==null||s==null)return null;const o=(a-l)/(s-l),i=b(r.maxSize,n,e),c=e?.shape;if(a<=l)return t;if(a>=s)return i;if(t==null||i==null)return null;if(r.scaleBy==="area"&&c){const v=c==="circle",f=v?g*(t/2)**2:t*t,p=f+o*((v?g*(i/2)**2:i*i)-f);return v?2*Math.sqrt(p/g):Math.sqrt(p)}return t+o*(i-t)}function H(a,r,n,e){const t=b(r.minSize,n,e);if(a==null||t==null)return t;const l=e?.shape,{minDataValue:s}=r;if(s==null)return null;const o=a/s,i=b(r.maxSize,n,e);let c=null;return c=l==="circle"?2*Math.sqrt(o*(t/2)**2):l==="square"||l==="diamond"||l==="image"?Math.sqrt(o*t**2):o*t,N(c,t,i)}function J(a,r,n,e,t){if(a==null)return null;const[l,s,o]=F(a,t);if(l===s)return b(r.stops?.[l].size,n,e);{const i=b(r.stops?.[l].size,n,e),c=b(r.stops?.[s].size,n,e);return i==null||c==null?null:i+(c-i)*o}}function K(a,r,n,e){const t=(e?.resolution??1)*_[r.valueUnit],l=b(r.minSize,n,e),s=b(r.maxSize,n,e),{valueRepresentation:o}=r;if(a==null)return l;let i=null;return i=o==="area"?2*Math.sqrt(a/g)/t:o==="radius"||o==="distance"?2*a/t:a/t,N(i,l,s)}function T(a,r,n,e,t){switch(r.transformationType){case"additive":return B(a,r,n,e);case"constant":return L(r,n,e);case"clamped-linear":return G(a,r,n,e);case"proportional":return H(a,r,n,e);case"stops":return J(a,r,n,e,t);case"real-world-size":return K(a,r,n,e);case"identity":return a;case"unknown":return null}}function Q(a,r,n){const{isScaleDriven:e}=a.cache;if(!(e&&n==="3d"||r))return null;const t={scale:r,view:n};let l=b(a.minSize,k,t),s=b(a.maxSize,k,t);if(l!=null||s!=null){if(l>s){const o=s;s=l,l=o}return{minSize:l,maxSize:s}}}function W(a,r,n){if(!a.visualVariables)return;const e=[],t=[],l=[],s=[],o=[];for(const i of a.visualVariables)switch(i.type){case"color":t.push(i);break;case"opacity":l.push(i);break;case"rotation":o.push(i);break;case"size":s.push(i)}return t.forEach(i=>{const c=M(i,r,n);e.push({variable:i,value:c})}),l.forEach(i=>{const c=R(i,r,n);e.push({variable:i,value:c})}),o.forEach(i=>{const c=C(i,r,n);e.push({variable:i,value:c})}),s.forEach(i=>{const c=S(i,r,n);e.push({variable:i,value:c})}),e}function F(a,r){if(!r)return;let n=0,e=r.length-1;return r.some((t,l)=>a<t?(e=l,!0):(n=l,!1)),[n,e,(a-r[n])/(r[e]-r[n])]}function X(a,r,n){const e=["proportional","proportional","proportional"];for(const t of a){const l=t.useSymbolValue?"symbol-value":S(t,r,n)??"proportional";switch(t.axis){case"width":e[0]=l;break;case"depth":e[1]=l;break;case"height":e[2]=l;break;case"width-and-depth":e[0]=l,e[1]=l;break;case"all":case void 0:case null:e[0]=l,e[1]=l,e[2]=l;break;default:q(t.axis)}}return e}const te=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:X,getColor:M,getOpacity:R,getRotationAngle:C,getSize:S,getSizeForValue:T,getSizeFromNumberOrVariable:b,getSizeRangeAtScale:Q,getVisualVariableValues:W,viewScaleRE:A},Symbol.toStringTag,{value:"Module"}));export{W as D,X as U,Z as i,re as l,C as m,I as n,A as p,te as v};
