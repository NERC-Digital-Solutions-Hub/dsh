import{O as y}from"./D1sKJjB8.js";import{x as d,_ as m,K as b}from"./COT3swUQ.js";import{r as L}from"./DGRj8LLO.js";import"./BzZgUCJc.js";import"./Cad-p0g1.js";import"./C9_KfL0q.js";import"./fh0BQpDQ.js";function G(e,a){return e.allLayerViews.find(t=>t.uid===a)?.layer.parent===e.map?.basemap}function C(e,a){return e===a||e?.portalItem?.id!=null&&e.portalItem.id===a?.portalItem?.id?!0:h(u(e),u(a))==="equal"}function D(e){return!!e?.baseLayers.concat(e.referenceLayers).some(S)}function S(e){if(s(e.url))return!0;if(e.type==="vector-tile")for(const a in e.sourceNameToSource){const r=e.sourceNameToSource[a];if(s(r?.sourceUrl))return!0}return!1}function N(e,a){if(a==null||e==null)return{spatialReference:null,updating:!1};if(a.loadStatus==="not-loaded")return a.load(),{spatialReference:null,updating:!0};if(a.spatialReference)return{spatialReference:a.spatialReference,updating:!1};if(a.baseLayers.length===0)return{spatialReference:null,updating:!1};const r=a.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const t=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),l=e.spatialReference;return l?{spatialReference:t.find(p=>l.equals(p))??t[0]??null,updating:!1}:{spatialReference:t[0],updating:!1}}const v=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function s(e){if(!e)return!1;const a=new d(m(e));return!!a.authority&&v.test(a.authority)}function u(e){return e?!e.loaded&&e.resourceInfo?I(e.resourceInfo.data):{baseLayers:n(e.baseLayers),referenceLayers:n(e.referenceLayers),groundLayers:n(e.groundLayers)}:null}function n(e){return(y.isCollection(e)?e.toArray():e).map(g)}function g(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:o("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null?void 0:e.sublayers?.map(a=>({id:a.id,visible:a.visible})),activeLayerId:e.type==="wmts"?e.activeLayer?.id:void 0}}function c(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function I(e){return e?{baseLayers:i((e.baseMapLayers??[]).filter(a=>!c(a))),referenceLayers:i((e.baseMapLayers??[]).filter(a=>c(a))),groundLayers:i(e.groundLayers??[])}:null}function i(e){return e.map(a=>R(a))}function R(e){let a;switch(e.layerType){case"VectorTileLayer":a="vector-tile";break;case"ArcGISTiledMapServiceLayer":a="tile";break;case"ArcGISSceneServiceLayer":a="scene";break;case"IntegratedMesh3DTilesLayer":a="IntegratedMesh3DTilesLayer";break;default:a="unknown"}return{type:a,effect:e.effect,url:o(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function h(e,a,r){return e!=null!=(a!=null)?"not-equal":!e||!a||f(e.baseLayers,a.baseLayers)&&f(e.referenceLayers,a.referenceLayers)?"equal":"not-equal"}function f(e,a){if(e.length!==a.length)return!1;for(let r=0;r<e.length;r++)if(!x(e[r],a[r]))return!1;return!0}function x(e,a){if(e.type!==a.type||e.url!==a.url||e.minScale!==a.minScale||e.maxScale!==a.maxScale||e.visible!==a.visible||e.opacity!==a.opacity||!L(e.effect,a.effect))return!1;if(e.activeLayerId!=null||a.activeLayerId!=null)return e.activeLayerId===a.activeLayerId;if(e.sublayers!=null||a.sublayers!=null){if(e.sublayers==null||a.sublayers==null||e.sublayers.length!==a.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const t=e.sublayers.at(r),l=a.sublayers.at(r);if(t?.id!==l?.id||t?.visible!==l?.visible)return!1}}return!0}function o(e){return e?b(e).replace(/^\s*https?:/i,"").toLowerCase():""}export{S as b,G as c,N as d,D as m,C as p};
