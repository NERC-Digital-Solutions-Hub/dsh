import{m as U}from"./DPHDVB8x.js";import{a as q,L as Z}from"./waHvktcX.js";import{l as z,r as $,m as x,aw as N,a as B}from"./2T-d3wGY.js";var C;let g=C=class extends z{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new C({variableName:this.variableName,dimensionName:this.dimensionName,values:q(this.values),isSlice:this.isSlice})}};$([x({type:String,json:{write:!0}})],g.prototype,"variableName",void 0),$([x({type:String,json:{write:!0}})],g.prototype,"dimensionName",void 0),$([x({type:N.array(N.oneOf([N.native(Number),N.array(N.native(Number))])),json:{write:!0}})],g.prototype,"values",void 0),$([x({type:Boolean,json:{write:!0}})],g.prototype,"isSlice",void 0),g=C=$([B("esri.layers.support.DimensionalDefinition")],g);const J="Raster.",b="Raster.Dim.",M=".Max",w={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},I=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function D(e,n){return new U({name:e,alias:n,domain:null,editable:!1,length:50,type:"string"})}function S(e,n){return new U({name:e,alias:n,domain:null,editable:!1,type:"double"})}function Q(e,n){return new U({name:e,alias:n,domain:null,editable:!1,type:"date"})}function re(e){return D(w.servicePixelValue,e??"Service Pixel Value")}function se(e){return D(w.rawServicePixelValue,e??"Raw Service Pixel Value")}function le(){return D(w.itemPixelValue,"Item Pixel Value")}function ue(e){return D(`${w.servicePixelValue}.${e}`,e)}function oe(e){return S(`${w.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function me(){return S(`${w.direction}`,"Direction (Â°)")}function ce(e){return e.fields.filter((n=>n.type!=="oid"&&n.name.toLowerCase()!=="value")).map((n=>{const a=n.clone();return a.name=`${J}${n.name}`,a}))}function fe(e){const n=new Set,a=new Set,r=new Map;return e.variables.forEach((({dimensions:i})=>{i.forEach((t=>{if(t.recurring)r.set(t.name,t.unit);else{const s=t.unit?.trim()==="ISO8601"?n:a;s.add(t.name),t.hasRanges&&s.add(`${t.name}${M}`)}}))})),[D(w.variable,"Variable"),...[...n].map((i=>Q(`${b}${i}`,A(i)))),...[...a].map((i=>S(`${b}${i}`,A(i)))),...[...r].map((([i,t])=>S(`${b}${i}`,_(i,t))))]}function _(e,n){return n=n?.toLowerCase(),n&&I.has(n)?I.get(n):A(e)}function A(e){const n=e.endsWith(M),a=n?e.slice(0,-4):e,r=a==="StdTime"?"Standard Time":a==="StdZ"?"Standard Z":a;return n?`${r} Max`:r}function T(e,n){return n?new Date(e):e}function de(e,n,a){a?.length&&(n[w.variable]=a[0].variableName,a.forEach((({dimensionName:r,values:i})=>{if(r&&i?.length){const t=`${b}${r}`,s=e.find((({name:o})=>o===t));if(!s)return;const l=s.type==="date",u=i[0];if(Array.isArray(u)){if(n[`${b}${r}`]=T(u[0],l),u[1]!=null){const o=`${b}${r}${M}`;if(e.some((({name:m})=>m===o))){const m=T(u[1],l);n[o]=m}}}else n[`${b}${r}`]=T(u,l)}})))}function he(e,n){if(n.pixelType.startsWith("f")&&e.forEach((({format:a,fieldName:r})=>{a&&r&&/^raster\.(item|service)pixelvalue/i.test(r)&&(a.places=2)})),n.multidimensionalInfo){const a=n.multidimensionalInfo.variables.flatMap((({dimensions:r})=>r));e.forEach((({format:r,fieldName:i})=>{if(r&&i?.startsWith(b)){const t=i.slice(b.length),s=`${t}${M}`;a.find((({name:u})=>u===t||u===s))?.values?.every((u=>Number.isInteger(u)))&&(r.places=0)}}))}}function V(e,n,a){const r=n.shift();if(a.length===0){const t=[];a.push({sliceId:-1,multidimensionalDefinition:t})}const i=a.length;for(let t=0;t<i;t++){const s=a.shift().multidimensionalDefinition;r.values?.forEach((l=>{a.push({sliceId:-1,multidimensionalDefinition:[...s,{variableName:e,dimensionName:r.name,values:[l]}]})}))}n.length&&V(e,n,a)}function ve(e,n){const a=[];let r=0;return(n?e.variables.filter((i=>i.name.toLowerCase()===n.toLowerCase())):[...e.variables].sort(((i,t)=>i.name>t.name?1:-1))).forEach((i=>{const t=[],s=[...i.dimensions].sort(((l,u)=>l.name>u.name?-1:1));V(i.name,s,t),t.forEach((l=>{a.push({...l,sliceId:r++})}))})),a}function ge(e,n,a){let r=e;if(n&&(n=[...n].sort(((i,t)=>i.dimensionName<t.dimensionName?-1:1))).forEach((({dimensionName:i,values:t,isSlice:s})=>{t.length&&(r=r.filter((l=>{const u=l.multidimensionalDefinition.find((m=>m.dimensionName===i));if(u==null)return!1;const o=u.values[0];return typeof o=="number"?typeof t[0]=="number"?t.includes(o):t.some((m=>m[0]<=o&&m[1]>=o)):typeof t[0]=="number"?t.some((m=>o[0]<=m&&o[1]>=m)):s?t.some((m=>m[0]===o[0]&&m[0]===o[1])):t.some((m=>m[0]>=o[0]&&m[0]<=o[1]||m[1]>=o[0]&&m[1]<=o[1]||m[0]<o[0]&&m[1]>o[1]))})))})),r.length&&a?.start!=null&&a.end!=null){const i=a.start.getTime(),t=a.end.getTime(),s=r[0].multidimensionalDefinition.findIndex((l=>l.dimensionName==="StdTime"));s>-1&&(r=r.filter((l=>{const u=l.multidimensionalDefinition[s].values[0];return i<=u&&t>=u})))}return r.map((i=>i.sliceId))}function Y(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function G(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function E(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function P(e,n,a){if(!n?.subsetDefinitions?.length)return e;let r;if(a){const{variables:s}=n;if(s.length&&!s.includes(a))return null;const l=n.subsetDefinitions.find((u=>u.dimensionName===e.name&&u.variableName===a));if(!l?.values?.length)return e;r=E(l.values)}else r=n.dimensions.find((({name:l})=>l===e.name))?.extent;const i=r;if(!i?.length)return e;const t=e.values.filter((s=>Y(s,i)));return{...e,extent:[...i],values:t}}function k(e,n,a){if(!n?.subsetDefinitions?.length)return!1;const{variables:r}=n;if(r.length&&e.some((({variableName:i})=>i&&!r.includes(i))))return!0;for(let i=0;i<e.length;i++){const t=e[i],s=n.subsetDefinitions.find((l=>(t.variableName===""||l.variableName===t.variableName)&&l.dimensionName===t.dimensionName));if(s?.values.length){const l=E(s.values);if(!t.isSlice&&t.values.length===2&&!Array.isArray(t.values[0])&&t.values[0]!==t.values[1]&&a){if(!G(t.values,l))return!0}else if(t.values.some((u=>!Y(u,l))))return!0}}return!1}function be(e,n){if(e==null)return{isOutside:!1};const{geometry:a,timeExtent:r,multidimensionalDefinition:i}=n;let t=null;if(r!=null&&(t=H(e,r),t==null))return{isOutside:!0};const{areaOfInterest:s}=e;if(s&&a){const l=a.type==="point"?a:a.type==="extent"?a.center:a.type==="polygon"?a.centroid:null;if(l&&!s.contains(l))return{isOutside:!0}}return i!=null&&i.length&&k(i,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:a,timeExtent:t,multidimensionalDefinition:i}}}function H(e,n){const a=e.dimensions.find((({name:s})=>s==="StdTime"));if(a==null||n.start==null&&n.end==null)return n;n=n.clone();const{start:r,end:i}=n.toJSON(),t=r===i?[r]:r!=null&&i!=null?[r,i]:[r??i];return t.length===2&&a?.extent.length&&(t[0]=Math.max(t[0],a.extent[0]),t[1]=Math.min(t[1],a.extent[1]??a.extent[0]),t[1]<t[0])||k([new g({variableName:"",dimensionName:"StdTime",isSlice:t.length===1,values:t})],e,!0)?null:(n.start=new Date(t[0]),n.end=new Date(t[1]??t[0]),n)}function ye(e){const{rasterInfo:n,multidimensionalSubset:a}=e,{multidimensionalInfo:r}=n;if(r==null)return null;let i=e.multidimensionalDefinition?.length?e.multidimensionalDefinition:F(n,{multidimensionalSubset:a});if(!i?.length)return null;if(i.some((s=>!s.dimensionName))){const{variableName:s}=i[0],l=F(n,{multidimensionalSubset:a,variableName:s});l?.forEach((u=>{const o=i?.find((({dimensionName:m})=>m===u.dimensionName));o?.values?.length&&(u.values=o.values,u.isSlice=o.isSlice)})),i=l}const{timeExtent:t}=e;if(i!=null&&t!=null&&(t.start!=null||t.end!=null)){i=i.map((h=>h.clone()));const s=r.variables.find((({name:h})=>h===i[0].variableName))?.dimensions?.find((({name:h})=>h==="StdTime")),l=i.find((({dimensionName:h})=>h==="StdTime"));if(!s||!l)return null;const{start:u,end:o}=t,m=u==null?null:u.getTime(),v=o==null?null:o.getTime(),c=m??v,d=v??m;if(s.values!=null){const h=s.values.filter((f=>{if(Array.isArray(f)){if(c===d)return f[0]<=c&&f[1]>=c;const y=f[0]<=c&&f[1]>c||f[0]<d&&f[1]>=d,p=f[0]>=c&&f[1]<=d||f[0]<c&&f[1]>d;return y||p}return c===d?f===c:f>=c&&f<=d}));if(h.length){const f=h.sort(((y,p)=>{const O=Array.isArray(y)?y[0]:y,L=Array.isArray(y)?y[1]:y,j=Array.isArray(p)?p[0]:p,W=Array.isArray(p)?p[1]:p;return c===d?O-j:Math.abs(L-d)-Math.abs(W-d)}))[0];l.values=[f]}else i=null}else if(s.hasRegularIntervals&&s.extent){const[h,f]=s.extent;c>f||d<h?i=null:l.values=c===d?[c]:[Math.max(h,c),Math.min(f,d)]}}return i!=null&&k(i,a)?null:i}function K(e,n={}){const{multidimensionalInfo:a,keyProperties:r}=e;if(a==null)return null;const{variableName:i,multidimensionalSubset:t,multidimensionalDefinition:s}=n,l=s!=null?s[0]?.variableName:null,u=i||l||r?.DefaultVariable;let{variables:o}=a;return t?.variables?.length&&(o=o.filter((({name:m})=>t.variables.includes(m)))),u?o.find((({name:m})=>m===u))??o[0]:o[0]}function F(e,n={}){const a=K(e,n);if(!a)return null;const r=[],{dimensions:i,name:t}=a;if(i.length===0)return[new g({variableName:t,dimensionName:"",values:[],isSlice:!0})];for(let s=0;s<i.length;s++){const l=P(i[s],n.multidimensionalSubset,t);if(!l)return null;const{values:u,extent:o}=l;let m=u?.[0]??o?.[0];l.name.toLowerCase()==="stdz"&&!l.hasRanges&&o&&Math.abs(o[1])<=Math.abs(o[0])&&(m=u?.length?u[u.length-1]:o[1]),r.push(new g({variableName:t,dimensionName:l.name,values:[m],isSlice:!n.useRangeForRangedDimensionInfo||!!l.hasRanges}))}return r}function pe(e){return!!e?.length&&e.some((n=>{if(n.values==null)return!0;const a=n.values.length;return a===0||a>1||!n.isSlice&&Array.isArray(n.values[0])}))}function we(e,n){if(n==null||e==null)return null;let a=n.variables.map((r=>({...r})));return e?.variables?.length&&(a=a.filter((({name:r})=>e.variables.includes(r))),a.forEach((r=>{r.dimensions=r.dimensions.map((i=>P(i,e,r.name))).filter(Z)}))),a}function X(e,n){const{values:a}=n;if(a?.length){const l=Array.isArray(a[0]),u=Array.isArray(e);return l!==u?-1:l&&u?a.findIndex((o=>o[0]===e[0]&&o[1]===e[1])):a.indexOf(e)}const{extent:r}=n;if(Array.isArray(e)||!r||e<r[0]||e>r[1])return-1;const i=n.interval||1;if(n.unit!=="ISO8601")return Math.round((e-r[0])/i);const t=r[0];let s=-1;switch(n.intervalUnit?.toLowerCase()||"days"){case"seconds":s=Math.round((e-t)/1e3/i);break;case"minutes":s=Math.round((e-t)/6e4/i);break;case"hours":s=Math.round((e-t)/36e5/i);break;case"days":s=Math.round((e-t)/864e5/i);break;case"months":{const l=new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear(),u=new Date(t).getUTCMonth(),o=new Date(e).getUTCMonth();s=l===0?o-u:o+11-u+12*(l-1)}break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear())/i);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear())/10/i)}return s}function R(e){let n=e.values?.length;if(n)return n;const{extent:a,unit:r}=e,i=e.interval||1,t=a?a[1]-a[0]:0;if(r!=="ISO8601")return Math.round(t/i);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":n=Math.round(t/1e3/i);break;case"minutes":n=Math.round(t/6e4/i);break;case"hours":n=Math.round(t/36e5/i);break;case"days":n=Math.round(t/864e5/i);break;case"months":if(a){const s=new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear(),l=new Date(a[0]).getUTCMonth(),u=new Date(a[1]).getUTCMonth();n=s===0?u-l+1:u+11-l+12*(s-1)+1}else n=0;break;case"years":n=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/i):0;break;case"decades":n=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/10/i):0;break;default:n=0}return n}function $e(e){if(e.extent?.length!==2||!e.interval)return[];const{extent:[n,a],interval:r}=e;if(e.unit==="ISO8601"){const t=e.intervalUnit?.toLowerCase()??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(t)?ee(n,a,r,t):[]}const i=Math.round((a-n)/r);return Array.from({length:i},((t,s)=>s===i-1?a:n+s*r))}function ee(e,n,a,r){const i=[];let t=e;const s=new Date(e);for(;t<=n;)switch(i.push(t),r){case"decades":s.setUTCFullYear(s.getUTCFullYear()+10*a),t=s.getTime();break;case"years":s.setUTCFullYear(s.getUTCFullYear()+a),t=s.getTime();break;case"months":s.setUTCMonth(s.getUTCMonth()+a),t=s.getTime();break;case"days":t+=864e5*a;break;case"hours":t+=36e5*a;break;case"minutes":t+=6e4*a;break;case"seconds":t+=1e3*a}return i.length===1?i[1]=n:i[i.length-1]=n,i}function Ne(e,n){let a=0;const r=e[0].variableName,i=[...n.variables].sort(((t,s)=>t.name>s.name?1:-1));for(let t=0;t<i.length;t++){const s=i[t],l=[...s.dimensions].sort(((m,v)=>m.name>v.name?-1:1));if(s.name!==r){a+=l.map((m=>R(m))).reduce(((m,v)=>m*v));continue}const u=l.map((m=>R(m))),o=l.length;for(let m=0;m<o;m++){const v=e.find((d=>d.dimensionName===l[m].name));if(v==null)return null;const c=X(v.values[0],l[m]);if(c===-1)return null;u.shift(),a+=m===o-1?c:c*u.reduce(((d,h)=>d*h))}break}return a}function De(e){return Math.round(24*(e-25569)*3600*1e3)}function ne(e){return e?.datasetFormat==="Function"}function xe(e){return ne(e)?e.primaryRasters.rasters:[e]}export{me as $,$e as D,Ne as N,de as V,ge as a,fe as b,se as c,K as d,ce as e,ye as f,pe as g,F as h,ve as i,oe as j,w as k,he as l,le as m,ue as n,re as o,g as p,be as q,ne as r,J as s,xe as t,b as u,we as v,De as w,k as x};
