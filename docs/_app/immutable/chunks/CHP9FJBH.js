const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DRxHIksu.js","./DCkdB7M8.js"])))=>i.map(i=>d[i]);
import{H as it,n as dt}from"./DedWa6hQ.js";import{s as G,i as nt}from"./BYatcg2i.js";import{f as P,i as at,b as ct,r as m,m as h,a as Ee,l as yt}from"./DvUDi2Se.js";import"./BVStbsji.js";import{a as A}from"./CnfuZz2S.js";import"./D6KPPgz5.js";import{f as ot,U as z,z as pe,_ as mt}from"./Bs5I5-7o.js";import{P as st,y as ht}from"./BDErjlP0.js";import{e as ft}from"./D_qA3yb9.js";import{i as _e,r as gt,a as Ne,b as J,l as bt}from"./Gj-X15q-.js";import{a as Tt}from"./DSvukMJ1.js";import{A as Me,y as wt,I as It}from"./BTFaZ95N.js";import{Q as ge,O as le}from"./elf00Mmu.js";import{I as ue,t as de,_ as F,E as ne,S as $e,o as be}from"./B4mRqufT.js";import{f as Et}from"./Ct-FuPNe.js";import{u as _t}from"./B_3Dpwt9.js";import{s as Se}from"./3PNoDE1S.js";import"./WcbF0m06.js";import"./CLP4QvbA.js";import{_ as Nt}from"./PPVm8Dsz.js";import{s as Q}from"./CMG93765.js";import{n as $t}from"./DwIAbcbk.js";import"./Bunn428X.js";import{g as ae}from"./muspHcCn.js";import{R as Y}from"./Cv9IkvcT.js";import{q as Lt}from"./D2fJSBL9.js";import{S as Mt}from"./B7VbszFd.js";import{E as St}from"./B9TnOdWG.js";import{r as vt}from"./Bx7Drccn.js";import{y as te}from"./BmZQD3Tc.js";import{h as Dt}from"./C2A-cDAk.js";import{f as Rt}from"./BohJ_yzu.js";import{L as Ct}from"./WP68i4Ay.js";import{y as kt,u as ve}from"./CtRXuqJg.js";import{s as At}from"./BTdrrTIi.js";import{l as De}from"./CdZ5E7Js.js";import{A as K,e as oe,l as xt}from"./ZfJYk1lX.js";import{p as Ot,n as Ft,l as jt}from"./BpCBUT2X.js";import{a as qt,p as Pt,l as Gt}from"./B0YVZ3UN.js";import{c as Ut,p as Ht}from"./K4FY9oqR.js";import{d as zt,p as Bt}from"./hpPpwecu.js";import{p as Qt,c as Vt}from"./CwFyj4KC.js";import{f as Wt}from"./Cn-KJRkU.js";import{t as Jt}from"./VEGSGQ51.js";import{c as Yt,f as Zt}from"./CeqSKNOq.js";import{d as Kt,v as Xt,j as er,w as tr,l as rr}from"./BwvlIeVB.js";import{m as se}from"./D26fh4vX.js";import{u as ir}from"./C-gotZDZ.js";import{m as nr}from"./CzgEe7_M.js";import{t as Re}from"./C03-sIHu.js";import{m as ar}from"./DBzD8FIy.js";import{g as or}from"./DWtdFFwQ.js";import{p as sr}from"./DyEdvwqw.js";import{L as Ce}from"./Cw4sh3xC.js";let lr=class{constructor(){this.version="",this.queryResult=new pr}},pr=class{constructor(){this.featureResult=new ur}},ur=class{constructor(){this.objectIdFieldName="",this.uniqueIdField=new dr,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new cr,this.geometryType=null,this.spatialReference=new ot,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new lt,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}},dr=class{constructor(){this.name="",this.isSystemMaintained=!1}},cr=class{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}},lt=class{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new yr,this.translate=new mr}};class yr{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}}let mr=class{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}},hr=class{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}},fr=class{constructor(){this.attributes=[],this.compressedGeometry=new Te,this.centroid=new Te,this.aggregateGeometries=[]}},Te=class{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}};var X;(function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"})(X||(X={}));const gr=[X.ELEMENTUID,X.TYPENAME];var ke,Ae;(function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"})(ke||(ke={})),(function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"})(Ae||(Ae={}));var xe,we,Ie,Z;(function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"})(xe||(xe={})),(function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"})(we||(we={})),(function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"})(Ie||(Ie={})),(function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"})(Z||(Z={}));function br(e){const t=new lr;t.version=e.version;const i=e.get_query_result();if(i.results_type.value!==0)throw new Error("Got a non-feature collection type");const r=i.get_feature_result(),n=t.queryResult.featureResult;n.objectIdFieldName=r.objectid_field_name,n.exceededTransferLimit=r.exceeded_transfer_limit,n.hasM=r.has_m,n.hasZ=r.has_z,n.geometryType=_e[r.geometry_type.value],n.globalIdFieldName=r.globalid_field_name,n.geohashFieldName=r.geohash_field_name;const a=n.uniqueIdField,p=r.unique_id_field;a.name=p.name,a.isSystemMaintained=p.isSystemMaintained;const s=n.geometryProperties,y=r.geometry_properties;s.shapeAreaFieldName=y.shapeAreaFieldName,s.shapeLengthFieldName=y.shapeLengthFieldName,s.units=y.units;const o=n.spatialReference,l=r.spatial_reference;o.wkid=l.wkid,o.latestWkid=l.latestWkid,o.vcsWkid=l.vcsWkid,o.latestVcsWkid=l.latestVcsWkid,o.wkt=l.wkt,n.transform=wr(r.transform);const d=n.fields,u=n.fieldNameToAttributeIndexMap,c=r.fields,f=c.size();for(let T=0;T<f;T++){const M=c.get(T),v=pt(M);d.push(v),u[v.name]=T,M.delete()}c.delete();const b=n.values,L=r.values_count();for(let T=0;T<L;T++)b.push(r.get_value_at(T));const $=n.features,N=r.features,_=N.size();if(_>0){for(const T of gr)if(u[T]===void 0)throw new Error(`Feature collection missing required attribute: ${T}`)}for(let T=0;T<_;T++){const M=new fr,v=N.get(T),j=M.attributes,q=v.attributes_count();for(let D=0;D<q;D++)j.push(v.get_attribute_at(D));const C=v.get_compressed_geometry();C&&(M.compressedGeometry=me(C),M.centroid=me(v.get_centroid()));const k=M.aggregateGeometries,R=v.aggregate_geometries,H=R.size();for(let D=0;D<H;D++){const W=R.get(D),ee=me(W);k.push(ee),W.delete()}R.delete(),$.push(M),v.delete()}N.delete();const S=n.geometryFields,I=r.geometry_fields,g=I.size();for(let T=0;T<g;T++){const M=I.get(T),v=Tr(M);S.push(v),M.delete()}return I.delete(),t}function me(e){const t=new Te;t.geometryType=_e[e.geometry_type.value];const i=[],r=[];for(let n=0;n<e.lengths.length;n++)i.push(e.lengths[n]);for(let n=0;n<e.coords.length;n++)r.push(e.coords[n]);return t.lengths=i,t.coords=r,t}function pt(e){const t=new hr;return t.name=e.name,t.alias=e.alias,t.fieldType=gt[e.field_type.value],t.sqlType=Ie[e.sql_type.value],t.domain=e.domain,t.defaultValue=e.default_value,t}function Tr(e){const t=pt(e);return t.geometryType=_e[e.geometry_type.value],t}function wr(e){const t=new lt;t.quantizeOriginPosition=we[e.quantizeOriginPosition.value];const i=t.scale,r=e.scale;i.xScale=r.xScale,i.yScale=r.yScale,i.mScale=r.mScale,i.zScale=r.zScale;const n=t.translate,a=e.translate;return n.xTranslate=a.xTranslate,n.yTranslate=a.yTranslate,n.mTranslate=a.mTranslate,n.zTranslate=a.zTranslate,t}async function Ir(e){const t=[],i={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(Oe(e.entitiesUrl).then((r=>{Fe(r,i)}))),e.relationshipsUrl&&t.push(Oe(e.relationshipsUrl).then((r=>{Fe(r,i)}))),await Promise.all(t),i}async function Ki(e,t){t??=!1;const i={generateAllSublayers:t,namedTypeDefinitions:new Map};return await Nr(e).then((r=>{Lr(r,i)})),i}async function Xi(e){const t=await Ne(),i=new t.MapOfObjectIdentifierSets;Er(i,t,e);const r=new t.MapOfObjectIdentifierSetsEncoder;try{r.set_map_of_identifier_sets(i),r.encode();const n=r.get_encoding_result();if(n.error.error_code!==0)throw new G("knowledge-graph:layer-support-utils",n.error.error_message);const a=structuredClone(n.get_byte_buffer());return r.delete(),a}finally{i.delete()}}function Er(e,t,i){for(const[r,n]of i.namedTypeDefinitions){if(!n.members||n.useAllData)continue;const a=n.members.keys();let p=!1,s=!0;const y=new t.ObjectIdArray,o=new t.StringArray,l=new t.GlobalIdArray,d=new t.IdentifierArray,u=new t.ObjectIdentifierSet;for(const c of a)s&&(p=!isNaN(Number(c)),s=!1),p?y.add_objectid(Number(c)):(o.add_string(c),l.add_globalid(c)),d.add_identifier(c);u.set_oid_array(y),u.set_string_array(o),u.set_globalid_array(l),u.set_identifier_array(d),y.delete(),o.delete(),l.delete(),d.delete(),e.put_identifier_set(r,u),u.delete()}return e}async function Oe(e){const t=await it(e,{responseType:"array-buffer"});return _r(await t.data)}async function _r(e){const t=new(await Ne()).FeatureCollectionDecoder,i=t.decode(new Uint8Array(e));if(i.error_code!==0)throw new G("knowledge-graph:layer-support-utils",i.error_message);const r=t.get_feature_collection(),n=br(r);return t.delete(),n}async function Nr(e){const t=await it(e,{responseType:"array-buffer"}),i=await t.data;return $r(new Uint8Array(i))}async function $r(e){const t=new(await Ne()).MapOfObjectIdentifierSetsDecoder,i=t.decode(new Uint8Array(e)),r=new Map;if(i.error_code!==0)throw new G("knowledge-graph:layer-support-utils",i.error_message);const n=t.get_map_of_identifier_sets(),a=n.keys,p=a.size();for(let s=0;s<p;s++){const y=a.get(s),o=n.query_identifier_set(y),l=[];if(o.id_array_type.value===Z.GLOBALID_ARRAY){const d=o.get_globalid_array(),u=d.count();for(let c=0;c<u;c++)l.push(d.get_globalid_at(c))}else if(o.id_array_type.value===Z.IDENTIFIER_ARRAY){const d=o.get_identifier_array(),u=d.count();for(let c=0;c<u;c++)l.push(d.get_identifier_at(c).toString())}else if(o.id_array_type.value===Z.STRING_ARRAY){const d=o.get_string_array(),u=d.count();for(let c=0;c<u;c++)l.push(d.get_string_at(c))}else{if(o.id_array_type.value!==Z.OID_ARRAY)throw new G("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const d=o.get_oid_array(),u=d.count();for(let c=0;c<u;c++)l.push(d.get_objectid_at(c).toString())}}r.set(y,l)}return t.delete(),r}function Fe(e,t){if(!e?.queryResult?.featureResult)return t;const i=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const r of e.queryResult.featureResult.features){const n=r.attributes[i[X.TYPENAME]],a=P(t.namedTypeDefinitions,n,(()=>({useAllData:!1,members:new Map}))),p=r.attributes[i[X.ELEMENTUID]];if(r.compressedGeometry?.coords?.length>0){let s=r.compressedGeometry.lengths;r.compressedGeometry.geometryType==="esriGeometryPoint"&&(s=[]),a.members.set(p,{id:p,linkChartLocation:new ft(s,r.compressedGeometry.coords)})}else a.members.set(p,{id:p})}return t}function Lr(e,t){for(const[i,r]of e){const n=P(t.namedTypeDefinitions,i,(()=>({useAllData:!1,members:new Map})));for(const a of r)n.members.has(a)||n.members.set(a,{id:a})}return t}const en={fetchAndConvertSerializedLinkChart:e=>Ir(e)};let he=class V{constructor(){this._featureLookup=new Map}static getInstance(){return V.instance||(V.instance=new V),V.instance}static resetInstance(){V.instance&&(V.instance=null)}deleteFromStore(t){t.forEach((i=>{this._featureLookup.delete(i)}))}readFromStoreByList(t){const i=[];return t.forEach((r=>{const n=this.readFromStoreById(r);n&&i.push(n)})),i}readFromStoreById(t){return this._featureLookup.get(t)??null}writeToStore(t,i,r){const n=[];return t.forEach((a=>{if(!a?.id)return;a.properties||(a.properties=[]);let p,s=null;if(r&&a.properties[r]&&(s=_t(a.properties[r])),"originId"in a&&"destinationId"in a&&(a.properties[ue]=a.originId,a.properties[de]=a.destinationId),a.properties[i]=a.id,a.id&&this._featureLookup.has(a.id)&&this._featureLookup.get(a.id).attributes){const y=this._featureLookup.get(a.id),o=JSON.parse(JSON.stringify(Object.assign(y.attributes,a.properties)));r&&a.properties[r]&&(o[r]=Et(a.properties[r])),p=new Se(s?JSON.parse(JSON.stringify(s)):y?.geometry?JSON.parse(JSON.stringify(y.geometry)):null,o,null,a.properties[i])}else p=new Se(s?JSON.parse(JSON.stringify(s)):null,a.properties,null,a.properties[i]);this._featureLookup.set(`${a.typeName?`${a.typeName}__${a.id}`:a.id}`,p),n.push(p)})),n}},fe,E=null;function tn(){return fe||(fe=Nt(()=>import("./DRxHIksu.js"),__vite__mapDeps([0,1]),import.meta.url).then((e=>e.l)).then((({default:e})=>e({locateFile:t=>dt(`esri/libs/linkchartlayout/${t}`)}))).then((e=>{Mr(e)})),fe)}function Mr(e){E=e}var je,U,qe,ce;(function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot",e[e.IsOld=8]="IsOld"})(je||(je={})),(function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.Canceled=2]="Canceled"})(U||(U={})),(function(e){e[e.Regular=0]="Regular",e[e.Curved=1]="Curved",e[e.Recursive=2]="Recursive"})(qe||(qe={})),(function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom"})(ce||(ce={}));const Pe={none:0,"start-only":1,"start-and-end":2};function Sr(e){const t={timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0,...e?.toJSON()??{},eventsTicksVisualization:e?.eventsTicksVisualization??"start-and-end"};return{...t,timeDirection:{value:ce[t.timeDirection]??ce.right},eventsTicksVisualization:{value:Pe[t.eventsTicksVisualization]??Pe["start-and-end"]}}}function B(e,t,i,r,n,a){const p=i.length,s=n.length,y=Float64Array.BYTES_PER_ELEMENT,o=Uint32Array.BYTES_PER_ELEMENT,l=Uint8Array.BYTES_PER_ELEMENT,d=16,u=d+p*(l+2*y)+s*(2*o),c=E._malloc(u);try{const f=c+d-c%d,b=f+p*y,L=b+p*y,$=L+s*o,N=$+s*o,_=()=>[E.HEAPF64.subarray(f>>3,(f>>3)+p),E.HEAPF64.subarray(b>>3,(b>>3)+p),E.HEAPU32.subarray(L>>2,(L>>2)+s),E.HEAPU32.subarray($>>2,($>>2)+s),E.HEAPU8.subarray(N,N+p)],[S,I,g,T,M]=_();S.set(i),I.set(r),g.set(n),T.set(a),M.set(t);const v=e(p,N,f,b,s,L,$);let j=null,q=null;if(v.value===U.Success){const W=E.getLayoutLinksTypes(),ee=E.getLayoutLinksVerticesEndIndices(),ye=E.getLayoutLinksVertices(),Le=E.countLayoutLinksVertices();!s||W&&ee?Le&&!ye?v.value=U.Error:(j={types:new Uint8Array(E.HEAPU8.subarray(W,W+s)),vertexEndIndex:new Uint32Array(E.HEAPU32.subarray(ee>>2,(ee>>2)+s)),vertices:new Float64Array(E.HEAPF64.subarray(ye>>3,(ye>>3)+2*Le))},q=E.getAuxiliaryGraphicElements()):v.value=U.Error}const[C,k,R,H,D]=_();return i.set(C),r.set(k),n.set(R),a.set(H),t.set(D),{status:v.value,links:j,graphics:q}}finally{E._free(c),E.cleanupLayout()}}const Ge=2,Ue=1,He=-1;var ze,Be,Qe,Ve,We,Je,Ye,Ze,Ke;(function(e){function t(){return E.getMinIdealEdgeLength()}function i(r,n,a,p,s,y,o=Ge,l=Ue,d=He){return B(((u,c,f,b,L,$,N)=>E.applyForceDirectedLayout(r,u,c,f,b,L,$,N,o,l,d)),n,a,p,s,y)}e.getMinIdealEdgeLength=t,e.apply=i})(ze||(ze={})),(function(e){function t(i,r,n,a,p,s,y=Ge,o=Ue,l=He){return B(((d,u,c,f,b,L,$)=>E.applyCommunityLayout(i,d,u,c,f,b,L,$,y,o,l)),r,n,a,p,s)}e.apply=t})(Be||(Be={})),(function(e){function t(i,r,n,a,p,s){return B(((y,o,l,d,u,c,f)=>E.applySimpleLayout(i,y,o,l,d,u,c,f)),r,n,a,p,s)}e.apply=t})(Qe||(Qe={})),(function(e){function t(i,r,n,a,p,s){return B(((y,o,l,d,u,c,f)=>E.applyHierarchicalLayout(i,y,o,l,d,u,c,f)),r,n,a,p,s)}e.apply=t})(Ve||(Ve={})),(function(e){function t(i,r,n,a,p,s){return B(((y,o,l,d,u,c,f)=>E.applyRadialTreeLayout(i,y,o,l,d,u,c,f)),r,n,a,p,s)}e.apply=t})(We||(We={})),(function(e){function t(i,r,n,a,p,s){return B(((y,o,l,d,u,c,f)=>E.applySmartTreeLayout(i,y,o,l,d,u,c,f)),r,n,a,p,s)}e.apply=t})(Je||(Je={})),(function(e){function t(i,r,n,a,p,s,y,o,l,d,u,c){return B(((f,b,L,$,N,_,S)=>{if(p.length!==f)return{value:U.Error};if(s.length!==f)return{value:U.Error};if(l.length!==N)return{value:U.Error};if(d.length!==N)return{value:U.Error};const I=Float64Array.BYTES_PER_ELEMENT,g=16,T=E._malloc(g+f*I),M=E._malloc(g+f*I),v=E._malloc(g+N*I),j=E._malloc(g+N*I),q=T+g-T%g,C=M+g-M%g,k=v+g-v%g,R=j+g-j%g;try{return E.HEAPF64.subarray(q>>3,(q>>3)+f).set(p),E.HEAPF64.subarray(C>>3,(C>>3)+f).set(s),E.HEAPF64.subarray(k>>3,(k>>3)+N).set(l),E.HEAPF64.subarray(R>>3,(R>>3)+N).set(d),E.applyChronologicalLayout(i,f,b,L,$,q,C,N,_,S,k,R,u,Sr(c))}finally{E._free(T),E._free(M),E._free(v),E._free(j)}}),r,n,a,y,o)}e.apply=t})(Ye||(Ye={})),(function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"})(Ze||(Ze={})),(function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"})(Ke||(Ke={}));at()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"});at()({absoluteValue:"absolute-value",multiplier:"multiplier"});const vr=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);function Dr(e,t){const i=new Map;if(t.dataModel?.relationshipTypes)for(const r of t.dataModel.relationshipTypes)r.name&&i.set(r.name,[]);for(const r of e)i.has(r.typeName)&&i.get(r.typeName)?.push(r.id);return i}async function rn(e,t,i){const r=[],n=Dr(e,t),a={},p=[];for(const[l,d]of n){if(d.length<1)continue;const u=`${l}_ids`;a[u]=d,p.push(`MATCH (n)-[r:${l}]->(m) WHERE id(r) in $${u} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(p.length===0)return[];const s=p.join(" UNION "),y=new Q({openCypherQuery:s,bindParameters:a}),o=(await J(t,y,i?.requestOptions)).resultRowsStream.getReader();for(;;){const{done:l,value:d}=await o.read();if(l)break;for(const u of d)r.push({id:u[0],typeName:u[1]}),r.push({id:u[2],typeName:u[3]})}return r}const nn=e=>vr.get(e)??"radial-root-centric";function Rr(e){if(!e.spatialReference.isWGS84)throw new G("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map((t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]))}let O=class extends ct{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((i=>{i.name&&(t.set(i.name,"entity"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(i.name),i.properties?.forEach((r=>{r.geometryType&&r.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(i.name,{name:r.name??"",geometryType:r.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((i=>{i.name&&(t.set(i.name,"relationship"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(i.name),i.properties?.forEach((r=>{r.geometryType&&r.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(i.name,{name:r.name??"",geometryType:r.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((i,r)=>{if(t.get(r)==="entity")this.entityTypeNames.add(r);else{if(t.get(r)!=="relationship")return nt.getLogger(this).warn(`A named type, ${r}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(r);this.relationshipTypeNames.add(r)}const n=new Map;i.members?.forEach((a=>{P(this.memberIdTypeLookup,a.id,(()=>new Set)).add(r)})),this.sublayerCaches.set(r,n)}))}addToLayer(e){e.forEach((({typeName:t,id:i})=>{if(!this.inclusionModeDefinition)throw new G("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const r=this.inclusionModeDefinition.namedTypeDefinitions.get(t);r.members||(r.members=new Map),r.members.set(i,{id:i}),P(this.memberIdTypeLookup,i,(()=>new Set)).add(t)}}else{const r=new Map;r.set(i,{id:i}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:r}),P(this.memberIdTypeLookup,i,(()=>new Set)).add(t)}}))}getById(e){return he.getInstance().readFromStoreById(e)}async getData(e,t,i){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let r;if(r=e||new Y({where:"1=1",outFields:["*"]}),t.parentCompositeLayer.type==="link-chart"){const n=t.parentCompositeLayer,a=this._processingCacheUpdatesLookup.get(t.objectType.name??""),p=r.outFields;p&&p.length===1&&p[0]===F&&r.where==="1=1"||await Promise.all(a??[]);const s=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],y=[];return s.forEach((o=>{if(this.relationshipTypeNames.has(t.objectType.name)){o.geometry=n.relationshipLinkChartDiagramLookup.get(o.attributes[t.objectIdField]);const l=this.memberIdTypeLookup.get(o.attributes[ue]),d=this.memberIdTypeLookup.get(o.attributes[de]),u=this._isEndEntitySpatial(l,o,ue),c=this._isEndEntitySpatial(d,o,de);o.attributes[ne]=Number(u&&c)}else{o.geometry=n.entityLinkChartDiagramLookup.get(o.attributes[t.objectIdField]);const l=this.geographicLookup.get(t.objectType.name);l&&o.attributes[l.name]?o.attributes[ne]=1:o.attributes[ne]=0}o.attributes[$e]=o.geometry,y.push(o)})),y}return this.retrieveDataFromService(r,t,i)}async getConnectedRecordIds(e,t,i){const r=[];let n="";const a=this._getNamedTypeIdMapFromNodeIds(e);if(t&&t?.length!==0){for(const l of t)n=n+l+"|";n=n.slice(0,-1)}const p={},s=[];for(const[l,d]of a){const u=`${l}_ids`;p[u]=d,t&&t?.length!==0?s.push(`MATCH (n:${l}) WHERE id(n) IN $${u} WITH n MATCH (n)-[r:${n}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):s.push(`MATCH (n:${l}) WHERE id(n) IN $${u} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!s.length)return r;const y=s.join(" UNION "),o=(await J(this.knowledgeGraph,new Q({openCypherQuery:y,bindParameters:p}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:l,value:d}=await o.read();if(l)break;for(let u=0;u<d.length;u++){const c=d[u];r.push({id:c[0],typeName:c[1]}),r.push({id:c[2],typeName:c[3]})}}return r}async getRelationshipsBetweenNodes(e,t,i){const r=this._getNamedTypeIdMapFromNodeIds(e);if(r.size===0)return[];const n={relationshipExclusionIds:t,possibleConnectionEntityIds:e},a=[];for(const[o,l]of r.entries()){const d=`${o}_ids`;n[d]=l,a.push(`MATCH (n:${o}) WHERE id(n) IN $${d} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const p=a.join(" UNION "),s=[],y=(await J(this.knowledgeGraph,new Q({openCypherQuery:p,bindParameters:n}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:o,value:l}=await y.read();if(o)break;for(let d=0;d<l.length;d++){const u=l[d];s.push({id:u[0],typeName:u[1]})}}return s}async getRelationshipsFromNodes(e,t,i,r){const n=this._getNamedTypeIdMapFromNodeIds(e);if(n.size===0||t.length===0)return[];const a={relationshipExclusionIds:i,possibleConnectionEntityIds:t},p=[];for(const[d,u]of n.entries()){const c=`${d}_ids`;a[c]=u,p.push(`MATCH (n:${d}) WHERE id(n) IN $${c} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const s=p.join(" UNION "),y=new Map,o=(await J(this.knowledgeGraph,new Q({openCypherQuery:s,bindParameters:a}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:d,value:u}=await o.read();if(d)break;for(let c=0;c<u.length;c++){const f=u[c];let b=y.get(f[1]);b||(b=new Set,y.set(f[1],b)),b.add(f[0])}}const l=[];for(const[d,u]of y)for(const c of u)l.push({id:c,typeName:d});return l}async refreshCacheContent(e,t,i,r=!0,n){const a=he.getInstance(),p=[],s=new Map,y=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((o=>{o.name&&y.set(o.name,o)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((o=>{o.name&&y.set(o.name,o)})),e||this.inclusionModeDefinition?e?e.forEach((o=>{if(this.memberIdTypeLookup.has(o))for(const l of this.memberIdTypeLookup.get(o))s.has(l)?s.get(l)?.push(o):s.set(l,[o])})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((o,l)=>{o.useAllData?s.set(l,null):o.members&&o.members.forEach((d=>{s.has(l)&&s.get(l)!==null?s.get(l)?.push(d.id):s.set(l,[d.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((o=>{o.name&&s.set(o.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((o=>{o.name&&s.set(o.name,null)})));for(const[o,l]of s){const d=new Set(l),u=new Promise(((c,f)=>{(async()=>{const L=new Set,$=[];let N,_="",S=!1;if(t||y.get(o)?.properties?.forEach((T=>{T.name&&L.add(T.name)})),i&&this.geographicLookup.has(o)){const T=this.geographicLookup.get(o)?.name;T&&L.add(T)}if(this.entityTypeNames.has(o))_=`MATCH (n:${o}) ${l?"WHERE id(n) IN $ids ":""}return ID(n)`,L.forEach((T=>{_+=`, n.${T}`,$.push(T)}));else{if(!this.relationshipTypeNames.has(o))throw new G("knowledge-graph:layer-data-manager",`The graph type of ${o} could not be determined. Was this type set in the KG data model and inclusion definition?`);S=!0,_=`MATCH ()-[n:${o}]->() ${l?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,L.forEach((T=>{_+=`, n.${T}`,$.push(T)}))}N=new Q(l?{openCypherQuery:_,bindParameters:{ids:l}}:{openCypherQuery:_});const I=(await J(this.knowledgeGraph,N,{signal:n?.signal})).resultRowsStream.getReader();for(;;){const{done:T,value:M}=await I.read();if(T)break;const v=[];for(let C=0;C<M.length;C++){const k=M[C];let R=0,H=0;const D={properties:{}};for(D.id=k[R],R++,H++,S&&(D.originId=k[R],R++,H++,D.destinationId=k[R],R++,H++,P(this.nodeConnectionsLookup,D.originId,(()=>new Set)).add(D.id),P(this.nodeConnectionsLookup,D.destinationId,(()=>new Set)).add(D.id),P(this.relationshipConnectionsLookup,D.id,(()=>[D.originId,D.destinationId])));R<k.length;R++)D.properties[$[R-H]]=k[R];d.delete(D.id),v.push(D)}const j=a.writeToStore(v,F,this.geographicLookup.get(o)?.name);this.sublayerCaches.has(o)||this.sublayerCaches.set(o,new Map),r&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(o)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(o,{useAllData:!1,members:new Map}),r&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(o).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(o).members=new Map);const q=this.sublayerCaches.get(o);j.forEach((C=>{q?.set(C.attributes[F],C),r&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(o).members.has(C.attributes[F])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(o).members.set(C.attributes[F],{id:C.attributes[F]}),P(this.memberIdTypeLookup,C.attributes[F],(()=>new Set)).add(o))}))}const g=this.inclusionModeDefinition?.namedTypeDefinitions.get(o);if(g)for(const T of d)g.members?.delete(T)})().then((()=>{c(null)})).catch((L=>{L.name==="AbortError"?c(null):f(L)}))}));p.push(u),this._processingCacheUpdatesLookup.get(o)?.push(u)}if(await Promise.all(p),n?.signal?.aborted)throw Tt()}removeFromLayer(e){const t=new Set,i=new Set(e.map((r=>r.id)));for(const r of e)t.add(r.typeName),this.memberIdTypeLookup.get(r.id)?.size===1?this.memberIdTypeLookup.delete(r.id):this.memberIdTypeLookup.get(r.id)?.delete(r.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(((n,a)=>{a===r.typeName&&n.members?.has(r.id)&&n.members.delete(r.id)}));t.forEach((r=>{this.sublayerCaches.get(r)?.forEach(((n,a)=>{i.has(a)&&this.sublayerCaches.get(r)?.delete(a)}))}))}async retrieveDataFromService(e,t,i){const r=he.getInstance(),n=new Set,a=[];let p,s="",y=[];const o=t.graphType==="relationship",l=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,d=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let u=!l&&d?Array.from(d).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&e.objectIds!=null&&(u=e.objectIds);else if(e.objectIds!=null&&u&&u.length>0){const f=e.objectIds;e.objectIds=u.filter((b=>f.includes(b)))}else if(e.objectIds!=null)u=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=u}if(e.outFields!=null){const f=e.outFields;f.includes("*")?t.fields.forEach((b=>{n.add(b.name)})):f.forEach((b=>{b!==F&&b!==t.geometryFieldName&&n.add(b)}))}if(e.geometry!=null){const f=e.geometry;let b;const L=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,$=L?.spatialReference,N=L?.serviceCapabilities?.geometryCapabilities;let _=N?.geometryMaxBoundingRectangleSizeX,S=N?.geometryMaxBoundingRectangleSizeY;if(f.type==="point"){let I=f;I.spatialReference?.isWGS84||(await ge(I.spatialReference,z),I=le(I,z)),b=new pe({spatialReference:z,xmin:I.x-1e-4,ymin:I.y-1e-4,xmax:I.x+1e-4,ymax:I.y+1e-4})}else f?.extent?.spatialReference&&!f.spatialReference?.isWGS84?(await ge(f.extent.spatialReference,z),b=le(f.extent,z)):b=f.extent;if(_&&S&&$){if($.wkid!==4326){const I=new pe({spatialReference:$,xmax:_,ymax:S}),g=le(I,z);_=g.xmax,S=g.ymax}if(b.xmax-b.xmin>_)throw new G("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${_}° latitude, limit exceeded`);if(b.ymax-b.ymin>S)throw new G("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${S}° longitude, limit exceeded`)}if(e.where!=null&&e.where!=="1=1"){const I=await Me(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((g=>{I.fieldNames.includes(g.name)&&n.add(g.name)}))}s=o?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&n.add(t.geometryFieldName),n.forEach((I=>{s+=`, n.${I}`,a.push(I)})),p=new Q({openCypherQuery:s,bindParameters:{param_filter_geom:new st({rings:Rr(b)})}})}else{let f="";if(e.where!=null&&e.where!=="1=1"){const $=await Me(e.where,t.fieldsIndex);t.fields.forEach((g=>{$.fieldNames.includes(g.name)&&n.add(g.name)}));const N=new Set(["column-reference","string","number","binary-expression"]),_=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let S=!1;const I=g=>{if(g.type==="column-reference")return`n.${g.column}`;if(g.type==="string")return`'${g.value}'`;if(g.type==="number")return`${g.value}`;if(g.type==="binary-expression"&&N.has(g.left.type)&&N.has(g.right.type)&&_.has(g.operator))return`${I(g.left)} ${g.operator} ${I(g.right)}`;if(g.type==="binary-expression"&&g.operator==="LIKE"){let T="";if(g.left.type==="function"&&g.left.args.value[0].type==="column-reference")T+=`lower(n.${g.left.args.value[0].column})`;else{if(g.left.type!=="column-reference")return S=!0,"";T+=`lower(n.${g.left.column})`}if(T+=" CONTAINS (",g.right.type!=="string")return S=!0,"";{let M=g.right.value;M.charAt(0)==="%"&&(M=M.slice(1)),M.charAt(M.length-1)==="%"&&(M=M.slice(0,-1)),T+=`'${M.toLowerCase()}')`}return T}return S=!0,""};f=I($.parseTree),S&&(f="")}let b="";b=o?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let L=!1;u&&(L=!0,b+=" WHERE ID(n) IN $ids"),f&&(b+=L?" AND":" WHERE",b+=` ${f}`),b+=" return ID(n)",o&&(b+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&n.add(t.geometryFieldName),n.forEach(($=>{b+=`, n.${$}`,a.push($)})),p=new Q(u?{openCypherQuery:b,bindParameters:{ids:u}}:{openCypherQuery:b})}const c=(await J(t.parentCompositeLayer.dataManager.knowledgeGraph,p,i)).resultRowsStream.getReader();for(;;){const{done:f,value:b}=await c.read();if(f)break;const L=[];for(let $=0;$<b.length;$++){const N=b[$];let _=0,S=0;const I={properties:{}};for(I.id=N[_],_++,S++,o&&(I.originId=N[_],_++,S++,I.destinationId=N[_],_++,S++);_<N.length;_++)I.properties[a[_-S]]=N[_];L.push(I)}y=y.concat(r.writeToStore(L,F,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return y}_isEndEntitySpatial(e,t,i){for(const r of e??[])if(this.entityTypeNames.has(r)){const n=this.geographicLookup.get(r),a=n&&this.sublayerCaches.get(r)?.get(t.attributes[i]);if(n&&a?.attributes[n.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const t=new Map;return e.forEach((i=>{if(this.memberIdTypeLookup.has(i))for(const r of this.memberIdTypeLookup.get(i)){if(!this.entityTypeNames.has(r))return;t.has(r)?t.get(r)?.push(i):t.set(r,[i])}})),t}};m([h()],O.prototype,"knowledgeGraph",void 0),m([h()],O.prototype,"inclusionModeDefinition",void 0),m([h()],O.prototype,"entityTypeNames",void 0),m([h()],O.prototype,"relationshipTypeNames",void 0),m([h()],O.prototype,"geographicLookup",void 0),m([h()],O.prototype,"sublayerCaches",void 0),m([h()],O.prototype,"nodeConnectionsLookup",void 0),m([h()],O.prototype,"relationshipConnectionsLookup",void 0),m([h()],O.prototype,"memberIdTypeLookup",void 0),O=m([Ee("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],O);const Xe=At(),Cr=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return m([h(Xe.fields)],t.prototype,"fields",void 0),m([h(Xe.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=m([Ee("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t},kr={initializeLayersFromClientData:async(e,t,i)=>{if(t||(t=[...e.layers,...e.tables].map((a=>a.graphTypeName))),t?.length===0)return;const r=new Map;for(const a of t)r.set(a,et(e,a));const n=await bt(e.dataManager.knowledgeGraph,Array.from(r.values()),{requestOptions:{signal:i?.signal}});for(const a of[...e.layers,...e.tables]){const p=a.objectType.name;if(p==null)continue;const s=n.get(et(e,p));if(s){const y=JSON.parse(s);y===null||typeof y!="object"||y.hasOwnProperty("showLabels")||(y.showLabels=!1),a.read(y,{origin:"service"})}}}},et=(e,t)=>e.type==="knowledge-graph"?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function an(e,t,i){return kr.initializeLayersFromClientData(e,t,i)}const tt=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],Ar="#8f8f82";function xr(e){return e<0||e>=tt.length?new De(Ar):new De(tt[e])}function Or(e){const t=e.toArray();return new $t({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function Fr(e){let t="ESRI__ID",i=4;for(const r of e)if(r.name){if(r.name.toLowerCase()==="name"){t=r.name;break}r.name.toLowerCase().includes("name")?(t=r.name,i=2):r.fieldType==="esriFieldTypeString"&&i>3&&(t=r.name,i=3)}return t}function jr(e,t,i){const r={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},n=new K({labelExpressionInfo:new oe({expression:i==="ESRI__ID"?`${t}`:`$feature.${i}`}),labelPlacement:"above-center",symbol:new ae(r)}),a=new K({labelExpressionInfo:new oe({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new ae({...r,yoffset:"12px"})});return e==="entity"?[n]:[a]}function qr(e,t,i){const r={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},n=i==="ESRI__ID"?`${e}`:`$feature.${i}`;return t==="point"?[new K({labelExpressionInfo:new oe({expression:n}),labelPlacement:"above-center",symbol:new ae(r)})]:t==="polyline"?[new K({labelExpressionInfo:new oe({expression:n}),labelPlacement:"center-along",repeatLabel:!0,symbol:new ae(r)})]:t==="polygon"?[new K({labelExpressionInfo:new oe({expression:n}),labelPlacement:"always-horizontal",symbol:new ae(r)})]:null}function x(e){if(!e.json)return e;e.json.write=rt(e.json.write);const t=e.json.origins;if(!t)return e;let i;for(i in t){const r=t[i];r&&(r.write=rt(r.write))}return e}function rt(e){return typeof e=="object"&&e?(e.enabled!==!1&&(e.overridePolicy=Pr(e)),e):e===!0?re():e}function Pr(e){const{target:t,writer:i,overridePolicy:r,...n}=e;return function(a,p){const s=ut.call(this,a,p);return s.enabled?{...n,...s}:s}}function re(){return{overridePolicy:ut}}function ut(e,t){const i=!!this.geometryType;let r={enabled:i};return i&&(r={...r,...ie.call(this,e,t)}),r}function ie(e,t){return{ignoreOrigin:this.originIdOf(t)>yt.DEFAULTS}}let w=class extends Cr(qt(zt(Ut(Ot(Qt(Yt(Jt(Wt(Mt(Dt)))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=kt(!1,!0),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=F,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then((()=>{const t=new MessageChannel;return new St(t.port1,{channel:t,client:{queryFeatures:(i,r={})=>{const n=Y.fromJSON(i);return this.queryFeaturesJSON(n,r)}}}),[t.port2]}))},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){const e=[];return this.objectType?.properties?.forEach((t=>{const i=t.fieldType==="esriFieldTypeOID"?"esriFieldTypeInteger":t.fieldType;e.push(se.fromJSON({name:t.name,type:i,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))})),e.push(se.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),se.fromJSON({name:be,type:"esriFieldTypeInteger",alias:be,editable:!1}),se.fromJSON({name:ne,type:"esriFieldTypeInteger",alias:ne,editable:!1})),e}get geometryType(){if(this.parentCompositeLayer?.type==="link-chart")return this.graphType==="relationship"?"polyline":"point";const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&t!=="esriGeometryNull"?te.fromJSON(t):null}get geometryFieldName(){return this.parentCompositeLayer?.type==="link-chart"?$e:this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name)?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasM??!1}get hasZ(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");if(!this.objectType||!this.parentCompositeLayer||!this.graphTypeName)return null;const e=this.objectType.properties?Fr(this.objectType.properties):"ESRI__ID";return this.parentCompositeLayer.type==="link-chart"?jr(this.graphType,this.graphTypeName,e):qr(this.graphTypeName,this.geometryType,e)}set renderer(e){wt(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");const e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map((n=>n.name)).indexOf(this.graphTypeName),i=xr(t);if(this.parentCompositeLayer?.type==="link-chart"){if(this.graphType==="relationship")return new nr({type:"simple",symbol:Or(i)});const n=Re(ve(te.toJSON("point")).renderer);return Ce(n.symbol,i),n}const r=Re(ve(te.toJSON(this.geometryType)).renderer);return Ce(r.symbol,i),r}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??ot.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return sr(this,e)}createQuery(){return new Y({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();const{resolvedQuery:i,queryEngine:r}=await this._setupQueryObjects(e),n=or.fromJSON(await r.executeQuery(i.toJSON(),t?.signal));return n.features.forEach((a=>{a.sourceLayer=this})),n}async queryFeaturesJSON(e,t){await this.load();const{resolvedQuery:i,queryEngine:r}=await this._setupQueryObjects(e);return await r.executeQuery(i.toJSON(),t?.signal)}async queryFeatureCount(e,t){await this.load();const{resolvedQuery:i,queryEngine:r}=await this._setupQueryObjects(e);return r.executeQueryForCount(i.toJSON(),t?.signal)}async queryExtent(e={},t){await this.load();const i={...e,returnGeometry:!0},{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(i),a=await n.executeQueryForExtent(r.toJSON(),t?.signal);let p;return p=a.extent?.xmin!=null&&a.extent?.xmax!=null&&a.extent?.ymin!=null&&a.extent?.ymax!=null?new pe(a.extent):new pe,{count:a.count,extent:p}}async queryObjectIds(e,t){await this.load();const i=Y.from(e);let r;if(this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{const n=await this.parentCompositeLayer.dataManager.getData(i,this,t);r=this.loadQueryEngine(n)}return await r.executeQueryForIds(i.toJSON(),t?.signal)}loadQueryEngine(e){const t=new Rt({geometryType:te.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),i=new Ct({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:te.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,featureIdInfo:{type:"object-id",fieldName:this.objectIdField},spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return i.featureStore.addMany(e),i}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new Y({where:"1=1",outFields:[F]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then((()=>It(this.timeInfo,this.fieldsIndex)))),Promise.resolve(this)}async _setupQueryObjects(e,t){const i=Y.from(e),r=i.geometry;if(r&&!r.spatialReference?.isWGS84&&(await ge(r.spatialReference,z),i.geometry=le(r instanceof st||r instanceof ht||r instanceof mt?r:r.extent,z)),this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)return{resolvedQuery:i,queryEngine:this._cachedQueryEngine};const n=await this.parentCompositeLayer.dataManager.getData(i,this,t);return{resolvedQuery:i,queryEngine:this.loadQueryEngine(n)}}};function Gr(e,t,i){const r=[["ESRI__AGGREGATION_COUNT",be],["ESRI__ORIGIN_ID",ue],["ESRI__DESTINATION_ID",de],["ESRI__LAYOUT_GEOMETRY",$e]];try{for(const n of e)for(const[a,p]of r)n.labelExpression=n.labelExpression?.replaceAll(a,p),n.labelExpressionInfo?.expression&&(n.labelExpressionInfo.expression=n.labelExpressionInfo.expression.replaceAll(a,p))}catch(n){nt.getLogger(this).warn("Error updating labelingInfo",n)}return xt(e,t,i)}m([h(x(A(Ft)))],w.prototype,"blendMode",void 0),m([h()],w.prototype,"capabilities",void 0),m([h({readOnly:!0})],w.prototype,"userHasUpdateItemPrivileges",null),m([h({json:{origins:{"web-scene":{write:!1}},write:re()}})],w.prototype,"charts",void 0),m([h({readOnly:!0})],w.prototype,"defaultPopupTemplate",null),m([h({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],w.prototype,"definitionExpression",void 0),m([h()],w.prototype,"displayField",void 0),m([h(x(A(Pt)))],w.prototype,"displayFilterEnabled",void 0),m([h(x(A(Gt)))],w.prototype,"displayFilterInfo",void 0),m([h(x(A(jt)))],w.prototype,"effect",void 0),m([h()],w.prototype,"elevationInfo",void 0),m([h(x(A(Ht)))],w.prototype,"featureEffect",void 0),m([h(x(A(Bt)))],w.prototype,"featureReduction",null),m([h()],w.prototype,"fields",null),m([h()],w.prototype,"geometryType",null),m([h()],w.prototype,"geometryFieldName",null),m([h({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],w.prototype,"graphType",void 0),m([h({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],w.prototype,"graphTypeName",null),m([h()],w.prototype,"hasM",null),m([h()],w.prototype,"hasZ",null),m([h({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],w.prototype,"id",void 0),m([h({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],w.prototype,"labelsVisible",void 0),m([h({type:[K],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:Gr,write:re()}})],w.prototype,"labelingInfo",null),m([h({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],w.prototype,"layerType",void 0),m([h(x(A(Kt)))],w.prototype,"legendEnabled",void 0),m([h(x(A(Xt)))],w.prototype,"maxScale",void 0),m([h(x(A(er)))],w.prototype,"minScale",void 0),m([h()],w.prototype,"objectIdField",void 0),m([h()],w.prototype,"objectType",void 0),m([h(x(A(tr)))],w.prototype,"opacity",void 0),m([h(x(A(Vt)))],w.prototype,"orderBy",void 0),m([h({clonable:!1})],w.prototype,"parent",void 0),m([h()],w.prototype,"parentCompositeLayer",void 0),m([h(x(A(rr)))],w.prototype,"popupEnabled",void 0),m([h({type:Lt,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],w.prototype,"popupTemplate",void 0),m([h({type:Number,json:{write:{overridePolicy:ie}}})],w.prototype,"refreshInterval",void 0),m([h({types:ar,json:{name:"layerDefinition.drawingInfo.renderer",write:re()}})],w.prototype,"renderer",null),m([h()],w.prototype,"source",void 0),m([h()],w.prototype,"spatialReference",null),m([h({type:ir,json:{name:"layerDefinition.timeInfo",write:{overridePolicy:ie},origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:{overridePolicy:ie}},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:{overridePolicy:ie}}}}})],w.prototype,"timeInfo",null),m([h({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],w.prototype,"title",null),m([vt("title")],w.prototype,"writeTitle",null),m([h({json:{read:!1}})],w.prototype,"type",void 0),m([h(x(A(Zt)))],w.prototype,"useViewTime",void 0),m([h({type:Boolean,json:{name:"visibility",write:re()}})],w.prototype,"visible",void 0),w=m([Ee("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],w);export{Be as A,nn as C,en as D,O as E,w as I,Ve as P,We as _,Ye as a,Qe as b,Je as c,je as d,tn as e,U as f,rn as g,Xi as h,an as i,Ki as m,he as o,qe as u,ze as v};
