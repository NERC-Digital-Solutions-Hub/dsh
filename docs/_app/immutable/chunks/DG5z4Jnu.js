import{x as u,r as a,m as f,a as d,H as c,aa as p}from"./oKHlAiyk.js";import"./BJj2_Vlp.js";import{i as v}from"./2eEJBHPf.js";import{a7 as g}from"./BxFa---M.js";import{a as y}from"./C5CzMsLd.js";import{V as I}from"./EnYQAt9i.js";import{U as w}from"./B-7eUg25.js";const n=new I,o=new WeakMap;function b(r){C(r)&&n.push(new WeakRef(r))}function $(r){const e=n.find((s=>s.deref()===r));e&&n.remove(e)}function C(r){return r!=null&&typeof r=="object"&&"refreshInterval"in r&&"refresh"in r}function m(r,e){return Number.isFinite(r)&&Number.isFinite(e)?e<=0?r:m(e,r%e):0}let h=0,i=0;function D(){const r=Date.now();let e=!1;for(const s of n){const t=s.deref();t?t.refreshInterval&&r-(o.get(t)??0)+5>=6e4*t.refreshInterval&&(o.set(t,r),t.refresh(r)):e=!0}if(e)for(let s=n.length-1;s>=0;s--)n.at(s).deref()||n.removeAt(s)}u((()=>{const r=Date.now();let e=0;for(const s of n){const t=s.deref();t&&(e=m(Math.round(6e4*t.refreshInterval),e),t.refreshInterval?o.get(t)||o.set(t,r):o.delete(t))}if(e!==i){if(i=e,clearInterval(h),i===0)return void(h=0);h=setInterval(D,i)}}),w);const l=.1,j=r=>{let e=class extends r{constructor(...s){super(...s),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=c((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||b(this)}),(()=>{}))}destroy(){$(this)}castRefreshInterval(s){return s>=l?s:s<=0?0:l}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(s=Date.now()){p(this._debounceHasDataChanged()).then((t=>{t&&this._set("refreshTimestamp",s),this.emit("refresh",{dataChanged:t})}),(t=>{v.getLogger(this).error(t),this.emit("refresh",{dataChanged:!1,error:t})}))}async hasDataChanged(){return!0}get test(){}};return a([f({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:y}}}}})],e.prototype,"refreshInterval",void 0),a([g("refreshInterval")],e.prototype,"castRefreshInterval",null),a([f({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),a([f({readOnly:!0})],e.prototype,"refreshParameters",null),e=a([d("esri.layers.mixins.RefreshableLayer")],e),e};export{j as f};
