import{N as f,z as c,_ as w,a as m}from"./DwWpeHsS.js";import{_ as y}from"./CbKIfN8e.js";import{O as _,a as h,m as o,b as V}from"./BUpj17sD.js";import{b as v}from"./BYuFUGQz.js";import{i as g}from"./D2XzXsfn.js";import{O as d}from"./oVyUXQqT.js";import{d as C}from"./D0U14gq-.js";import{r as b}from"./8tuXtSca.js";const u="sublayers",l="layerView";let p=class extends v(C){*graphicsViews(){this._graphicsViewsFeatureCollectionMap==null?this._graphicsViews==null?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(e,r){return Array.from(this.graphicsViews(),s=>{const t=s.hitTest(e);if(this._graphicsViewsFeatureCollectionMap!=null){const a=this._graphicsViewsFeatureCollectionMap.get(s);for(const i of t)!i.popupTemplate&&a.popupTemplate&&(i.popupTemplate=a.popupTemplate),i.sourceLayer=i.layer=this.layer}return t}).flat().map(s=>({type:"graphic",graphic:s,layer:this.layer,mapPoint:e}))}highlight(e,r){let s;typeof e=="number"?s=[e]:e instanceof y?s=[e.uid]:Array.isArray(e)&&e.length>0?s=typeof e[0]=="number"?e:e.map(i=>i&&i.uid):_.isCollection(e)&&(s=e.map(i=>i&&i.uid).toArray());const t=s?.filter(f);if(!t?.length)return c();const a=b(r);return this._addHighlights(t,a),c(()=>this._removeHighlights(t,a))}update(e){for(const r of this.graphicsViews())r.processUpdate(e)}attach(){const e=this.view,r=()=>this.requestUpdate(),s=this.layer.featureCollections;if(s!=null&&s.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const t of s){const a=new g(this.view.featuresTilingScheme),i=new d({view:e,graphics:t.source,renderer:t.renderer,requestUpdateCallback:r,container:a});this._graphicsViewsFeatureCollectionMap.set(i,t),this.container.addChild(i.container),this.addHandles([h(()=>t.visible,n=>i.container.visible=n,o),h(()=>i.updating,()=>this.notifyChange("updating"),o)],l)}this._processHighlight()}else this.layer.sublayers!=null&&this.addHandles(V(()=>this.layer.sublayers,"change",()=>this._createGraphicsViews(),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),u)}detach(){this._destroyGraphicsViews(),this.removeHandles(u)}moveEnd(){}viewChange(){for(const e of this.graphicsViews())e.viewChange()}isUpdating(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(l);for(const e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),this.layer.sublayers==null)return;const e=[],r=this.view,s=()=>this.requestUpdate();for(const t of this.layer.sublayers){const a=new g(this.view.featuresTilingScheme);a.fadeTransitionEnabled=!0;const i=new d({view:r,graphics:t.graphics,requestUpdateCallback:s,container:a});this.addHandles([t.on("graphic-update",i.graphicUpdateHandler),h(()=>t.visible,n=>i.container.visible=n,o),h(()=>i.updating,()=>this.notifyChange("updating"),o)],l),this.container.addChild(i.container),e.push(i)}this._graphicsViews=e,this._processHighlight()}_processHighlight(){const e=this._getHighlights();for(const r of this._graphicsViews||[])r.setHighlight(e);this._graphicsViewsFeatureCollectionMap?.forEach((r,s)=>{s.setHighlight(e)})}};p=w([m("esri.views.2d.layers.MapNotesLayerView2D")],p);const q=p;export{q as default};
