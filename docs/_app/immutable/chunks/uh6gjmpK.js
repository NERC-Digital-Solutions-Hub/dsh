import{_ as i,a as P,c as F,m as n,e as x}from"./DUlE1Kon.js";import{s as m}from"./DSdBzmdi.js";import{B as E,$ as g,b as S,d as j,m as O,G as T,e as $}from"./DxH_hBwP.js";import"./BFGjv385.js";let W=class{constructor(){this._resolver=g(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=1,this._cleanUp()},()=>{this._status=2,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===1}isRejected(){return this._status===2}isFulfilled(){return this._status!==0}abort(){this._resolver.reject(S())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const t=g(),o=[...this._resolvingPromises,t.promise],e=this._allPromise=Promise.all(o);e.then(()=>{this.isFulfilled()||this._allPromise!==e||this._resolver.resolve()},r=>{this.isFulfilled()||this._allPromise!==e||j(r)||this._resolver.reject(r)}),t.resolve()}};const A=s=>{const t=s;let o=class extends t{constructor(...e){super(...e),this._promiseProps=new W,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(e,r){return this._promiseProps.promise.then(()=>this).then(e,r)}catch(e){return this.when(null,e)}addResolvingPromise(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)}addResolvingTask(e){e&&!this._promiseProps.isFulfilled()&&(this.addHandles(E(e)),this._promiseProps.addResolvingPromise(e.promise))}};return o=i([P("esri.core.Promise")],o),o},U=A(F),z="not-loaded",L="loading",Z="failed",f="loaded",k=s=>{const t=s;let o=class extends t{constructor(...e){super(...e),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const R=this.load.bind(this);this.load=C=>{const w=new Promise((h,u)=>{const _=O(C,u);this.destroyed&&u(new m("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(h,u).finally(()=>{_&&_.remove()})});if(this.loadStatus===z){this._set("loadStatus",L);const h=this._loadController=new AbortController;R({signal:h.signal})}return r(),w}})),this.when(()=>{this._set("loadStatus",f),this._loadController=null},r=>{this.destroyed||(this._set("loadStatus",Z),this._set("loadError",r),this._loadController=null)})}destroy(){this._loadController&&(this._loadController=T(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===f}get loadWarnings(){return this._get("loadWarnings")}load(e){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new m("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return i([n({readOnly:!0})],o.prototype,"loaded",null),i([n({readOnly:!0})],o.prototype,"loadError",void 0),i([n({clonable:!1})],o.prototype,"loadStatus",void 0),i([n({type:[x],readOnly:!0})],o.prototype,"loadWarnings",null),o=i([P("esri.core.Loadable")],o),o},J=k(U);function K(s){return!(!s||!s.load)}let l;const B=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale,c=globalThis.document?.documentElement;function b(){const s=c?.getAttribute("lang"),t=globalThis.navigator?.language;return B??s??t??"en"}function p(){return l===void 0&&(l=b()),l}const G=/^(?<language>[a-z]{2,3})(?:-(?<extlang>[a-z]{3}))?(?:-[A-Z][a-z]{3})?(?:-(?<region>[A-Z]{2}|\d{3}))?(?:-.*)?$/;function N(s=p()){return y(s)?.language}function Q(s=p()){const t=y(s);return t?.language&&t?.extlang?s.replace(`${t.language}-`,""):s}function y(s=p()){return G.exec(s)?.groups}const a=[];function V(s){return a.push(s),$(()=>{a.splice(a.indexOf(s),1)})}const d=[];function X(s){return d.push(s),$(()=>d.splice(d.indexOf(s),1))}function v(){const s=b();l!==s&&([...d].forEach(t=>t(s)),l=s,[...a].forEach(t=>t(s)))}globalThis.addEventListener?.("languagechange",v),c&&new MutationObserver(()=>{v()}).observe(c,{attributeFilter:["lang"]});export{A as a,Q as b,V as c,p as l,K as m,U as n,k as p,N as s,J as u,X as v};
