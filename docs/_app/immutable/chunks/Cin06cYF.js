import{a as F}from"./BO0zSyDw.js";import{Q as I}from"./BoGhUpgK.js";import{f as w}from"./DOsAn7Yf.js";import{R as h}from"./C6RfGsvn.js";import{s as Q}from"./DGk5f3jX.js";import{B as S,x as T,j as g}from"./6oq_PgRr.js";import{d as j,O as v,V as O}from"./JWwKDW5N.js";import{I as q}from"./BYvjrcXq.js";async function k(e,r,m){const a=I(m),{point:t,distance:i,returnEdge:f,vertexMode:p}=r;if(!f&&p==="none")return{candidates:[]};let n=F(r.query);n=await e.schedule((()=>S(n,e.definitionExpression,e.spatialReference)),a),n=await e.reschedule((()=>j(n,{availableFields:e.availableFields,fieldsIndex:e.fieldsIndex,geometryType:e.geometryType,spatialReference:e.spatialReference})),a);const o=!Q(t.spatialReference,e.spatialReference);o&&await T(t.spatialReference,e.spatialReference);const u=typeof i=="number"?i:i.x,d=typeof i=="number"?i:i.y,y={xmin:t.x-u,xmax:t.x+u,ymin:t.y-d,ymax:t.y+d,spatialReference:t.spatialReference},s=o?g(y,e.spatialReference):y;if(!s)return{candidates:[]};const x=(await h(w(t),null,{signal:a}))[0],c=(await h(w(s),null,{signal:a}))[0];if(x==null||c==null)return{candidates:[]};const l=new v(await e.reschedule((()=>e.searchFeatures(O(c.toJSON()))),a),n,e);await e.reschedule((()=>e.executeObjectIdsQuery(l)),a),await e.reschedule((()=>e.executeTimeQuery(l)),a),await e.reschedule((()=>e.executeAttributesQuery(l)),a),await e.reschedule((()=>E(e,l,a)),a);const R=x.toJSON(),b=o?g(R,e.spatialReference):R,$=o?Math.max(s.xmax-s.xmin,s.ymax-s.ymin)/2:i;return l.createSnappingResponse({...r,point:b,distance:$},n.returnZ,t.spatialReference)}async function E(e,r,m){const{query:a}=r,{spatialRel:t}=a;if(!r?.items?.length||!a.geometry||!t)return;const i=await q(t,a.geometry,e.geometryType,e.hasZ,e.hasM),f=await e.runSpatialFilter(r.items,(p=>i(p.geometry)),m);r.items=f}export{k as u};
