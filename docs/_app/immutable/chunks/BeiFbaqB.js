const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BbKDyuk8.js","./PPVm8Dsz.js","./B92kdZ15.js","./Bs5I5-7o.js","./DvUDi2Se.js","./CnfuZz2S.js","./BYatcg2i.js","./DSvukMJ1.js","./Bx7Drccn.js","./DedWa6hQ.js","./CbAk7Q2g.js","./DjNaib5O.js","./B5cKxMX1.js"])))=>i.map(i=>d[i]);
import{_ as ct}from"./PPVm8Dsz.js";import{L as Nt}from"./CnfuZz2S.js";import{s as dt}from"./BYatcg2i.js";import{L as _t}from"./DSvukMJ1.js";import{z as A,Z as L,_ as N,d as Tt,k as v,m as T,f as wt,n as vt,o as ft,q as Ct}from"./Bs5I5-7o.js";import{P as it}from"./BDErjlP0.js";import{$ as Lt}from"./elf00Mmu.js";var Q;function O(){if(!ot)throw new dt("rasterprojectionhelper-project","projection operator is not loaded")}(function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"})(Q||(Q={}));const ut=(t,n,i,o=0)=>{if(i[0]===1)return[0,0];let s=1,e=-1,r=1,c=-1;for(let f=0;f<t.length;f+=2)isNaN(t[f])||(s=s>t[f]?t[f]:s,e=e>t[f]?e:t[f],r=r>t[f+1]?t[f+1]:r,c=c>t[f+1]?c:t[f+1]);const{cols:a,rows:u}=n,l=(e-s)/a/i[0],d=(c-r)/u/i[1],x=2*o;let h=0,m=!1,p=[0,0];for(let f=0;f<a-3;f++){for(let M=0;M<u-3;M++){const g=f*u*2+2*M,y=(t[g]+t[g+4]+t[g+4*u]+t[g+4*u+4])/4,w=(t[g+1]+t[g+5]+t[g+4*u+1]+t[g+4*u+5])/4,R=Math.abs((y-t[g+2*u+2])/l),S=Math.abs((w-t[g+2*u+3])/d);if(R+S>h&&(h=R+S,p=[R,S]),x&&h>x){m=!0;break}}if(m)break}return p},zt={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},F=32,Y=4,V=Y,Z=new Map,U=new Map,J=500,Ot=39.37,It=96;let q,E,j,ot=!1;async function Qt(){return q||(q=_t(),E=await ct(()=>import("./BbKDyuk8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url),j=await ct(()=>import("./DjNaib5O.js"),__vite__mapDeps([11,1,3,4,5,6,7,8,9,10,12]),import.meta.url),E.isLoaded()||await E.load(),j.isLoaded()||await j.load(),ot=!0,q.resolve()),q.promise}function Wt(t,n,i){if(O(),i){const o=E.execute(t,n);return j.getTransformation(n,t.spatialReference,o)}return j.getTransformation(t.spatialReference,n,t)}function tn(t,n,i,o){const s=t.spatialReference;if(!s||!n||s.equals(n))return t;O();const e=i.center,r=new A({xmin:e.x-t.x/2,xmax:e.x+t.x/2,ymin:e.y-t.y/2,ymax:e.y+t.y/2,spatialReference:s}),c=E.execute(r,n,{geographicTransformation:o}),a=_(n);return c==null||a!=null&&c.width>=a?B(t,s,n):{x:c.width,y:c.height}}function B(t,n,i){const o=L(n)/L(i);return{x:t.x*o,y:t.y*o}}function tt(t,n,i){const{spatialReference:o}=i;if(!o||!n||o.equals(n))return t;if(o.isGeographic&&n.isGeographic)return B(t,o,n);if(O(),!ot)throw new dt("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:s,y:e}=t;const r=(s+e)/2*L(o);let c=1;r>30&&(c=30/r,s*=c,e*=c);const a=256,u=s*a/2,l=e*a/2,{x:d,y:x}=i.center,h=[];for(let P=0;P<=a;P++)h.push([d-u,x-l+P*e]);for(let P=1;P<=a;P++)h.push([d-u+P*s,x+l]);for(let P=1;P<=a;P++)h.push([d+u,x+l-P*e]);for(let P=1;P<a;P++)h.push([d+u-P*s,x-l]);h.push(h[0]);const m=new it({rings:[h],spatialReference:o}),p=E.execute(m,n);if(!p)return B(t,o,n);const f=p.extent,M=_(n);if(f==null||M!=null&&f.width>=M)return B(t,o,n);const g=Jt(p.rings),y=s*e*a*a,w=Math.sqrt(g/y)/c,R={x:f.width/c/a,y:f.height/c/a},S={x:s*w,y:e*w},b=R.x*R.y;return Math.abs(b-S.x*S.y)/b<.1?R:S}function nt(t,n){return(typeof t=="number"?t:(t.x+t.y)/2)*L(n)*It*Ot}function nn(t,n){const{pixelSize:i,extent:o}=t;return nt(tt(i,n,o),n)}function k(t,n=.01){return L(t)?n/L(t):0}function mt(t,n,i,o=!0){const s=t.spatialReference;if(s.equals(n))return t;O();const e=E.execute(t,n,{geographicTransformation:i});return o&&e&&Mt([t],[e],s,n),e}function Mt(t,n,i,o){const s=D(i,!0),e=D(o,!0),r=k(i,J),c=k(o,J);if(r&&s!=null&&e!=null)for(let a=0;a<t.length;a++){const u=n[a];if(!u)continue;const{x:l}=t[a],{x:d}=u;d>=e[1]-c&&Math.abs(l-s[0])<r?u.x-=e[1]-e[0]:d<=e[0]+c&&Math.abs(l-s[1])<r&&(u.x+=e[1]-e[0])}}function $t(t){const{inSR:n,outSR:i,preferPE:o}=t;if(n.equals(i)){const{points:s}=rt(t,null);return s}return n.isWebMercator&&i.isWGS84||n.isWGS84&&i.isWebMercator?At(t):o&&(n.isGeographic||z(n)!=null)?xt(t):jt(t)}function jt(t){const{points:n}=rt(t,null),{inSR:i,outSR:o,datumTransformation:s}=t,e=n.map((c=>new N(c[0],c[1],i))),r=E.executeMany(e,o,{geographicTransformation:s});return s&&Mt(e,r,i,o),r.map((c=>c?[c.x,c.y]:[NaN,NaN]))}function xt(t){const{inSR:n,outSR:i,datumTransformation:o}=t,s=z(n),{points:e,mask:r}=rt(t,s);if(!n.isGeographic){const a=n.wkid?v.coordsys(n.wkid):v.fromString(n.isGeographic?T.PE_TYPE_GEOGCS:T.PE_TYPE_PROJCS,n.wkt2||n.wkt);ft.projToGeog(a,e.length,e)}if(o!=null&&o.steps.length){let a;if(i.isGeographic&&(a=e.map((([l])=>l>179.9955?1:l<-179.9955?-1:0))),o.steps.forEach((l=>{const d=l.wkid?v.geogtran(l.wkid):v.fromString(T.PE_TYPE_GEOGTRAN,l.wkt);Ct.geogToGeog(d,e.length,e,null,l.isInverse?T.PE_TRANSFORM_2_TO_1:T.PE_TRANSFORM_1_TO_2)})),a)for(let l=0;l<e.length;l++){const d=a[l],x=e[l][0],h=x>179.9955?1:x<-179.9955?-1:0;d&&h&&d!==h&&(e[l][0]=d>0?x+360:x-360)}}if(!i.isGeographic){const a=z(i,!0),u=a!=null&&a.isEnvelope?[a.bbox[1],a.bbox[3]]:[-90,90];qt(e,u);const l=i.wkid?v.coordsys(i.wkid):v.fromString(i.isGeographic?T.PE_TYPE_GEOGCS:T.PE_TYPE_PROJCS,i.wkt2||i.wkt);ft.geogToProj(l,e.length,e)}let c=e;if(r&&e.length!==r.length){c=[];for(let a=0,u=0;a<r.length;a++)r[a]?c.push(e[u++]):c.push([NaN,NaN])}return c}function At(t){const{cols:n,rows:i,xres:o,yres:s,usePixelCenter:e,inSR:r,outSR:c}=t;let{xmin:a,ymax:u}=t;e&&(a+=o/2,u-=s/2);const l=[],d=[],x=Math.max(n,i);for(let m=0;m<x;m++){const p=a+o*Math.min(n,m),f=u-s*Math.min(i,m),M=Lt(new N({x:p,y:f,spatialReference:r}),r,c);m<=n&&l.push(M.x),m<=i&&d.push(M.y)}const h=[];for(let m=0;m<n;m++)for(let p=0;p<i;p++)h.push([l[m],d[p]]);return h}function z(t,n=!1){let i=t.wkid||t.wkt2||t.wkt;if(!i||t.isGeographic)return null;if(i=String(i),Z.has(i)){const r=Z.get(i);return n?r?.gcs:r?.pcs}const o=t.wkid?v.coordsys(t.wkid):v.fromString(t.isGeographic?T.PE_TYPE_GEOGCS:T.PE_TYPE_PROJCS,t.wkt2||t.wkt),s=ht(o,k(t,1e-4)),e=ht(o,0,!0);return Z.set(i,{pcs:s,gcs:e}),n?e:s}function ht(t,n=0,i=!1){const o=vt.generate(t),s=i?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!o||!s?.length)return null;let e=!1,r=s.find((f=>f.getInclusive()===1&&f.getKind()===1));if(!r){if(r=s.find((f=>f.getInclusive()===1&&f.getKind()===0)),!r)return null;e=!0}const c=i?0:(o.getNorthPoleLocation()===2?1:0)|(o.getSouthPoleLocation()===2?2:0),a=o.isPannableRectangle(),u=r.getCoord();if(e)return{isEnvelope:e,isPannable:a,vertices:u,coef:null,bbox:[u[0][0]-n,u[0][1]-n,u[1][0]+n,u[1][1]+n],poleLocation:c};let l=0;const d=[];let[x,h]=u[0],[m,p]=u[0];for(let f=0,M=u.length;f<M;f++){l++,l===M&&(l=0);const[g,y]=u[f],[w,R]=u[l];if(R===y)d.push([g,w,y,R,2]);else{const S=(w-g)/(R-y||1e-4),b=g-S*y;y<R?d.push([S,b,y,R,0]):d.push([S,b,R,y,1])}x=x<g?x:g,h=h<y?h:y,m=m>g?m:g,p=p>y?p:y}return{isEnvelope:!1,isPannable:a,vertices:u,coef:d,bbox:[x,h,m,p],poleLocation:c}}function rt(t,n){const i=[],{cols:o,rows:s,xres:e,yres:r,usePixelCenter:c}=t;let{xmin:a,ymax:u}=t;if(c&&(a+=e/2,u-=r/2),n==null){for(let h=0;h<o;h++)for(let m=0;m<s;m++)i.push([a+e*h,u-r*m]);return{points:i}}const l=new Uint8Array(o*s);if(n.isEnvelope){const{bbox:[h,m,p,f]}=n;for(let M=0,g=0;M<o;M++){const y=a+e*M,w=n.isPannable||y>=h&&y<=p;for(let R=0;R<s;R++,g++){const S=u-r*R;w&&S>=m&&S<=f&&(i.push([y,S]),l[g]=1)}}return{points:i,mask:l}}const d=n.coef,x=[];for(let h=0;h<s;h++){const m=u-r*h,p=[],f=[];for(let g=0;g<d.length;g++){const[y,w,R,S,b]=d[g];if(m===R&&R===S)p.push(y),p.push(w),f.push(2),f.push(2);else if(m>=R&&m<=S){const P=y*m+w;p.push(P),f.push(b)}}let M=p;if(p.length>2){let g=f[0]===2?0:f[0],y=p[0];M=[];for(let w=1;w<f.length;w++)f[w]===2&&w!==f.length-1||(f[w]!==g&&(M.push(g===0?Math.min(y,p[w-1]):Math.max(y,p[w-1])),g=f[w],y=p[w]),w===f.length-1&&M.push(f[w]===0?Math.min(y,p[w]):Math.max(y,p[w])));M.sort(((w,R)=>w-R))}else p[0]>p[1]&&(M=[p[1],p[0]]);x.push(M)}for(let h=0,m=0;h<o;h++){const p=a+e*h;for(let f=0;f<s;f++,m++){const M=u-r*f,g=x[f];if(g.length===2)p>=g[0]&&p<=g[1]&&(i.push([p,M]),l[m]=1);else if(g.length>2){let y=!1;for(let w=0;w<g.length;w+=2)if(p>=g[w]&&p<=g[w+1]){y=!0;break}y&&(i.push([p,M]),l[m]=1)}}}return{points:i,mask:l}}function qt(t,n){const[i,o]=n;for(let s=0;s<t.length;s++){const e=t[s][1];(e<i||e>o)&&(t[s]=[NaN,NaN])}}function Rt(t,n){const i=_(t[0].spatialReference);if(t.length<2||i==null||(n=n??k(t[0].spatialReference),(t=t.filter((c=>c.width>n))).length===1))return t[0];let{xmin:o,xmax:s,ymin:e,ymax:r}=t[0];for(let c=1;c<t.length;c++){const a=t[c];s=a.xmax+i*c,e=Math.min(e,a.ymin),r=Math.max(r,a.ymax)}return new A({xmin:o,xmax:s,ymin:e,ymax:r,spatialReference:t[0].spatialReference})}function Pt(t,n,i=null,o=!0){const s=t.spatialReference;if(s.equals(n)||!n)return t;const e=st(t),r=_(s,!0),c=_(n);if(e===0||r==null||c==null){const l=et(t,n,i,o);if(l&&r==null&&c!=null&&Math.abs(l.width-c)<k(n)&&E.isLoaded()){const d=z(s);if(d!=null&&d.poleLocation===Q.None&&t.width<(d.bbox[2]-d.bbox[0])/2)return Bt(t,n)||l}return l}const a=t.clone().normalize();if(a.length===1&&t.xmax<r&&t.xmax-r/2>k(s)){const{xmin:l,xmax:d}=t;for(let x=0;x<=e;x++){const h=x===0?l:-r/2,m=x===e?d-r*x:r/2;a[x]=new A({xmin:h,xmax:m,ymin:t.ymin,ymax:t.ymax,spatialReference:s})}}const u=a.map((l=>et(l,n,i,o))).filter(Nt);return u.length===0?null:Rt(u)}function en(t,n,i){if(t.type==="extent"){const{xmin:o,ymin:s,xmax:e,ymax:r,spatialReference:c}=t;t=new it({rings:[[[o,r],[e,r],[e,s],[o,s],[o,r]]],spatialReference:c})}return t.spatialReference.equals(n)?t:(O(),E.execute(t,n,{geographicTransformation:i}))}function Bt(t,n){const i=_(n);if(i==null)return null;let{xmin:o,ymin:s,xmax:e,ymax:r}=t;const c=t.spatialReference,a=new it({spatialReference:c,rings:[[[o,s],[e,s],[e,r],[o,r],[o,s]]]}),u=E.execute(a,n);if(u.rings.length!==2||!u.rings[0].length||!u.rings[1].length)return null;const{rings:l}=u,d=k(c),x=new A({spatialReference:n});for(let h=0;h<2;h++){o=e=l[h][0][0],s=r=l[h][0][1];for(let m=0;m<l[h].length;m++)o=o>l[h][m][0]?l[h][m][0]:o,e=e<l[h][m][0]?l[h][m][0]:e,s=s>l[h][m][1]?l[h][m][1]:s,r=r<l[h][m][1]?l[h][m][1]:r;if(h===0)x.ymin=s,x.ymax=r,x.xmin=o,x.xmax=e;else if(x.ymin=Math.min(x.ymin,s),x.ymax=Math.max(x.ymax,r),Math.abs(e-i/2)<d)x.xmin=o,x.xmax=x.xmax+i;else{if(!(Math.abs(o+i/2)<d))return null;x.xmax=e+i}}return x}function et(t,n,i,o=!0,s=!0){const e=t.spatialReference;if(e.equals(n)||!n)return t;O();const r=E.execute(t,n,{geographicTransformation:i});if(s&&n.isWebMercator&&r&&(r.ymax=Math.min(20037508342787e-6,r.ymax),r.ymin=Math.max(-20037508342787e-6,r.ymin),r.ymin>=r.ymax))return null;if(!o||!r)return r;const c=D(e,!0),a=D(n,!0);if(c==null||a==null)return r;const u=k(e,.001),l=k(e,J),d=k(n,.001);if(Math.abs(r.xmin-a[0])<d&&Math.abs(r.xmax-a[1])<d){const x=Math.abs(t.xmin-c[0]),h=Math.abs(c[1]-t.xmax);if(x<u&&h>l){r.xmin=a[0];const m=[];m.push(new N(t.xmax,t.ymin,e)),m.push(new N(t.xmax,(t.ymin+t.ymax)/2,e)),m.push(new N(t.xmax,t.ymax,e));const p=m.map((f=>mt(f,n,i))).filter((f=>!isNaN(f?.x))).map((f=>f.x));r.xmax=Math.max.apply(null,p)}if(h<u&&x>l){r.xmax=a[1];const m=[];m.push(new N(t.xmin,t.ymin,e)),m.push(new N(t.xmin,(t.ymin+t.ymax)/2,e)),m.push(new N(t.xmin,t.ymax,e));const p=m.map((f=>mt(f,n,i))).filter((f=>!isNaN(f?.x))).map((f=>f.x));r.xmin=Math.min.apply(null,p)}}else{const x=k(n,.001);Math.abs(r.xmin-a[0])<x&&(r.xmin=a[0]),Math.abs(r.xmax-a[1])<x&&(r.xmax=a[1])}return r}function _(t,n=!1){if(!t)return null;const i=n?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*i:t.wkid&&t.isGeographic?360:2*zt[t.wkid]||null}function D(t,n=!1){if(t.isGeographic)return[-180,180];const i=_(t,n);return i!=null?[-i/2,i/2]:null}function pt(t,n,i,o){let s=(t-n)/i;return s-Math.floor(s)!==0?s=Math.floor(s):o&&(s-=1),s}function st(t,n=!1){const i=_(t.spatialReference);if(i==null)return 0;const o=n?0:-(i/2),s=k(t.spatialReference),e=!n&&Math.abs(t.xmax-i/2)<s?i/2:t.xmax,r=!n&&Math.abs(t.xmin+i/2)<s?-i/2:t.xmin;return pt(e,o,i,!0)-pt(r,o,i,!1)}function on(t){const n=t.storageInfo.origin.x,i=_(t.spatialReference,!0);if(i==null)return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const o=i/2,{nativePixelSize:s,storageInfo:e,extent:r}=t,{maximumPyramidLevel:c,blockWidth:a,pyramidScalingFactor:u}=e;let l=s.x;const d=[],x=t.transform!=null&&t.transform.type==="gcs-shift",h=n+(x?0:o),m=x?i-n:o-n;for(let p=0;p<=c;p++){const f=(r.xmax-n)/l/a,M=f-Math.floor(f)===0?f:Math.ceil(f),g=m/l/a,y=g-Math.floor(g)===0?g:Math.ceil(g),w=Math.floor(h/l/a),R=Math.round(h/l)%a,S=(a-Math.round(m/l)%a)%a;d.push({resolutionX:l,blockWidth:a,datasetColumnCount:M,worldColumnCountFromOrigin:y,leftMargin:R,rightPadding:S,originColumnOffset:w}),l*=u}return{originX:n,halfWorldWidth:o,pyramidsInfo:d,hasGCSSShiftTransform:x}}function Ft(t){if(!t||t.isGeographic)return t;const n=String(t.wkid||t.wkt2||t.wkt);let i;return U.has(n)?i=U.get(n):(i=(t.wkid?v.coordsys(t.wkid):v.fromString(T.PE_TYPE_PROJCS,t.wkt2||t.wkt)).getGeogcs().getCode(),U.set(n,i)),new wt({wkid:i})}function rn(t){const n=t.isAdaptive&&t.spacing==null;let i=t.spacing||[F,F],o=H(t),s={cols:o.size[0]+1,rows:o.size[1]+1};const e=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;let r=o.outofBoundPointCount===o.offsets.length/2||n&&e?[0,0]:ut(o.offsets,s,i,V);const c=(r[0]+r[1])/2,a=t.projectedExtent.spatialReference,u=t.srcBufferExtent.spatialReference;if(n&&(e||c>V)&&(a.isGeographic||z(a),i=[Y,Y],o=H({...t,spacing:i}),s={cols:o.size[0]+1,rows:o.size[1]+1},r=ut(o.offsets,s,i,V)),o.error=r,i[0]>1&&(o.coefficients=gt(o.offsets,s,e)),t.includeGCSGrid&&!a.isGeographic&&!a.isWebMercator)if(u.isGeographic)o.gcsGrid={offsets:o.offsets,coefficients:o.coefficients,spacing:i};else{const l=z(a);if(l!=null&&!l.isEnvelope){const d=Ft(a),x=Pt(t.projectedExtent,d),{offsets:h}=H({...t,srcBufferExtent:x,spacing:i}),m=gt(h,s,e);o.gcsGrid={offsets:h,coefficients:m,spacing:i}}}return o}function H(t){const{projectedExtent:n,srcBufferExtent:i,pixelSize:o,datumTransformation:s,rasterTransform:e}=t,r=n.spatialReference,c=i.spatialReference;O();const{xmin:a,ymin:u,xmax:l,ymax:d}=n,x=_(c),h=x!=null&&(t.hasWrapAround||e?.type==="gcs-shift"),m=t.spacing||[F,F],p=m[0]*o.x,f=m[1]*o.y,M=m[0]===1,g=Math.ceil((l-a)/p-.1/m[0])+(M?0:1),y=Math.ceil((d-u)/f-.1/m[1])+(M?0:1),w=$t({cols:g,rows:y,xmin:a,ymax:d,xres:p,yres:f,inSR:r,outSR:c,datumTransformation:s,preferPE:m[0]<=Y,usePixelCenter:M}),R=[];let S,b=0;const P=M?-1:NaN,{xmin:C,xmax:I,ymax:X,width:St,height:bt}=i,Gt=k(c,J),kt=x!=null&&C>0&&I>x/2,at=z(r),Et=at!=null&&at.poleLocation>0;for(let W=0;W<g;W++){const K=[];for(let $=0;$<y;$++){let G=w[W*y+$];if(h&&G[0]>I&&G[0]>x/2-Gt?G[0]-=x:h&&W===0&&G[0]<0&&kt&&!e&&(G[0]+=x),!G||isNaN(G[0])||isNaN(G[1]))R.push(P),R.push(P),K.push(null),b++;else{if(e){const lt=e.inverseTransform(new N({x:G[0],y:G[1],spatialReference:c}));G=[lt.x,lt.y]}K.push(G),W>0&&h&&S[$]&&G[0]<S[$][0]&&(G[0]+=x,Et&&G[0]>I&&G[0]>x&&(G[0]-=x)),R.push((G[0]-C)/St),R.push((X-G[1])/bt)}}S=K}return{offsets:R,error:null,coefficients:null,outofBoundPointCount:b,spacing:m,size:M?[g,y]:[g-1,y-1]}}function gt(t,n,i){const{cols:o,rows:s}=n,e=new Float32Array((o-1)*(s-1)*2*6),r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),c=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let a=0;a<o-1;a++){for(let u=0;u<s-1;u++){let l=a*s*2+2*u;const d=t[l],x=t[l+1],h=t[l+2],m=t[l+3];l+=2*s;const p=t[l],f=t[l+1],M=t[l+2],g=t[l+3];let y=0,w=12*(u*(o-1)+a);for(let R=0;R<3;R++)e[w++]=r[y++]*d+r[y++]*h+r[y++]*M;y=0;for(let R=0;R<3;R++)e[w++]=r[y++]*x+r[y++]*m+r[y++]*g;y=0;for(let R=0;R<3;R++)e[w++]=c[y++]*d+c[y++]*p+c[y++]*M;y=0;for(let R=0;R<3;R++)e[w++]=c[y++]*x+c[y++]*f+c[y++]*g}if(i)for(let u=0;u<e.length;u++)isNaN(e[u])&&(e[u]=-1)}return e}function Yt(t,n){const i=t.clone().normalize();return i.length===1?i[0]:Rt(i,n)}function sn(t){const{spatialReference:n}=t,i=Tt(n);if(!i)return t;const[o,s]=i.valid,e=s-o;let r=0;if(t.xmin<o){const c=o-t.xmin;r=Math.ceil(c/e)}else if(t.xmin>s){const c=t.xmin-s;r=-Math.ceil(c/e)}return new A({spatialReference:t.spatialReference,xmin:t.xmin+r*e,ymin:t.ymin,xmax:t.xmax+r*e,ymax:t.ymax})}function an(t,n,i){const{storageInfo:o,pixelSize:s}=n;let e=0,r=!1;const{pyramidResolutions:c}=o,a=o.tileInfo.format?.toLowerCase()==="mixed"?Math.max(1,Math.min(3,o.tileInfo.dpi/96)):1,u=(t.x+t.y)/2/a;if(c!=null&&c.length){const m=c[c.length-1],p=(m.x+m.y)/2,f=(s.x+s.y)/2;if(u<=f)e=0;else if(u>=p)e=c.length,r=u/p>8;else{let g,y=f;for(let w=1;w<=c.length;w++){if(g=(c[w-1].x+c[w-1].y)/2,u<=g){u===g?e=w:i==="down"?(e=w-1,r=u/y>8):e=i==="up"||u-y>g-u||u/y>2?w:w-1;break}y=g}}const M=e===0?s:c[e-1];return r&&Math.min(M.x,M.y)*L(n.spatialReference)>19567&&(r=!1),{pyramidLevel:e,pyramidResolution:new N({x:M.x,y:M.y,spatialReference:n.spatialReference}),excessiveReading:r}}const l=Math.log(t.x/s.x)/Math.LN2,d=Math.log(t.y/s.y)/Math.LN2,x=n.storageInfo.maximumPyramidLevel||0;e=i==="down"?Math.floor(Math.min(l,d)):i==="up"?Math.ceil(Math.max(l,d)):Math.round((l+d)/2),e<0?e=0:e>x&&(r=e>x+3,e=x);const h=2**e;return{pyramidLevel:e,pyramidResolution:new N({x:h*n.nativePixelSize.x,y:h*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:r}}function yt(t,n,i=!1){const{pixelSize:o,extent:s}=t,e=Wt(s,n,!1),r=Pt(Yt(s,(o.x+o.y)/16),n,e);return!r||i||st(r)===0?r:et(s,n,e)}function ln(t,n,i){const o=i?.tileSize,s=i?.alignGlobalDatasetWithAGOL,{extent:e,spatialReference:r,pixelSize:c}=t,a=tt(c,n,e);if(a==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(a.x+a.y)/2,l=nt(u,n),d=n.isGeographic?256/o*2958287637958547e-7:256/o*591657527591555e-6;let x=t.dataType==="vector-magdir"||t.dataType==="vector-uv";const h=yt(t,n,!0),m=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/l)/Math.LN2));if(!x&&h&&s&&(n.isGeographic||n.isWebMercator)){const b=_(n);if(x=st(h)>0||b!=null&&h.width>b/4,!x&&b!=null){let P=-1;if(m<3)P=2**m*u*o;else if(t.storageInfo){const{maximumPyramidLevel:I=0,pyramidScalingFactor:X=2}=t.storageInfo;P=X**I*u*o}const C=Math.ceil(b/P);x=C===1||C===2&&b/2-h.xmax<P}}let p,f=l;const M=1.001,g=Math.min(2,Math.max(1.414,t.storageInfo?.pyramidScalingFactor||2));if(x){f=d;const b=n.isGeographic?1341104507446289e-21:.29858214164761665,P=nt(b,n),C=n.isGeographic?4326:3857;p=tt({x:b,y:b},r,yt(t,new wt({wkid:C}),!0)),p.x*=f/P,p.y*=f/P}else{p={x:c.x,y:c.y};let b=0;for(;f<d*(M/2)&&b<m;)b++,f*=g,p.x*=g,p.y*=g;Math.max(f,d)/Math.min(f,d)<=M&&(f=d)}const y=[f],w=[{x:p.x,y:p.y}],R=70.5310735,S=Math.min(R,l)/M;for(;f>=S;)f/=g,p.x/=g,p.y/=g,y.push(f),w.push({x:p.x,y:p.y});return{projectedPixelSize:a,scales:y,srcResolutions:w,isCustomTilingScheme:!x}}function Jt(t){let n=0;for(const i of t){const o=i.length;let s=i[0][0]*(i[1][1]-i[o-2][1]);for(let e=1;e<o-1;e++)s+=i[e][0]*(i[e+1][1]-i[e-1][1]);n+=s/2}return Math.abs(n)}export{mt as A,Wt as C,nn as O,Pt as Q,en as V,tn as _,_ as e,sn as f,on as i,yt as m,st as o,rn as s,an as u,Qt as v,ln as x};
