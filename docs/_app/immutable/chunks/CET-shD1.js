import{r as l,m as p,a as S,f as kt,O as Pn,M as On,C as me,u as K,E as vt,n as qt,t as Fe,a9 as Yt,K as He,ap as En}from"./Bcg-2HKw.js";import Cn from"./B4_pDwsp.js";import{V as Xt}from"./B0Ux2NeR.js";import{j as ge,o as Vt,l as Z,w as St,U as Rn}from"./BEmcbgM0.js";import{L as mt,b as Kt,h as kn}from"./w-2V2ENZ.js";import"./DGjcIG0n.js";import{h as Ze}from"./B6nUj3Vi.js";import{d as Vn}from"./DcmYqKhq.js";import{r as j,V as In,R as Un,E as An,c as zn,H as Dn}from"./Z1HnRdIa.js";import{c as Gn}from"./0ti59-db.js";import{a as Le,j as Fn,ay as Hn,aw as Zn,S as Ln,ab as Wn,au as Nn,b as jn,aA as Bn,f as re,_ as V,Z as Qt,N as We,V as se,a_ as qn,a9 as Yn}from"./Q08H8bVX.js";import{g as Jt,P as Xn,c as Ne,A as Kn,_ as Qn,Q as fe,I as Jn,o as je,s as ti,u as Pt,w as ye}from"./6lnTPk9w.js";import{P as Tt,n as E,d as Lt,V as ei,p as ni,W as Be,y as ii,m as oi,r as ri,q as ve}from"./Dl3KosoA.js";import{j as si,N as ai}from"./CyvnHO2d.js";import{c as li}from"./BXfAqMn_.js";import{c as ci,u as pi}from"./XMika3GS.js";import{u as ui}from"./h6CPogxh.js";import{x as _e,z as di,A as F}from"./D769sw7B.js";import{R as hi,L as mi}from"./DdIqWru-.js";import{e as we}from"./aQ5IuZRd.js";import{f as It,o as gi,a as qe,d as dt,h as N,j as fi}from"./B26l9TEx.js";import{a as yi,b as vi,E as Ye,j as Xe,p as Ot,u as _i,m as Ke}from"./DV-xHWUv.js";import{h as gt,k as wi,R as xi,y as Qe,F as Je,Q as bi,w as $i,E as te,e as ee,P as Mi,p as Si,c as Ti,t as Pi,d as Oi,f as Ei,g as Ci}from"./C7cjwFoL.js";import{c as tt,P as ae,Q as Ri,$ as J,a0 as tn,K as ki,B as Q,a1 as en,a2 as Vi,a3 as nn,j as Ii,M as Ui,a4 as Ai,g as zi,a5 as Di,a6 as Gi,R as Fi,l as on,X as rn,a7 as Hi,W as Zi}from"./BLipWmbO.js";import{t as xe}from"./DmxaQ-k8.js";import{t as Li}from"./DMhnZ7k1.js";import{c as le,f as Wi}from"./aQeO9QTD.js";import{y as Ni}from"./58W6c_CL.js";import{m as _t,r as be}from"./D6KPPgz5.js";import{l as ji}from"./Chk7YAAL.js";import{O as Et}from"./BTWTCu7M.js";import{c as Bi}from"./1PeDMkUM.js";import{x as Ut,k as qi}from"./CCaF8uoA.js";import{n as At,e as ce}from"./ChQmqWUr.js";import{D as sn,g as an}from"./CJ1UsTrr.js";import{o as ot,j as $e,f as Yi,M as Xi,e as Ki,u as Qi,l as Me,k as Se}from"./C4eyRFHZ.js";import{W as Ji,K as zt}from"./DmANTHro.js";import{t as rt}from"./4xua0hmf.js";function ut(e,t){return e===t||e!=null&&t!=null&&Le(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function Wt(e,t,n){return e===t||e!=null&&t!=null&&Le(e.spatialReference,t.spatialReference)&&_t(e.x,t.x,n)&&_t(e.y,t.y,n)&&_t(e.z??0,t.z??0,n)&&_t(e.m??0,t.m??0,n)}var T;(function(e){e[e.NeverApplied=0]="NeverApplied",e[e.Applied=1]="Applied",e[e.Undone=2]="Undone"})(T||(T={}));var I;(function(e){e.UndoRedoUpdating="UndoRedoUpdating",e.UndoInvalidError="UndoInvalidError",e.RedoInvalidError="RedoInvalidError",e.ApplyInvalidError="ApplyInvalidError"})(I||(I={}));const Dt={[I.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[I.UndoInvalidError]:"There are no items to Undo",[I.RedoInvalidError]:"There are no items to Redo",[I.ApplyInvalidError]:"Cannot apply an item that is already applied"};let st=class extends Error{constructor(){super(Dt[I.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},ne=class extends Error{constructor(){super(Dt[I.UndoInvalidError]),this.type="undo-redo-undo-error"}},Te=class extends Error{constructor(){super(Dt[I.RedoInvalidError]),this.type="undo-redo-redo-error"}},to=class extends Error{constructor(){super(Dt[I.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var A;(function(e){e[e.Apply=0]="Apply",e[e.Undo=1]="Undo",e[e.Redo=2]="Redo"})(A||(A={}));let wt=class extends kt{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=T.NeverApplied}get canUndo(){return this.status===T.Applied}get canRedo(){return this.status===T.Undone}async executeUndoRedoOperation(t){switch(t){case A.Apply:if(this.status!==T.NeverApplied)throw new to;return await this.apply(),void(this.status=T.Applied);case A.Undo:if(this.status!==T.Applied)throw new ne;return await this.undo(),void(this.status=T.Undone);case A.Redo:if(this.status!==T.Undone)throw new ne;return await this.redo(),void(this.status=T.Applied)}}};l([p()],wt.prototype,"name",void 0),l([p()],wt.prototype,"tag",void 0),wt=l([S("esri.undoredo.UndoableOperation")],wt);let R=class extends kt{constructor(){super(...arguments),this._stack=new Xt,this._stackPosition=-1,this._updatingHandles=new Ze}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((t=>t.destroy()))}_drainStack(){this._stack.drain((t=>t.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new ne;if(this.updating)throw new st;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(A.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Te;if(this.updating)throw new st;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new Te;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(A.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new st;await this._updatingHandles.addPromise((async()=>{t.status===T.NeverApplied&&await t.executeUndoRedoOperation(A.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((n=>n.destroy())),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new st;await this._updatingHandles.addPromise((async()=>{t.status===T.NeverApplied&&await t.executeUndoRedoOperation(A.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,n=!1){if(this.updating&&!n)return;await ge((()=>!this.updating));const i=new Xt;for(let o=0;o<this._stack.length;o++){const r=this._stack.getItemAt(o);r&&(r.tag===t?(r.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(r))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new st;await ge((()=>!this.updating)),this._drainStack()}};l([p()],R.prototype,"_stack",void 0),l([p()],R.prototype,"_stackPosition",void 0),l([p()],R.prototype,"updating",null),l([p({readOnly:!0})],R.prototype,"canUndo",null),l([p({readOnly:!0})],R.prototype,"hasUndo",null),l([p({readOnly:!0})],R.prototype,"canRedo",null),l([p({readOnly:!0})],R.prototype,"hasRedo",null),R=l([S("esri.UndoRedo")],R);let eo=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var ie;let D=ie=class extends Tt{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,this.rings.length!==0||!e)return;const n=Fn(this.radius,this.radiusUnit,"meters"),i=e.spatialReference;let o,r="geographic";if(i.isWebMercator?r="webMercator":((i.wkid&&Hn[i.wkid])!=null||(i.wkt2||i.wkt)&&Zn(i.wkt2||i.wkt))&&(r="projected"),this.geodesic){let s;switch(r){case"webMercator":s=Ln(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":s=e}o=this._createGeodesicCircle(s,n,t),r==="webMercator"&&(o=Wn(o))}else{let s;r==="webMercator"||r==="projected"?s=n/Nn(e.spatialReference):r==="geographic"&&(s=jn(n,"meters",Bn(e.spatialReference).radius)),o=this._createPlanarCircle(e,s,t)}this.spatialReference=o.spatialReference,this.addRing(o.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:n,radiusUnit:i,geodesic:o}=this;return new ie({center:e?.clone(),numberOfPoints:t,radius:n,radiusUnit:i,geodesic:o})}_createGeodesicCircle(e,t,n){const i=[],o=[e.x,e.y];for(let r=0;r<360;r+=360/n){const s=this.hasZ?[0,0,e.z??0]:[0,0];si(s,o,r,t,re.WGS84),i.push(s)}return i.push(i[0]),new Tt({rings:[i]})}_createPlanarCircle(e,t,n){const i=[],o=2*Math.PI/n;for(let r=0;r<n;++r){const s=o*r,c=[e.x+Math.cos(-s)*t,e.y+Math.sin(-s)*t];this.hasZ&&c.push(e.z??0),i.push(c)}return i.push(i[0]),new Tt({spatialReference:e.spatialReference,rings:[i]})}};l([p({type:V})],D.prototype,"center",void 0),l([p()],D.prototype,"geodesic",void 0),l([p()],D.prototype,"numberOfPoints",void 0),l([p()],D.prototype,"radius",void 0),l([p()],D.prototype,"radiusUnit",void 0),D=ie=l([S("esri.geometry.Circle")],D);const no=D;function Ct(e,t,n=null){return n!=null?[e,t,n]:[e,t]}function x(e,t,n=null){return n!=null?{x:e,y:t,z:n}:{x:e,y:t}}let ln=class{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map((n=>this.mapToLocal(n))).filter(mt)}get doUnnormalization(){return!1}},io=class extends ln{constructor(t,n,i=null){super(n),this._defaultZ=i,this.transform=_e(),this.transformInv=_e(),this.transform=di(t),ui(this.transformInv,this.transform)}makeMapPoint(t,n){return Ct(t,n,this._defaultZ)}mapToLocal(t){return x(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return Ct(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}},oo=class extends ln{constructor(t,n){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=E(),this.tangentFrameUpWS=E(),this.tangentFrameRightWS=E(),this.tangentFrameForwardWS=E(),this.localFrameRightWS=E(),this.localFrameUpWS=E(),this.worldToLocalTransform=we(),this.localToWorldTransform=we(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=n,this.defaultZ=n.hasZ?n.z:null;const i=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Lt.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Lt.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Lt.Z,this.tangentFrameForwardWS);const o=E();Jt(o,this.tangentFrameForwardWS,Xn(i,this.tangentFrameForwardWS)),Ne(this.localFrameRightWS,i,o),Kn(this.localFrameRightWS,this.localFrameRightWS),Qn(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),hi(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),mi(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(t,n){return Ct(t,n,this.defaultZ)}mapToLocal(t){const n=E();this.view.renderCoordsHelper.toRenderCoords(new V({x:t[0],y:t[1],spatialReference:this.spatialReference}),n),fe(n,n,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(n,new V({spatialReference:this.view.spatialReference}));return i!=null?x(i.x/this.scale,i.y/this.scale):null}localToMap(t){const n=E();this.view.renderCoordsHelper.toRenderCoords(new V({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),n),fe(n,n,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(n,new V({spatialReference:this.view.spatialReference}));return i!=null?Ct(i.x,i.y,this.defaultZ):null}};function ro(e,t){if(e.type==="2d")return new io(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type==="3d"){const n=t.length>2?new V({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new V({x:t[0],y:t[1],spatialReference:e.spatialReference});return new oo(e,n)}return null}function W(e,t){const n=new V({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function so(e,t){return new oi({points:e,spatialReference:t})}function Pe(e,t,n){const i=new ii({paths:e,spatialReference:t});return n&&Be(i),i}function ft(e,t,n,i=!0){const o=Kt(e);o.forEach((s=>{const c=s[0],a=s[s.length-1];kn(c,a)&&s.length!==1||s.push(s[0])}));let r=new Tt({rings:o,spatialReference:t});return r.rings.forEach((s=>{ni(s)||s.reverse()})),n&&Be(r),i&&!ci(r)&&We(t)&&(r=pi(r)||r),r}function Oe(e,t,n){const i=t.mapToLocalMultiple(e),o=[],r={x:i[0].x,y:i[0].y},s={x:i[1].x,y:i[1].y},c=Math.round(s.x-r.x),a=Math.round(s.y-r.y),u=Math.max(Math.abs(c),Math.abs(a));if(n){const d={x:r.x+u,y:r.y+u},m={x:r.x-u,y:r.y-u};o.push(x(d.x,m.y),x(m.x,m.y),x(m.x,d.y),x(d.x,d.y))}else{const d={x:c>0?r.x+u:r.x-u,y:a>0?r.y+u:r.y-u};o.push(x(r.x,r.y),x(d.x,r.y),x(d.x,d.y),x(r.x,d.y))}return cn(ft([o.map((d=>t.localToMap(d))).filter(mt)],t.spatialReference,t.doUnnormalization,!0),o,t)}function ao(e,t,n){let i=t.mapToLocalMultiple(e);if(i.length===1){const a=i[0];i=[x(a.x-48,a.y+48),x(a.x+48,a.y-48),x(a.x+48,a.y-48),x(a.x-48,a.y+48)]}const o=[],r={x:i[0].x,y:i[0].y},s={x:i[1].x,y:i[1].y};if(n){const c=Math.round(s.x-r.x),a=Math.round(s.y-r.y);o.push(x(r.x-c,r.y-a),x(s.x,r.y-a),x(s.x,s.y),x(r.x-c,s.y))}else o.push(x(r.x,r.y),x(s.x,r.y),x(s.x,s.y),x(r.x,s.y));return cn(ft([o.map((c=>t.localToMap(c))).filter(mt)],t.spatialReference,t.doUnnormalization,!0),o,t)}function cn(e,t,n){const i=xt(t[3],t[2],n),o=xt(t[1],t[2],n),r=xt(t[0],t[1],n),s=xt(t[0],t[3],n);return{geometry:e,midpoints:i!=null&&o!=null&&r!=null&&s!=null?{top:i,right:o,bottom:r,left:s}:null}}function xt(e,t,n){B[0]=e.x,B[1]=e.y,B[2]=0,q[0]=t.x,q[1]=t.y,q[2]=0,Jn(B,B,q,.5),bt.x=B[0],bt.y=q[1],bt.z=q[2];const i=n.localToMap(bt);return i!=null?W(i,n.spatialReference):null}const bt=x(0,0,0),B=E(),q=E();function Ee(e,t,n,i){const o=t.mapToLocalMultiple(e);let r=null,s=null;if(n)r=o[0],s=o[1];else{const h=o[0],v=o[1],b=Math.round(v.x-h.x),w=Math.round(v.y-h.y),$=Math.max(Math.abs(b),Math.abs(w));r=x(b>0?h.x+$/2:h.x-$/2,w>0?h.y+$/2:h.y-$/2),s=x(Math.abs(b)>Math.abs(w)?r.x-$/2:r.x,Math.abs(b)>Math.abs(w)?r.y:r.y-$/2)}const c=t.localToMap(r),a=t.localToMap(s);if(c==null||a==null)return null;t.doUnnormalization&&ei([[c,a]],t.spatialReference);const u=W(c,t.spatialReference),d=W(a,t.spatialReference),m=Qt(t.spatialReference);let f=0;if(We(t.spatialReference))f=m*li(u,d);else{const h=r.x-s.x,v=r.y-s.y;f=m*Math.sqrt(h*h+v*v)*1}const y=new no({center:u,radius:f,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:ft(y.rings,y.spatialReference,!1),center:u,edge:d}}function lo(e,t,n){const i=t.mapToLocalMultiple(e),o=i[0],r=i[1],s=Math.round(r.x-o.x),c=Math.round(r.y-o.y),a=x(n?o.x:o.x+s/2,n?o.y:o.y+c/2),u=n?s:s/2,d=n?c:c/2,m=60,f=[],y=2*Math.PI/m;function h(P){const it=Math.cos(P),yt=Math.sin(P);return x(u*it+a.x,d*yt+a.y)}for(let P=0;P<m;P++)f.push(h(P*y));f.push(f[0]);const{spatialReference:v,doUnnormalization:b}=t,w=ft([f.map((P=>t.localToMap(P))).filter(mt)],v,b,!1),$=t.localToMap(h(Math.PI/2)),C=t.localToMap(h(0)),z=t.localToMap(h(-Math.PI/2)),G=t.localToMap(h(Math.PI));return{geometry:w,midpoints:$!=null&&C!=null&&z!=null&&G!=null?{top:W($,v),right:W(C,v),bottom:W(z,v),left:W(G,v)}:null}}function et(e,t,n){if(e==null)return"noTool";switch(e){case"point":return co();case"multipoint":return"multipoint";case"polyline":return po(t,n);case"polygon":return uo(t,n);case"rectangle":case"circle":return ho(t,n);default:return}}function co(e){return"point"}function po(e,t){const n=e!=null&&e.type==="polyline"&&e.paths.length?e.paths[0].length:0;return t==="freehand"?n<2?"freehandStart":"freehandEnd":n<2?"polylineZeroVertices":"polylineOneVertex"}function uo(e,t){const n=e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0;if(n<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(n<4)return t==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function ho(e,t){if((e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function mo(e,t){const n=e?.geometry;if(!e||n?.type!=="mesh"||!t)return;const{renderCoordsHelper:i,elevationProvider:o}=t,{camera:r}=t.state,{extent:s}=n,{center:c,spatialReference:a}=s,u=Qt(a),d=se(a),m=Qt(i.spatialReference),f=s.width*u,y=s.height*d,h=(s.zmax??0)*d,v=h-(s.zmin??0)*d,b=Math.max(f,y,v)/m,{x:w,y:$}=c,C=c.z??0;je($t,w,$,C),i.toRenderCoords($t,a,$t);const z=b/r.computeScreenPixelSizeAt($t);if(z>r.width*fo)return"meshTooClose";if(z<go)return"meshTooFar";const G=yi(e),{absoluteZ:P}=vi(w,$,h,a,t,G);return P<(o.getElevation(w,$,C,a,"ground")??0)*d+v*yo?"meshUnderground":"mesh"}const go=20,fo=1,yo=.1,$t=E();function vo(e,t,n,i,o,r){let s="geodesic",c=ai(n);const a=tt();return ae(e,t,i,a),a[2]=0,c&&At(a,n,a,c)||(s="euclidean",c=n),{mode:s,view:t,elevationInfo:i,hasZ:o,directionMode:r,spatialReference:e.spatialReference,measurementSR:c,origin:a}}function _o(e,t,n){if(t==null||e==null)return;const i=qn(n.measurementSR);if(i==null)return;const o=Gt(e,n);if(o==null)return;const r=It(t,i);return new ki(o,r)}function wo(e,t,n,i){if(n==null||e==null)return;const o=Gt(e,i);if(o==null)return;const r=J(n),s=10,c=u=>{if(u==null)return;const d=tt(),m=gi(u,"degrees","geographic");return Ui(d,o,i.measurementSR,s,m,i.mode)?new Ii(o,d):void 0},a=()=>{if(t!=null&&e!=null)return J(nn(t,e))};switch(i.directionMode){case Q.Absolute:return c(r);case Q.Relative:{const u=a();return u==null?void 0:c(u+r)}case Q.RelativeBilateral:{const u=a();return u==null?void 0:en([c(u+r),c(u-r)])}}}function pn(e,t){const n=Ft(e,t);return n!=null?new Vi(n):void 0}function un(e,t,n){const{context:i,longitude:o,latitude:r,direction:s,distance:c,elevation:a}=n;if(o!=null||r!=null||c!=null||a!=null||s!=null){if(o!=null||r!=null){const u=J(o),d=J(r),m=Ft(a,i);return new tn(u,d,m)}return xo(e,t,n)}}function xo(e,t,{context:n,direction:i,distance:o,elevation:r}){if(t==null)return pn(r,n);const{view:s,elevationInfo:c,measurementSR:a}=n,u=ae(t,s,c);if(!a||!At(u,t.spatialReference,Ce,a))return;const[d,m]=Ce,f=o!=null?It(o,"meters"):void 0,y=J(i),h=Ft(r,n),v=w=>{const $=new Ai([d,m],a,f,h,w);return f==null||w==null||h==null&&n.hasZ?$:new zi($.closestTo(u))};if(y==null)return v(void 0);const b=()=>{if(e!=null&&t!=null)return J(nn(e,t))};switch(n.directionMode){case Q.Absolute:return v(y);case Q.Relative:{const w=b();return w==null?void 0:v(w+y)}case Q.RelativeBilateral:{const w=b();return w==null?void 0:en([v(w+y),v(w-y)])}}}function bo(e){return e.context.mode==="geodesic"?un(null,null,e):dn(e)}function $o(e,t,n){const{context:i,x:o,y:r,distance:s,direction:c,elevation:a}=n;return i.mode==="geodesic"?un(t,e,n):o!=null||r!=null?dn(n):Mo([_o(e,s,i),wo(e,t,c,i),pn(a,i)])}function dn({x:e,y:t,elevation:n,context:i}){Mt.x=e?.value??0,Mt.y=t?.value??0,Mt.spatialReference=i.spatialReference;const o=Gt(Mt,i,Po);return new tn(e!=null&&o!=null?o[0]:void 0,t!=null&&o!=null?o[1]:void 0,Ft(n,i))}function Mo(e){let t;for(const n of e)n&&(t=t?.intersect(n)??n);return t}function Gt(e,t,n=tt()){const{view:i,elevationInfo:o,measurementSR:r,origin:s,mode:c}=t;if(ae(e,i,o,n),At(n,e.spatialReference,n,r))return c!=="geodesic"&&Ne(n,n,s),n}function So(e,t,n,i){const{view:o,measurementSR:r,spatialReference:s,origin:c,mode:a}=n;if(a==="geodesic"?ti(at,e):Pt(at,e,c),At(at,r,at,s))return Ri(at,o,t,n,i)}function Ft(e,t){return To(e,t)?.value??void 0}function To(e,{view:t,origin:n,elevationInfo:i,hasZ:o,measurementSR:r}){if(e==null||!o)return;const s=Yn(r);if(s==null)return;const[c,a]=n,u=It(e,s),d=t?.type==="3d"?Ye(t,c,a,u,r,i):u;return d!=null?qe(d,s):void 0}const Ce=tt(),Po=tt(),at=tt(),Mt=ce(0,0,0,re.WGS84);let k=class extends j{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=dt}get allFields(){return[]}};l([p()],k.prototype,"type",void 0),l([p()],k.prototype,"radius",void 0),l([p()],k.prototype,"xSize",void 0),l([p()],k.prototype,"ySize",void 0),l([p()],k.prototype,"area",void 0),l([p()],k.prototype,"helpMessage",void 0),l([p()],k.prototype,"allFields",null),k=l([S("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],k);let lt=class extends gt(j){constructor(t){super(t),this.type="draw-mesh",this.orientation=wi({lockable:!1}),this.scale=xi({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};l([p()],lt.prototype,"helpMessage",void 0),l([p()],lt.prototype,"allFields",null),lt=l([S("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],lt);let ct=class extends gt(j){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};l([p()],ct.prototype,"helpMessage",void 0),l([p()],ct.prototype,"allFields",null),ct=l([S("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],ct);let pt=class extends gt(j){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};l([p()],pt.prototype,"helpMessage",void 0),l([p()],pt.prototype,"allFields",null),pt=l([S("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],pt);let Y=class extends gt(j){constructor(t){super(t),this.type="draw-polygon",this.direction=Qe(),this.distance=Je(),this.area=bi(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};l([p()],Y.prototype,"xyMode",void 0),l([p()],Y.prototype,"helpMessage",void 0),l([p()],Y.prototype,"allFields",null),Y=l([S("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],Y);let X=class extends gt(j){constructor(t){super(t),this.type="draw-polyline",this.direction=Qe(),this.distance=Je(),this.totalLength=$i(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};l([p()],X.prototype,"helpMessage",void 0),l([p()],X.prototype,"xyMode",void 0),l([p()],X.prototype,"allFields",null),X=l([S("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],X);let U=class extends j{constructor(t){super(t),this.type="draw-rectangle",this.xSize=N,this.ySize=N,this.area=dt}get allFields(){return[]}};l([p()],U.prototype,"type",void 0),l([p()],U.prototype,"xSize",void 0),l([p()],U.prototype,"ySize",void 0),l([p()],U.prototype,"area",void 0),l([p()],U.prototype,"helpMessage",void 0),l([p()],U.prototype,"allFields",null),U=l([S("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],U);function Oo(e,t){return{point:new pt({sketchOptions:t,viewType:e}),multipoint:new ct({sketchOptions:t,viewType:e}),polyline:new X({sketchOptions:t,viewType:e}),polygon:new Y({sketchOptions:t,viewType:e}),mesh:new lt({sketchOptions:t,viewType:e}),rectangle:new U({sketchOptions:t}),circle:new k({sketchOptions:t})}}function Re(e){const{directionOptions:t,geometryType:n,sketchOptions:i,tooltipInfos:o}=e,r=c=>{const a=Ht(e).mode,u=o[c].elevation;a==="relative-to-ground"||a==="relative-to-scene"||a==="on-the-ground"?u.lock(de(e)):u.unlock()},s=c=>{if(t){const a=o[c].direction;a.committed=t.angle,a.unlockOnVertexPlacement=!1,i.values.directionMode=t.mode}};switch(n){case"polygon":case"polyline":r(n),s(n);break;case"point":case"mesh":r(n)}}function Eo(e,t){const{drawOperation:n,view:i}=t,o=pe(t),r=Ht(t);if(i.type==="2d"||!e||r.mode!=="absolute-height"||n?.numCommittedVertices!==1||!o||o.type!=="draw-polyline"&&o.type!=="draw-polygon"||o.elevation.locked)return;const[s,c,a]=e,u=Zo(s,c,a,r,t);u!=null&&o.elevation.lock(u)}function ke(e){pe(e)?.allFields.forEach((t=>{t.unlockOnVertexPlacement&&t.unlock()}))}function pe({geometryType:e,graphic:t,tooltipInfos:n}){return t?.geometry?.type!==Co[e]?e==="circle"||e==="rectangle"?n[e]:null:n[e]}const Co={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function Ro(e,t){switch(e?.type){case"draw-point":ko(e,t);break;case"draw-multipoint":Vo(e,t);break;case"draw-polyline":Uo(e,t);break;case"draw-polygon":Ao(e,t);break;case"draw-rectangle":Do(e,t);break;case"draw-circle":Go(e,t);break;case"draw-mesh":Io(e,t)}}function ko(e,t){const n=t.graphic?.geometry;n?.type==="point"&&(ue(e,n,t),e.helpMessage=et("point",n,t.drawOperation.drawingMode))}function Vo(e,t){const n=t.graphic?.geometry;n?.type==="multipoint"&&(ue(e,n,t),e.helpMessage=et("multipoint",n,t.drawOperation.drawingMode))}function Io(e,t){const{graphic:n,view:i}=t,o=n?.geometry;i.type!=="3d"||o&&o.type!=="mesh"||(ue(e,o?.origin,t),o&&In(e,o),e.helpMessage=mo(n,i))}function ue(e,t,n){const{drawOperation:i,view:o,sketchOptions:r}=n,{cursorVertex:s}=i;e.sketchOptions=r,e.viewType=o.type;const c=t?.type==="multipoint"?t.getPoint(t.points.length-1):t;if(e.setLocationFromPoint(c,nt(n)),mn(e.elevation,n),!s)return void(i.constraints=void 0);const a=s;i.constraints={context:vn(a,n),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}function Uo(e,t){const{createOperationGeometry:n,drawOperation:i,automaticLengthMeasurementUtils:o}=t,r=n!=null?n.full:null;r&&r.type!=="polyline"||(hn(e,t),e.totalLength.actual=i.lastVertex?(r?o.autoLength2D(r):null)??N:null,e.helpMessage=et("polyline",r,t.drawOperation.drawingMode))}function Ao(e,t){const{createOperationGeometry:n,drawOperation:i}=t,o=n!=null?n.full:null;o&&o.type!=="polygon"||(hn(e,t),e.area.actual=i.lastVertex?(o?t.automaticAreaMeasurementUtils.autoArea2D(o):null)??dt:null,e.helpMessage=et("polygon",o,t.drawOperation.drawingMode))}const Ve=Pn(V);function hn(e,t){const{drawOperation:n,sketchOptions:i,view:o,automaticLengthMeasurementUtils:r}=t,{cursorVertex:s,lastVertex:c,secondToLastVertex:a}=n,u=i.values.effectiveDirectionMode;e.sketchOptions=i,e.viewType=o.type;const d=c&&s?r.autoDistanceBetweenPoints2D(Ve(c),Ve(s))??N:null;if(e.distance.actual=d,e.distance.readOnly=c==null,e.direction.actual=null,e.direction.readOnly=!0,c&&s&&(u==="absolute"||a)){const y=Gi(a,c,s,u);e.direction.actual=y??fi,e.direction.readOnly=!1}e.setLocationFromPoint(s,nt(t)),mn(e.elevation,t);const m=zo(c,t);e.xyMode=m,e.direction.visible=m==="direction-distance",e.distance.visible=m==="direction-distance",e.effectiveX.visible=m==="coordinates",e.effectiveY.visible=m==="coordinates";const f=s??c;n.constraints=f?{context:vn(f,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function zo(e,{sketchOptions:t}){const n=t.tooltips.xyMode;return n==="auto"?e?"direction-distance":"coordinates":n}function Do(e,t){e.sketchOptions=t.sketchOptions,e.xSize=fn(t),e.ySize=yn(t),e.area=gn(t),e.helpMessage=et("rectangle",t.graphic?.geometry,t.drawOperation.drawingMode)}function Go(e,t){const{forceUniformSize:n,sketchOptions:i}=t;e.sketchOptions=i,e.radius=n?Fo(t):null,e.xSize=n?null:fn(t),e.ySize=n?null:yn(t),e.area=gn(t),e.helpMessage=et("circle",t.graphic?.geometry,t.drawOperation.drawingMode)}function mn(e,t){const{drawOperation:n}=t,i=n?.cursorVertex??n?.lastVertex;e.actual=Fi(i)??de(t),e.visible=n.hasZ,e.readOnly=!1,e.showAsZ=!0}function gn(e){const t=e.createOperationGeometry?.full;return t?.type!=="polygon"?dt:e.automaticAreaMeasurementUtils.autoArea2D(t)??dt}function fn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){const n=e?.rectangle?.midpoints;return(n!=null?t.autoDistanceBetweenPoints2D(n.left,n.right):null)??N}function yn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){const n=e?.rectangle?.midpoints;return(n!=null?t.autoDistanceBetweenPoints2D(n.top,n.bottom):null)??N}function Fo({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){return(e?.circle?.center!=null&&e.circle.edge!=null?t.autoDistanceBetweenPoints2D(e.circle.center,e.circle.edge):null)??N}function Ho(e){const{geometryType:t,tooltipInfos:n}=e;switch(t){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const i=n[t].elevation.committed;return i?It(i,"meters")/se(nt(e)):void 0}default:return}}function Zo(e,t,n,i,o){const{view:r,drawOperation:s}=o;if(r.type!=="3d"||!s)return;n??=0;const c=nt(o),a=Ht(o),u=Ye(r,e,t,n,c,a,i);return Di(u,c)??de(o)}function Ht(e){return e.drawOperation.elevationInfo??Xe}function nt(e){return e.drawOperation.coordinateHelper.spatialReference}function de(e){const t=se(nt(e));return qe(e.defaultZ*t,"meters")}function vn(e,t){return vo(e,t.view,nt(t),Ht(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var L;(function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"})(L||(L={}));let Lo=class{constructor(){this._isToolEditable=!0,this._manipulators=new Xt,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,n=L.WhenToolEditable){this.addMany([t],n)}addMany(t,n=L.WhenToolEditable){for(const i of t){const o={manipulator:i,visibilityPredicate:n,attached:!1};this._manipulators.add(o),this._attached&&this._updateManipulatorAttachment(o)}}remove(t){for(let n=0;n<this._manipulators.length;n++)if(this._manipulators.at(n).manipulator===t){const i=this._manipulators.splice(n,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((t=>{this._updateManipulatorAttachment(t)})),this._attached=!0}detach(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((({manipulator:t})=>t.destroy())),this._manipulators.destroy(),this._resourceContexts=null}on(t,n){return this._manipulators.on(t,(i=>{n(i)}))}forEach(t){for(const n of this._manipulators.items)t(n)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach((n=>t.push(n.manipulator))),t}intersect(t,n){let i=null,o=Number.MAX_VALUE;return this._manipulators.forEach((({manipulator:r,attached:s})=>{if(!s||!r.interactive)return;const c=r.intersectionDistance(t,n);c!=null&&c<o&&(o=c,i=r)})),i}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const n=t.manipulator;n.grabbing=!1,n.dragging=!1,n.hovering=!1,n.selected=!1,n.detach&&n.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===L.Always||(this._isToolEditable?t.visibilityPredicate===L.WhenToolEditable:t.visibilityPredicate===L.WhenToolNotEditable)}},M=class extends Vt.EventedAccessor{constructor(e){super(e),this.manipulators=new Lo,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[F.MANAGER,!0],[F.USER,!0]]),this._creationFinishedResolver=On()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(F.USER)}set editable(e){this.setEditableFlag(F.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}cancel(){this.emit("cancel")}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===F.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach((({manipulator:n})=>{n.dragging&&(t=!0,n.events.emit("drag",{action:"end",start:e,screenPoint:e}))})),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(F.USER)&&this.getEditableFlag(F.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};l([p({constructOnly:!0})],M.prototype,"view",void 0),l([p({readOnly:!0})],M.prototype,"active",null),l([p({value:!0})],M.prototype,"visible",null),l([p({value:!0})],M.prototype,"editable",null),l([p({readOnly:!0})],M.prototype,"manipulators",void 0),l([p({readOnly:!0})],M.prototype,"updating",null),l([p()],M.prototype,"cursor",null),l([p({readOnly:!0})],M.prototype,"automaticManipulatorSelection",void 0),l([p()],M.prototype,"hasFocusedManipulators",null),l([p()],M.prototype,"hasGrabbedManipulators",void 0),l([p()],M.prototype,"hasHoveredManipulators",void 0),l([p()],M.prototype,"firstGrabbedManipulator",void 0),l([p({readOnly:!0})],M.prototype,"created",void 0),l([p({readOnly:!0})],M.prototype,"removeIncompleteOnCancel",void 0),M=l([S("esri.views.interactive.InteractiveToolBase")],M);let _=class extends Vt.EventedMixin(M){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new on}initialize(){const{view:t}=this;this.internalGraphicsLayer=new Gn({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const n=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Oo(t.type,this.sketchOptions);const i=Un((()=>({view:t,options:this.sketchOptions.tooltips})));this.tooltip=i,Re(this._tooltipsContext),this._coordinateFormatterLoadTask=Vn((()=>An())),this.addHandles([n.on("vertex-add",(o=>this.onVertexAdd(o))),n.on("vertex-remove",(o=>this.onVertexRemove(o))),n.on("vertex-update",(o=>this.onVertexUpdate(o))),n.on("cursor-update",(o=>this.onCursorUpdate(o))),n.on("cursor-remove",(()=>this._updateGraphic())),n.on("complete",(o=>this.onComplete(o))),this._coordinateFormatterLoadTask,i.on("paste",(o=>zn(o,this.activeTooltipInfo))),Z((()=>this.cursor),(o=>{n.cursor=o}),St),me((()=>{const{activeTooltipInfo:o,sketchOptions:r}=this;Ro(o,this._tooltipsContext),i.info=r.tooltips.effectiveEnabled?o:null})),me((()=>{n.constraintZ=Ho(this._tooltipsContext)}),Rn)]),this.finishToolCreation()}destroy(){this.drawOperation=K(this.drawOperation),this.tooltip=K(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=K(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:t,directionOptions:n,drawOperation:i,forceUniformSize:o,geometryType:r,graphic:s,sketchOptions:c,tooltipInfos:a,view:u,automaticAreaMeasurementUtils:d,automaticLengthMeasurementUtils:m}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:t,directionOptions:n,drawOperation:i,forceUniformSize:o,geometryType:r,graphic:s,sketchOptions:c,tooltipInfos:a,view:u,automaticAreaMeasurementUtils:d,automaticLengthMeasurementUtils:m}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const n=this.drawOperation;n&&(n.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:n}}=this;return t==="2d"&&n&&"undoRedo"in n&&n.undoRedo instanceof R?n.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||Dn(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Re(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(O.outline),this.removeHandles(O.regularVertices),this.removeHandles(O.activeVertex),this.removeHandles(O.activeEdge),this.removeHandles(Nt)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const n=new Cn({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=n,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(n),this.addHandles(this.initializeGraphic(n)),this.notifyChange("graphic"),this.addHandles(vt((()=>{this.internalGraphicsLayer.remove(n),this._graphic===n&&(this._graphic=null)})),Nt),n}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(this.drawOperation==null)return;const{coordinateHelper:n,view:i,visualizationCursorVertex:o,lastVertex:r,committedVertices:s,geometryIncludingUncommittedVertices:c,numCommittedVertices:a}=this.drawOperation;if(!(a>0||o!=null))return;const u=t.operationComplete?s:c,d=u.length,m=o!=null?n.pointToArray(o):null,f=this._drawSpatialReference,y=i.type==="3d"&&i.viewingMode==="global",h=new eo;h.committedVertices=s,h.cursorVertex=m;const{geometryType:v}=this;switch(v){case"point":case"mesh":h.full=n.arrayToPoint(u[0]);break;case"multipoint":h.full=d>0?so(u,f):null;break;case"polyline":case"polygon":d>0&&(h.full=v==="polygon"?ft([u],f,y,!0):Pe([u],f,y),h.cursorEdge=m!=null&&r&&!ut(o,r)?Pe([[m,n.pointToArray(r)]],f,y):null,h.outline=d>1?h.full:null);break;case"circle":case"rectangle":{if(h.committedVertices=h.cursorVertex=null,!d)break;const b=ro(i,u[0]),w=u[0],$=b.makeMapPoint(w[0]+Wo*i.resolution,w[1]);v==="circle"?d===1&&t.operationComplete?h.circle=Ee([w,$],b,!0):d===2&&(this.forceUniformSize?h.circle=Ee(u,b,this.centered):h.rectangle=lo(u,b,this.centered)):d===1&&t.operationComplete?h.rectangle=Oe([w,$],b,!0):d===2&&(h.rectangle=this.forceUniformSize?Oe(u,b,this.centered):ao(u,b,this.centered)),h.full=h.circle!=null?h.circle.geometry:h.rectangle?.geometry,h.outline=h.full?.type==="polygon"?h.full:null;break}default:return null}return h}initializeGraphic(t){return vt()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let n=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(n=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:n,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return vt()}onCursorEdgeChanged(t){return vt()}onVertexAdd(t){ke(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||Eo(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){ke(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),O.activeEdge):this.removeHandles(O.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),O.outline):this.removeHandles(O.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),O.regularVertices):this.removeHandles(O.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),O.activeVertex):this.removeHandles(O.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(Nt)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?pe(this._tooltipsContext):null}};l([p()],_.prototype,"_coordinateFormatterLoadTask",void 0),l([p()],_.prototype,"_createOperationGeometry",void 0),l([p()],_.prototype,"_tooltipsContext",null),l([p({value:!0})],_.prototype,"centered",null),l([p()],_.prototype,"cursor",null),l([p({nonNullable:!0})],_.prototype,"defaultZ",void 0),l([p({constructOnly:!0})],_.prototype,"directionOptions",void 0),l([p()],_.prototype,"drawOperation",void 0),l([p()],_.prototype,"elevationLockOnVertexAddDisabled",void 0),l([p({value:!0})],_.prototype,"enabled",null),l([p({value:!0})],_.prototype,"forceUniformSize",null),l([p({constructOnly:!0})],_.prototype,"geometryType",void 0),l([p()],_.prototype,"graphic",null),l([p({constructOnly:!0})],_.prototype,"graphicProperties",void 0),l([p()],_.prototype,"graphicSymbol",null),l([p({constructOnly:!0})],_.prototype,"hasZ",void 0),l([p({constructOnly:!0})],_.prototype,"geometryToPlace",void 0),l([p()],_.prototype,"mode",null),l([p()],_.prototype,"snappingManager",void 0),l([p()],_.prototype,"snapToScene",void 0),l([p()],_.prototype,"tooltip",void 0),l([p()],_.prototype,"tooltipInfos",void 0),l([p({constructOnly:!0,type:on})],_.prototype,"sketchOptions",void 0),l([p()],_.prototype,"updating",null),l([p({constructOnly:!0,nonNullable:!0})],_.prototype,"view",void 0),l([p({constructOnly:!0})],_.prototype,"automaticAreaMeasurementUtils",void 0),l([p({constructOnly:!0})],_.prototype,"automaticLengthMeasurementUtils",void 0),l([p({constructOnly:!0})],_.prototype,"undoRedo",null),l([p()],_.prototype,"activeTooltipInfo",null),_=l([S("esri.views.draw.DrawGraphicTool")],_);const Nt=Symbol("create-operation-graphic"),O={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function hs(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Wo=48,_n="click";class No{constructor({consumesClicks:t,grabbableForEvent:n}){this.events=new Vt,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=t,this.grabbableForEvent=n}destroy(){}intersectionDistance(t,n){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}function jo(e,t){let n=null,i=null;return o=>{if(o.action==="cancel")return void(i!=null&&(i.execute({action:"cancel"}),n=null,i=null));const r={action:o.action,screenStart:o.start,screenEnd:o.screenPoint};o.action==="start"&&n==null&&(n=new ht,i=new ht,t(e,n,i,o.pointerType,r)),n?.execute(r),o.action==="end"&&n!=null&&(n=null,i=null)}}function jt(e,t){return e.events.on("drag",jo(e,t))}function ms(e,t){const n=[e.x,e.y,e.z??0],i=t,o=[Math.cos(i),Math.sin(i)],r=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(r===0)return null;o[0]/=r,o[1]/=r;const s=c=>{const a=(c.x-n[0])*o[0]+(c.y-n[1])*o[1];c.x=n[0]+a*o[0],c.y=n[1]+a*o[1]};return c=>(s(c.mapStart),s(c.mapEnd),{...c,axis:o})}function Bo(e){let t=null;return n=>{if(n.action==="start"&&(t=qo(e,n.mapStart.spatialReference)),t==null)return null;const i=n.mapEnd.x-n.mapStart.x,o=n.mapEnd.y-n.mapStart.y,r=(n.mapEnd.z??0)-(n.mapStart.z??0);return t.move(i,o,r,n.action),{...n,translationX:i,translationY:o,translationZ:r}}}function Ie(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():Et(e,t)}function qo(e,t){const n=e.operations;if(!n)return null;const i=n.data.geometry,o=qi(t);if(i.spatialReference.equals(o))return Bt(e,n,(()=>{}));if(i.type!=="mesh"){const r=Ie(i,o);if(r==null)return null;const s=i.spatialReference;return Bt(e,te.fromGeometry(r,n.viewingMode),(()=>{const c=Et(i,s);n.trySetGeometry(c)}))}if(Bi(i)){const r=Ie(i.origin,o);if(!r)return null;const s=i.spatialReference,c=te.fromGeometry(r,n.viewingMode);return Bt(e,n,(()=>{const a=Et(c.data.geometry,s),u=a.x-i.origin.x,d=a.y-i.origin.y,m=(a.z??0)-(i.origin.z??0);n.move(u,d,m)}))}return null}function Bt(e,t,n){let i=0,o=0,r=0;return{move:(s,c,a,u)=>{u==="start"&&(i=0,o=0,r=0);const d=s-i,m=c-o,f=a-r;t.move(d,m,f),i+=d,o+=m,r+=f,n(),u==="end"&&e.endInteraction?.()}}}function gs(e,t=null,n){let i=null;const o=t==null||e.spatialReference?.equals(t)?s=>s:s=>s!=null?Et(s,t):s,r={exclude:[],...n};return s=>{if(s.action==="start"&&(i=o(e.toMap(s.screenStart,r))),i==null)return null;const c=o(e.toMap(s.screenEnd,r));return c!=null?{...s,mapStart:i,mapEnd:c}:null}}function fs(e){const t=e.map((n=>Bo(n))).filter(mt);return n=>{const i=n.mapEnd.x-n.mapStart.x,o=n.mapEnd.y-n.mapStart.y,r=n.mapEnd.z-n.mapStart.z;return t.forEach((s=>s(n))),{...n,translationX:i,translationY:o,translationZ:r}}}function Yo(e){const t=e.operations?.createResetState();return n=>(t?.remove(),n)}function ys(e){const t=e.map((n=>Yo(n))).filter((n=>n!=null));return n=>(t.forEach((i=>i(n))),n)}function vs(){let e=0,t=0,n=0;return i=>{i.action==="start"&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z);const o=i.mapEnd.x-e,r=i.mapEnd.y-t,s=i.mapEnd.z-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,{...i,mapDeltaX:o,mapDeltaY:r,mapDeltaZ:s,mapDeltaSpatialReference:i.mapStart.spatialReference}}}function _s(){let e=0,t=0;return n=>{n.action==="start"&&(e=n.screenStart.x,t=n.screenStart.y);const i=n.screenEnd.x-e,o=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:i,screenDeltaY:o}}}function ws(e,t){let n=null,i=0,o=0;return r=>{if(r.action==="start"&&(n=e.toScreen?.(t),n!=null&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=r.screenStart.x-n.x,o=r.screenStart.y-n.y))),n==null)return null;const s=be(r.screenEnd.x-i,0,e.width),c=be(r.screenEnd.y-o,0,e.height),a=le(s,c);return r.screenStart=n,r.screenEnd=a,r}}const Xo=()=>{};class ht{constructor(){this.execute=Xo}next(t,n=new ht){return t!=null&&(this.execute=i=>{const o=t(i);o!=null&&n.execute(o)}),n}}function Ko(e,t,n=[]){if(e.type==="2d")return o=>o;let i=null;return o=>{o.action==="start"&&(i=e.toMap(o.screenStart,{exclude:n}),i!=null&&(i.z=Ot(i,e,t)));const r=e.toMap(o.screenEnd,{exclude:n});r!=null&&(r.z=Ot(r,e,t));const s=i!=null&&r!=null?{sceneStart:i,sceneEnd:r}:null;return{...o,scenePoints:s}}}function Ue(e,t,n){const i=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,o=Ut(e);return o.z=i,o.hasZ=!0,o.z=Ot(o,t,n),o}function xs(e,t){if(e.type==="2d")return i=>i;let n=null;return i=>{i.action==="start"&&(n=Ue(i.mapStart,e,t));const o=Ue(i.mapEnd,e,t),r=n!=null&&o!=null?{sceneStart:n,sceneEnd:o}:null;return{...i,scenePoints:r}}}function Qo({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:i,useZ:o=!0}){const r=new ht;if(t==null)return{snappingStep:[Ae,r],cancelSnapping:Ae};let s,c=null,a=null,u=null;const d=()=>{c=qt(c),t.doneSnapping(),a?.frameTask.remove(),a=null,s=Fe(s),u=null},m=Jo(t,o,r);let f=null,y=null,h=null;return{snappingStep:[v=>{if(!e(v))return v;const{action:b}=v;if(b==="start"){const{info:w}=v,$=tr(t.view);if(a=er(n,v,$),a.context.selfSnappingZ=null,!o&&w!=null){const C=ir(n.coordinateHelper,w.handle.component);C!=null&&(a.context.selfSnappingZ={value:C,elevationInfo:n.elevationInfo??Xe})}}if(a!=null){const{context:w,originalScenePos:$,originalPos:C}=a,{mapEnd:z,mapStart:G,scenePoints:P}=v,it=wn(C,oe(z,G)),yt=oe(G,C),$n={...v,action:"update"},Mn=a.context,Zt=nr($,P),he=t.update({point:it,scenePoint:Zt,context:w});if(h=he,xn(z,he,yt,o),f=it,y=Zt,b!=="end"){const{frameTask:Sn}=a;c==null&&(c=new AbortController),u=Tn=>{i.addPromise(Yt(m({frameTask:Sn,event:$n,context:Mn,point:it,scenePoint:Zt,delta:yt,getLastState:()=>({point:f,scenePoint:y,updatePoint:Tn.forceUpdate?null:h})},c.signal)))},u({forceUpdate:!1}),s==null&&(s=Z((()=>t.options.effectiveEnabled),(()=>u?.({forceUpdate:!0}))))}}return b==="end"&&d(),v},r],cancelSnapping:v=>(d(),v)}}function Jo(e,t,n){return He((async({frameTask:i,point:o,scenePoint:r,context:s,event:c,delta:a,getLastState:u},d)=>{const m=await i.schedule((()=>e.snap({point:o,scenePoint:r,context:s,signal:d})),d);if(m.valid){let f=await i.schedule((()=>m.apply()),d);const y=u();y.point!=null&&o!==y.point&&(f=e.update({point:y.point,scenePoint:y.scenePoint,context:s})),y.updatePoint!=null&&ut(f,y.updatePoint)||(xn(c.mapEnd,f,a,t),n.execute(c))}}))}function tr(e){return e.type==="3d"?e.resourceController.scheduler.registerTask(an.SNAPPING):sn}function er(e,t,n){return{context:new ee({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info!=null?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin!=null?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:t.scenePoints!=null?t.scenePoints.sceneStart:null,frameTask:n}}function wn(e,[t,n,i]){const o=Ut(e);return o.x+=t,o.y+=n,o.hasZ&&(o.z+=i),o}function nr(e,t){return e==null||t==null?null:wn(e,oe(t.sceneEnd,t.sceneStart))}function oe(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function xn(e,t,[n,i,o],r){e.x=t.x+n,e.y=t.y+i,r&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function ir(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const o of n){const r=e.getZ(o.pos);if(i!=null&&r!=null&&Math.abs(r-i)>1e-6)return null;i==null&&(i=r)}return i}function Ae(e){return e}let H=class extends kt{constructor(e){super(e),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=He((async(t,n,i,o)=>{const r=this._frameTask;if(r==null)return;const s=await r.schedule((()=>n.snap({...t,context:i,signal:o})),o);s.valid&&await r.schedule((()=>{this.stagedPoint=s.apply(),t!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=n.update({...this._snapPoints,context:i}))}),o)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e=this.view.type==="3d"?this.view?.resourceController?.scheduler:null;this._frameTask=e!=null?e.registerTask(an.SNAPPING):sn}destroy(){this._abortController=qt(this._abortController),this._frameTask=Fe(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:o}=e,r=t.update({point:i,scenePoint:o,context:n});return this.stagedPoint=r,r}async snap(e,t,n){const{point:i,scenePoint:o}=e;return this.stagedPoint=t.update({point:i,scenePoint:o,context:n}),this._snapPoints=e,this._abortController==null&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=qt(this._abortController),this._snapPoints=null}};l([p({constructOnly:!0})],H.prototype,"view",void 0),l([p()],H.prototype,"stagedPoint",null),l([p()],H.prototype,"constrainResult",void 0),l([p()],H.prototype,"_stagedPoint",void 0),H=l([S("esri.views.interactive.snapping.SnappingOperation")],H);const or="crosshair",rr="progress",ze=Symbol(),De=Symbol();let g=class extends Vt.EventedMixin(kt){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Li,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Ze,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=xe(bo),this._getPolylineOrPolygonConstraint=xe($o),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new rn,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,t.elevationInfo==null&&(this.elevationInfo=_i(!!t.hasZ))}initialize(){const{geometryType:t,view:n}=this,i=n.spatialReference,o="viewingMode"in n.state?n.state.viewingMode:ji.Local,r=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=Mi(this.hasZ,this.hasM,i),this._editGeometryOperations=new te(new Si(r,this.coordinateHelper),o),this._snappingOperation=new H({view:n}),this.addHandles([Z((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint})),(({stagedPoint:a,constraint:u},d)=>{const{snappingOptions:m}=this;if(m&&(m.forceDisabled=u!=null&&Hi(u)),d!=null&&a===d.stagedPoint&&u!==d.constraint)return this._onKeyboardBasedChange();this._processCursor(a??this._screenToMap(this._stagedScreenPoint))}),{equals:(a,u)=>a.stagedPoint===u.stagedPoint&&En(a.constraint,u.constraint)}),Z((()=>this.view.viewpoint),((a,u)=>{a&&u&&Ni(a,u)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new Ti(i,o),this._editGeometryOperations.data.components.push(this._activeComponent);const s=this.segmentLabels;s!=null&&(s.context={view:n,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},this.addHandles(Z((()=>this.labelOptions.enabled),(a=>{s.visible=a}),St))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(a=>{const u=a.vertices.map((h=>({componentIndex:0,vertexIndex:h.index,coordinates:this.coordinateHelper.vectorToArray(h.pos)}))),d=u.map((h=>h.coordinates)),m=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;ut(m,this.firstVertex)||(this.firstVertex=m);const f=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;ut(f,this.lastVertex)||(this.lastVertex=f);const y=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(ut(y,this.secondToLastVertex)||(this.secondToLastVertex=y),this._processCursor(this.cursorVertex),a.type){case"vertex-add":this.emit(a.type,{...a,added:d,vertices:u});break;case"vertex-update":this.emit(a.type,{...a,updated:d,vertices:u});break;case"vertex-remove":this.emit(a.type,{...a,removed:d,vertices:u})}})));const c=this._manipulator=new No({consumesClicks:!1,grabbableForEvent:a=>this.drawingMode!=="click"||a.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(c),c.grabbable=t!=="point"&&t!=="multipoint",this.addHandles([c.events.on("immediate-click",(a=>this._onImmediateClick(a))),c.events.on("immediate-double-click",(a=>this._onImmediateDoubleClick(a))),Z((()=>this.drawingMode),(()=>{this.removeHandles(ze),this.addHandles(this._createManipulatorDragPipeline(c),ze)}),St),Z((()=>({effectiveCursor:this.effectiveCursor})),(({effectiveCursor:a})=>{c.cursor=a}),St)]),Zi(this,(()=>{const a=this.view.inputManager.latestPointerType??"mouse",u=this._getSnappingContext(a);if(this.snappingManager!=null){const d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,u);this._updatingHandles.addPromise(Yt(d))}}))}destroy(){K(this.segmentLabels),K(this._snappingOperation),this._editGeometryOperations=K(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:t,_manipulator:n}=this;return t!=null&&this._pointerDownStates.has(t)||n.grabbing||!n.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((t=>this.coordinateHelper.vectorToArray(t.pos)))}get _constraint(){const{constraints:t,constraintsEnabled:n}=this;if(t&&n)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??_n)}get effectiveCursor(){return this.loading?rr:this._hideDefaultCursor?null:this.cursor||or}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:t,lastVertex:n,firstVertex:i,geometryType:o}=this;return o==="polygon"&&Wt(t,i)||Wt(t,n)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:t,committableVertex:n,coordinateHelper:i}=this,o=t.slice();return n!=null&&o.push(i.pointToArray(n)),o}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:t}=this;t!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){const n=t?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:i,numCommittedVertices:o}=this,r=i==="multipoint"&&o===0||i==="polyline"&&o<2||i==="polygon"&&o<3;i!=="segment"&&i!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!r,(this.isCompleted||n)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((s,c)=>({componentIndex:0,vertexIndex:c,coordinates:s}))),aborted:n,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){const n=Kt(this.cursorVertex),i=Kt(t),o=i&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(i)??i),r=this._snapToClosingVertex(o),s=this._applyConstraints(r);Wt(n,s)||(this._set("cursorVertex",s),this.segmentLabels?.set("stagedVertex",s!=null?this.coordinateHelper.pointToVector(s):null),s==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(s)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(t==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return t;const n=this._mapToScreen(t);if(!n)return t;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,n)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,n)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return jt(t,((n,i,o,r)=>{const s=r==="touch"&&this._snappingEnabled;if(this.isCompleted||!s)return;const{snappingStep:c,cancelSnapping:a}=Qo({predicate:()=>s,snappingManager:this.snappingManager,snappingContext:new ee({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});o=o.next((u=>(s&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),u))).next(a),i.next(this._screenToMapDragEventStep()).next((u=>(u.action==="start"&&(this._processCursor(u.mapStart),(this.geometryType==="segment"||s&&!this.numCommittedVertices)&&this.commitStagedVertex()),u))).next(Ko(this.view,this.elevationInfo)).next(...c).next((u=>(s&&(this._processCursor(u.mapEnd),u.action==="end"&&this.commitStagedVertex()),u))).next((u=>(u.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),u)))}))}_createManipulatorDragPipelineFreehand(t){return jt(t,((n,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next((o=>(o.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(o.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),o))).next((o=>{switch(o.action){case"start":case"update":this._processCursor(o.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return o}))}))}_createManipulatorDragPipelineHybrid(t){return jt(t,((n,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next((o=>(o.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),De),this._processCursor(o.mapStart),this.commitStagedVertex()),o))).next((o=>{switch(o.action){case"start":case"update":this._processCursor(o.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(De),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return o}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:t,constraintZ:n,geometryType:i,numCommittedVertices:o}=this;return t?n!=null||i==="segment"&&o>0:(i==="segment"||i==="polygon")&&o>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:t,coordinateHelper:n,drawSurface:i,elevationDrawSurface:o,snapToSceneEnabled:r}=this;if(o==null)return i;if(!this.hasZ)return o.defaultZ=null,o;const s=this.elevationInfo?.mode;let c=this.defaultZ,a=t||s==="absolute-height";return r!=null&&(a=r),s==="on-the-ground"&&(a=!1),this._drawAtFixedElevation&&(c=(t?this.constraintZ:null)??n.getZ(this._activeComponent.vertices[0].pos),a=!1),a?i:(o.defaultZ=c,o)}_mapToScreen(t){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging))try{const{drawingMode:n,geometryType:i}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;const o=this._screenToMap(t.screenPoint);if(o==null||o==null||n==="freehand"&&i!=="point"&&i!=="multipoint")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(o),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),t.pointerType!=="mouse"&&this._processCursor(null),(n==="freehand"&&this.geometryType!=="multipoint"||i==="point"||i==="segment"&&this.numCommittedVertices===2||i==="segment"&&n==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const n=le(t.x,t.y);this._stagedScreenPoint=n,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(n,t.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,n){const i=this._snappingOperation,o=this._screenToMap(t),r=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(o==null)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const s=this.snappingManager;if(s==null)return this._processCursor(o),void i.abort();const c=this._getSnappingContext(n);this._updatingHandles.addPromise(Yt(i.snap({point:o,scenePoint:r},s,c)))}_applyConstraints(t){const{_constraint:n,constraints:i}=this;if(!t||!i||!n)return t;const{context:o}=i,r=Gt(t,o),s=r?n.closestTo(r):void 0;if(!s)return t;const c=So(s,t,o),a=this.view.type==="2d"||o.elevationInfo.mode!=="absolute-height";return c!=null&&a&&this.constraintZ!=null&&this.hasZ&&(c.z=this.constraintZ),c}_screenToMap(t){return t?this._updateAndGetEffectiveDrawSurface()?.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return n=>{if(n.action==="start"&&(t=this._screenToMap(n.screenStart)),t==null)return null;const i=this._screenToMap(n.screenEnd);return i!=null?{...n,mapStart:t,mapEnd:i}:null}}_vertexWithinPointerDistance(t,n){const o=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return o!=null&&sr(o,n,25)}_getSnappingContext(t){const n=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new ee({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:n!=null?{value:n,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function sr(e,t,n){const i=e.x-t.x,o=e.y-t.y;return i*i+o*o<=n}l([p()],g.prototype,"_hideDefaultCursor",void 0),l([p()],g.prototype,"_stagedPointerId",void 0),l([p()],g.prototype,"_isDragging",null),l([p()],g.prototype,"_snappingOperation",void 0),l([p()],g.prototype,"_snappingEnabled",null),l([p({constructOnly:!0})],g.prototype,"graphic",void 0),l([p()],g.prototype,"constraintsEnabled",void 0),l([p()],g.prototype,"constraints",void 0),l([p()],g.prototype,"_constraint",null),l([p()],g.prototype,"constraintZ",void 0),l([p()],g.prototype,"defaultZ",void 0),l([p()],g.prototype,"isDraped",void 0),l([p({constructOnly:!0})],g.prototype,"automaticLengthMeasurementUtils",void 0),l([p({value:_n})],g.prototype,"drawingMode",null),l([p({constructOnly:!0})],g.prototype,"elevationDrawSurface",void 0),l([p({constructOnly:!0})],g.prototype,"elevationInfo",void 0),l([p({constructOnly:!0,type:rn})],g.prototype,"labelOptions",void 0),l([p({constructOnly:!0})],g.prototype,"geometryType",void 0),l([p({constructOnly:!0})],g.prototype,"hasM",void 0),l([p({constructOnly:!0})],g.prototype,"hasZ",void 0),l([p()],g.prototype,"cursor",void 0),l([p()],g.prototype,"effectiveCursor",null),l([p()],g.prototype,"loading",void 0),l([p({constructOnly:!0})],g.prototype,"manipulators",void 0),l([p({constructOnly:!0})],g.prototype,"drawSurface",void 0),l([p({constructOnly:!0})],g.prototype,"segmentLabels",void 0),l([p({constructOnly:!0})],g.prototype,"snappingManager",void 0),l([p({constructOnly:!0})],g.prototype,"snappingVisualizer",void 0),l([p()],g.prototype,"snapToSceneEnabled",void 0),l([p({readOnly:!0})],g.prototype,"cursorVertex",null),l([p({readOnly:!0})],g.prototype,"visualizationCursorVertex",null),l([p()],g.prototype,"committableVertex",null),l([p()],g.prototype,"firstVertex",void 0),l([p()],g.prototype,"lastVertex",void 0),l([p()],g.prototype,"secondToLastVertex",void 0),l([p()],g.prototype,"updating",null),l([p({constructOnly:!0})],g.prototype,"view",void 0),g=l([S("esri.views.draw.DrawOperation")],g);class $s{constructor(t,n,i,o=null){this._elevationInfo=t,this.defaultZ=n,this._view=i,this._excludeGraphics=o}screenToMap(t){const{defaultZ:n,_view:i}=this,o=i.sceneIntersectionHelper.intersectElevationFromScreen(Wi(t.x,t.y),this._elevationInfo,n??0,this._excludeGraphics);return n==null&&o!=null&&(o.z=void 0),o}mapToScreen(t){const n=ce(t.x,t.y,Ke(this._view,t,this._elevationInfo),t.spatialReference);return this._view.toScreen(n)}constrainZ(t){const{defaultZ:n}=this;return n!=null&&t.z!==n&&((t=Ut(t)).z=n),t}}class Ms{constructor(t,n,i=[]){this.view=t,this.elevationInfo=n,this.exclude=i}screenToMap(t){const n=this.view.toMap(t,{exclude:this.exclude,excludeLabels:!0});return n!=null&&(n.z=Ot(n,this.view,this.elevationInfo)),n}mapToScreen(t){let n=t;return this.elevationInfo!=null&&(n=ce(t.x,t.y,Ke(this.view,t,this.elevationInfo),t.spatialReference)),this.view.toScreen(n)}constrainZ(t){return t}}let Ss=class{constructor(t,n=!1,i=0){this.view=t,this.hasZ=n,this.defaultZ=i,this.mapToScreen=o=>t.toScreen(o),this.screenToMap=n?o=>{const r=t.toMap(o);return r.z=i,r}:o=>t.toMap(o)}constrainZ(t){const{defaultZ:n}=this;return this.hasZ&&t.z!==n&&((t=Ut(t)).z=n),t}};const Rt=class Rt{screenToMap(t){const{x:n,y:i}=t;return new V({x:n,y:i,spatialReference:Rt.spatialReference})}mapToScreen(t){return le(t.x,t.y)}constrainZ(t){return t}};Rt.spatialReference=new re;let Ge=Rt;function Ps(e,t){return bn(e,t,!1)}function Os(e,t){return bn(e,t,!0)}function bn(e,t,n){if(e instanceof Pi){if(e.operation instanceof Oi)return ar(e.operation,t,n),!0;if(e.operation instanceof Ei)return lr(e.operation,t,n),!0;if(e.operation instanceof Ci)return cr(e.operation,t,n),!0}return!1}function ar(e,t,n=!1){const i=n?-1:1,o=ri(i*e.dx,i*e.dy,i*e.dz);Pt(t.origin,t.origin,o),zt(t)}function lr(e,t,n=!1){const i=n?-e.angle:e.angle;ye(t.basis1,t.basis1,ve,i),ye(t.basis2,t.basis2,ve,i),zt(t)}function cr(e,t,n=!1){const i=n?1/e.factor1:e.factor1,o=n?1/e.factor2:e.factor2;Jt(t.basis1,t.basis1,i),Jt(t.basis2,t.basis2,o),Se(t.origin,t.origin,e.origin,e.axis1,i),Se(t.origin,t.origin,e.origin,e.axis2,o),zt(t)}function Es(e,t,n,i,o=!1){i||(i=Ji());const r=ot(rt.get(),e[1],-e[0]),s=ot(rt.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=ot(rt.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=rt.get(),u=t.allVertices;u.forEach((({pos:y})=>{ot(a,$e(e,y),$e(r,y)),Yi(s,s,a),Xi(c,c,a)}));const d=1e-6,m=ot(rt.get(),c[0]-s[0]<d?n/2:0,c[1]-s[1]<d?n/2:0);Ki(s,s,m),Qi(c,c,m);const f=o?u.reduce(((y,h)=>y+(h.pos[2]??0)),0)/u.length:0;return Me(i.basis1,e,(c[0]-s[0])/2),Me(i.basis2,r,(c[1]-s[1])/2),je(i.origin,s[0]*e[0]+s[1]*r[0],s[0]*e[1]+s[1]*r[1],f),Pt(i.origin,i.origin,i.basis1),Pt(i.origin,i.origin,i.basis2),zt(i),i}export{Ko as D,_ as E,g as F,xs as G,ws as M,Es as S,Os as T,hs as a,gs as b,$s as c,Ps as d,fs as e,Bo as f,Yo as g,Ss as h,Qo as i,_s as j,Ms as l,ms as m,M as n,jt as p,vs as v,ht as w,ys as z};
