import{a as L,f as Q,S,r as I,Q as V}from"./DUQhet5j.js";import{i as W}from"./BbNfuhIx.js";import{t as G,$ as J,b as K,c as X}from"./B2reeZpr.js";function Y(e){return e.__accessor__??null}function Tt(e,t){return e?.metadata?.[t]!=null}function bt(e,t,s){return s?$(e,t,{policy:s,path:""}):$(e,t,null)}function $(e,t,s){return t?Object.keys(t).reduce((i,n)=>{const a=n;if(a==="__proto__")return i;let r=null,l="merge";if(s&&(r=s.path?`${s.path}.${n}`:n,l=s.policy(r)),l==="replace"||l==="replace-arrays"&&Array.isArray(i[a]))return i[a]=t[a],i;if(i[a]===void 0)return i[a]=L(t[a]),i;let h=i[a],o=t[a];if(h===o)return i;if(Array.isArray(o)||Array.isArray(i))h=h?Array.isArray(h)?i[a]=h.slice():i[a]=[h]:i[a]=[],o&&(Array.isArray(o)||(o=[o]),o.forEach(m=>{h.includes(m)||h.push(m)}));else if(o&&typeof o=="object")if(s){const m=s.path;s.path=r,i[a]=$(h,o,s),s.path=m}else i[a]=$(h,o,null);else i.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(i[a]=o);return i},e||{}):e}function Z(e){return Array.isArray(e)?e:e.split(".")}function M(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function tt(e){if(Array.isArray(e)){const t=[];for(const s of e)t.push(...M(s));return t}return M(e)}function Dt(e,t,s,i){const n=tt(t);if(n.length!==1){const a=n.map(r=>i(e,r,s));return G(a)}return i(e,n[0],s)}const g={Dirty:1,Overridden:2,Computing:4,NonNullable:8,HasDefaultValue:16,DepTrackingInitialized:32,AutoTracked:64,ExplicitlyTracking:128};let et=class{constructor(t){this.accessed=void 0,this._handles=void 0,this._observer=t}destroy(){this.accessed?.clear(),this.clear()}onAccessed(t){this._observer!=null&&t!==this._observer&&(this.accessed==null&&(this.accessed=new Set),this.accessed.add(t))}onTrackingEnd(){this._observer!=null&&(this.clear(),this.accessed!=null&&(this._handles==null&&(this._handles=[]),this.accessed.forEach(t=>{this._handles.push(t.observe(this._observer))}),this.accessed.clear()))}clear(){if(this._handles!=null){for(let t=0;t<this._handles.length;++t)this._handles[t].remove();this._handles.length=0}}};const v=new et,d=[];let p=v;function st(e){p.onAccessed(e)}let A=!1,k=!1;function it(e,t,s){if(A)return F(e,t,s);let i=null;return q(e),i=t.call(s),N(),i}function Ft(e,t){return it(v,e,t)}function F(e,t,s){const i=A;A=!0,q(e);let n=null;try{n=t.call(s)}catch(a){k&&W.getLogger("esri.core.accessorSupport.tracking").error(a)}return N(),A=i,n}function q(e){p=e,d.push(e)}function N(){const e=d.length;if(e>1){const t=d.pop();p=d[e-2],t.onTrackingEnd()}else if(e===1){const t=d.pop();p=v,t.onTrackingEnd()}else p=v}function at(e,t){if(t.flags&g.DepTrackingInitialized)return;t.flags|=g.DepTrackingInitialized;const s=k;k=!1,t.flags&g.AutoTracked?F(t.trackingTarget,t.metadata.get,e):rt(e,t),k=s}const nt=[];function rt(e,t){t.flags&g.ExplicitlyTracking||(t.flags|=g.ExplicitlyTracking,F(t.trackingTarget,()=>{const s=t.metadata.dependsOn||nt;for(const i of s)if(typeof i!="string"||i.includes(".")){const n=Z(i);for(let a=0,r=e;a<n.length&&r!=null&&typeof r=="object";++a)r=z(r,n[a],a!==n.length-1)}else z(e,i,!1)}),t.flags&=-129)}function z(e,t,s){const i=t.endsWith("?")?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const a=parseInt(i,10);if(!isNaN(a))return Array.isArray(e)?e[a]:e.at(a)}const n=Y(e);if(n){const a=n.propertiesByName.get(i);a&&(st(a),at(e,a))}return s?e[i]:void 0}const _=[];function O(e){_.push(e),_.length===1&&queueMicrotask(()=>{const t=_.slice();_.length=0;for(const s of t)s()})}class U{constructor(t,s=30){this.name=t,this._counter=0,this._samples=new Array(s)}push(t){t!=null&&(this._samples[++this._counter%this._samples.length]=t)}set(t){t!=null&&(this._samples[this._counter%this._samples.length]=t)}get median(){return this._samples.slice().sort((t,s)=>t-s)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((t,s)=>t+s,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}}const w=(e,t,s,i)=>{let n=t,a=t;const r=s>>>1,l=e[n-1];for(;a<=r;){a=n<<1,a<s&&i(e[a-1],e[a])<0&&++a;const h=e[a-1];if(i(h,l)<=0)break;e[n-1]=h,n=a}e[n-1]=l},P=(e,t)=>e<t?-1:e>t?1:0;function lt(e,t,s,i){s===void 0&&(s=e.length),i===void 0&&(i=P);for(let a=s>>>1;a>t;a--)w(e,a,s,i);const n=t+1;for(let a=s-1;a>t;a--){const r=e[t];e[t]=e[a],e[a]=r,w(e,n,a,i)}}function*ht(e,t,s,i){s===void 0&&(s=e.length),i===void 0&&(i=P);for(let a=s>>>1;a>t;a--)w(e,a,s,i),yield;const n=t+1;for(let a=s-1;a>t;a--){const r=e[t];e[t]=e[a],e[a]=r,w(e,n,a,i),yield}}const ot=1.5,ct=1.1;let R=class{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Q,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>j(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const s=new Array;for(let i=0;i<this._length;i++){const n=this.data[i];t(n)&&s.push(n)}return s}at(t){if((t=Math.trunc(t)||0)<0&&(t+=this._length),!(t<0||t>=this._length))return this.data[t]}includes(t,s){const i=this.data.indexOf(t,s);return i!==-1&&i<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let s=t;s<this._length;++s)this.data[s]=this._deallocator(this.data[s]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,s=t.length){for(let i=0;i<s;i++)this.data[this._length++]=t[i]}fill(t,s){for(let i=0;i<s;i++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,j(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const s=S(this.data,I(t),this.length,this._hint);if(s!==-1)return this.data.splice(s,1),this.length=this.length-1,t}removeUnordered(t){return this.removeUnorderedIndex(S(this.data,I(t),this.length,this._hint))}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,s=t.length,i){this.length=V(this.data,t,this.length,s,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,s){if(t>=this.length||s>=this.length||t===s)return;const i=this.data[t];this.data[t]=this.data[s],this.data[s]=i}sort(t){lt(this.data,0,this.length,t)}iterableSort(t){return ht(this.data,0,this.length,t)}some(t,s){for(let i=0;i<this.length;++i)if(t.call(s,this.data[i],i,this.data))return!0;return!1}find(t,s){const{data:i,length:n}=this;for(let a=0;a<n;++a)if(t.call(s,i[a]))return i[a]}filterInPlace(t,s){let i=0;for(let n=0;n<this._length;++n){const a=this.data[n];t.call(s,a,n,this.data)&&(this.data[n]=this.data[i],this.data[i]=a,i++)}if(this._deallocator)for(let n=i;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=i,this._shrink(),this}forAll(t,s){const{data:i,length:n}=this;for(let a=0;a<n;++a)t.call(s,i[a],a,i)}forEach(t,s){this.data.slice(0,this.length).forEach(t,s)}map(t,s){const i=new Array(this.length);for(let n=0;n<this.length;++n)i[n]=t.call(s,this.data[n],n,this.data);return i}reduce(t,s){let i=s;for(let n=0;n<this.length;++n)i=t(i,this.data[n],n,this.data);return i}has(t){const s=this.length,i=this.data;for(let n=0;n<s;++n)if(i[n]===t)return!0;return!1}*[Symbol.iterator](){for(let t=0;t<this.length;t++)yield this.data[t]}};function j(e){e.data.length>ot*e.length&&(e.data.length=Math.floor(e.length*ct))}function St(e){return e}function It(e){return 1e3*e}function Mt(e){return e}function zt(e){return .001*e}class ut{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class ft{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let b=0;const f={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},D=["prepare","preRender","render","postRender","update","finish"],E=[],u=new R;class dt{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,B()}}function gt(){c!=null&&(cancelAnimationFrame(c),c=requestAnimationFrame(x))}function B(){c==null&&(b=performance.now(),c=requestAnimationFrame(x))}const T={frameTasks:u,willDispatch:!1,clearFrameTasks:pt,dispatch:H,executeFrameTasks:mt,reschedule:gt};function jt(e){const t=new ft(e);return E.push(t),T.willDispatch||(T.willDispatch=!0,O(H)),t}function qt(e){const t=new ut(e);return u.push(t),B(),new dt(t)}let c=null;function pt(e=!1){u.forAll(t=>{t.removed=!0}),e&&C()}function x(){const e=performance.now();c=null,c=u.some(s=>!s.paused&&!s.removed)?requestAnimationFrame(x):null,T.executeFrameTasks(e)}function mt(e){const t=e-b;b=e;const s=1e3/60,i=Math.max(0,t-s);f.time=e,f.frameDuration=s-i;for(let n=0;n<D.length;n++){const a=performance.now(),r=D[n];u.forAll(l=>{l.paused||l.removed||(n===0&&l.ticks++,l.phases[r]&&(f.elapsedFrameTime=performance.now()-e,f.deltaTime=l.ticks===0?0:t,l.phases[r]?.call(l,f)))}),At[n].push(performance.now()-a)}C(),kt.push(performance.now()-e)}const y=new R;function C(){u.forAll(e=>{e.removed&&y.push(e)}),u.removeUnorderedMany(y.data,y.length),y.clear()}function H(){for(;E.length;){const e=E.shift();e.isActive&&e.callback()}T.willDispatch=!1}function _t(e=1,t){const s=J(),i=()=>{K(t)?s.reject(X()):e===0?s():(--e,O(()=>i()))};return i(),s.promise}function yt(e){return _t(1,e)}async function Nt(e){await yt(e),await new Promise(t=>requestAnimationFrame(()=>{e?.aborted||t()}))}const At=D.map(e=>new U(e)),kt=new U("total");export{jt as A,qt as F,_t as M,yt as P,Nt as U,st as a,St as b,It as c,Mt as d,Tt as e,it as f,et as g,bt as h,g as i,Ft as j,Dt as l,at as m,Y as n,Z as o,R as r,U as s,O as t,zt as u,rt as y};
