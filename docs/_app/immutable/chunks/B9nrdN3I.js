import{z as U,M,b as G,g as C,b6 as V,b7 as W,b3 as F,x as L,bt as q,aJ as J,_ as u,m as f,a as K}from"./DwWpeHsS.js";import{g as Q}from"./GnozomzB.js";import{l as X,a as S,w as Y,f as Z}from"./CAYuU9oo.js";import{a as ee,b as te}from"./CFn2K6-l.js";import{n as re}from"./B2_jlIup.js";import{n as se,aj as ne,a8 as oe}from"./CeRhhlE3.js";import{b as w,e as ie,c as ae,o as E,t as de,d as le,v as ce,f as H,g as he,h as pe}from"./D5wPz3MX.js";import{K as ue}from"./DOBtub6T.js";function me(t){return typeof t=="string"?document.getElementById(t):t??null}function ze(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}const fe={handleInterceptedEvent:(t,e,r,s)=>(t.scheduleRender(),e.properties[`on${s.type}`].apply(e.properties.bind||r,[s]))},ge={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.startsWith("-")?t.style.setProperty(e,r):t.style[e]=r}},ye=t=>({...ge,...t}),ve=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},_e=(t,e)=>t.find(e),T=(t,e,r=!1)=>{let s=t;return e.forEach((c,i)=>{const h=s?.children?_e(s.children,p=>p.domNode===c):void 0;r&&!h&&i!==e.length-1||(s=h)}),s},$e=t=>{let e;const r={...fe,...t},s=ye(r),c=s.performanceLogger;let i,h=!0,p=!1;const n=[],o=[],g=(d,a,b)=>{let y;s.eventHandlerInterceptor=(Ne,je,Ce,Fe)=>function(v){let P;c("domEvent",v);const R=ve(v.currentTarget,y.domNode),x=R.some($=>customElements.get($?.tagName?.toLowerCase()));if(v.eventPhase===Event.CAPTURING_PHASE||!x)R.reverse(),P=T(y.getLastRender(),R);else{const $=v.composedPath(),D=$.slice($.indexOf(v.currentTarget),$.indexOf(y.domNode)).reverse();P=T(y.getLastRender(),D,!0)}let j;return P&&(j=r.handleInterceptedEvent(e,P,this,v)),c("domEventProcessed",v),j},r.postProcessProjectionOptions?.(s);const N=b();y=d(a,N,s),s.eventHandlerInterceptor=void 0,n.push(y),o.push(b),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(y,N)};let m=()=>{if(i=void 0,h){h=!1,c("renderStart",void 0);for(let d=0;d<n.length;d++){const a=o[d]();c("rendered",void 0);try{n[d].update(a)}catch(b){console.error(b)}c("patched",void 0)}c("renderDone",void 0),h=!0}};return r.modifyDoRenderImplementation&&(m=r.modifyDoRenderImplementation(m,n,o)),e={renderNow:m,scheduleRender:()=>{i||p||(i=requestAnimationFrame(m))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),p=!0},resume:()=>{p=!1,h=!0,e.scheduleRender()},append:(d,a)=>{g(w.append,d,a)},insertBefore:(d,a)=>{g(w.insertBefore,d,a)},merge:(d,a)=>{g(w.merge,d,a)},replace:(d,a)=>{g(w.replace,d,a)},detach:d=>{for(let a=0;a<o.length;a++)if(o[a]===d)return o.splice(a,1),n.splice(a,1)[0];throw new Error("renderFunction was not found")}},e};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.3.3 */let A=!1;const be=t=>{A=!0,ue(t)};let O;function Pe(){A||be(se(ne(O)))}function xe(t){const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push(t[r]?.());return e.length>0?Promise.all(e):null}O="components/assets";const k=new Set;function we(t){k.add(t),t.finally(()=>k.delete(t))}function Re(t){return U()}var B;let Ee=0;function z(t,e){const r=Object.prototype.hasOwnProperty;for(const s in e)r.call(e,s)&&r.call(t,s)&&(t[s]!=null&&e[s]!=null&&typeof t[s]=="object"&&typeof e[s]=="object"?z(t[s],e[s]):t[s]=e[s]);return t}const Ie=$e({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(s,c,i,h)=>{const p=e?.(s,c,i,h),n=r.test(s);if(!((s=s.replace(r,"")).toLowerCase()in i)||n){const o=s[2].toLowerCase()+s.slice(3),g=a=>p?.call(i,a);i.addEventListener(o,g,n);const m=()=>i.removeEventListener(o,g,n),d=h.afterRemoved;h.afterRemoved=a=>{d?.(a),m()}}return p}},handleInterceptedEvent(t,e,r,s){const{eventPhase:c,type:i}=s,h=c===Event.CAPTURING_PHASE;let p=`on${i}${h?"capture":""}`;const n=e.properties;(n&&p in n||(p=`on${i[0].toUpperCase()}${i.slice(1)}${h?"Capture":""}`,n&&p in n))&&(pe(),t.scheduleRender(),n[p].call(n.bind||r,s))}});let I=!1;var _;let l=(_=class extends ee(X){constructor(e,r){super(e,r),this._attached=!1,this._projector=Ie,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=M(async()=>{if(this._messageBundleProps?.length){const n=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:o,propertyName:g})=>{if(this.destroyed)return;let m=await Q(o);this.destroyed||(this.uiStrings&&Object.keys(this.uiStrings)&&(m=z(G(m),this.uiStrings)),this[g]=m)}));if(this.destroyed)return;for(const o of n)o.status==="rejected"&&C.getLogger(this).error("widget-intl:locale-error",this.declaredClass,o.reason)}await this.loadLocale()}),this.addHandles(Re()),Pe();const s="esri-widget-uid-"+re(),c=this.render.bind(this);this._trackingTarget=new V(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const i=()=>({vnodeSelector:"div",properties:{key:`${s}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),h=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const n=c()??i(),o=n.properties??={};if(o.key??=s,H(n.vnodeSelector)){if(!this.visible)return i()}else this.visible?o.styles||(o.styles={}):(o.class="",o.styles={display:"none"}),o.styles.display??="";let g=0;return n.children?.forEach(m=>{H(m.vnodeSelector)||(m.properties??={},m.properties.key??=`${this.id}--${g++}`)}),he(this,n)};this.render=()=>{if(I)return h();let n=ie(this)??null;if(n)return n;this._trackingTarget.clear(),I=!0;try{n=W(this._trackingTarget,h)}catch(o){throw C.getLogger(this).error(o),o}finally{I=!1}return n&&ae(this,n),n};const p=this.beforeFirstRender();p?this._resourcesFetch=p.then(()=>{this.destroyed||(this._readyForTrueRender=!0,this._postInitialize())}):(this._resourcesFetch=Promise.resolve().then(()=>{this.destroyed||this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),we(this._resourcesFetch)}normalizeCtorArgs(e,r){const s={...e};return r&&(s.container=r),s}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(F):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(L(this._trackingTarget),L(this.viewModel),this._detach(this.container),this._set("container",null),this.render=()=>null,this._projector=null,E(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return me(e)}get destroyed(){return super.destroyed}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+Ee++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(B=de,le)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(E(this),this._projector.scheduleRender())}classes(...e){return ce.apply(this,e)}renderNow(){E(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(S(()=>this.viewModel,(r,s)=>{s&&this.removeHandles("delegated-events"),r&&q(r)&&this.addHandles(this._delegatedEventNames.map(c=>J(r,c,i=>{this.emit(c,i)})),"delegated-events")},Y)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(F),this.scheduleRender()};this.addHandles([te(e),S(()=>this.uiStrings,e)]),this.addHandles(Z(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0}))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}},_[B]=!0,_.vnodeSelector="div",_);u([f()],l.prototype,"_readyForTrueRender",void 0),u([f({value:null})],l.prototype,"container",null),u([oe("container")],l.prototype,"castContainer",null),u([f()],l.prototype,"icon",null),u([f()],l.prototype,"id",null),u([f()],l.prototype,"label",null),u([f()],l.prototype,"renderable",null),u([f()],l.prototype,"uiStrings",void 0),u([f()],l.prototype,"viewModel",void 0),u([f({value:!0})],l.prototype,"visible",null),u([f()],l.prototype,"key",void 0),u([f()],l.prototype,"children",void 0),u([f()],l.prototype,"afterCreate",void 0),u([f()],l.prototype,"afterUpdate",void 0),u([f()],l.prototype,"afterRemoved",void 0),l=u([K("esri.widgets.Widget")],l);const De=l;function Ue(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}export{De as B,xe as c,Ue as e,me as n,ze as t};
