import{H as I,r as A,O as S,ai as q,a as L,C as r,I as R,J as N,aj as O,m as M}from"./CKPuaBYR.js";import{o as $}from"./DE3--tLW.js";import{b as P}from"./w-2V2ENZ.js";import{s as j}from"./D8t6YHTB.js";import{t as T}from"./BBGELVfD.js";var h;(function(n){n[n.ADD=1]="ADD",n[n.REMOVE=2]="REMOVE",n[n.MOVE=4]="MOVE"})(h||(h={}));function z(n){return(e,t)=>{e[t]=n}}var b;class J{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}}class k{constructor(e,t,s,i,a){this.target=e,this.added=t,this.removed=s,this.start=i,this.deleteCount=a}}const m=new I(J,void 0,(n=>{n.item=null,n.target=null,n.defaultPrevented=!1,n.cancellable=!1}));function w(n){n&&typeof n=="object"&&"destroy"in n&&typeof n.destroy=="function"&&n.destroy()}function D(n){return n?n instanceof E?n.toArray():n.length?Array.prototype.slice.apply(n):[]:[]}function V(n){if(n?.length)return n[0]}function H(n,e,t,s){const i=Math.min(n.length-t,e.length-s);let a=0;for(;a<i&&n[t+a]===e[s+a];)a++;return a}function B(n,e,t,s){e&&e.forEach(((i,a,u)=>{n.push(i),B(n,t.call(s,i,a,u),t,s)}))}const p=new Set,v=new Set,y=new Set,x=new Map;let F=0;var C;let E=(C=class extends $.EventedAccessor{static isCollection(e){return e!=null&&e instanceof b}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new j,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:F++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof b?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return r(this._observable),this._items}set items(e){this._emitBeforeChanges(h.ADD)||(this._splice(0,this.length,D(e)),this._emitAfterChanges(h.ADD))}hasEventListener(e){return!this.destroyed&&(e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e))}on(e,t){if(this.destroyed)return R();if(e==="change"){const s=this._chgListeners,i={removed:!1,callback:t};return s.push(i),this._notifications&&this._notifications.push({listeners:s.slice(),items:this._items.slice(),changes:[]}),R((()=>{i.removed=!0,s.splice(s.indexOf(i),1)}))}return this._emitter.on(e,t)}once(e,t){const s="deref"in t?()=>t.deref():()=>t,i=this.on(e,(a=>{s()?.call(null,a),i.remove()}));return i}add(e,t){if(r(this._observable),this._emitBeforeChanges(h.ADD))return this;const s=this.getNextIndex(t??null);return this._splice(s,0,[e]),this._emitAfterChanges(h.ADD),this}addMany(e,t=this._items.length){if(r(this._observable),!e?.length)return this;if(this._emitBeforeChanges(h.ADD))return this;const s=this.getNextIndex(t);return this._splice(s,0,D(e)),this._emitAfterChanges(h.ADD),this}at(e){if(r(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(r(this._observable),!this.length||this._emitBeforeChanges(h.REMOVE))return[];const e=this._removeAllRaw();return this._emitAfterChanges(h.REMOVE),e}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return r(this._observable),this._createNewInstance({items:this._items.map(P)})}concat(...e){r(this._observable);const t=e.map(D);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(r(this._observable),!this.length||this._emitBeforeChanges(h.REMOVE))return;const s=this._splice(0,this.length),i=s.length;for(let a=0;a<i;a++)e.call(t,s[a],a,s);this._emitAfterChanges(h.REMOVE)}destroyAll(){this.drain(w)}destroyMany(e){const t=this.removeMany(e);return t.forEach(w),t}every(e,t){return r(this._observable),this._items.every(e,t)}filter(e,t){r(this._observable);const s=arguments.length===2?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:s})}find(e,t){return r(this._observable),this._items.find(e,t)}findIndex(e,t){return r(this._observable),this._items.findIndex(e,t)}flatten(e,t){r(this._observable);const s=[];return B(s,this,e,t),new b(s)}forEach(e,t){return r(this._observable),this._items.forEach(e,t)}getItemAt(e){return r(this._observable),this._items[e]}getNextIndex(e){r(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return r(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return r(this._observable),this._items.indexOf(e,t)}join(e=","){return r(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return r(this._observable),this._items.lastIndexOf(e,t)}map(e,t){r(this._observable);const s=this._items.map(e,t);return new b({items:s})}reorder(e,t=this.length-1){r(this._observable);const s=this.indexOf(e);if(s!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),s!==t){if(this._emitBeforeChanges(h.MOVE))return e;this._splice(s,1),this._splice(t,0,[e]),this._emitAfterChanges(h.MOVE)}return e}}pop(){if(r(this._observable),!this.length||this._emitBeforeChanges(h.REMOVE))return;const e=V(this._splice(this.length-1,1));return this._emitAfterChanges(h.REMOVE),e}push(...e){return r(this._observable),this._emitBeforeChanges(h.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(h.ADD)),this.length}reduce(e,t){r(this._observable);const s=this._items;return arguments.length===2?s.reduce(e,t):s.reduce(e)}reduceRight(e,t){r(this._observable);const s=this._items;return arguments.length===2?s.reduceRight(e,t):s.reduceRight(e)}remove(e){return r(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(r(this._observable),e<0||e>=this.length||this._emitBeforeChanges(h.REMOVE))return;const t=V(this._splice(e,1));return this._emitAfterChanges(h.REMOVE),t}removeMany(e){if(r(this._observable),!e?.length||this._emitBeforeChanges(h.REMOVE))return[];const t=e instanceof b?e.toArray():e,s=this._items,i=[],a=t.length;for(let u=0;u<a;u++){const _=t[u],c=s.indexOf(_);if(c>-1){const l=1+H(t,s,u+1,c+1),f=this._splice(c,l);f&&f.length>0&&i.push.apply(i,f),u+=l-1}}return this._emitAfterChanges(h.REMOVE),i}reverse(){if(r(this._observable),this._emitBeforeChanges(h.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(h.MOVE),this}shift(){if(r(this._observable),!this.length||this._emitBeforeChanges(h.REMOVE))return;const e=V(this._splice(0,1));return this._emitAfterChanges(h.REMOVE),e}slice(e=0,t=this.length){return r(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return r(this._observable),this._items.some(e,t)}sort(e){if(r(this._observable),!this.length||this._emitBeforeChanges(h.MOVE)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(h.MOVE),this}_requiresSort(e=(t,s)=>t===s?0:t<s?-1:1){const t=this.length-1;for(let s=0;s<t;s++)if(e(this.items[s],this.items[s+1])>0)return!0;return!1}splice(e,t,...s){r(this._observable),arguments.length===1&&(t=this.length),t??=0;const i=(t?h.REMOVE:0)|(s.length?h.ADD:0);if(this._emitBeforeChanges(i))return[];const a=this._splice(e,t,s)||[];return this._emitAfterChanges(i),a}toArray(){return r(this._observable),this._items.slice()}toJSON(e){return r(this._observable),this.toArray().map((t=>T(t)?t.toJSON(e):t))}toLocaleString(){return r(this._observable),this._items.toLocaleString()}toString(){return r(this._observable),this._items.toString()}unshift(...e){return r(this._observable),!e.length||this._emitBeforeChanges(h.ADD)||(this._splice(0,0,e),this._emitAfterChanges(h.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,s){const i=this._items,a=this.itemType;let u,_;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=N((()=>this._dispatchChange()))),e<0&&(e+=this.length),t){if(_=i.splice(e,t),this.hasEventListener("before-remove")){const c=m.acquire();c.target=this,c.cancellable=!0;for(let l=0,f=_.length;l<f;l++)u=_[l],c.reset(u),this.emit("before-remove",c),c.defaultPrevented&&(_.splice(l,1),i.splice(e,0,u),e+=1,l-=1,f-=1);m.release(c)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const c=m.acquire();c.target=this,c.cancellable=!1;const l=_.length;for(let f=0;f<l;f++)c.reset(_[f]),this.emit("after-remove",c);m.release(c)}}if(s?.length){if(a){const o=[];for(const g of s){const d=a.ensureType(g);d==null&&g!=null||o.push(d)}s=o}const c=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),f=e===this.length;if(c||l){const o=m.acquire();o.target=this,o.cancellable=!0;const g=m.acquire();g.target=this,g.cancellable=!1;for(const d of s)c?(o.reset(d),this.emit("before-add",o),o.defaultPrevented||(f?i.push(d):i.splice(e++,0,d),this._set("length",i.length),l&&(g.reset(d),this.emit("after-add",g)))):(f?i.push(d):i.splice(e++,0,d),this._set("length",i.length),g.reset(d),this.emit("after-add",g));m.release(g),m.release(o)}else{if(f)for(const o of s)i.push(o);else i.splice(e,0,...s);this._set("length",i.length)}}if((s?.length||_?.length)&&this._notifyChangeEvent(s,_),this.hasEventListener("after-splice")){const c=new k(this,s,_,e,t);this.emit("after-splice",c)}return _}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const s=m.acquire();s.target=this,s.cancellable=!0,s.type=e,this.emit("before-changes",s),t=s.defaultPrevented,m.release(s)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=m.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),m.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const s=t.changes;p.clear(),v.clear(),y.clear();for(const{added:l,removed:f}of s){if(l)if(y.size===0&&v.size===0)for(const o of l)p.add(o);else for(const o of l)v.has(o)?(y.add(o),v.delete(o)):y.has(o)||p.add(o);if(f)if(y.size===0&&p.size===0)for(const o of f)v.add(o);else for(const o of f)p.has(o)?p.delete(o):(y.delete(o),v.add(o))}const i=O.acquire();p.forEach((l=>{i.push(l)}));const a=O.acquire();v.forEach((l=>{a.push(l)}));const u=this._items,_=t.items,c=O.acquire();if(y.forEach((l=>{_.indexOf(l)!==u.indexOf(l)&&c.push(l)})),t.listeners&&(i.length||a.length||c.length)){const l={target:this,added:i,removed:a,moved:c},f=t.listeners.length;for(let o=0;o<f;o++){const g=t.listeners[o];g.removed||g.callback.call(this,l)}}O.release(i),O.release(a),O.release(c)}p.clear(),v.clear(),y.clear()}},b=C,C.ofType=e=>{if(!e)return b;if(x.has(e))return x.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const a=e.typeMap[i].prototype.declaredClass;t?t+=` | ${a}`:t=a}let s=class extends b{};return A([z({Type:e,ensureType:typeof e=="function"?S(e):q(e)})],s.prototype,"itemType",void 0),s=A([L(`esri.core.Collection<${t}>`)],s),x.set(e,s),s},C);A([M()],E.prototype,"_updating",void 0),A([M()],E.prototype,"length",void 0),A([M()],E.prototype,"items",null),A([M({readOnly:!0})],E.prototype,"updating",null),E=b=A([L("esri.core.Collection")],E);const X=E;export{X as V,z as n};
