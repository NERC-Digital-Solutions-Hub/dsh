import{C as _,g as B,s as E}from"./DwWpeHsS.js";import{n as K}from"./B87vTgcy.js";import{y as F,P as U}from"./D2feDspf.js";import{a1 as T,H as k,I as Q,P as L,au as I,f as G,ag as V}from"./BfMV86KQ.js";import{r as j,i as b,o as z,s as H}from"./jrtQMiTD.js";import{v as X,f as Y}from"./CbKIfN8e.js";import{f as Z}from"./8hNj00IL.js";import{r as ee,o as te}from"./BauKPgXA.js";async function ne(e,t,i,r){const n=Z(e),l=t[0].spatialReference,o={...r,responseType:"json",query:{...n.query,f:"json",sr:T(l),target:JSON.stringify({geometryType:X(t[0]),geometries:t}),cutter:JSON.stringify(i)}},s=await k(n.path+"/cut",o),{cutIndexes:a,geometries:c=[]}=s.data;return{cutIndexes:a,geometries:c.map(u=>{const m=Y(u);return m.spatialReference=l,m})}}async function se(e,t,i){const r=typeof e=="string"?Q(e):e,n=t[0].spatialReference,l=X(t[0]),o={...i,query:{...r.query,f:"json",sr:T(n),geometries:JSON.stringify(ee(t))}},{data:s}=await k(r.path+"/simplify",o);return te(s.geometries,l,n)}const D=()=>B.getLogger("esri.geometry.support.normalizeUtils");function re(e){return e.type==="polygon"}function oe(e){return e[0].type==="polygon"}function ie(e){return e[0].type==="polyline"}function C(e){const t=[];let i=0,r=0;for(let n=0;n<e.length;n++){const l=e[n];let o=null;for(let s=0;s<l.length;s++)o=l[s],t.push(o),s===0?(i=o[0],r=i):(i=Math.min(i,o[0]),r=Math.max(r,o[0]));o&&t.push([(i+r)/2,0])}return t}function le(e,t){if(!(e instanceof F||e instanceof U)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw D().error(n),new E("internal:geometry",n)}const i=z(e),r=[];for(const n of i){const l=[];r.push(l),l.push([n[0][0],n[0][1]]);for(let o=0;o<n.length-1;o++){const s=n[o][0],a=n[o][1],c=n[o+1][0],u=n[o+1][1],m=Math.sqrt((c-s)*(c-s)+(u-a)*(u-a)),p=(u-a)/m,d=(c-s)/m,g=m/t;if(g>1){for(let R=1;R<=g-1;R++){const P=R*t,f=d*P+s,h=p*P+a;l.push([f,h])}const $=(m+Math.floor(g-1)*t)/2,S=d*$+s,q=p*$+a;l.push([S,q])}l.push([c,u])}}return re(e)?new U({rings:r,spatialReference:e.spatialReference}):new F({paths:r,spatialReference:e.spatialReference})}function J(e,t,i){if(t){const r=le(e,1e6);e=V(r,!0)}return i&&(e=H(e,i)),e}function O(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const n=b(r,t);e[0]=r+n*(-2*t)}else if(r<i){const n=b(r,i);e[0]=r+n*(-2*i)}}else{const r=e.x;if(r>t){const n=b(r,t);e=e.clone().offset(n*(-2*t),0)}else if(r<i){const n=b(r,i);e=e.clone().offset(n*(-2*i),0)}}return e}function ae(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const n=t.cutIndexes[r],l=t.geometries[r],o=z(l);for(let s=0;s<o.length;s++){const a=o[s];a.some(c=>{if(c[0]<180)return!0;{let u=0;for(let p=0;p<a.length;p++){const d=a[p][0];u=d>u?d:u}u=Number(u.toFixed(9));const m=-360*b(u,180);for(let p=0;p<a.length;p++){const d=l.getPoint(s,p);l.setPoint(s,p,d.clone().offset(m,0))}return!0}})}if(n===i){if(oe(e))for(const s of z(l))e[n]=e[n].addRing(s);else if(ie(e))for(const s of z(l))e[n]=e[n].addPath(s)}else i=n,e[n]=l}return e}async function fe(e,t,i){if(!Array.isArray(e))return fe([e],t);t&&typeof t!="string"&&D().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof t=="string"?t:t?.url??_.geometryServiceUrl;let n,l,o,s,a,c,u,m,p=0;const d=[],g=[];for(const f of e)if(f!=null)if(n||(n=f.spatialReference,l=L(n),o=n.isWebMercator,c=o?102100:4326,s=j[c].maxX,a=j[c].minX,u=j[c].plus180Line,m=j[c].minus180Line),l)if(f.type==="mesh")g.push(f);else if(f.type==="point")g.push(O(f.clone(),s,a));else if(f.type==="multipoint"){const h=f.clone();h.points=h.points.map(x=>O(x,s,a)),g.push(h)}else if(f.type==="extent"){const h=f.clone()._normalize(!1,!1,l);g.push(h.rings?new U(h):h)}else if(f.extent){const h=f.extent,x=b(h.xmin,a)*(2*s);let M=x===0?f.clone():H(f.clone(),x);h.offset(x,0);let{xmin:w,xmax:y}=h;w=Number(w.toFixed(9)),y=Number(y.toFixed(9)),h.intersects(u)&&y!==s?(p=y>p?y:p,M=J(M,o),d.push(M),g.push("cut")):h.intersects(m)&&w!==a?(p=y*(2*s)>p?y*(2*s):p,M=J(M,o,360),d.push(M),g.push("cut")):g.push(M)}else g.push(f.clone());else g.push(f);else g.push(f);let $=b(p,s),S=-90;const q=$,R=new F;for(;$>0;){const f=360*$-180;R.addPath([[f,S],[f,-1*S]]),S*=-1,$--}if(d.length>0&&q>0){const f=ae(d,await ne(r,d,R,i)),h=[],x=[];for(let y=0;y<g.length;y++){const v=g[y];if(v!=="cut")x.push(v);else{const N=f.shift(),A=e[y];A!=null&&A.type==="polygon"&&A.rings&&A.rings.length>1&&N.rings.length>=A.rings.length?(h.push(N),x.push("simplify")):x.push(o?I(N):N)}}if(!h.length)return x;const M=await se(r,h,i),w=[];for(let y=0;y<x.length;y++){const v=x[y];v!=="simplify"?w.push(v):w.push(o?I(M.shift()):M.shift())}return w}const P=[];for(let f=0;f<g.length;f++){const h=g[f];if(h!=="cut")P.push(h);else{const x=d.shift();P.push(o===!0?I(x):x)}}return P}function de(e){if(!e)return null;const t=e.extent;if(!t)return null;const i=e.spatialReference&&L(e.spatialReference);if(!i)return t;const[r,n]=i.valid,l=2*n,{width:o}=t;let s,{xmin:a,xmax:c}=t;if([a,c]=[c,a],e.type==="extent"||o===0||o<=n||o>l||a<r||c>n)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;s=C(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;s=C(e.paths);break;case"multipoint":s=e.points}const u=t.clone();for(let m=0;m<s.length;m++){let p=s[m][0];p<0?(p+=n,c=Math.max(p,c)):(p-=n,a=Math.min(p,a))}return u.xmin=a,u.xmax=c,u.width<o?(u.xmin-=n,u.xmax-=n,u):t}function Me(e,t,i){const r=L(i);if(r==null)return e;const[n,l]=r.valid,o=2*l;let s=0,a=0;t>l?s=Math.ceil(Math.abs(t-l)/o):t<n&&(s=-Math.ceil(Math.abs(t-n)/o)),e>l?a=Math.ceil(Math.abs(e-l)/o):e<n&&(a=-Math.ceil(Math.abs(e-n)/o));let c=e+(s-a)*o;const u=c-t;return u>l?c-=o:u<n&&(c+=o),c}function $e(e,t){return W(t)?.normalize(e)??e}function W(e){const t=L(e);if(t==null)return null;const[i,r]=t.valid;return new K(i,r)}const we=W(G.WGS84);W(G.WebMercator);export{we as A,Me as L,fe as P,$e as S,le as b,de as z};
