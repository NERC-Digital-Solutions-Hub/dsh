import{b as _,l as b,n as l,o as g,p as x}from"./DUQhet5j.js";import{i as d}from"./BbNfuhIx.js";import{u as f}from"./BjyH-Vyd.js";import{O as h,R as n}from"./DQOO6RKE.js";const c=()=>d.getLogger("esri.views.webgl.BufferObject"),T=!!_("esri-tests-disable-gpu-memory-measurements");let S=class r{static createIndex(e,t,i){return new r(e,34963,t,i)}static createUniform(e,t,i){return new r(e,35345,t,i)}static createPixelPack(e,t=35041,i){const s=new r(e,35051,t);return i&&s.setSize(i),s}static createPixelUnpack(e,t=35040,i){return new r(e,35052,t,i)}static createTransformFeedback(e,t=35044,i){const s=new r(e,35982,t);return s.setSize(i),s}constructor(e,t,i,s){this._context=e,this.bufferType=t,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(h.BufferObject,this),this._glName=this._context.gl.createBuffer(),f(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get sizeBytes(){if(this.bufferType===34963){if(this._indexType===n.UNSIGNED_INT)return 4*this._size;if(this._indexType===n.UNSIGNED_SHORT)return 2*this._size}return this._size}get usedMemory(){return T?0:this.sizeBytes}get _isVAOAware(){return this.bufferType===34963||this.bufferType===34962}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(h.BufferObject,this),this._context=null):this._glName&&c().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===34963&&t!=null)switch(this._indexType=t,t){case n.UNSIGNED_SHORT:e*=2;break;case n.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===34963&&(b(e)?this._indexType=n.UNSIGNED_BYTE:l(e)?(t/=2,this._indexType=n.UNSIGNED_SHORT):g(e)&&(t/=4,this._indexType=n.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;t!=null?s.bufferData(this.bufferType,t,this.usage):s.bufferData(this.bufferType,e,this.usage),f(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,t,i,s){if(!e)return;const u=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:a}=this._context;a.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,i,s-i),f(a),this._isVAOAware&&this._context.bindVAO(u)}getSubData(e,t=0,i,s){if(i<0||s<0)return;const u=p(e)?e.BYTES_PER_ELEMENT:1;if(u*((i??0)+(s??0))>e.byteLength)return;t+u*(s??0)>this.usedMemory&&c().warn("Potential problem getting subdata: requested data exceeds buffer size!");const a=this._context.gl;this.bufferType===35982?(this._context.bindBuffer(this,35982),a.getBufferSubData(35982,t,e,i,s),this._context.unbindBuffer(35982)):(this._context.bindBuffer(this,36662),a.getBufferSubData(36662,t,e,i,s),this._context.unbindBuffer(36662))}async getSubDataAsync(e,t=0,i,s){await this._context.clientWaitAsync(),this.getSubData(e,t,i,s)}};function p(o){return x(o)}export{S as o};
