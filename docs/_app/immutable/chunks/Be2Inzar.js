const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Db985nzU.js","./CaJv-7Uz.js","./oKHlAiyk.js","./BJj2_Vlp.js","./2eEJBHPf.js","./BxFa---M.js","./PPVm8Dsz.js","./BU-dfLkt.js","./EnYQAt9i.js","./B-7eUg25.js","./BZedbJEu.js","./C-4pLmJn.js","./zNZQG8RX.js","./D6KPPgz5.js","./7UfobvnF.js","./DZd6gJy7.js","./Bau_5PW-.js","./DVHypsku.js","./418LbBLl.js","./Cb4i6ZOf.js","./8hr2idEF.js","./B1Avswm0.js","./csvUn3i6.js","./cTZz5F9l.js","./BLQPBdEE.js"])))=>i.map(i=>d[i]);
import{r,m as s,a as d,l as m,f as q,u as L,e as $,d as B,B as S,c as D,z as J,b as z}from"./oKHlAiyk.js";import{O as V}from"./o0B939Hd.js";import{_}from"./PPVm8Dsz.js";import{l as R}from"./B7zDb3e9.js";import{V as v}from"./EnYQAt9i.js";import{n as k}from"./D2jLiM28.js";import{K as H,a as E}from"./BJj2_Vlp.js";import{i as A,s as Q}from"./2eEJBHPf.js";import{p as U}from"./BZedbJEu.js";import{t as W}from"./BL1fuJQX.js";import{r as K}from"./BG9QFDG6.js";import{r as X,n as Y,a as C}from"./GwO4izZl.js";import{l as j}from"./Cry81sjZ.js";import{o as Z}from"./B-7eUg25.js";import{ab as ee,H as te,a7 as x}from"./BxFa---M.js";import{n as re}from"./Cl5lrJ4c.js";import{v as oe}from"./HrPI521c.js";import{l as c}from"./BfJy8cai.js";import{D as se,N as ae,e as ie}from"./CaJv-7Uz.js";import{p as ne,l as le,m as pe}from"./D5gyBayZ.js";import{l as ue,a as de,t as ye}from"./DvaZXDI1.js";var I;let f=I=class extends m{constructor(e){super(e),this.type="none"}clone(){return new I({type:this.type})}};r([K({none:"none",stayAbove:"stay-above"}),s({json:{write:{isRequired:!0}}})],f.prototype,"type",void 0),f=I=r([d("esri.ground.NavigationConstraint")],f);const ce=Symbol("GroundInstance");var N,O,M;let l=O=(M=class extends m.JSONSupportMixin(U){constructor(e){super(e),this[N]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new v;const t=o=>{o.parent&&o.parent!==this&&"remove"in o.parent&&o.parent.remove(o),o.parent=this,o.type!=="elevation"&&o.type!=="base-elevation"&&A.getLogger(this).error(`Layer '${o.title}, id:${o.id}' of type '${o.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},a=o=>{o.parent=null};this.addHandles([this.layers.on("after-add",(o=>t(o.item))),this.layers.on("after-remove",(o=>a(o.item)))])}initialize(){this.when().catch((e=>{q(e)||A.getLogger(this).error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)L(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",k(e,this._get("layers")))}writeLayers(e,t,a,o){const n=[];e&&(o={...o,layerContainerType:"ground"},e.forEach((u=>{if("write"in u){const h={};H(u)().write(h,o)&&n.push(h)}else o?.messages&&o.messages.push(new Q("layer:unsupported",`Layers (${u.title}, ${u.id}) of type '${u.declaredClass}' cannot be persisted in the ground`,{layer:u}))}))),t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return W(this,(e=>{e(this.layers)}))}async queryElevation(e,t){await this.load({signal:t?.signal});const{ElevationQuery:a}=await _(()=>import("./Db985nzU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url);$(t);const o=new a,n=this.layers.filter(F).toArray();return o.queryAll(n,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{ElevationQuery:a}=await _(()=>import("./Db985nzU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url);$(t);const o=new a,n=this.layers.filter(F).toArray();return o.createSamplerAll(n,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:E(this.surfaceColor),navigationConstraint:E(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new O({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,a){const o=t?.origin||"web-scene",n=t?.portal||null,u=t?.url||null,{populateOperationalLayers:h}=await _(async()=>{const{populateOperationalLayers:w}=await import("./Bau_5PW-.js");return{populateOperationalLayers:w}},__vite__mapDeps([16,8,2,3,4,9,10,6,5,7,11,17,18,1,19,20,21,22,23,14,12,13,24]),import.meta.url);$(a);const T=[];if(e.layers&&Array.isArray(e.layers)){const w={context:{origin:o,url:u,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};T.push(h(this.layers,e.layers,w))}await Promise.allSettled(T)}},N=ce,M);function me(e){return e&&"createElevationSampler"in e}function F(e){return e.type==="elevation"||me(e)}r([s({json:{read:!1,write:{isRequired:!0}}})],l.prototype,"layers",null),r([B("layers")],l.prototype,"writeLayers",null),r([s({readOnly:!0})],l.prototype,"resourceInfo",void 0),r([s({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:S,read:{reader:X,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Y(e)},target:"transparency"}}})],l.prototype,"opacity",void 0),r([s({type:R,json:{type:[S],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],l.prototype,"surfaceColor",void 0),r([s({type:f,json:{write:!0}})],l.prototype,"navigationConstraint",void 0),l=O=r([d("esri.Ground")],l);const b=l;let g=class extends C.ClonableMixin(m){constructor(t){super(t),this.color=null}};r([s({type:R,json:{type:[S],write:!0}})],g.prototype,"color",void 0),g=r([d("esri.effects.FocusAreaOutline")],g);const he=g;let p=class extends m.JSONSupportMixin(C){constructor(e){super(e),this.id=`focusarea-${re()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new c}readGeometries(e,t,a){Array.isArray(e)?this.geometries=c.fromJSON(e,a):a.hooks?.onAfterLoad?.((()=>this._loadGeometries(ee(e,a),a)))}async _loadGeometries(e,t){const a=await te(e,{responseType:"json"});this.geometries=c.fromJSON(a.data,t)}};r([s({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),s()],p.prototype,"id",void 0),r([s({type:String,json:{write:!0}})],p.prototype,"title",void 0),r([s({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],p.prototype,"enabled",void 0),r([s({type:he,json:{write:!0}})],p.prototype,"outline",void 0),r([s({type:c,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new c(e.items.map((t=>t.clone())))}),oe({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],p.prototype,"geometries",void 0),r([D(["web-scene","portal-item"],"geometries")],p.prototype,"readGeometries",null),p=r([d("esri.effects.FocusArea")],p);const fe=p;let y=class extends m.JSONSupportMixin(C){constructor(e){super(e),this.areas=new v,this.style="bright"}};r([s({type:v.ofType(fe),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new v(e.items.map((t=>t.clone())))})],y.prototype,"areas",void 0),r([s({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],y.prototype,"style",void 0),y=r([d("esri.effects.FocusAreas")],y);const P=y;function ge(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function ve(e){return!(!ge(e)||!se(e)?.operations?.supportsEditing||"editingEnabled"in e&&!ae(e)||ie(e))}const G={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function be(e){let t=null;if(typeof e=="string")if(e in G){const a=G[e];t=new b({resourceInfo:{data:{layers:[a]}}})}else A.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=J(b,e);return t}let i=class extends ue(de(Z.EventedMixin(z))){constructor(e){super(e),this.allLayers=new j({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.focusAreas=new P,this.allTables=ye(this),this.basemap=null,this.editableLayers=new j({getCollections:()=>[this.allLayers],itemFilterFunction:ve}),this.ground=new b,this._basemapCache=ne()}destroy(){le(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=L(this.basemap),L(this.ground),this._set("ground",null)}castBasemap(e){return pe(e,this._basemapCache)}castGround(e){return be(e)??this._get("ground")}findLayerById(e){return this.allLayers.find((t=>t.id===e))}findTableById(e){return this.allTables.find((t=>t.id===e))}};r([s({readOnly:!0,dependsOn:[]})],i.prototype,"allLayers",void 0),r([s({type:P,nonNullable:!0,json:{write:{overridePolicy:e=>({enabled:e.areas.length>0,ignoreOrigin:!0})}}})],i.prototype,"focusAreas",void 0),r([s({readOnly:!0})],i.prototype,"allTables",void 0),r([s({type:V,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],i.prototype,"basemap",void 0),r([x("basemap")],i.prototype,"castBasemap",null),r([s({readOnly:!0})],i.prototype,"editableLayers",void 0),r([s({type:b,nonNullable:!0})],i.prototype,"ground",void 0),r([x("ground")],i.prototype,"castGround",null),r([s()],i.prototype,"undoRedo",void 0),i=r([d("esri.Map")],i);const we=i,ze=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{we as L,ze as M,ve as e};
