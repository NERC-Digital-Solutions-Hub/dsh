import{r as A,av as j,ca as I,a as R,G as r,e as L,A as q,g as P,cb as O,m as M,I as N,M as T}from"./CtNvT6K6.js";import{o as k}from"./BDW2xvBE.js";import{a as z}from"./ZGrc7RNF.js";import{s as H}from"./BHaUclSc.js";import{c as J}from"./Bxh34c20.js";import{l as U,w as G}from"./K7zsZ2sk.js";var h;(function(s){s[s.ADD=1]="ADD",s[s.REMOVE=2]="REMOVE",s[s.MOVE=4]="MOVE"})(h||(h={}));function F(s){return(e,t)=>{e[t]=s}}var m;let W=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};class K{constructor(e,t,i,n,a){this.target=e,this.added=t,this.removed=i,this.start=n,this.deleteCount=a}}const p=new P(W,void 0,(s=>{s.item=null,s.target=null,s.defaultPrevented=!1,s.cancellable=!1}));function $(s){s&&typeof s=="object"&&"destroy"in s&&typeof s.destroy=="function"&&s.destroy()}function D(s){return s?s instanceof E?s.toArray():s.length?Array.prototype.slice.apply(s):[]:[]}function V(s){if(s?.length)return s[0]}function Q(s,e,t,i){const n=Math.min(s.length-t,e.length-i);let a=0;for(;a<n&&s[t+a]===e[i+a];)a++;return a}function S(s,e,t,i){e&&e.forEach(((n,a,f)=>{s.push(n),S(s,t.call(i,n,a,f),t,i)}))}const b=new Set,y=new Set,v=new Set,x=new Map;let X=0;var C;let E=(C=class extends k.EventedAccessor{static isCollection(e){return e!=null&&e instanceof m}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new H,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:X++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof m?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return r(this._observable),this._items}set items(e){this._emitBeforeChanges(h.ADD)||(this._splice(0,this.length,D(e)),this._emitAfterChanges(h.ADD))}hasEventListener(e){return!this.destroyed&&(e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e))}on(e,t){if(this.destroyed)return L();if(e==="change"){const i=this._chgListeners,n={removed:!1,callback:t};return i.push(n),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),L((()=>{n.removed=!0,i.splice(i.indexOf(n),1)}))}return this._emitter.on(e,t)}once(e,t){const i="deref"in t?()=>t.deref():()=>t,n=this.on(e,(a=>{i()?.call(null,a),n.remove()}));return n}add(e,t){if(r(this._observable),this._emitBeforeChanges(h.ADD))return this;const i=this.getNextIndex(t??null);return this._splice(i,0,[e]),this._emitAfterChanges(h.ADD),this}addMany(e,t=this._items.length){if(r(this._observable),!e?.length)return this;if(this._emitBeforeChanges(h.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,D(e)),this._emitAfterChanges(h.ADD),this}at(e){if(r(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(r(this._observable),!this.length||this._emitBeforeChanges(h.REMOVE))return[];const e=this._removeAllRaw();return this._emitAfterChanges(h.REMOVE),e}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return r(this._observable),this._createNewInstance({items:this._items.map(z)})}concat(...e){r(this._observable);const t=e.map(D);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(r(this._observable),!this.length||this._emitBeforeChanges(h.REMOVE))return;const i=this._splice(0,this.length),n=i.length;for(let a=0;a<n;a++)e.call(t,i[a],a,i);this._emitAfterChanges(h.REMOVE)}destroyAll(){this.drain($)}destroyMany(e){const t=this.removeMany(e);return t.forEach($),t}every(e,t){return r(this._observable),this._items.every(e,t)}filter(e,t){r(this._observable);const i=arguments.length===2?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:i})}find(e,t){return r(this._observable),this._items.find(e,t)}findIndex(e,t){return r(this._observable),this._items.findIndex(e,t)}flatten(e,t){r(this._observable);const i=[];return S(i,this,e,t),new m(i)}forEach(e,t){return r(this._observable),this._items.forEach(e,t)}getItemAt(e){return r(this._observable),this._items[e]}getNextIndex(e){r(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return r(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return r(this._observable),this._items.indexOf(e,t)}join(e=","){return r(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return r(this._observable),this._items.lastIndexOf(e,t)}map(e,t){r(this._observable);const i=this._items.map(e,t);return new m({items:i})}reorder(e,t=this.length-1){r(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(h.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(h.MOVE)}return e}}pop(){if(r(this._observable),!this.length||this._emitBeforeChanges(h.REMOVE))return;const e=V(this._splice(this.length-1,1));return this._emitAfterChanges(h.REMOVE),e}push(...e){return r(this._observable),this._emitBeforeChanges(h.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(h.ADD)),this.length}reduce(e,t){r(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){r(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return r(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(r(this._observable),e<0||e>=this.length||this._emitBeforeChanges(h.REMOVE))return;const t=V(this._splice(e,1));return this._emitAfterChanges(h.REMOVE),t}removeMany(e){if(r(this._observable),!e?.length||this._emitBeforeChanges(h.REMOVE))return[];const t=e instanceof m?e.toArray():e,i=this._items,n=[],a=t.length;for(let f=0;f<a;f++){const g=t[f],c=i.indexOf(g);if(c>-1){const l=1+Q(t,i,f+1,c+1),u=this._splice(c,l);u&&u.length>0&&n.push.apply(n,u),f+=l-1}}return this._emitAfterChanges(h.REMOVE),n}reverse(){if(r(this._observable),this._emitBeforeChanges(h.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(h.MOVE),this}shift(){if(r(this._observable),!this.length||this._emitBeforeChanges(h.REMOVE))return;const e=V(this._splice(0,1));return this._emitAfterChanges(h.REMOVE),e}slice(e=0,t=this.length){return r(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return r(this._observable),this._items.some(e,t)}sort(e){if(r(this._observable),!this.length||this._emitBeforeChanges(h.MOVE)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(h.MOVE),this}_requiresSort(e=(t,i)=>t===i?0:t<i?-1:1){const t=this.length-1;for(let i=0;i<t;i++)if(e(this.items[i],this.items[i+1])>0)return!0;return!1}splice(e,t,...i){r(this._observable),arguments.length===1&&(t=this.length),t??=0;const n=(t?h.REMOVE:0)|(i.length?h.ADD:0);if(this._emitBeforeChanges(n))return[];const a=this._splice(e,t,i)||[];return this._emitAfterChanges(n),a}toArray(){return r(this._observable),this._items.slice()}toJSON(e){return r(this._observable),this.toArray().map((t=>J(t)?t.toJSON(e):t))}toLocaleString(){return r(this._observable),this._items.toLocaleString()}toString(){return r(this._observable),this._items.toString()}unshift(...e){return r(this._observable),!e.length||this._emitBeforeChanges(h.ADD)||(this._splice(0,0,e),this._emitAfterChanges(h.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const n=this._items,a=this.itemType;let f,g;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=q((()=>this._dispatchChange()))),e<0&&(e+=this.length),t){if(g=n.splice(e,t),this.hasEventListener("before-remove")){const c=p.acquire();c.target=this,c.cancellable=!0;for(let l=0,u=g.length;l<u;l++)f=g[l],c.reset(f),this.emit("before-remove",c),c.defaultPrevented&&(g.splice(l,1),n.splice(e,0,f),e+=1,l-=1,u-=1);p.release(c)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const c=p.acquire();c.target=this,c.cancellable=!1;const l=g.length;for(let u=0;u<l;u++)c.reset(g[u]),this.emit("after-remove",c);p.release(c)}}if(i?.length){if(a){const o=[];for(const _ of i){const d=a.ensureType(_);d==null&&_!=null||o.push(d)}i=o}const c=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),u=e===this.length;if(c||l){const o=p.acquire();o.target=this,o.cancellable=!0;const _=p.acquire();_.target=this,_.cancellable=!1;for(const d of i)c?(o.reset(d),this.emit("before-add",o),o.defaultPrevented||(u?n.push(d):n.splice(e++,0,d),this._set("length",n.length),l&&(_.reset(d),this.emit("after-add",_)))):(u?n.push(d):n.splice(e++,0,d),this._set("length",n.length),_.reset(d),this.emit("after-add",_));p.release(_),p.release(o)}else{if(u)for(const o of i)n.push(o);else n.splice(e,0,...i);this._set("length",n.length)}}if((i?.length||g?.length)&&this._notifyChangeEvent(i,g),this.hasEventListener("after-splice")){const c=new K(this,i,g,e,t);this.emit("after-splice",c)}return g}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=p.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,p.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=p.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),p.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;b.clear(),y.clear(),v.clear();for(const{added:l,removed:u}of i){if(l)if(v.size===0&&y.size===0)for(const o of l)b.add(o);else for(const o of l)y.has(o)?(v.add(o),y.delete(o)):v.has(o)||b.add(o);if(u)if(v.size===0&&b.size===0)for(const o of u)y.add(o);else for(const o of u)b.has(o)?b.delete(o):(v.delete(o),y.add(o))}const n=O.acquire();b.forEach((l=>{n.push(l)}));const a=O.acquire();y.forEach((l=>{a.push(l)}));const f=this._items,g=t.items,c=O.acquire();if(v.forEach((l=>{g.indexOf(l)!==f.indexOf(l)&&c.push(l)})),t.listeners&&(n.length||a.length||c.length)){const l={target:this,added:n,removed:a,moved:c},u=t.listeners.length;for(let o=0;o<u;o++){const _=t.listeners[o];_.removed||_.callback.call(this,l)}}O.release(n),O.release(a),O.release(c)}b.clear(),y.clear(),v.clear()}},m=C,C.ofType=e=>{if(!e)return m;if(x.has(e))return x.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const n in e.typeMap){const a=e.typeMap[n].prototype.declaredClass;t?t+=` | ${a}`:t=a}let i=class extends m{};return A([F({Type:e,ensureType:typeof e=="function"?j(e):I(e)})],i.prototype,"itemType",void 0),i=A([R(`esri.core.Collection<${t}>`)],i),x.set(e,i),i},C);A([M()],E.prototype,"_updating",void 0),A([M()],E.prototype,"length",void 0),A([M()],E.prototype,"items",null),A([M({readOnly:!0})],E.prototype,"updating",null),E=m=A([R("esri.core.Collection")],E);const Y=E,w=new WeakMap;function B(s){return!s.destroyed&&(w.has(s)||s.addHandles([U((()=>{const e=s.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||B(e))}),(e=>w.set(s,e)),G),L((()=>w.delete(s)))]),w.get(s))}function ce(s){return s!=null&&typeof s=="object"&&"type"in s&&s.type==="feature"}function ue(s){return s!=null&&typeof s=="object"&&"type"in s&&s.type==="graphics"}function fe(s){return s!=null&&typeof s=="object"&&"type"in s&&s.type==="map-image"}function ge(s){return s!=null&&typeof s=="object"&&"type"in s&&s.type==="knowledge-graph"&&"layers"in s}function _e(s){return s!=null&&typeof s=="object"&&"type"in s&&s.type==="knowledge-graph-sublayer"}function pe(s){return s!=null&&typeof s=="object"&&"type"in s&&s.type==="subtype-group"&&"sublayers"in s}function de(s){return s?.type==="subtype-sublayer"}const me={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function be(s){const e=s?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function ye(s){return s==="integrated-mesh"||s==="integrated-mesh-3dtiles"}function ve(s){return s?.type==="feature"&&!s.url&&s.source?.type==="memory"}function Ee(s){const e=s?.type;return(e==="feature"||e==="subtype-group"||e==="oriented-imagery")&&s?.source?.type==="feature-layer"}async function Ae(s,e){const t=T?.findServerInfo(s);if(t?.currentVersion!=null)return t.owningSystemUrl||null;const i=s.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const n=`${s.slice(0,i)}/rest/info`,a=e!=null?e.signal:null,{data:f}=await N(n,{query:{f:"json"},responseType:"json",signal:a});return f?.owningSystemUrl||null}function Z(s){if(!("capabilities"in s))return!1;switch(s.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function Ce(s){return Z(s)?"effectiveCapabilities"in s?s.effectiveCapabilities:s.capabilities:null}function ee(s){if(!("editingEnabled"in s))return!1;switch(s.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function Oe(s){return!!ee(s)&&("effectiveEditingEnabled"in s?s.effectiveEditingEnabled:s.editingEnabled)}function Me(s){const e=new Y;for(const t of s.allLayers.concat(s.allTables))t.type==="csv"||B(t)||("charts"in t&&e.push(t),t.type==="subtype-group"&&e.push(...t.sublayers));return e}function te(s,e){return null}function we(s){return null}function se(s){return!s||s.type==="Feature Service"&&!s.sourceUrl}function De(s,e){!e||!se(s)||te(s.url)}export{Me as $,we as A,Ae as B,Ce as D,se as G,De as H,Oe as N,Z as P,Y as V,B as a,ge as c,de as g,me as h,be as j,ve as k,_e as l,F as n,ue as o,pe as p,fe as s,ce as u,ye as w,Ee as x,te as z};
