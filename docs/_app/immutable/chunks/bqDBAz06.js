import{V as d}from"./EnYQAt9i.js";import{K as L}from"./oKHlAiyk.js";import{x as S,_ as v,K as g}from"./BU-dfLkt.js";import{r as I}from"./gU8z3wlr.js";import{a as i}from"./o0B939Hd.js";function V(e){return e.portalItem?.type==="Web Scene"||e.referenceLayers.some((t=>t.type==="scene"))}function K(e){return!!e?.portalItem?.tags?.some((t=>t.toLowerCase()==="beta"))}function N(e,t){return e.allLayerViews.find((r=>r.uid===t))?.layer.parent===e.map?.basemap}function h(e){let t=null;const a=u(e),r=!a?.baseLayers.length;for(const n in i){const l=m(a,y(i[n]),{mustMatchReferences:r});if(l==="equal"){t=n;break}l==="base-layers-equal"&&(t=n)}return t}function j(e,t){return e===t||e?.portalItem?.id!=null&&e.portalItem.id===t?.portalItem?.id?!0:m(u(e),u(t),{mustMatchReferences:!0})==="equal"}function B(e){return!!e?.baseLayers.concat(e.referenceLayers).some(R)}function R(e){if(s(e.url))return!0;if(e.type==="vector-tile")for(const t in e.sourceNameToSource){const a=e.sourceNameToSource[t];if(s(a?.sourceUrl))return!0}return!1}function W(e,t){if(t==null||e==null)return{spatialReference:null,updating:!1};if(t.loadStatus==="not-loaded")return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(t.baseLayers.length===0)return{spatialReference:null,updating:!1};const a=t.baseLayers.at(0);switch(a.loadStatus){case"not-loaded":a.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?a.tileInfo?.spatialReference:a.spatialReference]).filter(Boolean),n=e.spatialReference;return n?{spatialReference:r.find((l=>n.equals(l)))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}const x=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function s(e){if(!e)return!1;const t=new S(v(e));return!!t.authority&&x.test(t.authority)}function u(e){return e?!e.loaded&&e.resourceInfo?y(e.resourceInfo.data):{baseLayers:c(e.baseLayers),referenceLayers:c(e.referenceLayers)}:null}function c(e){return(d.isCollection(e)?e.toArray():e).map(q)}function q(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:b("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null?void 0:e.sublayers?.map((t=>({id:t.id,visible:t.visible}))),activeLayerId:e.type==="wmts"?e.activeLayer?.id:void 0}}function f(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function y(e){return e?{baseLayers:o((e.baseMapLayers??[]).filter((t=>!f(t)))),referenceLayers:o((e.baseMapLayers??[]).filter((t=>f(t))))}:null}function o(e){return e.map((t=>w(t)))}function w(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:b(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function m(e,t,a){return e!=null!=(t!=null)?"not-equal":!e||!t?"equal":p(e.baseLayers,t.baseLayers)?p(e.referenceLayers,t.referenceLayers)?"equal":a.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function p(e,t){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!T(e[a],t[a]))return!1;return!0}function T(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity||!I(e.effect,t.effect))return!1;if(e.activeLayerId!=null||t.activeLayerId!=null)return e.activeLayerId===t.activeLayerId;if(e.sublayers!=null||t.sublayers!=null){if(e.sublayers==null||t.sublayers==null||e.sublayers.length!==t.sublayers.length)return!1;for(let a=0;a<e.sublayers.length;a++){const r=e.sublayers.at(a),n=t.sublayers.at(a);if(r?.id!==n?.id||r?.visible!==n?.visible)return!1}}return!0}function b(e){return e?g(e).replace(/^\s*https?:/i,"").toLowerCase():""}function _(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const a=h(e);return a?i[a].thumbnailUrl:L(e.baseLayers,U)}function U(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}export{R as b,N as c,W as d,_ as j,B as m,K as s,V as u,j as y};
