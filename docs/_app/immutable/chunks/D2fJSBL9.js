import{r as e,m as o,a as p,o as Ot,x as $,b as Ut,i as Pt,S as Wt}from"./DvUDi2Se.js";import{a as C}from"./DHdURl-u.js";import{V as E}from"./InWWYu7p.js";import{l as a,r as R,o as Tt}from"./Bx7Drccn.js";import{a as v}from"./CnfuZz2S.js";import{i as Vt}from"./BYatcg2i.js";import{S as zt}from"./DSvukMJ1.js";import{e as Dt}from"./DedWa6hQ.js";import{z as Gt,E as Kt,X as Xt}from"./BTFaZ95N.js";import{r as bt}from"./Hpj2QL01.js";import{Y as Ht}from"./BtRNH9HO.js";import{l as Yt}from"./CdZ5E7Js.js";import{a as Qt,c as Zt,p as te}from"./Db_cRbTq.js";let Y=class extends a{constructor(i){super(i),this.type=null}};e([o({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],Y.prototype,"type",void 0),Y=e([p("esri.popup.content.Content")],Y);const x=Y,H=new Ot({asc:"ascending",desc:"descending"});let B=class extends C.ClonableMixin(a){constructor(i){super(i),this.field=null,this.order="ascending"}};e([o({type:String,json:{write:!0}})],B.prototype,"field",void 0),e([o({type:H.apiValues,json:{type:H.jsonValues,read:H.read,write:H.write}})],B.prototype,"order",void 0),B=e([p("esri.popup.support.AttachmentsOrderByInfo")],B);const ee=B;let I=class extends C.ClonableMixin(x){constructor(i){super(i),this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};e([o({type:String,json:{write:!0}})],I.prototype,"description",void 0),e([o({type:["auto","preview","list"],json:{write:!0}})],I.prototype,"displayType",void 0),e([o({type:[ee],json:{write:!0}})],I.prototype,"orderByFields",void 0),e([o({type:String,json:{write:!0}})],I.prototype,"title",void 0),e([o({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],I.prototype,"type",void 0),I=e([p("esri.popup.content.AttachmentsContent")],I);const V=I;var nt;let j=nt=class extends x{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new nt({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?v(this.outFields):null})}};e([o()],j.prototype,"creator",void 0),e([o()],j.prototype,"destroyer",void 0),e([o()],j.prototype,"outFields",void 0),e([o({type:["custom"],readOnly:!0})],j.prototype,"type",void 0),j=nt=e([p("esri.popup.content.CustomContent")],j);const ie=j;var pt;let O=pt=class extends a{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new pt({title:this.title,expression:this.expression})}};e([o({type:String,json:{write:!0}})],O.prototype,"title",void 0),e([o({type:String,json:{write:!0}})],O.prototype,"expression",void 0),e([o({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],O.prototype,"returnType",void 0),O=pt=e([p("esri.popup.ElementExpressionInfo")],O);const oe=O;var lt;let k=lt=class extends x{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new lt({expressionInfo:this.expressionInfo?.clone()})}};e([o({type:oe,json:{write:!0}})],k.prototype,"expressionInfo",void 0),e([o({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],k.prototype,"type",void 0),k=lt=e([p("esri.popup.content.ExpressionContent")],k);const it=k;let T=class extends C.ClonableMixin(a){constructor(i){super(i),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};e([bt(Ht)],T.prototype,"dateFormat",void 0),e([o({type:Boolean,json:{write:!0}})],T.prototype,"digitSeparator",void 0),e([o({type:$,json:{write:!0}})],T.prototype,"places",void 0),T=e([p("esri.popup.support.FieldInfoFormat")],T);const re=T;var at;let c=at=class extends a{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new at({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};e([o({type:String,json:{write:!0}})],c.prototype,"fieldName",void 0),e([o({type:re,json:{write:!0}})],c.prototype,"format",void 0),e([o({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],c.prototype,"isEditable",void 0),e([o({type:String,json:{write:!0}})],c.prototype,"label",void 0),e([bt(new Ot({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],c.prototype,"stringFieldOption",void 0),e([o({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],c.prototype,"statisticType",void 0),e([o({type:String,json:{write:!0}})],c.prototype,"tooltip",void 0),e([o({type:Boolean,json:{write:!0}})],c.prototype,"visible",void 0),c=at=e([p("esri.popup.FieldInfo")],c);const At=c;var dt;let m=dt=class extends x{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,i){i.fieldInfos=t&&t.map((r=>r.toJSON()))}clone(){return new dt(v({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};e([o({type:Object,json:{write:!0}})],m.prototype,"attributes",void 0),e([o({type:String,json:{write:!0}})],m.prototype,"description",void 0),e([o({type:[At]})],m.prototype,"fieldInfos",void 0),e([R("fieldInfos")],m.prototype,"writeFieldInfos",null),e([o({type:String,json:{write:!0}})],m.prototype,"title",void 0),e([o({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],m.prototype,"type",void 0),m=dt=e([p("esri.popup.content.FieldsContent")],m);const z=m;let N=class extends a{constructor(i){super(i),this.altText=null,this.caption="",this.title="",this.type=null}};e([o({type:String,json:{write:!0}})],N.prototype,"altText",void 0),e([o({type:String,json:{write:!0}})],N.prototype,"caption",void 0),e([o({type:String,json:{write:!0}})],N.prototype,"title",void 0),e([o({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],N.prototype,"type",void 0),N=e([p("esri.popup.content.mixins.MediaInfo")],N);const St=N;var ut;let b=ut=class extends Ut{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new ut({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};e([o()],b.prototype,"color",void 0),e([o()],b.prototype,"fieldName",void 0),e([o()],b.prototype,"tooltip",void 0),e([o()],b.prototype,"value",void 0),b=ut=e([p("esri.popup.content.support.ChartMediaInfoValueSeries")],b);const se=b;var ct;let g=ct=class extends a{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new ct({colors:v(this.colors),fields:v(this.fields),normalizeField:this.normalizeField,series:v(this.series),tooltipField:this.tooltipField})}};e([o({type:[Yt],json:{type:[[$]],write:!0}})],g.prototype,"colors",void 0),e([o({type:[String],json:{write:{isRequired:!0}}})],g.prototype,"fields",void 0),e([o({type:String,json:{write:!0}})],g.prototype,"normalizeField",void 0),e([o({type:[se],json:{read:!1}})],g.prototype,"series",void 0),e([o({type:String,json:{write:!0}})],g.prototype,"tooltipField",void 0),g=ct=e([p("esri.popup.content.support.ChartMediaInfoValue")],g);const ne=g;let J=class extends St{constructor(i){super(i),this.type=null,this.value=void 0}};e([o({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],J.prototype,"type",void 0),e([o({type:ne,json:{write:{isRequired:!0}}})],J.prototype,"value",void 0),J=e([p("esri.popup.content.mixins.ChartMediaInfo")],J);const ot=J,rt=Pt()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var yt;let Q=yt=class extends ot{constructor(t){super(t),this.type="bar-chart"}clone(){return new yt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};e([o({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:rt.write,isRequired:!0}}})],Q.prototype,"type",void 0),Q=yt=e([p("esri.popup.content.BarChartMediaInfo")],Q);const Mt=Q;var ht;let Z=ht=class extends ot{constructor(t){super(t),this.type="column-chart"}clone(){return new ht({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};e([o({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:rt.write,isRequired:!0}}})],Z.prototype,"type",void 0),Z=ht=e([p("esri.popup.content.ColumnChartMediaInfo")],Z);const Et=Z;var ft;let L=ft=class extends a{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new ft({linkURL:this.linkURL,sourceURL:this.sourceURL})}};e([o({type:String,json:{write:!0}})],L.prototype,"linkURL",void 0),e([o({type:String,json:{write:{isRequired:!0}}})],L.prototype,"sourceURL",void 0),L=ft=e([p("esri.popup.content.support.ImageMediaInfoValue")],L);const pe=L;var mt;let A=mt=class extends St{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new mt({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};e([o({type:Number,json:{write:!0}})],A.prototype,"refreshInterval",void 0),e([o({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],A.prototype,"type",void 0),e([o({type:pe,json:{write:{isRequired:!0}}})],A.prototype,"value",void 0),A=mt=e([p("esri.popup.content.ImageMediaInfo")],A);const Bt=A;var wt;let tt=wt=class extends ot{constructor(t){super(t),this.type="line-chart"}clone(){return new wt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};e([o({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:rt.write,isRequired:!0}}})],tt.prototype,"type",void 0),tt=wt=e([p("esri.popup.content.LineChartMediaInfo")],tt);const kt=tt;var vt;let et=vt=class extends ot{constructor(t){super(t),this.type="pie-chart"}clone(){return new vt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};e([o({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:rt.write,isRequired:!0}}})],et.prototype,"type",void 0),et=vt=e([p("esri.popup.content.PieChartMediaInfo")],et);const Jt=et,xt={base:St,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Mt,"column-chart":Et,"line-chart":kt,"pie-chart":Jt,image:Bt}};var It;let y=It=class extends x{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map((i=>i.type==="image"?Bt.fromJSON(i):i.type==="barchart"?Mt.fromJSON(i):i.type==="columnchart"?Et.fromJSON(i):i.type==="linechart"?kt.fromJSON(i):i.type==="piechart"?Jt.fromJSON(i):void 0)).filter(Boolean)}writeMediaInfos(t,i){i.mediaInfos=t&&t.map((r=>r.toJSON()))}clone(){return new It(v({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};e([o()],y.prototype,"activeMediaInfoIndex",void 0),e([o({type:Object,json:{write:!0}})],y.prototype,"attributes",void 0),e([o({type:String,json:{write:!0}})],y.prototype,"description",void 0),e([o({types:[xt]})],y.prototype,"mediaInfos",void 0),e([Tt("mediaInfos")],y.prototype,"readMediaInfos",null),e([R("mediaInfos")],y.prototype,"writeMediaInfos",null),e([o({type:String,json:{write:!0}})],y.prototype,"title",void 0),e([o({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],y.prototype,"type",void 0),y=It=e([p("esri.popup.content.MediaContent")],y);const D=y;var gt;let q=gt=class extends a{constructor(t){super(t),this.field=null,this.order=null}clone(){return new gt({field:this.field,order:this.order})}};e([o({type:String,json:{write:!0}})],q.prototype,"field",void 0),e([o({type:["asc","desc"],json:{write:!0}})],q.prototype,"order",void 0),q=gt=e([p("esri.popup.support.RelatedRecordsInfoFieldOrder")],q);const Lt=q;let f=class extends C.ClonableMixin(x){constructor(t){super(t),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};e([o({type:String,json:{write:!0}})],f.prototype,"description",void 0),e([o({type:Number,json:{type:$,write:!0}})],f.prototype,"displayCount",void 0),e([o({type:["list"],json:{write:{isRequired:!0}}})],f.prototype,"displayType",void 0),e([o({type:[Lt],json:{write:!0}})],f.prototype,"orderByFields",void 0),e([o({type:Number,json:{type:$,write:{isRequired:!0}}})],f.prototype,"relationshipId",void 0),e([o({type:String,json:{write:!0}})],f.prototype,"title",void 0),e([o({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],f.prototype,"type",void 0),f=e([p("esri.popup.content.RelationshipContent")],f);const G=f;var Ft;let U=Ft=class extends x{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new Ft({text:this.text})}};e([o({type:String,json:{write:!0}})],U.prototype,"text",void 0),e([o({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],U.prototype,"type",void 0),U=Ft=e([p("esri.popup.content.TextContent")],U);const K=U;let w=class extends C.ClonableMixin(a){constructor(i){super(i),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};e([o({type:String,json:{write:!0}})],w.prototype,"title",void 0),e([o({type:String,json:{write:!0}})],w.prototype,"description",void 0),e([o({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],w.prototype,"type",void 0),e([o({type:Number,json:{type:$,write:!0}})],w.prototype,"associatedNetworkSourceId",void 0),e([o({type:Number,json:{type:$,write:!0}})],w.prototype,"associatedAssetGroup",void 0),e([o({type:Number,json:{type:$,write:!0}})],w.prototype,"associatedAssetType",void 0),w=e([p("esri.popup.support.UtilityNetworkAssociationType")],w);const le=w;let F=class extends C.ClonableMixin(x){constructor(i){super(i),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};e([o({type:String,json:{write:!0}})],F.prototype,"description",void 0),e([o({type:Number,json:{type:$,write:!0}})],F.prototype,"displayCount",void 0),e([o({type:String,json:{write:!0}})],F.prototype,"title",void 0),e([o({type:[le],json:{write:!0}})],F.prototype,"associationTypes",void 0),e([bt({utilityNetworkAssociations:"utility-network-associations"})],F.prototype,"type",void 0),F=e([p("esri.popup.content.UtilityNetworkAssociationsContent")],F);const Rt=F,ae={base:null,key:"type",typeMap:{attachment:V,media:D,text:K,expression:it,field:z,relationship:G,utilityNetworkAssociations:Rt}},de={base:null,key:"type",typeMap:{attachment:V,media:D,text:K,expression:it,field:z,relationship:G}};var $t;let S=$t=class extends a{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new $t({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};e([o({type:String,json:{write:!0}})],S.prototype,"name",void 0),e([o({type:String,json:{write:!0}})],S.prototype,"title",void 0),e([o({type:String,json:{write:!0}})],S.prototype,"expression",void 0),e([o({type:["string","number"],json:{write:!0}})],S.prototype,"returnType",void 0),S=$t=e([p("esri.popup.ExpressionInfo")],S);const ue=S;var jt;let P=jt=class extends a{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new jt({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};e([o({type:Boolean,json:{write:!0}})],P.prototype,"returnTopmostRaster",void 0),e([o({type:Boolean,json:{write:!0}})],P.prototype,"showNoDataRecords",void 0),P=jt=e([p("esri.popup.LayerOptions")],P);const ce=P;var Nt;let W=Nt=class extends a{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Nt({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?v(this.orderByFields):null})}};e([o({type:Boolean,json:{write:!0}})],W.prototype,"showRelatedRecords",void 0),e([o({type:[Lt],json:{write:!0}})],W.prototype,"orderByFields",void 0),W=Nt=e([p("esri.popup.RelatedRecordsInfo")],W);const Ct=W,M="relationships/",_t="expression/",ye=E.ofType({key:"type",defaultKeyValue:"button",base:te,typeMap:{button:Zt,toggle:Qt}}),he={base:x,key:"type",typeMap:{media:D,custom:ie,text:K,attachments:V,fields:z,expression:it,relationship:G,utilityNetworkAssociations:Rt}},qt=new Set(["attachments","fields","media","text","expression","relationship"]),fe=new Set([...qt,"utility-network-associations"]);let l=class extends C.ClonableMixin(a){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(t){return Array.isArray(t)?t.map((i=>Wt(he,i))):typeof t=="string"||typeof t=="function"||t instanceof HTMLElement||zt(t)?t:(Vt.getLogger(this).error("content error","unsupported content value",{value:t}),null)}readContent(t,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeWebSceneContent(t,i,r,s){this._writePopupTemplateContent(t,i,s)}writeWebMapContent(t,i,r,s){this._writePopupTemplateContent(t,i,s)}writeFieldInfos(t,i,r,s){const{content:n}=this,d=Array.isArray(n)?n:null;if(t){const u=d?d.filter((h=>h.type==="fields")):[],_=u.length&&u.every((h=>h.fieldInfos?.length));i.fieldInfos=t.filter(Boolean).map((h=>{const X=h.toJSON(s);return _&&(X.visible=!1),X}))}if(d)for(const u of d)u.type==="fields"&&this._writeFieldsContent(u,i)}writeLayerOptions(t,i,r,s){i[r]=!t||t.showNoDataRecords===null&&t.returnTopmostRaster===null?null:t.toJSON(s)}writeTitle(t,i){i.title=t||""}async collectRequiredFields(t,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(t,i,[...r,...this._getContentExpressionInfos(this.content,r)]),Gt(t,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(t){const i=new Set;return await this.collectRequiredFields(i,t),[...i].sort()}_writePopupTemplateContent(t,i,r){typeof t!="string"?Array.isArray(t)&&(i.popupElements=t.filter((s=>r?.origin==="web-scene"?qt.has(s.type):fe.has(s.type))).map((s=>s?.toJSON(r))),i.popupElements.forEach((s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)}))):i.description=t}_writeFieldsContent(t,i){if(!Array.isArray(t.fieldInfos)||!t.fieldInfos.length)return;const r=v(t.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach((s=>{const n=i.fieldInfos.find((d=>d.fieldName?.toLowerCase()===s.fieldName?.toLowerCase()));n?n.visible=!0:i.fieldInfos.push(s)})):i.fieldInfos=r}_writeAttachmentContent(t){t.showAttachments||(t.showAttachments=!0)}_writeRelationshipContent(t,i){const r=t.orderByFields?.map((n=>this._toFieldOrderJSON(n,t.relationshipId)))||[],s=[...i.relatedRecordsInfo?.orderByFields||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(t,i){!i.description&&t.text&&(i.description=t.text)}_writeMediaContent(t,i){if(!Array.isArray(t.mediaInfos)||!t.mediaInfos.length)return;const r=v(t.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(t,i,r){const s={description:!1,mediaInfos:!1};return r.map((n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),D.fromJSON(n)):n.type==="text"?(n.text||!t||s.description||(n.text=t,s.description=!0),K.fromJSON(n)):n.type==="attachments"?V.fromJSON(n):n.type==="fields"?z.fromJSON(n):n.type==="expression"?it.fromJSON(n):n.type==="relationship"?G.fromJSON(n):n.type==="utilityNetworkAssociations"?Rt.fromJSON(n):void 0)).filter(Boolean)}_toRelationshipContent(t){const{field:i,order:r}=t;if(!i?.startsWith(M))return null;const s=i.replace(M,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),d=s[1];return!Number.isNaN(n)&&d?G.fromJSON({relationshipId:n,orderByFields:[{field:d,order:r}]}):null}_toFieldOrderJSON(t,i){const{order:r,field:s}=t;return{field:`${M}${i}/${s}`,order:r}}_readPopupInfo({description:t,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];t?n.push(new K({text:t})):n.push(new z),Array.isArray(i)&&i.length&&n.push(D.fromJSON({mediaInfos:i})),r&&n.push(V.fromJSON({displayType:"auto"}));const{showRelatedRecords:d,orderByFields:u}=s;return d&&u?.length&&u.forEach((_=>{const h=this._toRelationshipContent(_);h&&n.push(h)})),n.length?n:t}_getContentElementFields(t){const i=t?.type;if(i==="attachments")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)];if(i==="custom")return t.outFields||[];if(i==="fields")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...this._getFieldInfoFields(t.fieldInfos??this.fieldInfos)];if(i==="media"){const r=t.mediaInfos||[];return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...r.reduce(((s,n)=>[...s,...this._getMediaInfoFields(n)]),[])]}return i==="text"?this._extractFieldNames(t.text):i==="relationship"||i==="utility-network-associations"?[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)]:[]}_getMediaInfoFields(t){const{caption:i,title:r,value:s}=t,n=s||{},{fields:d,normalizeField:u,tooltipField:_,sourceURL:h,linkURL:X}=n,st=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(h),...this._extractFieldNames(X),...d??[]];return u&&st.push(u),_&&st.push(_),st}_getContentExpressionInfos(t,i){return Array.isArray(t)?t.reduce(((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]]),i):[]}_getContentFields(t){return typeof t=="string"?this._extractFieldNames(t):Array.isArray(t)?t.reduce(((i,r)=>[...i,...this._getContentElementFields(r)]),[]):[]}async _collectExpressionInfoFields(t,i,r){r&&await Promise.all(r.map((s=>Kt(t,i,s.expression))))}_getFieldInfoFields(t){return t?t.filter((({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(M)||i.startsWith(_t)))).map((i=>i.fieldName)):[]}_getActionsFields(t){return t?t.toArray().reduce(((i,r)=>[...i,...this._getActionFields(r)]),[]):[]}_getActionFields(t){const{className:i,title:r,type:s}=t,n=s==="button"||s==="toggle"?t.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(t){return typeof t=="string"?this._extractFieldNames(t):[]}_extractFieldNames(t){return Xt(t).filter((i=>!(i.indexOf(M)===0||i.indexOf(_t)===0)))}};e([o({type:ye})],l.prototype,"actions",void 0),e([o()],l.prototype,"content",void 0),e([Dt("content")],l.prototype,"castContent",null),e([Tt("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],l.prototype,"readContent",null),e([R("web-scene","content",{popupElements:{type:E.ofType(de)},showAttachments:{type:Boolean},mediaInfos:{type:E.ofType(xt)},description:{type:String},relatedRecordsInfo:{type:Ct}})],l.prototype,"writeWebSceneContent",null),e([R("content",{popupElements:{type:E.ofType(ae)},showAttachments:{type:Boolean},mediaInfos:{type:E.ofType(xt)},description:{type:String},relatedRecordsInfo:{type:Ct}})],l.prototype,"writeWebMapContent",null),e([o({type:[ue],json:{write:!0}})],l.prototype,"expressionInfos",void 0),e([o({type:[At]})],l.prototype,"fieldInfos",void 0),e([R("fieldInfos")],l.prototype,"writeFieldInfos",null),e([o({type:ce})],l.prototype,"layerOptions",void 0),e([R("layerOptions")],l.prototype,"writeLayerOptions",null),e([o({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],l.prototype,"lastEditInfoEnabled",void 0),e([o()],l.prototype,"outFields",void 0),e([o()],l.prototype,"overwriteActions",void 0),e([o()],l.prototype,"returnGeometry",void 0),e([o({json:{type:String}})],l.prototype,"title",void 0),e([R("title")],l.prototype,"writeTitle",null),l=e([p("esri.PopupTemplate")],l);const ke=l;export{D as I,V as a,Lt as b,le as c,z as d,ee as e,K as f,oe as g,ue as i,re as m,At as n,se as p,ke as q};
