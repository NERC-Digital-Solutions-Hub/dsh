const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CWEv4_tx.js","./Dg2Cy1wG.js","./DvUDi2Se.js","./CnfuZz2S.js","./BYatcg2i.js","./DSvukMJ1.js","./DedWa6hQ.js","./PPVm8Dsz.js","./CbAk7Q2g.js","./InWWYu7p.js","./BtRNH9HO.js","./C3DztaFN.js","./Fd-zc6xv.js","./Cfk1RgA5.js","./CJqWAG8q.js","./Bs5I5-7o.js","./Bx7Drccn.js","./BDErjlP0.js","./D6KPPgz5.js","./elf00Mmu.js","./BTzO5B6K.js","./DZd6gJy7.js","./DXQ1SMQZ.js","./DBpg6XpS.js","./DP1E39gi.js","./DqMVdTcb.js","./Bstk8l7f.js","./BNRAtZeH.js","./DbI_LlRP.js","./C-b0kuzB.js","./CWwez7Ew.js","./BfuGwL9X.js"])))=>i.map(i=>d[i]);
import{r as o,m as a,a as y,x as T,w as D,b as U}from"./DvUDi2Se.js";import{a as x,O as g}from"./JZrX1DQH.js";import{_ as A}from"./PPVm8Dsz.js";import{l as J}from"./CdZ5E7Js.js";import{V as w}from"./InWWYu7p.js";import{n as V}from"./CLdLWz9D.js";import{M as z,a as N}from"./CnfuZz2S.js";import{i as $,s as k}from"./BYatcg2i.js";import{l as h,r as H,o as Q}from"./Bx7Drccn.js";import{p as W}from"./Bstk8l7f.js";import{t as K}from"./BJ6KxFoX.js";import{b as X,u as _,s as I}from"./DSvukMJ1.js";import{r as Y}from"./Hpj2QL01.js";import{r as Z,n as ee,a as j}from"./DHdURl-u.js";import{l as M}from"./B8bQhW-6.js";import{o as te}from"./BtRNH9HO.js";import{i as re,H as oe,x as se,e as F}from"./DedWa6hQ.js";import{n as ae}from"./Cl5lrJ4c.js";import{v as ie}from"./CSgXBDAV.js";import{l as f}from"./Bcw4sJLc.js";import{a as ne}from"./Cfk1RgA5.js";import{D as le,N as pe}from"./Dg2Cy1wG.js";import"./CbAk7Q2g.js";import"./Djp3mnm5.js";import"./BkkzFYiK.js";import{l as ue,a as de,t as ye}from"./BfvMWYA7.js";var C;let b=C=class extends h{constructor(e){super(e),this.type="none"}clone(){return new C({type:this.type})}};o([Y({none:"none",stayAbove:"stay-above"}),a({json:{write:{isRequired:!0}}})],b.prototype,"type",void 0),b=C=o([y("esri.ground.NavigationConstraint")],b);const ce=Symbol("GroundInstance");var G,E,q;let p=E=(q=class extends h.JSONSupportMixin(W){constructor(e){super(e),this[G]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new w;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&$.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},s=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",(r=>t(r.item))),this.layers.on("after-remove",(r=>s(r.item)))])}initialize(){this.when().catch((e=>{X(e)||$.getLogger(this).error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)_(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",V(e,this._get("layers")))}writeLayers(e,t,s,r){const n=[];e&&(r={...r,layerContainerType:"ground"},e.forEach((l=>{if("write"in l){const d={};z(l)().write(d,r)&&n.push(d)}else r?.messages&&r.messages.push(new k("layer:unsupported",`Layers (${l.title}, ${l.id}) of type '${l.declaredClass}' cannot be persisted in the ground`,{layer:l}))}))),t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return K(this,(e=>{e(this.layers)}))}async queryElevation(e,t){await this.load({signal:t?.signal});const{ElevationQuery:s}=await A(()=>import("./CWEv4_tx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url);I(t);const r=new s,n=this.layers.filter(R).toArray();return r.queryAll(n,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{ElevationQuery:s}=await A(()=>import("./CWEv4_tx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url);I(t);const r=new s,n=this.layers.filter(R).toArray();return r.createSamplerAll(n,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:N(this.surfaceColor),navigationConstraint:N(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new E({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,s){const r=t?.origin||"web-scene",n=t?.portal||null,l=t?.url||null,{populateOperationalLayers:d}=await A(async()=>{const{populateOperationalLayers:S}=await import("./DXQ1SMQZ.js");return{populateOperationalLayers:S}},__vite__mapDeps([22,9,2,3,4,5,10,11,12,8,23,24,1,6,7,13,14,25,26,16,15,27,28,29,30,19,17,18,20,31]),import.meta.url);I(s);const c=[];if(e.layers&&Array.isArray(e.layers)){const S={context:{origin:r,url:l,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};c.push(d(this.layers,e.layers,S))}await Promise.allSettled(c)}},G=ce,q);function me(e){return e&&"createElevationSampler"in e}function R(e){return e.type==="elevation"||me(e)}o([a({json:{read:!1,write:{isRequired:!0}}})],p.prototype,"layers",null),o([H("layers")],p.prototype,"writeLayers",null),o([a({readOnly:!0})],p.prototype,"resourceInfo",void 0),o([a({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:T,read:{reader:Z,source:"transparency"},write:{writer:(e,t)=>{t.transparency=ee(e)},target:"transparency"}}})],p.prototype,"opacity",void 0),o([a({type:J,json:{type:[T],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],p.prototype,"surfaceColor",void 0),o([a({type:b,json:{write:!0}})],p.prototype,"navigationConstraint",void 0),p=E=o([y("esri.Ground")],p);const L=p;let v=class extends j.ClonableMixin(h){constructor(t){super(t),this.color=null}};o([a({type:J,json:{type:[T],write:!0}})],v.prototype,"color",void 0),v=o([y("esri.effects.FocusAreaOutline")],v);const fe=v;let u=class extends h.JSONSupportMixin(j){constructor(e){super(e),this.id=`focusarea-${ae()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new f}readGeometries(e,t,s){Array.isArray(e)?this.geometries=f.fromJSON(e,s):s.hooks?.onAfterLoad?.((()=>this._loadGeometries(re(e,s),s)))}async _loadGeometries(e,t){const s=await oe(e,{responseType:"json"});this.geometries=f.fromJSON(s.data,t)}};o([a({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),a()],u.prototype,"id",void 0),o([a({type:String,json:{write:!0}})],u.prototype,"title",void 0),o([a({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],u.prototype,"enabled",void 0),o([a({type:fe,json:{write:!0}})],u.prototype,"outline",void 0),o([a({type:f,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new f(e.items.map((t=>t.clone())))}),ie({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],u.prototype,"geometries",void 0),o([Q(["web-scene","portal-item"],"geometries")],u.prototype,"readGeometries",null),u=o([y("esri.effects.FocusArea")],u);const he=u;let m=class extends h.JSONSupportMixin(j){constructor(e){super(e),this.areas=new w,this.style="bright"}};o([a({type:w.ofType(he),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new w(e.items.map((t=>t.clone())))})],m.prototype,"areas",void 0),o([a({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],m.prototype,"style",void 0),m=o([y("esri.effects.FocusAreas")],m);const B=m;function ge(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function be(e){return!(!ge(e)||!le(e)?.operations?.supportsEditing||"editingEnabled"in e&&!pe(e)||ne(e))}const O=()=>$.getLogger("esri.support.basemapUtils");function ve(){return{}}function we(e){for(const t in e){const s=e[t];_(s),delete e[t]}}function $e(e,t){let s;if(typeof e=="string"){const r=e in x,n=!r&&e.includes("/");if(!r&&!n){if(se())O().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const l=Object.entries(x).filter((([d,c])=>c.classic||c.is3d)).map((([d])=>`"${d}"`)).sort().join(", ");O().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`)}return null}t&&(s=t[e]),s||(s=r?g.fromId(e):new g({style:{id:e}}),t&&(t[e]=s))}else s=D(g,e);return s?.destroyed&&(O().warn("The provided basemap is already destroyed",{basemap:s}),s=null),s}const P={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function _e(e){let t=null;if(typeof e=="string")if(e in P){const s=P[e];t=new L({resourceInfo:{data:{layers:[s]}}})}else $.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=D(L,e);return t}let i=class extends ue(de(te.EventedMixin(U))){constructor(e){super(e),this.allLayers=new M({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.focusAreas=new B,this.allTables=ye(this),this.basemap=null,this.editableLayers=new M({getCollections:()=>[this.allLayers],itemFilterFunction:be}),this.ground=new L,this._basemapCache=ve()}destroy(){we(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=_(this.basemap),_(this.ground),this._set("ground",null)}castBasemap(e){return $e(e,this._basemapCache)}castGround(e){return _e(e)??this._get("ground")}findLayerById(e){return this.allLayers.find((t=>t.id===e))}findTableById(e){return this.allTables.find((t=>t.id===e))}};o([a({readOnly:!0,dependsOn:[]})],i.prototype,"allLayers",void 0),o([a({type:B,nonNullable:!0,json:{write:{overridePolicy:e=>({enabled:e.areas.length>0,ignoreOrigin:!0})}}})],i.prototype,"focusAreas",void 0),o([a({readOnly:!0})],i.prototype,"allTables",void 0),o([a({type:g,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],i.prototype,"basemap",void 0),o([F("basemap")],i.prototype,"castBasemap",null),o([a({readOnly:!0})],i.prototype,"editableLayers",void 0),o([a({type:L,nonNullable:!0})],i.prototype,"ground",void 0),o([F("ground")],i.prototype,"castGround",null),o([a()],i.prototype,"undoRedo",void 0),i=o([y("esri.Map")],i);const Le=i,Xe=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{Le as L,Xe as M,be as e};
