import{b as j,P as I,c as G}from"./DUQhet5j.js";import{a as c}from"./B2reeZpr.js";import{o as M,n as W,e as L,g as P,f as p,l as V,A as Z}from"./D8DYOP_H.js";function B(e){return e?.release&&typeof e.release=="function"}function H(e){return e?.acquire&&typeof e.acquire=="function"}var a;let C=(a=class{constructor(t,s,n,r=1,i=0){this._creator=t,this._acquireFunction=s,this._releaseFunction=n,this.allocationSize=r,this._pool=new Array(i),this._initialSize=i;for(let u=0;u<i;u++)this._pool[u]=this._creator();this.allocationSize=Math.max(r,1)}destroy(){this.prune(0)}acquire(...t){let s;if(a.test.disabled)s=this._creator();else{if(this._pool.length===0){const n=this.allocationSize;for(let r=0;r<n;r++)this._pool[r]=this._creator()}s=this._pool.pop()}return this._acquireFunction?this._acquireFunction(s,...t):H(s)&&s.acquire(...t),s}release(t){t&&!a.test.disabled&&(this._releaseFunction?this._releaseFunction(t):B(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let s=t;s<this._pool.length;++s){const n=this._pool[s];this._dispose(n)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}},a.test={disabled:!!j("esri-tests-disable-memory-pools")},a);function J(e){e.length=0}let z=class{constructor(t=50,s=50){this._pool=new C(()=>[],void 0,J,s,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return w.acquire()}static release(t){return w.release(t)}static prune(){w.prune()}};const w=new z(100);function R(e,t){const s=e.endsWith("?")?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const r=parseInt(s,10);if(!isNaN(r))return Array.isArray(t)?t[r]:t.at(r)}const n=W(t);return L(n,s)?n.get(s):t[s]}function A(e,t,s){if(e==null)return e;const n=R(t[s],e);return!n&&s<t.length-1?void 0:s===t.length-1?n:A(n,t,s+1)}function q(e,t,s=0){return typeof t!="string"||t.includes(".")?A(e,M(t),s):R(t,e)}function yt(e,t){return q(e,t)}function mt(e,t){return q(t,e)!==void 0}const k={INITIALIZING:0,CONSTRUCTING:1,CONSTRUCTED:2,DESTROYING:3,DESTROYED:4};let K=class extends C{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...t){const s=super.acquire(...t);return this._set.delete(s),s}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}};function Q(e,t){for(const s of e.values())if(t(s))return!0;return!1}function E(e,t){if(!t)return e;for(const s of t)s!=null&&e.add(s);return e}function gt(e,t){return t!=null&&e.add(t),e}function X(e,t){const s=new Set;return E(s,e),E(s,t),s}function tt(e,t){const s=new Set;for(const n of t)e.has(n)&&s.add(n);return s}function qt(e,t){if(!e||!t)return!1;if(e===t)return!0;for(const s of e)if(!t.has(s))return!1;return!0}function wt(e,t){if(e==null&&t==null)return!0;if(e==null||t==null||e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}function et(e,t){const s=new Set(e);for(const n of t)s.delete(n);return s}function St(e,t){return et(X(e,t),tt(e,t))}let st=0;function S(){return++st}class T extends P{constructor(t){super(new nt(t)),this._observer&&D.register(this,new WeakRef(this._observer),this)}destroy(){this._observer&&D.unregister(this._observer),this.accessed?.clear(),this.clear(),this._observer?.destroy()}}let nt=class{constructor(t){this._notify=t,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}destroy(){this.destroyed=!0,this._notify=rt}};const D=new FinalizationRegistry(e=>{e.deref()?.destroy()});function rt(){}let h=!1;const y=[];function N(e,t){let s=new T(i),n=null,r=!1;function i(){if(!s||r)return;if(h)return void F(i);const o=n;s.clear(),h=!0,r=!0,n=p(s,e),r=!1,h=!1,t(n,o),U()}function u(){s&&(s.destroy(),s=null,n=null)}return r=!0,n=p(s,e),r=!1,c(u)}function O(e,t){let s=new T(r),n=null;function r(){t(n,u)}function i(){s&&(s.destroy(),s=null),n=null}function u(){return s?(s.clear(),n=p(s,e),n):null}return u(),c(i)}function kt(e,t){let s=!1,n=!1;const r=!!t?.sync;let i=new T(()=>{s||n||(n=!0,r?u():queueMicrotask(u))});function u(){n=!1,i&&!s&&(h?F(u):(i.clear(),h=!0,s=!0,p(i,e),s=!1,h=!1,U()))}function o(){i&&(i.destroy(),i=null)}return s=!0,p(i,e),s=!1,c(o)}function F(e){y.includes(e)||y.unshift(e)}function U(){for(;y.length;)y.pop()()}const g=class g{constructor(){this.uid=S(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,s,n,r,i){return this.pool.acquire(0,t,s,n,r,i,I)}static acquireTracked(t,s,n,r){return this.pool.acquire(1,t,s,n,null,null,r)}notify(t,s){this.type===0?this.callback.call(this.target,t,s,this.path,this.target):this.callback.call(null,t,s,void 0,void 0)}acquire(t,s,n,r,i,u,o){this.uid=S(),this.removed=!1,this.type=t,this.oldValue=s,this.callback=n,this.getValue=r,this.target=i,this.path=u,this.equals=o}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=S(),this.removed=!0}};g.pool=new K(()=>new g);let _=g;const v=new z,l=new Set;let m;function $(e){l.delete(e),l.add(e),it()}function it(){m||(m=Z(ut))}function ot(e){if(e.removed)return;const t=e.oldValue,s=e.getValue();e.equals(t,s)||(e.oldValue=s,e.notify(s,t))}function Tt(e){for(const t of l.values())t.target===e&&(t.removed=!0)}function ut(){let e=10;for(;m&&e--;){m=null;const t=lt(),s=v.acquire();for(const n of t){const r=n.uid;ot(n),r===n.uid&&n.removed&&s.push(n)}for(const n of l)n.removed&&(s.push(n),l.delete(n));for(const n of s)_.pool.release(n);v.release(s),v.release(t),b.forEach(n=>n())}}function lt(){const e=v.acquire();e.length=l.size;let t=0;for(const s of l)e[t]=s,++t;return l.clear(),e}const b=new Set;function Et(e){return b.add(e),c(()=>b.delete(e))}function at(e,t,s){let n=V(e,t,s,(r,i,u)=>{let o,f,d=O(()=>q(r,i),(Y,x)=>{r.__accessor__?.lifecycle===k.DESTROYED||o&&o.uid!==f?n.remove():(o||(o=_.acquireUntracked(Y,u,x,r,i),f=o.uid),$(o))});return c(()=>{d.remove(),o&&(o.uid!==f||o.removed||(o.removed=!0,$(o)),o=null),n=d=null})});return n}function ct(e,t,s){const n=V(e,t,s,(r,i,u)=>{let o=!1;return N(()=>q(r,i),(f,d)=>{r.__accessor__.lifecycle!==k.DESTROYED?o||(o=!0,I(d,f)||u.call(r,f,d,i,r),o=!1):n.remove()})});return n}function Dt(e,t,s,n=!1){return e.__accessor__&&e.__accessor__.lifecycle!==k.DESTROYED?n?ct(e,t,s):at(e,t,s):c()}function ft(e,t,s){let n,r,i=O(e,(u,o)=>{n&&n.uid!==r?i.remove():(n||(n=_.acquireTracked(u,t,o,s),r=n.uid),$(n))});return c(()=>{i.remove(),n&&(n.uid!==r||n.removed||(n.removed=!0,$(n)),n=null),i=null})}function ht(e,t,s){let n=!1;return N(e,(r,i)=>{n||(n=!0,s(i,r)||t(r,i),n=!1)})}function It(e,t,s=!1,n=G){return s?ht(e,t,n):ft(e,t,n)}function Vt(e){return Q(l,t=>t.oldValue===e)}export{Et as E,k as I,Vt as O,Dt as S,It as U,S as a,qt as b,et as c,tt as d,C as e,wt as f,gt as g,q as h,kt as i,mt as j,K as k,it as l,St as m,Q as n,yt as o,Tt as q,E as r,T as s,z as t,X as u};
