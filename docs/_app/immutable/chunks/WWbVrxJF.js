import{a as _,au as P,co as N,b as R,F as n,x as L,A as T,t as H,cp as $,m as y,aY as I,w as z,bU as U,ab as J,aa as F,V as G,H as W,J as Y}from"./DX5R6uCF.js";import{d as K,l as Q,w as X}from"./zQYKJ5V3.js";import{a as Z}from"./C6k8CR_f.js";import{s as ee}from"./DVGi2NY1.js";import{t as te}from"./K0pwTKFC.js";var o;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(o||(o={}));function se(t){return(e,s)=>{e[s]=t}}var b;let ie=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},re=class{constructor(e,s,i,r,a){this.target=e,this.added=s,this.removed=i,this.start=r,this.deleteCount=a}};const d=new H(ie,void 0,(t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}));function j(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function D(t){return t?t instanceof w?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function x(t){if(t?.length)return t[0]}function ne(t,e,s,i){const r=Math.min(t.length-s,e.length-i);let a=0;for(;a<r&&t[s+a]===e[i+a];)a++;return a}function k(t,e,s,i){e&&e.forEach(((r,a,f)=>{t.push(r),k(t,s.call(i,r,a,f),s,i)}))}const v=new Set,E=new Set,C=new Set,V=new Map;let ae=0;var O;let w=(O=class extends K.EventedAccessor{static isCollection(e){return e!=null&&e instanceof b}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new ee,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:ae++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof b?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return n(this._observable),this._items}set items(e){this._emitBeforeChanges(o.ADD)||(this._splice(0,this.length,D(e)),this._emitAfterChanges(o.ADD))}hasEventListener(e){return!this.destroyed&&(e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e))}on(e,s){if(this.destroyed)return L();if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:s};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),L((()=>{r.removed=!0,i.splice(i.indexOf(r),1)}))}return this._emitter.on(e,s)}once(e,s){const i="deref"in s?()=>s.deref():()=>s,r=this.on(e,(a=>{i()?.call(null,a),r.remove()}));return r}add(e,s){if(n(this._observable),this._emitBeforeChanges(o.ADD))return this;const i=this.getNextIndex(s??null);return this._splice(i,0,[e]),this._emitAfterChanges(o.ADD),this}addMany(e,s=this._items.length){if(n(this._observable),!e?.length)return this;if(this._emitBeforeChanges(o.ADD))return this;const i=this.getNextIndex(s);return this._splice(i,0,D(e)),this._emitAfterChanges(o.ADD),this}at(e){if(n(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(n(this._observable),!this.length||this._emitBeforeChanges(o.REMOVE))return[];const e=this._removeAllRaw();return this._emitAfterChanges(o.REMOVE),e}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return n(this._observable),this._createNewInstance({items:this._items.map(Z)})}concat(...e){n(this._observable);const s=e.map(D);return this._createNewInstance({items:this._items.concat(...s)})}drain(e,s){if(n(this._observable),!this.length||this._emitBeforeChanges(o.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let a=0;a<r;a++)e.call(s,i[a],a,i);this._emitAfterChanges(o.REMOVE)}destroyAll(){this.drain(j)}destroyMany(e){const s=this.removeMany(e);return s.forEach(j),s}every(e,s){return n(this._observable),this._items.every(e,s)}filter(e,s){n(this._observable);const i=arguments.length===2?this._items.filter(e,s):this._items.filter(e);return this._createNewInstance({items:i})}find(e,s){return n(this._observable),this._items.find(e,s)}findIndex(e,s){return n(this._observable),this._items.findIndex(e,s)}flatten(e,s){n(this._observable);const i=[];return k(i,this,e,s),new b(i)}forEach(e,s){return n(this._observable),this._items.forEach(e,s)}getItemAt(e){return n(this._observable),this._items[e]}getNextIndex(e){n(this._observable);const s=this.length;return(e=e??s)<0?e=0:e>s&&(e=s),e}includes(e,s=0){return n(this._observable),this._items.includes(e,s)}indexOf(e,s=0){return n(this._observable),this._items.indexOf(e,s)}join(e=","){return n(this._observable),this._items.join(e)}lastIndexOf(e,s=this.length-1){return n(this._observable),this._items.lastIndexOf(e,s)}map(e,s){n(this._observable);const i=this._items.map(e,s);return new b({items:i})}reorder(e,s=this.length-1){n(this._observable);const i=this.indexOf(e);if(i!==-1){if(s<0?s=0:s>=this.length&&(s=this.length-1),i!==s){if(this._emitBeforeChanges(o.MOVE))return e;this._splice(i,1),this._splice(s,0,[e]),this._emitAfterChanges(o.MOVE)}return e}}pop(){if(n(this._observable),!this.length||this._emitBeforeChanges(o.REMOVE))return;const e=x(this._splice(this.length-1,1));return this._emitAfterChanges(o.REMOVE),e}push(...e){return n(this._observable),this._emitBeforeChanges(o.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(o.ADD)),this.length}reduce(e,s){n(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,s):i.reduce(e)}reduceRight(e,s){n(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,s):i.reduceRight(e)}remove(e){return n(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(n(this._observable),e<0||e>=this.length||this._emitBeforeChanges(o.REMOVE))return;const s=x(this._splice(e,1));return this._emitAfterChanges(o.REMOVE),s}removeMany(e){if(n(this._observable),!e?.length||this._emitBeforeChanges(o.REMOVE))return[];const s=e instanceof b?e.toArray():e,i=this._items,r=[],a=s.length;for(let f=0;f<a;f++){const g=s[f],c=i.indexOf(g);if(c>-1){const h=1+ne(s,i,f+1,c+1),u=this._splice(c,h);u&&u.length>0&&r.push.apply(r,u),f+=h-1}}return this._emitAfterChanges(o.REMOVE),r}reverse(){if(n(this._observable),this._emitBeforeChanges(o.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(o.MOVE),this}shift(){if(n(this._observable),!this.length||this._emitBeforeChanges(o.REMOVE))return;const e=x(this._splice(0,1));return this._emitAfterChanges(o.REMOVE),e}slice(e=0,s=this.length){return n(this._observable),this._createNewInstance({items:this._items.slice(e,s)})}some(e,s){return n(this._observable),this._items.some(e,s)}sort(e){if(n(this._observable),!this.length||this._emitBeforeChanges(o.MOVE)||!this._requiresSort(e))return this;const s=this._splice(0,this.length);return arguments.length?s.sort(e):s.sort(),this._splice(0,0,s),this._emitAfterChanges(o.MOVE),this}_requiresSort(e=(s,i)=>s===i?0:s<i?-1:1){const s=this.length-1;for(let i=0;i<s;i++)if(e(this.items[i],this.items[i+1])>0)return!0;return!1}splice(e,s,...i){n(this._observable),arguments.length===1&&(s=this.length),s??=0;const r=(s?o.REMOVE:0)|(i.length?o.ADD:0);if(this._emitBeforeChanges(r))return[];const a=this._splice(e,s,i)||[];return this._emitAfterChanges(r),a}toArray(){return n(this._observable),this._items.slice()}toJSON(e){return n(this._observable),this.toArray().map((s=>te(s)?s.toJSON(e):s))}toLocaleString(){return n(this._observable),this._items.toLocaleString()}toString(){return n(this._observable),this._items.toString()}unshift(...e){return n(this._observable),!e.length||this._emitBeforeChanges(o.ADD)||(this._splice(0,0,e),this._emitAfterChanges(o.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,s,i){const r=this._items,a=this.itemType;let f,g;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=T((()=>this._dispatchChange()))),e<0&&(e+=this.length),s){if(g=r.splice(e,s),this.hasEventListener("before-remove")){const c=d.acquire();c.target=this,c.cancellable=!0;for(let h=0,u=g.length;h<u;h++)f=g[h],c.reset(f),this.emit("before-remove",c),c.defaultPrevented&&(g.splice(h,1),r.splice(e,0,f),e+=1,h-=1,u-=1);d.release(c)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const c=d.acquire();c.target=this,c.cancellable=!1;const h=g.length;for(let u=0;u<h;u++)c.reset(g[u]),this.emit("after-remove",c);d.release(c)}}if(i?.length){if(a){const l=[];for(const p of i){const m=a.ensureType(p);m==null&&p!=null||l.push(m)}i=l}const c=this.hasEventListener("before-add"),h=this.hasEventListener("after-add"),u=e===this.length;if(c||h){const l=d.acquire();l.target=this,l.cancellable=!0;const p=d.acquire();p.target=this,p.cancellable=!1;for(const m of i)c?(l.reset(m),this.emit("before-add",l),l.defaultPrevented||(u?r.push(m):r.splice(e++,0,m),this._set("length",r.length),h&&(p.reset(m),this.emit("after-add",p)))):(u?r.push(m):r.splice(e++,0,m),this._set("length",r.length),p.reset(m),this.emit("after-add",p));d.release(p),d.release(l)}else{if(u)for(const l of i)r.push(l);else r.splice(e,0,...i);this._set("length",r.length)}}if((i?.length||g?.length)&&this._notifyChangeEvent(i,g),this.hasEventListener("after-splice")){const c=new re(this,i,g,e,s);this.emit("after-splice",c)}return g}_emitBeforeChanges(e){let s=!1;if(this.hasEventListener("before-changes")){const i=d.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),s=i.defaultPrevented,d.release(i)}return s}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const s=d.acquire();s.target=this,s.cancellable=!1,s.type=e,this.emit("after-changes",s),d.release(s)}this._observable.notify()}_notifyChangeEvent(e,s){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:s})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const s of e){const i=s.changes;v.clear(),E.clear(),C.clear();for(const{added:h,removed:u}of i){if(h)if(C.size===0&&E.size===0)for(const l of h)v.add(l);else for(const l of h)E.has(l)?(C.add(l),E.delete(l)):C.has(l)||v.add(l);if(u)if(C.size===0&&v.size===0)for(const l of u)E.add(l);else for(const l of u)v.has(l)?v.delete(l):(C.delete(l),E.add(l))}const r=$.acquire();v.forEach((h=>{r.push(h)}));const a=$.acquire();E.forEach((h=>{a.push(h)}));const f=this._items,g=s.items,c=$.acquire();if(C.forEach((h=>{g.indexOf(h)!==f.indexOf(h)&&c.push(h)})),s.listeners&&(r.length||a.length||c.length)){const h={target:this,added:r,removed:a,moved:c},u=s.listeners.length;for(let l=0;l<u;l++){const p=s.listeners[l];p.removed||p.callback.call(this,h)}}$.release(r),$.release(a),$.release(c)}v.clear(),E.clear(),C.clear()}},b=O,O.ofType=e=>{if(!e)return b;if(V.has(e))return V.get(e);let s=null;if(typeof e=="function")s=e.prototype.declaredClass;else if(e.base)s=e.base.prototype.declaredClass;else for(const r in e.typeMap){const a=e.typeMap[r].prototype.declaredClass;s?s+=` | ${a}`:s=a}let i=class extends b{};return _([se({Type:e,ensureType:typeof e=="function"?P(e):N(e)})],i.prototype,"itemType",void 0),i=_([R(`esri.core.Collection<${s}>`)],i),V.set(e,i),i},O);_([y()],w.prototype,"_updating",void 0),_([y()],w.prototype,"length",void 0),_([y()],w.prototype,"items",null),_([y({readOnly:!0})],w.prototype,"updating",null),w=b=_([R("esri.core.Collection")],w);const oe=w;function Ee(t,e,s){return I(t.map(((i,r)=>e.apply(s,[i,r]))))}async function Ce(t,e,s){return(await I(t.map(((i,r)=>e.apply(s,[i,r]))))).map((i=>i.value))}function S(t){return{ok:!0,value:t}}function B(t){return{ok:!1,error:t}}function le(t){return t!=null&&t.ok===!0?t.value:null}function he(t){return t!=null&&t.ok===!1?t.error:null}async function Ae(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return S(await t)}catch(e){return B(e)}}async function we(t){try{return S(await t)}catch(e){return G(e),B(e)}}function Oe(t,e){return new A(t,e)}let A=class extends z{get value(){return le(this._result)}get error(){return he(this._result)}get finished(){return this._result!=null}constructor(t,e){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=U(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:s}=this._abortController;this.promise=t(s),this.promise.then((i=>{this._result=S(i),this._cleanup()}),(i=>{this._result=B(i),this._cleanup()})),this._abortHandle=J(e,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=F(this._abortHandle),this._abortController=null}};_([y()],A.prototype,"value",null),_([y()],A.prototype,"error",null),_([y()],A.prototype,"finished",null),_([y()],A.prototype,"promise",void 0),_([y()],A.prototype,"_result",void 0),A=_([R("esri.core.asyncUtils.ReactiveTask")],A);const M=new WeakMap;function q(t){return!t.destroyed&&(M.has(t)||t.addHandles([Q((()=>{const e=t.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||q(e))}),(e=>M.set(t,e)),X),L((()=>M.delete(t)))]),M.get(t))}function $e(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function Me(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="graphics"}function De(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="map-image"}function xe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="knowledge-graph"&&"layers"in t}function Ve(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="knowledge-graph-sublayer"}function Le(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function Re(t){return t?.type==="subtype-sublayer"}const Se={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function Be(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function je(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function Ie(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function ke(t){const e=t?.type;return(e==="feature"||e==="subtype-group"||e==="oriented-imagery")&&t?.source?.type==="feature-layer"}async function qe(t,e){const s=Y?.findServerInfo(t);if(s?.currentVersion!=null)return s.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const r=`${t.slice(0,i)}/rest/info`,a=e!=null?e.signal:null,{data:f}=await W(r,{query:{f:"json"},responseType:"json",signal:a});return f?.owningSystemUrl||null}function ce(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function Pe(t){return ce(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function ue(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function Ne(t){return!!ue(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}function Te(t){const e=new oe;for(const s of t.allLayers.concat(t.allTables))s.type==="csv"||q(s)||("charts"in s&&e.push(s),s.type==="subtype-group"&&e.push(...s.sublayers));return e}function fe(t,e){return null}function He(t){return null}function ge(t){return!t||t.type==="Feature Service"&&!t.sourceUrl}function ze(t,e){!e||!ge(t)||fe(t.url)}export{Te as $,He as A,qe as B,Pe as D,ge as G,ze as H,Ne as N,ce as P,oe as V,Ae as _,Ee as a,Le as b,we as c,Oe as d,q as e,xe as f,Re as g,Se as h,Be as j,Ie as k,Ve as l,se as n,Me as o,Ce as p,De as s,$e as u,je as w,ke as x,fe as z};
