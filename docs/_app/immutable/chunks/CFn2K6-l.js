const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./2dXtPFpf.js","./PPVm8Dsz.js","./DwWpeHsS.js","./CeRhhlE3.js","./C4qJhnT8.js","./CAYuU9oo.js","./DZE8-7HP.js","./GnozomzB.js","./Cp_8tW2x.js","./C_U3EkfM.js","./CLl2gHQ2.js","./BBV24j_2.js","./6W6J17CP.js","./v5xyD8FI.js","./Y_0EfhRu.js","./bnayRBMH.js","./DFoMxmW4.js","./DdbdneQ1.js","./BAIa4HHN.js","./DYIbcMrs.js","./BfLeziQE.js","./B2_jlIup.js","./BeiFfq_I.js","./CUKvHaKn.js","./B4oxan5h.js","./_Wu26JHk.js","./CBhtnfFj.js","./CIbyfs1t.js","./DfYjIaZP.js","./gul0yLcR.js","./Bt7d_ltN.js","./C_hZxtZf.js","./Iaw-yPgv.js","./C4m88JEB.js","./B_YI4KXt.js","./CF39WpqH.js","./BAzr6Eo0.js","./BOi-zD_D.js","./B36ip4uz.js","./C7XcR_qA.js","./DlemiWd4.js","./BmgeYasw.js","./DLOQEY_Z.js","./DRAy6pQp.js","./TaFUw3Kk.js","./BQME-Dbz.js","./CGdpgIRD.js","./qyF9FwQ9.js","./XI-Li77m.js","./C7Pxb65r.js","./BVgVoZ7V.js","./CsqWJYk4.js","./Ck0Sc68b.js","./C1b-UyR1.js","./CrKCdXr9.js","./DHf6qaib.js","./BiRr0v4Y.js","./D1nNABr7.js"])))=>i.map(i=>d[i]);
import{_ as I}from"./PPVm8Dsz.js";import{_ as e,a as S,av as et,$ as J,Y as E,L as rt,u as F,m as r,H as st,X as ot,s as v,aS as it,z as k,b as lt,o as at,n as R,B as Y,G as nt,C as B,x as T,V as ut,P as j,ar as H,v as pt,c as w}from"./DwWpeHsS.js";import{a3 as dt,f as ht,z as Z,bq as ct,c as b,H as yt,i as L}from"./CeRhhlE3.js";let mt=class{constructor(){this._resolver=J(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=1,this._cleanUp()},()=>{this._status=2,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===1}isRejected(){return this._status===2}isFulfilled(){return this._status!==0}abort(){this._resolver.reject(E())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const t=J(),s=[...this._resolvingPromises,t.promise],i=this._allPromise=Promise.all(s);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},a=>{this.isFulfilled()||this._allPromise!==i||rt(a)||this._resolver.reject(a)}),t.resolve()}};const ft=o=>{const t=o;let s=class extends t{constructor(...i){super(...i),this._promiseProps=new mt,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,a){return this._promiseProps.promise.then(()=>this).then(i,a)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}addResolvingTask(i){i&&!this._promiseProps.isFulfilled()&&(this.addHandles(et(i)),this._promiseProps.addResolvingPromise(i.promise))}};return s=e([S("esri.core.Promise")],s),s},vt=ft(F),gt="not-loaded",_t="loading",Pt="failed",z="loaded",St=o=>{const t=o;let s=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(a=>{const n=this.load.bind(this);this.load=u=>{const d=new Promise((h,m)=>{const P=ot(u,m);this.destroyed&&m(new v("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(h,m).finally(()=>{P&&P.remove()})});if(this.loadStatus===gt){this._set("loadStatus",_t);const h=this._loadController=new AbortController;n({signal:h.signal})}return a(),d}})),this.when(()=>{this._set("loadStatus",z),this._loadController=null},a=>{this.destroyed||(this._set("loadStatus",Pt),this._set("loadError",a),this._loadController=null)})}destroy(){this._loadController&&(this._loadController=it(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===z}get loadWarnings(){return this._get("loadWarnings")}load(i){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new v("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return e([r({readOnly:!0})],s.prototype,"loaded",null),e([r({readOnly:!0})],s.prototype,"loadError",void 0),e([r({clonable:!1})],s.prototype,"loadStatus",void 0),e([r({type:[st],readOnly:!0})],s.prototype,"loadWarnings",null),s=e([S("esri.core.Loadable")],s),s},Ot=St(vt);function Qt(o){return!(!o||!o.load)}let q;const wt=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale,x=globalThis.document?.documentElement;function X(){const o=x?.getAttribute("lang"),t=globalThis.navigator?.language;return wt??o??t??"en"}function C(){return q===void 0&&(q=X()),q}const bt=/^(?<language>[a-z]{2,3})(?:-(?<extlang>[a-z]{3}))?(?:-[A-Z][a-z]{3})?(?:-(?<region>[A-Z]{2}|\d{3}))?(?:-.*)?$/;function Bt(o=C()){return tt(o)?.language}function Tt(o=C()){const t=tt(o);return t?.language&&t?.extlang?o.replace(`${t.language}-`,""):o}function tt(o=C()){return bt.exec(o)?.groups}const D=[];function Et(o){return D.push(o),k(()=>{D.splice(D.indexOf(o),1)})}const $=[];function xt(o){return $.push(o),k(()=>$.splice($.indexOf(o),1))}function V(){const o=X();q!==o&&([...$].forEach(t=>t(o)),q=o,[...D].forEach(t=>t(o)))}globalThis.addEventListener?.("languagechange",V),x&&new MutationObserver(()=>{V()}).observe(x,{attributeFilter:["lang"]});let U;function Ct(o){return U&&!U.destroyed||(U=o()),U}var M;const Gt=new at({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let y=M=class extends F{constructor(o){super(o),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(o){o!=="asc"&&o!=="desc"||this._set("sortOrder",o)}clone(){return new M({categories:this.categories?lt(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(o,t){let s=[];this.categories&&(s=this.categories.map(u=>Array.isArray(u)?JSON.stringify(u):u));let i="";if(this.extent){const u=dt(this.extent,ht.WGS84);u!=null&&(i=`${u.xmin},${u.ymin},${u.xmax},${u.ymax}`)}let a=this.query;!this.disableExtraQuery&&o.extraQuery&&(a="("+a+")"+o.extraQuery);const n={categories:s,bbox:i,q:a,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(u=>Gt.toJSON(u.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...t,...n}}}};e([r()],y.prototype,"categories",void 0),e([r()],y.prototype,"disableExtraQuery",void 0),e([r({type:Z})],y.prototype,"extent",void 0),e([r()],y.prototype,"filter",void 0),e([r()],y.prototype,"num",void 0),e([r()],y.prototype,"query",void 0),e([r()],y.prototype,"sortField",void 0),e([r()],y.prototype,"sortOrder",null),e([r()],y.prototype,"start",void 0),y=M=e([S("esri.portal.PortalQueryParams")],y);var N;let c=N=class extends R{constructor(o){super(o),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const o=this.url,t=this.thumbnail;return o&&t&&this.portal?this.portal?.normalizeUrl(`${o}/info/${t}?f=json`):null}get url(){const o=this.portal?.restUrl;return o?o+"/community/groups/"+this.id:null}fetchCategorySchema(o){return this.portal.request(this.url+"/categorySchema",o).then(t=>{const s=t.categorySchema||[];return s.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",o):s})}fetchMembers(o){return this.portal.request(this.url+"/users",o)}getThumbnailUrl(o){let t=this.thumbnailUrl;return t&&o&&(t+=`&w=${o}`),t}toJSON(){throw new v("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(o){if(!o)return null;if(o.declaredClass)throw new Error("JSON object is already hydrated");const t=new N({sourceJSON:o});return t.read(o),t}queryItems(o,t){let s=Y(y,o);const i=this.portal;return parseFloat(i.currentVersion)>5?(s=s||new y,i.queryPortal(`/content/groups/${this.id}/search`,s,"PortalItem",t)):(s=s?s.clone():new y,s.query="group:"+this.id+(s.query?" "+s.query:""),i.queryItems(s,t))}_fetchCategorySchemaSet(o,t){const s=this.portal;return s.fetchSelf(s.authMode,!0,t).then(i=>{const a=i.contentCategorySetsGroupQuery;if(a){const n=new y({disableExtraQuery:!0,num:1,query:a});return s.queryGroups(n,t)}throw new v("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const a=i.results[0],n=new y({num:1,query:`typekeywords:"${o}"`});return a.queryItems(n,t)}throw new v("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(a=>{const n=a?.categorySchema;return n?.length?n:[]}):[])}};e([r()],c.prototype,"access",void 0),e([r({type:Date})],c.prototype,"created",void 0),e([r()],c.prototype,"description",void 0),e([r()],c.prototype,"id",void 0),e([r()],c.prototype,"isInvitationOnly",void 0),e([r({type:Date})],c.prototype,"modified",void 0),e([r()],c.prototype,"owner",void 0),e([r()],c.prototype,"portal",void 0),e([r()],c.prototype,"snippet",void 0),e([r()],c.prototype,"sortField",void 0),e([r()],c.prototype,"sortOrder",void 0),e([r()],c.prototype,"sourceJSON",void 0),e([r()],c.prototype,"tags",void 0),e([r()],c.prototype,"thumbnail",void 0),e([r({readOnly:!0})],c.prototype,"thumbnailUrl",null),e([r()],c.prototype,"title",void 0),e([r({readOnly:!0})],c.prototype,"url",null),c=N=e([S("esri.portal.PortalGroup")],c);let O=class extends F{constructor(o){super(o),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};e([r()],O.prototype,"nextQueryParams",void 0),e([r()],O.prototype,"queryParams",void 0),e([r()],O.prototype,"results",void 0),e([r()],O.prototype,"total",void 0),O=e([S("esri.portal.PortalQueryResult")],O);let _=class extends R{constructor(o){super(o),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const o=this.portal?.restUrl;return o?`${o}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new v("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};e([r({type:Date})],_.prototype,"created",void 0),e([r()],_.prototype,"id",void 0),e([r()],_.prototype,"portal",void 0),e([r()],_.prototype,"title",void 0),e([r({readOnly:!0})],_.prototype,"url",null),e([r()],_.prototype,"username",void 0),_=e([S("esri.portal.PortalFolder")],_);var A;let p=A=class extends R{constructor(o){super(o),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.id=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const o=this.url,t=this.thumbnail;return o&&t?this.portal.normalizeUrl(`${o}/info/${t}?f=json`):null}get userContentUrl(){const o=this.portal?.restUrl;return o?`${o}/content/users/${this.id}`:null}get url(){const o=this.portal?.restUrl;return o?`${o}/community/users/${this.id}`:null}addItem(o){const t=o&&o.item,s=o?.data,i=o?.folder,a={method:"post"};t&&(a.query=t.createPostQuery(),s!=null&&(typeof s=="string"?a.query.text=s:typeof s=="object"&&(a.query.text=JSON.stringify(s))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",a).then(u=>(t.id=u.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}async deleteItem(o,t=!1){let s=this.userContentUrl;o.ownerFolder&&(s+="/"+o.ownerFolder);const i=t?{permanentDelete:!0}:{};await this.portal.request(s+`/items/${o.id}/delete`,{method:"post",query:i}),o.id=null,o.portal=null}async deleteItems(o,t=!1){o=o.slice();const s=this.userContentUrl+"/deleteItems",i=[],a=o.map(n=>n.id);if(a.length){const n={method:"post",query:{items:a.join(","),permanentDelete:t}},u=await this.portal.request(s,n);for(const d of u.results){const h=o.find(Q=>d.itemId===Q.id),m=d.success;let P=null;m?(h.id=null,h.portal=null):d.error&&(P=new v("portal:delete-item-failed",d.error.message,d.error)),i.push({item:h,success:m,error:P})}}return i}fetchFolders(){const o={query:{num:1}};return this.portal.request(this.userContentUrl??"",o).then(t=>{let s;return s=t&&t.folders?t.folders.map(i=>{const a=_.fromJSON(i);return a.portal=this.portal,a}):[],s})}fetchGroups(){return this.portal.request(this.url??"").then(o=>{let t;return t=o&&o.groups?o.groups.map(s=>{const i=c.fromJSON(s);return i.portal=this.portal,i}):[],t})}async fetchItems(o){o??={};let t=this.userContentUrl??"";o.folder&&(t+="/"+o.folder.id);const{default:s}=await I(()=>import("./2dXtPFpf.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),i={folders:!1,inRecycleBin:!!o.inRecycleBin||null,foldersContent:!(o.folder||!o.includeSubfolderItems)||null,num:o.num||10,start:o.start||1,sortField:o.sortField||"created",sortOrder:o.sortOrder||"asc"},a=await this.portal.request(t,{query:i});let n;return a?.items?(n=a.items.map(u=>{const d=s.fromJSON(u);return d.portal=this.portal,d}),await Promise.all(n.map(u=>u.load())),{items:n,nextStart:a.nextStart,total:a.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(o=>o.tags)}getThumbnailUrl(o){let t=this.thumbnailUrl;return t&&o&&(t+=`&w=${o}`),t}queryFavorites(o){return this.favGroupId?(this._favGroup||(this._favGroup=new c({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(o)):Promise.reject(new v("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(o,t){const s=this.userContentUrl,i=t?{folderID:typeof t=="string"?t:t.id}:null;await this.portal.request(s+`/items/${o.id}/restore`,{method:"post",query:i})}toJSON(){throw new v("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(o){if(!o)return null;if(o.declaredClass)throw new Error("JSON object is already hydrated");const t=new A({sourceJSON:o});return t.read(o),t}};e([r()],p.prototype,"access",void 0),e([r({type:Date})],p.prototype,"created",void 0),e([r()],p.prototype,"culture",void 0),e([r()],p.prototype,"description",void 0),e([r()],p.prototype,"email",void 0),e([r()],p.prototype,"favGroupId",void 0),e([r()],p.prototype,"fullName",void 0),e([r()],p.prototype,"id",void 0),e([r({type:Date})],p.prototype,"modified",void 0),e([r()],p.prototype,"orgId",void 0),e([r()],p.prototype,"portal",void 0),e([r()],p.prototype,"preferredView",void 0),e([r()],p.prototype,"privileges",void 0),e([r()],p.prototype,"region",void 0),e([r()],p.prototype,"role",void 0),e([r()],p.prototype,"roleId",void 0),e([r()],p.prototype,"sourceJSON",void 0),e([r()],p.prototype,"thumbnail",void 0),e([r({readOnly:!0})],p.prototype,"thumbnailUrl",null),e([r()],p.prototype,"units",void 0),e([r({readOnly:!0})],p.prototype,"userContentUrl",null),e([r({readOnly:!0})],p.prototype,"url",null),e([r()],p.prototype,"username",void 0),e([r()],p.prototype,"userLicenseTypeId",void 0),e([r()],p.prototype,"userType",void 0),p=A=e([S("esri.portal.PortalUser")],p);var f;let G;const W={PortalGroup:()=>Promise.resolve({default:c}),PortalItem:()=>I(()=>import("./2dXtPFpf.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),PortalUser:()=>Promise.resolve({default:p})};var g;let l=(g=class extends nt(Ot){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.g3DTilesGalleryGroupQuery=null,this.g3dTilesEnabled=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=B.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){K.unregister(this),this.defaultBasemap=T(this.defaultBasemap),this.defaultDevBasemap=T(this.defaultDevBasemap),this.defaultVectorBasemap=T(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=ut(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const s of t)B.request.trustedServers.includes(s)||B.request.trustedServers.push(s);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=this.user?.orgId,s=!t||this.canSearchPublic;return this.id&&!s?` AND orgid:${this.id}`:null}get hasAPIKey(){return ct(this.restUrl)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get loaded(){return super.loaded}get restUrl(){let t=this.url;if(t){const s=t.indexOf("/sharing");t=s>0?t.slice(0,s):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,s=this.thumbnail;return t&&s?this._normalizeSSL(t+"/portals/self/resources/"+s):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let s=null;return t&&(s=p.fromJSON(t),s.portal=this),s}load(t){const s=I(async()=>{const{default:i}=await import("./C4qJhnT8.js").then(a=>a.B);return{default:i}},__vite__mapDeps([4,1,2,3,5,6,7,0,8,9]),import.meta.url).then(({default:i})=>{j(t),G=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(!this.hasAPIKey&&b){const a=b;this.credential=a.findCredential(this.restUrl),this.credential||this.authMode!==f.AUTH_MODE_AUTO&&this.authMode!==f.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=a.on("credential-create",qt(new WeakRef(this))),K.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(s),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),s=(await I(async()=>{const{default:i}=await import("./CLl2gHQ2.js");return{default:i}},__vite__mapDeps([10,1,2,3,11,12,13,5,14,15,16,17,18,19,20,21,22,23,7,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,0,51,52,53,54,55,56,57]),import.meta.url)).default;return t?t.map(i=>new s({id:i.id,url:i.url})):[]}async fetchBasemaps(t,s){const i=await this._fetchBasemaps(t,s);if(s?.include3d===!0&&this.use3dBasemaps!==!1){const a=await this._fetchBasemaps3D(t,s);i.unshift(...a)}return i}async fetchDefault3DBasemap(t){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||this.default3DBasemapQuery==="none")return null;const s=new y;s.query=this.default3DBasemapQuery,s.disableExtraQuery=!0;const i=(await this.queryItems(s,t)).results.find(a=>a.type==="Web Scene");return i?new G({portalItem:i}):null}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(s=>s.categorySchema):H(t)?Promise.reject(E()):Promise.resolve([])}async fetchClassificationSchema(t){return this.hasClassificationSchema?this.request(this.restUrl+"/portals/self/classification/classificationSchema",t).then(s=>s.classificationSchema):null}fetchFeaturedGroups(t){const s=this.featuredGroups,i=new y({num:100,sortField:"title"});if(s?.length){const a=[];for(const n of s)a.push(`(title:"${n.title}" AND owner:${n.owner})`);return i.query=a.join(" OR "),this.queryGroups(i,t).then(n=>n.results)}return H(t)?Promise.reject(E()):Promise.resolve([])}fetchRegions(t){const s=this.user?.culture||this.culture||C();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:s}})}fetchSettings(t){const s=this.user?.culture||this.culture||C();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:s}})}static getDefault(){return Ct(()=>new f)}queryGroups(t,s){return this.queryPortal("/community/groups",t,"PortalGroup",s)}queryItems(t,s){return this.queryPortal("/search",t,"PortalItem",s)}queryUsers(t,s){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",s)}fetchSelf(t=this.authMode,s=!1,i){const a=this.restUrl+"/portals/self",n={authMode:t,query:{culture:C().toLowerCase()},withCredentials:!0,...i};return n.authMode==="auto"&&(n.authMode="no-prompt"),s&&(n.query.default=!0),this.request(a,n)}queryPortal(t,s,i,a){const n=Y(y,s),u=d=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...a}).then(h=>{const m=n.clone();return m.start=h.nextStart,new O({nextQueryParams:m,queryParams:n,total:h.total,results:f._resultsToTypedArray(d,{portal:this},h,a)})}).then(h=>Promise.all(h.results.map(m=>typeof m.when=="function"?m.when():h)).then(()=>h,m=>(pt(m),h)));return i&&W[i]?W[i]().then(({default:d})=>(j(a),u(d))):u()}signIn(){if(this.hasAPIKey)return this.load().then(()=>{if(!this.user)throw new v("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")});if(this.authMode===f.AUTH_MODE_ANONYMOUS||this.authMode===f.AUTH_MODE_NO_PROMPT&&!b)return Promise.reject(new v("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=s=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(s||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=s,this.fetchSelf("immediate"))):this.user&&this.credential===s?null:(this.credential=s,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return b?b.getCredential(this.restUrl,{prompt:this.authMode!==f.AUTH_MODE_NO_PROMPT}).then(s=>t(s)):t(this.credential)}normalizeUrl(t){const s=this.credential?.token;return this._normalizeSSL(s?t+(t.includes("?")?"&":"?")+"token="+s:t)}requestToTypedArray(t,s,i){return this.request(t,s).then(a=>{const n=f._resultsToTypedArray(i,{portal:this},a);return Promise.all(n.map(u=>typeof u.when=="function"?u.when():a)).then(()=>n,()=>n)})}request(t,s={}){const i={f:"json",...s.query},{authMode:a=this.authMode===f.AUTH_MODE_ANONYMOUS||this.authMode===f.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:n=null,cacheBust:u=!1,method:d="auto",responseType:h="json",signal:m}=s,P={authMode:a,body:n,cacheBust:u,method:d,query:i,responseType:h,timeout:0,signal:m};return s.withCredentials&&(P.withCredentials=!0),yt(this._normalizeSSL(t),P).then(Q=>Q.data)}toJSON(){throw new v("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new f({sourceJSON:t})}_getHelperService(t){const s=this.helperServices?.[t];if(!s)throw new v("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return s}async _fetchBasemaps(t,s){const i=new y;i.query=t||(L()?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const a=await this.queryGroups(i,s);if(!a.total)return[];const n=a.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const u=await n.queryItems(i,s);return u.total?u.results.filter(d=>d.type==="Web Map").map(d=>new G({portalItem:d})):[]}async _fetchBasemaps3D(t,s){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];if(L())return[];const a=new y({query:i,disableExtraQuery:!0}),n=await this.queryGroups(a,s);if(!n.total)return[];const u=n.results[0];a.num=100,a.query='type:"Web Scene"',a.sortField=u.sortField||"name",a.sortOrder=u.sortOrder||"desc";const d=await u.queryItems(a,s);return d.total?d.results.filter(h=>h.type==="Web Scene").map(h=>new G({portalItem:h})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const s=G.fromJSON(t);return s.portalItem={portal:this},s}return null}static _resultsToTypedArray(t,s,i,a){let n;if(i){const u=a!=null?a.signal:null;n=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||s)&&(n=n.map(d=>{const h=Object.assign(t?t.fromJSON(d):d,s);return typeof h.load=="function"&&h.load(u),h}))}else n=[];return n}},f=g,g.AUTH_MODE_ANONYMOUS="anonymous",g.AUTH_MODE_AUTO="auto",g.AUTH_MODE_IMMEDIATE="immediate",g.AUTH_MODE_NO_PROMPT="no-prompt",g);e([r()],l.prototype,"access",void 0),e([r()],l.prototype,"allSSL",void 0),e([r()],l.prototype,"authMode",void 0),e([r()],l.prototype,"authorizedCrossOriginDomains",void 0),e([w("authorizedCrossOriginDomains")],l.prototype,"readAuthorizedCrossOriginDomains",null),e([r()],l.prototype,"basemapGalleryGroupQuery",void 0),e([r({json:{name:"3DBasemapGalleryGroupQuery"}})],l.prototype,"basemapGalleryGroupQuery3D",void 0),e([r({json:{name:"g3DTilesGalleryGroupQuery"}})],l.prototype,"g3DTilesGalleryGroupQuery",void 0),e([r({json:{name:"g3dTilesEnabled"}})],l.prototype,"g3dTilesEnabled",void 0),e([r()],l.prototype,"bingKey",void 0),e([r()],l.prototype,"canListApps",void 0),e([r()],l.prototype,"canListData",void 0),e([r()],l.prototype,"canListPreProvisionedItems",void 0),e([r()],l.prototype,"canProvisionDirectPurchase",void 0),e([r()],l.prototype,"canSearchPublic",void 0),e([r()],l.prototype,"canShareBingPublic",void 0),e([r()],l.prototype,"canSharePublic",void 0),e([r()],l.prototype,"canSignInArcGIS",void 0),e([r()],l.prototype,"canSignInIDP",void 0),e([r()],l.prototype,"colorSetsGroupQuery",void 0),e([r()],l.prototype,"commentsEnabled",void 0),e([r({type:Date})],l.prototype,"created",void 0),e([r()],l.prototype,"credential",void 0),e([r()],l.prototype,"culture",void 0),e([r()],l.prototype,"currentVersion",void 0),e([r()],l.prototype,"customBaseUrl",void 0),e([r()],l.prototype,"default3DBasemapQuery",void 0),e([r()],l.prototype,"defaultBasemap",void 0),e([w("defaultBasemap")],l.prototype,"readDefaultBasemap",null),e([r()],l.prototype,"defaultDevBasemap",void 0),e([w("defaultDevBasemap")],l.prototype,"readDefaultDevBasemap",null),e([r({type:Z})],l.prototype,"defaultExtent",void 0),e([r()],l.prototype,"defaultVectorBasemap",void 0),e([w("defaultVectorBasemap")],l.prototype,"readDefaultVectorBasemap",null),e([r()],l.prototype,"description",void 0),e([r()],l.prototype,"devBasemapGalleryGroupQuery",void 0),e([r()],l.prototype,"eueiEnabled",void 0),e([r({readOnly:!0})],l.prototype,"extraQuery",null),e([r()],l.prototype,"featuredGroups",void 0),e([r()],l.prototype,"featuredItemsGroupQuery",void 0),e([r()],l.prototype,"galleryTemplatesGroupQuery",void 0),e([r()],l.prototype,"layoutGroupQuery",void 0),e([r()],l.prototype,"livingAtlasGroupQuery",void 0),e([r({readOnly:!0})],l.prototype,"hasAPIKey",null),e([r()],l.prototype,"hasCategorySchema",void 0),e([r()],l.prototype,"hasClassificationSchema",void 0),e([r()],l.prototype,"helpBase",void 0),e([r()],l.prototype,"helperServices",void 0),e([r()],l.prototype,"helpMap",void 0),e([r()],l.prototype,"homePageFeaturedContent",void 0),e([r()],l.prototype,"homePageFeaturedContentCount",void 0),e([r()],l.prototype,"httpPort",void 0),e([r()],l.prototype,"httpsPort",void 0),e([r()],l.prototype,"id",void 0),e([r()],l.prototype,"ipCntryCode",void 0),e([r({readOnly:!0})],l.prototype,"isOrganization",null),e([r()],l.prototype,"isPortal",void 0),e([r()],l.prototype,"isReadOnly",void 0),e([r({readOnly:!0})],l.prototype,"itemPageUrl",null),e([r()],l.prototype,"layerTemplatesGroupQuery",void 0),e([r()],l.prototype,"maxTokenExpirationMinutes",void 0),e([r({type:Date})],l.prototype,"modified",void 0),e([r()],l.prototype,"name",void 0),e([r()],l.prototype,"portalHostname",void 0),e([r()],l.prototype,"portalMode",void 0),e([r()],l.prototype,"portalProperties",void 0),e([r()],l.prototype,"region",void 0),e([r()],l.prototype,"recycleBinEnabled",void 0),e([r({readOnly:!0})],l.prototype,"restUrl",null),e([r()],l.prototype,"rotatorPanels",void 0),e([r()],l.prototype,"showHomePageDescription",void 0),e([r()],l.prototype,"sourceJSON",void 0),e([r()],l.prototype,"staticImagesUrl",void 0),e([r({json:{name:"2DStylesGroupQuery"}})],l.prototype,"stylesGroupQuery2d",void 0),e([r({json:{name:"stylesGroupQuery"}})],l.prototype,"stylesGroupQuery3d",void 0),e([r()],l.prototype,"supportsHostedServices",void 0),e([r()],l.prototype,"symbolSetsGroupQuery",void 0),e([r()],l.prototype,"templatesGroupQuery",void 0),e([r()],l.prototype,"thumbnail",void 0),e([r({readOnly:!0})],l.prototype,"thumbnailUrl",null),e([r()],l.prototype,"units",void 0),e([r()],l.prototype,"url",void 0),e([r()],l.prototype,"urlKey",void 0),e([w("urlKey")],l.prototype,"readUrlKey",null),e([r()],l.prototype,"user",void 0),e([w("user")],l.prototype,"readUser",null),e([r()],l.prototype,"use3dBasemaps",void 0),e([r()],l.prototype,"useDefault3dBasemap",void 0),e([r()],l.prototype,"useStandardizedQuery",void 0),e([r()],l.prototype,"useVectorBasemaps",void 0),e([r()],l.prototype,"vectorBasemapGalleryGroupQuery",void 0),l=f=e([S("esri.portal.Portal")],l);const K=new FinalizationRegistry(o=>{o.remove()});function qt(o){const t=b;return()=>{const s=o.deref();s&&t.findCredential(s.restUrl)&&s.signIn().catch(()=>{})}}const Mt=Object.freeze(Object.defineProperty({__proto__:null,get default(){return l}},Symbol.toStringTag,{value:"Module"}));export{l as M,Mt as P,ft as a,Et as b,Tt as c,St as d,p as e,C as l,Qt as m,vt as n,y as p,Bt as s,Ot as u,xt as v};
