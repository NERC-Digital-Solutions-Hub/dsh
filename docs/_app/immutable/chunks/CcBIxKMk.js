const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BIyGGnuB.js","./BG8Nkn6y.js","./BVp01coW.js","./oKHlAiyk.js","./BJj2_Vlp.js","./2eEJBHPf.js","./BOqKFYYJ.js","./B-7eUg25.js","./BZedbJEu.js","./PPVm8Dsz.js","./BxFa---M.js","./BU-dfLkt.js","./Cl5lrJ4c.js","./C8BmVxiO.js","./Bu7NDcrC.js","./BaPpu_B1.js","./CiUMl5x3.js","./DsWFkhLL.js","./CFxfMnfS.js","./DavrSX6K.js","./BcbLaE7n.js","./CVQMCrWN.js","./gJcj4rEF.js","./Fjqoh7GI.js"])))=>i.map(i=>d[i]);
import{_ as V}from"./PPVm8Dsz.js";import{e as F,b as se,f as ae,r as n,m as c,a as C,aP as de}from"./oKHlAiyk.js";import{C as fe,am as ge,an as ye,ao as be,o as ve,_ as A,a_ as Q,al as K,z as we,Z as _e,f as Z,aQ as k,s as J,a7 as X,aq as Se}from"./BxFa---M.js";import{s as h,i as re}from"./2eEJBHPf.js";import{l as $,j as xe,h as Te,a as Re,f as le}from"./B-7eUg25.js";import{L as $e}from"./BJj2_Vlp.js";import{d as Me,y as Be,j as Ee,u as Ie,s as ke}from"./bqDBAz06.js";import{O as Le,A as Oe,n as f,B as Ce}from"./BVp01coW.js";import{O as j}from"./o0B939Hd.js";import{V as E}from"./EnYQAt9i.js";import{p as q,m as Ae,C as ne}from"./BZedbJEu.js";import{L as ze,k as Ge,K as We}from"./7UfobvnF.js";import{e as Fe}from"./BQBvadb7.js";import{m as Pe}from"./D5gyBayZ.js";import{O as He,f as Ue,i as qe,m as De}from"./CaJv-7Uz.js";import{l as P,a as Y}from"./DB6WT5au.js";import{b as H,w as je}from"./zNZQG8RX.js";import{s as z,m as U,A as Ne,S as Ve,q as Qe}from"./D6KPPgz5.js";import{j as G,l as W}from"./ByCWW859.js";import{n as Ke}from"./InsT2XWv.js";import{e as B,t as Ze}from"./D4q3WNNc.js";import{e as ee}from"./nbXsAMVf.js";var T;(function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"})(T||(T={}));function Je(e){return oe(e)||ye(e)||be(e)}function oe(e){return fe(e)||ge(e)}const Xe=12;var u;let I=(u=class{constructor(t){const i=u.checkUnsupported(t);if(i!=null)throw i;const s=t;this.spatialReference=s.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=ve(this.spatialReference),this.origin=[s.origin.x,s.origin.y],this.pixelSize=s.size[0],this.dpi=s.dpi;const a=s.lods.reduce(((p,d)=>(d.level<p.minLod.level&&(p.minLod=d),p.max=Math.max(p.max,d.level),p)),{minLod:s.lods[0],max:-1/0}),r=a.minLod,l=2**r.level;let o=r.resolution*l,m=r.scale*l;this.levels=new Array(a.max+1);for(let p=0;p<this.levels.length;p++)this.levels[p]={resolution:o,scale:m,tileSize:[o*s.size[0],o*s.size[1]]},o/=2,m/=2}clone(){return new u(this.toTileInfo())}toTileInfo(){return new G({dpi:this.dpi,origin:new A({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((t,i)=>new W({level:i,scale:t.scale,resolution:t.resolution})))})}getExtent(t,i,s,a){const r=this.levels[t],l=r.tileSize[0],o=r.tileSize[1];a[0]=this.origin[0]+s*l,a[2]=this.origin[0]+(s+1)*l,a[3]=this.origin[1]-i*o,a[1]=this.origin[1]-(i+1)*o}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=Q(t[0]),i[1]=K(t[1]),i[2]=Q(t[2]),i[3]=K(t[3])):this._isGCS&&(i[0]=z(t[0]),i[1]=z(t[1]),i[2]=z(t[2]),i[3]=z(t[3]))}getExtentGeometry(t,i,s,a=new we){return this.getExtent(t,i,s,_),a.spatialReference=this.spatialReference,a.xmin=_[0],a.ymin=_[1],a.xmax=_[2],a.ymax=_[3],a.zmin=void 0,a.zmax=void 0,a}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const{resolution:s,scale:a}=this.levels[this.levels.length-1],r=s/2*this.pixelSize;this.levels.push({resolution:s/2,scale:a/2,tileSize:[r,r]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t,i=1/0){if(u.checkUnsupported(t))return!1;const s=new u(t);if(!s.spatialReference.equals(this.spatialReference)||s.pixelSize!==this.pixelSize)return!1;const a=Math.min(this.levels.length-1,s.levels.length-1,i),r=this.levels[a].resolution;let l=.5*r;return!U(s.origin[0],this.origin[0],l)||!U(s.origin[1],this.origin[1],l)?!1:(l=.5*r/2**a/this.pixelSize*Xe,U(r,s.levels[a].resolution,l))}rootTilesInExtent(t,i=null,s=1/0){const a=new Array,r=this.levels[0].tileSize;if(t==null||r[0]===0||r[1]===0)return a;u.computeRowColExtent(t,r,this.origin,_);let l=_[1],o=_[3],m=_[0],p=_[2];const d=p-m,R=o-l;if(d*R>s){const b=Math.floor(Math.sqrt(s));R>b&&(l=l+Math.floor(.5*R)-Math.floor(.5*b),o=l+b),d>b&&(m=m+Math.floor(.5*d)-Math.floor(.5*b),p=m+b)}for(let b=l;b<o;b++)for(let M=m;M<p;M++)a.push([0,b,M]);return i!=null&&(i[0]=this.origin[0]+m*r[0],i[1]=this.origin[1]-o*r[1],i[2]=this.origin[0]+p*r[0],i[3]=this.origin[1]-l*r[1]),a}static computeRowColExtent(t,i,s,a){const r=.001*(t[2]-t[0]+(t[3]-t[1]));a[0]=Math.max(0,Math.floor((t[0]+r-s[0])/i[0])),a[2]=Math.max(0,Math.ceil((t[2]-r-s[0])/i[0])),a[1]=Math.max(0,Math.floor((s[1]-t[3]+r)/i[1])),a[3]=Math.max(0,Math.ceil((s[1]-t[1]-r)/i[1]))}static isPowerOfTwo(t){const i=t.lods,s=i[0].resolution*2**i[0].level;return!i.some((a=>!Ne(a.resolution,s/2**a.level)))}static hasGapInLevels(t){const i=t.lods.map((s=>s.level));i.sort(((s,a)=>s-a));for(let s=1;s<i.length;s++)if(i[s]!==i[0]+s)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some((s=>s.origin!=null&&(s.origin[0]!==i.x||s.origin[1]!==i.y)))}static getMissingTileInfoError(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?N():t.lods.length<1?new h("tilingscheme:generic","Tiling scheme must have at least one level"):u.isPowerOfTwo(t)?u.hasGapInLevels(t)?new h("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):u.tileSizeSupported(t)?u.hasOriginPerLODs(t)?new h("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new h("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new h("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const s=t[2]-t[0],a=t[3]-t[1],r=_e(i),l=1.2*Math.max(s,a),o=256,m=l/o,p=m*r*(96/.0254),d=new u(new G({size:[o,o],origin:new A({x:t[0]-.5*(l-s),y:t[3]+.5*(l-a)}),lods:[new W({level:0,resolution:m,scale:p})],spatialReference:i}));return d.ensureMaxLod(20),d}static makeWebMercatorAuxiliarySphere(t){const i=new u(u.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,s=16){const a=256/i,r=new u(new G({size:[i,i],origin:new A({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new W({level:0,resolution:.703125*a,scale:295497598570834e-6*a})]}));return r.ensureMaxLod(s),r}get test(){}},u.WebMercatorAuxiliarySphereTileInfo=new G({size:[256,256],origin:new A({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Z.WebMercator}),spatialReference:Z.WebMercator,lods:[new W({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),u.WebMercatorAuxiliarySphere=u.makeWebMercatorAuxiliarySphere(19),u);function N(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}const _=H(),te=64;Ve(Qe/10);const Ye=H();I.WebMercatorAuxiliarySphere.getExtent(0,0,0,Ye);H([-180,-90,180,90]);function et(e,t,i,s){if(e==null)return N();const a=e.spatialReference;if(a.isGeographic&&!oe(a))return new h("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=I.checkUnsupported(e);return r??(i==null?new h("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):tt(e,i)||(t==null||a.equals(t)||t.isWGS84&&a.isWebMercator?null:new h("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function tt(e,t){const i=e.lods,s=i[0].resolution*2**i[0].level,a=[s*e.size[0],s*e.size[1]],r=[e.origin.x,e.origin.y],l=je(t),o=H();I.computeRowColExtent(l,a,r,o);const m=(o[2]-o[0])*(o[3]-o[1]);if(m>te){const p=i[0].scale*2**i[0].level;let d=Math.max((l[3]-l[1])/e.size[1],(l[2]-l[0])/e.size[0])*p/s;const R=Math.floor(Math.log(d)/Math.log(10));return d=Math.ceil(d/10**R)*10**R,new h("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(p).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+d.toLocaleString()+".",{level0Scale:p,suggestedLevel0Scale:d,requiredNumRootTiles:m,allowedNumRootTiles:te})}return null}const it=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:et},Symbol.toStringTag,{value:"Module"}));function st(e,t,i,s){if(e==null)return N();const a=e?.lods.length-1,r=e.spatialReference;if(r.isWebMercator){if(!I.makeWebMercatorAuxiliarySphere(a).compatibleWith(e,s))return new h("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!Je(r))return new h("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!I.makeGCSWithTileSize(e.spatialReference,e.size[0],a).compatibleWith(e,s))return e.spatialReference.isWGS84?new h("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new h("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?null:new h("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const at=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:st},Symbol.toStringTag,{value:"Module"})),rt={[P.Global]:at,[P.Local]:it};function D(e,t,i,s,a){return rt[s].checkIfTileInfoSupportedForViewSR(e,i,t,a)}function lt(e,t,i){const s=He(e);if(s!=null){if(!E.isCollection(s))return{tileInfo:s.tileInfo,fullExtent:s.fullExtent};{const a=s.find((r=>D(r.tileInfo,r.fullExtent,t,i)==null));if(a)return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}return{tileInfo:null,fullExtent:null}}T.NORTH,T.EAST,T.SOUTH,T.WEST;T.NORTH_EAST,T.SOUTH_EAST,T.SOUTH_WEST,T.NORTH_WEST;function nt(e,t){return e!=null&&(t==null||(t===P.Local?!e.isGeographic||e.isWGS84||e.wkid===k.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===k.CGCS2000||e.wkid===k.GCSMARS2000||e.wkid===k.GCSMARS2000_SPHERE||e.wkid===k.GCSMOON2000))}async function ot(e,t={}){const{basemap:i,view:s}=e;await i.load(t),pt(i),await mt(i,s,t),F(t)}async function ct(e,t={}){const{basemap:i,view:s}=e;F(t);const a=i.baseLayers.find((o=>o.type==="unknown"))?.loadError;if(a!=null)throw a;if(!s||"spatialReferenceLocked"in s&&!s.spatialReferenceLocked||(await i.load(t),F(t),i.baseLayers.length===0))return;const r=i.baseLayers.at(0);if(!Ue(r))return;if(i.spatialReference){if(s.spatialReference.equals(i.spatialReference))return;ie()}await r.load(t),F(t);const l=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:null]).filter($e);l.length!==0&&l.every((o=>!s.spatialReference.equals(o)))&&ie()}function ie(){throw new h("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}function pt(e){if(e.baseLayers.length===0&&e.referenceLayers.length===0)return;const t=e.baseLayers.concat(e.referenceLayers).toArray().filter((i=>!qe(i))).map((i=>ht(i)));if(t.length)throw t[0]}function ht(e){return new h("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})}async function mt(e,t,i){if(e.baseLayers.length===0)return;const s=e.baseLayers.at(0);if(De(s)){try{await s.load(i)}catch(a){const r="basemap-compatibility:unknown-error",l="Unknown basemap compatibility error",{name:o=r,message:m=l,details:p}=a;throw new h(o,m,p)}ut(s,t)}}function ut(e,t){const i=t.state.viewingMode;if(!i)return;let s,a;if(e?.type==="wmts"){const o=lt(e,t.spatialReference,i);if(o.tileInfo==null)throw new h("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");s=o.tileInfo,a=o.fullExtent}else s=e.tileInfo,a=e.fullExtent;if(s==null)return;if(!nt(s.spatialReference,i))throw new h(`basemapgalleryitem:spatial-reference-unsupported-${Y(i)}`,`Basemap spatial reference is unsupported in ${Y(i)} mode`);const r=e?.type==="vector-tile"?s.getCompatibleForVTL(256):null;if(i===P.Global){let o=D(s,a,null,i);if(o&&e?.type==="vector-tile"&&a!=null&&r&&!D(r,a,null,i)&&(o=null),o){const m=s.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new h(`basemapgalleryitem:tiling-scheme-unsupported-${m}-global`,"Basemap tiling scheme is unsupported in global mode",{error:o})}}else if(I.checkUnsupported(s))throw new h("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const l=t.basemapTerrain?.tilingScheme;if(l&&!l.compatibleWith(s)&&(e?.type!=="vector-tile"||!r||!l.compatibleWith(r)))throw new h("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}let S=class extends Ke.IdentifiableMixin(se){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.addHandles([$((()=>this.basemap?.loadStatus),e),$((()=>this.compatibilityFunction),e),$((()=>this.view&&"basemapTerrain"in this.view&&this.view.basemapTerrain?.tilingScheme),e),$((()=>this.view?.ready),e),$((()=>this.view?.spatialReference),e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return Me(this.view,this.basemap)}set basemap(e){e&&e.load().catch((()=>{})),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){this._cancelRefresh(),this._set("state","loading");const e=this.basemap?.loadStatus;if(e!=="loaded"&&e!=="failed")return;if(!this.compatibilityFunction)return void(e==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:i}=t;this.compatibilityFunction(this,{signal:i}).then((()=>xe((()=>!this._spatialReferenceTask.updating),i))).then((()=>{this._set("state","ready"),this._set("error",null)})).catch((s=>{ae(s)||(this._set("state","error"),this._set("error",s))})),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};n([c({readOnly:!0})],S.prototype,"_spatialReferenceTask",null),n([c()],S.prototype,"basemap",null),n([c()],S.prototype,"compatibilityFunction",void 0),n([c({readOnly:!0})],S.prototype,"error",void 0),n([c({readOnly:!0})],S.prototype,"spatialReference",null),n([c({readOnly:!0})],S.prototype,"state",void 0),n([c()],S.prototype,"view",void 0),S=n([C("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],S);const ce=S,pe=E.ofType(j);let L=class extends se{constructor(e){super(e),this.basemaps=new pe}destroy(){this.basemaps.forEach((e=>e.destroy()))}get state(){return"ready"}refresh(){}};n([c({type:pe})],L.prototype,"basemaps",void 0),n([c({readOnly:!0})],L.prototype,"state",null),L=n([C("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],L);const he=L,me=E.ofType(j);let x=class extends q.LoadableMixin(Ae.EsriPromiseMixin(he)){constructor(e){super(e),this._lastPortalBasemapFetchController=null,this.basemaps=new me,this.filterFunction=null,this.portal=ne.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles($((()=>[this.filterFunction,this.loadStatus,this.portal?.basemapGalleryGroupQuery,this.portal?.basemapGalleryGroupQuery3D,this.portal?.user,this.query,this.updateBasemapsCallback]),(()=>this.refresh()),Te))}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach((e=>e.destroy()))}get state(){return this.loadStatus==="not-loaded"?"not-loaded":this.loadStatus==="loading"||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),Promise.resolve(this)}async refresh(){if(this.loadStatus!=="loaded")return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{const i=await e.fetchBasemaps(this._toQueryString(this.query),{signal:t.signal,include3d:this.viewType==="3d"||void 0});await this._updateBasemaps(i)}catch(i){if(ae(i))throw i;re.getLogger(this).warn(new h("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:i})),await this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(e){return e&&typeof e!="string"?Object.keys(e).map((t=>`${t}:${e[t]}`)).join(" AND "):e}async _updateBasemaps(e=[]){let t=await this._filterBasemaps(e);t=this.updateBasemapsCallback?await this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)}async _filterBasemaps(e){if(!this.filterFunction)return e;const t=e.map(this.filterFunction),i=await Promise.all(t);return e.filter(((s,a)=>i[a]))}};n([c({readOnly:!0,type:me})],x.prototype,"basemaps",void 0),n([c()],x.prototype,"filterFunction",void 0),n([c({type:ne})],x.prototype,"portal",void 0),n([c()],x.prototype,"query",void 0),n([c({readOnly:!0})],x.prototype,"state",null),n([c()],x.prototype,"updateBasemapsCallback",void 0),n([c()],x.prototype,"viewType",void 0),x=n([C("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],x);const O=x,ue=E.ofType(ce);function dt(e){return e&&e.declaredClass==="esri.portal.Portal"}function ft(e){return e&&!(e instanceof O)&&(!!e.portal||!!e.query)}function gt(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}let y=class extends q{constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new ue,this.source=new O,this.view=null}initialize(){const e=()=>this._recreateItems();this.addHandles([$((()=>this.state==="ready"?this.compatibilityFunction:null),(()=>this._updateItems())),Re((()=>this.source?.basemaps),"change",e,{onListenerAdd:e}),le((()=>this.view),(()=>{this.source instanceof O&&(this.source.viewType=this.view?.type)}),{once:!0})])}destroy(){const e=this.source.basemaps.find((t=>t===this.activeBasemap));e&&this.source.basemaps.remove(e),this.source?.destroy()}get activeBasemap(){return this.view?.map?.basemap??null}set activeBasemap(e){const t=this.view;if(!t?.map)return;if(!e||!t.ready)return t.map.basemap=e,void this._clearOverride("activeBasemap");const i=e.spatialReference||this.items?.find((s=>this.basemapEquals(e,s.basemap)))?.spatialReference;if(i&&"spatialReferenceLocked"in t&&!t.spatialReferenceLocked){const s=t.spatialReference;if(i!=null&&!J(s,i)&&!ze(t.spatialReference,i)&&!Ge())return this._override("activeBasemap",e),this._loadingProjectionEngine=!0,void We().then((()=>{this._get("activeBasemap")===e&&(t.map.basemap=e,t.spatialReference=i,this._clearOverride("activeBasemap"))}),(()=>{})).then((()=>{this._loadingProjectionEngine=!1}));t.map.basemap=e,this._clearOverride("activeBasemap"),i==null||J(t.spatialReference,i)||(t.spatialReference=i)}else t.map.basemap=e,this._clearOverride("activeBasemap")}castActiveBasemap(e){return Pe(e)}get activeBasemapIndex(){const{state:e,activeBasemap:t}=this;return e!=="ready"?-1:this._findBasemapIndex(t)}get compatibilityFunction(){return this.view?.type==="3d"?ot:ct}set compatibilityFunction(e){this._overrideIfSome("compatibilityFunction",e)}castSource(e){return Array.isArray(e)||E.isCollection(e)?new he({basemaps:Array.isArray(e)?new E(e):e}):dt(e)?new O({portal:e}):ft(e)?new O(e):gt(e)?e:null}get state(){return this.view?.ready&&this.source?Fe(this.view)&&!this.view.inGeographicLayout?"unsupported":this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return Be(e,t)}refresh(){this._recreateItems()}load(){return this.loadSource()}loadSource(e){return this.addResolvingPromise(q.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_findBasemapIndex(e){const{items:t}=this,i=t.findIndex((s=>s.basemap===e));return i===-1?t.findIndex((s=>this.basemapEquals(s.basemap,e))):i}_recreateItems(){const e=this.source?.basemaps??[],{view:t,compatibilityFunction:i}=this,s=new Map(this.items.map((r=>[r.basemap,r]))),a=e.map((r=>{const l=s.get(r);return l?(s.delete(r),l):new ce({basemap:r,compatibilityFunction:i,view:t})}));this.items.removeAll(),this.items.addMany(a),s.forEach((r=>r.destroy()))}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};n([c()],y.prototype,"_loadingProjectionEngine",void 0),n([c({type:j})],y.prototype,"activeBasemap",null),n([X("activeBasemap")],y.prototype,"castActiveBasemap",null),n([c({readOnly:!0})],y.prototype,"activeBasemapIndex",null),n([c()],y.prototype,"compatibilityFunction",null),n([c({readOnly:!0,type:ue})],y.prototype,"items",void 0),n([c()],y.prototype,"source",void 0),n([X("source")],y.prototype,"castSource",null),n([c({readOnly:!0})],y.prototype,"state",null),n([c()],y.prototype,"view",void 0),y=n([C("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],y);const yt=y,v="esri-basemap-gallery",w={base:v,sourceLoading:`${v}--source-loading`,loader:`${v}__loader`,item:`${v}__item`,itemContainer:`${v}__item-container`,itemContent:`${v}__item-content`,itemTitle:`${v}__item-title`,itemTagsContainer:`${v}__item-tags-container`,itemThumbnail:`${v}__item-thumbnail`,selectedItem:`${v}__item--selected`,itemError:`${v}__item--error`};let g=class extends Le{constructor(e,t){super(e,t),this.disabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new yt,this._focusBasemapItemEnabled=!1,de(re.getLogger(this),"Basemap Gallery","arcgis-basemap-gallery",{version:"4.32"})}initialize(){this.addHandles(le((()=>this.source),(()=>this.viewModel.loadSource()),{sync:!0,initial:!0}))}loadDependencies(){return Oe({scrim:()=>V(()=>import("./BIyGGnuB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url),chip:()=>V(()=>import("./DavrSX6K.js"),__vite__mapDeps([19,20,2,3,4,5,6,7,8,9,10,11,12,13,18,17,16,21,22,23,15]),import.meta.url)})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get icon(){return"basemap"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.source.state==="loading",t=this.disabled||this.viewModel.state==="disabled",i={[w.sourceLoading]:e,[B.disabled]:t};return f("div",{class:this.classes(w.base,B.widget,B.panel,i),key:"container"},this._getContext())}_getContext(){if(this.viewModel.state==="unsupported")return f("div",{class:B.empty,key:"empty-message"},f(ee,{level:this.headingLevel},this.messages.unsupported));if(this.source.state==="loading")return f("div",{class:w.loader,key:"loader"});const e=this.viewModel.items;return e.length>0?f("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:w.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},e.map(((t,i)=>this._renderBasemapGalleryItem(t,i))).toArray()):f("div",{class:B.empty,key:"empty-message"},f(ee,{level:this.headingLevel},this.messages.noBasemaps))}_getRoundRobinIndex(e,t){return(e+t)%t}_handleKeyDown(e){const{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();const{items:i,activeBasemapIndex:s}=this.viewModel,a=t==="ArrowUp"||t==="ArrowLeft"?this._getRoundRobinIndex(Math.max(s-1,-1),i.length):this._getRoundRobinIndex(s+1,i.length),r=i.at(a);r?.state==="ready"&&(this.viewModel.activeBasemap=r.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&e.tabIndex===0&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const t=e.currentTarget["data-item"];t.state==="ready"&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e,t){const i=Ee(e.basemap)||Se("esri/themes/base/images/basemap-toggle-64.svg"),s=e.basemap.title,a=e.basemap.portalItem?.snippet,r=e.error?.message||a||s,{viewModel:{state:l,activeBasemapIndex:o}}=this,m=this.disabled||l==="disabled",p=o===t,d=p||o===-1&&t===0?0:-1,R=l==="loading",b={[w.selectedItem]:p,[w.itemError]:e.state==="error"},M=`basemapgallery-item-${e.uid}`;return f("li",{afterUpdate:this._focusBasemapItem,"aria-checked":p.toString(),"aria-disabled":m.toString(),"aria-labelledby":M,bind:this,class:this.classes(w.item,b),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:d,title:r},f("img",{alt:"",class:w.itemThumbnail,src:i}),f("div",{class:w.itemContent,key:"content"},f("div",{class:w.itemTitle,key:"title"},f("span",{id:M},s)),Ie(e.basemap)?this._renderTags(e.basemap):null),e.state==="loading"||p&&R?f("calcite-scrim",null,f("span",{"aria-hidden":"true",class:B.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return f("div",{class:w.itemTagsContainer,key:"tag"},this._render3DTag(),ke(e)?this._renderBetaTag():null)}_render3DTag(){const{messages:e}=this;return f("calcite-chip",{key:"tag-3d",label:e.tag3D,scale:"s"},this.messages.tag3D)}_renderBetaTag(){const{messages:e}=this;return f("calcite-chip",{appearance:"outline-fill",key:"tag-beta",label:e.tagBeta,scale:"s"},this.messages.tagBeta)}};n([c()],g.prototype,"activeBasemap",null),n([c()],g.prototype,"disabled",void 0),n([c()],g.prototype,"headingLevel",void 0),n([c()],g.prototype,"icon",null),n([c()],g.prototype,"label",null),n([c(),Ce("esri/widgets/BasemapGallery/t9n/BasemapGallery")],g.prototype,"messages",void 0),n([c()],g.prototype,"source",null),n([c()],g.prototype,"view",null),n([c()],g.prototype,"viewModel",void 0),n([c()],g.prototype,"_focusBasemapItemEnabled",void 0),n([Ze()],g.prototype,"_handleClick",null),g=n([C("esri.widgets.BasemapGallery")],g);const Pt=g;export{Pt as default};
