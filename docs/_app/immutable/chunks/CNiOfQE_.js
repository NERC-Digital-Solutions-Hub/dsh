const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BsRkDwgu.js","./Bqd_gqra.js","./CIQQjfB5.js","./BAcBkKCc.js","./CSRfKCc0.js","./CgU_ym0P.js","./DtlFgwmP.js","./CcFT35nQ.js","./M0JgZTHi.js","./IFw7MSSZ.js","./D2dZROTq.js","./CfqCvuNV.js","./B0RVq4b1.js","./D1c7BrxZ.js","./DWPPkjmw.js","./JbyIPgoZ.js","./BCtzk-C-.js","./C4eyRFHZ.js","./DQOJ18NT.js","./Cgb6qxNH.js","./BoQXaWjD.js","./DjaNyL8u.js","./DcfdNZM3.js","./DYYw7YFt.js","./DKVlmMsw.js","./D6wORzA5.js","./D0McSoSZ.js","./B60T0BCa.js","./DnBnwCMo.js","./DkkBFsv6.js","./Dl6bCIPC.js","./9YvG7tFv.js","./CNwZtXe_.js","./E46kXjj4.js","./aQeO9QTD.js","./DePabmVo.js","./Bkom5cG8.js","./BDPef-KV.js","./Bg5lAQPW.js","./BcXCdcOL.js","./BqWAC5sf.js","./DdUoTmJT.js","./B-ijtQ5Q.js","./CYKsn8TC.js","./CShJpVDg.js","./DZd6gJy7.js","./CGvmZw-o.js","./Cl5lrJ4c.js","./C8BmVxiO.js","./BDlco3bb.js","./CirnR8CI.js","./FR_xYEAS.js","./BO7T41XY.js","./D7UGKWpM.js","./CyON1hAb.js","./Cq6xcPf8.js","./MtSiOt06.js","./C0wm8_Yw.js","./B-zGGx3L.js","./7owU_zlG.js","./Djp3mnm5.js","./ByrI9egR.js","./vxzZWcCJ.js","./CcIdp2Yi.js","./Da-VUuQo.js","./D0Se3yGq.js","./COvDEESv.js","./Chk7YAAL.js","./fMX96Gix.js","./BM_yfCyU.js","./QQC62dOK.js","./DYLesDE2.js","./E--N6Yy3.js","./X7dkXTy5.js","./CNcZ35Er.js","./DKpmsPfl.js","./CSo4uJJZ.js","./B1N-tmtC.js","./CASyCajO.js","./BiphejqT.js","./DPCCjVET.js","./pDuGEAnG.js","./DmQditu1.js","./BrScpkSj.js","./rxpTDz6e.js","./BkQcsSCB.js","./DPb6J-GU.js","./_IxPpk9H.js","./BRUGCono.js","./B5o_lm6j.js","./q_b6UJoq.js","./aQ5IuZRd.js","./eYlK6JLp.js","./DUs9h-Fn.js","./Du0WQJv3.js","./J1idRF_O.js","./_MsMyCQj.js","./CzVXZJih.js","./tcMWcbZd.js","./n6UOt7ty.js","./B7wIRYao.js","./B88RY33J.js","./BvIqEAWZ.js","./DCkdB7M8.js","./DDF9JTgg.js","./Bk6HCqyi.js","./DNCFYQOC.js","./DCdj6Lab.js","./gMlJTWF7.js","./Dp3MkQqU.js","./BhfHjf2T.js","./BTLqT4aT.js","./C8ZG1AwD.js","./BhPaqSJj.js","./YVjlbuTu.js","./BbnngyKK.js","./DmxaQ-k8.js","./DW-3qdZ_.js","./BsxeN7wM.js","./ltwylKVQ.js","./uwh25NbA.js","./DX4VvegC.js","./C5CzMsLd.js","./CaC0i37c.js","./DqgbWyRT.js","./DG9bwVAE.js","./DcEC8-tB.js","./4kudGrBO.js","./BJqzdWTu.js","./DdViISjG.js","./JHpxLPrE.js","./B92kdZ15.js","./DP7_WWTp.js","./BhSfrqRb.js","./haExpC0_.js","./gp0vqpyo.js","./BClSL5wp.js","./D8vJWn2M.js","./CWOWzaUq.js","./DLhMxcwp.js","./B00E_7dL.js","./BtD-9i8-.js","./CYeLijs3.js","./DuCwdtFS.js","./BqMYqny5.js","./CbA8Rs8l.js","./2YFNJfbI.js","./GKolV7NZ.js","./lBJv7KCQ.js","./BQV8zBHs.js","./DcXZL-cx.js","./W7naJMja.js","./DqUfNlT4.js","./DGZV8z5E.js","./DQz1YAgS.js","./Cvea1LZP.js","./Do2N-Dw5.js","./cNVmFZQQ.js","./mS1NY2f2.js","./DPHc0Sgi.js","./N86vRvDz.js","./1mYWTFa-.js","./DHKyPJQ0.js","./D4EzmgYN.js","./BfkzOMLV.js","./Cj7KC756.js","./BBwFZqyN.js","./Bdd80V3g.js","./B7DOPRQ6.js","./DK4bfR44.js","./BKo2foNY.js","./DndLQBWr.js","./WCVSSNPR.js","./qJ1Rs9p8.js","./JErgjwFR.js","./JPKE73K4.js","./C2rNy6Lp.js","./D9gy186-.js","./DmI6wQNQ.js","./BLyltQyJ.js","./Cs0_GM_v.js","./CAzaqhxf.js","./wm1q4thl.js","./iZTkh1ZX.js","./BwAbyeCe.js","./CKDs7F62.js","./gQim6TH1.js","./_U4bZfv1.js","./D1Xd7PW1.js","./KcazVFlU.js","./CYsUaMUi.js","./Bbbh9eUc.js","./BNh8SLV0.js","./C2wByPi_.js","./C_UcZ9U1.js","./D3MecMi1.js","./DokGt0TD.js","./CSSVAcyT.js","./Ch9HLMlQ.js","./CcMAzYFv.js","./wgcSlC6h.js","./DMTzKezq.js","./DKmzuciy.js","./6jVx4gpu.js","./DtcRL9WS.js","./BsrspasF.js","./DnBFnl8r.js","./B_ofE66n.js","./DIDjTM9_.js","./sCOC7eLD.js","./n6brNtTg.js","./BR8EEvDc.js","./aBSzc6z6.js","./Cm-m1Zp8.js","./CqgvsNem.js","./B1MVbh5i.js","./DT5ELa7P.js","./C-5UXChP.js","./B-Mdk1tE.js","./B2SuPWre.js","./DX0nv8uQ.js"])))=>i.map(i=>d[i]);
import{g as ye,r as c,m as d,a as N,s as We,R as me,bY as lt,cO as ct,u as q,bK as ve,ad as Ce,bU as ht,cP as A,bf as dt,bi as Ae,b1 as ut}from"./Bqd_gqra.js";import{d as Ge,l as V,w as ne,U as yt,a as ke,f as gt,j as De,h as mt}from"./CcFT35nQ.js";import{i as vt,n as ft}from"./CSRfKCc0.js";import{i as Ke,s as _t}from"./CgU_ym0P.js";import{h as ze}from"./BDlco3bb.js";import{c as Xe}from"./uwh25NbA.js";import{h as bt,d as Et,S as wt,b as St}from"./27Y3ajM6.js";import{_ as R}from"./CIQQjfB5.js";import{g as Tt,o as Ot,l as Gt,V as j,d as Mt,w as Rt}from"./DtlFgwmP.js";import{x as Pt,n as C,y as Ct,O as Te,Q as At,L as kt,T as Dt,U as It,W as Ie}from"./D2dZROTq.js";import{b as $t,d as Ht,x as Z}from"./CNwZtXe_.js";import{u as $e,a as Lt,m as Ut}from"./E46kXjj4.js";import{v as Qe,l as xt,f as Vt,x as Nt,j as Oe}from"./B0RVq4b1.js";import{e as Ft}from"./FR_xYEAS.js";import{c as jt,_ as O,n as He,a as w}from"./Bg5lAQPW.js";import{p as ce,i as k,U as qt,w as D,G as I,L as Yt,g as Bt,v as Zt,H as Je,m as et,x as Wt,z as tt,K as Kt,s as Le,O as Me,P as X,b as fe,Q as Ue,E as zt,n as Xt,S as Qt,Z as Jt,T as ea,V as ta,l as at,W as aa,u as ia,X as oa,Y as ra,_ as sa}from"./BCtzk-C-.js";import{c as na,u as pa,H as Q,I as la,s as ca,o as xe,q as ha,j as da}from"./BoQXaWjD.js";import{m as ua}from"./C4eyRFHZ.js";import{c as ya,f as ga}from"./aQeO9QTD.js";import{e as ma,n as va}from"./DjaNyL8u.js";import{a as ge,l as Re}from"./CfqCvuNV.js";import{m as fa,l as it}from"./CKkaYPbd.js";import{q as _a,b as ba,R as Ea,v as wa}from"./DYYw7YFt.js";import{e as Sa}from"./D9gy186-.js";import{p as Ta,D as Oa,O as Ga,J as Ma}from"./_IxPpk9H.js";import{v as Ra}from"./D4EzmgYN.js";function Ve(e){switch(e){case _.SUPPORTED:break;case _.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case _.GEOMETRY_MISSING:return"no geometry";case _.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case _.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case _.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var _;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(_||(_={}));function Pa(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return _.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return _.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return _.GEOMETRY_TYPE_UNSUPPORTED}const a=e.elevationInfo;return Qe(a)?_.ELEVATION_MODE_UNSUPPORTED:_.SUPPORTED}function Ca(e){return Aa(e).result}function Aa(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:_.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:_.GEOMETRY_MISSING};if(Qe(e.elevationInfo))return{result:_.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,a=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:_.SUPPORTED,geometry:a}:{result:_.GEOMETRY_TYPE_UNSUPPORTED}}function ka(e){if(e.layer?.type!=="graphics")return _.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return _.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return _.SUPPORTED;default:return _.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some((a=>a.type==="object"))?_.SYMBOL_TYPE_UNSUPPORTED:xt(e)!=="on-the-ground"&&Vt(e)?_.ELEVATION_MODE_UNSUPPORTED:_.SUPPORTED}function Ne(e,t,a){if(!t||!e?.map)return;const{map:i}=e;i.layers.find((r=>r===t))||i.add(t,a)}function Wi(e,t){const a=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find((i=>{const o=i.layer;return o===a||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(a)}))}function Ki(e){return Ft(e)||Tt(e)||Ot(e)||Gt(e)}let $=class extends ye{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new j}};c([d({constructOnly:!0})],$.prototype,"layer",void 0),c([d()],$.prototype,"enabled",void 0),c([d()],$.prototype,"updating",void 0),c([d()],$.prototype,"availability",void 0),c([d()],$.prototype,"sublayerSources",void 0),$=c([N("esri.views.interactive.snapping.FeatureSnappingLayerSource")],$);let T=class extends ye{constructor(t){super(t),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new j,this.distance=ce.distance,this.touchSensitivityMultiplier=ce.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const t=this.featureSources;t.some(Fe)&&Ke.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const a=t.filter(Ia),i=this._get("_effectiveFeatureSources")?.filter(Fe)??new j;for(const l of a){const n=i.find((h=>h.layer===l.layer.parent));if(n)n.sublayerSources.includes(l)||n.sublayerSources.add(l);else if(l.layer.parent){const h=new $({layer:l.layer.parent});h.sublayerSources.add(l),i.add(h)}}for(const l of i){const n=l.sublayerSources.filter((h=>!a.includes(h)));l.sublayerSources.removeMany(n)}i.removeMany(i.filter((l=>l.sublayerSources.length===0)));const o=t.filter(Da),r=this._get("_effectiveFeatureSources")??new j,{added:p,removed:s}=vt(r.toArray(),[...o,...i]);return r.removeMany(s),r.addMany(p),r}};function Fe(e){return e.layer.type==="subtype-group"}function Da(e){return e.layer.type!=="subtype-group"}function Ia(e){return e.layer.type==="subtype-sublayer"}c([d()],T.prototype,"enabled",void 0),c([d()],T.prototype,"enabledToggled",void 0),c([d()],T.prototype,"forceDisabled",void 0),c([d()],T.prototype,"selfEnabled",void 0),c([d()],T.prototype,"featureEnabled",void 0),c([d()],T.prototype,"gridEnabled",void 0),c([d()],T.prototype,"attributeRulesEnabled",void 0),c([d({type:j.ofType($)})],T.prototype,"featureSources",void 0),c([d()],T.prototype,"distance",void 0),c([d()],T.prototype,"touchSensitivityMultiplier",void 0),c([d({readOnly:!0})],T.prototype,"effectiveEnabled",null),c([d({readOnly:!0})],T.prototype,"effectiveGridEnabled",null),c([d({readOnly:!0})],T.prototype,"effectiveSelfEnabled",null),c([d({readOnly:!0})],T.prototype,"effectiveFeatureEnabled",null),c([d({readOnly:!0})],T.prototype,"_effectiveFeatureSources",null),T=c([N("esri.views.interactive.snapping.SnappingOptions")],T);class B{constructor(t,a,i,o){this.targetPoint=t,this.constraint=a,this.isDraped=i,this.domain=o}}let ot=class extends B{constructor({targetPoint:t,objectId:a,constraint:i,isDraped:o}){super(t,i,o,k.FEATURE),this.objectId=a}},$a=class extends ot{constructor(t){super({...t,isDraped:!0,constraint:new qt(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new D(I.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Ha=class extends ot{constructor(t){super({...t,constraint:new Yt(t.edgeStart,t.edgeEnd)})}get hints(){return[new D(I.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},pe=class extends B{constructor(t,a,i,o){super(t,new Bt(t),o,k.ALL),this.first=a,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Zt(this.targetPoint,this.isDraped,this.domain)]}},La=class extends B{constructor({lineStart:t,lineEnd:a,targetPoint:i,isDraped:o}){super(i,new Je(t,a),o,k.SELF),this._referenceLineHint=new D(I.REFERENCE_EXTENSION,t,a,o,this.domain)}get hints(){return[this._referenceLineHint,new D(I.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Ua=class extends B{constructor({referenceLine:t,lineStart:a,targetPoint:i,isDraped:o}){const r=Pt(a),{left:p,right:s}=t;na(r,pa(r,r,s),p),super(i,new Je(a,et(r)),o,k.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new D(I.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Wt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((t=>new D(I.REFERENCE,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight)))]}addReferenceLine(t){const a={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{Q(t.right,i.edge.left)&&(i.fadeLeft=!1,a.fadeRight=!1),Q(t.right,i.edge.right)&&(i.fadeRight=!1,a.fadeRight=!1),Q(t.left,i.edge.right)&&(i.fadeRight=!1,a.fadeLeft=!1),Q(t.left,i.edge.left)&&(i.fadeLeft=!1,a.fadeLeft=!1)})),this._referenceLines.push(a)}},xa=class extends B{constructor({targetPoint:t,constraint:a,previousVertex:i,otherVertex:o,otherVertexType:r,isDraped:p,selfSnappingType:s,objectId:l,domain:n}){super(t,a,p,n??k.SELF),this.previousVertex=i,this.otherVertex=o,this.otherVertexType=r,this.selfSnappingType=s??de.None,this.objectId=l??null}get hints(){const t=this.previousVertex,a=this.otherVertexType===he.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===he.CENTER?this.targetPoint:this.otherVertex;return[new D(I.TARGET,a,i,this.isDraped,this.domain),new D(I.REFERENCE,t,a,this.isDraped,this.domain),new tt(this.previousVertex,a,i,this.isDraped,this.domain)]}};var he,de;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(he||(he={})),(function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"})(de||(de={}));let Va=class extends B{constructor({targetPoint:t,point1:a,point2:i,isDraped:o}){super(t,new Kt(et(la(C(),a,i,.5)),.5*ua(Le(a),Le(i))),o,k.SELF),this._p1=a,this._p2=i}get hints(){return[new D(I.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new D(I.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new tt(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function Na(e,t,a,i,o=C()){const r=ca(Fa,e);return r[2]=Nt(i,r,t,a)||0,i.renderCoordsHelper.toRenderCoords(r,t,o),o}const Fa=C();function ja(e,t,a,i){return i.type==="2d"?(J.x=e[0],J.y=e[1],J.spatialReference=t,i.toScreen(J)):(Na(e,t,a,i,je),i.state.camera.projectToScreen(je,_e),ya(_e[0],_e[1]))}const J=ma(0,0,0,null),je=C(),_e=ga();function qa(e){const{spatialReference:t}=e;return Me(t,Ka,za,e)}function Ya(e,t){if(!We(e.spatialReference,t.spatialReference))return null;const{spatialReference:a}=e;return ee[0]=e.x,ee[1]=e.y,ee[2]=e.hasZ?e.z:0,te[0]=t.x,te[1]=t.y,te[2]=t.hasZ?t.z:0,rt(ee,te,a)}function rt(e,t,a){return Me(a,Za,Wa,e,t,a)}const Ba={geodesicLength:qa,geodesicDistanceBetweenPoints:Ya,geodesicDistance:rt};async function st(){return await fa(),Ba}function Za(e,t,a){return ge(_a(Qa,e,t,a).distance,"meters")}function Wa(e,t,a){return ge(it(Xa(e,t,a),{unit:"meters"}),"meters")}function Ka(e){return ge(Ea([e],"meters")[0],"meters")}function za(e){return ge(it(e,{unit:"meters"}),"meters")}function Xa(e,t,a){return new Ct({spatialReference:a,paths:[[[...e],[...t]]]})}const Qa=new ba,ee=C(),te=C();let P=class extends Ge.EventedMixin(ye){constructor(e){super(e),this.options=new T,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=H.MAIN}initialize(){this.addHandles([V((()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:a,effectiveFeatureEnabled:i,effectiveGridEnabled:o}=this.options;return{selfEnabled:a,featureEnabled:i,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}}),((e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=Mt((a=>this._updateEngines(e,t,a)))}),ne),V((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),yt)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach((e=>e.destroy())),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,a){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const i=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!i.has("feature")?this._createFeatureSnappingEngine(a):void 0,e.selfEnabled&&!i.has("self")?this._createSelfSnappingEngine(a):void 0,e.gridEnabled&&!i.has("grid")?this._createGridSnappingEngine(a):void 0]);if(a.aborted)for(const r of o)r.status==="fulfilled"&&r.value?.engine.destroy();else{for(const r of o)r.status==="fulfilled"&&r.value&&i.set(r.value.type,r.value.engine);this._engines=Array.from(i.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},a]=await Promise.all([R(()=>import("./BsRkDwgu.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93]),import.meta.url),st()]);return me(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:a})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:a}=await R(()=>import("./Du0WQJv3.js"),__vite__mapDeps([94,1,2,3,4,5,10,8,7,20,18,71,72,28,73,74,95,96,23,16,9,11,17,19,21,22,24,25,14,26,27,29,30,6,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,12,13,15,93]),import.meta.url);return me(e),{type:"grid",engine:new a({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await R(()=>import("./CzVXZJih.js"),__vite__mapDeps([97,2,3,1,4,5,6,7,8,17,18,20,10,49,12,13,14,15,16,9,11,19,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,98,99,100]),import.meta.url);me(e);const{view:a,options:i}=this,{spatialReference:o}=a;return{type:"feature",engine:new t({view:a,options:i,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,a=e*t;return a*a}snap(e){return ti(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:a}=e;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:r}=a,p=Te(o,r);if(p==null)return t;const{view:s}=this,{elevationInfo:l,visualizer:n}=a,h=[],u=X(p,s,l),v=i.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,v,a)||!Ee(i,a.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=fe(v),h.push(...i.hints);for(const g of this._currentOtherActiveCandidates)Ee(g,a.drawConstraints)&&(g.targetPoint=fe(v),h.push(...g.hints));return n!=null&&this.addHandles(n.draw(h,{spatialReference:r,elevationInfo:ai(a),view:s,selfSnappingZ:a.selfSnappingZ}),be),Ue(v,s,t,a)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case H.MAIN:return e;case H.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=H.MAIN}_removeVisualization(){this.removeHandles(be)}async _snapSinglePoint({point:e,context:t,signal:a}){const{view:i}=this,{elevationInfo:o}=t,r=X(e,i,o),p=await this._fetchCandidates(r,k.ALL,t,a);return this._createSnapResult(r,H.MAIN,p,i,e,t,a)}async _snapMultiPoint({point:e,scenePoint:t,context:a,signal:i}){const{view:o}=this,{coordinateHelper:r,elevationInfo:p,spatialReference:s}=a;await At(t.spatialReference,s);const l=Te(t,s),n=X(l,o,p),h=await this._fetchCandidates(n,k.FEATURE,a,i);if(h.length>0){const g=await this._fetchCandidates(n,k.SELF,a,i);return this._createSnapResult(n,H.SCENE,[...h,...g],o,l,a,i)}const u=X(e,o,p),v=await this._fetchCandidates(u,k.SELF,a,i);return this._createSnapResult(u,H.MAIN,v,o,{z:r.hasZ()&&e.hasZ?e.z??0:void 0,m:r.hasM()&&e.hasM?e.m??0:void 0},a,i)}async _fetchCandidates(e,t,a,i){return(await Promise.all(this._engines.map((o=>o.fetchCandidates(e,t,a,i))))).flat()}_createSnapResult(e,t,a,i,o,r,p){return{get valid(){return!lt(p)},apply:()=>{const{spatialReference:s}=r,{snappedPoint:l,hints:n}=this._processCandidates(e,t,a,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(n,{spatialReference:s,elevationInfo:Oe,view:i,selfSnappingZ:r.selfSnappingZ}),be),Ue(l,i,o,r)}}}_processCandidates(e,t,a,i){if(a.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),zt(e,a);const o=this._currentMainCandidate;if(o!=null){const r=ei(o,a);if(r>=0){if(!(a[r]instanceof pe))return this._intersectWithOtherCandidates(r,a,e,t,i);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,i))return this._updateSnappingCandidate(o,t,a,i)}}return this._intersectWithOtherCandidates(0,a,e,t,i)}_intersectWithOtherCandidates(e,t,a,i,o){const{coordinateHelper:r}=o,p=t[e],s=[];for(let l=0;l<t.length;++l){if(l===e)continue;const n=t[l],h=p.constraint.intersect(n.constraint);if(h)for(const u of h.closestPoints(p.targetPoint))s.push([new pe(fe(u),p,n,n.isDraped),this._squaredScreenDistance(a,u,r)])}return s.length>0&&(s.sort(((l,n)=>l[1]-n[1])),s[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(s[0][0],i,t,o):Ee(p,o.drawConstraints)?this._updateSnappingCandidate(p,i,t,o):{snappedPoint:a,hints:[]}}_updateSnappingCandidate(e,t,a,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const p of a){if(e instanceof pe){if(p.constraint.equals(e.first.constraint)||p.constraint.equals(e.second.constraint))continue}else if(p.constraint.equals(e.constraint))continue;const s=p.constraint.closestTo(o);this._squaredScreenDistance(s,o,i.coordinateHelper)<Ja()&&(p.targetPoint=o,this._currentOtherActiveCandidates.push(p),r.push(...p.hints))}return{snappedPoint:o,hints:r}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,a){return this._squaredScreenDistance(e,t,a.coordinateHelper)<this._squaredPointProximityThreshold(a.pointer)}_squaredScreenDistance(e,t,a){return Xt(this._toScreen(e,a),this._toScreen(t,a))}_toScreen(e,t){return ja(e,t.spatialReference,Oe,this.view)}get test(){}};var H;c([d({constructOnly:!0})],P.prototype,"view",void 0),c([d()],P.prototype,"options",void 0),c([d({readOnly:!0})],P.prototype,"updating",null),c([d()],P.prototype,"_loadTask",void 0),c([d()],P.prototype,"_engines",void 0),c([d()],P.prototype,"_squaredMouseProximityThreshold",null),c([d()],P.prototype,"_squaredTouchProximityThreshold",null),P=c([N("esri.views.interactive.snapping.SnappingManager")],P),(function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"})(H||(H={}));const be="visualization-handle";function Ja(){return ce.satisfiesConstraintScreenThreshold*ce.satisfiesConstraintScreenThreshold}function Ee(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof $a||e instanceof Ha||e instanceof La||e instanceof Ua||e instanceof Va)&&(!(e instanceof xa)||t.direction==null&&e.selfSnappingType===de.LastVertex)}function ei(e,t){return e instanceof pe?we(t,e.first)>=0&&we(t,e.second)>=0?0:-1:we(t,e)}function we(e,t){let a=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){a=i;break}return a}function ti(e){return e.scenePoint!=null}function ai({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Oe:t}function ii(e,t=ue()){return nt(e,t)}function oi(e,t=ue()){return nt(e,t,!1)}function nt(e,t,a=e.hasZ){const i=Qt(e.spatialReference),o=ct(i);if(o==null)return null;const r=(s,l)=>!(l.length<2)&&(xe(s,l[0],l[1],a&&l[2]||0),!0);let p=0;for(const s of e.rings){const l=s.length;if(l<3)continue;const{positionsWorldCoords:n}=t;for(;n.length<l;)n.push(C());const h=ri,u=xe(si,0,0,0),v=1/l;for(let y=0;y<l;y++){if(!r(h,s[y])||!va(h,e.spatialReference,n[y],i))return null;ha(u,u,n[y],v)}const g=Ta(n[0],n[1],u,Oa());if(da(Ga(g))===0)continue;for(let y=0;y<l;y++)Ma(g,u,n[y],n[y]);const m=ni(n);for(let y=0;y<m.length;y+=3)p+=Ra(n[m[y]],n[m[y+1]],n[m[y+2]])}return Re(p,o)}const ri=C(),si=C();function ue(){return{positionsWorldCoords:[]}}function ni(e){return Sa(pi(e),[],2)}function pi(e){const t=new Float64Array(2*e.length);for(let a=0;a<e.length;++a){const i=e[a],o=2*a;t[o]=i[0],t[o+1]=i[1]}return t}const li=e=>({geodesicArea(t){const{spatialReference:a}=t;return Me(a,hi,(i=>di(e,i)),t)}});async function ci(){const e=await R(()=>import("./B88RY33J.js"),__vite__mapDeps([101,1,2,3,4,5,102,103,104,10,8,7]),import.meta.url);return li(e)}function hi(e){return Re(Math.abs(wa([e],"square-meters")[0]),"square-meters")}function di(e,t){try{return Re(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch{return null}}const ui=e=>({autoAreaByElevationMode(t,a,i=ue()){if(a==="on-the-ground"){const o=e.geodesicArea(t);return o??oi(t,i)}return ii(t,i)},autoArea2D(t,a=ue()){return this.autoAreaByElevationMode(t,"on-the-ground",a)}});let Se=null;async function ae(){return Se||(Se=ui(await ci())),Se}function yi(e){return{autoLength2D:t=>e.geodesicLength(t)??ta(t),autoDistanceBetweenPoints2D:(t,a)=>e.geodesicDistanceBetweenPoints(t,a)??ea(t,a),autoDistance2D:(t,a,i)=>(W[0]=t[0],W[1]=t[1],W[2]=t.length===3?t[2]:0,K[0]=a[0],K[1]=a[1],K[2]=a.length===3?a[2]:0,e.geodesicDistance(W,K,i)??Jt(W,K,i))}}async function F(){return yi(await st())}const W=C(),K=C();let G=class extends Ge.EventedAccessor{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:ft(this.activeComponent)}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const t=this.activeComponent;t&&(t.type!=="box"&&t.type!=="reshape"&&t.type!=="graphic-mover"||t.refresh())}set undo(t){this._set("undo",(()=>{this.canUndo()&&t()}))}set redo(t){this._set("redo",(()=>{this.canRedo()&&t()}))}};c([d()],G.prototype,"activeComponent",void 0),c([d()],G.prototype,"cancelled",void 0),c([d()],G.prototype,"history",void 0),c([d()],G.prototype,"tool",null),c([d()],G.prototype,"type",void 0),c([d()],G.prototype,"canUndo",null),c([d()],G.prototype,"canRedo",null),c([d()],G.prototype,"onEnd",void 0),c([d()],G.prototype,"undo",null),c([d()],G.prototype,"redo",null),c([d()],G.prototype,"toggleTool",void 0),c([d()],G.prototype,"addToSelection",void 0),c([d()],G.prototype,"removeFromSelection",void 0),G=c([N("esri.widgets.Sketch.support.OperationHandle")],G);let le=class extends G{};c([d()],le.prototype,"activeComponent",void 0),le=c([N("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],le);let L=class extends G{};c([d()],L.prototype,"activeComponent",void 0),L=c([N("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],L);function gi(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function mi(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var qe;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(qe||(qe={}));const Ye={defaultZ:0},z={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:jt},tool:"transform"};let f=class extends Ge.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new ze,this._internalGraphicsLayer=new Xe({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new $e({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Lt({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Ut({color:[130,130,130,1],width:2}),this.meshSymbol=new $t({symbolLayers:new j([new Ht])}),this.updateGraphics=new j,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new $e({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new at,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Ye,this.defaultUpdateOptions=z,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new T}initialize(){this.addHandles([ke((()=>this.view?.map?.layers),"change",(e=>{e.removed.includes(this.layer)&&this.cancel()})),ke((()=>this.layer?.graphics),"change",(e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),V((()=>this.layer?.elevationInfo??null),(e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)}),ne),V((()=>this.view),(e=>{this._defaultSnappingManager=q(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new P({view:e,options:this.snappingOptions})),e.type==="2d"?R(()=>import("./Bk6HCqyi.js"),__vite__mapDeps([105,1,2,3,4,5,29,30,10,8,7,6,14,27,24,25,28,31,32,33,34,35,36,106,17,18,19,107,16,9,11,20,21,22,23,26,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,12,13,15,93,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150]),import.meta.url):e.type==="3d"&&(R(()=>import("./W7naJMja.js").then(t=>t.e),__vite__mapDeps([151,1,2,3,4,5,149,24,25,10,8,7,85,18,86,20,12,13,14,15,34,6,110,11,111,61,90,112,89,91,113,114,115,27,38,39,9,28,29,30,31,32,33,35,36,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,63,64,65,66,26,37,67,17,19,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,116,117,118,16,21,22,23,87,88,92,93,152,153,141,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,140,169,170,171,139,172,173,174,175,176,177,178,179,180,181,182,183,184,108,109,185,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,186,187,188,142,143,144,107,189,190,191,145,146,147,148]),import.meta.url),R(()=>import("./BNh8SLV0.js").then(t=>t.G),__vite__mapDeps([192,1,2,3,4,5,7,38,39,10,8,9,28,29,30,6,14,27,24,25,31,32,33,34,35,36,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,18,62,63,64,65,66,26,37,67,17,19,68,69,70,71,72,73,74,75,76,20,77,78,79,80,81,82,83,84,22,21,12,13,15,154,90,85,86,152,92,89,88,91,87,153,155,112,93,156,157,158,159,160,161,162,163,141,164,165,166,167,168,140,169,170,171,114,115,139,172,173,174,138,193,190,194,181,195,196,197,198,199,200,146,147,201,202,203,204,186,205,206,207,208,209,210,211,212,213,100,214,215,124]),import.meta.url)))}),ne),V((()=>this.view?.spatialReference),((e,t)=>{e&&t&&!e.equals(t)&&this.cancel()}))]),aa(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=q(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,a=!t&&e&&"tooltip"in e?e.tooltip:null;return a?.visible?a:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Ye,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...z,...e,reshapeOptions:{...z.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...z.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=q(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new P({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:i,map:o}=t;i&&(t.cursor=null),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const a="view-ready";this.removeHandles(a),e&&this.addHandles(gt((()=>e.ready),(i=>{this.removeHandles(this._viewHandlesKey),i&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)}),ne),a),this._set("view",e)}cancel(){this._moduleLoaderAbortController=ve(this._moduleLoaderAbortController),this._viewReadyAbortController=ve(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:a,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:a})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map((t=>t.clone())).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:a,layer:i}=this;if(!a||this.state==="disabled")throw i||this._logMissingLayer(),Ce();if(a.activeTool!=null&&(a.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Ne(a,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void a.map.remove(this._internalGraphicsLayer);const r=()=>{if(o===this._operationHandle){const p=this.createGraphic,s=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||p==null||i.add(p),this._sketchContinuationFlag=!1,this.emit("create",{graphic:p,state:s?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),s||this._sketchContinuationFlag)return;const{creationMode:l}=this;if(l==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(Ae(this.create(e,t)))}else l==="update"&&p&&this._updatingHandles.addPromise(Ae(this.update([p])))}};o.on("complete",r),this._operationHandle=o,a.ready&&a.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:a,view:i,state:o}=this;if(!i||o==="disabled")throw a||this._logMissingLayer(),Ce();i.activeTool!=null&&(i.activeTool=null);const r=Array.isArray(e)?e:[e];if(e==null||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some((s=>s.layer!==a?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):s.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0))))return;const p=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,t));this.destroyed||p==null||S(p)||(Ne(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(p,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:p.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const a of e)a.geometry==null||a.geometry.type==="mesh"||We(a.geometry.spatialReference,t.spatialReference)||(kt(a.geometry.spatialReference,t.spatialReference)||Dt()||await It(),a.geometry=Te(a.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach((p=>{p.type!=="vector-tile"&&p.type!=="imagery"||o.push(p)}));const r=await t.hitTest(e,{exclude:o});return ia(r.results)}const a=[t.map.ground];t.map.allLayers.forEach((o=>{Rt(o.type)&&a.push(o)}));const i=await t.hitTest(e,{exclude:a});if(i.results.length>0){const o=i.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(o.distance??0)>-Math.min(3*i.ground.distance,t.viewingMode==="global"?ht(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",(async t=>{const a=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!a&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))}),O.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer((()=>this._getFirstHit(He(e))));let a=null;if(t!=null){const i=t.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(e.stopPropagation(),a=i):this.view?.type!=="2d"||this._isComponentGraphic(i)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();a==null||this.updateGraphics.includes(a)||await this.update([a],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const a=this.view;if(!a)return this._logMissingView(),null;const i={hasZ:a.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,a,i);return o==null?null:(a.tools.add(o),a.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,a){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:o,hasZ:r,geometryToPlace:p,graphicProperties:s,mode:l,preserveAspectRatio:n}=a,h=gi(l,e),u=mi(e),v=a?.optionsPerTool?.has(e)?a.optionsPerTool.get(e):{},g=v?.preserveAspectRatio??n??e!=="rectangle",m={centered:e!=="rectangle"&&!(e==="circle"&&!g),cursor:i,defaultZ:o,forceUniformSize:g,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:p,geometryType:u,mode:h,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:t,...v};return t.type==="2d"?this._makeDrawGraphicTool2D(m):this._makeDrawGraphicTool3D(m)}async _makeDrawGraphicTool2D(e){const[t,a,i]=await Promise.all([this._requireModule(R(()=>import("./Bk6HCqyi.js"),__vite__mapDeps([105,1,2,3,4,5,29,30,10,8,7,6,14,27,24,25,28,31,32,33,34,35,36,106,17,18,19,107,16,9,11,20,21,22,23,26,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,12,13,15,93,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150]),import.meta.url)),ae(),F()]);return S(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:fi(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:i})}async _makeDrawGraphicTool3D(e){const[t,a,i]=await Promise.all([this._requireModule(R(()=>import("./W7naJMja.js").then(r=>r.e),__vite__mapDeps([151,1,2,3,4,5,149,24,25,10,8,7,85,18,86,20,12,13,14,15,34,6,110,11,111,61,90,112,89,91,113,114,115,27,38,39,9,28,29,30,31,32,33,35,36,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,63,64,65,66,26,37,67,17,19,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,116,117,118,16,21,22,23,87,88,92,93,152,153,141,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,140,169,170,171,139,172,173,174,175,176,177,178,179,180,181,182,183,184,108,109,185,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,186,187,188,142,143,144,107,189,190,191,145,146,147,148]),import.meta.url)),ae(),F()]);if(S(t)||this.destroyed)return null;const{elevationInfo:o}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:o,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:i})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let a=null;const i=e.forceUniformSize,o=e.centered,r=[t.on("key-down",(s=>{if(s.key===w.pan)s.stopPropagation(),s.repeat||(e.enabled=!1);else if(s.key===w.complete)s.stopPropagation(),e.completeCreateOperation();else if(s.key!==w.vertexAdd||s.repeat)s.key===w.undo?(s.stopPropagation(),p.undo()):s.key===w.redo?(s.stopPropagation(),p.redo()):s.key!==w.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||s.repeat?s.key===w.center&&(s.repeat||(e.centered=!o,s.stopPropagation())):(e.forceUniformSize=!i,s.stopPropagation());else{const l=e.drawOperation.geometryType;l!=="polyline"&&l!=="polygon"&&l!=="multipoint"||(s.stopPropagation(),e.drawOperation.commitStagedVertex())}}),O.WIDGET),t.on("key-up",(s=>{s.key===w.pan?e.enabled=!0:s.key!==w.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?s.key===w.center&&(e.centered=o,s.stopPropagation()):(e.forceUniformSize=i,s.stopPropagation())}),O.WIDGET),e.on("vertex-add",(s=>{switch(a=a==null?"start":"active",s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:a,tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("cursor-update",(s=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:s.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),e.on("vertex-remove",(s=>{switch(s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("complete",(s=>{this._set("createGraphic",s.graphic),a="complete",s.aborted?p&&p.cancel():p&&p.complete()})),V((()=>this._getGraphicSymbolFromTool(e.geometryType)),(s=>{e.graphicSymbol=s}))],p=new le({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{A(r),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return p}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:a,view:i}=this;if(!i)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let r=o.tool??z.tool;for(const p of e)a.remove(p),a.add(p);if(i.type==="3d"){if(e.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(e,o,i,r);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,i);case"transform":return this._setupGraphicTransform3DOperation(e,o,i)}}switch(r){case"move":return this._setupMove2DOperation(e,o,i);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,r,o,i);case"transform":if(e.length===1){const p=e[0].geometry?.type;p!=="point"&&p!=="multipoint"||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,o,i)}}async _setupMove3DOperation(e,t,a,i,o=!1){const[r,p]=await Promise.all([this._requireModule(R(()=>import("./W7naJMja.js").then(m=>m.e),__vite__mapDeps([151,1,2,3,4,5,149,24,25,10,8,7,85,18,86,20,12,13,14,15,34,6,110,11,111,61,90,112,89,91,113,114,115,27,38,39,9,28,29,30,31,32,33,35,36,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,63,64,65,66,26,37,67,17,19,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,116,117,118,16,21,22,23,87,88,92,93,152,153,141,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,140,169,170,171,139,172,173,174,175,176,177,178,179,180,181,182,183,184,108,109,185,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,186,187,188,142,143,144,107,189,190,191,145,146,147,148]),import.meta.url)),F()]);if(S(r))return r;const{ManipulatedObject3DGraphic:s,MoveTool3D:l}=r.module,n=new Map,h=()=>{n.forEach((m=>m.destroy())),n.clear()};for(const m of e){const y=new s({view:a,graphic:m}),b=Pa(y);if(b!==_.SUPPORTED)return h(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Ve(b)}).`),null;n.set(m,y)}const u=new l({view:a,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:p});a.tools.add(u),u.objects.addMany(Array.from(n.values())),o||this.updateGraphics.addMany(e);const v=[],g=new L({activeComponent:u,tool:i,type:"update",onEnd:()=>{A(v),re(a,u),h()},undo:()=>{Ze(this.view,u),ie(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{oe(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:m=>{this.updateGraphics.push(m);const y=new s({view:a,graphic:m});n.set(m,y),u.objects.push(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[m],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:m=>{const y=this.updateGraphics.indexOf(m);if(g.history.undo.forEach((M=>M.updates.splice(y,1))),g.history.redo.forEach((M=>M.updates.splice(y,1))),this.updateGraphics.remove(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[m],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void g.complete();const b=n.get(m);b&&(u.objects.remove(b),b.destroy(),n.delete(m))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||i!=="transform")return;const m=this.updateGraphics.at(0),y=await this._setupReshape3DOperation(m,t,a,!0);y&&!S(y)&&(g.onEnd(),g.destroy(),this._setUpdateOperationHandle(y,t))}});return v.push(...this._getHandlesForComponent(g,t),a.on("immediate-click",(m=>this._getCommonUpdateOperationClickHandlers(g,m,t)),O.WIDGET),a.on("key-down",(m=>{this._getCommonUpdateOperationKeyDownHandlers(g,m)}),O.WIDGET)),g}_setupGraphicTransform3DOperation(e,t,a,i=!1){if(e.length===1&&ka(e[0])===_.SUPPORTED){const o=e[0],r=o.geometry;if(r!=null&&(r.type==="point"||r.type==="mesh"))return this._setupPointTransform3DOperation(o,t,a);if(r!=null&&(r.type==="polygon"||r.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,a,i)}return this._setupMove3DOperation(e,t,a,"transform",i)}async _setupPointTransform3DOperation(e,t,a){const i="transform",{enableRotation:o,enableScaling:r,enableZ:p}=t,s=await this._requireModule(R(()=>import("./W7naJMja.js").then(m=>m.e),__vite__mapDeps([151,1,2,3,4,5,149,24,25,10,8,7,85,18,86,20,12,13,14,15,34,6,110,11,111,61,90,112,89,91,113,114,115,27,38,39,9,28,29,30,31,32,33,35,36,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,63,64,65,66,26,37,67,17,19,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,116,117,118,16,21,22,23,87,88,92,93,152,153,141,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,140,169,170,171,139,172,173,174,175,176,177,178,179,180,181,182,183,184,108,109,185,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,186,187,188,142,143,144,107,189,190,191,145,146,147,148]),import.meta.url));if(S(s))return s;const{TransformTool3D:l,ManipulatedObject3DGraphic:n}=s.module,h=new n({graphic:e,view:a}),u=new l({object:h,view:a,enableRotation:o,enableScaling:r,enableZ:p,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(u),this.updateGraphics.add(e);const v=[],g=new L({activeComponent:u,tool:i,type:"update",onEnd:()=>{A(v),re(a,u),h.destroy()},undo:()=>{Ze(this.view,u),ie(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{oe(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async m=>{this.updateGraphics.add(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[m],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const y=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);S(y)||this._setUpdateOperationHandle(y,t)},removeFromSelection:m=>{this.updateGraphics.remove(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[m],type:"selection-change"},type:"update"}),g.complete()},toggleTool:()=>{}});return v.push(...this._getHandlesForComponent(g,t),a.on("immediate-click",(m=>this._getCommonUpdateOperationClickHandlers(g,m,t)),O.WIDGET),a.on("key-down",(m=>{this._getCommonUpdateOperationKeyDownHandlers(g,m)}),O.WIDGET)),g}async _setupPolyTransform3DOperation(e,t,a,i=!1){const o="transform",{enableRotation:r,enableScaling:p,enableZ:s,preserveAspectRatio:l}=t,[n,h]=await Promise.all([this._requireModule(R(()=>import("./W7naJMja.js").then(E=>E.e),__vite__mapDeps([151,1,2,3,4,5,149,24,25,10,8,7,85,18,86,20,12,13,14,15,34,6,110,11,111,61,90,112,89,91,113,114,115,27,38,39,9,28,29,30,31,32,33,35,36,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,63,64,65,66,26,37,67,17,19,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,116,117,118,16,21,22,23,87,88,92,93,152,153,141,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,140,169,170,171,139,172,173,174,175,176,177,178,179,180,181,182,183,184,108,109,185,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,186,187,188,142,143,144,107,189,190,191,145,146,147,148]),import.meta.url)),F()]);if(S(n))return n;const{ManipulatedObject3DGraphic:u,ExtentTransformTool:v}=n.module,g=this.view?.inputManager?.isModifierKeyDown(w.constraint),m=new u({view:a,graphic:e}),y=new v({object:m,view:a,enableRotation:r,enableScaling:p,enableZ:s,preserveAspectRatio:!!l!=!!g,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:h});a.tools.add(y),i||this.updateGraphics.add(e);const b=[],M=new L({activeComponent:y,tool:o,type:"update",onEnd:()=>{A(b),re(a,y),m.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async E=>{this.updateGraphics.add(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[E],removed:[],type:"selection-change"},type:"update"}),M.onEnd(),M.destroy();const Pe=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);S(Pe)||this._setUpdateOperationHandle(Pe,t)},removeFromSelection:E=>{this.updateGraphics.remove(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[E],type:"selection-change"},type:"update"}),M.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const E=await this._setupReshape3DOperation(e,t,a,!0);E&&!S(E)&&(M.onEnd(),M.destroy(),this._setUpdateOperationHandle(E,t))}});return b.push(...this._getHandlesForComponent(M,t),a.on("immediate-click",(E=>this._getCommonUpdateOperationClickHandlers(M,E,t)),O.WIDGET),a.on("key-down",(E=>this._getCommonUpdateOperationKeyDownHandlers(M,E)),O.WIDGET),a.on("key-down",(E=>{E.key!==w.constraint||E.repeat||(y.preserveAspectRatio=!y.preserveAspectRatio,E.stopPropagation())}),O.WIDGET),a.on("key-up",(E=>{E.key===w.constraint&&(y.preserveAspectRatio=!y.preserveAspectRatio,E.stopPropagation())}),O.WIDGET)),M}async _setupMove2DOperation(e,t,a){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,a);if(S(o))return o;const r=new L({activeComponent:o,tool:i,type:"update",onEnd:()=>{this._displayDefaultCursor(),A(l),A(s),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const n=this.updateGraphics.toArray();ie(r,n),r.refreshComponent(),this._emitUndoEvent({graphics:n,tool:i})},redo:()=>{const n=this.updateGraphics.toArray();oe(r,n),r.refreshComponent(),this._emitRedoEvent({graphics:n,tool:i})},addToSelection:async n=>{await this._updatingHandles.addPromise(this._updateSpatialReference(n)),this.updateGraphics.push(n),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{const h=this.updateGraphics.indexOf(n);r.history.undo.forEach((v=>v.updates.splice(h,1))),r.history.redo.forEach((v=>v.updates.splice(h,1))),this.updateGraphics.remove(n);const u=this.updateGraphics.toArray();this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=u:r.complete()}});let p=!1;const s=[a.on("immediate-click",(n=>this._getCommonUpdateOperationClickHandlers(r,n,t)),O.WIDGET),a.on("key-down",(n=>{this._getCommonUpdateOperationKeyDownHandlers(r,n),n.key!==w.constraint||n.repeat||(p=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)}),O.WIDGET),a.on("key-up",(n=>{n.key===w.constraint&&p&&(p=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)}),O.WIDGET)],l=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,a,i=!1){const o="reshape",[r,p,s]=await Promise.all([this._requireModule(R(()=>import("./W7naJMja.js").then(b=>b.e),__vite__mapDeps([151,1,2,3,4,5,149,24,25,10,8,7,85,18,86,20,12,13,14,15,34,6,110,11,111,61,90,112,89,91,113,114,115,27,38,39,9,28,29,30,31,32,33,35,36,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,63,64,65,66,26,37,67,17,19,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,116,117,118,16,21,22,23,87,88,92,93,152,153,141,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,140,169,170,171,139,172,173,174,175,176,177,178,179,180,181,182,183,184,108,109,185,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,186,187,188,142,143,144,107,189,190,191,145,146,147,148]),import.meta.url)),ae(),F()]);if(S(r))return r;const{ManipulatedObject3DGraphic:l,ReshapeTool3D:n}=r.module,h=new l({view:a,graphic:e}),u=Ca(h);if(u!==_.SUPPORTED)return h.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Ve(u)}).`),null;const v=t.reshapeOptions,g=new n({view:a,object:h,enableZVertex:t.enableZ&&v?.vertexOperation==="move",enableZShape:t.enableZ&&v?.shapeOperation==="move",enableMoveObject:v?.shapeOperation==="move"||v?.shapeOperation==="move-xy",enableMidpoints:v?.edgeOperation==="split",enableEdgeOffset:v?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:p,automaticLengthMeasurementUtils:s});a.tools.add(g),i||this.updateGraphics.add(h.graphic);const m=[],y=new L({activeComponent:g,tool:o,type:"update",onEnd:()=>{A(m),re(a,g),h.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async b=>{this.updateGraphics.add(b),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[b],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const M=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);S(M)||this._setUpdateOperationHandle(M,t)},removeFromSelection:b=>{this.updateGraphics.remove(b),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[b],type:"selection-change"},type:"update"}),y.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;y.onEnd(),y.destroy();const b=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,a,!0);S(b)||this._setUpdateOperationHandle(b,t)}});return m.push(...this._getHandlesForComponent(y,t),a.on("immediate-click",(b=>this._getCommonUpdateOperationClickHandlers(y,b,t)),O.WIDGET),a.on("key-down",(b=>{this._getCommonUpdateOperationKeyDownHandlers(y,b)}),O.WIDGET)),y}async _setupTransformOrReshape2DOperation(e,t,a,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,a,i):await this._getReshape(e,a,i);if(S(o))return o;const r=new L({activeComponent:o,type:"update",onEnd:()=>{A(s),A(p),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{ie(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{oe(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async l=>{let n=r.activeComponent;if(n?.type==="reshape"){const h=[...this.updateGraphics,l];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const u=await this._setupTransformOrReshape2DOperation(h,"transform",a,i);if(S(u))return;this._setUpdateOperationHandle(u,a)}else this.updateGraphics.add(l),n.graphics=this.updateGraphics.toArray(),n.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async l=>{const n=this.updateGraphics.indexOf(l);r.history.undo.forEach((u=>u.updates.splice(n,1))),r.history.redo.forEach((u=>u.updates.splice(n,1))),this.updateGraphics.remove(l);const h=this.updateGraphics.toArray();if(h.length===0)r.complete();else{const u=h[0].geometry;h.length!==1||u==null||u.type!=="point"&&u.type!=="multipoint"?r.activeComponent.graphics=h:r.toggleTool()}this.emit("update",{graphics:h,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const l=this.updateGraphics.at(0),n=l.geometry;if(n!=null&&(r.tool==="reshape"&&(n.type==="point"||n.type==="multipoint")||r.tool==="transform"&&n.type==="extent"))return;let h=null;r.tool==="transform"?h=await this._getReshape([l],a,i):r.tool==="reshape"&&(h=await this._getBox([l],a,i)),S(h)||(r.activeComponent?.destroy(),r.activeComponent=h,r.activeComponent&&(A(s),s=this._getHandlesForComponent(r,a)))}}),p=[i.on("immediate-click",(l=>this._getCommonUpdateOperationClickHandlers(r,l,a)),O.WIDGET),i.on("key-down",(l=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,l),l.key===w.constraint&&!l.repeat&&r){const n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}}),O.WIDGET),i.on("key-up",(l=>{if(l.key===w.constraint&&r){const n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}}),O.WIDGET)];let s=this._getHandlesForComponent(r,a);return r}async _getGraphicMover(e,t,a){const{enableMoveAllGraphics:i,highlightOptions:o}=t,r=await this._requireModule(R(()=>import("./DT5ELa7P.js").then(p=>p.G),__vite__mapDeps([216,1,2,3,4,5,7,120,63,29,30,10,8,6,14,27,24,25,28,31,32,33,34,35,36,121,122,123,124,60,61,18,125,13,15,150,38,39,9,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,62,64,65,66,26,37,67,17,19,68,69,70,71,72,73,74,75,76,20,77,78,79,80,81,82,83,84,100,145,22,12,146,147,148]),import.meta.url));return S(r)?r:new r.module.default({enableMoveAllGraphics:i,highlightName:o?.name,highlightsEnabled:!!o?.enabled,indicatorsEnabled:!1,graphics:e,view:a,callbacks:{onGraphicMoveStart:({dx:p,dy:s,graphic:l})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:s,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:p,dy:s,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:s,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:p,dy:s,graphic:l})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:s,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayMoveCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,a){const{enableRotation:i,enableScaling:o,highlightOptions:r,preserveAspectRatio:p}=t,[s,l]=await Promise.all([this._requireModule(R(()=>import("./C-5UXChP.js"),__vite__mapDeps([217,1,2,3,4,5,29,30,10,8,7,6,14,27,24,25,28,31,32,33,34,35,36,11,150,216,120,63,121,122,123,124,60,61,18,125,13,15,38,39,9,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,62,64,65,66,26,37,67,17,19,68,69,70,71,72,73,74,75,76,20,77,78,79,80,81,82,83,84,100,145,22,12,146,147,148,218,16,21,23,85,86,87,88,89,90,91,92,93,110,111,112,113,114,115,116,117,118,191,187]),import.meta.url)),F()]);if(S(s))return s;const n=this.view?.inputManager?.isModifierKeyDown(w.constraint);return new s.module.default({graphics:e,enableRotation:i,enableScaling:o,highlightName:r?.name,highlightsEnabled:!!r?.enabled,preserveAspectRatio:!!p!=!!n,layer:this._internalGraphicsLayer,view:a,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:l,callbacks:{onMoveStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onMove:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onMoveStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScaleStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScale:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScaleStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotateStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotate:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotateStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"})}})}async _getReshape(e,t,a){const{highlightOptions:i,reshapeOptions:o}=t,r=o?.edgeOperation==="split",p=o?.shapeOperation==="move",[s,l,n]=await Promise.all([this._requireModule(R(()=>import("./B2SuPWre.js"),__vite__mapDeps([219,1,2,3,4,5,29,30,10,8,7,6,14,27,24,25,28,31,32,33,34,35,36,120,63,121,122,123,124,60,61,18,125,13,15,67,106,17,19,107,16,9,11,20,21,22,23,26,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,62,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,12,93,108,109,110,111,112,113,114,115,116,117,118,220,188,142,143,144,189,190,149,200,146,147,185,150,216,100,145,148,187,218]),import.meta.url)),ae(),F()]);return S(s)?s:new s.module.default({enableMidpoints:r,enableMovement:p,graphic:e[0],highlightName:i?.name,highlightsEnabled:!!i?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:n,view:a,callbacks:{onReshapeStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onReshape:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onReshapeStop:({mover:h,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:h,type:u},type:"update"}),onMoveStart:({dx:h,dy:u,mover:v,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:h,dy:u,mover:v,type:g},type:"update"}),onMove:({dx:h,dy:u,mover:v,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:h,dy:u,mover:v,type:g},type:"update"}),onMoveStop:({dx:h,dy:u,mover:v,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:h,dy:u,mover:v,type:g},type:"update"}),onVertexAdd:({added:h,type:u,vertices:v})=>{const g=h.map((m=>Ie(m.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:g,vertices:v,type:u},type:"update"})},onVertexRemove:({removed:h,type:u,vertices:v})=>{const g=h.map((m=>Ie(m.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:g,vertices:v,type:u},type:"update"})}}})}_getHandlesForComponent(e,t){const a=e.activeComponent;if(!a)return[];switch(a.type){case"graphic-mover":return[a.on("graphic-click",(({graphic:i,viewEvent:o})=>{o.native?.shiftKey&&t.multipleSelectionEnabled&&(o.stopPropagation(),e.removeFromSelection(i))})),a.on("graphic-move-start",(i=>e.addToHistory(U(i.allGraphics))))];case"box":return[a.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),a.on("move-start",(i=>e.addToHistory(U(i.graphics)))),a.on("rotate-start",(i=>e.addToHistory(U(i.graphics)))),a.on("scale-start",(i=>e.addToHistory(U(i.graphics))))];case"reshape":return[a.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),a.on("move-start",(i=>e.addToHistory(U([i.mover])))),a.on("reshape-start",(i=>e.addToHistory(U([i.graphic])))),a.on("vertex-add",(i=>e.addToHistory(U([i.oldGraphic])))),a.on("vertex-remove",(i=>e.addToHistory(U([i.oldGraphic]))))];case"move-3d":return[a.events.on("record-undo",(({updates:i})=>{e.addToHistory({updates:i})})),a.events.on("move-start",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-start"},type:"update"})})),a.events.on("move",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:i.dx,dy:i.dy,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move"},type:"update"})})),a.events.on("move-stop",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-stop"},type:"update"})})),a.events.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[a.events.on("record-undo",(({updates:i})=>{e.addToHistory({updates:i})})),a.events.on("translate-start",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-start"},type:"update"})})),a.events.on("translate-stop",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-stop"},type:"update"})})),a.events.on("rotate-start",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-start"},type:"update"})})),a.events.on("rotate-stop",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-stop"},type:"update"})})),a.events.on("scale-start",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-start"},type:"update"})})),a.events.on("scale-stop",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-stop"},type:"update"})})),a.events.on("translate",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move"},type:"update"})})),a.events.on("rotate",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate"},type:"update"})})),a.events.on("scale",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale"},type:"update"})})),a.events.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()}))];case"reshape-3d":return[a.events.on("reshape",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})})),a.events.on("move",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})})),a.events.on("vertex-add",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})})),a.events.on("vertex-remove",(i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})})),a.events.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()}))]}}_onTransformOrReshape2DGraphicClick(e,t,a){const{graphic:i,viewEvent:o}=a;return o.native?.shiftKey&&i.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const a=this.view?.map;this._disablePopup(t);const i=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),a&&a.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}};e.on("complete",i)}async _getCommonUpdateOperationClickHandlers(e,t,a){const i=He(t),o=await t.defer((()=>this._getFirstHit(i)));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,a))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,a){const i=!!a.multipleSelectionEnabled;return e.some((o=>o!=null&&!(!i||o.layer!==this.layer)&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0)))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const a=t.key;a===w.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):a===w.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):a===w.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&w.delete.includes(a)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,a=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||a.length===1&&a[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=q(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayMoveCursor(){this.view?.container&&this.view.cursor!=="move"&&(this.view.cursor="move")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,a){Ke.getLogger(this).error(new _t(e,t,a))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const a=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:a}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return De((()=>!this.updating))}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(ve(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await dt(De((()=>e?.ready)),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Be("view"))}_logMissingLayer(){this._logError(vi,Be("layer"))}};c([d()],f.prototype,"_defaultSnappingManager",void 0),c([d()],f.prototype,"updating",null),c([d({readOnly:!0})],f.prototype,"_updatingHandles",void 0),c([d()],f.prototype,"_operationHandle",void 0),c([d({readOnly:!0})],f.prototype,"activeTool",null),c([d({readOnly:!0})],f.prototype,"activeCreateToolDrawMode",null),c([d()],f.prototype,"activeTooltip",null),c([d({types:Z})],f.prototype,"activeFillSymbol",void 0),c([d()],f.prototype,"activeLineSymbol",void 0),c([d()],f.prototype,"activeVertexSymbol",void 0),c([d()],f.prototype,"allowDeleteKey",void 0),c([d({readOnly:!0})],f.prototype,"createGraphic",null),c([d()],f.prototype,"defaultCreateOptions",null),c([d()],f.prototype,"defaultUpdateOptions",null),c([d({type:oa,nonNullable:!0})],f.prototype,"labelOptions",null),c([d()],f.prototype,"layer",void 0),c([d({types:Z})],f.prototype,"pointSymbol",void 0),c([d({types:Z})],f.prototype,"polygonSymbol",void 0),c([d({types:Z})],f.prototype,"polylineSymbol",void 0),c([d()],f.prototype,"meshSymbol",void 0),c([d({type:T,nonNullable:!0})],f.prototype,"snappingOptions",null),c([d()],f.prototype,"snappingManager",null),c([d({readOnly:!0})],f.prototype,"state",null),c([d({type:ra,nonNullable:!0})],f.prototype,"tooltipOptions",null),c([d({readOnly:!0})],f.prototype,"updateGraphics",void 0),c([d()],f.prototype,"updateOnGraphicClick",void 0),c([d()],f.prototype,"creationMode",void 0),c([d({type:sa,nonNullable:!0})],f.prototype,"valueOptions",null),c([d({types:Z})],f.prototype,"vertexSymbol",void 0),c([d({value:null})],f.prototype,"view",null),c([d({constructOnly:!0,type:at})],f.prototype,"sketchOptions",void 0),f=c([N("esri.widgets.Sketch.SketchViewModel")],f);const vi="sketch:missing-property",Be=e=>`Property '${e}' is missing on SketchViewModel.`;function fi(e){return e==="polygon"||e==="rectangle"||e==="circle"}function ie(e,t){pt("undo",e.history.undo,e.history.redo,t)}function oe(e,t){pt("redo",e.history.redo,e.history.undo,t)}function pt(e,t,a,i){const o=t.pop();if(!o)return;const r=o.updates,p=[];i.forEach(((s,l)=>{const n=r[l];n!=null&&("geometry"in n&&n.geometry!=null&&(p.push({geometry:s.geometry}),s.geometry=n.geometry),"symbol"in n&&n.symbol!=null&&(p.push({symbol:s.symbol}),s.symbol=n.symbol),"undo"in n&&(p.push(n),n[e](s)))})),a.push({updates:p})}function Ze(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function U(e){return{updates:e.map((({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t}))}}function re(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function S(e){return"requireError"in e&&e.requireError==="aborted"}function se(e,t){e.networkFeature=t}function _i(e){const t=Y(e.graphic);return{...e,networkFeature:t}}function bi(e){const t=e.graphics.map((a=>Y(a)));return{...e,networkFeatures:t}}function Y(e){return e.networkFeature}function Ei(e){return e?.type==="point"||e?.type==="polyline"||e?.type==="polygon"}let x=class extends ye{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new Xe({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new ze,this.enabled=!0,this._handleSketchViewModelEvents=async t=>{switch(t.type){case"update":switch(t.state){case"active":case"complete":for(const a of t.graphics)Y(a).geometry=Ei(a.geometry)?a.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const a of t.graphics){const i=Y(a);this._removeNetworkFeature(i)}break;case"create":if(t.graphic&&t.state==="complete"&&this._createMode){const a=t.graphic.geometry?.clone(),i=t.graphic.symbol?.clone();if(!a)break;switch(this._createMode){case"stop":{if(a.type!=="point")break;const{stops:o}=this.layer;if(o.length>0&&o.every((({geometry:p})=>!p))){o.at(0).geometry=a;break}if(o.length>1&&o.filter(((p,s)=>s!==0)).every((({geometry:p})=>!p))){o.at(1).geometry=a;break}const r=new St({geometry:a});o.add(r),se(t.graphic,r);break}case"point-barrier":{if(a.type!=="point")break;const o=new wt({geometry:a,symbol:i});this.layer.pointBarriers.add(o),se(t.graphic,o);break}case"polyline-barrier":{if(a.type!=="polyline")break;const o=new Et({geometry:a,symbol:i});this.layer.polylineBarriers.add(o),se(t.graphic,o);break}case"polygon-barrier":{if(a.type!=="polygon")break;const o=new bt({geometry:a,symbol:i});this.layer.polygonBarriers.add(o),se(t.graphic,o);break}}}}(await this.view.whenLayerView(this.layer)).emit(t.type,t.type==="create"?_i(t):bi(t))}}initialize(){this._sketchViewModel=new f({layer:this._graphicsLayer,view:this.view}),this.addHandles([V((()=>this.enabled),(e=>{e?this._activate():this._deactivate()}),mt),V((()=>{const{stops:e,pointBarriers:t,polylineBarriers:a,polygonBarriers:i}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:a,polygonBarriers:i}}),(()=>{this.enabled&&this._loadClonedGraphics()})),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),ut(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=q(this._graphicsLayer),this._sketchViewModel=q(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map((e=>Y(e)))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case"stop":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const t=this._graphicsLayer.graphics.find((a=>Y(a)===e));t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap((t=>t.toArray().map((a=>{const i=a.toGraphic();return i.networkFeature=a,i}))));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};c([d()],x.prototype,"enabled",void 0),c([d({constructOnly:!0})],x.prototype,"layer",void 0),c([d({readOnly:!0})],x.prototype,"selectedNetworkFeatures",null),c([d()],x.prototype,"updating",null),c([d({constructOnly:!0})],x.prototype,"view",void 0),x=c([N("esri.views.2d.layers.support.RouteLayerInteraction")],x);const no=Object.freeze(Object.defineProperty({__proto__:null,get RouteLayerInteraction(){return x}},Symbol.toStringTag,{value:"Module"}));export{_ as P,no as R,pe as a,$a as b,Ha as c,xa as d,Ki as e,Va as f,Ua as g,Pa as h,Na as i,Wi as l,ot as n,he as o,de as p,La as r,ja as s,Ne as t};
