import{r as p,a as d,b as E}from"./DvUDi2Se.js";import{L as c,a as v,b as f,e as _}from"./DSvukMJ1.js";import"./CnfuZz2S.js";var r;(function(s){s[s.PENDING=0]="PENDING",s[s.RESOLVED=1]="RESOLVED",s[s.REJECTED=2]="REJECTED"})(r||(r={}));class R{constructor(){this._resolver=c(),this._status=r.PENDING,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=r.RESOLVED,this._cleanUp()}),(()=>{this._status=r.REJECTED,this._cleanUp()})),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===r.RESOLVED}isRejected(){return this._status===r.REJECTED}isFulfilled(){return this._status!==r.PENDING}abort(){this._resolver.reject(v())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=c(),i=[...this._resolvingPromises,e.promise],t=this._allPromise=Promise.all(i);t.then((()=>{this.isFulfilled()||this._allPromise!==t||this._resolver.resolve()}),(u=>{this.isFulfilled()||this._allPromise!==t||f(u)||this._resolver.reject(u)})),e.resolve()}}const P=s=>{let e=class extends s{constructor(...i){super(...i),this._promiseProps=new R,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,t){return this._promiseProps.promise.then((()=>this)).then(i,t)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=p([d("esri.core.Promise")],e),e};let l=class extends P(E){};l=p([d("esri.core.Promise")],l),(function(s){s.EsriPromiseMixin=P})(l||(l={}));let o;const b=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale,h=globalThis.document?.documentElement;function g(){const s=h?.getAttribute("lang"),e=globalThis.navigator?.language;return b??s??e??"en"}function D(){return o===void 0&&(o=g()),o}const T=/^(?<language>[a-z]{2,3})(?:-[a-z]{3})?(?:-[A-Z][a-z]{3})?(?:-(?<region>[A-Z]{2}|\d{3}))?(?:-.*)?$/;function O(s=D()){return T.exec(s)?.groups}const n=[];function j(s){return n.push(s),_((()=>{n.splice(n.indexOf(s),1)}))}const a=[];function C(s){return a.push(s),_((()=>a.splice(a.indexOf(s),1)))}function m(){const s=g();o!==s&&([...a].forEach((e=>e(s))),o=s,[...n].forEach((e=>e(s))))}globalThis.addEventListener?.("languagechange",m),h&&new MutationObserver((()=>{m()})).observe(h,{attributeFilter:["lang"]});export{C as b,j as d,D as i,l as m,O as s};
