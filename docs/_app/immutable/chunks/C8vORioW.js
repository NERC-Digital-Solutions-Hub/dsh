import{n as l,m}from"./DxjXvSCh.js";import{x as p,l as s}from"./BPUO2T-J.js";import{o as y,B as c,t as f,j as w,u as h,z as u,K as S}from"./w2laebja.js";import{L as g,i as v}from"./X1nuWVwY.js";import{a9 as d,a8 as x,a7 as I}from"./CPwmGbun.js";async function o(r,n,t,e){if(t.length===1){if(d(t[0]))return s(r,t[0],u(t[1],-1));if(f(t[0]))return s(r,t[0].toArray(),u(t[1],-1))}else if(t.length===2){if(d(t[0]))return s(r,t[0],u(t[1],-1));if(f(t[0]))return s(r,t[0].toArray(),u(t[1],-1));if(c(t[0])){const i=await t[0].load(),a=await A(g.create(t[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),e,n);return F(n,await t[0].calculateStatistic(r,a,u(t[2],1e3),n.abortSignal))}}else if(t.length===3&&c(t[0])){const i=await t[0].load(),a=await A(g.create(t[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),e,n);return F(n,await t[0].calculateStatistic(r,a,u(t[2],1e3),n.abortSignal))}return s(r,t,-1)}function F(r,n){return n instanceof v?m.fromReaderAsTimeStampOffset(n.toStorageFormat()):n instanceof Date?m.dateJSAndZoneToArcadeDate(n,S(r)):n}async function A(r,n,t){const e=r.getVariables();if(e.length>0){const i={};for(const a of e)i[a]=n.evaluateIdentifier(t,{name:a});r.parameters=i}return r}function K(r){r.mode==="async"&&(r.functions.stdev=function(n,t){return r.standardFunctionAsync(n,t,(e,i,a)=>o("stdev",n,a,r))},r.functions.variance=function(n,t){return r.standardFunctionAsync(n,t,(e,i,a)=>o("variance",n,a,r))},r.functions.average=function(n,t){return r.standardFunctionAsync(n,t,(e,i,a)=>o("mean",n,a,r))},r.functions.mean=function(n,t){return r.standardFunctionAsync(n,t,(e,i,a)=>o("mean",n,a,r))},r.functions.sum=function(n,t){return r.standardFunctionAsync(n,t,(e,i,a)=>o("sum",n,a,r))},r.functions.min=function(n,t){return r.standardFunctionAsync(n,t,(e,i,a)=>o("min",n,a,r))},r.functions.max=function(n,t){return r.standardFunctionAsync(n,t,(e,i,a)=>o("max",n,a,r))},r.functions.count=function(n,t){return r.standardFunctionAsync(n,t,async(e,i,a)=>{if(y(a,1,1,n,t),a[0]==null)return 0;if(c(a[0]))return a[0].count(e.abortSignal);if(d(a[0])||x(a[0]))return a[0].length;if(f(a[0]))return a[0].length();if(w(a[0]))return a[0].entryCount();throw new l(n,"InvalidParameter",t)})},r.functions.isempty=function(n,t){return r.standardFunctionAsync(n,t,async(e,i,a)=>{if(y(a,1,2,e,i),a.length>=2&&!I(a[1]))throw new l(e,"InvalidParameter",i);return u(a[1],!1)?c(a[0])?await a[0].isEmpty(e.abortSignal):p(a[0]):h(a[0])})})}export{K as registerFunctions};
