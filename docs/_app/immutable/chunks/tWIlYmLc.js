const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Bn-jQ6xz.js","./DEofI9xF.js","./DEfw6_ef.js","./BsH20_Vs.js","./Cg-g7sfq.js","./CbSHxjnO.js","./PPVm8Dsz.js","./CuDkSQ9K.js","./H0QphIdm.js","./CYlsogSb.js","./DiDKkOPS.js","./CupCqN7H.js","./CXxgNwmb.js","./FGXSRGVg.js","./v-Ii51UH.js","./bnayRBMH.js","./BXgHj_R5.js","./fHzmurrr.js","./BSSYCBQc.js","./BlVatGDq.js","./Cosuz3XB.js","./CrVPmpa8.js","./-2w9DGWe.js","./BvZUr92_.js","./ClNG7cqw.js","./5_UtZh6F.js","./DsRi2o3o.js","./DRBpbFTt.js","./DVPBzQS7.js"])))=>i.map(i=>d[i]);
import{_ as r,m as o,a as d,n as R,D as C,d as B,u as _,c as w,r as J,x as L,b as H,w as z}from"./DEfw6_ef.js";import{F as V}from"./CxlgmuS0.js";import{_ as $}from"./PPVm8Dsz.js";import{u as P}from"./C_0-aHjr.js";import{O as g}from"./H0QphIdm.js";import{l as A}from"./62qj6Kpw.js";import{n as k}from"./XDfhPTz9.js";import{O as U,a as j}from"./BsH20_Vs.js";import{i as I,s as W}from"./Cg-g7sfq.js";import{u as K}from"./DiDKkOPS.js";import{l as Q}from"./i1FBtECX.js";import{r as X}from"./CErz6YiP.js";import{r as Y,n as Z,l as ee,f as D}from"./GBH_ff3h.js";import{a as te,f as re}from"./CYlsogSb.js";import{D as oe,H as se,ab as E}from"./CbSHxjnO.js";import{n as ae}from"./Oe6SV2kF.js";import{j as ie}from"./CTb2irFk.js";import{l as c}from"./D0AGBp4m.js";import{o as ne}from"./CXxgNwmb.js";import{G as le,$ as pe}from"./DEofI9xF.js";import{f as ue,l as de,p as ye}from"./C0i3V7C8.js";import{n as ce,a as me,t as he}from"./DYawoE1a.js";var S;let h=S=class extends R{constructor(e){super(e),this.type="none"}clone(){return new S({type:this.type})}};r([X({none:"none",stayAbove:"stay-above"}),o({json:{write:{isRequired:!0}}})],h.prototype,"type",void 0),h=S=r([d("esri.ground.NavigationConstraint")],h);const q=Symbol("GroundInstance");function ze(e){return e!=null&&typeof e=="object"&&q in e}var N,T,F;let i=T=(F=class extends C(K){constructor(e){super(e),this[N]=!0,this.parent=null,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new g;const t=a=>{const{parent:l}=a;l&&l!==this&&"remove"in l&&l.remove?.(a),a.parent=this,a.type!=="elevation"&&a.type!=="base-elevation"&&I.getLogger(this).error(`Layer '${a.title}, id:${a.id}' of type '${a.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},s=a=>{a.parent=null};this.addHandles([this.layers.on("after-add",a=>t(a.item)),this.layers.on("after-remove",a=>s(a.item))]),this.allLayers=new A({getCollections:()=>[this.layers,this.parent?.basemap?.groundLayers]})}removeChildLayer(e){this.layers.remove(e)}initialize(){this.when().catch(e=>{B(e)||I.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}get integratedMeshGround(){const e=this.parent?.basemap?.groundLayers.at(0);return e?.replacesTerrain?e:null}destroy(){const e=this.layers.removeAll();for(const t of e)_(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get loaded(){return super.loaded}get layers(){return this._get("layers")}set layers(e){this._set("layers",k(e,this._get("layers")))}writeLayers(e,t,s,a){const l=[];e&&(a={...a,layerContainerType:"ground"},e.forEach(u=>{if("write"in u){const m={};U(u)().write(m,a)&&l.push(m)}else a?.messages&&a.messages.push(new W("layer:unsupported",`Layers (${u.title}, ${u.id}) of type '${u.declaredClass}' cannot be persisted in the ground`,{layer:u}))})),t.layers=l}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Q(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t?.signal});const{queryAll:s}=await $(()=>import("./Bn-jQ6xz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url);return w(t),s(this.layers.filter(x).toArray(),e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{createSampler:s}=await $(()=>import("./Bn-jQ6xz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url);return w(t),s(this.layers.filter(x).toArray(),e,t)}clone(){const e={opacity:this.opacity,surfaceColor:j(this.surfaceColor),navigationConstraint:j(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new T({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,s){const a=t?.origin||"web-scene",l=t?.portal||null,u=t?.url||null,{populateOperationalLayers:m}=await $(async()=>{const{populateOperationalLayers:b}=await import("./BlVatGDq.js");return{populateOperationalLayers:b}},__vite__mapDeps([19,8,2,3,4,9,10,11,7,20,21,1,5,6,12,22,23,24,25,26,27,13,14,15,16,28]),import.meta.url);w(s);const O=[];if(e.layers&&Array.isArray(e.layers)){const b={context:{origin:a,url:u,portal:l,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};O.push(m(this.layers,e.layers,b))}await Promise.allSettled(O)}},N=q,F);function x(e){return e&&"createElevationSampler"in e}r([o()],i.prototype,"parent",void 0),r([o()],i.prototype,"integratedMeshGround",null),r([o({json:{read:!1,write:{isRequired:!0}}})],i.prototype,"layers",null),r([o()],i.prototype,"allLayers",void 0),r([J("layers")],i.prototype,"writeLayers",null),r([o({readOnly:!0})],i.prototype,"resourceInfo",void 0),r([o({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:L,read:{reader:Y,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Z(e)},target:"transparency"}}})],i.prototype,"opacity",void 0),r([o({type:P,json:{type:[L],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],i.prototype,"surfaceColor",void 0),r([o({type:h,json:{write:!0}})],i.prototype,"navigationConstraint",void 0),i=T=r([d("esri.Ground")],i);const v=i;let f=class extends ee(R){constructor(e){super(e),this.color=null}};r([o({type:P,json:{type:[L],write:!0}})],f.prototype,"color",void 0),f=r([d("esri.effects.FocusAreaOutline")],f);const fe=f;let p=class extends C(D){constructor(e){super(e),this.id=`focusarea-${ae()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new c}readGeometries(e,t,s){Array.isArray(e)?this.geometries=c.fromJSON(e,s):s.origin!=="web-scene"&&s.origin!=="portal-item"||s.hooks?.onAfterLoad?.(()=>this._loadGeometries(oe(e,s),s))}async _loadGeometries(e,t){const s=await se(e,{responseType:"json"});this.geometries=c.fromJSON(s.data,t)}};r([o({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),o()],p.prototype,"id",void 0),r([o({type:String,json:{write:!0}})],p.prototype,"title",void 0),r([o({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],p.prototype,"enabled",void 0),r([o({type:fe,json:{write:!0}})],p.prototype,"outline",void 0),r([o({type:c,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new c(e.items.map(t=>t.clone()))}),ie({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],p.prototype,"geometries",void 0),r([H(["web-scene","portal-item","service"],"geometries")],p.prototype,"readGeometries",null),p=r([d("esri.effects.FocusArea")],p);const ge=p;let y=class extends C(D){constructor(e){super(e),this.areas=new g,this.style="bright"}};r([o({type:g.ofType(ge),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new g(e.items.map(t=>t.clone()))})],y.prototype,"areas",void 0),r([o({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],y.prototype,"style",void 0),y=r([d("esri.effects.FocusAreas")],y);const M=y;function ve(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function be(e){return!(!ve(e)||!le(e)?.operations?.supportsEditing||"editingEnabled"in e&&!pe(e)||ne(e))}const G={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function we(e){let t=null;if(typeof e=="string")if(e in G){const s=G[e];t=new v({resourceInfo:{data:{layers:[s]}}})}else I.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=z(v,e);return t}let n=class extends ce(me(te)){constructor(e){super(e),this.allLayers=new A({getCollections:()=>[this.basemap?.baseLayers,this.basemap?.groundLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.focusAreas=new M,this.allTables=he(this),this.basemap=null,this.editableLayers=new A({getCollections:()=>[this.allLayers],itemFilterFunction:be}),this.ground=new v,this._basemapCache=ue(),this.addHandles(re(()=>this.ground,(t,s)=>{s?.parent===this&&(s.parent=null),t.parent=this},{sync:!0}))}destroy(){de(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=_(this.basemap),_(this.ground),this._set("ground",null)}castBasemap(e){return ye(e,this._basemapCache)}castGround(e){return we(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};r([o({readOnly:!0,dependsOn:[]})],n.prototype,"allLayers",void 0),r([o({type:M,nonNullable:!0,json:{write:{overridePolicy:e=>({enabled:e.areas.length>0,ignoreOrigin:!0})}}})],n.prototype,"focusAreas",void 0),r([o({readOnly:!0})],n.prototype,"allTables",void 0),r([o({type:V,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],n.prototype,"basemap",void 0),r([E("basemap")],n.prototype,"castBasemap",null),r([o({readOnly:!0})],n.prototype,"editableLayers",void 0),r([o({type:v,nonNullable:!0})],n.prototype,"ground",void 0),r([E("ground")],n.prototype,"castGround",null),r([o()],n.prototype,"undoRedo",void 0),n=r([d("esri.Map")],n);const $e=n,Ve=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"}));export{$e as L,Ve as M,be as e,ze as o};
