import{a as T,N as f,b as c,W as w,P as Z,x as N,n as g}from"./Cc17QD5h.js";import{I as $,d as S,w as U,e as C}from"./BeSfGlfk.js";import"./BLSZFbqy.js";import"./CZCUGSrh.js";import"./Djp3mnm5.js";import"./Chx5LzQ5.js";import"./BFGjv385.js";import"./CQL0hffV.js";import"./DSdBzmdi.js";import"./D-I_tQMx.js";import{h as D}from"./iG1wnc6C.js";const W=",",F={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},v=new Set(["integer","small-integer"]);let p=null;function Y(e){return $(e)||S(e)||U(e)}async function A(e){const{field:n,field2:t,field3:s,normalizationField:r,valueExpression:u,fields:o}=e;let i=[];if(u){if(!p){const{arcadeUtils:m}=await C();p=m}i=p.extractFieldNames(u)}return n&&i.push(n),t&&i.push(t),s&&i.push(s),r&&i.push(r),o&&i.push(...o),i}function l(e){return String(e).padStart(2,"0")}function h(e,n,t){let s;return n==="date"||n==="number"?(n==="number"&&(e=new Date(e)),s=`TIMESTAMP'${t?e.getFullYear():e.getUTCFullYear()}-${l((t?e.getMonth():e.getUTCMonth())+1)}-${l(t?e.getDate():e.getUTCDate())} ${l(t?e.getHours():e.getUTCHours())}:${l(t?e.getMinutes():e.getUTCMinutes())}:${l(t?e.getSeconds():e.getUTCSeconds())}'`):s=e,s}function L(e,n,t,s){const{hasQueryEngine:r}=e,u=`(${h(t,y(e,t),r)} - ${h(n,y(e,n),r)})`;let o=F[s],i="/";return o<1&&(o=1/o,i="*"),{sqlExpression:o===1?u:`(${u} ${i} ${o})`,sqlWhere:null}}function y(e,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const t=e.getField(n);if(n.toLowerCase()==="<now>")return;if($(t))return"field"}}function Q(e,n){const t=n&&e.getField(n);return!!t&&v.has(t.type)}function j(e){return`cast(${e} as float)`}function B(e,n){const{format:t,fieldFormat:s,timeZoneOptions:r,fieldType:u}=n??{},o=s?T(s):null;let i,m;if(r&&({timeZone:i,timeZoneName:m}=D(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,o||f(t||"short-date-short-time"),u)),typeof e=="string"&&isNaN(Date.parse(u==="time-only"?`1970-01-01T${e}Z`:e)))return e;switch(u){case"date-only":{const a=o||f(t||"short-date");return typeof e=="string"?N(e,{...a}):c(e,{...a,timeZone:g})}case"time-only":{const a=o||f(t||"short-time");return typeof e=="string"?Z(e,a):c(e,{...a,timeZone:g})}case"timestamp-offset":{if(!i&&typeof e=="string"&&new Date(e).toISOString()!==e)return e;const a=t||o||r?o||f(t||"short-date-short-time"):void 0,d=a?{...a,timeZone:i,timeZoneName:m}:void 0;return typeof e=="string"?w(e,d):c(e,d)}default:{const a=t||o||r?o||f(t||"short-date-short-time"):void 0;return c(typeof e=="string"?new Date(e):e,a?{...a,timeZone:i,timeZoneName:m}:void 0)}}}export{L as C,Q as M,j as N,Y as U,W as c,A as w,B as x};
