import{_ as y,m as A,w as I,S as q,a as O}from"./Aa_nm3Tf.js";import{m as N,k as r,a as L,A as $,I as C}from"./BHwe4xe6.js";import{l as M}from"./CvJVpgMV.js";import{a as P}from"./BFGjv385.js";import{s as R}from"./BnL9dRiP.js";import{t as T}from"./DzPnzJx5.js";function j(e){return(t,s)=>{t[s]=e}}var m;class z{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}class k{constructor(t,s,i,h,l){this.target=t,this.added=s,this.removed=i,this.start=h,this.deleteCount=l}}const _=new N(()=>new z,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1});function B(e){e&&typeof e=="object"&&"destroy"in e&&typeof e.destroy=="function"&&e.destroy()}function w(e){return e?e instanceof v?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function x(e){if(e?.length)return e[0]}function J(e,t,s,i){const h=Math.min(e.length-s,t.length-i);let l=0;for(;l<h&&e[s+l]===t[i+l];)l++;return l}function S(e,t,s,i){t&&t.forEach((h,l,f)=>{e.push(h),S(e,s.call(i,h,l,f),s,i)})}const d=new Set,p=new Set,b=new Set,E=new Map;let D=0,v=m=class extends M{static ofType(e){if(!e)return m;if(E.has(e))return E.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const h=e.typeMap[i].prototype.declaredClass;t?t+=` | ${h}`:t=h}let s=class extends m{};return y([j({Type:e,ensureType:typeof e=="function"?I(e):q(e)})],s.prototype,"itemType",void 0),s=y([O(`esri.core.Collection<${t}>`)],s),E.set(e,s),s}static isCollection(e){return e!=null&&e instanceof m}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new R,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:D++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof m?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),super.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return r(this._observable),this._items}set items(e){this._emitBeforeChanges(1)||(this._splice(0,this.length,w(e)),this._emitAfterChanges(1))}hasEventListener(e){return!this.destroyed&&(e==="change"?this._chgListeners.length>0:super.hasEventListener(e))}on(e,t){if(this.destroyed)return L();if(e==="change"){const s=this._chgListeners,i={removed:!1,callback:t};return s.push(i),this._notifications&&this._notifications.push({listeners:s.slice(),items:this._items.slice(),changes:[]}),L(()=>{i.removed=!0,s.splice(s.indexOf(i),1)})}return super.on(e,t)}once(e,t){const s="deref"in t?()=>t.deref():()=>t,i=this.on(e,h=>{s()?.call(null,h),i.remove()});return i}add(e,t){if(r(this._observable),this._emitBeforeChanges(1))return this;const s=this.getNextIndex(t??null);return this._splice(s,0,[e]),this._emitAfterChanges(1),this}addMany(e,t=this._items.length){if(r(this._observable),!e?.length)return this;if(this._emitBeforeChanges(1))return this;const s=this.getNextIndex(t);return this._splice(s,0,w(e)),this._emitAfterChanges(1),this}at(e){if(r(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(r(this._observable),!this.length||this._emitBeforeChanges(2))return[];const e=this._removeAllRaw();return this._emitAfterChanges(2),e}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return r(this._observable),this._createNewInstance({items:this._items.map(P)})}concat(...e){r(this._observable);const t=e.map(w);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(r(this._observable),!this.length||this._emitBeforeChanges(2))return;const s=this._splice(0,this.length),i=s.length;for(let h=0;h<i;h++)e.call(t,s[h],h,s);this._emitAfterChanges(2)}destroyAll(){this.drain(B)}destroyMany(e){const t=this.removeMany(e);return t.forEach(B),t}every(e,t){return r(this._observable),this._items.every(e,t)}filter(e,t){r(this._observable);const s=arguments.length===2?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:s})}find(e,t){return r(this._observable),this._items.find(e,t)}findIndex(e,t){return r(this._observable),this._items.findIndex(e,t)}flatten(e,t){r(this._observable);const s=[];return S(s,this,e,t),new m(s)}forEach(e,t){return r(this._observable),this._items.forEach(e,t)}getItemAt(e){return r(this._observable),this._items[e]}getNextIndex(e){r(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return r(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return r(this._observable),this._items.indexOf(e,t)}join(e=","){return r(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return r(this._observable),this._items.lastIndexOf(e,t)}map(e,t){r(this._observable);const s=this._items.map(e,t);return new m({items:s})}reorder(e,t=this.length-1){r(this._observable);const s=this.indexOf(e);if(s!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),s!==t){if(this._emitBeforeChanges(4))return e;this._splice(s,1),this._splice(t,0,[e]),this._emitAfterChanges(4)}return e}}pop(){if(r(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=x(this._splice(this.length-1,1));return this._emitAfterChanges(2),e}push(...e){return r(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,e),this._emitAfterChanges(1)),this.length}reduce(e,t){r(this._observable);const s=this._items;return arguments.length===2?s.reduce(e,t):s.reduce(e)}reduceRight(e,t){r(this._observable);const s=this._items;return arguments.length===2?s.reduceRight(e,t):s.reduceRight(e)}remove(e){return r(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(r(this._observable),e<0||e>=this.length||this._emitBeforeChanges(2))return;const t=x(this._splice(e,1));return this._emitAfterChanges(2),t}removeMany(e){if(r(this._observable),!e?.length||this._emitBeforeChanges(2))return[];const t=e instanceof m?e.toArray():e,s=this._items,i=[],h=t.length;for(let l=0;l<h;l++){const f=t[l],o=s.indexOf(f);if(o>-1){const a=1+J(t,s,l+1,o+1),c=this._splice(o,a);c&&c.length>0&&i.push.apply(i,c),l+=a-1}}return this._emitAfterChanges(2),i}reverse(){if(r(this._observable),this._emitBeforeChanges(4))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(4),this}shift(){if(r(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=x(this._splice(0,1));return this._emitAfterChanges(2),e}slice(e=0,t=this.length){return r(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return r(this._observable),this._items.some(e,t)}sort(e){if(r(this._observable),!this.length||this._emitBeforeChanges(4)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(4),this}_requiresSort(e=(t,s)=>t===s?0:t<s?-1:1){const t=this.length-1;for(let s=0;s<t;s++)if(e(this.items[s],this.items[s+1])>0)return!0;return!1}splice(e,t,...s){r(this._observable),arguments.length===1&&(t=this.length),t??=0;const i=(t?2:0)|(s.length?1:0);if(this._emitBeforeChanges(i))return[];const h=this._splice(e,t,s)||[];return this._emitAfterChanges(i),h}toArray(){return r(this._observable),this._items.slice()}toJSON(e){return r(this._observable),this.toArray().map(t=>T(t)?t.toJSON(e):t)}toLocaleString(){return r(this._observable),this._items.toLocaleString()}toString(){return r(this._observable),this._items.toString()}unshift(...e){return r(this._observable),!e.length||this._emitBeforeChanges(1)||(this._splice(0,0,e),this._emitAfterChanges(1)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,s){const i=this._items,h=this.itemType;let l,f;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=$(()=>this._dispatchChange())),e<0&&(e+=this.length),t){if(f=i.splice(e,t),this.hasEventListener("before-remove")){const o=_.acquire();o.target=this,o.cancellable=!0;for(let a=0,c=f.length;a<c;a++)l=f[a],o.reset(l),this.emit("before-remove",o),o.defaultPrevented&&(f.splice(a,1),i.splice(e,0,l),e+=1,a-=1,c-=1);_.release(o)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const o=_.acquire();o.target=this,o.cancellable=!1;const a=f.length;for(let c=0;c<a;c++)o.reset(f[c]),this.emit("after-remove",o);_.release(o)}}if(s?.length){if(h){const n=[];for(const u of s){const g=h.ensureType(u);g==null&&u!=null||n.push(g)}s=n}const o=this.hasEventListener("before-add"),a=this.hasEventListener("after-add"),c=e===this.length;if(o||a){const n=_.acquire();n.target=this,n.cancellable=!0;const u=_.acquire();u.target=this,u.cancellable=!1;for(const g of s)o?(n.reset(g),this.emit("before-add",n),n.defaultPrevented||(c?i.push(g):i.splice(e++,0,g),this._set("length",i.length),a&&(u.reset(g),this.emit("after-add",u)))):(c?i.push(g):i.splice(e++,0,g),this._set("length",i.length),u.reset(g),this.emit("after-add",u));_.release(u),_.release(n)}else{if(c)for(const n of s)i.push(n);else i.splice(e,0,...s);this._set("length",i.length)}}if((s?.length||f?.length)&&this._notifyChangeEvent(s,f),this.hasEventListener("after-splice")){const o=new k(this,s,f,e,t);this.emit("after-splice",o)}return f}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const s=_.acquire();s.target=this,s.cancellable=!0,s.type=e,this.emit("before-changes",s),t=s.defaultPrevented,_.release(s)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=_.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),_.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const s=t.changes;d.clear(),p.clear(),b.clear();for(const{added:a,removed:c}of s){if(a)if(b.size===0&&p.size===0)for(const n of a)d.add(n);else for(const n of a)p.has(n)?(b.add(n),p.delete(n)):b.has(n)||d.add(n);if(c)if(b.size===0&&d.size===0)for(const n of c)p.add(n);else for(const n of c)d.has(n)?d.delete(n):(b.delete(n),p.add(n))}const i=C.acquire();d.forEach(a=>{i.push(a)});const h=C.acquire();p.forEach(a=>{h.push(a)});const l=this._items,f=t.items,o=C.acquire();if(b.forEach(a=>{f.indexOf(a)!==l.indexOf(a)&&o.push(a)}),t.listeners&&(i.length||h.length||o.length)){const a={target:this,added:i,removed:h,moved:o},c=t.listeners.length;for(let n=0;n<c;n++){const u=t.listeners[n];u.removed||u.callback.call(this,a)}}C.release(i),C.release(h),C.release(o)}d.clear(),p.clear(),b.clear()}};y([A()],v.prototype,"_updating",void 0),y([A()],v.prototype,"length",void 0),y([A()],v.prototype,"items",null),y([A({readOnly:!0})],v.prototype,"updating",null),v=m=y([O("esri.core.Collection")],v);const V=v;export{V as O,j as n};
